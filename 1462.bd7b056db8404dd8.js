"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1462],{41462:(C,r,a)=>{a.r(r),a.d(r,{GradeWiseSlabsViewModel:()=>b});var o=a(9120),d=a(31168),h=a(46204),u=a(27329),p=a(21050),m=a(1647),n=a(40950),g=a(15082),v=a(9439);class b extends h.g{constructor(e){super(),this.DialogResult=!1,this.plvGrade=new p.y$(0),this.dtpWEF=new m.Lc(0),Logger.InfoLog("GradeWiseSlabsViewModel::Entering GradeWiseSlabsViewModel()"),this.DisplayMessage="",this.plvGrade.SetTimeToZero(),this.plvGrade.OnPactListBoxValueChanged.Subscribe(this,"plvGrade_SelectedValueChanged"),this.dtpWEF.CustomFormat="MMM/yyyy",this.dtpWEF.Date=o.d.SessionManager.PayrollMonth,this.dtpWEF.Label="With Effect From",this.plvGrade.Label="Grade",this.plvGrade.TypeID=1,this.plvGrade.CCID=50053,this.LoadGrid(),e>0&&(this.plvGrade.SelectedValue=e,this.plvGrade_SelectedValueChanged(this.plvGrade)),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting GradeWiseSlabsViewModel()")}plvGrade_SelectedValueChanged(e){try{if(Logger.InfoLog("GradeWiseSlabsViewModel::Entering plvGrade_SelectedValueChanged()"),this.DisplayMessage="",this.plvGrade.SelectedValue>0){let t=this.plvGrade.SelectedValue;try{let s=o.d.empService.GetQueryData(0,"EGS001",t,"","");if(this.dgv.Clear(),null!=s&&s.length>0){let l;this.dtpWEF.Date=d.J0.ParseDate(s[0].WEF.toString());for(let i=0;i<s.length;i++)l=this.dgv.NewRow(),l.ComponentName_Key=s[i].ComponentID,l.ComponentName=s[i].ComponentName,l.MinAmount=s[i].MinAmount,l.MaxAmount=s[i].MaxAmount,l.ApplicableFormula=s[i].ApplicableFormula,l.AlertType=s[i].AlertType,this.dgv.addRow(l);this.RefreshSno()}else this.dgv.addRow(this.dgv.NewRow())}catch(s){return this.DisplayMessage=s.Message,this.MessageVisibility=!0,void Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION plvGrade_SelectedValueChanged()"+s.Message)}}Logger.InfoLog("GradeWiseSlabsViewModel::Exiting plvGrade_SelectedValueChanged()")}catch(t){Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION plvGrade_SelectedValueChanged()"+t.stack)}}LoadGrid(){Logger.InfoLog("GradeWiseSlabsViewModel::Entering LoadGrid()"),this.dgv=new u.vv,this.dgv.CanUserAddRows=!0,this.dgv.CanUserSortColumns=!1,this.dgv.Columns=[],this.dgv.Width="700";let t,e=new n.O7;e.Header="#",e.DisplayMember="sno",e.ID="sno",e.Width=40,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),e=new n.O7,e.Header="Component Name",e.DisplayMember="ComponentName",e.DataType="LISTBOX",e.CostCenterID=50052,e.FilterCondition="",e.TypeID=10,e.Width=150,this.dgv.Columns.push(e),e=new n.O7,e.Header="Min. Amount",e.DisplayMember="MinAmount",e.ID="MinAmount",e.Width=90,e.ReadOnly=!1,e.DataType="FLOAT",e.DefaultValue="0",this.dgv.Columns.push(e),e=new n.O7,e.Header="Max. Amount",e.DisplayMember="MaxAmount",e.ID="MaxAmount",e.Width=90,e.ReadOnly=!1,e.DataType="FLOAT",e.DefaultValue="0",this.dgv.Columns.push(e),e=new n.O7,e.Header="Applicable Formula",e.DisplayMember="ApplicableFormula",e.DataType="TextBlock",e.Width=200,this.dgv.Columns.push(e),e=new n.O7,e.Header="Alert Type",e.ValueBinding="AlertType",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,t=new Array,t.push(g._p.ComboBoxItems_2("Stop","Stop")),t.push(g._p.ComboBoxItems_2("Warn","Warn")),e.ComboData=t,e.DefaultValue="Stop",this.dgv.Columns.push(e),this.dgv.Table=[],this.dgv.TableNewRow.Subscribe(this,"dgv_RowAdded"),this.dgv.RowDeleted.Subscribe(this,"dgv_RowDeleted"),this.dgv.TableColumns.push("sno"),this.dgv.TableColumns.push("ComponentName"),this.dgv.TableColumns.push("ComponentName_Key"),this.dgv.TableColumns.push("MinAmount"),this.dgv.TableColumns.push("MaxAmount"),this.dgv.TableColumns.push("ApplicableFormula"),this.dgv.TableColumns.push("AlertType"),this.dgv.Clear(),this.dgv.addRow(this.dgv.NewRow()),this.dgv.BeginEdit.Subscribe(this,"onBeginEdit"),this.RefreshSno(),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting LoadGrid()")}dgv_RowAdded(e){this.RefreshSno()}dgv_RowDeleted(e){this.RefreshSno()}RefreshSno(){if(!this.dgv.TableColumns.Contains("sno"))return;let e=1;this.dgv.Table.forEach(t=>{t.sno=e,e++,this.dgv.updateRow(t)})}Button_Click(e){Logger.InfoLog("GradeWiseSlabsViewModel::Entering Button_Click"),"OK"==e.toString()?this.Save_Click():"Clear"==e.toString()&&(this.plvGrade.SelectedValue=0,this.Clear_Click()),"Delete"==e.toString()?this.Delete_Click():"Cancel"==e.toString()&&o.d.page.HideDialog(this.PopUpGUID),Logger.InfoLog("GradeWiseSlabsViewModel::Exiting Button_Click")}Clear_Click(){this.dtpWEF.Date=new Date((new Date).getFullYear(),(new Date).getMonth(),1),this.dgv.Clear(),this.dgv.addRow(this.dgv.NewRow())}Save_Click(){if(Logger.InfoLog("GradeWiseSlabsViewModel::Entering Save_Click"),this.ValidateSave())try{this.dgv.commitEdit();let e="";for(let t=0;t<this.dgv.Table.length;t++)d.J0.IsEmpty(this.dgv.Table[t].ComponentName_Key)||(e+='<Row SNo="'+t+'1"',e+=' ComponentID="'+this.dgv.Table[t].ComponentName_Key.toString()+'"',e+=' MinAmount="'+d.J0.String(this.dgv.Table[t].MinAmount)+'"',e+=' MaxAmount="'+d.J0.String(this.dgv.Table[t].MaxAmount)+'"',e+=' AlertType="'+d.J0.String(this.dgv.Table[t].AlertType)+'"',d.J0.IsEmpty(this.dgv.Table[t].ApplicableFormula)?e+=' ApplicableFormula=""':e+=' ApplicableFormula="'+v.Dw.GetValidXml(this.dgv.Table[t].ApplicableFormula.toString())+'"',e+="/>");if(e.length>0){e="<Rows> "+e+"</Rows>";let t=[];t.push(this.plvGrade.SelectedValue),t.push(new Date(this.dtpWEF.Date.getFullYear(),this.dtpWEF.Date.getMonth(),1)),t.push(e.toString()),t.push(1),t.push(o.d.SessionManager.UserName);let s=o.d.empService.ExecuteQueryPost_SP(t,"spPAY_SetGradeWiseSalarySlabs");parseInt(s.Tables[0][0][Object.keys(s.Tables[0][0])[0]])>0&&(this.DisplayMessage="Record Saved Successfully.",this.MessageVisibility=!0,this.Clear_Click())}}catch(e){return Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION Save_Click()"+e.stack),this.DisplayMessage=e.Message,void(this.MessageVisibility=!0)}Logger.InfoLog("GradeWiseSlabsViewModel::Exiting Save_Click")}Delete_Click(){Logger.InfoLog("GradeWiseSlabsViewModel::Entering Delete_Click");try{let e=[];e.push(this.plvGrade.SelectedValue),e.push(new Date(this.dtpWEF.Date.getFullYear(),this.dtpWEF.Date.getMonth(),1)),e.push(""),e.push(2),e.push(o.d.SessionManager.UserName);let t=o.d.empService.ExecuteQueryPost_SP(e,"spPAY_SetGradeWiseSalarySlabs");null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&(this.DisplayMessage="Deleted Successfully.",this.MessageVisibility=!0,this.Clear_Click())}catch(e){return Logger.ErrorLog("GradeWiseSlabsViewModel::EXCEPTION Delete_Click()"+e.stack),this.DisplayMessage=e.Message,void(this.MessageVisibility=!0)}Logger.InfoLog("GradeWiseSlabsViewModel::Exiting Delete_Click")}ValidateSave(){if(0==this.plvGrade.SelectedValue)return this.DisplayMessage="Select any Grade",this.plvGrade.SetFocus=!0,this.MessageVisibility=!0,!1;let e=0;if(this.dgv.Table.length>0){for(let t=0;t<this.dgv.Table.length;t++)if(null!=this.dgv.Table[t].ComponentName_Key&&null!=this.dgv.Table[t].ComponentName_Key){if(null==this.dgv.Table[t].MinAmount||null==this.dgv.Table[t].MinAmount)return this.DisplayMessage="Enter Min. Amount at Row No : "+(t+1),this.MessageVisibility=!0,!1;if(null==this.dgv.Table[t].MaxAmount||null==this.dgv.Table[t].MaxAmount)return this.DisplayMessage="Enter Max. Amount at Row No : "+(t+1),this.MessageVisibility=!0,!1;if(null==this.dgv.Table[t].AlertType||null==this.dgv.Table[t].AlertType)return this.DisplayMessage="Select any Alert Type at Row No : "+(t+1),this.MessageVisibility=!0,!1}for(let t=0;t<this.dgv.Table.length;t++)null!=this.dgv.Table[t].ComponentName_Key&&null!=this.dgv.Table[t].ComponentName_Key&&""!=this.dgv.Table[t].ComponentName_Key.toString().Trim()&&null!=this.dgv.Table[t].MinAmount&&null!=this.dgv.Table[t].MinAmount&&""!=this.dgv.Table[t].MinAmount.toString().Trim()&&null!=this.dgv.Table[t].MaxAmount&&null!=this.dgv.Table[t].MaxAmount&&""!=this.dgv.Table[t].MaxAmount.toString().Trim()&&null!=this.dgv.Table[t].AlertType&&null!=this.dgv.Table[t].AlertType&&""!=this.dgv.Table[t].AlertType.toString().Trim()&&e++;if(0==e)return this.DisplayMessage="Enter atleast one detail",this.MessageVisibility=!0,!1}return!0}onBeginEdit(e){let l=this.dgv.Table.indexOf(e.args.item);if(l=-1==l||1==this.dgv.Table.length||0==this.dgv.Table.length||this.dgv.Table.length-l<=1?1:0,this.dgv.CanUserAddRows)for(let i=0;i<l;i++){let M=this.dgv.NewRow();this.dgv.addRow(M)}}}}}]);