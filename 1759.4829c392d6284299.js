"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1759],{81759:(k,V,u)=>{u.r(V),u.d(V,{DashBoardNotifViewModel:()=>K});var R=u(10467),i=u(86739),o=u(8787),W=u(23823),w=u(49710),A=u(13349),x=u(18569),F=u(95050),G=u(31820),M=u(58828),U=u(51304);class K extends W.g{constructor(t){super(),this.ProgressValue=0,this.ProgressMax=0,this.ShowProcessDialog=!1,this.LocationID="",this.dtColumns=[],this.EventsType=0,this.Enable=!0,this.ClubInvoice=!1,this.oDocument=null,this._BulkDr=null,this._Ddate=Date.Today();try{this.EventsType=t,this.Grid=new w.vv,this.Grid.Width="500",this.Grid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.InitColumns(),2==t&&this.RefreshData()}catch(l){Logger.ErrorLog("DashBoardNotifViewModel","Constructor",l)}Logger.InfoLog("DashBoardNotifViewModel:: Entering DashBoardNotifViewModel")}InitColumns(){if(2==this.EventsType)this.Grid.Columns=A.GeneralDashboardViewModel.InitColumns("Notification Events_DashBoardCustomize");else if(4==this.EventsType&&(this.Grid.Columns=A.GeneralDashboardViewModel.InitColumns("Post Dated Documents_DashBoardCustomize"),this.LocationID=i.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==i.d.SessionManager.Preferences.EnableLocationWise.toString()?i.d.SessionManager.LocationID>0?i.d.SessionManager.LocationID.toString():i.d.SessionManager.LocationWhere:"0",i.d.SessionManager.IsActionAssigned(4e4,"Read"))){M.PostedDocumentViewModel.SetDimensionQuery();let t=i.d.document.GetDashPDCDocuments(this.LocationID,M.PostedDocumentViewModel.strSelect,M.PostedDocumentViewModel.strJoin);this.dt=t.Tables[0],this.tempdt=t,null!=this.dt&&this.dt.forEach(l=>{l.id=i.d.slick.rowid,l.Date_Text=o.J0.ParseDate(l.DocDate).ToString(i.d.SessionManager.Preferences["Date Format"]),null!=l.ChequeMaturityDate&&(l.MaturityDate=o.J0.ParseDate(l.ChequeMaturityDate).ToString(i.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt}}RefreshData(){if(2==this.EventsType){let t="";"True"==i.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==i.d.SessionManager.Preferences["LW Reports"]&&(i.d.SessionManager.LocationID>0?t=" and dcc.dcCCNID2="+i.d.SessionManager.LocationID:"1"!=i.d.SessionManager.RoleID&&!o.J0.IsEmpty(i.d.SessionManager.LocationWhere)&&(t=" and dcc.dcCCNID2 IN ("+i.d.SessionManager.LocationWhere+")")),U.$.GetScheduleEvents(t).subscribe(l=>{let m=l.Tables[0],a=!1;if(null!=m){let b,e=0;m.forEach(d=>{d.id=i.d.slick.rowid,b=o.J0.ParseDate(d.EventTime),(29==b.Minute||59==b.Minute)&&(b=b.AddMinutes(1)),d.EventTime_Text=b.ToString(i.d.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=parseInt(d.FreqType),1==e?d.FreqType=i.d.GetResource("Com_Once"):4==e?d.FreqType=i.d.GetResource("Reports_LblDaily"):8==e?d.FreqType=i.d.GetResource("Com_Weekly"):16==e||32==e?d.FreqType=i.d.GetResource("Com_Monthly"):0==e&&(d.FreqType="Contract"),o.J0.Int(d.TrackingNO)>0&&(a=!0)})}if(a&&!this.Grid.Columns.find(e=>"TrackingNO"==e.DisplayMember)){let e=new x.O7;e.Header="TrackingNO",e.DisplayMember="TrackingNO",e.ReadOnly=!0,e.Width=80,this.Grid.Columns.push(e),this.Grid.RefreshColumns()}this.Grid.Table=m})}else if(4==this.EventsType&&(this.LocationID=i.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==i.d.SessionManager.Preferences.EnableLocationWise.toString()?i.d.SessionManager.LocationID>0?i.d.SessionManager.LocationID.toString():i.d.SessionManager.LocationWhere:"0",i.d.SessionManager.IsActionAssigned(4e4,"Read"))){M.PostedDocumentViewModel.SetDimensionQuery();let t=i.d.document.GetDashPDCDocuments(this.LocationID,M.PostedDocumentViewModel.strSelect,M.PostedDocumentViewModel.strJoin);this.dt=t.Tables[0],this.tempdt=t,null!=this.dt&&this.dt.forEach(l=>{l.Date_Text=o.J0.ParseDate(l.DocDate).ToString(i.d.SessionManager.Preferences["Date Format"]),null!=l.ChequeMaturityDate&&(l.MaturityDate=o.J0.ParseDate(l.ChequeMaturityDate).ToString(i.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt}}OnButtonClick(t){var l=this;return(0,R.A)(function*(){if("PostPDC"==t){const{PostedDocumentComponent:m}=yield u.e(1284).then(u.bind(u,61284));let a=new M.PostedDocumentViewModel(!0);a.PostedDocumentViewModel_1(l.tempdt),i.d.page.addNewTab({component:m,params:{obj:a}})}else"RefreshPDC"==t&&l.RefreshData()})()}OnLinkClickEvent(t,l,m){try{4==this.EventsType?F.RibbonExtViewModel.LoadDocument(t):2==this.EventsType&&this.LoadDocument(t,!1)}catch(a){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",a)}}AutoPost(){var t=this;return(0,R.A)(function*(){const{ProcessDialogViewModel:l}=yield u.e(1830).then(u.bind(u,1830)),{ProcessDialogComponent:m}=yield u.e(5274).then(u.bind(u,5274));t.ProgressMessage="Resaving documents.Please wait...";let a=new l(t);i.d.page.ShowDialog(a,m,{HideClose:!1,HideHeader:!0,ShowCenter:!0})})()}save(){this.ProgressMessage="Posting documents please wait..";let t=null;this.ClubInvoice?(t=this.dt.filter(a=>1==a.Select),t.sort((a,e)=>a.contractID-e.contractID)):t=this.dt.filter(a=>1==a.Select),this.ProgressMax=t.length,this.ProgressValue=0,this.ShowProcessDialog=!0;let l=new Array,m=0;for(let a=0;a<t.length;a++){if(null!=this.oDocument&&m>0&&this.ClubInvoice&&!o.J0.IsEmpty(t[a].contractID)&&m!=parseInt(t[a].contractID.toString())&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),l.forEach(e=>{e.Remarks=this.oDocument.DisplayMessage,e.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo}),l.Clear()),m=parseInt(t[a].contractID),""==o.J0.String(t[a].Postedvoucherno)&&(this.ClubInvoice?setTimeout(()=>{this.LoadDocument(t[a],!0,!1,l.length),l.push(t[a])},100):setTimeout(()=>{this.LoadDocument(t[a],!0)},100),null==this.oDocument))return void(t[a].Remarks="Define particulars dimension in body");t[a].Select=!1,this._BulkDr=t[a][a]}null!=this.oDocument&&l.length>0&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),l.forEach(a=>{a.Remarks=this.oDocument.DisplayMessage,a.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo})),this.ProgressMax==this.ProgressValue&&(this.ShowProcessDialog=!1)}GetNarr(t,l,m){let a="";if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!o.J0.IsEmpty(t.Tables[0][0].RentNodeid)){var e=t.Tables[1].filter(b=>b.PartID==t.Tables[0][0].RentNodeid.toString());e.length>0&&!o.J0.IsEmpty(e[0].cnt)&&(a+=this.GetStr(e[0].cnt.toString(),m)+"Installment")}return a+=" for the Period of (",i.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=i.d.SessionManager.Preferences.RentalNarrFormat?a+=l.ToString(i.d.SessionManager.Preferences.RentalNarrFormat):a+=l.ToString("MMM/yyyy"),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!o.J0.IsEmpty(t.Tables[0][0].nextDate)&&(i.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=i.d.SessionManager.Preferences.RentalNarrFormat?a+="-"+o.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString(i.d.SessionManager.Preferences.RentalNarrFormat):a+="-"+o.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString("MMM/yyyy")),a+=")",a}LoadDocument(t,l,m=!0,a=0){var e=this;return(0,R.A)(function*(){let d,b=o.J0.String(t.VoucherNo);if(e.ClubInvoice)d=""!=t.DocumentDate.ToString()?o.J0.ParseDate(t.DocumentDate):new Date;else{if(o.J0.IsEmpty(t.EventTime))return;d=o.J0.ParseDate(t.EventTime.toString())}let O=parseInt(t.SchEventID.toString()),L="";Object.keys(t).Contains("SchGUID")&&(L=o.J0.String(t.SchGUID));let v=i.d.report.GetDocumentDetailsByVoucherNo(b);if(o.J0.Int(v.obj)>0){let T;T=v.Tables[0].length>0?v.Tables[0][0]:v.Tables[1][0];const{AddEditDocumentViewModel:J}=yield Promise.resolve().then(u.bind(u,10287)),{AddEditDocumentComponent:_}=yield Promise.resolve().then(u.bind(u,96833));let r=null;null!=e.oDocument&&null==e.oDocument.ScreenObject&&(e.oDocument=null),parseInt(t.SubCostCenterID)>0&&t.SubCostCenterID.toString()!=t.CostCenterID.toString()?((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(t.SubCostCenterID))&&(e.oDocument=new J(parseInt(t.SubCostCenterID.toString()),"",!!l)),r=e.oDocument.ScreenObject.GetEditDataByCCDOCID(t.CostCenterID.toString(),t.NodeID.toString())):((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(T.CostCenterID))&&(e.oDocument=new J(parseInt(T.CostCenterID),T.DocumentName.toString(),!!l)),r=e.oDocument.ScreenObject.GetEditData(T.DocPrefix.toString(),T.DocNumber.toString(),0)),l||i.d.page.addNewTab({title:e.oDocument.ScreenName,component:_,params:{obj:e.oDocument}});let E="";null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("VoucherNO")&&(E=r.Tables[0][0].VoucherNO.toString());let P,p=!1;"2"==o.J0.String(t.RecurMethod)&&!o.J0.IsEmpty(t.RecurMethod)&&"2"==o.J0.String(t.RecurMethod)&&(p=!0),e.ClubInvoice&&!e.oDocument.ScreenObject.GridDataColumns.Contains("ScheduleID")&&(e.oDocument.ScreenObject.GridDataColumns.push("ScheduleID"),e.oDocument.ScreenObject.GridDataColumns.push("SchGUID"));for(let s=0;s<r.Tables[0].length;s++)r.Tables[0][s].DocDetailsID="0",r.Tables[0][s].DocID="0",!o.J0.IsEmpty(t.AttachmentID)&&"0"==o.J0.String(t.AttachmentID)&&r.Columns[0].Contains("CanRecur")&&(r.Tables[0][s].CanRecur=null),p&&(P=r.Tables[0][s].CreditAccount,r.Tables[0][s].CreditAccount=r.Tables[0][s].DebitAccount,r.Tables[0][s].DebitAccount=P,P=r.Tables[0][s].CrAccountCode,r.Tables[0][s].CrAccountCode=r.Tables[0][s].DBAccountCode,r.Tables[0][s].DBAccountCode=P,P=r.Tables[0][s].CrAccountName,r.Tables[0][s].CrAccountName=r.Tables[0][s].DBAccountName,r.Tables[0][s].DBAccountName=P,P=r.Tables[0][s].CrIsBillWise,r.Tables[0][s].CrIsBillWise=r.Tables[0][s].DBIsBillWise,r.Tables[0][s].DBIsBillWise=P);for(let s=0;s<r.Tables[8].length;s++)r.Columns[8].Contains("CanEdit")&&(r.Tables[8][s].CanEdit=!0);if(r.Columns[0].Remove("DocDate"),r.Columns[0].Remove("DocNumber"),e.oDocument.ScreenObject.DocPrefix.ComboBox.SelectedValue=T.DocPrefix.toString(),e.oDocument._Ddate=d,e.oDocument.OnDocPrefixChanged_2(T.DocPrefix.toString(),!1),e.oDocument.ScreenObject.LoadEditData(r,!1,O),e.oDocument.ScheduleID=O,e.oDocument.RecurDocumentVoucherNo=E,e.oDocument.SchGUID=L,e.oDocument.objGeneralDashboard=e,r.Columns[0].Contains("RefCCID")&&"95"==r.Tables[0][0].RefCCID.toString()){r.Columns[0].Contains("RefNodeid")&&!o.J0.IsEmpty(r.Tables[0][0].RefNodeid)&&(e.oDocument.ScreenObject.RefNodeID=parseInt(r.Tables[0][0].RefNodeid.toString())),e.oDocument.ScreenObject.RefCCId=95;let s=null;if(i.d.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&!o.J0.IsEmpty(i.d.SessionManager.Preferences.DepositLinkDimension)&&(s=e.oDocument.ScreenObject.ColumnSource.find(D=>D.CostCenterID==parseInt(i.d.SessionManager.Preferences.DepositLinkDimension))),null==s)return void(e.oDocument=null);let n=e.oDocument.ScreenObject.GetScheduleDetails(e.oDocument.ScreenObject.RefNodeID,d,O),N=e.GetNarr(n,d,a);if(null!=(g=e.oDocument.ScreenObject._StaticFields.find(D=>"CommonNarration"==D.DBColumnName))&&g instanceof G.Dw&&0==a&&(g.Text=N),e.ClubInvoice){var j=e.oDocument.ScreenObject.GridData.filter(D=>D.ScheduleID==O);for(let D=0;D<j.length;D++)e.oDocument.ScreenObject.GridDataColumns.Contains("LineNarration")&&(j[D].LineNarration=N),j[D].SchGUID=L}if(null!=n&&n.Tables[0].length>0&&"1"==n.Tables[0][0].islastInv.toString()&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&!o.J0.IsEmpty(n.Tables[2][0].CCID)){if(null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<n.Tables[2].length;D++)if((c=e.oDocument.ScreenObject.GridData.filter(f=>f[s.ValueMember]==o.J0.String(n.Tables[2][D].CCNodeID))).length>0){let f=o.J0.Double(n.Tables[2][D].Amount);if((C=n.Tables[1].filter(h=>h.PartID==n.Tables[2][D].CCNodeID.toString())).length>0&&!o.J0.IsEmpty(C[0].TotInv)&&(f-=o.J0.Double(C[0].TotInv)),f<=0&&(f=0),1==c.length)c[0].Rate=f,c[0].Gross=f,e.oDocument.CalculateTotals(c[0],!1),f=o.J0.Double(n.Tables[2][D].VatAmount),C.length>0&&""!=o.J0.String(C[0].TotVat)&&(f-=o.J0.Double(C[0].TotVat)),f>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(h=>!o.J0.IsEmpty(h.DisplayMember)&&"dcnum53"==h.DisplayMember.toLowerCase()))&&(c[0].dcNum53=f.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=f.ToString("N"+I.DecimalPoints),e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=f.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum61=f.ToString("N"+I.DecimalPoints)));else{let h=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[s.ValueMember]==n.Tables[2][D].CCNodeID).Compute("sum","Rate");var I;null!=y&&y.toString().length>0&&(h=f-o.J0.Double(y)),h>0&&!o.J0.IsEmpty(c[0].Rate)&&(c[0].Rate=o.J0.Double(c[0].Rate)+h,c[0].Gross=c[0].Rate,e.oDocument.CalculateTotals(c[0],!1)),f=o.J0.Double(n.Tables[2][D].VatAmount),C.length>0&&!o.J0.IsEmpty(C[0].TotVat)&&(f-=o.J0.Double(C[0].TotVat)),h=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[s.ValueMember]==n.Tables[2][D].CCNodeID).Compute("sum","dcNum53"),null!=y&&y.toString().length>0&&(h=f-o.J0.Double(y)),h>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(B=>!o.J0.IsEmpty(B.DisplayMember)&&"dcnum53"==B.DisplayMember.toLowerCase()))&&!o.J0.IsEmpty(c[0].dcNum53)&&(c[0].dcNum53=(o.J0.Double(c[0].dcNum53)+h).ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=c[0].dcNum53,e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=c[0].dcNum53,c[0].dcCalcdcNum61=c[0].dcNum53))}}}else if(null!=n&&n.Tables[0].length>0&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&""!=n.Tables[2][0].CCID.toString()&&null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<n.Tables[2].length;D++){var c;if((c=e.oDocument.ScreenObject.GridData.filter(h=>h[s.ValueMember]==n.Tables[2][D].CCNodeID.toString())).length>0){let h=parseFloat(n.Tables[2][D].Amount.toString());var C;if((C=n.Tables[1].filter(S=>S.PartID==n.Tables[2][D].CCNodeID.toString())).length>0&&!o.J0.IsEmpty(C[0].TotInv)&&(h-=parseFloat(C[0].TotInv.toString())),h<=0)for(let S=0;S<c.length;S++)c[S].Rate=0,c[S].Gross=0,e.oDocument.CalculateTotals(c[S],!1)}}}if(""!=E){let s=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&52627==n.LinkData);if(s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)o.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]=E);else for(let n=0;n<r.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]=E;else(g=e.oDocument.ScreenObject._TextFields.find(N=>N.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))&&g instanceof G.Dw&&(g.Text=E);if(s=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&55262==n.LinkData),s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)o.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]="1");else for(let n=0;n<r.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]="1";else{var g;(g=e.oDocument.ScreenObject._TextFields.find(N=>N.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))instanceof G.Dw&&(g.Text="1")}}e.oDocument.SetNewDocButtonVisibility(),l&&m&&(e.oDocument.GenratePrefix=!0,e.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?e.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":e.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),e.oDocument.SaveCallBackMethod.Subscribe(e,"DocSaveCallBack"),e.oDocument.IsInventoryVoucher?e.oDocument.SaveInventoryDocument_1("ReSave"):e.oDocument.SaveAccountingDocument("ReSave"),e.oDocument.callbacksubject.subscribe(s=>{e.dtColumns.Contains("Remarks")&&(t.Remarks=e.oDocument.DisplayMessage,t.Postedvoucherno=e.oDocument.ScreenObject.VoucherNo),e.dtGrid.RefreshGridView()}))}})()}DocSaveCallBack(){this.ProgressValue++,this.ProgressValue==this.ProgressMax&&(this.ShowProcessDialog=!1)}GetStr(t,l){let m;switch(m=o.J0.Int(t),m++,m+=l,m){case 1:return"1st ";case 2:return"2nd ";case 3:return"3rd ";default:return m+"th "}}}}}]);