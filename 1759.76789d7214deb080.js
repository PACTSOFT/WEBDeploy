"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1759],{81759:(k,j,u)=>{u.r(j),u.d(j,{DashBoardNotifViewModel:()=>K});var R=u(10467),l=u(86739),n=u(8787),W=u(23823),w=u(49710),J=u(13349),x=u(18569),U=u(95050),G=u(31820),M=u(58828),_=u(51304);class K extends W.g{constructor(t){super(),this.ProgressValue=0,this.ProgressMax=0,this.ShowProcessDialog=!1,this.LocationID="",this.dtColumns=[],this.EventsType=0,this.Enable=!0,this.ClubInvoice=!1,this.oDocument=null,this._BulkDr=null,this._Ddate=Date.Today();try{this.EventsType=t,this.Grid=new w.vv,this.Grid.Width="500",this.Grid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.InitColumns(),2==t&&this.RefreshData()}catch(a){Logger.ErrorLog("DashBoardNotifViewModel","Constructor",a)}Logger.InfoLog("DashBoardNotifViewModel:: Entering DashBoardNotifViewModel")}InitColumns(){if(2==this.EventsType)this.Grid.Columns=J.GeneralDashboardViewModel.InitColumns("Notification Events_DashBoardCustomize");else if(4==this.EventsType&&(this.Grid.Columns=J.GeneralDashboardViewModel.InitColumns("Post Dated Documents_DashBoardCustomize"),this.LocationID=l.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==l.d.SessionManager.Preferences.EnableLocationWise.toString()?l.d.SessionManager.LocationID>0?l.d.SessionManager.LocationID.toString():l.d.SessionManager.LocationWhere:"0",l.d.SessionManager.IsActionAssigned(4e4,"Read"))){M.PostedDocumentViewModel.SetDimensionQuery();let t=l.d.document.GetDashPDCDocuments(this.LocationID,M.PostedDocumentViewModel.strSelect,M.PostedDocumentViewModel.strJoin);this.dt=t.Tables[0],this.tempdt=t,null!=this.dt&&this.dt.forEach(a=>{a.id=l.d.slick.rowid,a.Date_Text=n.J0.ParseDate(a.DocDate).ToString(l.d.SessionManager.Preferences["Date Format"]),null!=a.ChequeMaturityDate&&(a.MaturityDate=n.J0.ParseDate(a.ChequeMaturityDate).ToString(l.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt}}RefreshData(){if(2==this.EventsType){let t="";"True"==l.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==l.d.SessionManager.Preferences["LW Reports"]&&(l.d.SessionManager.LocationID>0?t=" and dcc.dcCCNID2="+l.d.SessionManager.LocationID:"1"!=l.d.SessionManager.RoleID&&!n.J0.IsEmpty(l.d.SessionManager.LocationWhere)&&(t=" and dcc.dcCCNID2 IN ("+l.d.SessionManager.LocationWhere+")")),_.$.GetScheduleEvents(t).subscribe(a=>{let m=a.Tables[0],r=!1;if(null!=m){let h,e=0;m.forEach(f=>{f.id=l.d.slick.rowid,h=n.J0.ParseDate(f.EventTime),(29==h.Minute||59==h.Minute)&&(h=h.AddMinutes(1)),f.EventTime_Text=h.ToString(l.d.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=parseInt(f.FreqType),1==e?f.FreqType=l.d.GetResource("Com_Once"):4==e?f.FreqType=l.d.GetResource("Reports_LblDaily"):8==e?f.FreqType=l.d.GetResource("Com_Weekly"):16==e||32==e?f.FreqType=l.d.GetResource("Com_Monthly"):0==e&&(f.FreqType="Contract"),n.J0.Int(f.TrackingNO)>0&&(r=!0)})}if(r&&!this.Grid.Columns.find(e=>"TrackingNO"==e.DisplayMember)){let e=new x.O7;e.Header="TrackingNO",e.DisplayMember="TrackingNO",e.ReadOnly=!0,e.Width=80,this.Grid.Columns.push(e),this.Grid.RefreshColumns()}this.Grid.Table=m})}else if(4==this.EventsType&&(this.LocationID=l.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==l.d.SessionManager.Preferences.EnableLocationWise.toString()?l.d.SessionManager.LocationID>0?l.d.SessionManager.LocationID.toString():l.d.SessionManager.LocationWhere:"0",l.d.SessionManager.IsActionAssigned(4e4,"Read"))){M.PostedDocumentViewModel.SetDimensionQuery();let t=l.d.document.GetDashPDCDocuments(this.LocationID,M.PostedDocumentViewModel.strSelect,M.PostedDocumentViewModel.strJoin);this.dt=t.Tables[0],this.tempdt=t,null!=this.dt&&this.dt.forEach(a=>{a.Date_Text=n.J0.ParseDate(a.DocDate).ToString(l.d.SessionManager.Preferences["Date Format"]),null!=a.ChequeMaturityDate&&(a.MaturityDate=n.J0.ParseDate(a.ChequeMaturityDate).ToString(l.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt}}OnButtonClick(t){var a=this;return(0,R.A)(function*(){if("PostPDC"==t){const{PostedDocumentComponent:m}=yield u.e(1284).then(u.bind(u,61284));let r=new M.PostedDocumentViewModel(!0);r.PostedDocumentViewModel_1(a.tempdt),l.d.page.addNewTab({component:m,params:{obj:r}})}else"RefreshPDC"==t&&a.RefreshData()})()}OnLinkClickEvent(t,a,m){try{4==this.EventsType?U.RibbonExtViewModel.LoadDocument(t):2==this.EventsType&&this.LoadDocument(t,!1)}catch(r){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",r)}}AutoPost(){var t=this;return(0,R.A)(function*(){const{ProcessDialogViewModel:a}=yield u.e(1830).then(u.bind(u,1830)),{ProcessDialogComponent:m}=yield u.e(5274).then(u.bind(u,5274));t.ProgressMessage="Resaving documents.Please wait...";let r=new a(t);l.d.page.ShowDialog(r,m,{HideClose:!1,HideHeader:!0,ShowCenter:!0})})()}save(){this.ProgressMessage="Posting documents please wait..";let t=null;this.ClubInvoice?(t=this.dt.filter(r=>1==r.Select),t.sort((r,e)=>r.contractID-e.contractID)):t=this.dt.filter(r=>1==r.Select),this.ProgressMax=t.length,this.ProgressValue=0,this.ShowProcessDialog=!0;let a=new Array,m=0;for(let r=0;r<t.length;r++){if(null!=this.oDocument&&m>0&&this.ClubInvoice&&!n.J0.IsEmpty(t[r].contractID)&&m!=parseInt(t[r].contractID.toString())&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),a.forEach(e=>{e.Remarks=this.oDocument.DisplayMessage,e.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo}),a.Clear()),m=parseInt(t[r].contractID),""==n.J0.String(t[r].Postedvoucherno)&&(this.ClubInvoice?setTimeout(()=>{this.LoadDocument(t[r],!0,!1,a.length),a.push(t[r])},100):setTimeout(()=>{this.LoadDocument(t[r],!0)},100),null==this.oDocument))return void(t[r].Remarks="Define particulars dimension in body");t[r].Select=!1,this._BulkDr=t[r][r]}null!=this.oDocument&&a.length>0&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),a.forEach(r=>{r.Remarks=this.oDocument.DisplayMessage,r.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo})),this.ProgressMax==this.ProgressValue&&(this.ShowProcessDialog=!1)}GetNarr(t,a,m,r){let e=l.d.report.ReportDataSet("RPT022",!1,"select * from COM_CostCenterPreferences with(Nolock) where CostCenterID = "+r+" and Name = 'RentalNarrFormat'"),h="";if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!n.J0.IsEmpty(t.Tables[0][0].RentNodeid)){var f=t.Tables[1].filter(E=>E.PartID==t.Tables[0][0].RentNodeid.toString());f.length>0&&!n.J0.IsEmpty(f[0].cnt)&&(h+=this.GetStr(f[0].cnt.toString(),m)+"Installment")}return h+=" for the Period of (",null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&null!=e.Tables[0][0].Value&&""!=e.Tables[0][0].Value.toString()?h+=a.ToString(e.Tables[0][0].Value.toString()):h+=a.ToString("MMM/yyyy"),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!n.J0.IsEmpty(t.Tables[0][0].nextDate)&&(null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&null!=e.Tables[0][0].Value&&""!=e.Tables[0][0].Value.toString()?h+="-"+n.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString(e.Tables[0][0].Value.toString()):h+="-"+n.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString("MMM/yyyy")),h+=")",h}LoadDocument(t,a,m=!0,r=0){var e=this;return(0,R.A)(function*(){let f,h=n.J0.String(t.VoucherNo);if(e.ClubInvoice)f=""!=t.DocumentDate.ToString()?n.J0.ParseDate(t.DocumentDate):new Date;else{if(n.J0.IsEmpty(t.EventTime))return;f=n.J0.ParseDate(t.EventTime.toString())}let E=parseInt(t.SchEventID.toString()),L="";Object.keys(t).Contains("SchGUID")&&(L=n.J0.String(t.SchGUID));let v=l.d.report.GetDocumentDetailsByVoucherNo(h);if(n.J0.Int(v.obj)>0){let T;T=v.Tables[0].length>0?v.Tables[0][0]:v.Tables[1][0];const{AddEditDocumentViewModel:A}=yield Promise.resolve().then(u.bind(u,10287)),{AddEditDocumentComponent:F}=yield Promise.resolve().then(u.bind(u,33012));let i=null;null!=e.oDocument&&null==e.oDocument.ScreenObject&&(e.oDocument=null),parseInt(t.SubCostCenterID)>0&&t.SubCostCenterID.toString()!=t.CostCenterID.toString()?((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(t.SubCostCenterID))&&(e.oDocument=new A(parseInt(t.SubCostCenterID.toString()),"",!!a)),i=e.oDocument.ScreenObject.GetEditDataByCCDOCID(t.CostCenterID.toString(),t.NodeID.toString())):((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(T.CostCenterID))&&(e.oDocument=new A(parseInt(T.CostCenterID),T.DocumentName.toString(),!!a)),i=e.oDocument.ScreenObject.GetEditData(T.DocPrefix.toString(),T.DocNumber.toString(),0)),a||l.d.page.addNewTab({title:e.oDocument.ScreenName,component:F,params:{obj:e.oDocument}});let N="";null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("VoucherNO")&&(N=i.Tables[0][0].VoucherNO.toString());let P,p=!1;"2"==n.J0.String(t.RecurMethod)&&!n.J0.IsEmpty(t.RecurMethod)&&"2"==n.J0.String(t.RecurMethod)&&(p=!0),e.ClubInvoice&&!e.oDocument.ScreenObject.GridDataColumns.Contains("ScheduleID")&&(e.oDocument.ScreenObject.GridDataColumns.push("ScheduleID"),e.oDocument.ScreenObject.GridDataColumns.push("SchGUID"));for(let s=0;s<i.Tables[0].length;s++)i.Tables[0][s].DocDetailsID="0",i.Tables[0][s].DocID="0",!n.J0.IsEmpty(t.AttachmentID)&&"0"==n.J0.String(t.AttachmentID)&&i.Columns[0].Contains("CanRecur")&&(i.Tables[0][s].CanRecur=null),p&&(P=i.Tables[0][s].CreditAccount,i.Tables[0][s].CreditAccount=i.Tables[0][s].DebitAccount,i.Tables[0][s].DebitAccount=P,P=i.Tables[0][s].CrAccountCode,i.Tables[0][s].CrAccountCode=i.Tables[0][s].DBAccountCode,i.Tables[0][s].DBAccountCode=P,P=i.Tables[0][s].CrAccountName,i.Tables[0][s].CrAccountName=i.Tables[0][s].DBAccountName,i.Tables[0][s].DBAccountName=P,P=i.Tables[0][s].CrIsBillWise,i.Tables[0][s].CrIsBillWise=i.Tables[0][s].DBIsBillWise,i.Tables[0][s].DBIsBillWise=P);for(let s=0;s<i.Tables[8].length;s++)i.Columns[8].Contains("CanEdit")&&(i.Tables[8][s].CanEdit=!0);if(i.Columns[0].Remove("DocDate"),i.Columns[0].Remove("DocNumber"),e.oDocument.ScreenObject.DocPrefix.ComboBox.SelectedValue=T.DocPrefix.toString(),e.oDocument._Ddate=f,e.oDocument.OnDocPrefixChanged_2(T.DocPrefix.toString(),!1),e.oDocument.ScreenObject.LoadEditData(i,!1,E),e.oDocument.ScheduleID=E,e.oDocument.RecurDocumentVoucherNo=N,e.oDocument.SchGUID=L,e.oDocument.objGeneralDashboard=e,i.Columns[0].Contains("RefCCID")&&!n.J0.IsEmpty(i.Tables[0][0].RefCCID)&&(i.Columns[0].Contains("RefNodeid")&&!n.J0.IsEmpty(i.Tables[0][0].RefNodeid)&&(e.oDocument.ScreenObject.RefNodeID=parseInt(i.Tables[0][0].RefNodeid.toString())),e.oDocument.ScreenObject.RefCCId=n.J0.Int(i.Tables[0][0].RefCCId)),i.Columns[0].Contains("RefCCId")&&("95"==n.J0.String(i.Tables[0][0].RefCCId)||"104"==n.J0.String(i.Tables[0][0].RefCCId))){let s=null;if(l.d.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&!n.J0.IsEmpty(l.d.SessionManager.Preferences.DepositLinkDimension)&&(s=e.oDocument.ScreenObject.ColumnSource.find(D=>D.CostCenterID==parseInt(l.d.SessionManager.Preferences.DepositLinkDimension))),null==s)return void(e.oDocument=null);let o=e.oDocument.ScreenObject.GetScheduleDetails(e.oDocument.ScreenObject.RefNodeID,f,E),O=e.GetNarr(o,f,r,n.J0.Int(i.Tables[0][0].RefCCId));if(null!=(g=e.oDocument.ScreenObject._StaticFields.find(D=>"CommonNarration"==D.DBColumnName))&&g instanceof G.Dw&&0==r&&(g.Text=O),e.ClubInvoice){var V=e.oDocument.ScreenObject.GridData.filter(D=>D.ScheduleID==E);for(let D=0;D<V.length;D++)e.oDocument.ScreenObject.GridDataColumns.Contains("LineNarration")&&(V[D].LineNarration=O),V[D].SchGUID=L}if(null!=o&&o.Tables[0].length>0&&"1"==o.Tables[0][0].islastInv.toString()&&o.Tables.length>2&&o.Columns[2].Contains("CCID")&&o.Tables[2].length>0&&!n.J0.IsEmpty(o.Tables[2][0].CCID)){if(null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<o.Tables[2].length;D++)if((c=e.oDocument.ScreenObject.GridData.filter(d=>d[s.ValueMember]==n.J0.String(o.Tables[2][D].CCNodeID))).length>0){let d=n.J0.Double(o.Tables[2][D].Amount);if((S=o.Tables[1].filter(C=>C.PartID==o.Tables[2][D].CCNodeID.toString())).length>0&&!n.J0.IsEmpty(S[0].TotInv)&&(d-=n.J0.Double(S[0].TotInv)),d<=0&&(d=0),1==c.length)c[0].Rate=d,c[0].Gross=d,e.oDocument.CalculateTotals(c[0],!1),d=n.J0.Double(o.Tables[2][D].VatAmount),S.length>0&&""!=n.J0.String(S[0].TotVat)&&(d-=n.J0.Double(S[0].TotVat)),d>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(C=>!n.J0.IsEmpty(C.DisplayMember)&&"dcnum53"==C.DisplayMember.toLowerCase()))&&(c[0].dcNum53=d.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=d.ToString("N"+I.DecimalPoints),e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=d.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum61=d.ToString("N"+I.DecimalPoints)));else{let C=0,y=e.oDocument.ScreenObject.GridData.filter(b=>b[s.ValueMember]==o.Tables[2][D].CCNodeID).Compute("sum","Rate");var I;null!=y&&y.toString().length>0&&(C=d-n.J0.Double(y)),C>0&&!n.J0.IsEmpty(c[0].Rate)&&(c[0].Rate=n.J0.Double(c[0].Rate)+C,c[0].Gross=c[0].Rate,e.oDocument.CalculateTotals(c[0],!1)),d=n.J0.Double(o.Tables[2][D].VatAmount),S.length>0&&!n.J0.IsEmpty(S[0].TotVat)&&(d-=n.J0.Double(S[0].TotVat)),C=0,y=e.oDocument.ScreenObject.GridData.filter(b=>b[s.ValueMember]==o.Tables[2][D].CCNodeID).Compute("sum","dcNum53"),null!=y&&y.toString().length>0&&(C=d-n.J0.Double(y)),C>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(B=>!n.J0.IsEmpty(B.DisplayMember)&&"dcnum53"==B.DisplayMember.toLowerCase()))&&!n.J0.IsEmpty(c[0].dcNum53)&&(c[0].dcNum53=(n.J0.Double(c[0].dcNum53)+C).ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=c[0].dcNum53,e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=c[0].dcNum53,c[0].dcCalcdcNum61=c[0].dcNum53))}}}else if(null!=o&&o.Tables[0].length>0&&o.Tables.length>2&&o.Columns[2].Contains("CCID")&&o.Tables[2].length>0&&""!=o.Tables[2][0].CCID.toString()&&null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<o.Tables[2].length;D++){var c;if((c=e.oDocument.ScreenObject.GridData.filter(C=>C[s.ValueMember]==o.Tables[2][D].CCNodeID.toString())).length>0){let C=parseFloat(o.Tables[2][D].Amount.toString());var S;if((S=o.Tables[1].filter(b=>b.PartID==o.Tables[2][D].CCNodeID.toString())).length>0&&!n.J0.IsEmpty(S[0].TotInv)&&(C-=parseFloat(S[0].TotInv.toString())),C<=0)for(let b=0;b<c.length;b++)c[b].Rate=0,c[b].Gross=0,e.oDocument.CalculateTotals(c[b],!1)}}}if(""!=N){let s=e.oDocument.ScreenObject.Data.Tables[0].filter(o=>79==o.LocalReference&&52627==o.LinkData);if(s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let o=0;o<e.oDocument.ScreenObject.GridData.length;o++)n.J0.IsEmpty(e.oDocument.ScreenObject.GridData[o].ProductID_Key)||(e.oDocument.ScreenObject.GridData[o][s[0].SysColumnName.toString()]=N);else for(let o=0;o<i.Tables[0].length;o++)e.oDocument.ScreenObject.GridData[o][s[0].SysColumnName.toString()]=N;else(g=e.oDocument.ScreenObject._TextFields.find(O=>O.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))&&g instanceof G.Dw&&(g.Text=N);if(s=e.oDocument.ScreenObject.Data.Tables[0].filter(o=>79==o.LocalReference&&55262==o.LinkData),s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let o=0;o<e.oDocument.ScreenObject.GridData.length;o++)n.J0.IsEmpty(e.oDocument.ScreenObject.GridData[o].ProductID_Key)||(e.oDocument.ScreenObject.GridData[o][s[0].SysColumnName.toString()]="1");else for(let o=0;o<i.Tables[0].length;o++)e.oDocument.ScreenObject.GridData[o][s[0].SysColumnName.toString()]="1";else{var g;(g=e.oDocument.ScreenObject._TextFields.find(O=>O.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))instanceof G.Dw&&(g.Text="1")}}e.oDocument.SetNewDocButtonVisibility(),a&&m&&(e.oDocument.GenratePrefix=!0,e.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?e.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":e.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),e.oDocument.SaveCallBackMethod.Subscribe(e,"DocSaveCallBack"),e.oDocument.IsInventoryVoucher?e.oDocument.SaveInventoryDocument_1("ReSave"):e.oDocument.SaveAccountingDocument("ReSave"),e.oDocument.callbacksubject.subscribe(s=>{e.dtColumns.Contains("Remarks")&&(t.Remarks=e.oDocument.DisplayMessage,t.Postedvoucherno=e.oDocument.ScreenObject.VoucherNo),e.dtGrid.RefreshGridView()}))}})()}DocSaveCallBack(){this.ProgressValue++,this.ProgressValue==this.ProgressMax&&(this.ShowProcessDialog=!1)}GetStr(t,a){let m;switch(m=n.J0.Int(t),m++,m+=a,m){case 1:return"1st ";case 2:return"2nd ";case 3:return"3rd ";default:return m+"th "}}}}}]);