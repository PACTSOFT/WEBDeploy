"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2861],{22861:(M,S,d)=>{d.r(S),d.d(S,{ShiftAssignRotationViewModel:()=>W});var g=d(86739),y=d(8787),D=d(92701),u=d(24028),v=d(49710),r=d(18569),T=d(1444),p=d(60420),_=d(23823);class W extends _.g{constructor(){if(super(),this.FromDate=new u.Lc(0),this.ToDate=new u.Lc(0),this.dt=null,this.dtRotData=null,this.dt=g.d.common.GetDataTable("SAV001",""),this.Title="Shift Assign - Rotation Setup",null!=this.dt&&this.dt.length>0){this.CCList=[];let e=new D.BZ(0);e.DBColumnName=this.dt[0].FeatureID,e.FeatureID=parseInt(this.dt[0].FeatureID),e.Label=y.J0.String(this.dt[0].Name),this.CCList.push(e)}this.LoadWeekShiftGrid(),this.LoadGenerateGrid()}LoadGenerateGrid(){this.dgv=new v.vv,this.dgv.CanUserAddRows=!1,this.dgv.CanUserSortColumns=!1,this.dgv.CanUserDeleteRows=!0,this.dgv.Columns=[],this.dgv.Width="",this.dgv.Height=200;let e=new r.O7;e.Header="#",e.DisplayMember="sno",e.ID="sno",e.Width=50,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),e=new r.O7,e.Header=null!=this.dt&&this.dt.length>0?y.J0.String(this.dt[0].Name):"Employee",e.DisplayMember="Employee",e.ID="Employee",e.Width=220,e.ReadOnly=!0,e.TextAlign="Left",this.dgv.Columns.push(e),e=new r.O7,e.Header="From",e.DisplayMember="From",e.ID="From",e.Width=100,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),e=new r.O7,e.Header="To",e.DisplayMember="To",e.ID="To",e.Width=100,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),e=new r.O7,e.Header="Shift",e.DisplayMember="Shift",e.ID="Shift",e.Width=170,e.ReadOnly=!0,e.TextAlign="Left",this.dgv.Columns.push(e),this.dgv.Table=[],this.dgv.TableColumns.push("sno"),this.dgv.TableColumns.push("Employee"),this.dgv.TableColumns.push("Employee_Key"),this.dgv.TableColumns.push("From"),this.dgv.TableColumns.push("To"),this.dgv.TableColumns.push("Shift"),this.dgv.TableColumns.push("Shift_Key")}LoadWeekShiftGrid(){this.dgvWeekShifts=new v.vv,this.dgvWeekShifts.CanUserAddRows=!1,this.dgvWeekShifts.CanUserSortColumns=!1,this.dgvWeekShifts.CanUserDeleteRows=!1,this.dgvWeekShifts.Columns=[],this.dgvWeekShifts.Width="310";let e=new r.O7;e.Header="Week Day",e.DisplayMember="WeekDay",e.ID="WeekDay",e.Width=100,e.ReadOnly=!0,e.TextAlign="Left",this.dgvWeekShifts.Columns.push(e),e=new r.O7,e.Header="Shift",e.DisplayMember="Shift",e.DataType="LISTBOX",e.CostCenterID=50073,e.FilterCondition="IsGroup=0",e.TypeID=1,e.Width=200,this.dgvWeekShifts.Columns.push(e),this.dgvWeekShifts.Table=[],this.dgvWeekShifts.TableColumns.push("WeekDay"),this.dgvWeekShifts.TableColumns.push("Shift"),this.dgvWeekShifts.TableColumns.push("Shift_Key"),this.ResetWeekShiftGridRows()}ResetWeekShiftGridRows(){let e;this.dgvWeekShifts.Table.Clear(),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Monday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Tuesday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Wednesday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Thursday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Friday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Saturday",this.dgvWeekShifts.addRow(e),e=this.dgvWeekShifts.NewRow(),e.WeekDay="Sunday",this.dgvWeekShifts.addRow(e)}OnChkLstClear(e){this.CCList[0].Items.Clear()}OnPickerClick(e){const a=new T.$;a.SearchPickerViewModel_3(this,"COSTCENTER",e),g.d.page.ShowDialog(a,p.u,{ShowCenter:!0})}ParentCallBack(e){if("COSTCENTER"==e.PickerType){let a=this.CCList[0];e.SelectedNodes.forEach(i=>{i.IsGroup||0==a.Items.filter(s=>s.Value==i.Id.toString()).length&&(a.Items.push(D.oN.CheckedListBoxItem_5(i.Text[1],i.Id.toString(),!0)),a.Items[a.Items.length-1].Parent=i.Text[0])})}}OnButtonClick(e){"Cancel"==e?g.d.page.HideDialog(this.PopUpGUID):"Generate"==e?this.Generate_Click():"Load"==e&&this.Load_Click()}Load_Click(){if(!(this.dgv.Table.length>0))return this.DisplayMessage="Generate atleast for one Employee",void(this.MessageVisibility=!0);this.dtRotData=this.dgv.Table.Copy(),this.DialogResult=!0,g.d.page.HideDialog(this.PopUpGUID)}Generate_Click(){let e=!1,a=!1;for(let h=0;h<this.CCList[0].Items.length;h++)if(this.CCList[0].Items[h].IsChecked){e=!0;break}if(0==this.CCList[0].Items.length||!e)return this.DisplayMessage="Select atleast one Employee",void(this.MessageVisibility=!0);for(let h=0;h<this.dgvWeekShifts.Table.length;h++)if(!y.J0.IsEmpty(this.dgvWeekShifts.Table[h].Shift_Key)){a=!0;break}if(!a)return this.DisplayMessage="Assign atleast one Shift for Week day",void(this.MessageVisibility=!0);this.dgv.refreshDatawithIDs();let i,t,s=this.FromDate.Date,o=s,l=-1,n="",f=null,C=g.d.common.GetDataTable("SAV002","");for(let h=0;h<this.CCList[0].Items.length;h++)if(this.CCList[0].Items[h].IsChecked)for(s=this.FromDate.Date,o=s,l=-1,n="";s<=this.ToDate.Date;)if(50051==parseInt(this.dt[0].FeatureID)&&null!=C&&C.length>0&&(f=null,f=C.filter(m=>m.NodeID==this.CCList[0].Items[h].Value),null!=f&&f.length>0&&s<new Date(f[0].DateOfJoining)))s=s.AddDays(1);else{if(i=this.dgvWeekShifts.Table.filter(m=>m.WeekDay==s.getDayName().toString()),null!=i&&i.length>0){if(-1!=l){if(null!=i[0].Shift_Key&&null!=i[0].Shift_Key&&""!=i[0].Shift_Key.toString()&&l==parseInt(i[0].Shift_Key)){s.ToString("dd MMM yyyy")==this.ToDate.Date.ToString("dd MMM yyyy")&&(t=this.dgv.NewRow(),t.sno=this.dgv.Table.length+1,t.Employee=this.CCList[0].Items[h].Name,t.Employee_Key=this.CCList[0].Items[h].Value,t.From=o.ToString("dd/MMM/yyyy"),t.To=s.ToString("dd/MMM/yyyy"),t.Shift=n,t.Shift_Key=l,this.dgv.addRow(t)),s=s.AddDays(1);continue}t=this.dgv.NewRow(),t.sno=this.dgv.Table.length+1,t.Employee=this.CCList[0].Items[h].Name,t.Employee_Key=this.CCList[0].Items[h].Value,t.From=o.ToString("dd/MMM/yyyy"),t.To=s.AddDays(-1).ToString("dd/MMM/yyyy"),t.Shift=n,t.Shift_Key=l,this.dgv.addRow(t),s.ToString("dd MMM yyyy")==this.ToDate.Date.ToString("dd MMM yyyy")&&(y.J0.IsEmpty(i[0].Shift_Key)?(o=s.AddDays(1),l=-1,n=""):(o=s,l=parseInt(i[0].Shift_Key),n=i[0].Shift.toString()),t=this.dgv.NewRow(),t.sno=this.dgv.Table.length+1,t.Employee=this.CCList[0].Items[h].Name,t.Employee_Key=this.CCList[0].Items[h].Value,t.From=o.ToString("dd/MMM/yyyy"),t.To=s.ToString("dd/MMM/yyyy"),t.Shift=n,t.Shift_Key=l,this.dgv.addRow(t))}y.J0.IsEmpty(i[0].Shift_Key)?(o=s.AddDays(1),l=-1,n=""):(o=s,l=parseInt(i[0].Shift_Key),n=i[0].Shift.toString())}s=s.AddDays(1)}this.dgv.refreshDataView()}}}}]);