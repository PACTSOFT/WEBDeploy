"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2909],{62909:(U,F,C)=>{C.r(F),C.d(F,{UpdatePayTermsViewModel:()=>O});var d=C(86739),e=C(8787),G=C(32647),V=C(23823),R=C(98669),y=C(92701),I=C(24028),M=C(31820),A=C(49710),J=C(68719),f=C(18569),N=C(78906),_=C(95050),v=C(81669);class O extends V.g{get MxHeight(){return(window.innerHeight-150).toString()}get SelectAll(){return this._SelectAll}set SelectAll(s){s!=this._SelectAll&&(this._SelectAll=s,this.SelectAllRows())}get angularGrid(){return this.PstDocGrid.angularGrid}get PstDocGridTable(){return this.PstDocGrid.Table}get PstDocGridTableColumns(){return this.PstDocGrid.TableColumns}get angularGrid1(){return this.PartGrid.angularGrid}get PartGridTable(){return this.PartGrid.Table}get PartGridTableableColumns(){return this.PartGrid.TableColumns}UpdatePayTermsViewModel_1(s,n,t,a=0){this.DisplayName=2==a?"Contract History":1==a?"Copy":3==a?"Renew Sub Contracts":4==a?"Terminate Sub Contracts":5==a?"Refund Sub Contracts":6==a?"Close Sub Contracts":7==a?"Unit wise rate":50==a?"Penalty":null!=n?"Distribute":"Generate Contract",this.Calltype=a,this.oparent=s,this.selectedrow=n,this.Rows=t,this.CopyRows.Visible=!1,50==a?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.CopyRows.Visible=!1,this.IsGenerateVisible=!1):2==a||3==a||4==a||5==a||6==a?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1,2==a&&(this.IsSaveVisible=!1)):1==a?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PartGrid.Visible=!1,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!0,this.CopyRows.DataType="INT"):null==this.selectedrow?(this.Filter.Visible=!0,this.Filter.Label="Contract for Year",this.Filter.Items.push(y._p.ComboBoxItems_2("ALL","ALL")),this.Rows.forEach(i=>{this.Filter.Items.push(i)}),this.Filter.Width="320",this.Filter.Items.length>0&&(this.Filter.SelectedValue=this.Filter.Items[0].Value,this.Filter.SelectedItem=this.Filter.Items[0])):this.oparent.multiVisi&&7!=this.Calltype?(this.Filter.Visible=!0,this.Filter.Width="120",this.Filter.Label="Show",this.Filter.Items.push(y._p.ComboBoxItems_2("Both","0")),this.Filter.Items.push(y._p.ComboBoxItems_2("Show only unit","1")),this.Filter.Items.push(y._p.ComboBoxItems_2("Show only Dates","2")),this.Filter.SelectionChangedCommand.Subscribe(this,"ButtonSave"),this.Filter.SelectedValue="0"):this.Filter.Visible=!1,1!=a&&2!=a&&3!=a&&4!=a&&5!=a&&6!=a&&50!=a&&this.AddDateColumns(),this.IsCancelVisible=!0,this.PstDocGridTable.length>0&&(this.PstDocGrid.Height=252,this.PstDocGrid.Width="800"),this.PartGridTable.length>0&&(this.PartGrid.Height=252),this.PstDocGrid.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}UpdatePayTermsViewModel_2(s){this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1,this.IsCancelVisible=!0,this.PstDocGrid.SearchVisible=!0,this.PstDocGrid.AddSearchCols(),this.Calltype=2,this.PstDocGrid.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}constructor(s){if(super(),this.SavePostedDocument=new v.Yk,this.DailogResult=!0,this._SelectAll=!1,this.Filter=new y.y$,this.CopyRows=new M.Dw,this.IsCancelVisible=!1,this.IsSaveVisible=!0,this.Rows=[],this.Calltype=0,this.DocCCID=0,this.CCID=0,this.CompletionDateColName="",this.Columns="",this.Joins="","AddEditRenContractViewModel"==s)return this.IsCancelVisible=!1,void(this.Filter.Visible=!1);this.IsCancelVisible=!1,this.Filter.Visible=!1,this.DisplayName=s,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.onLoad(),this.FillSearchDetails()}OnKeyDown(s,n){!n.ctrlKey&&116==n.which&&(n.preventDefault(),this.onCopy(this.PstDocGrid.getArgsObj(s)))}onCopy(s){let n=s.column.className;"DataGridPactListBoxColumn"!=n&&s.grid.getEditorLock().commitCurrentEdit();let t="";t=s.column.field;let a=confirm(d.d.GetResource("overrideallNotocopyblank"));if(!a)return;let i=this.PstDocGrid.Table,l=s.item;for(let o=0;o<i.length;o++){"DataGridPactListBoxColumn"==n&&s.grid.getEditorLock().commitCurrentEdit();let u=!1;for(let r=0;r<this.PstDocGrid.Columns.length;r++)if(this.PstDocGrid.Columns[r].IsVisible&&"sno"!=this.PstDocGrid.Columns[r].DisplayMember.toLowerCase()&&(("INT"==this.PstDocGrid.Columns[r].DataType||"FLOAT"==this.PstDocGrid.Columns[r].DataType)&&""!=e.J0.String(i[o][this.PstDocGrid.Columns[r].DisplayMember])&&0!=parseFloat(i[o][this.PstDocGrid.Columns[r].DisplayMember].toString())||"LISTBOX"==this.PstDocGrid.Columns[r].DataType&&""!=e.J0.String(i[o][this.PstDocGrid.Columns[r].ValueMember])&&parseInt(i[o][this.PstDocGrid.Columns[r].ValueMember].toString())>0||("SELECTIONBOX"==this.PstDocGrid.Columns[r].DataType||"String"==this.PstDocGrid.Columns[r].DataType||"TextBlock"==this.PstDocGrid.Columns[r].DataType||"TEXT"==this.PstDocGrid.Columns[r].DataType)&&""!=e.J0.String(i[o][this.PstDocGrid.Columns[r].DisplayMember])||("DATE"==this.PstDocGrid.Columns[r].DataType||"DATESORT"==this.PstDocGrid.Columns[r].DataType||"DATETIME"==this.PstDocGrid.Columns[r].DataType)&&""!=e.J0.String(i[o][this.PstDocGrid.Columns[r].DisplayMember+"_Key"]))){u=!0;break}if(u){if(!(a||""==e.J0.String(i[o][t])||this.PstDocGrid.TableColumns[t].DataType&&""!=e.J0.String(i[o][t])&&0==parseFloat(i[o][t].toString())))continue;if(i[o][t]=l[t].toString(),"DataGridDateTimeColumn"!=n&&"DataGridDateColumn"!=n||!this.PstDocGrid.TableColumns.Contains(t+"_Key")||""==e.J0.String(l[t+"_Key"])){if("DataGridPactListBoxColumn"==n){var h=this.PstDocGrid.Columns.find(r=>r.DisplayMember==t);null!=h&&""!=e.J0.String(l[h.ValueMember])&&(i[o][h.ValueMember]=l[h.ValueMember].toString())}}else i[o][t+"_Key"]=l[t+"_Key"].toString();if("quantity"==t.toLowerCase()){let r=1;""!=e.J0.String(i[o].UOMConversion)&&i[o].UOMConversion.toString()&&(r=parseFloat(i[o].UOMConversion.toString())),""!=e.J0.String(i[o].Quantity)&&(i[o].UOMConvertedQty=r*parseFloat(i[o].Quantity.toString()))}this.PstDocGrid.updateRow(i[o])}}}onLoad(){this.InitColumns(),this.SavePostedDocument.Subscribe(this,"ButtonSave")}AddDateColumns(){let t,i,s=!1;if(this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.CompletionDate.Label="Start date",this.CompletionDate.Enable=!1,this.oparent.StartDate.Date&&(this.CompletionDate.Date=this.oparent.StartDate.Date),this.EndDate=new I.C_(0),this.oparent.EndDate.Date&&(this.EndDate.Date=this.oparent.EndDate.Date),this.EndDate.Label="End Date",this.EndDate.Enable=!1,this.Tower.Visible=!1,7==this.Calltype&&(this.CompletionDate.Visible=this.EndDate.Visible=!1),this.PartGrid=new A.vv,this.PartGrid.Visible=!0,this.PstDocGrid=new A.vv,this.PstDocGrid.CanUserSortColumns=!1,this.PstDocGrid.CanUserDeleteRows=!0,this.PstDocGrid.RowHeight=25,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGrid.CanUserAddRows=!0,this.PstDocGrid.BeginEdit.Subscribe(this,"OnBeginEdit"),this.PstDocGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.PstDocGrid.OnRowSelection.Subscribe(this,"OnRowSelection"),this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("FromDate"),this.PstDocGridTableColumns.push("FromDate_Key"),this.PstDocGrid.DataTypes.Date.push("FromDate_Key"),this.PstDocGridTableColumns.push("ToDate"),this.PstDocGridTableColumns.push("ToDate_Key"),this.PstDocGrid.DataTypes.Date.push("ToDate_Key"),this.PstDocGridTableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),this.PstDocGridTableColumns.push("Unit"),this.PstDocGridTableColumns.push("Unit_key"),this.PstDocGrid.DataTypes.Int.push("Unit_key"),this.PstDocGridTableColumns.push("Period"),this.PstDocGridTableColumns.push("Rate"),this.PstDocGrid.DataTypes.Double.push("Rate"),this.PstDocGridTableColumns.push("Discount"),this.PstDocGrid.DataTypes.Double.push("Discount"),this.PstDocGridTableColumns.push("ActAmount"),this.PstDocGrid.DataTypes.Double.push("ActAmount"),this.PstDocGridTableColumns.push("Narration"),this.PstDocGridTableColumns.push("Percent"),this.PstDocGrid.DataTypes.Double.push("Percent"),7==this.Calltype)104==this.oparent.CostCenterID?(this.PstDocGridTableColumns.push("VatType"),this.PstDocGrid.DataTypes.Int.push("VatType"),this.PstDocGridTableColumns.push("VatPer"),this.PstDocGrid.DataTypes.Double.push("VatPer"),this.PstDocGridTableColumns.push("VatAmount"),this.PstDocGrid.DataTypes.Double.push("VatAmount"),this.PstDocGridTableColumns.push("Net"),this.PstDocGrid.DataTypes.Double.push("Net")):(this.PstDocGridTableColumns.push("PrevRent"),this.PstDocGrid.DataTypes.Double.push("PrevRent"),this.PstDocGridTableColumns.push("BaseRent"),this.PstDocGrid.DataTypes.Double.push("BaseRent"));else{this.oparent.DistribtueInvoice&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("Distribute"),this.PstDocGrid.DataTypes.Int.push("Distribute")),this.oparent.ShowMonthAmountInDistribute&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("MonthAmount"),this.PstDocGrid.DataTypes.Double.push("MonthAmount"));var n=this.oparent.ScreenObject.Data.Tables[5].filter(h=>"DistProposedrent"==h.Name);n.length>0&&(0,G.yG0)(n[0].Value)&&(this.oparent.multiVisi&&(this.PstDocGridTableColumns.push("PrevRent"),this.PstDocGrid.DataTypes.Double.push("PrevRent"),this.PstDocGridTableColumns.push("BaseRent"),this.PstDocGrid.DataTypes.Double.push("BaseRent")),this.PstDocGridTableColumns.push("ProposedRent"),this.PstDocGrid.DataTypes.Double.push("ProposedRent"),this.PstDocGridTableColumns.push("ProposedDisc"),this.PstDocGrid.DataTypes.Double.push("ProposedDisc"),this.PstDocGridTableColumns.push("ProposedAmount"),this.PstDocGrid.DataTypes.Double.push("ProposedAmount"))}if(null!=this.selectedrow?(t=new f.O7,t.Header=d.d.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t)):(this.CompletionDate.Visible=!1,this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PstDocGrid.Visible=!1,this.IsGenerateVisible=!0),7!=this.Calltype&&(t=new f.O7,t.Header="From Date",t.DisplayMember="FromDate",t.Width=140,t.DataType="DATE",this.PstDocGrid.Columns.push(t),t=new f.O7,t.Header="To Date",t.DisplayMember="ToDate",t.Width=140,t.DataType="DATE",this.PstDocGrid.Columns.push(t)),null!=this.selectedrow){t=new f.O7,t.Header="Unit",t.DisplayMember="Unit",t.ValueMember="Unit_key",t.Width=120,t.DataType="LISTBOX",7==this.Calltype&&104==this.oparent.CostCenterID?(t.CostCenterID=93,t.TypeID=2):(t.CostCenterID=this.oparent.Unit.CCID,t.TypeID=this.oparent.Unit.TypeID),this.oparent.multiVisi||7==this.Calltype?(t.IsVisible=!0,t.FilterCondition=7==this.Calltype&&104==this.oparent.CostCenterID?" a.PropertyID in("+this.oparent.Property.SelectedValue+")":" a.unitid in("+this.oparent.SelectedUnits+")"):t.IsVisible=!1,this.PstDocGrid.Columns.push(t);let h=this.oparent.ContractParticular.find(o=>"Discount"==o.DisplayMember);if(7==this.Calltype&&104==this.oparent.CostCenterID){t=new f.O7,t.Header="Vat",t.ValueBinding="VatType",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let o=[];o.push(y._p.ComboBoxItems_2("Yes","1")),o.push(y._p.ComboBoxItems_2("No","0")),t.ComboData=o,this.PstDocGrid.Columns.push(t)}else{if(this.PstDocGridTableColumns.Contains("MonthAmount")&&(t=new f.O7,t.Header="Month Wise",t.DisplayMember="MonthAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),this.PstDocGridTableColumns.Contains("BaseRent")){let o=this.oparent.ScreenObject.Data.Tables[0].filter(u=>null!=u.LocalReference&&79==u.LocalReference&&-11==u.LinkData);o.length>0&&(t=new f.O7,t.Header=o[0].ResourceData.toString(),t.DisplayMember="PrevRent",t.Width=100,t.DataType="FLOAT",e.J0.IsEmpty(o[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(o[0].IsEditable)),t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),o=this.oparent.ScreenObject.Data.Tables[0].filter(u=>null!=u.LocalReference&&93==u.LocalReference&&25641==u.LinkData),o.length>0&&(t=new f.O7,t.Header=o[0].ResourceData.toString(),t.DisplayMember="BaseRent",t.Width=100,t.DataType="FLOAT",e.J0.IsEmpty(o[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(o[0].IsEditable)),t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t))}if(this.PstDocGridTableColumns.Contains("ProposedRent")&&(t=new f.O7,t.Header="Proposed Rent",(a=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedRent"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString()),t.DisplayMember="ProposedRent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new f.O7,t.Header="Discount",(a=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedDisc"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString()),t.DisplayMember="ProposedDisc",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new f.O7,t.Header="After discount",(a=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedAfterDisc"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString()),t.DisplayMember="ProposedAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),null!=h&&h.IsVisible){if(t=new f.O7,7==this.Calltype)t.Header="Proposed Rent",(a=this.oparent.ScreenObject.Data.Tables[0].filter(u=>"ProposedRent"==u.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString());else if(0==this.Calltype&&95==this.oparent.CostCenterID&&null!=this.selectedrow){if(t.Header="Amount",null!=this.oparent.ScreenObject.Data&&this.oparent.ScreenObject.Data.Tables.length>0&&this.oparent.ScreenObject.Data.Tables[this.oparent.ScreenObject.Data.Tables.length-2].length>0){let o=this.oparent.ScreenObject.Data.Tables[this.oparent.ScreenObject.Data.Tables.length-2],u=0;this.oparent.cntrct.ContractID>0&&(u="426"==this.oparent.StatusID.SelectedValue||"427"==this.oparent.StatusID.SelectedValue?2:1),o=o.filter(1==u?r=>2==r.Mode||3==r.Mode:2==u?r=>2==r.Mode||3==r.Mode||4==r.Mode:r=>1==r.Mode||3==r.Mode),o=o.filter(r=>-5==r.CostCenterColID),o.length>0&&(t.ReadOnly=!(0,G.yG0)(o[0].IsEditable),s=!(0,G.yG0)(o[0].IsEditable))}}else t.Header="Amount";t.DisplayMember="ActAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new f.O7,7==this.Calltype?(t.Header="Discount",(a=this.oparent.ScreenObject.Data.Tables[0].filter(u=>"ProposedDisc"==u.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString())):0==this.Calltype&&95==this.oparent.CostCenterID&&null!=this.selectedrow?(t.Header="Discount",t.ReadOnly=s):t.Header="Discount",t.DisplayMember="Discount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)}}var a;if(t=new f.O7,7==this.Calltype?(t.Header="After discount",(a=this.oparent.ScreenObject.Data.Tables[0].filter(u=>"ProposedAfterDisc"==u.SysColumnName)).length>0&&(e.J0.IsEmpty(a[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(a[0].IsEditable)),t.Header=a[0].ResourceData.toString())):null!=h&&h.IsVisible?(t.Header="After discount",0==this.Calltype&&95==this.oparent.CostCenterID&&null!=this.selectedrow&&(t.ReadOnly=s)):t.Header="Amount",t.DisplayMember="Amount",t.Width=120,t.ShowTotal=!0,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),this.PstDocGrid.ShowTotals=!0,7!=this.Calltype){t=new f.O7,t.Header="%",t.DisplayMember="Percent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("Distribute")&&(t=new f.O7,t.Header="Distribute",t.DisplayMember="Distribute",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t)),t=new f.O7,t.Header="Rate",t.DisplayMember="Rate",t.Width=80,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString();let o=this.oparent.ScreenObject.Data.Tables[5].filter(u=>"ShowRateInDistribute"==u.Name);t.IsVisible=!!(o.length>0&&(0,G.yG0)(o[0].Value)),this.PstDocGrid.Columns.push(t)}}if(7==this.Calltype&&104==this.oparent.CostCenterID)t=new f.O7,t.Header="Vat Percent",t.DisplayMember="VatPer",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),t=new f.O7,t.Header="Vat Amount",t.DisplayMember="VatAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new f.O7,t.Header="Net",t.DisplayMember="Net",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t);else if(7!=this.Calltype){t=new f.O7,t.Header="Period",t.ValueBinding="Period",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let h=N.a.GetLookupData(31);if(null!=h){let o=[];for(let u=0;u<h.length;u++)o.push(y._p.ComboBoxItems_2(h[u].Name.toString(),h[u].NodeID.toString()));t.ComboData=o}this.PstDocGrid.Columns.push(t)}if(this.oparent.multiVisi){let h=this.oparent.ScreenObject.Data.Tables[0].filter(o=>null!=o.LocalReference&&93==o.LocalReference&&25641!=o.LinkData);if(h.length>0){h.SortBy(["SectionID","SectionSeqNumber"]);for(let o=1;o<=h.length&&!(o>10);o++)t=new f.O7,t.Header=h[o-1].ResourceData.toString(),t.DisplayMember="Fld"+o.toString(),t.ID=h[o-1].LinkData.toString(),t.Width=100,e.J0.IsEmpty(h[o-1].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[o-1].IsEditable)),this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.push(t.DisplayMember)}}if(t=new f.O7,t.Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",t.Width=150,this.PstDocGrid.Columns.push(t),null==this.selectedrow)this.Rows.forEach(h=>{let o=this.PstDocGrid.NewRow();!e.J0.IsEmpty(h.Value)&&e.J0.isValidDate(h.Value)&&(i=e.J0.isValidDate(h.Value),o.FromDate=e.J0.ParseDate(h.Value).ToString(d.d.SessionManager.Preferences["Date Format"]),o.FromDate_Key=e.J0.ParseDate(h.Value)),!e.J0.IsEmpty(h.Parent)&&e.J0.isValidDate(h.Parent)&&(i=e.J0.isValidDate(h.Parent),o.ToDate=e.J0.ParseDate(h.Parent).ToString(d.d.SessionManager.Preferences["Date Format"]),o.ToDate_Key=e.J0.ParseDate(h.Parent)),h.CurrID>0&&(o.Period=h.CurrID),this.PstDocGrid.addRow(o)});else if(7!=this.Calltype&&""!=e.J0.String(this.selectedrow.Xml)||7==this.Calltype&&""!=e.J0.String(this.selectedrow.UnitXml)){let h=new e.VB;if(h.LoadXml(7==this.Calltype?this.selectedrow.UnitXml.toString():this.selectedrow.Xml.toString()),null!=h){h.DocumentElement.children.length>0&&null!=h.DocumentElement.attributes&&null!=h.DocumentElement.attributes.Filter&&!e.J0.IsEmpty(h.DocumentElement.attributes.Filter.value)&&(this.Filter.SelectedValue=h.DocumentElement.attributes.Filter.value,this.ButtonSave("Selectionchanged")),this.PstDocGrid.Clear();let o=h.SelectNodes("XML/Row");"0"==this.Filter.SelectedValue&&(o=h.SelectNodes("XML/UnitsRow/Row")),7==this.Calltype&&(o=h.SelectNodes("UnitsXML/Row"));for(let u=0;u<o.length;u++){let r=o[u],p=this.PstDocGrid.NewRow();if(null!=r.attributes.FromDate&&!e.J0.IsEmpty(r.attributes.FromDate.value)&&e.J0.isValidDate(r.attributes.FromDate.value)&&(i=e.J0.isValidDate(r.attributes.FromDate.value),p.FromDate=e.J0.ParseDate(r.attributes.FromDate.value).ToString(d.d.SessionManager.Preferences["Date Format"]),p.FromDate_Key=e.J0.ParseDate(r.attributes.FromDate.value)),null!=r.attributes.ToDate&&!e.J0.IsEmpty(r.attributes.ToDate.value)&&e.J0.isValidDate(r.attributes.ToDate.value)&&(i=e.J0.isValidDate(r.attributes.ToDate.value),p.ToDate=e.J0.ParseDate(r.attributes.ToDate.value).ToString(d.d.SessionManager.Preferences["Date Format"]),p.ToDate_Key=e.J0.ParseDate(r.attributes.ToDate.value)),null!=r.attributes.Unit&&!e.J0.IsEmpty(r.attributes.Unit.value)&&(p.Unit_key=parseInt(r.attributes.Unit.value)),null!=r.attributes.Period&&!e.J0.IsEmpty(r.attributes.Period.value)&&(p.Period=parseInt(r.attributes.Period.value)),null!=r.attributes.Amount&&!e.J0.IsEmpty(r.attributes.Amount.value)&&(p.Amount=parseFloat(r.attributes.Amount.value)),null!=r.attributes.MonthAmount&&!e.J0.IsEmpty(r.attributes.MonthAmount.value)&&(p.MonthAmount=parseFloat(r.attributes.MonthAmount.value)),null!=r.attributes.Rate&&!e.J0.IsEmpty(r.attributes.Rate.value)&&(p.Rate=parseFloat(r.attributes.Rate.value)),this.PstDocGridTableColumns.Contains("Distribute")&&null!=r.attributes.Distribute&&!e.J0.IsEmpty(r.attributes.Distribute.value)&&(p.Distribute=parseFloat(r.attributes.Distribute.value)),this.PstDocGridTableColumns.Contains("ActAmount")&&null!=r.attributes.ActAmount&&!e.J0.IsEmpty(r.attributes.ActAmount.value)&&(p.ActAmount=parseFloat(r.attributes.ActAmount.value)),this.PstDocGridTableColumns.Contains("Percent")&&null!=r.attributes.Percent&&!e.J0.IsEmpty(r.attributes.Percent.value)&&(p.Percent=parseFloat(r.attributes.Percent.value)),this.PstDocGridTableColumns.Contains("Discount")&&null!=r.attributes.Discount&&!e.J0.IsEmpty(r.attributes.Discount.value)&&(p.Discount=parseFloat(r.attributes.Discount.value)),null!=r.attributes.Narration&&!e.J0.IsEmpty(r.attributes.Narration.value)&&(p.Narration=r.attributes.Narration.value),this.PstDocGridTableColumns.Contains("VatType")&&null!=r.attributes.VatType&&!e.J0.IsEmpty(r.attributes.VatType.value)&&(p.VatType=r.attributes.VatType.value),this.PstDocGridTableColumns.Contains("VatPer")&&null!=r.attributes.VatPer&&!e.J0.IsEmpty(r.attributes.VatPer.value)&&(p.VatPer=parseFloat(r.attributes.VatPer.value)),this.PstDocGridTableColumns.Contains("VatAmount")&&null!=r.attributes.VatAmount&&!e.J0.IsEmpty(r.attributes.VatAmount.value)&&(p.VatAmount=parseFloat(r.attributes.VatAmount.value)),this.PstDocGridTableColumns.Contains("Net")&&null!=r.attributes.Net&&!e.J0.IsEmpty(r.attributes.Net.value)&&(p.Net=parseFloat(r.attributes.Net.value)),this.PstDocGridTableColumns.Contains("ProposedRent")&&null!=r.attributes.ProposedRent&&!e.J0.IsEmpty(r.attributes.ProposedRent.value)&&(p.ProposedRent=parseFloat(r.attributes.ProposedRent.value)),this.PstDocGridTableColumns.Contains("ProposedDisc")&&null!=r.attributes.ProposedDisc&&!e.J0.IsEmpty(r.attributes.ProposedDisc.value)&&(p.ProposedDisc=parseFloat(r.attributes.ProposedDisc.value)),this.PstDocGridTableColumns.Contains("ProposedAmount")&&null!=r.attributes.ProposedAmount&&!e.J0.IsEmpty(r.attributes.ProposedAmount.value)&&(p.ProposedAmount=parseFloat(r.attributes.ProposedAmount.value)),7==this.Calltype&&95==this.oparent.CostCenterID&&!e.J0.IsEmpty(p.Unit_key)){let D=null;this.oparent.StartDate.Date&&null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>7&&(D=this.oparent.dsPart.Tables[7].filter(m=>m.UNITID==p.Unit_key.toString()&&m.WEF<=this.oparent.StartDate.Date)),null!=D&&D.length>0?(D.SortBy(["WEF"]),e.J0.IsEmpty(D[0].RENT)||(p.BaseRent=D[0].RENT.toString())):null!=r.attributes.BaseRent&&!e.J0.IsEmpty(r.attributes.BaseRent.value)&&(p.BaseRent=parseFloat(r.attributes.BaseRent.value))}this.PstDocGridTableColumns.Contains("PrevRent")&&null!=r.attributes.PrevRent&&!e.J0.IsEmpty(r.attributes.PrevRent.value)&&(p.PrevRent=parseFloat(r.attributes.PrevRent.value));for(let D=0;D<this.PstDocGrid.Columns.length;D++)this.PstDocGrid.Columns[D].DisplayMember.Contains("Fld")&&null!=r.attributes[this.PstDocGrid.Columns[D].DisplayMember]&&!e.J0.IsEmpty(r.attributes[this.PstDocGrid.Columns[D].DisplayMember].value)&&(p[this.PstDocGrid.Columns[D].DisplayMember]=r.attributes[this.PstDocGrid.Columns[D].DisplayMember].value);p.Sno=this.PstDocGridTable.length+1,this.PstDocGrid.addRow(p)}}(7==this.Calltype||!(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0)&&this.PstDocGrid.Columns[3].IsVisible)&&(this.PstDocGrid.RefreshGrid=!0)}else if(104==this.oparent.CostCenterID&&7==this.Calltype){let h=d.d.rental.GetUnitsByProp(this.oparent.Property.SelectedValue);if(null!=h&&h.Tables.length>0&&h.Columns[0].Contains("UnitID")&&h.Tables[0].length>0)for(let o=0;o<h.Tables[0].length;o++){let u=this.PstDocGrid.NewRow();if(u.FromDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),u.FromDate_Key=this.oparent.StartDate.Date,u.ToDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),u.ToDate_Key=this.oparent.StartDate.Date,u.Unit=h.Tables[0][o].Name.toString(),u.Unit_key=h.Tables[0][o].UnitID.toString(),u.VatType=e.J0.IsEmpty(h.Tables[0][o].CCNID70)||"3"!=h.Tables[0][o].CCNID70.toString()?"0":"1",!e.J0.IsEmpty(h.Tables[0][o].Rent)){let r=parseFloat(h.Tables[0][o].Rent.toString());if(u.Amount=r.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),"1"==u.VatType.toString()){u.VatPer=this.oparent.VatonRent.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString());let p=r*this.oparent.VatonRent/100;u.VatAmount=p.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),u.Net=(r+p).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())}else u.Net=r.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())}u.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(u)}}else if(7==this.Calltype){if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){let h=null;e.J0.IsEmpty(this.oparent.Unit.LocalRefXML)||(h=d.d.rental.GetUnitsData(this.oparent.SelectedUnits,this.oparent.Unit.LocalRefXML));for(let o=0;o<this.oparent.dsPart.Tables[5].length;o++){let u=this.PstDocGrid.NewRow();u.Unit_key=this.oparent.dsPart.Tables[5][o].UnitID.toString();let r=null;this.oparent.StartDate.Date&&this.oparent.dsPart.Tables.length>7&&(r=this.oparent.dsPart.Tables[7].filter(p=>p.UNITID==this.oparent.dsPart.Tables[5][o].UnitID.toString()&&p.WEF<=this.oparent.StartDate.Date)),null!=r&&r.length>0?(r.SortBy(["WEF"]),e.J0.IsEmpty(r[0].RENT)||(u.BaseRent=u.Amount=r[0].RENT.toString()),e.J0.IsEmpty(r[0].DICOUNT)||(u.Discount=r[0].DICOUNT.toString()),e.J0.IsEmpty(r[0].RENTAMT)||(u.ActAmount=r[0].RENTAMT.toString())):(e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].RENT)||(u.BaseRent=u.Amount=this.oparent.dsPart.Tables[5][o].RENT.toString()),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].Dicount)||(u.Discount=this.oparent.dsPart.Tables[5][o].Dicount.toString()),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].RENTAMT)||(u.ActAmount=this.oparent.dsPart.Tables[5][o].RENTAMT.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].PrevVal)||(u.PrevRent=parseFloat(this.oparent.dsPart.Tables[5][o].PrevVal.toString())),this.FillREfDet(h,u),u.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(u)}this.PstDocGrid.RefreshGrid=!0}}else if(this.oparent.EndDate.Date&&this.oparent.StartDate.Date&&!e.J0.IsEmpty(this.selectedrow.Amount))if(""!=this.oparent.SelectedUnits){let h=null;if(e.J0.IsEmpty(this.oparent.Unit.LocalRefXML)||(h=d.d.rental.GetUnitsData(this.oparent.SelectedUnits,this.oparent.Unit.LocalRefXML)),!e.J0.IsEmpty(this.oparent.dsPart)&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){let o=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),u=this.oparent.SelectedUnits.split(",");if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let r;r=e.J0.DoubleTryParse(this.oparent.TotalYears.Text);for(let p=0;p<u.length;p++){let D=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(D=this.oparent.dsPart.Tables[5].filter(m=>m.UnitID==u[p])),null!=D&&D.length>0){let m=parseFloat(this.selectedrow.Amount.toString())*parseFloat(D[0].RENT);null!=o&&parseFloat(o)>0&&(m/=parseFloat(o));let b=m/r;for(let S=0;S<r;S++){let c=this.PstDocGrid.NewRow();c.FromDate=this.oparent.StartDate.Date.AddYears(S).ToString(d.d.SessionManager.Preferences["Date Format"]),c.FromDate_Key=this.oparent.StartDate.Date.AddYears(S),S==r-1?(c.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),c.ToDate_Key=this.oparent.EndDate.Date):(c.ToDate=this.oparent.StartDate.Date.AddYears(S+1).AddDays(-1).ToString(d.d.SessionManager.Preferences["Date Format"]),c.ToDate_Key=this.oparent.StartDate.Date.AddYears(S+1).AddDays(-1)),c.Unit_key=D[0].UnitID.toString(),e.J0.IsEmpty(D[0].RENT)||(c.Amount=b.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),c.Rate=(parseFloat(c.Amount)/parseFloat(D[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),c.Discount=0,c.ActAmount=c.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(D[0].RENT)&&(c.BaseRent=parseFloat(D[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(D[0].PrevVal)&&(c.PrevRent=parseFloat(D[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(D[0].RENT)||(c.ProposedAmount=parseFloat(D[0].RENT.toString())),e.J0.IsEmpty(D[0].Dicount)||(c.ProposedDisc=parseFloat(D[0].Dicount.toString())),e.J0.IsEmpty(D[0].RENTAMT)||(c.ProposedRent=parseFloat(D[0].RENTAMT.toString())),this.CalcAmount(c,"")),this.FillREfDet(h,c),c.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(c)}}}}else{this.Filter.SelectedValue="1",this.ButtonSave("Selectionchanged"),this.PstDocGrid.Clear();let r=parseFloat(this.selectedrow.Amount.toString());if(r.ToString("N2")==parseFloat(o).ToString("N2"))for(let p=0;p<u.length;p++){let D=this.PstDocGrid.NewRow();D.FromDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.FromDate_Key=this.oparent.StartDate.Date,this.PstDocGrid.TableColumns.Contains("ProposedAmount")?(D.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.EndDate.Date):(D.ToDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.StartDate.Date);let m=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(m=this.oparent.dsPart.Tables[5].filter(b=>b.UnitID==u[p])),null!=m&&m.length>0&&(D.Unit_key=m[0].UnitID.toString(),e.J0.IsEmpty(m[0].RENT)||(D.Amount=parseFloat(m[0].RENT).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),D.Rate=(parseFloat(D.Amount)/parseFloat(m[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),D.Discount=0,D.ActAmount=D.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(m[0].RENT)&&(D.BaseRent=e.J0.Double(m[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(m[0].PrevVal)&&(D.PrevRent=e.J0.Double(m[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(m[0].RENT)||(D.ProposedAmount=e.J0.Double(m[0].RENT.toString())),e.J0.IsEmpty(m[0].Dicount)||(D.ProposedDisc=e.J0.Double(m[0].Dicount.toString())),e.J0.IsEmpty(m[0].RENTAMT)||(D.ProposedRent=e.J0.Double(m[0].RENTAMT.toString())),this.CalcAmount(D,""))),this.FillREfDet(h,D),D.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(D)}else for(let p=0;p<u.length;p++){let D=this.PstDocGrid.NewRow();D.FromDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.FromDate_Key=this.oparent.StartDate.Date,this.PstDocGrid.TableColumns.Contains("ProposedAmount")?(D.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.EndDate.Date):(D.ToDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.StartDate.Date);let m=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(m=this.oparent.dsPart.Tables[5].filter(b=>b.UnitID==u[p])),null!=m&&m.length>0&&(D.Unit_key=m[0].UnitID.toString(),e.J0.IsEmpty(m[0].RENT)||(D.Amount=null!=o?(r*parseFloat(m[0].RENT)/parseFloat(o)).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()):(r*parseFloat(m[0].RENT)).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),D.Rate=(parseFloat(D.Amount)/parseFloat(m[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),D.Discount=0,D.ActAmount=D.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(m[0].RENT)&&(D.BaseRent=e.J0.Double(m[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(m[0].PrevVal)&&(D.PrevRent=e.J0.Double(m[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(m[0].RENT)||(D.ProposedAmount=e.J0.Double(m[0].RENT.toString())),e.J0.IsEmpty(m[0].Dicount)||(D.ProposedDisc=e.J0.Double(m[0].Dicount.toString())),e.J0.IsEmpty(m[0].RENTAMT)||(D.ProposedRent=e.J0.Double(m[0].RENTAMT.toString())),this.CalcAmount(D,""))),this.FillREfDet(h,D),D.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(D)}}this.PstDocGrid.Columns[3].IsVisible&&!this.PstDocGrid.RefreshGrid&&(this.PstDocGrid.RefreshGrid=!0)}}else if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let h;h=e.J0.DoubleTryParse(this.oparent.TotalYears.Text);let u,o=parseFloat(this.selectedrow.Amount.toString())/h;e.J0.DoubleTryParse(this.selectedrow.Discount.toString())?(u=e.J0.DoubleTryParse(this.selectedrow.Discount.toString()),u/=h):u=0;let r=0,p=0;for(let D=0;D<h;D++){let m=this.PstDocGrid.NewRow();m.FromDate=this.oparent.StartDate.Date.AddYears(D).ToString(d.d.SessionManager.Preferences["Date Format"]),m.FromDate_Key=this.oparent.StartDate.Date.AddYears(D),D==h-1?(m.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),m.ToDate_Key=this.oparent.EndDate.Date,m.Amount=(parseFloat(this.selectedrow.Amount.toString())-r).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),u>0?(m.Discount=(parseFloat(this.selectedrow.Discount.toString())-p).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),m.ActAmount=(parseFloat(m.Amount.toString())+parseFloat(m.Discount.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())):(m.Discount=0,m.ActAmount=m.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(m.Rate=(parseFloat(m.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))):(m.ToDate=this.oparent.StartDate.Date.AddYears(D+1).AddDays(-1).ToString(d.d.SessionManager.Preferences["Date Format"]),m.ToDate_Key=this.oparent.StartDate.Date.AddYears(D+1).AddDays(-1),m.Amount=o.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),u>0?(m.Discount=u.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),m.ActAmount=(o+u).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),p+=parseFloat(m.Discount)):(m.Discount=0,m.ActAmount=m.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(m.Rate=(parseFloat(m.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))),r+=parseFloat(m.Amount.toString()),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].RENT)||(m.ProposedAmount=parseFloat(this.oparent.dsPart.Tables[5][0].RENT.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].Dicount)||(m.ProposedDisc=parseFloat(this.oparent.dsPart.Tables[5][0].Dicount.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].RENTAMT)||(m.ProposedRent=parseFloat(this.oparent.dsPart.Tables[5][0].RENTAMT.toString())),this.CalcAmount(m,"")),m.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(m)}}null!=this.selectedrow&&this.OnGridCellEditEnding(null,"Amount",0);for(let h=0;h<5;h++){let o=this.PstDocGrid.NewRow();this.PstDocGridTableColumns.Contains("select")?o.select=!1:o.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(o)}if(7==this.Calltype)this.PartGrid.Visible=!1;else if(null!=this.selectedrow){this.PartGrid.CanUserSortColumns=!1,this.PartGrid.CanUserDeleteRows=!0,this.PartGrid.RowHeight=25,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PartGrid.CanUserAddRows=!1,this.PartGridTableableColumns.push("Sno"),this.PartGridTableableColumns.push("Part"),this.PartGridTableableColumns.push("Part_Key"),this.PstDocGrid.DataTypes.Int.push("Part_Key"),this.PartGridTableableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),t=new f.O7,t.Header="Particulars",t.DisplayMember="Part",t.Width=100,t.ReadOnly=!0,this.PartGrid.Columns.push(t),t=new f.O7,t.Header="Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.ReadOnly=!0,t.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PartGrid.Columns.push(t);for(let h=0;h<this.oparent.DataTable.length;h++)if(!e.J0.IsEmpty(this.oparent.DataTable[h].NodeID)){let o=this.PartGrid.NewRow();if(o.Part_Key=this.oparent.DataTable[h].NodeID.toString(),e.J0.IsEmpty(this.oparent.DataTable[h].Particulars)){var l=this.oparent.ContractParticular.find(u=>!e.J0.StringIsNullOrEmpty(u.ValueBinding)&&"NodeID"==u.ValueBinding);if(null!=l&&null!=l){let u=this.oparent.ContractParticular[1].ComboData.filter(r=>r.NodeID==this.oparent.DataTable[h].NodeID.toString());u.length>0&&(o.Part=u[0].Particulars.toString())}}else o.Part=this.oparent.DataTable[h].Particulars.toString();this.PartGrid.addRow(o)}}}OnRowSelection(s){return null!=s&&7!=this.Calltype&&this.PopulateParticulars(s),!0}getdays(s,n){return s.iMonth()<=2&&s.IsLeapYear()||2==n.iMonth()&&29==n.getDate()||s<new Date(n.getFullYear(),2,28)&&n.iMonth()>2&&n.IsLeapYear()?366:365}FillREfDet(s,n){if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&s.Columns[0].Contains("UnitID")){var t=s.Tables[0].filter(a=>a.UnitID==n.Unit_key.toString());if(t.length>0)for(let a=0;a<this.PstDocGrid.Columns.length;a++)this.PstDocGrid.Columns[a].DisplayMember.Contains("Fld")&&s.Columns[0].Contains(this.PstDocGrid.Columns[a].ID)&&(n[this.PstDocGrid.Columns[a].DisplayMember]=e.J0.String(t[0][this.PstDocGrid.Columns[a].ID]))}}PopulateParticulars(s){let n,t,a=null,i=null;e.J0.IsEmpty(s.ToDate_Key)||(i=e.J0.ParseDate(s.ToDate_Key.toString())),e.J0.IsEmpty(s.FromDate_Key)||(a=e.J0.ParseDate(s.FromDate_Key.toString()));for(let l=0;l<this.oparent.DataTable.length;l++)if(!e.J0.IsEmpty(this.oparent.DataTable[l].NodeID)){let h=this.PartGrid.Table.filter(o=>o.Part_Key==this.oparent.DataTable[l].NodeID.toString());if(h.length>0){let o=0;if(this.oparent.DataTable[l]==this.selectedrow)for(let u=0;u<this.PstDocGrid.Table.length;u++)!e.J0.IsEmpty(this.PstDocGrid.Table[u].Amount)&&!e.J0.IsEmpty(this.PstDocGrid.Table[u].FromDate_Key)&&(e.J0.ParseDate(this.PstDocGrid.Table[u].FromDate_Key.toString()),o+=parseFloat(this.PstDocGrid.Table[u].Amount.toString()));else if(e.J0.IsEmpty(this.oparent.DataTable[l].Xml))!e.J0.IsEmpty(a)&&a.Date==this.oparent.StartDate.Date&&!e.J0.IsEmpty(this.oparent.DataTable[l].Amount)&&(o+=parseFloat(this.oparent.DataTable[l].Amount.toString()));else{let u=new e.VB;u.LoadXml(this.oparent.DataTable[l].Xml.toString());let r=-1;if(u.DocumentElement.children.length>0&&null!=u.DocumentElement.attributes&&null!=u.DocumentElement.attributes.Filter&&!e.J0.IsEmpty(u.DocumentElement.attributes.Filter.value)&&(r=parseInt(u.DocumentElement.attributes.Filter.value)),2==r||-1==r)u.DocumentElement.children[0].childNodes.forEach(p=>{n=e.J0.isValidDate(p.FromDate.value),t=e.J0.isValidDate(p.ToDate.value),!e.J0.IsEmpty(a)&&null!=n&&a.Date==n.Date&&!e.J0.IsEmpty(p.Amount.value)&&!e.J0.IsEmpty(i)&&null!=t&&i.Date==t.Date&&(o+=parseFloat(p.Amount.value))});else if(0==r){let p=u.SelectNodes("XML/UnitsRow/Row");for(let D=0;D<p.length;D++){let m=p[D];n=e.J0.isValidDate(m.attributes.FromDate.value),t=e.J0.isValidDate(m.attributes.ToDate.value),!e.J0.IsEmpty(a)&&null!=n&&a.Date==n.Date&&!e.J0.IsEmpty(m.attributes.Amount.value)&&!e.J0.IsEmpty(i)&&null!=t&&i.Date==t.Date&&(o+=parseFloat(m.attributes.Amount.value))}}}h[0].Amount=o,this.PartGrid.updateRow(h[0])}}}CalcAmount(s,n){let t,a,i;if(t=e.J0.DoubleTryParse(s.ProposedRent),a=e.J0.DoubleTryParse(s.ProposedDisc),i=e.J0.DoubleTryParse(s.ProposedAmount),"ProposedAmount"==n&&(s.ProposedRent=(i+a).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),("ProposedRent"==n||"ProposedDisc"==n)&&(0==t&&i>0?s.ProposedRent=(i+a).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()):s.ProposedAmount=(t-a).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),!e.J0.IsEmpty(s.ToDate_Key)&&!e.J0.IsEmpty(s.FromDate_Key)){let l=e.J0.GetDateDifference(e.J0.ParseDate(s.ToDate_Key),e.J0.ParseDate(s.FromDate_Key));l++,365==l||366==l?s.ActAmount=s.ProposedAmount:(i=e.J0.DoubleTryParse(s.ProposedAmount),s.ActAmount=(i/this.getdays(new Date(s.FromDate_Key.toString()),new Date(s.ToDate_Key.toString()))*l).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=e.J0.DoubleTryParse(s.ActAmount),a=e.J0.DoubleTryParse(s.Discount),s.Amount=(t-a).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())}}OnBeginEdit(s){let t=this.PstDocGrid.Table.indexOf(s.args.item);if(t=-1==t||this.PstDocGrid.Table.length-t<3?3:0,this.PstDocGrid.CanUserAddRows)for(let a=0;a<t;a++){let i=this.PstDocGrid.NewRow();i.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(i)}}OnGridCellEditEnding(s,n,t){if(e.J0.IsEmpty(s)||(n=s.column.field,s=s.item),"Percent"==n&&!e.J0.IsEmpty(s.Percent)&&parseFloat(s.Percent.toString())>0&&this.PstDocGrid.SelectedIndex>0&&!e.J0.IsEmpty(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount)){let a=parseFloat(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount.toString());s.Amount=(a+parseFloat(s.Percent)*a/100).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),n="Amount"}if("MonthAmount"==n&&null!=s&&!e.J0.IsEmpty(s.MonthAmount)&&!e.J0.IsEmpty(s.ToDate_Key)&&!e.J0.IsEmpty(s.FromDate_Key)&&(s.Amount=parseFloat(s.MonthAmount.toString())*this.oparent.CalculateMonthsbetweenDates(e.J0.ParseDate(s.FromDate_Key.toString()),e.J0.ParseDate(s.ToDate_Key.toString())),n="Amount"),"VatType"==n&&(n="Amount"),null!=s&&("ProposedRent"==n||"ProposedDisc"==n||"ProposedAmount"==n)&&(this.CalcAmount(s,n),this.CalculateTotals(s),this.PstDocGrid.updateRow(s),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(s)),("Amount"==n||"ActAmount"==n||"Discount"==n||"Rate"==n)&&this.PstDocGrid.Columns.length>4){if("Rate"==n&&null!=s)if(null==this.oparent.dsPart&&this.oparent.FillDs(),e.J0.IsEmpty(s.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(s.Amount=(parseFloat(s.Rate)*parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()));else{let a=this.oparent.dsPart.Tables[5].filter(i=>i.UnitID==s.Unit_key.toString());a.length>0&&(s.Amount=(parseFloat(s.Rate)*parseFloat(a[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))}if(null!=s){let a,i,l;a=e.J0.DoubleTryParse(s.ActAmount),i=e.J0.DoubleTryParse(s.Discount),l=e.J0.DoubleTryParse(s.Amount),("Amount"==n||"Rate"==n)&&(s.ActAmount=(l+i).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),("ActAmount"==n||"Discount"==n)&&(0==a&&l>0?s.ActAmount=(l+i).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()):s.Amount=(a-i).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),7==this.Calltype&&104==this.oparent.CostCenterID&&("1"==s.VatType.toString()?(s.VatPer=this.oparent.VatonRent.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),i=l*this.oparent.VatonRent/100,s.VatAmount=i.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),s.Net=(l+i).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())):(s.VatPer=(0).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),s.VatAmount=(0).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),s.Net=l.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())))}if(this.CalculateTotals(s),null!=s&&7!=this.Calltype){if("Rate"!=n&&(null==this.oparent.dsPart&&this.oparent.FillDs(),!e.J0.IsEmpty(s.Amount)))if(e.J0.IsEmpty(s.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(s.Rate=(parseFloat(s.Amount)/parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()));else{let a=this.oparent.dsPart.Tables[5].filter(i=>i.UnitID==s.Unit_key.toString());a.length>0&&(s.Rate=(parseFloat(s.Amount)/parseFloat(a[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))}this.PstDocGrid.updateRow(s),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(s)}}}CalculateTotals(s){let n=this.PstDocGrid.Table.Compute("sum","Amount");(null==n||null==n)&&(n=0);var t=this.PstDocGrid.Columns.find(a=>"Amount"==a.DisplayMember);null!=t&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),n=this.PstDocGrid.Table.Compute("sum","ActAmount"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"ActAmount"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),n=this.PstDocGrid.Table.Compute("sum","Discount"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"Discount"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(n=this.PstDocGrid.Table.Compute("sum","ProposedAmount"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"ProposedAmount"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),n=this.PstDocGrid.Table.Compute("sum","ProposedRent"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"ProposedRent"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),n=this.PstDocGrid.Table.Compute("sum","ProposedDisc)"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"ProposedDisc"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))),this.PstDocGrid.TableColumns.Contains("BaseRent")&&(n=this.PstDocGrid.Table.Compute("sum","BaseRent"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"BaseRent"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))),7==this.Calltype&&104==this.oparent.CostCenterID&&(n=this.PstDocGrid.Table.Compute("sum","Net"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"Net"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),n=this.PstDocGrid.Table.Compute("sum","VatAmount"),(null==n||null==n)&&(n=0),null!=(t=this.PstDocGrid.Columns.find(a=>"VatAmount"==a.DisplayMember))&&(t.footer=parseFloat(n).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()))),null!=s&&this.PstDocGrid.UpdateFooter()}InitColumns(){let s;this.Tower=new R.y$(0),this.CompletionDate=new I.C_(0),this.CompletionDate.Label="New CompletionDate",this.EndDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid=new A.vv,this.PartGrid.Visible=!1,this.PartGrid=new A.vv,this.PartGrid.CanUserSortColumns=!0,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("select"),this.PstDocGrid.DataTypes.Bool.push("select"),this.PstDocGridTableColumns.push("DocNumber"),this.PstDocGridTableColumns.push("DocPrefix"),this.PstDocGridTableColumns.push("DocID"),this.PstDocGridTableColumns.push("CostCenterID"),this.PstDocGridTableColumns.push("VNO"),s=new f.O7,s.Header=d.d.GetResource("DocumentDesigner_Sno"),s.DisplayMember="Sno",s.ReadOnly=!0,s.Width=50,this.PstDocGrid.Columns.push(s),s=new f.O7,s.Header="Select",s.DisplayMember="select",s.Width=60,s.DataType="CheckBox",this.PstDocGrid.Columns.push(s);let n=d.d.rental.GetPaymentScreenDef(),t=null;for(let a=0;a<n.Tables[0].length;a++)"PaymentTermDocumentName"==n.Tables[0][a].DBText.toString()?e.J0.IsEmpty(n.Tables[0][a].Value)||(this.DocCCID=parseInt(n.Tables[0][a].Value.toString())):"PaymentTermCompletionDate"==n.Tables[0][a].DBText.toString()?this.CompletionDateColName=n.Tables[0][a].Value.toString():"LinkDocument"==n.Tables[0][a].DBText.toString()?e.J0.IsEmpty(n.Tables[0][a].Value)||(this.CCID=parseInt(n.Tables[0][a].Value.toString())):"PaymentTermFields"==n.Tables[0][a].DBText.toString()&&(t=n.Tables[0][a].Value.toString().split(";"));this.Tower.CCID=this.CCID,this.Tower.TypeID=1,this.Tower.Label="Tower",t.forEach(a=>{let i=[]=n.Tables[1].filter(l=>l.SysColumnName==a);if(i.length>0)if(s=new f.O7,s.Header=i[0].ResourceData.toString(),s.DisplayMember=i[0].SysColumnName.toString(),"VoucherNo"==s.DisplayMember&&(s.DataType="LINK",s.Click.Subscribe(this,"onClick")),s.ReadOnly=!0,s.Width=100,this.PstDocGrid.Columns.push(s),s.SectionName=i[0].UserColumnType.toString(),this.PstDocGridTableColumns.push(i[0].SysColumnName.toString()),i[0].SysColumnName.toString().toLowerCase().Contains("dcccnid")){let l=parseInt(i[0].SysColumnName.toString().toLowerCase().Replace("dcccnid",""));l+=5e4,this.Joins+=" left Join "+this.GetTableName(l)+" c"+l.toString()+"  WITH(NOLOCK) on c."+i[0].SysColumnName.toString()+"= c"+l.toString()+".NODEID  ",this.Columns+=",c"+l.toString()+".name "+s.DisplayMember}else"debitaccount"==i[0].SysColumnName.toString().toLowerCase()||"creditaccount"==i[0].SysColumnName.toString().toLowerCase()?(this.Joins+=" left Join "+this.GetTableName(2)+" c"+i[0].SysColumnName.toString()+"  WITH(NOLOCK) on a."+i[0].SysColumnName.toString()+"= c"+i[0].SysColumnName.toString()+".AccountID  ",this.Columns+=",c"+i[0].SysColumnName.toString()+".Accountname "+s.DisplayMember):"duedate"==i[0].SysColumnName.toString().toLowerCase()||"docdate"==i[0].SysColumnName.toString().toLowerCase()||"billdate"==i[0].SysColumnName.toString().toLowerCase()?this.Columns+=",Convert(datetime,"+s.DisplayMember+") "+s.DisplayMember:this.Columns+=","+s.DisplayMember;else"PaymentTerm"==a&&(s=new f.O7,s.Header="PaymentTerm",s.DisplayMember="PaymentTerm",s.ReadOnly=!0,s.Width=100,s.SectionName="PaymentTerm",this.PstDocGrid.Columns.push(s),this.PstDocGridTableColumns.push("PaymentTerm"),this.Columns+=",(select top 1 pd.ProfileName from COM_DocPayTerms p ",this.Columns+=" join Acc_PaymentDiscountProfile pd on p.ProfileID=pd.ProfileID  ",this.Columns+=" where p.VoucherNo=a.VoucherNo)  "+s.DisplayMember)})}GetTableName(s){return 2==s?"ACC_Accounts":3==s?"INV_Product":50001==s?"COM_Division":50002==s?"COM_Location":50003==s?"COM_Branch":50004==s?"COM_Department":50005==s?"COM_Salesman":50006==s?"COM_Category":50007==s?"COM_Area":50008==s?"COM_Teritory":"COM_CC"+s}onClick(){null!=this.PstDocGrid.SelectedItem&&!e.J0.IsEmpty(this.PstDocGrid.SelectedItem.CostCenterID)&&_.RibbonExtViewModel.LoadDocument(this.PstDocGrid.SelectedItem)}SelectAllRows(){for(let s=0;s<this.PstDocGrid.Table.length;s++)this.PstDocGridTable[s].select=this.SelectAll}FillSearchDetails(){this.Options=new y.y$(0),this.SearchCols=new y.y$(0),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_Equals"),"1")),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_NotEquals"),"2")),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_BeginsWith"),"3")),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_EndsWith"),"4")),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_Contains"),"5")),this.Options.Items.push(y._p.ComboBoxItems_2(d.d.GetResource("Com_NotContains"),"6")),this.Options.SelectedValue="5",this.PstDocGrid.Columns.forEach(s=>{s.IsVisible&&"Sno"!=s.DisplayMember&&"select"!=s.DisplayMember&&this.SearchCols.Items.push(y._p.ComboBoxItems_2(s.Header,s.DisplayMember))}),this.SearchCols.Items.length>0&&(this.SearchCols.SelectedValue=this.SearchCols.Items[0].Value)}LoadData(){if(null!=this.Tower&&this.Tower.CCID>0&&this.Tower.SelectedValue>0){let s,n;this.PstDocGrid.Clear();let t=" where c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue,a=d.d.rental.GetPayTermsofProperty(t,this.Columns,this.Joins);if(null!=a&&a.Tables.length>0&&a.Columns[0].Contains("DocPrefix")){for(let i=0;i<a.Tables[0].length;i++){n=this.PstDocGrid.NewRow(),n.Sno=(i+1).toString(),n.select=!1,n.DocNumber=a.Tables[0][i].DocNumber.toString(),n.DocPrefix=a.Tables[0][i].DocPrefix.toString(),n.DocID=a.Tables[0][i].DocID.toString(),n.CostCenterID=a.Tables[0][i].CostCenterID.toString(),n.VNO=a.Tables[0][i].VNO.toString();for(let l=2;l<this.PstDocGrid.Columns.length;l++)a.Columns[0].Contains(this.PstDocGrid.Columns[l].DisplayMember)?"date"==this.PstDocGrid.Columns[l].SectionName.toLowerCase()&&!e.J0.IsEmpty(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember])&&e.J0.isValidDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString())&&(s=e.J0.isValidDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString()),n[this.PstDocGrid.Columns[l].DisplayMember]=e.J0.ParseDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString()).ToString(d.d.SessionManager.Preferences["Date Format"])):"datetime"==this.PstDocGrid.Columns[l].SectionName.toLowerCase()&&!e.J0.IsEmpty(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember])&&e.J0.isValidDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString())?(s=e.J0.isValidDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString()),n[this.PstDocGrid.Columns[l].DisplayMember]=e.J0.ParseDate(a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString()).ToString(d.d.SessionManager.Preferences["Date Format"]+" hh:mm:ss")):n[this.PstDocGrid.Columns[l].DisplayMember]=a.Tables[0][i][this.PstDocGrid.Columns[l].DisplayMember].toString()}this.PstDocGrid.addRow(n)}}}ButtonSave(s){if(this.DisplayMessage="",this.PstDocGrid&&this.PstDocGrid.angularGrid?.slickGrid&&this.PstDocGrid.angularGrid?.slickGrid.getActiveCellNode()&&(this.PstDocGrid.angularGrid.slickGrid.getActiveCell(),this.PstDocGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit()),"Save"==s){if(2==this.Calltype||50==this.Calltype)return void d.d.page.HideDialog(this.PopUpGUID);if(7==this.Calltype){let h,o,u,i="",l="",r=0,p=0,D=0,m=0;if(this.Filter.Visible&&this.Filter.Items.length>1)for(let b=0;b<this.Filter.Items.length;b++){const S=this.Filter.Items[b];if(S!=this.Filter.SelectedItem&&e.J0.IsEmpty(S.Aliasname))return this.DisplayMessage="Define rates for "+S.Name,void(this.MessageVisibility=!0);S!=this.Filter.SelectedItem&&(i+=S.Aliasname,p+=S.ExchgRate,null!=S.obj?D+=parseFloat(S.obj):S.obj=0,h=this.oparent.StartDate.Date,r=parseInt(S.Value),o=h.AddYears(r-1),h=h.AddYears(r),u=h<this.oparent.EndDate.Date?h.AddDays(-1):this.oparent.EndDate.Date,l+='<Row FromDate="'+o.ToString("dd/MMM/yyyy")+'" ',l+='ToDate="'+u.ToString("dd/MMM/yyyy")+'" ',l+='Distribute="'+S.Seq+'" ',l+='Amount="'+S.ExchgRate+parseFloat(S.obj)+'" ',l+='Discount="0" ',l+='ActAmount="'+S.ExchgRate+parseFloat(S.obj)+'" ',l+='NonTaxAmount="'+parseFloat(S.obj)+'" ',l+='TaxableAmt="'+S.ExchgRate+'" />')}null!=this.Filter.SelectedItem&&(r=e.J0.Int(this.CopyRows.Text),this.Filter.SelectedItem.Seq=!e.J0.IsEmpty(this.CopyRows.Text)&&r>0?r:1),this.Filter.Visible?(h=this.oparent.StartDate.Date,r=parseInt(this.Filter.SelectedValue),o=h.AddYears(r-1),i+='FromDate="'+h.ToString("dd/MMM/yyyy")+'" ',h=h.AddYears(r),u=h<this.oparent.EndDate.Date?h.AddDays(-1):this.oparent.EndDate.Date,i+='ToDate="'+h.ToString("dd/MMM/yyyy")+'" '):(o=this.oparent.StartDate.Date,u=this.oparent.EndDate.Date),this.Filter.Visible&&this.Filter.Items.length>1&&(this.Filter.SelectedItem.obj=this.Filter.SelectedItem.ExchgRate=0),i+="<UnitsXML>";for(let b=0;b<this.PstDocGrid.Table.length;b++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[b].Amount)){i+="<Row ",this.Filter.Visible&&this.Filter.Items.length>1&&(i+='Year="'+this.Filter.SelectedValue+'" Distribute="'+this.Filter.SelectedItem.Seq+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[b].Unit_key)||(i+='Unit="'+this.PstDocGrid.Table[b].Unit_key.toString()+'" '),i+='Amount="'+this.PstDocGrid.Table[b].Amount.toString()+'" ',104==this.oparent.CostCenterID?("1"==e.J0.String(this.PstDocGrid.Table[b].VatType)?p+=parseFloat(this.PstDocGrid.Table[b].Amount.toString()):D+=parseFloat(this.PstDocGrid.Table[b].Amount.toString()),i+='FromDate="'+o.ToString("dd/MMM/yyyy")+'" ',i+='ToDate="'+u.ToString("dd/MMM/yyyy")+'" ',this.Filter.Visible&&this.Filter.Items.length>1&&("1"==this.PstDocGrid.Table[b].VatType.toString()?this.Filter.SelectedItem.ExchgRate+=parseFloat(this.PstDocGrid.Table[b].Amount.toString()):this.Filter.SelectedItem.obj=parseFloat(this.Filter.SelectedItem.obj)+parseFloat(this.PstDocGrid.Table[b].Amount.toString()))):(this.PstDocGridTableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].Discount)&&(p+=parseFloat(this.PstDocGrid.Table[b].Discount.toString())),this.PstDocGridTableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].ActAmount)&&(D+=parseFloat(this.PstDocGrid.Table[b].ActAmount.toString())),this.PstDocGridTableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].BaseRent)&&(m+=parseFloat(this.PstDocGrid.Table[b].BaseRent.toString()))),this.PstDocGridTableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].BaseRent)&&(i+='BaseRent="'+this.PstDocGrid.Table[b].BaseRent.toString()+'" '),this.PstDocGridTableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].PrevRent)&&(i+='PrevRent="'+this.PstDocGrid.Table[b].PrevRent.toString()+'" '),this.PstDocGridTableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].Discount)&&(i+='Discount="'+this.PstDocGrid.Table[b].Discount.toString()+'" '),this.PstDocGridTableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[b].ActAmount)&&(i+='ActAmount="'+this.PstDocGrid.Table[b].ActAmount.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[b].VatType)||(i+='VatType="'+this.PstDocGrid.Table[b].VatType.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[b].VatPer)||(i+='VatPer="'+this.PstDocGrid.Table[b].VatPer.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[b].VatAmount)||(i+='VatAmount="'+this.PstDocGrid.Table[b].VatAmount.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[b].Net)||(i+='Net="'+this.PstDocGrid.Table[b].Net.toString()+'" ');for(let S=0;S<this.PstDocGrid.Columns.length;S++)this.PstDocGrid.Columns[S].DisplayMember.Contains("Fld")&&(i+=this.PstDocGrid.Columns[S].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[b][this.PstDocGrid.Columns[S].DisplayMember])+'" ');i+='Narration="'+e.J0.String(this.PstDocGrid.Table[b].Narration)+'"/>'}return i+="</UnitsXML>",this.selectedrow.UnitXml=i.toString(),104==this.oparent.CostCenterID?(this.selectedrow.NonTaxAmount=D,this.selectedrow.Amount=p+D,this.selectedrow.ActAmount=e.J0.IsEmpty(this.selectedrow.Discount)?this.selectedrow.Amount:p+D+parseFloat(this.selectedrow.Discount.toString()),this.oparent.CalculateNRec(),this.oparent.CalculateFooter(),this.Filter.Visible&&this.Filter.Items.length>1&&(l+='<Row FromDate="'+o.ToString("dd/MMM/yyyy")+'" ',l+='ToDate="'+u.ToString("dd/MMM/yyyy")+'" ',l+='Distribute="'+this.Filter.SelectedItem.Seq+'" ',l+='Amount="'+this.Filter.SelectedItem.ExchgRate+parseFloat(this.Filter.SelectedItem.obj)+'" ',l+='Discount="0" ',l+='ActAmount="'+this.Filter.SelectedItem.ExchgRate+parseFloat(this.Filter.SelectedItem.obj)+'" ',l+='NonTaxAmount="'+parseFloat(this.Filter.SelectedItem.obj)+'" ',l+='TaxableAmt="'+this.Filter.SelectedItem.ExchgRate+'" />',l.Insert(0,"<XML>"),l+="</XML>",this.selectedrow.Xml=l.toString())):(this.oparent.ProposedRent.Text=D.toString(),this.oparent.ProposedDisc.Text=p.toString(),(n=this.oparent.ScreenObject.Data.Tables[0].filter(b=>null!=b.LocalReference&&93==b.LocalReference&&25641==b.LinkData)).length>0&&null!=(t=this.oparent.ScreenObject.GetCustomField(n[0].SysColumnName.toString()))&&t instanceof M.Dw&&(t.Text=m.toString()),this.oparent.CalculateTextFields(this.oparent.ProposedDisc),this.oparent.CalculateRentBaedOnDays(0,!1)),void d.d.page.HideDialog(this.PopUpGUID)}if(1==this.Calltype){let i=0;if(i=e.J0.IntTryParse(this.CopyRows.Text),!(i>0))return this.DisplayMessage="Enter valid count.",void(this.MessageVisibility=!0);{let l=["DocID","DocNumber","DocPrefix","DocumentName","CostCenterID","DocumentNo","Status","Xml"],h=this.oparent.DataTable.indexOf(this.selectedrow);for(let o=0;o<i;o++){let u=this.oparent.DataTableObj.NewRow();for(let r=0;r<this.oparent.DataTableObj.Columns.length;r++)this.oparent.DataTableColumns.Contains(l[r])||(u[r]=this.selectedrow[r]);this.oparent.DataTableObj.insertRowAt(u,h)}for(let o=0;o<this.oparent.DataTableObj.Table.length;o++)this.oparent.DataTable[o].SNO=o+1}return}if(3==this.Calltype||4==this.Calltype||5==this.Calltype||6==this.Calltype){for(let i=0;i<this.PstDocGrid.Table.length;i++)if(""!=this.PstDocGrid.Table[i].Select.toString()&&(0,G.yG0)(this.PstDocGrid.Table[i].Select.toString())){let l=new J.AddEditRenContractViewModel;l.AddEditRenContractViewModel_1(95,parseInt(this.PstDocGrid.Table[i].ContractID.toString()),!1,0,0,""),l.IsFromSubContract=!1,l.ContractDate.Text=l.ContractDate.Date.ToString("dd/MMM/yyyy"),l.StartDate.Text=l.StartDate.Date.ToString("dd/MMM/yyyy"),l.EndDate.Text=l.EndDate.Date.ToString("dd/MMM/yyyy"),l.Tenant.Text=l.Property.Text=l.Unit.Text="",3==this.Calltype?(l.IsFromSubContract=!0,l.OnCustomizeExtraFields("AutoRenew"),l.OnSave("AutoSave")):4==this.Calltype?(l.TerminateContracts=this.oparent.TerminateContracts,l.TerminateContract(l.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,1,!0)):5==this.Calltype?(l.TerminateContracts=this.oparent.TerminateContracts,l.TerminateContract(l.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,3,!0)):6==this.Calltype&&(l.TerminateContracts=this.oparent.TerminateContracts,l.TerminateContract(l.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,2,!0))}return void d.d.page.HideDialog(this.PopUpGUID)}if(null!=this.oparent&&null!=this.selectedrow){if(this.oparent.IsRecurPosted)return this.DisplayMessage="Can not change as documents posted.",void(this.MessageVisibility=!0);let i=0,l=null,h=null,o=0,u=0,r=0,p=new Array;if(this.Filter.Visible&&"2"!=this.Filter.SelectedValue){if(this.Filter.Visible&&"1"==this.Filter.SelectedValue){for(let c=0;c<this.PstDocGrid.Table.length;c++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[c].Unit_key)){if(p.Contains(parseInt(this.PstDocGrid.Table[c].Unit_key.toString())))return this.DisplayMessage="Unit "+this.PstDocGrid.Table[c].Unit.toString()+" is defined more than once.",void(this.MessageVisibility=!0);p.push(parseInt(this.PstDocGrid.Table[c].Unit_key.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[c].Amount)||(o+=parseFloat(this.PstDocGrid.Table[c].Amount.toString()),i++),e.J0.IsEmpty(this.PstDocGrid.Table[c].ActAmount)||(r+=parseFloat(this.PstDocGrid.Table[c].ActAmount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[c].Discount)||(u+=parseFloat(this.PstDocGrid.Table[c].Discount.toString()))}if(i>0&&p.length!=this.oparent.SelectedUnits.split(",").length)return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else if(this.Filter.Visible&&"0"==this.Filter.SelectedValue&&(this.oparent.SelectedUnits.split(",").forEach(c=>{var g=this.PstDocGrid.Table.filter(P=>P.Unit_key==c,"FromDate_Key");if(l=null,h=null,g.length>0){p.push(parseInt(c));for(let P=0;P<g.length;P++){if(null==l&&!e.J0.IsEmpty(g[P].FromDate_Key)&&(l=e.J0.ParseDate(g[P].FromDate_Key.toString())),null!=h&&!e.J0.IsEmpty(g[P].FromDate_Key)&&1!=e.J0.GetDateDifference(e.J0.ParseDate(g[P].FromDate_Key),e.J0.ParseDate(h)))return this.DisplayMessage="Enter correct from date at row no:"+(this.PstDocGrid.Table.indexOf(g[P])+1),void(this.MessageVisibility=!0);if(e.J0.IsEmpty(g[P].Amount)||(o+=parseFloat(g[P].Amount.toString()),i++),e.J0.IsEmpty(g[P].ActAmount)||(r+=parseFloat(g[P].ActAmount.toString())),e.J0.IsEmpty(g[P].Discount)||(u+=parseFloat(g[P].Discount.toString())),e.J0.IsEmpty(g[P].ToDate_Key)||(h=e.J0.ParseDate(g[P].ToDate_Key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(g[P].FromDate_Key)&&!e.J0.IsEmpty(g[P].ToDate_Key)&&(""==e.J0.String(g[P].Distribute)||parseInt(g[P].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(this.PstDocGrid.Table.indexOf(g[P])+1),void(this.MessageVisibility=!0)}if(null==l||l.toDateString()!=this.CompletionDate.Date.toDateString())return this.DisplayMessage="Contract start date and first date does not match for ."+g[0].Unit.toString(),void(this.MessageVisibility=!0);if(null==h||h.toDateString()!=this.EndDate.Date.toDateString())return this.DisplayMessage="Contract end date and last date does not match for ."+g[0].Unit.toString(),void(this.MessageVisibility=!0)}}),i>0&&p.length!=this.oparent.SelectedUnits.split(",").length))return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else{for(let c=0;c<this.PstDocGrid.Table.length;c++){if(null==l&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].FromDate_Key)&&(l=e.J0.ParseDate(this.PstDocGrid.Table[c].FromDate_Key.toString())),null!=h&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].FromDate_Key)&&1!=e.J0.GetDateDifference(e.J0.ParseDate(this.PstDocGrid.Table[c].FromDate_Key),e.J0.ParseDate(h)))return this.DisplayMessage="Enter correct from date at row no:"+(c+1),void(this.MessageVisibility=!0);if(e.J0.IsEmpty(this.PstDocGrid.Table[c].Amount)||(o+=parseFloat(this.PstDocGrid.Table[c].Amount.toString()),i++),e.J0.IsEmpty(this.PstDocGrid.Table[c].ActAmount)||(r+=parseFloat(this.PstDocGrid.Table[c].ActAmount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[c].Discount)||(u+=parseFloat(this.PstDocGrid.Table[c].Discount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[c].ToDate_Key)||(h=e.J0.ParseDate(this.PstDocGrid.Table[c].ToDate_Key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].FromDate_Key)&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ToDate_Key)&&(""==e.J0.String(this.PstDocGrid.Table[c].Distribute)||parseInt(this.PstDocGrid.Table[c].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(c+1),void(this.MessageVisibility=!0)}if(i>0&&(null==l||l.toDateString()!=this.CompletionDate.Date.toDateString()))return this.DisplayMessage="Contract start date and first date does not match.",void(this.MessageVisibility=!0);if(i>0&&(null==h||h.toDateString()!=this.EndDate.Date.toDateString()))return this.DisplayMessage="Contract end date and last date does not match.",void(this.MessageVisibility=!0)}if((i>0&&(""==e.J0.String(this.selectedrow.Amount)||0==parseFloat(this.selectedrow.Amount.toString()))||this.PstDocGrid.TableColumns.Contains("ProposedAmount"))&&(this.selectedrow.Amount=o.ToString("N"+this.oparent.Mdeci),this.selectedrow.Discount=u.ToString("N"+this.oparent.Mdeci),this.selectedrow.ActAmount=r.ToString("N"+this.oparent.Mdeci),this.oparent.Reevaluate(!0),this.oparent.CalculateNRec()),i>0&&!e.J0.IsEmpty(this.selectedrow.Amount)&&parseFloat(this.selectedrow.Amount.toString()).ToString("N"+this.oparent.Mdeci)!=o.ToString("N"+this.oparent.Mdeci))return this.DisplayMessage="Amount mismatch",void(this.MessageVisibility=!0);let D="",m=0,b=0,S=0;if(i>0){if(D+="<XML",this.Filter.Visible&&(D+=' Filter="'+this.Filter.SelectedValue+'" '),D+=">",this.Filter.Visible&&"0"==this.Filter.SelectedValue)this.oparent.SelectedUnits.split(",").forEach(g=>{let P=this.PstDocGrid.Table.filter(T=>T.Unit_key==g,"FromDate_Key");D+='<UnitsRow Unit="'+g+'" Amount="##amt##" >';let w=0;for(let T=0;T<P.length;T++)if(!e.J0.IsEmpty(P[T].Amount)){D+="<Row ",D+='FromDate="'+e.J0.ParseDate(P[T].FromDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='ToDate="'+e.J0.ParseDate(P[T].ToDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='Unit="'+P[T].Unit_key.toString()+'" ',e.J0.IsEmpty(P[T].Period)||(D+='Period="'+P[T].Period.toString()+'" '),e.J0.IsEmpty(P[T].Rate)||(D+='Rate="'+P[T].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!e.J0.IsEmpty(P[T].MonthAmount)&&(D+='MonthAmount="'+P[T].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(P[T].Distribute)&&(D+='Distribute="'+P[T].Distribute.toString()+'" '),e.J0.IsEmpty(P[T].Discount)||(D+='Discount="'+P[T].Discount.toString()+'" '),e.J0.IsEmpty(P[T].ActAmount)||(D+='ActAmount="'+P[T].ActAmount.toString()+'" '),e.J0.IsEmpty(P[T].Percent)||(D+='Percent="'+P[T].Percent.toString()+'" '),D+='Amount="'+P[T].Amount.toString()+'" ',this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(P[T].BaseRent)&&(D+='BaseRent="'+P[T].BaseRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(P[T].PrevRent)&&(D+='PrevRent="'+P[T].PrevRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&!e.J0.IsEmpty(P[T].ProposedAmount)&&(D+='ProposedAmount="'+P[T].ProposedAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(P[T].ProposedDisc)&&(D+='ProposedDisc="'+P[T].ProposedDisc.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(P[T].ProposedRent)&&(D+='ProposedRent="'+P[T].ProposedRent.toString()+'" ');for(let E=0;E<this.PstDocGrid.Columns.length;E++)this.PstDocGrid.Columns[E].DisplayMember.Contains("Fld")&&(D+=this.PstDocGrid.Columns[E].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[T][this.PstDocGrid.Columns[E].DisplayMember])+'" ');this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(P[T].ProposedDisc)&&(b+=parseFloat(P[T].ProposedDisc.toString())),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(P[T].ProposedRent)&&(m+=parseFloat(P[T].ProposedRent.toString())),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(P[T].BaseRent)&&(S+=parseFloat(P[T].BaseRent.toString())),D+='Narration="'+e.J0.String(P[T].Narration)+'"/>',w+=parseFloat(P[T].Amount.toString())}D=D.Replace("##amt##",w.toString()),D+="</UnitsRow>"});else for(let c=0;c<this.PstDocGrid.Table.length;c++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[c].Amount)){D+="<Row ",(!this.Filter.Visible||this.PstDocGrid.Columns[1].IsVisible)&&(D+='FromDate="'+e.J0.ParseDate(this.PstDocGrid.Table[c].FromDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='ToDate="'+e.J0.ParseDate(this.PstDocGrid.Table[c].ToDate_Key).ToString("dd/MMM/yyyy")+'" '),this.Filter.Visible&&this.PstDocGrid.Columns[3].IsVisible&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].Unit_key)&&(D+='Unit="'+this.PstDocGrid.Table[c].Unit_key.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[c].Period)||(D+='Period="'+this.PstDocGrid.Table[c].Period.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[c].Rate)||(D+='Rate="'+this.PstDocGrid.Table[c].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].MonthAmount)&&(D+='MonthAmount="'+this.PstDocGrid.Table[c].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].Distribute)&&(D+='Distribute="'+this.PstDocGrid.Table[c].Distribute.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].Discount)&&(D+='Discount="'+this.PstDocGrid.Table[c].Discount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ActAmount)&&(D+='ActAmount="'+this.PstDocGrid.Table[c].ActAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Percent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].Percent)&&(D+='Percent="'+this.PstDocGrid.Table[c].Percent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].BaseRent)&&(D+='BaseRent="'+this.PstDocGrid.Table[c].BaseRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].PrevRent)&&(D+='PrevRent="'+this.PstDocGrid.Table[c].PrevRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ProposedAmount)&&(D+='ProposedAmount="'+this.PstDocGrid.Table[c].ProposedAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ProposedDisc)&&(D+='ProposedDisc="'+this.PstDocGrid.Table[c].ProposedDisc.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ProposedRent)&&(D+='ProposedRent="'+this.PstDocGrid.Table[c].ProposedRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ProposedDisc)&&(b+=parseFloat(this.PstDocGrid.Table[c].ProposedDisc.toString())),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].ProposedRent)&&(m+=parseFloat(this.PstDocGrid.Table[c].ProposedRent.toString())),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[c].BaseRent)&&(S+=parseFloat(this.PstDocGrid.Table[c].BaseRent.toString()));for(let g=0;g<this.PstDocGrid.Columns.length;g++)this.PstDocGrid.Columns[g].DisplayMember.Contains("Fld")&&(D+=this.PstDocGrid.Columns[g].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[c][this.PstDocGrid.Columns[g].DisplayMember])+'" ');D+='Amount="'+this.PstDocGrid.Table[c].Amount.toString()+'" ',D+='Narration="'+e.J0.String(this.PstDocGrid.Table[c].Narration)+'"/>'}D+="</XML>"}var n,t;if(this.selectedrow.Xml=D.toString(),this.PstDocGrid.TableColumns.Contains("ProposedAmount"))this.oparent.ProposedRent.Text=m.toString(),this.oparent.ProposedDisc.Text=b.toString(),(n=this.oparent.ScreenObject.Data.Tables[0].filter(g=>null!=g.LocalReference&&93==g.LocalReference&&25641==g.LinkData)).length>0&&null!=(t=this.oparent.ScreenObject.GetCustomField(n[0].SysColumnName.toString()))&&t instanceof M.Dw&&(t.Text=S.toString()),this.oparent.CalculateTextFields(this.oparent.ProposedDisc);return this.oparent.DataTableObj.updateRow(this.selectedrow),void d.d.page.HideDialog(this.PopUpGUID)}if(!(null!=this.CompletionDate.Date&&this.CompletionDate.Date&&this.PstDocGrid.Table.length>0))return this.PstDocGrid.Table.length>0?(this.DisplayMessage="can not save blank data ",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Completion Date",void(this.MessageVisibility=!0));{let i="";for(let l=0;l<this.PstDocGrid.Table.length;l++)!e.J0.IsEmpty(this.PstDocGrid.Table[l].select)&&(0,G.yG0)(this.PstDocGrid.Table[l].select.toString())&&(i+='<Row ID="'+this.PstDocGrid.Table[l].DocID.toString()+'" ',i+=' CostCenterID="'+this.PstDocGrid.Table[l].CostCenterID.toString()+'" ',i+=' VNO="'+this.PstDocGrid.Table[l].VNO.toString()+'" />');if(!(i.length>0))return this.DisplayMessage="Select data to save",void(this.MessageVisibility=!0);{i="<XML>"+i+"</XML>";let l=0,h=d.d.rental.SaveCompletionDate(i.toString(),this.CompletionDate.Date.Date(),this.Tower.SelectedValue);this.DisplayMessage=h.Message,l=h.RetValue,this.MessageVisibility=!0,l>0&&this.PstDocGrid.Clear()}}}else if("GenFirst"==s){if(null!=this.oparent&&null==this.selectedrow&&null!=this.Rows){if(e.J0.IsEmpty(this.Filter.SelectedValue))return this.DisplayMessage="Select Year",void(this.MessageVisibility=!0);if("ALL"==this.Filter.SelectedValue)this.oparent.GenerateContract();else{let i=null,l=null,h=0;i=e.J0.ParseDate(this.Filter.SelectedValue),e.J0.IsEmpty(this.Filter.SelectedItem.Parent)||(l=e.J0.ParseDate(this.Filter.SelectedItem.Parent)),this.Filter.SelectedItem.CurrID>0&&(h=parseInt(this.Filter.SelectedItem.CurrID.toString())),this.oparent.GenerateContract(i,l,h)}return void d.d.page.HideDialog(this.PopUpGUID)}}else"Search"==s?this.SearchGrid():"OK"==s?this.LoadData():"Close"==s?(this.DailogResult=!1,d.d.page.HideDialog(this.PopUpGUID)):"Selectionchanged"==s&&("0"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!0):"1"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!1,this.PstDocGrid.Columns[2].IsVisible=!1,this.PstDocGrid.Columns[3].IsVisible=!0):"2"==this.Filter.SelectedValue&&(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!1),this.PstDocGrid.RefreshColumns(),this.LoadDefaultValues(),this.PstDocGrid.gridObj&&this.PstDocGrid.gridObj.onRendered.subscribe(i=>{this.CalculateTotals(null),this.PstDocGrid.UpdateFooter()}))}LoadDefaultValues(){if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){this.PstDocGrid.Clear();var s=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),n=this.oparent.SelectedUnits.split(",");let t;if(t=e.J0.DoubleTryParse(this.oparent.TotalYears.Text),"0"==this.Filter.SelectedValue&&this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1))for(let a=0;a<n.length;a++){let i=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(i=this.oparent.dsPart.Tables[5].filter(l=>l.UnitID==n[a])),null!=i&&i.length>0){let l=parseFloat(this.selectedrow.Amount.toString())*parseFloat(i[0].RENT);null!=s&&parseFloat(s)>0&&(l/=parseFloat(s));let h=l/t;for(let o=0;o<t;o++){let u=this.PstDocGrid.NewRow();u.FromDate=this.oparent.StartDate.Date.AddYears(o).ToString(d.d.SessionManager.Preferences["Date Format"]),u.FromDate_Key=this.oparent.StartDate.Date.AddYears(o),o==t-1?(u.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),u.ToDate_Key=this.oparent.EndDate.Date):(u.ToDate=this.oparent.StartDate.Date.AddYears(o+1).AddDays(-1).ToString(d.d.SessionManager.Preferences["Date Format"]),u.ToDate_Key=this.oparent.StartDate.Date.AddYears(o+1).AddDays(-1)),u.Unit_key=i[0].UnitID.toString(),e.J0.IsEmpty(i[0].RENT)||(u.Amount=h.ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),u.Rate=(parseFloat(u.Amount)/parseFloat(i[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),u.Discount=0,u.ActAmount=u.Amount.toString(),u.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(u)}}}else if("1"==this.Filter.SelectedValue){let a=parseFloat(this.selectedrow.Amount.toString());if(a.ToString("N2")==parseFloat(s).ToString("N2"))for(let i=0;i<n.length;i++){let l=this.PstDocGrid.NewRow();l.FromDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),l.FromDate_Key=this.oparent.StartDate.Date,l.ToDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),l.ToDate_Key=this.oparent.StartDate.Date;let h=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(h=this.oparent.dsPart.Tables[5].filter(o=>o.UnitID==n[i])),null!=h&&h.length>0&&(l.Unit_key=h[0].UnitID.toString(),e.J0.IsEmpty(h[0].RENT)||(l.Amount=parseFloat(h[0].RENT).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),l.Rate=(parseFloat(l.Amount)/parseFloat(h[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),l.Discount=0,l.ActAmount=l.Amount.toString()),l.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(l)}else for(let i=0;i<n.length;i++){let l=this.PstDocGrid.NewRow();l.FromDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),l.FromDate_Key=this.oparent.StartDate.Date,l.ToDate=this.oparent.StartDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),l.ToDate_Key=this.oparent.StartDate.Date;let h=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(h=this.oparent.dsPart.Tables[5].filter(o=>o.UnitID==n[i])),null!=h&&h.length>0&&(l.Unit_key=h[0].UnitID.toString(),e.J0.IsEmpty(h[0].RENT)||(l.Amount=null!=s?(a*parseFloat(h[0].RENT)/parseFloat(s)).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()):(a*parseFloat(h[0].RENT)).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString()),l.Rate=(parseFloat(l.Amount)/parseFloat(h[0].RentableArea.toString())).ToString("N"+d.d.SessionManager.Preferences.DecimalsinAmount.toString())),l.Discount=0,l.ActAmount=l.Amount.toString()),l.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(l)}}else if("2"==this.Filter.SelectedValue)for(let a=0;a<t;a++){let i=this.PstDocGrid.NewRow();i.FromDate=this.oparent.StartDate.Date.AddYears(a).ToString(d.d.SessionManager.Preferences["Date Format"]),i.FromDate_Key=this.oparent.StartDate.Date.AddYears(a),a==t-1?(i.ToDate=this.oparent.EndDate.Date.ToString(d.d.SessionManager.Preferences["Date Format"]),i.ToDate_Key=this.oparent.EndDate.Date):(i.ToDate=this.oparent.StartDate.Date.AddYears(a+1).AddDays(-1).ToString(d.d.SessionManager.Preferences["Date Format"]),i.ToDate_Key=this.oparent.StartDate.Date.AddYears(a+1).AddDays(-1)),i.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(i)}this.PstDocGrid.Columns[3].IsVisible&&(this.PstDocGrid.RefreshGrid=!0);for(let a=0;a<5;a++){let i=this.PstDocGrid.NewRow();i.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(i)}}}SearchGrid(){if(e.J0.IsEmpty(this.SearchText))return;let s="";if(""!=this.SearchCols.SelectedValue)s=this.SearchCols.SelectedValue;else{if(!(this.SearchCols.Items.length>0))return;s=this.SearchCols.Items[0].Value}if(!this.PstDocGridTableColumns.Contains(s))return;let n=this.PstDocGrid.SelectedIndex;-1==n&&(n=0);for(let t=0;t<this.PstDocGrid.Table.length;t++)if(n<this.PstDocGrid.Table.length-1?n++:n=0,!e.J0.IsEmpty(this.PstDocGrid.Table[n][s]))switch(this.Options.SelectedValue){case"1":if(this.PstDocGrid.Table[n][s].toString().toLowerCase()==this.SearchText.toLowerCase())return void this.Setselectedrow(n);break;case"2":if(this.PstDocGrid.Table[n][s].toString().toLowerCase()!=this.SearchText.toLowerCase())return void this.Setselectedrow(n);break;case"3":if(this.PstDocGrid.Table[n][s].toString().toLowerCase().startsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(n);break;case"4":if(this.PstDocGrid.Table[n][s].toString().toLowerCase().endsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(n);break;case"5":if(this.PstDocGrid.Table[n][s].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(n);break;case"6":if(!this.PstDocGrid.Table[n][s].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(n)}}Setselectedrow(s){this.PstDocGrid.SelectedItem=this.PstDocGrid.Table[s]}}}}]);