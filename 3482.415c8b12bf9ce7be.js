"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3482],{3482:(Ft,st,oe)=>{oe.r(st),oe.d(st,{DimDefinition:()=>It,ImportTemplates:()=>wt,ImportUtilityViewModel:()=>fi,MimizField:()=>Pe,StringBuilderLike:()=>Be});var Le=oe(10467),I=oe(86739),N=oe(8787),B=oe(32647),Tt=oe(23823),se=oe(92701),k=oe(31820),mt=oe(49710),ct=oe(18569),jt=oe(48792),xe=oe(92840),ft=oe(91679),lt=oe(20141),He=oe(95707),Kt=oe(98669),Et=oe(36466),Jt=oe(8585),ot=oe(81669),et=oe(62288),At=oe(71336),Ue=oe(62460),gt=(oe(24028),oe(33547)),xt=oe(97965),Ct=oe(39559),Qt=oe(92020),Dt=oe(67559),Vt=oe(93621),Ht=oe(26485),Rt=oe(35901),Wt=oe(73334),$t=oe(40008),Yt=oe(50742);class Zt{constructor(){this.RulesListVisible=!1,this.RulesList=[],this.NotesList=[],this.ConfirmList=[],this.NewInfo=[],this.ErrorList=[],this.ButtonClick=new ot.Yk,this.ColumnSource=[]}PreviewDataViewModel(e,s){if(this.Parent=s,this.Parent.IsScaned){if(this.TempExcelTableVisible=!1,this.Parent.NotesList.length>0){this.NotesListVisible=!0;let u,i=0;this.Parent.NotesList.forEach(h=>{u=new xe.AddNoteViewModel,u.AddNoteViewModel_1(this),u.NoteID=i+1,u.Note.Text=h.Note.Text,u.Note.ToolTipDescription=h.Note.ToolTipDescription,u.Note.Label=h.Note.Label,u.IsModified=!0,this.NotesList.push(u)})}else this.NotesListVisible=!1;this.Parent.RulesList.length>0?(this.RulesList=this.Parent.RulesList,this.RulesListVisible=!0):this.RulesListVisible=!1,this.Parent.ErrorList.length>0?(this.ErrorList=this.Parent.ErrorList,this.ErrorListVisible=!0,this.NextEnable=!1):this.NextEnable=!0,this.Title="Confirmation",this.btnOkText="Confirm"}else this.NotesListVisible=!1,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.TempExcelTableVisible=!0,this.Title="Excel Data",this.btnOkText="Ok";let l;this.DS=[],this.ColumnSource=[],this.CostCenterFields=[],this.DS=s.grData,this.CostCenterFields=s.CostCenterFields?s.CostCenterFields:s.CostCenterFieldsAllTables,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.AddColumns(e),this.TempExcelTable=this.ValidateExcelData(e),l="",this.TempExcelTable.forEach(i=>{l+=`[${i}] is null and `}),l.length>5&&(l=l.substring(0,l.length-5)),this.NoofRows="Total No. of Rows in file are "+l.length+"|"+this.TempExcelTable.length}AddColumns(e){this.TempExcelTable=[],e&&0!=e.length&&Object.keys(e[0]).forEach(l=>{let i=new Yt.i;i.DisplayMember=l,i.HeaderText=l,i.width=l.includes("_Key")?"0":"100",this.ColumnSource.push(i),this.TempExcelTable.push(l)})}ValidateExcelData(e){let s=[];return s=this.CostCenterFields.Tables[0],e.forEach(l=>{this.DS._Table.forEach(i=>{if(null==i.FeatureFieldName||""==i.FeatureFieldName.toString()||"0"==i.FeatureFieldName.toString())return;let h,u=s.filter(t=>t.CostCenterColID=i.FeatureFieldName.toString());switch(h="",u.length>0&&(N.J0.IsEmpty(u[0].ColumnDataType)||(h=u[0].ColumnDataType.toString()),("INT"==h.toUpperCase()&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0||"INT"==h.toUpperCase()&&("AccountTypeID"==u[0].SysColumnName.toString()||"ProductTypeID"==u[0].SysColumnName.toString()))&&(h="TEXT")),h.toUpperCase()){case"INT":""!=l[i[0].toString()].toString()&&null!=l[i[0].toString()]&&""!=l[i[0].toString()].toString()&&N.J0.ValidateInt(l[i[0].toString()].toString())&&(l[i[0].toString()]="Error"),e.AcceptChanges();break;case"DATE":""!=l[i[0].toString()].toString()&&null!=l[i[0].toString()]&&""!=l[i[0].toString()].toString()&&N.J0.isValidDate(l[i[0].toString()].toString())&&(l[i[0].toString()]="Error"),e.AcceptChanges();break;case"FLOAT":""!=l[i[0].toString()].toString()&&null!=l[i[0].toString()]&&""!=l[i[0].toString()].toString()&&N.J0.ValidateDouble(l[i[0].toString()].toString())&&(l[i[0].toString()]="Error"),e.AcceptChanges();break;case"COMBOBOX":parseInt(this.Parent.Feature.SelectedValue.toString())>4e4&&parseInt(this.Parent.Feature.SelectedValue.toString())<5e4&&"VoucherNo"==s[0].SysColumnName.toString()&&""!=l[i[0].toString()].toString()&&null!=l[i[0].toString()]&&(N.J0.ValidateInt(l[i[0].toString()].toString())||(l[i[0].toString()]="NA")),e.AcceptChanges();break;case"LISTBOX":N.J0.IsNum(l[i[0].toString()+"_Key"])&&(l[i[0].toString()]="NA"),e.AcceptChanges()}})}),e}OnButtonClick(e){if(this.Parent.IsPreviewDataOk=!1,"Cancel"==e.toString())this.Parent.IsScaned&&(this.Parent.IsScaned=!1),I.d.page.HideDialog(this.PopUpGUID);else if("Confirm"==e.toString()){let s;s=new xe.AddNoteViewModel,s.NoteID=0,s.Note.Text="Total no. of Rows: "+this.Parent.ExcelTable.length,this.ConfirmList.push(s),this.btnOkText="Next",this.NextEnable=!0,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!1,this.ConfirmListVisible=!0,s=new xe.AddNoteViewModel,s.NoteID=0;for(let i of this.NotesList){s=new xe.AddNoteViewModel,s.NoteID=0;let u=i.Note.ToolTipDescription.split(",");if(this.Parent.ExcelTable.Columns.Contains(i.Note.Label)){this.Parent.ExcelTable.Columns.Contains("IsDeleted")||this.Parent.ExcelTable.Columns.push("IsDeleted");let h=0;for(let t in u)if(""!=t.toString()){let o=this.Parent.ExcelTable.filter(r=>r.item.Note.Label==t.split("~")[0].toString().Replace("'","''"));if(o.length>0)for(let r in o)i.IsModified||(r.IsDeleted=!0),h++}s.Note.Text=i.IsModified?"New rows for "+i.Note.Label+", Count :"+h:"Removed rows for "+i.Note.Label+", Count :"+h,s.NoteID=h,s.Note.Label=i.Note.Label,this.ConfirmList.push(s),this.Parent.ExcelTable.AcceptChanges()}}s=new xe.AddNoteViewModel,s.NoteID=0;let l=0;this.Parent.ExcelDataColumn.includes("IsDeleted")&&(l=this.Parent.ExcelTable.Select("IsDeleted='true'").length),s.Note.Text="Number of total rows deleted, count :"+l,this.ConfirmList.push(s)}else if("View"==e.toString()){if(null!=this._SelectedNote){let s;if(""!=this.SelectedNote.Note.ToolTipDescription){this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!0;let l=[],i=this.SelectedNote.Note.ToolTipDescription.split(",");for(let u=0;u<i.length;u++)""!=i[u].toString()&&(s=new xe.AddNoteViewModel,s.NoteID=0,s.Note.Label=i[u].toString().substring(i[u].lastIndexOf("~")+1).toString(),s.Note.Text=i[u].toString().substring(0,i[u].lastIndexOf("~")),l.push(s))}}}else if("BackInfo"==e.toString())this.RulesList.length>0&&(this.RulesListVisible=!0),this.ErrorList.length>0&&(this.ErrorListVisible=!0),this.NotesList.length>0&&(this.NotesListVisible=!0),this.NewInfoVisible=!1;else try{this.Parent.IsScaned&&(this.Parent.IsPreviewDataOk=!0,this.Parent.NotesList=this.NotesList,I.d.page.HideDialog(this.PopUpGUID))}catch{}}}var Pt=oe(21580),qt=oe(27630),bt=oe(91229),D=oe(54438),Lt=oe(60177),Nt=oe(89417),zt=oe(99246),ei=oe(73955);function ti(z,e){if(1&z&&(D.qex(0),D.EFF(1,"\n                            "),D.j41(2,"div",16),D.EFF(3,"\n                                "),D.j41(4,"span",17),D.EFF(5),D.k0s(),D.EFF(6,"\n                            "),D.k0s(),D.EFF(7,"\n                        "),D.bVm()),2&z){const s=e.$implicit;D.R7$(5),D.JRh(s.HeaderText)}}function ii(z,e){if(1&z&&(D.qex(0),D.EFF(1,"\n                                    "),D.j41(2,"div",22),D.EFF(3),D.k0s(),D.EFF(4,"\n                                "),D.bVm()),2&z){const s=e.$implicit,l=D.XpG().$implicit;D.R7$(3),D.SpI("\n                                        ",l[s.DisplayMember],"\n                                    ")}}function si(z,e){if(1&z){const s=D.RV6();D.j41(0,"div",20),D.bIt("click",function(i){const u=D.eBV(s).$implicit,h=D.XpG(3);return D.Njj(h.OnListItemClick(i,u))}),D.EFF(1,"\n                            "),D.j41(2,"div",21),D.EFF(3,"\n                                "),D.DNE(4,ii,5,1,"ng-container",14),D.EFF(5,"\n                            "),D.k0s(),D.EFF(6,"\n                        "),D.k0s()}if(2&z){const s=D.XpG(3);D.R7$(4),D.Y8G("ngForOf",s.obj.ColumnSource)}}function ai(z,e){if(1&z&&(D.j41(0,"div",18),D.EFF(1,"\n                        "),D.DNE(2,si,7,1,"div",19),D.EFF(3,"\n                    "),D.k0s()),2&z){const s=D.XpG(2);D.R7$(2),D.Y8G("ngForOf",s.obj.TempExcelTable)}}function li(z,e){if(1&z&&(D.j41(0,"div",10),D.EFF(1,"\n            "),D.j41(2,"div",11),D.EFF(3,"\n                "),D.j41(4,"div",12),D.EFF(5,"\n                    "),D.j41(6,"div",13),D.EFF(7,"\n                        "),D.DNE(8,ti,8,1,"ng-container",14),D.EFF(9,"\n                    "),D.k0s(),D.EFF(10,"\n                    "),D.DNE(11,ai,4,1,"div",15),D.EFF(12,"\n                "),D.k0s(),D.EFF(13,"\n            "),D.k0s(),D.EFF(14,"\n        "),D.k0s()),2&z){const s=D.XpG();D.R7$(2),D.AVh("List__dropdown--open",s.suggestionsIsOpen),D.R7$(6),D.Y8G("ngForOf",s.obj.ColumnSource),D.R7$(3),D.Y8G("ngIf",null!=s.obj.TempExcelTable)}}function oi(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s)}}function ri(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,oi,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const s=D.XpG();D.R7$(24),D.Y8G("ngForOf",s.obj.ColumnSource)}}function ni(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s.Note.Text)}}function ui(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,ni,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const s=D.XpG();D.R7$(24),D.Y8G("ngForOf",s.obj.ErrorList)}}function hi(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s.Note.Text)}}function di(z,e){if(1&z){const s=D.RV6();D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                       \n                        "),D.j41(15,"tr"),D.EFF(16,"\n                            "),D.j41(17,"div",29),D.EFF(18,"\n                                "),D.j41(19,"div",30),D.EFF(20,"\n                                    "),D.j41(21,"input",31),D.mxI("ngModelChange",function(i){D.eBV(s);const u=D.XpG();return D.DH7(u.obj.IsModified,i)||(u.obj.IsModified=i),D.Njj(i)}),D.k0s(),D.EFF(22,"\n                                    "),D.EFF(23,"\n                                "),D.k0s(),D.EFF(24,"\n                                "),D.EFF(25,"\n                            "),D.k0s(),D.EFF(26,"\n                        "),D.k0s(),D.EFF(27,"\n                            "),D.EFF(28,"\n                           \n                        \n                    "),D.k0s(),D.EFF(29,"\n                "),D.k0s(),D.EFF(30,"\n            "),D.k0s(),D.EFF(31,"\n            "),D.j41(32,"div",26),D.EFF(33,"\n                "),D.j41(34,"table",25),D.EFF(35,"\n                    "),D.j41(36,"tbody"),D.EFF(37,"\n                        "),D.DNE(38,hi,6,2,"tr",27),D.EFF(39,"\n                    "),D.k0s(),D.EFF(40,"\n                "),D.k0s(),D.EFF(41,"\n            "),D.k0s(),D.EFF(42,"\n        "),D.k0s()}if(2&z){const s=D.XpG();D.R7$(21),D.R50("ngModel",s.obj.IsModified),D.R7$(17),D.Y8G("ngForOf",s.obj.NotesListVisible)}}function mi(z,e){if(1&z){const s=D.RV6();D.j41(0,"button",33),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(s);const i=D.XpG(2);return D.Njj(i.ButtonClick("BackInfo"))}),D.nrm(2,"i",34),D.EFF(3,"\n    "),D.k0s()}2&z&&D.FS9("title",D.bMT(1,1,"Back"))}function ci(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                            "),D.j41(6,"td"),D.EFF(7),D.k0s(),D.EFF(8,"\n\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s.Label),D.R7$(3),D.JRh(s.Note.Text)}}function gi(z,e){if(1&z){const s=D.RV6();D.j41(0,"div",23),D.EFF(1,"\n\n            "),D.DNE(2,mi,4,3,"button",32),D.EFF(3,"\n            "),D.j41(4,"div",24),D.EFF(5,"\n                "),D.j41(6,"table",25),D.EFF(7,"\n                    "),D.j41(8,"thead"),D.EFF(9,"\n                        "),D.j41(10,"tr"),D.EFF(11,"\n                            "),D.EFF(12,"\n                            "),D.j41(13,"th"),D.EFF(14,"NewInfo"),D.k0s(),D.EFF(15,"\n                        "),D.k0s(),D.EFF(16,"\n                        "),D.j41(17,"tr"),D.EFF(18,"\n                            "),D.j41(19,"div",29),D.EFF(20,"\n                                "),D.j41(21,"div",30),D.EFF(22,"\n                                    "),D.j41(23,"input",31),D.mxI("ngModelChange",function(i){D.eBV(s);const u=D.XpG();return D.DH7(u.obj.IsModified,i)||(u.obj.IsModified=i),D.Njj(i)}),D.k0s(),D.EFF(24,"\n                                    "),D.EFF(25,"\n                                "),D.k0s(),D.EFF(26,"\n                                "),D.EFF(27,"\n                            "),D.k0s(),D.EFF(28,"\n                        "),D.k0s(),D.EFF(29,"\n                            "),D.EFF(30,"\n                           \n                       \n                    "),D.k0s(),D.EFF(31,"\n                "),D.k0s(),D.EFF(32,"\n            "),D.k0s(),D.EFF(33,"\n            "),D.j41(34,"div",26),D.EFF(35,"\n                "),D.j41(36,"table",25),D.EFF(37,"\n                    "),D.j41(38,"tbody"),D.EFF(39,"\n                        "),D.DNE(40,ci,9,3,"tr",27),D.EFF(41,"\n                    "),D.k0s(),D.EFF(42,"\n                "),D.k0s(),D.EFF(43,"\n            "),D.k0s(),D.EFF(44,"\n        "),D.k0s()}if(2&z){const s=D.XpG();D.R7$(2),D.Y8G("ngIf",s.obj.IsDynamicTree),D.R7$(21),D.R50("ngModel",s.obj.IsModified),D.R7$(17),D.Y8G("ngForOf",s.obj.NewInfo)}}function Ci(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s.Note.Text)}}function Di(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,Ci,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const s=D.XpG();D.R7$(24),D.Y8G("ngForOf",s.obj.RulesList)}}function Si(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const s=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(s.Note.Text)}}function pi(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,Si,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const s=D.XpG();D.R7$(24),D.Y8G("ngForOf",s.obj.ConfirmList)}}let Ti=(()=>{class z{ngOnInit(){console.log("ObjPReview",this.obj),console.log("params",this.params)}OnListItemClick(s,l){}static#e=this.\u0275fac=function(l){return new(l||z)};static#t=this.\u0275cmp=D.VBU({type:z,selectors:[["app-preview-data"]],decls:36,vars:10,consts:[[1,"master-screen",2,"padding-bottom","4px","max-width","600px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],["style","display: flex;flex-direction: column;",4,"ngIf"],["class","PACT_Table",4,"ngIf"],[1,"input_cntrl_label"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"display","flex","flex-direction","column"],["DropUp","",1,"List__dropdown","List__dropdown--suggestions","suggestions"],[1,"suggestions__group"],[1,"suggestions__group-Header",2,"display","flex"],[4,"ngFor","ngForOf"],["class","suggestions__group-content",4,"ngIf"],[1,"suggestions__group-column",2,"width","120px"],[2,"text-overflow","ellipsis"],[1,"suggestions__group-content"],["class","suggestions__item suggestions__list",3,"click",4,"ngFor","ngForOf"],[1,"suggestions__item","suggestions__list",3,"click"],[1,"suggestions__list-info",2,"display","flex"],[1,"suggestions__list-name",2,"width","120px"],[1,"PACT_Table"],[1,"tbl-header"],["cellpadding","0","cellspacing","0","border","0"],[1,"tbl-content"],["class","tbl-row",4,"ngFor","ngForOf"],[1,"tbl-row"],[1,"div-import-item"],[1,"form-group","col-xl-6","col-md-6","col-sm-6","col-xs-12","divChk"],["type","checkbox",1,"input_checkbox",3,"ngModelChange","ngModel"],["class","secondary-btn-wicon",3,"title","click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click","title"],[1,"fa-light","fa-search"]],template:function(l,i){1&l&&(D.j41(0,"div",0),D.EFF(1,"\n    "),D.j41(2,"div",1),D.EFF(3,"\n        "),D.DNE(4,li,15,4,"div",2),D.EFF(5,"\n        "),D.DNE(6,ri,29,1,"div",3),D.EFF(7,"\n\n\n\n\n        "),D.DNE(8,ui,29,1,"div",3),D.EFF(9,"\n        "),D.DNE(10,di,43,2,"div",3),D.EFF(11,"\n        "),D.DNE(12,gi,45,3,"div",3),D.EFF(13,"\n\n\n        "),D.DNE(14,Di,29,1,"div",3),D.EFF(15,"\n\n        \n       \n\n        "),D.DNE(16,pi,29,1,"div",3),D.EFF(17,"\n       \n       \n       \n\n        "),D.j41(18,"label",4),D.EFF(19),D.k0s(),D.EFF(20,"\n    "),D.k0s(),D.EFF(21,"\n    "),D.j41(22,"div",5),D.EFF(23,"\n        "),D.j41(24,"div"),D.EFF(25,"\n            "),D.j41(26,"button",6),D.bIt("click",function(){return i.obj.ButtonClick.Call(i.obj.btnOkText)}),D.nrm(27,"i",7),D.EFF(28),D.k0s(),D.EFF(29,"\n            "),D.j41(30,"button",8),D.bIt("click",function(){return i.obj.ButtonClick.Call("Cancel")}),D.nrm(31,"i",9),D.EFF(32),D.k0s(),D.EFF(33,"\n        "),D.k0s(),D.EFF(34,"\n    "),D.k0s(),D.EFF(35,"\n"),D.k0s()),2&l&&(D.R7$(4),D.Y8G("ngIf",i.obj.TempExcelTableVisible),D.R7$(2),D.Y8G("ngIf",i.obj.TempExcelTableVisible),D.R7$(2),D.Y8G("ngIf",i.obj.ErrorListVisible),D.R7$(2),D.Y8G("ngIf",i.obj.NotesListVisible),D.R7$(2),D.Y8G("ngIf",i.obj.NewInfoVisible),D.R7$(2),D.Y8G("ngIf",i.obj.RulesListVisible),D.R7$(2),D.Y8G("ngIf",i.obj.ConfirmListVisible),D.R7$(3),D.JRh(i.obj.NoofRows),D.R7$(9),D.JRh(i.obj.btnOkText),D.R7$(4),D.JRh("Cancel"))},dependencies:[Lt.Sq,Lt.bT,Nt.Zm,Nt.BC,Nt.vS,zt.k,ei.D9]})}return z})();class Pe{constructor(e,s){this.fName=e,this.fResult=s}setFieldValue(e){this.fResult=e}}class Be{constructor(){this.parts=[]}append(e){return this.parts.push(String(e)),this}toString(){return this.parts.join("")}clear(){this.parts=[]}}class fi extends Tt.g{get DtImport(){return this.grData.Table}set DtImport(e){this.grData.Table=e}get ImportCols(){return this.grData.Columns}set ImportCols(e){this.grData.Columns=e}get DataTable(){return this.DataTableObj.Table}constructor(e,s){super(),this.ds=null,this.obj=new jt.Document,this.oProduct=new xt.c,this.oFile=new N.n_,this.Name=new k.Dw(0),this.Profile=new se.y$(0),this.Dimensions=new se.y$(0),this.IsSaveDocValidate=!1,this.dtValue=new Date,this.strHistoryMsg="",this.LocRemarks="",this.DeptRemarks="",this.DesgRemarks="",this.EDate=new Date,this.totEarnings=0,this.totDeductions=0,this.ReportViewModel=null,this.columnexist=!1,this.colcode="",this.colname="",this.code="",this.name="",this.codecolnum=0,this.namecolnum=0,this.excelview=[],this.oChart=new ft.T,this.timespan=0,this.userCreate=new qt.PropertyRoleUser,this.grData=new mt.vv,this._DocumentType=0,this.IsExcel=!0,this.IsScaned=!1,this.IsPreviewDataOk=!1,this.GroupExists=!1,this.EmpGrade=1,this.IDHistoryMessage="",this.ErrorMessage="",this.drSel=null,this.NotesList=[],this.ErrorList=[],this.RulesList=[],this.CostCenterFieldsAllTables={},this.CodeDef=[],this.dtPayrollE=[],this.dtPayrollD=[],this.costCenterTableZero=[],this.QtyFldName="",this.GrssFldName="",this.BinDimFieldName="",this.DonotUpdateInventory=!0,this.GradeRemarks="",this.DataTableObj=new mt.vv,this.lstContactFields=[],this.lstAddressFields=[],this.xDocCodeDef=new N.VB,this.Administration={},this.objAsset=new lt.V,this.temp=[],this.lookuptemp=[],this.CCQuery=[],this.CCQueryData=new se.y$(0),this.lookupQuery=[],this.ccdv=[],this.lookupdv=[],this.COls=[],this.catSub=new He.bT,this.partCat=new He.bT,this.BankAccounts=new Kt.y$(0),this.BatchCode=new k.s3(27184),this.WithoutExcel=!1,this.FailedRecourdList=[],this.ImportingMessage="Importing Data Please Wait....",this.ScreenObject=null,this.ActualFileName="",this.ColumnSource=[],this.FeatureVisibility=!0,this.ImportVisbility=!0,this.BulkVisible=!1,this.ProgressValue=0,this.ProgressMax=0,this.ShowBarcodeDimension=!1,this.BarcodeDim=0,this.QtyText=new k.Dw(0),this.RateText=new k.Dw(0),this.ProfileName=new k.Dw(0),this.Feature=new se.y$(0),this.UpdateBasedOn=new se.y$(0),this.fldDict=new He.bT,this.QtyCombo=new se.y$(0),this.RateCombo=new se.y$(0),this.RefreshGrid=!1,this.IsDuplicateNameAllowed=!1,this.DoNotCreateCCVisibility=!1,this.UpdateBasedOnVisibility=!1,this.DoNotCreateCostCenter=!1,this.IsAvgRateChecked=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.IsQtyChecked=!1,this.IsRateChecked=!1,this.IsProductwiseBarcode=!1,this.IsAutoCodeGen=!1,this.ValidateBeforeImport=!0,this.UpdateStatusInExcel=!0,this.AppendData=!1,this.AppendVisible=!1,this.FillLocalReference=!1,this.FillLocRefVisibility=!1,this.IsCode=!1,this.BulkSave=!1,this.PartialSave=!1,this.IsPreview=!1,this.IsUpdate=!1,this.VerifyVisible=!1,this.ValidateVisible=!1,this.IsSnoBasedLinking=!1,this.GridEnable=!1,this.NameSameasCode=!1,this.lblTitle="",this.ButtonOpen=new Et.v,this.ButtonSave=new Et.v,this.EmpCode=new k.s3(0),this.DocItems=new se.v4,this.TemplateGrid=new mt.vv,this.ProductTypeID=0,this.IgnoreBatch=0,this.Date=new Date,this.YearMonth=this.Date.getFullYear().toString()+this.Date.toLocaleDateString("default",{month:"short"}),this.ProfileID=0,this.Browsefile=new ot.Yk,this.ExportFile=new ot.Yk,this.ImportData=new ot.Yk,this.SaveFile=new ot.Yk,this.ControlGen=new gt.ControlGenerator,this.objCG=new gt.ControlGenerator,this.objEmpEss=new Qt.r,this.PosRegisterField="",this.PosShiftField="",this.PosRegisterDim=0,this.PosShiftDim=0,this.DocNumberField="",this.DocPrefixField="",this.VoucherNoField="",this.DocDateField="",this.FreeQtyField="",this.QtyField="",this.RateField="",this.GrossField="",this.UnitFieldName="",this.ProductFieldName="",this.CrAccFieldName="",this.DrAccFieldName="",this.ExhgRateFieldName="",this.CurrencyFieldName="",this.IsDrFieldCode=!1,this.IsCrFieldCode=!1,this.isAvgrate=!1,this.isCreditRowAdded=!1,this.isDebitRowAdded=!1,this._SelectedValue="",this._FeatureSelectedValue=null,this.eval=new At.PE,this.VoucherType=0,this.strSerial=[],this.dttemp=[],this.tempfield="",this.dvMain=[],this.GroupsImport=!1,this.GroupTotCount=0,this.GroupfailCount=0,this.budgetInput=[],this.budgetTable=[],this.DataCollection=new Vt.t,this.BudgetType=0,this.CCPropertySales=[],this.CCPropertyAccntn=[],this.CCPropertyLandlord=[],this.CCNodeDet=[],this.dsCCPropS=[],this.CCSalesNodeid="0",this.CCAccNodeid="0",this.CCLndNodeid="0",this.Previewinfo="",this.Uomsb="",this.UomCol="",this.batchnumberfield="",this.bcodefield="",this.mfgdatefield="",this.expdatefield="",this.productidfield="",this.sbQuery="",this.UpdateColumns="",this.lstDuplicate=[],this.dblTotalHours=0,this.isEdit=!1,this.IsLoad=!1,this.FileName="",this.ExcelDataColumn=[],this.ProfileName.Label="Profile Name",this.Feature.Label="Feature",this.ProfileID=e,Logger.InfoLog("ImportViewModel::Entering ImportViewModel"),this.BankAccounts.Visible=!1,this.TemplateGrid.Visible=!1,this.QtyCombo.Visible=!1,this.YearMonth="",this.loadFeatures(s),this.grData.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}loadFeatures(e){const s=I.d.document.GetFeaturesList();if(I.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==I.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.YearMonth=""),this.Feature.Items.Clear(),s&&s.Tables){for(let h=0;h<s.Tables[0].length;h++)251==N.J0.Int(s.Tables[0][h].FeatureID)||252==N.J0.Int(s.Tables[0][h].FeatureID)||253==N.J0.Int(s.Tables[0][h].FeatureID)||254==N.J0.Int(s.Tables[0][h].FeatureID)||255==N.J0.Int(s.Tables[0][h].FeatureID)?this.Feature.Items.push(se._p.ComboBoxItems_4("Payroll "+s.Tables[0][h].Name.toString(),s.Tables[0][h].FeatureID.toString(),null,`${s.Tables[0][h].FeatureID.toString()}_${"Payroll "+s.Tables[0][h].Name.toString()}`)):this.Feature.Items.push(se._p.ComboBoxItems_4(s.Tables[0][h].Name.toString(),s.Tables[0][h].FeatureID.toString(),null,`${s.Tables[0][h].FeatureID.toString()}_${s.Tables[0][h].Name.toString()}`));this.Feature.Items.push(se._p.ComboBoxItems_4("Attachments","-100","","Attachments_-100"))}let l,i,u;e?(this.ButtonOpen.Visible=!1,this.ProfileName.Enable=!1,this.FeatureVisibility=!1,this.Feature.Enable=!1,this.GridEnable=!1):this.ButtonOpen.Visible=!(!I.d.SessionManager.IsActionAssigned(162,"Create")&&!I.d.SessionManager.IsActionAssigned(162,"Update")),this.ButtonSave.Visible=!!I.d.SessionManager.IsActionAssigned(162,"Update"),this.BankAccounts.CCID=2,this.BankAccounts.TypeID=2,this.BankAccounts.CustomWhere="AccountTypeID=2",this.UpdateBasedOn.Visible=!1,this.Browsefile.Subscribe(this,"OnBrowsefile"),this.ExportFile.Subscribe(this,"OnExportFile"),this.ImportData.Subscribe(this,"OnImportData"),this.SaveFile.Subscribe(this,"OnSave"),this.DisplayName=this.lblTitle,this.ButtonSave.ClickCommand.Subscribe(this,"OnSave"),i=[],this.grData.Clear(),this.grData.Columns=[],l=new ct.O7,l.DisplayMember="FieldName",l.Header=I.d.GetResource("Import_FieldName"),l.DataType="TextBlock",l.Width=100,l.ReadOnly=!0,l.DisableTab=!0,i.push(l),this.grData.TableColumns.push("FieldName"),l=new ct.O7,l.DisplayMember="ResourceData",l.ValueMember="CostCenterColID",l.ValueBinding="FeatureFieldName",l.Header=I.d.GetResource("Import_FeatureFieldName"),l.DataType="ComboBox",l.Width=200,l.DisableTab=!1,u=[],u.push(se._p.ComboBoxItems_2("","")),l.ComboData=u,i.push(l),this.grData.TableColumns.push("FeatureFieldName"),this.ImportCols=i,this.grData.Height=300,this.grData.Width="400",this.grData.addEmptyRow(),this.grData.refreshDataView(),0!=this.ProfileID&&(l.ReadOnly=!I.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Feature.Enable=I.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Import(this.ProfileID,e)),Logger.InfoLog("ImportViewModel::Exiting ImportViewModel")}OnKeyDown(e,s){console.log("eventD",e),!s.ctrlKey&&46==s.which&&"Delete"==s.key&&(console.log("Deleted calling "),this.grData.removeRowAt(e.row))}Import(e,s){if(e>0){const i=I.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){let u=new N.VB;u.LoadXml(i.Tables[0][0].Structure.toString()),null!=u&&u.DocumentElement.children[0].attributes[0].value.toString()}e>0&&(this.isEdit=!s)}}get FeatureSelectedValue(){return this._FeatureSelectedValue}set FeatureSelectedValue(e){this._FeatureSelectedValue!=e&&(this._FeatureSelectedValue=e)}OnChange(e){const s=e.target.value,l=this.Feature.Items.find(i=>i.Aliasname==s);this.Feature._SelectedValue=l?.Value||"",this.Feature.SelectedItem=l||null,this.OnSelectionChanged(this)}OnSelectionChanged(e){if(this.ValidateVisible=!1,null!=this.Feature.SelectedValue&&""!=this.Feature.SelectedValue){if(this.QtyCombo.Visible=!1,this.UpdateBasedOn.Visible=!1,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(se._p.ComboBoxItems_2("","")),this.VerifyVisible=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.CostCenterFieldsAllTables=I.d.document.GetFeaturesDetails(parseInt(this.Feature.SelectedValue),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),this.CostCenterFieldsAllTables?.Tables.length>0&&this.CostCenterFieldsAllTables.Columns[this.CostCenterFieldsAllTables.Columns.length-1].Contains("ErrorMessage"))return;let l=this.CostCenterFieldsAllTables.Tables[this.CostCenterFieldsAllTables.Tables.length-1];this.CodeDef=l&&l.length>0&&"PrefixContent"in l[0]?l:null,this.AppendVisible="101"==this.Feature.SelectedValue||"2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||N.J0.Int(this.Feature.SelectedValue)>5e4&&N.J0.Int(this.Feature.SelectedValue)<59999,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4||93==parseInt(this.Feature.SelectedValue)?(0==this.ProfileID&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&(this.DoNotCreateCostCenter=!0),this.FillLocRefVisibility=!0,this.DocItems.Items.Clear()):(this.FillLocRefVisibility=!1,this.FillLocalReference=!1,this.DoNotCreateCostCenter=!1),this.costCenterTableZero=this.CostCenterFieldsAllTables.Tables[0];let i={CostCenterColID:"-200",SysColumnName:"",ResourceData:""};const u=this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{},h=Object.keys(u);h.includes("CostcenterID")&&(i.CostcenterID=this.Feature.SelectedValue),h.includes("ColumnCostCenterID")&&(i.ColumnCostCenterID="0"),h.includes("IsColumninuse")&&(i.IsColumninuse="boolean"==typeof u.IsColumninuse||1),h.includes("IsColumninuse")&&(i.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),h.includes("ColumnDataType")&&(i.ColumnDataType="str"),this.costCenterTableZero.unshift(i),this.IsSnoBasedLinking=!1;const t=parseInt(this.Feature.SelectedValue);if(t>4e4&&t<5e4&&this.CostCenterFieldsAllTables.Tables.length>3&&this.CostCenterFieldsAllTables.Tables[3].length>0){let r=this.CostCenterFieldsAllTables.Tables[3].filter(m=>"SnoBasedLinking"===m.PrefName);if(r.length>0){const m=r[0].PrefValue;m.toString()!==String(!!m)&&(this.IsSnoBasedLinking=!0,this.costCenterTableZero.unshift({CostCenterColID:"-501",CostcenterID:this.Feature.SelectedValue,ColumnCostCenterID:"0",CostcenterName:null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:"Feature",SysColumnName:"RefSNo",ResourceData:"RefSNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}))}}if(99==t)this.costCenterTableZero.unshift({CostCenterColID:"0",SysColumnName:"",ResourceData:""});else if(null!=this.Feature.SelectedItem&&"Substitute Products"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"SubstituteGroup",ResourceData:"Substitute Group",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name||"Product With Services(Many-One)"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceCode",ResourceData:"Service Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Services to Dimension"==this.Feature.SelectedItem.Name){this.costCenterTableZero=[];let r=this.CostCenterFieldsAllTables.Tables[7];if(r.length>0){const m=r.filter(p=>"LinkedProductDimension"===p?.Name);let c=parseInt(m[0].CostcenterID);this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:c,CostcenterName:"Product",SysColumnName:"Dimension",ResourceData:"Dimension",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})}}else this.Feature.SelectedItem&&"Kit Products"==this.Feature.SelectedItem.Name?(this.costCenterTableZero=[],this.AddKitProductRows(this.costCenterTableZero)):this.Feature.SelectedItem&&"Product QC"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddQCProductRows(this.costCenterTableZero));if(73==t&&this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Product",SysColumnName:"CloseDate",ResourceData:"Close Date",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"DATE"}),114==t&&this.AddFollowupRows(this.costCenterTableZero),40054==t){let r,m=this.CostCenterFieldsAllTables;this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-300",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcCCNID51",ResourceData:"Employee Code*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push({CostCenterColID:"-301",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha5",ResourceData:"Days Attended*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.costCenterTableZero.push({CostCenterColID:"-302",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha9",ResourceData:"Absent(LOP) Days",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"});let p=this.dsEmpPayWithDate(1,I.d.SessionManager.PayrollMonth);p&&p.Tables&&p.Tables.length>0&&p.Tables[0].length>0&&p.Tables[0].filter(S=>[1,2,3,4].includes(+S.Type)).sort((S,F)=>{const y=+S.Type,C=+F.Type;return y==C?y-C:+S.SNo-+F.SNo}).forEach(S=>{const F={};F.CostCenterColID=S.CostCenterColID,F.CostcenterID=t,F.ColumnCostCenterID=S.Type,F.SysColumnName="dcNum"+S.SNo,F.ResourceData=S.ComponentName,F.IsColumninuse=!0,F.IsColumnUserDefined=!1,F.ColumnDataType="FLOAT","OverTime"==N.J0.String(S.FieldType)&&(F.CostCenterName=(F.CostCenterName||"")+"_OT"),this.costCenterTableZero.push(F)}),r=m.Tables[0].filter(T=>T.SysColumnName&&T.SysColumnName.startsWith("dcAlpha")),r&&r.length>0&&r.forEach(T=>{if(parseInt(T.SysColumnName.replace("dcAlpha",""),10)>50){const S={};S.CostCenterColID=T.CostCenterColID,S.CostcenterID=t,S.ColumnCostCenterID="6",S.SysColumnName=T.SysColumnName,S.ResourceData=T.ResourceData,S.IsColumninuse=T.IsColumninuse,S.IsColumnUserDefined=T.IsColumnUserDefined,S.ColumnDataType=T.ColumnDataType,this.costCenterTableZero.push(S)}})}else if(t>4e4&&t<5e4&&Object.keys(this.costCenterTableZero.includes("CostCenterColID"))){null!=this.ExcelTable&&this.FillQtyRateCombo(),this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocNumber",ResourceData:"Numeric Doc No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"INT"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocPrefix",ResourceData:"DocPrefix",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-3",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"BillWiseDocNo",ResourceData:"BillWise DocNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"BillWiseDocNo"}),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory?([{id:"-4",ColumnCC:"16",SysCol:"Batchno",Resource:"Batch No",DataType:"str"},{id:"-5",ColumnCC:"0",SysCol:"MfgDate",Resource:"Mfg Date",DataType:"DATE"},{id:"-6",ColumnCC:"0",SysCol:"ExpDate",Resource:"Exp Date",DataType:"DATE"},{id:"-26",ColumnCC:"0",SysCol:"BatchDocNo",Resource:"Batch DocNo",DataType:"str"},{id:"-25",ColumnCC:"0",SysCol:"AVGRATE",Resource:"AVGRATE",DataType:"FLOAT"},{id:"-28",ColumnCC:"0",SysCol:"AVGRATEVALUE",Resource:"AVGRATEVALUE",DataType:"FLOAT"},{id:"-29",ColumnCC:"0",SysCol:"BinCode",Resource:"Bin Code",DataType:"str"},{id:"-30",ColumnCC:"0",SysCol:"BinName",Resource:"Bin Name",DataType:"str"}].forEach(d=>{this.costCenterTableZero.push({CostCenterColID:d.id,CostcenterID:t,ColumnCostCenterID:d.ColumnCC,SysColumnName:d.SysCol,ResourceData:d.Resource,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:d.DataType})}),this.BulkVisible=!0):(this.BulkVisible=!1,this.BulkSave=!1);let n=[];n=this.CostCenterFieldsAllTables.Tables[3];let a=!1;if(n&&n.length>0){const T=n.filter(d=>"EnableSchemes"===d.PrefName);if(T.length>0){const d=T[0].PrefValue;a="true"===d||!0===d}}a&&this.costCenterTableZero.push({CostCenterColID:"-8",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"FreeQTY",ResourceData:"FreeQTY",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.CostCenterFieldsAllTables.Tables[2].length>0&&N.J0.Int(5==this.CostCenterFieldsAllTables.Tables[2][0].DocumentType)&&this.AddTransferFromToRows(this.CostCenterFieldsAllTables.Tables[0]),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory&&(this.costCenterTableZero.push({CostCenterColID:"-7",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNo",ResourceData:"Linking Ref No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNo"}),this.costCenterTableZero.push({CostCenterColID:"-77",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNoSNo",ResourceData:"Linking Ref No SNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNoSNo"}));let g=-9;const p=this.costCenterTableZero.filter(T=>{const d=String(T.SysColumnName||"").toLowerCase();return["debitaccount","creditaccount","AccountID"].includes(d)});for(let T of p){const d={CostCenterColID:g.toString(),CostcenterID:t,ColumnCostCenterID:"2",SysColumnName:T.SysColumnName+"Code",ResourceData:(T.ResourceData||"").replace("Name","")+"Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:T.ColumnDataType};this.costCenterTableZero.push(d),g--}this.VerifyVisible=!0}if(56==t){const r=this.costCenterTableZero;if(!r||0===r.length)return;const m=c=>{const n=r.findIndex(a=>String(a.SysColumnName||"").toLowerCase()===c.toLowerCase());-1!==n&&r.splice(n,1)};m("Status"),m("Attachment"),m("Location")}if(76==t&&"Bill Of Materials With Multiple Stage"!=this.Feature.SelectedItem.Name&&this.FillBomDetails(),93==t&&"Unit Rates"!=this.Feature.SelectedItem.Name&&this.FillUnitRates(),t>6e4&&(this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Name",ResourceData:"Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Default",ResourceData:"Default",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})),null!=this.Feature.SelectedItem&&"Unit Rates"!==this.Feature.SelectedItem.Name&&"Product QC"!==this.Feature.SelectedItem.Name&&"Services to Dimension"!==this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&this.AddContactsRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Services to Dimension"!=this.Feature.SelectedItem.Name&&"Kit Products"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Dimension Move"!=this.Feature.SelectedItem.Name&&"Document Edit"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&(this.AddCodeRows(this.costCenterTableZero),this.AddWEFRows(this.costCenterTableZero),this.AddGroupSeriesRows(this.costCenterTableZero)),2==t&&null!=this.Feature.SelectedItem&&"Account Report Template"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name||3==t&&null!=this.Feature.SelectedItem&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Products With Substitutes"!=this.Feature.SelectedItem.Name||83==t||72==t||73==t||86==t||89==t||115==t||251==t||251==t||252==t||253==t||254==t||255==t||110==t||92==t||93==t||t>5e4&&t<=50075&&null!=this.Feature.SelectedItem&&"Job Output"!=this.Feature.SelectedItem.Name){let r={CostCenterColID:"-100",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodePrefix",ResourceData:"Code Prefix",ColumnDataType:"TEXT"};const c=Object.keys(this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{});c.includes("IsColumninuse")&&(r.IsColumninuse="boolean"==typeof u.IsColumninuse||1),c.includes("IsColumninuse")&&(r.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(r);let n={CostCenterColID:"-101",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodeNumber",ResourceData:"Code Number",ColumnDataType:"INT"};c.includes("IsColumninuse")&&(r.IsColumninuse="boolean"==typeof u.IsColumninuse||1),c.includes("IsColumninuse")&&(r.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(n)}if(50051==t){this.UpdateBasedOn.Visible=!0,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(se._p.ComboBoxItems_2("",""));let r=this.costCenterTableZero.filter(n=>"1"===n.IsUnique||1===n.IsUnique);if(r&&r.length>0)for(let n=0;n<r.length;n++){const a=N.J0.String(r[n].UserColumnName),g=N.J0.String(r[n].SysColumnName);this.UpdateBasedOn.Items.push(se._p.ComboBoxItems_2(a,g))}[{CostCenterColID:"-17",SysColumnName:"Assigned_VacDaysPeriod",ResourceData:"Assigned_VacDaysPeriod",ColumnDataType:"TEXT"},{CostCenterColID:"-001",SysColumnName:"GradeFromDate",ResourceData:"GradeFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-002",SysColumnName:"LocFromDate",ResourceData:"LocFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-003",SysColumnName:"DeptFromDate",ResourceData:"DeptFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-004",SysColumnName:"DesgFromDate",ResourceData:"DesgFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-005",SysColumnName:"EffectFromDate",ResourceData:"EffectFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-006",SysColumnName:"ActAppraisalFrom",ResourceData:"ActAppraisalFrom",ColumnDataType:"DATE"},{CostCenterColID:"-007",SysColumnName:"NextAppraisalDate",ResourceData:"NextAppraisalDate",ColumnDataType:"DATE"},{CostCenterColID:"-008",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-009",SysColumnName:"LocRemarks",ResourceData:"LocRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-010",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-011",SysColumnName:"DesgRemarks",ResourceData:"DesgRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-013",SysColumnName:"AppraisalReason",ResourceData:"AppraisalReason",ColumnDataType:"TEXT"},{CostCenterColID:"-014",SysColumnName:"IdentityCountry",ResourceData:"IdentityCountry",ColumnDataType:"TEXT"},{CostCenterColID:"-015",SysColumnName:"IdentityIsDefault",ResourceData:"IdentityIsDefault",ColumnDataType:"TEXT"},{CostCenterColID:"-018",SysColumnName:"Percentage",ResourceData:"Percentage",ColumnDataType:"FLOAT"}].forEach(n=>{this.costCenterTableZero.push({CostCenterColID:n.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:n.SysColumnName,ResourceData:n.ResourceData,IsColumninuse:"true",IsColumnUserDefined:"true",ColumnDataType:n.ColumnDataType})});let c=this.dsEmpPay(1);if(null!=c&&c.Tables.length>0){let n=c.Tables[0]||[];if(n&&n.length>0){n.filter(a=>"EmployeeMaster"===a.FieldType);for(let a=0;a<n.length;a++){if(N.J0.String("1"==n[a].Type)){let p={CostCenterColID:N.J0.String(n[a].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Earnings_"+N.J0.String(n[a].ComponentName),ResourceData:"Earnings_"+N.J0.String(n[a].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(p)}else if(N.J0.String("2"==n[a].Type)){let p={CostCenterColID:N.J0.String(n[a].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Deductions_"+N.J0.String(n[a].ComponentName),ResourceData:"Deductions_"+N.J0.String(n[a].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(p)}n.filter(p=>["1","2","3"].includes(p.Type)).foreach(p=>{const T=p.Type.toString(),d=p.ComponentID,S=p.ComponentName;let F="",y="",C="",f="";"1"===T&&(F="DrAccEarnings_",y="CrAccEarnings_",C="-100",f="-101"),"2"===T&&(F="DrAccDeductions_",y="CrAccDeductions_",C="-200",f="-201"),"3"===T&&(F="DrAccLoans_",y="CrAccLoans_",C="-300",f="-301");const w={CostCenterColID:`${f}${d}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${S}`,ResourceData:`${y} ${S}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"};this.costCenterTableZero.push({CostCenterColID:`${C}${d}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${S}`,ResourceData:`${F} ${S}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push(w)})}}}}else 7==t?[{CostCenterColID:"-401",SysColumnName:"AccountTypes",ResourceData:"Account Types"},{CostCenterColID:"-402",SysColumnName:"ProductTypes",ResourceData:"Product Types"},{CostCenterColID:"-403",SysColumnName:"LicenseCount",ResourceData:"License Count"},{CostCenterColID:"-404",SysColumnName:"Online/Offline",ResourceData:"Online/Offline"},{CostCenterColID:"-405",SysColumnName:"2StepVerificationMode",ResourceData:"2-Step Verification Mode"},{CostCenterColID:"-406",SysColumnName:"Language",ResourceData:"Language"}].forEach(m=>{this.costCenterTableZero.push({CostCenterColID:m.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:m.SysColumnName,ResourceData:m.ResourceData,ColumnDataType:"TEXT"})}):101==t?(this.costCenterTableZero.push({CostCenterColID:"-001",ColumnCostCenterID:"0",ColumnDataType:"TEXT",SysColumnName:"CarryForward",ResourceData:"Carry Forward"}),this.costCenterTableZero.push({CostCenterColID:"-002",ColumnCostCenterID:"12",ColumnDataType:"INT",SysColumnName:"Currency",ResourceData:"Currency"}),this.costCenterTableZero.push({CostCenterColID:"-003",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExchangeRate",ResourceData:"Exchange Rate"})):-100==t&&(this.AddAttachemtnRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Products With Vendor Multiple Barcode"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddProductVendorWiseMultipleBarcodeRows(this.costCenterTableZero)));if(95==t&&this.AddContractRows(this.costCenterTableZero),83==t&&null!=this.Feature.SelectedItem&&"CRM Customer With Contacts"==this.Feature.SelectedItem.Name&&this.CostCenterFieldsAllTables.Tables.length>5){const r=this.CostCenterFieldsAllTables.Tables[0],m=this.CostCenterFieldsAllTables.Tables[5];if(Array.isArray(m)&&m.length>0){this.costCenterTableZero=[...r,...m];for(let c of m){const n=Number(c.CostCenterColID);isNaN(n)||this.lstContactFields.push(n)}}}const o=[...this.costCenterTableZero];o.sort((r,m)=>r.ResourceData.localeCompare(m.ResourceData)),this.ImportCols[1].ComboData=o,this.grData.RefreshColumns(),95===t&&this.ImportCols[1].ComboData.sort((r,m)=>r["ResourceData asc"].localeCompare(m["ResourceData asc"]));for(let r=0;r<this.grData.Table.length;r++)this.grData.Table[r][1]="0";this.RefreshGrid=!this.RefreshGrid,this.BankAccounts.Visible=70==t,this.DoNotCreateCCVisibility=!0,this.TemplateGrid=(new wt).BuildGrid(N.J0.Int(this.Feature.SelectedValue.toString()),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),t>4e4&&t<5e4&&Object.keys(this.CostCenterFieldsAllTables.length>0?this.CostCenterFieldsAllTables[2]:{}).includes("IsInventory")&&(this.ValidateVisible=!0)}}AddTransferFromToRows(e){const s=parseInt(this.Feature.SelectedValue);if(!e||0===e.length)return;let l=e.filter(i=>{const u=N.J0.Int(i.ColumnCostCenterID);return 2===u||3===u||u>=50001&&u<=50075});for(let i of l){const u=N.J0.Int(i.IsTransfer),h=N.J0.Int(i.ColumnCostCenterID);if(!isNaN(u)&&(h>5e3||u>0)){const t={CostCenterColID:-N.J0.Int(i.CostCenterColID),CostcenterID:s,ColumnCostCenterID:h,UserColumnName:"TO"+i.ResourceData,IsColumnUserDefined:"1",SysTableName:i.SysTableName,ColumnDataType:i.ColumnDataType,SysColumnName:i.SysColumnName,ResourceData:"TO"+i.ResourceData};i.ResourceData="From "+i.ResourceData,i.UserColumnName="From "+i.ResourceData,e.push(t)}}-1!==s&&this.costCenterTableZero.sort((i,u)=>i.ResourceData.localeCompare(u.ResourceData))}AddContactsRows(e){const s=parseInt(this.Feature.SelectedValue);if((2==s||3==s||83==s||86==s||89==s||15==s||s>5e4&&s<=50075)&&e.push({CostCenterColID:-16,ColumnCostCenterID:s,IsColumnUserDefined:1,SysTableName:"",ResourceData:"ParentGroupName",UserColumnName:"ParentGroupName",SysColumnName:"ParentGroupName"}),2==s&&"Account Report Template"!=this.Feature.SelectedItem.Name||83==s&&"CRM Customer With Address"==this.Feature.SelectedItem.Name||s>5e4&&s<=50075){let l=I.d.document.GetCostCenterScreenDetails(110);if(null==l)return;if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0)for(let i=0;i<l.Tables[0].length;i++){let u={};this.lstAddressFields.push(N.J0.StringIsNullOrEmpty(l.Tables[0][i].CostCenterColID.toString())?0:N.J0.Int(l.Tables[0][i].CostCenterColID)),u.CostCenterColID=l.Tables[0][i].CostCenterColID.toString(),u.IsColumnUserDefined=1,u.CostCenterID=s,u.SysTableName="COM_Address",u.ResourceData=N.J0.String(l.Tables[0][i].ResourceData),u.UserColumnName=N.J0.String(l.Tables[0][i].UserColumnName),u.SysColumnName=N.J0.String(l.Tables[0][i].SysColumnName),u.ColumnCostCenterID=N.J0.String(l.Tables[0][i].ColumnCostCenterID),e.push(u)}}-1!==s&&e.sort((l,i)=>l.ResourceData.localeCompare(i.ResourceData))}AddProductWiseUOMRows(e){if(3==parseInt(this.Feature.SelectedValue)){if({CostCenterColID:-19,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Name",UserColumnName:"Base_Name",SysColumnName:"Base_Name"}.push(e),{CostCenterColID:-20,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Conversion",UserColumnName:"Base_Conversion",SysColumnName:"Base_Conversion"}.push(e),{CostCenterColID:-21,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitName",UserColumnName:"Conversion_UnitName",SysColumnName:"Conversion_UnitName"}.push(e),{CostCenterColID:-22,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitValue",UserColumnName:"Conversion_UnitValue",SysColumnName:"Conversion_UnitValue"}.push(e),{CostCenterColID:-23,IsColumnUserDefined:0,SysTableName:"",ResourceData:"MultiBarcode",UserColumnName:"MultiBarcode",SysColumnName:"MultiBarcode"}.push(e),{CostCenterColID:-24,IsColumnUserDefined:0,SysTableName:"",ResourceData:"BaseMultiBarcode",UserColumnName:"BaseMultiBarcode",SysColumnName:"BaseMultiBarcode"}.push(e),this.CostCenterFieldsAllTables.length>8&&Object.keys(this.CostCenterFieldsAllTables.Tables[0]).includes("Name")){const m=this.CostCenterFieldsAllTables.Tables[8].find(c=>"BarcodeDimension"==c.Name);if(m&&m.Value&&N.J0.Int(m.Value)>0&&(this.BarcodeDim=N.J0.Int(m[0].Value),this.ShowBarcodeDimension=!0),this.ShowBarcodeDimension){let c={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(c.ColumnCostCenterID=this.BarcodeDim),c.ResourceData="Base_Barcode",c.UserColumnName="Base_Barcode",c.SysColumnName="Base_Barcode",e.push(c);let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(n.ColumnCostCenterID=this.BarcodeDim),n.ResourceData="UOM_Barcode",n.UserColumnName="UOM_Barcode",n.SysColumnName="UOM_Barcode",e.push(n)}else{e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Base_Barcode",UserColumnName:"Base_Barcode",SysColumnName:"Base_Barcode"}),e.push({CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ResourceData:"UOM_Barcode",UserColumnName:"UOM_Barcode",SysColumnName:"UOM_Barcode"})}}}}AddProductVendorWiseMultipleBarcodeRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-23,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:2,ResourceData:"Vendor",UserColumnName:"Vendor",SysColumnName:"Vendor"}),e.push({CostCenterColID:-24,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"ETA",UserColumnName:"ETA",SysColumnName:"ETA"}),e.push({CostCenterColID:-25,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Priority",UserColumnName:"Priority",SysColumnName:"Priority"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min. Order Quantity",UserColumnName:"Min. Order Quantity",SysColumnName:"Min. Order Quantity"}),e.push({CostCenterColID:-26,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Barcode",UserColumnName:"Barcode",SysColumnName:"Barcode"}),e.push({CostCenterColID:-27,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Volume",UserColumnName:"Volume",SysColumnName:"Volume"}),e.push({CostCenterColID:-28,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Weight",UserColumnName:"Weight",SysColumnName:"Weight"});let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"String",ResourceData:"Remarks"};n.UserColumnName=n.SysColumnName="Remarks",e.push(n)}}AddQCProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){if(e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),I.d.SessionManager.Preferences.ContainsKey("TestCaseDimension")&&""!=I.d.SessionManager.Preferences.TestCaseDimension&&N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension)>0){let g={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};g.ColumnCostCenterID=N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension),g.ResourceData="QC Name",g.UserColumnName="QC Name",g.SysColumnName="QC Name",e.push(g);let p={CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:""};p.ColumnCostCenterID=N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension),p.ResourceData=p.UserColumnName=p.SysColumnName="QC Code",e.push(p)}let u={CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:""};u.ResourceData=u.UserColumnName=u.SysColumnName="Document",e.push(u),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Type",UserColumnName:"Type",SysColumnName:"Type"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min",UserColumnName:"Min",SysColumnName:"Min"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Max",UserColumnName:"Max",SysColumnName:"Max"}),e.push({CostCenterColID:-36,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Probable val",UserColumnName:"Probable val",SysColumnName:"Probable val"}),e.push({CostCenterColID:-37,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Sample",UserColumnName:"Sample",SysColumnName:"Sample"}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ResourceData:"SampleType",UserColumnName:"SampleType",SysColumnName:"SampleType"}),e.push({CostCenterColID:-38,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Observation",UserColumnName:"Observation",SysColumnName:"Observation"}),e.push({CostCenterColID:-39,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Varience",UserColumnName:"Varience",SysColumnName:"Varience"})}}AddKitProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product",UserColumnName:"Kit_Product",SysColumnName:"Kit_Product"}),e.push({CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product_Code",UserColumnName:"Kit_Product_Code",SysColumnName:"Kit_Product_Code"}),e.push({CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Qty",UserColumnName:"Kit_Qty",SysColumnName:"Kit_Qty"}),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_UOM",UserColumnName:"Kit_UOM",SysColumnName:"Kit_UOM"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Rate",UserColumnName:"Kit_Rate",SysColumnName:"Kit_Rate"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_Link",UserColumnName:"Kit_Link",SysColumnName:"Kit_Link"})}}AddAttachemtnRows(e){this.QtyCombo.Visible=!0,this.QtyCombo.Items.push(se._p.ComboBoxItems_2("Accounts","2")),this.QtyCombo.Items.push(se._p.ComboBoxItems_2("Products","3"));for(let h=0;h<this.Feature.Items.length;h++)!N.J0.StringIsNullOrEmpty(this.Feature.Items[h].Value)&&(N.J0.Int(this.Feature.Items[h].Value)>5e4&&N.J0.Int(this.Feature.Items[h].Value)<50050||73==N.J0.Int(this.Feature.Items[h].Value)||86==N.J0.Int(this.Feature.Items[h].Value)||92==N.J0.Int(this.Feature.Items[h].Value)||93==N.J0.Int(this.Feature.Items[h].Value)||94==N.J0.Int(this.Feature.Items[h].Value)||95==N.J0.Int(this.Feature.Items[h].Value))&&this.QtyCombo.Items.push(se._p.ComboBoxItems_2(this.Feature.Items[h].Name,this.Feature.Items[h].Value));(e=[]).push({CostCenterColID:-10,IsColumnUserDefined:1,SysTableName:"",ResourceData:"FileName",UserColumnName:"FileName",SysColumnName:"FileName"});e.push({CostCenterColID:-11,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Description",UserColumnName:"FileDescription",SysColumnName:"FileDescription"});e.push({CostCenterColID:-12,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Code",UserColumnName:"Code",SysColumnName:"Code"});if(e.push({CostCenterColID:-13,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Name",UserColumnName:"Name",SysColumnName:"Name"}),I.d.SessionManager.Preferences.ContainsKey("AttahmentGrid")&&""!=I.d.SessionManager.Preferences.AttahmentGrid){let t=(new DOMParser).parseFromString(I.d.SessionManager.Preferences.AttahmentGrid,"text/xml"),o=-30;const r=t.documentElement?.childNodes||[];for(let m=0;m<r.length;m++){const c=r[m];if(!c&&!c.attributes)continue;const n=c.getAttribute("FieldName");if(n&&""!==n.trim()){o--;let a={CostCenterColID:o,IsColumnUserDefined:1,SysTableName:"",ResourceData:c.getAttribute("Field")||"",UserColumnName:n,SysColumnName:n};if("Type"==n){const p=I.d.SessionManager.Preferences.AttahmentDimType;p&&""!=p&&isNaN(parseInt(p))&&(a.ColumnCostCenterID=parseInt(p))}const g=c.getAttribute("Unique");g&&""!==g.trim()&&(a.IsUnique=g),e.push(a)}}}}AddFollowupRows(e){this.QtyCombo.Visible=!0;for(let l=0;l<this.Feature.Items.length;l++)(73==N.J0.Int(this.Feature.Items[l].Value)||86==N.J0.Int(this.Feature.Items[l].Value)||89==N.J0.Int(this.Feature.Items[l].Value))&&this.QtyCombo.Items.push(se._p.ComboBoxItems_2(this.Feature.Items[l].Name,this.Feature.Items[l].Value));e.push({CostCenterColID:"-1",ColumnCostCenterID:"0",SysColumnName:"Code",ResourceData:"Code*",UserColumnName:"Code",ColumnDataType:"TEXT"})}AddContractRows(e){if(95==N.J0.Int(this.Feature.SelectedValue)){e.foreach(h=>{h.SysTableName&&h.SysTableName.includes("Particulars")&&(h.ResourceData="Particular_"+h.ResourceData)}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_IsParticulars",UserColumnName:"Particular_IsParticulars",SysColumnName:"Particular_IsParticulars"}),e.push({CostCenterColID:-41,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_SNO",UserColumnName:"Particular_SNO",SysColumnName:"Particular_SNO"}),e.push({CostCenterColID:-42,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"IsOPening",UserColumnName:"IsOPening",SysColumnName:"IsOPening"})}}AddCodeRows(e){const s=N.J0.Int(this.Feature.SelectedValue),l=e.filter(u=>2==u.ColumnCostCenterID||3==u.ColumnCostCenterID||u.ColumnCostCenterID>=50001&&u.ColumnCostCenterID<=50075);let i=l.length;for(let u=0;u<i;u++)if(2==s||3==s||s>5e4){let h={};h.CostCenterColID=-N.J0.Int(l[u].CostCenterColID),h.ColumnCostCenterID=N.J0.Int(l[u].ColumnCostCenterID),h.UserColumnName=l[u].ResourceData+"Code",h.CostCenterID=s,h.IsColumnUserDefined=1,h.SysTableName=l[u].SysTableName,h.SysColumnName=l[u].SysColumnName,h.ResourceData=l[u].ResourceData+"Code",e.push(h)}-1!=s&&(e.sort((u,h)=>{const t=u.ResourceData?u.ResourceData.toString():"",o=h.ResourceData?h.ResourceData.toString():"";return t.localeCompare(o)}),this.grData.RefreshColumns(),this.grData.RefreshGrid=!0)}AddWEFRows(e){let s=N.J0.Int(this.Feature.SelectedValue);const l=e.filter(t=>2==t.ColumnCostCenterID||3==t.ColumnCostCenterID||t.ColumnCostCenterID>=50001&&t.ColumnCostCenterID<=50075);let i=l.length;const h=Object.keys(e.length>0?e:{});for(let t=0;t<i;t++)if(h.includes("UserProbableValues")&&null!=l[t].UserProbableValues&&("H"==l[t].UserProbableValues.toString().toUpperCase()||"HP2"==l[t].UserProbableValues.toString().toUpperCase()||"HP3"==l[t].UserProbableValues.toString().toUpperCase())&&(2==s||3==s||s>5e4)){let o={};o.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"000",o.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),o.UserColumnName=l[t].ResourceData+"_FromDate",o.CostCenterID=s,o.IsColumnUserDefined=1,o.SysTableName=l[t].SysTableName,o.SysColumnName=l[t].SysColumnName+"_FromDate",o.ResourceData=l[t].ResourceData+"_FromDate",e.push(o);let r={};r.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"001",r.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),r.UserColumnName=l[t].ResourceData+"_ToDate",r.CostCenterID=s,r.IsColumnUserDefined=1,r.SysTableName=l[t].SysTableName,r.SysColumnName=l[t].SysColumnName+"_ToDate",r.ResourceData=l[t].ResourceData+"_ToDate",e.push(r);let m={};m.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"002",m.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),m.UserColumnName=l[t].ResourceData+"_Remarks",m.CostCenterID=s,m.IsColumnUserDefined=1,m.SysTableName=l[t].SysTableName,m.SysColumnName=l[t].SysColumnName+"_Remarks",m.ResourceData=l[t].ResourceData+"_Remarks",e.push(m)}-1!=s&&e.sort((t,o)=>(t.ResourceData||"").localeCompare(o.ResourceData||""))}formatDate(e){return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"/")}AddGroupSeriesRows(e){let s=N.J0.Int(this.Feature.SelectedValue);if(2==s||3==s||s>5e4){let l={CostCenterColID:-43,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesStart",UserColumnName:"SeriesStart",SysColumnName:"SeriesStart"};e.push(l),e.push({CostCenterColID:-44,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesEnd",UserColumnName:"SeriesEnd",SysColumnName:"SeriesEnd"});let u={CostCenterColID:-45,IsColumnUserDefined:1,SysTableName:"COM_CCCCData"};l.ColumnDataType="INT",u.ResourceData="IsManual",u.UserColumnName="IsManual",u.SysColumnName="IsManual",e.push(u)}}OnBrowsefile(e){if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const s=new FileReader,l=e.target.files[0],i=this.ActualFileName;this.ActualFileName=l.name;const u=I.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&(this.ProfileName.Text=u.Tables[0].profileName),this.IsLoad&&this.ProfileID>0&&u.Tables.length>0&&!Object.keys(u.tables[0]).includes("ErrorMessage")&&u.Tables[0].length>0)return this.ActualFileName=i,this.DisplayMessage='File name mismatch, select file name (" + ds.Tables[0]["FileName"].toString() + ")',void(this.MessageVisibility=!0);s.onload=h=>{const r=et.LF(s.result,{type:"binary",cellDates:!0});this.workbookK=r;const c=r.Sheets[r.SheetNames[0]];this.worksheetWS=c,this.ExcelData=et.Wp.sheet_to_json(c,{header:1}),this.ExcelTable=this.ExcelData,this.dsexcel=this.ExcelData;try{this.ActualFileName=e.target.value,this.DtImport.Clear();for(let n=0;n<this.ExcelData[0].length;n++){let a=this.grData.NewRow();this.grData.addRow(a),a.FieldName=this.ExcelData[0][n],this.grData.updateRow(a)}if(this.ExcelTable.length>0&&(this.ExcelDataColumn=this.ExcelTable[0],this.ExcelTable.splice(0,1)),!N.J0.IsEmpty(this.ImportCols[1].DefaultValueText)){let n=new N.VB;if(n.LoadXml(this.ImportCols[1].DefaultValueText),null!=n)for(let a=0;a<n.DocumentElement.children.length;a++){const g=n.DocumentElement.children[a];for(let p=0;p<this.DtImport.length;p++)(p+1).toString()==g.attributes[0].value&&(this.DtImport[p].FeatureFieldName=N.J0.String(g.attributes[2].value),this.grData.updateRow(this.DtImport[p]))}}0!=this.ProfileID&&(this.isEdit||this.IsLoad)&&(Logger.InfoLog("after ProfileID != 0 && (isEdit || IsLoad)  check..."),Logger.InfoLog("before ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),null!=u&&u.Tables.length>0&&!u.Columns[0].Contains("ErrorMessage")?(Logger.InfoLog("after ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),this.ProfileName.Text=u.Tables[0][0].ProfileName.toString(),this.IsLoad&&this.ProfileID>0&&this.ActualFileName!=u.Tables[0][0].FileName.toString()&&"1"!=I.d.SessionManager.RoleID?this.DisplayMessage="File name mismatch, select file name ("+u.Tables[0][0].FileName.toString()+") ":""!=u.Tables[0][0].Structure.toString()&&this.ReadStructure(u.Tables[0][0].Structure.toString(),!0),Logger.InfoLog("end... ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check...")):u.Columns[0].Contains("ErrorMessage")&&u.Tables[0].length>0&&Logger.InfoLog("ds.Columns[0].Contains(ErrorMessage) :: "+u.Tables[0][0].ErrorMessage.toString())),parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&this.costCenterTableZero.Contains("CostCenterColID")&&null!=this.ExcelTable&&0==this.QtyCombo.Items.length&&0==this.RateCombo.Items.length&&this.FillQtyRateCombo()}catch(n){return void(this.DisplayMessage=n.Message)}},s.readAsBinaryString(l)}OnExportFile(e,s){this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";let l={};s.InitPrintOrExport(l),l.Type=e,l.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"","PDF"==e?l.lst=[]:"Print"==e?(l.lst=[],l.Type="PDF"):("Excel"==e||"OpenXML"==e)&&(l.lst=[]),l.al="al",I.d.report.ExportReport(s.Data,s.ReportColumns,l,"AccDrillDown").subscribe(i=>{"Print"==e?I.d.SessionManager.printTab(i.FileName):(I.d.SessionManager.Download(i.FileName,"khasim"),N.J0.IsEmpty(i.Message)&&!N.J0.IsEmpty(i.FileName)&&(this.DisplayMessage="Exported Successfully"))},i=>{})}ScanDocument(e,s,l,i){let u=this.costCenterTableZero,c=[],n=["50001","50002","50008","50009"];for(let a=0;a<this.ExcelTable.length;a++)for(const g of this.grData.Table){if(null==g[1]||""==g[1].toString()||"0"==g[1].toString())continue;const p=u.find(T=>T.CostCenterColID?.toString()===g[a]?.toString());if(p&&p.ColumnDataType){const T=p.ColumnDataType.toUpperCase(),d=g[0],S=this.ExcelData[a][d]?.toString().trim()||"",F=p.ResourceData;switch(T){case"DATE":if("DocDate"==p.SysColumnName){if(this.VoucherNoField&&(!S||!this.ExcelTable[a][this.VoucherNoField].toString().Trim()&&isNaN(Date.parse(S))))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} date expected `,this.MessageVisibility=!0,!1}else if(S&&isNaN(Date.parse(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} date expected `,this.MessageVisibility=!0,!1;break;case"FLOAT":if(S&&isNaN(Date.parse(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1;const y=p.SysColumnName.toLowerCase();"quantity"==y?this.QtyField=d:"rate"==y?this.RateField=d:"avgrate"==y?(this.isAvgrate=!0,this.RateField=d):"FreeQTY"==y?this.FreeQtyField=d:"gross"==y?(this.GrossField=d,this.GrssFldName=d):"exchangerate"==y?this.ExhgRateFieldName=d:"avgratevalue"==y&&(this.GrossField=this.GrssFldName=d);break;case"INT":if("DocNumber"===p.SysColumnName.toLowerCase()&&(this.DocNumberField=d),S&&isNaN(N.J0.Int(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1;break;case"COMBOTEXT":if(this.VoucherNoField=d,S){const f=S.split(this.Delimiter?this.Delimiter[0]:" ");if(!f[f.length-1]||isNaN(N.J0.Int(f[f.length-1])))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1}break;case"STR":"DocPrefix"==p.SysColumnName.toLowerCase()&&(this.DocPrefixField=d);break;case"STRING":if("refno"==p.SysColumnName.toLowerCase()){const f=this.grData.Table.filter(b=>"-501"===b.FeatureFieldName);if(f.length>0&&!this.ccdv.includes[400]){let b="",w="";for(let P=0;P<this.ExcelTable.length;P++)b+=(b?",":"")+`'${this.ExcelTable[P][d]}'`,w+=(w?",":"")+`'${this.ExcelTable[P][f[0][0]]}'`;const R=this.ScreenObject.GetLinkDefDetails(N.J0.Int(this.Feature.SelectedValue),0,b,"",w,"");null!=R&&R.Tables.length>0&&(this.ccdv[400]=R.Tables[0]),null!=R&&R.Tables.length>4&&(this.ccdv[400]=R.Tables[5])}}break;case"PRODUCTSTRING":""==this.ProductFieldName&&(this.ProductFieldName=g.FieldName.toString()),this.CheckProductExtraField(a,3,this.ProductFieldName,u[0].SysColumnName.toString(),!1,this.IsCode);break;case"COSTCENTERSTRING":this.CheckCostCenterExtraField(a,N.J0.Int(u[0].CostCenterID.toString()),g.FieldName.toString(),u[0].CostCenterName.toString(),u[0].SysColumnName.toString(),!1,this.IsCode);break;case"LISTBOX":if(!(this.ProfileID>-20&&this.ProfileID<0&&n.Contains(u[0].ColumnCostCenterID.toString()))&&2!=N.J0.Int(u[0].ColumnCostCenterID.toString())&&3!=N.J0.Int(u[0].ColumnCostCenterID.toString())){if(i&&I.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&I.d.SessionManager.Preferences.POSItemCodeDimension==u[0].ColumnCostCenterID.toString())continue;s&&l>0&&l==N.J0.Int(u[0].ColumnCostCenterID.toString())?this.BinDimFieldName=d:this.CheckCostCenterField(a,N.J0.Int(u[0].ColumnCostCenterID.toString()),g.FieldName.toString(),!1,this.IsCode)}if("debitaccount"==p.SysColumnName.toLowerCase())this.DrAccFieldName=d;else if("debitaccountcode"==p.SysColumnName.toLowerCase())this.DrAccFieldName=d,this.IsDrFieldCode=!0;else if("creditaccount"==p.SysColumnName.toLowerCase())this.CrAccFieldName=d;else if("currencyid"==p.SysColumnName.toLowerCase())this.CurrencyFieldName=d;else if("creditaccountcode"==p.SysColumnName.toLowerCase())this.CrAccFieldName=d,this.IsCrFieldCode=!0;else if("productid"==p.SysColumnName.toLowerCase()&&1!=this.ProfileID)""==this.ProductFieldName&&(this.ProductFieldName=d),Object.keys(u[0]).includes("parentccdefaultcolid")&&"261"==u[0].parentccdefaultcolid.toString().toLowerCase()?(this.ProductFieldName=d,this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(a,3,this.ProductFieldName,!1,!0):this.CheckCostCenterField(a,3,this.ProductFieldName,!1,!0))):this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(a,3,this.ProductFieldName,!1,!1):this.CheckCostCenterField(a,3,this.ProductFieldName,!1,!1));else if("Unit"==p.SysColumnName.toLowerCase()){this.UnitFieldName=d;let f=`${d}_key`,b="";if(!Object.prototype.hasOwnProperty.call(this.ExcelTable[a],f)){for(let R of this.ExcelTable)R[f]="";const w=N.J0.Int(p.ColumnCostCenterID);this.temp[w]||(this.temp[w]=[])}if(""!=S){let R=this.CostCenterFieldsAllTables.Tables[4];const P=S,U=this.ExcelData[a][this.ProductFieldName]?.toString().trim().replaced(/'/g,"''")||"";let x=[];if(this.IsCode?(""!==this.ProductFieldName&&(x=R.filter(G=>G.unitName===P&&G.productCode===U)),"Product Code"==this.ProductFieldName?x=R.filter(G=>G.unitName===P&&G.productCode===U):"Product Name"==this.ProductFieldName&&(x=R.filter(G=>G.unitName===S&&G.productName===U)),(0==x.length||""==this.ProductFieldName)&&(x=R.filter(G=>G.unitName===P&&(!G.productName||"DynamicSet"==G.productName)))):(""!==this.ProductFieldName&&(x=R.filter(G=>G.unitName===P&&G.productCode===U)),"Product Code"==this.ProductFieldName?x=R.filter(G=>G.unitName===P&&G.productCode===U):"Product Name"==this.ProductFieldName&&(x=R.filter(G=>G.unitName===S&&G.productName===U)),(0==x.length||!this.ProductFieldName)&&(x=R.filter(G=>G.unitName===P&&(!G.productName||"DynamicSet"==G.productName)))),x.length>0)this.ExcelTable[a][f]=x[0].UOMID.toString();else{const G=N.J0.Int(p.ColumnCostCenterID),ee=P.toLowerCase();this.temp[G].includes(ee)||(this.temp[G].push(ee),b+=`<Row  PrimaryKey='0' UName='" ${P}'  ConversionRate='1' MapAction='NEW' />`)}}if(""!=b){b=`<XML>${b}</XML>`;const R=I.d.document.AddUOMWithDataset(["",0,b,1,I.d.SessionManager.CompanyGUID,I.d.SessionManager.UserName,I.d.SessionManager.RoleID,I.d.SessionManager.LanguageID]);if(null!=R&&R.Tables.length>0&&Object.keys(R.Tables[0]).includes("ErrorMessage"))return this.DisplayMessage=R.Tables[0].Rows[0].ErrorMessage.toString(),!1;for(let P=0;P<R.Tables[0].length;P++){const U=Object.keys(R.Tables[0][P]).includes("UnitName"),x=Object.keys(R.Tables[0][P]).includes("UOMID");for(let G of this.ExcelTable)G[f]==U&&(G[f]=x)}}}break;case"TEXT":const C=N.J0.Int(p.ColumnCostCenterID);44==C?this.CheckLookupField(a,N.J0.Int(p.ColumnCCListViewTypeID),d):C>0&&this.CheckCostCenterField(a,N.J0.Int(p.ColumnCostCenterID),d,!1,this.IsCode)}}if(e&&!c.includes(this.ExcelTable[a])&&""!=this.ProductFieldName&&""!=this.QtyFldName){let T="";""!=this.VoucherNoField?T+=`[${this.VoucherNoField}]='  ${this.ExcelTable[a][this.VoucherNoField].replace(/'/g,"''")}' and `:""!=this.DocPrefixField&&""!=this.DocNumberField?(T+=`[${this.DocPrefixField}]='  ${this.ExcelTable[a][this.DocPrefixField].replace(/'/g,"''")}' and `,T+=`[${this.DocNumberField}]='  ${this.ExcelTable[a][this.DocNumberField].replace(/'/g,"''")}' and `):""!=this.DocNumberField&&(T+=`[${this.DocNumberField}]='  ${this.ExcelTable[a][this.DocNumberField].replace(/'/g,"''")}' and `),""!=this.UnitFieldName&&(T+=`[${this.UnitFieldName}]='  ${this.ExcelTable[a][this.UnitFieldName].replace(/'/g,"''")}' and `),T+=`[${this.ProductFieldName}]='  ${this.ExcelTable[a][this.ProductFieldName].replace(/'/g,"''")}' `;const d=this.ExcelTable.filter(F=>{try{return new Function("row",`return ${T.replace(/\[|\]/g,"row['").replace(/=/g,"']==")}`)(F)}catch{return!1}}),S=this.grData.Table.filter(F=>"-25"==F.FeatureFieldName);if(d.length>1&&0===S.length){let F=0,y=0,C="";for(let b=1;b<d.length;b++){const w=d[b];w[this.QtyFldName]&&(F+=parseFloat(w[this.QtyFldName])||0),w[this.GrssFldName]&&(y+=parseFloat(w[this.GrssFldName])||0),this.BinDimFieldName&&w[this.BinDimFieldName]&&(C+=","+w[this.BinDimFieldName]),c.push(w)}const f=d[0];f[this.QtyFldName]=""!=f[this.QtyFldName].toString()?parseFloat(f[this.QtyFldName].toString())+F:F,f[this.GrssFldName]=""!=f[this.GrssFldName].toString()?parseFloat(f[this.GrssFldName].toString())+y:y,""!=this.BinDimFieldName&&(f[this.BinDimFieldName]=f[this.BinDimFieldName].toString()+C,this.CheckCostCenterField(this.ExcelTable.indexOf(f),l,this.BinDimFieldName,!1,!1))}else""!=this.BinDimFieldName&&this.CheckCostCenterField(a,l,this.BinDimFieldName,!1,!1)}}for(const a of c)this.ExcelTable.splice(this.ExcelTable.indexOf(a),1);return!0}FillAccountValues(){this.isCreditRowAdded&&this.GetDocumentReferenceData("CreditAccount"),this.isDebitRowAdded&&this.GetDocumentReferenceData("DebitAccount")}MapDebitCreditAccountFields(){let e=this.CostCenterFieldsAllTables.Tables[0],s=" ",l=" ";for(const i of this.grData.Table){if(!i[1]||""==i[1].toString()||"0"==i[1].toString())continue;const u=i[1]?.toString();if(u){const h=e.filter(t=>t.CostCenterColID?.toString()===u);if(h.length>0&&null!=h[0].ColumnDataType&&"LISTBOX"===h[0].ColumnDataType.toString().toUpperCase()){const o=h[0].SysColumnName?.toString().toLowerCase();"debitaccount"==o?s=i[0].toString():"debitaccountcode"==o?(s=i[0].toString(),this.IsDrFieldCode=!0):"creditaccount"==o?l=i[0].toString():"creditaccountcode"==o&&(l=i[0].toString(),this.IsCrFieldCode=!0)}}if(""==s){const h=this.CostCenterFieldsAllTables.Tables[0].filter(t=>"DebitAccount"===t.SysColumnName);if(h.length>0){const t=h[0].UserDefaultValue?.toString()||"",o=h[0].LINKDATA?.toString()||"";if(t&&"0"!=t||o){this.ExcelTable.includes(h[0].SysColumnName.toString())||(this.ExcelTable.push(h[0].SysColumnName.toString()),this.ExcelTable.push(h[0].SysColumnName.toString()+"_Key"));const r=[];r[1]=h[0].CostCenterColID.toString(),r[0]=s=h[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(r)}}}if(""==l){const h=this.CostCenterFieldsAllTables.Tables[0].filter(r=>"CreditAccount"===r.SysColumnName),t=h[0].UserDefaultValue?.toString()||"",o=h[0].LINKDATA?.toString()||"";if(h.length()>0&&(t&&"0"!==t||o)){this.ExcelTable.includes(h[0].SysColumnName.toString())||(this.ExcelTable.push(h[0].SysColumnName.toString()),this.ExcelTable.push(h[0].SysColumnName.toString()+"_Key"));const r=[];r[1]=h[0].CostCenterColID.toString(),r[0]=s=h[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(r)}}}}GetDocumentReferenceData(e){const s=this.CostCenterFieldsAllTables.Tables[0].filter(l=>l.SysColumnName===e);if(s.length>0){const l=s[0].UserDefaultValue,i=s[0].LINKDATA,u=N.J0.Int(this.Feature.SelectedValue);if(l&&""!==l.toString()&&"0"!==l.toString()){const h=I.d.document.GetDataSet(`SELECT AccountName,AccountID FROM Acc_Accounts with(nolock) where Accountid='${l}'`);if(!(h&&h.Tables.length>0))return this.DisplayMessage=`${e} doesn't exists for Master`,void(this.MessageVisibility=!0);for(let t of this.ExcelTable)t[s[0].SysColumnName]=h.Tables[0].Rows[0].AccountName,t[s[0].SysColumnName+"_Key"]=h.Tables[0].Rows[0].AccountID}else if(i&&""!==i.toString()&&"0"!==i.toString()){const h=I.d.document.GetImportLinkRefData(i,u);if(h&&h.Tables.length>0&&h.Tables[0].Rows.length>0){let t=0;""!==h.Tables[0].COSTCENTERID&&(t=h.Tables[0].COSTCENTERID);const o=h.Tables[0].Feature;let r=!1;for(let m of this.grData.Table)if(""!==m[1].toString()){const c=this.CostCenterFieldsAllTables.Tables[0].filter(n=>n.ColumnCostCenterID.toString()===t.toString()&&n.CostCenterColID.toString()===m[1].toString());if(c.length>0&&c[0].ColumnCostCenterID.toString()===t.toString()){for(let n of this.ExcelTable)if(this.ExcelTable.includes(m[0].toString()+"_Key")&&""!==n[m[0].toString()+"_Key"].toString()){const a=h.Tables[1].filter(g=>g.NodeID.toString()===n[m[0].toString()+"_Key"].toString());if(!(a.length>0&&null!=a[0].ACCOUNTNAME))return this.DisplayMessage=`${e} mapping doesn't exists for Product ${n[m[0].toString()]}`,void(this.MessageVisibility=!0);n[s[0].SysColumnName]=a[0].ACCOUNTNAME,n[s[0].SysColumnName+"_Key"]=a[0].AccountID}r=!0;break}}if(!r)return this.DisplayMessage=`Select ${o}`,void(this.MessageVisibility=!0)}}}}CheckProductExtraField(e,s,l,i,u,h){if(s<5e4&&(!u||11===s)&&2!==s&&3!==s&&12!==s)return;let t;this.ExcelDataColumn.includes(l)&&(t=l+"_Key",this.ExcelDataColumn.push(t)),this.ExcelTable.includes(t)||this.ExcelTable.push(t),this.ExcelTable.includes("TempProductName")||this.ExcelTable.push("TempProductName"),this.ExcelTable.includes("TempProductCode")||this.ExcelTable.push("TempProductCode"),this.ccdv.includes(s)||(this.ccdv.push(s,I.d.document.GetCostCenterDetailsBYCostCenterID(s,i).Tables[0]),this.CCQuery.push(s,""),this.COls.push(s,t),this.temp.push(s,[]));try{const o=this.ExcelTable[e][0][l]?.toString().trim().replace(/'/g,"''")||"",r=+this.Feature.SelectedValue;this.ccdv[s].RowFilter=r>4e4&&r<5e4&&""!==i?`${i}='${o}'`:this.IsCode?`Code='${o}'`:`Name='${o}'`}catch(o){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+o.toString())}this.ccdv[s].length>0&&(this.ExcelTable[e][t]=this.ccdv[s][0].NodeID,this.ccdv[s][0].Name?this.ExcelTable[e].TempProductName=this.ccdv[s][0].Name:this.ExcelTable[e].TempProductCode=this.ccdv[s][0].Code)}CheckCostCenterExtraField(e,s,l,i,u,h,t){if(s<5e4&&(!h||11==s)&&2!=s&&3!=s&&12!=s)return;let o;this.ExcelDataColumn.includes(l)&&(o=l+"_Key",this.ExcelDataColumn.push(o)),this.ExcelDataColumn.includes(o)||this.ExcelDataColumn.push(o),this.ccdv.includes(s)||(this.ccdv.push({ColCCId:I.d.document.GetCostCenterDetailsBYCostCenterID(s,u).Tables[0]}),this.CCQuery.push({ColCCId:""}),this.COls.push({ColCCId:o}),this.temp.push({ColCCId:[]}));try{const r=this.ExcelTable[e][l]?.toString().trim().replace(/'/g,"''")||"",m=+this.Feature.SelectedValue;m>4e4&&m<5e4&&""!==u&&this.ccdv[0][s].filter(n=>n.SCOLName==r)}catch(r){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+r.toString())}this.ccdv[s].length>0&&(this.ExcelTable[e][o]=this.ccdv[s][0].NodeID)}CheckCostCenterField(e,s,l,i,u){let h,t;if(s<5e4&&(!i||11==s)&&93!=s&&92!=s&&94!=s&&95!=s&&83!=s&&2!=s&&3!=s&&5!=s&&6!=s&&7!=s&&12!=s&&72!=s&&77!=s&&76!=s)return;if(this.ExcelDataColumn.includes(l)&&(t=l+"_Key"),3==s&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){let r=this.ExcelDataColumn[l].ColumnName+"_PrdTypeID";this.ExcelDataColumn.Contains(r)||this.ExcelDataColumn.push(r)}38==this._DocumentType&&(0!=this.PosRegisterDim&&this.PosRegisterDim==s&&(this.PosRegisterField=l),0!=this.PosShiftDim&&this.PosShiftDim==s&&(this.PosShiftField=l)),this.ExcelDataColumn.Contains(t)||this.ExcelDataColumn.push(t),12==s&&(this.ExcelDataColumn.Contains("ExchangeRate")||this.ExcelDataColumn.push("ExchangeRate")),this.ccdv.includes(s)||(this.ccdv.push({key:s,value:I.d.document.GetCostCenterDetailsBYCostCenterID(s,"").Tables[0]}),this.CCQuery.push({key:s,value:""}),this.CCQueryData.Items.push(se._p.ComboBoxItems_3(l,"",s.toString())),this.COls.push({key:s,value:t}),this.temp.push({key:s,value:[]}));try{let r=this.ExcelDataColumn.indexOf(l);const m=this.ExcelTable[0][r]?.toString().trim().replace(/'/g,"''");let c=this.ccdv.find(n=>n.key==s)?.value;if(c)if("95"==this.Feature.SelectedValue&&93==s&&m){const n=m.substring(0,m.indexOf(",")).trim();h=c.filter(u?a=>a.Code==n:a=>a.Name==n)}else h=c.filter(12==s?n=>n.Name==m:u?n=>n.Code==m:n=>n.Name==m)}catch(r){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+r.toString())}const o=h;if(h.length>0)this.ExcelTable[e][t]=o[0].NodeID,u&&this.ExcelDataColumn.includes(l+"_Name")&&(this.ExcelTable[e][l+"_Name"]=o[0].Name),!this.ExcelDataColumn.includes(l+"_Curr")&&o.includes("Curr")&&this.ExcelDataColumn.push(l+"_Curr"),!this.ExcelDataColumn.includes(l+"_Exch")&&o.includes("Exch")&&this.ExcelDataColumn.push(l+"_Exch"),this.ExcelDataColumn.includes(l+"_Curr")&&o.includes("Curr")&&(this.ExcelTable[e][l+"_Curr"]=o[0].Curr),this.ExcelDataColumn.includes(l+"_Exch")&&o.includes("Exch")&&(this.ExcelTable[e][l+"_Exch"]=o[0].Exch),this.ExcelDataColumn.includes(l+"_PrdTypeID")&&o.includes("PrdTypeID")&&(this.ExcelTable[e][l+"_PrdTypeID"]=o[0].PrdTypeID),12==s&&(this.ExcelTable[e].ExchangeRate=o[0].ExchangeRate);else{const r=this.ExcelTable[e][l]?.toString().trim();if(r&&r.length>0&&!this.temp[0][s].includes(r)){this.temp[0][s].push(r);const m=this.grData.Table.filter(n=>n.FieldName===l&&"-16"===n.FeatureFieldName),c=` <Row AccountName="${k.Dw.GetValidXml(r.replace(/'/g,"''"))}"${m.length>0?' IsGroup="1"':""} ></Row> `;this.CCQuery.push(s,this.CCQuery[s]+c);for(let n of this.CCQueryData.Items)if(n.Parent===s.toString()){n.Value+=`${r}~${e+1},`;break}}}}CheckBulkCostCenterField(e,s,l,i,u){if(2===s||3===s){let h;if(this.ExcelDataColumn.includes(l)&&(h=l+"_Key",this.ExcelDataColumn.push(h)),this.ExcelTable.includes(h)||this.ExcelTable.push(h),!this.ccdv.includes(s)){const t=I.d.document.GetCostCenterDetailsBYCostCenterID(s,"").Tables[0];this.ccdv.push(s,t),this.CCQuery.push(s,""),this.CCQueryData.Items.push(se._p.ComboBoxItems_3(l,"",s.toString())),this.COls.push({ColCCId:h}),this.temp.push({ColCCId:[]})}try{const t=this.ExcelTable[e][l]?.toString().trim().replace(/'/g,"''")||"";this.ccdv[s].RowFilter=this.IsCode?`Code='${t}'`:`Name='${t}'`}catch(t){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+t.toString())}if(this.ccdv[s].length>0)this.ExcelTable[e][h]=this.ccdv[s][0].NodeID,u&&this.ExcelTable.includes(`${l}_Name`)&&(this.ExcelTable[e][`${l}_Name`]=this.ccdv[s][0].Name),!this.ExcelTable.includes(`${l}_Curr`)&&this.ccdv[s].Table.Columns.includes("Curr")&&this.ExcelTable.push(`${l}_Curr`),!this.ExcelTable.includes(`${l}_Exch`)&&this.ccdv[s].Table.Columns.includes("Exch")&&this.ExcelTable.push(`${l}_Exch`),this.ExcelTable.includes(`${l}_Curr`)&&this.ccdv[s].Table.Columns.includes("Curr")&&(this.ExcelTable[e][`${l}_Curr`]=this.ccdv[s][0].Curr),this.ExcelTable.includes(`${l}_Exch`)&&this.ccdv[s].Table.Columns.includes("Exch")&&(this.ExcelTable[e][`${l}_Exch`]=this.ccdv[s][0].Exch);else{const t=this.ExcelTable[e][l]?.toString().trim()||"";if(!this.temp[s].includes(t)&&t.length>0){this.temp[s].push(t),this.grData.Table.filter(r=>r.FieldName===l&&"-16"===r.FeatureFieldName).length>0?this.CCQuery.push(s,this.CCQuery[s]+` <Row AccountName="${k.Dw.GetValidXml(t.replace(/'/g,"''"))}" IsGroup="1" ></Row> `):this.CCQuery.push(s,this.CCQuery[s]+` <Row AccountName="${k.Dw.GetValidXml(t.replace(/'/g,"''"))}" ></Row> `);for(const r of this.CCQueryData.Items)if(r.Parent===s.toString()){r.Value+=`${t}~${e+1},`;break}}}}}CheckLookupField(e,s,l){let i,u;if(this.ExcelDataColumn.includes(l)&&(i=l+"_Key",this.ExcelDataColumn.push(i)),this.ExcelTable[e].includes(i)||this.ExcelTable[e].push(i),!this.lookupdv.includes(s)){const h=I.d.report.GetDataTable("IMP002",String(s));this.lookupdv.push({[s]:h}),this.lookupQuery.push({[s]:""}),this.COls.push({[s]:i}),this.lookuptemp.push({[s]:[]})}try{let h=this.ExcelDataColumn.indexOf(l);const t=this.ExcelTable[e][h]?.toString().trim().replace(/'/g,"''")||"";u=this.lookupdv[0][s].filter(o=>o.Name==t)}catch(h){Logger.ErrorLog("ImportUtilityViewModel:: CheckLookupField"+h.toString())}if(u.length>0)this.ExcelTable[e][i]=u[0].NodeID;else{const h=this.ExcelTable[e][l]?.toString().trim()||"";!this.lookuptemp[0][s].includes(h)&&h.length>0&&(this.lookuptemp[0][s].push(h),this.lookupQuery.push(s,this.lookupQuery[0][s]+` <Row lookup="${k.Dw.GetValidXml(h.replace(/'/g,"''"))}" ></Row> `))}}CheckAssignedCostCenters(e,s,l,i){if(s<5e4&&7!=s)return;let u=this.ExcelTable[l].ColumnName+"_Key";this.ExcelTable.includes(u)||this.ExcelTable.push(u),this.ccdv.includes(s)||(I.d.document.GetCostCenterDetailsBYCostCenterID(s,""),this.CCQuery.push(s,""),this.COls.push(s,u),this.temp.push(s,[]));let h=this.ExcelTable[e][l].toString().replace(/'/g,"''")||"";if(h.length>0){let t=h.split(",");h="",("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==s&&(h+="<XML>");for(let o=0;o<t.length;o++){if(this.ccdv[s].RowFilter=i?"Code='"+t[o].Trim()+"'":"Name='"+t[o].Trim()+"'",0==this.ccdv[s].length&&"3"==this.Feature.SelectedValue&&s>5e4&&s<59999&&!this.DoNotCreateCostCenter){let r=I.d.document.SetImportDataWithDataset('<XML><Row AccountName="'+t[o].Trim()+'" ></Row> </XML>',s.toString(),this.IsUpdate);null!=r&&r.Tables[0].length>0&&(h+='<Row CostCenterId="'+s+'" NodeID="'+r.Tables[0][0].NodeID.toString()+'" />')}this.ccdv[s].length>0&&(h+="92"!=this.Feature.SelectedValue&&"93"!=this.Feature.SelectedValue||7!=s?'<Row CostCenterId="'+s+'" NodeID="'+this.ccdv[s][0].NodeID.toString()+'" />':'<Row UserID="'+this.ccdv[s][0].NodeID.toString()+'" />')}("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==s&&(h+="</XML>"),h.length>0&&(this.ExcelTable[e][u]=h)}}FillCostCenterFields(e){let s=!1;for(const[l,i]of Object.entries(this.CCQuery))if(""!==i){let u=!1;if(this.NotesList?.length>0)for(const t of this.NotesList)if(this.ExcelTable[this.COls[l].replace("_Key","")]===t.Note.Label&&t.IsModified){u=!0;break}let h=null;if("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue){if(u){let t=[];t.push(`<XML>${i}</XML>`),t.push(l.toString()),t.push(I.d.SessionManager.CompanyIndex),h=I.d.document.SetImportDataWithDataset(`<XML>${i}</XML>`,l.toString(),this.IsUpdate)}}else{let t=[];t.push(`<XML>${i}</XML>`),t.push(l.toString()),t.push(I.d.SessionManager.CompanyIndex),h=I.d.document.SetImportDataWithDataset(`<XML>${i}</XML>`,l.toString(),this.IsUpdate)}if(h?.Tables?.length>0){let t=0;if("3"===this.Feature.SelectedValue)for(let o=0;o<h.Tables.length;o++){const r=h.Tables[o].Columns;if(r[0].ColumnName.toLowerCase().includes("nodeid")&&r[1].ColumnName.toLowerCase().includes("name")){t=o;break}}this.ccdv.push(l,h.Tables[t]),s=!0}}if(s)for(const[l,i]of Object.entries(this.CCQuery))if(""!==i)for(let u=0;u<this.ccdv[l].length;u++)if(e){const h=this.CostCenterFieldsAllTables.Tables[0].filter(o=>o.ColumnCostCenterID==l),t=this.grData;for(const o of h){const r=t.Table.filter(m=>m.FeatureFieldName==o.CostCenterColID);for(const m of r){const c=m[0],n=this.ExcelTable.filter(a=>a[c]===this.ccdv[l][u].Name);for(const a of n)a[`${c}_Key`]=this.ccdv[l][u].NodeID}}}else{const h=this.ExcelTable[this.COls[l].replace("_Key","")],t=this.ExcelTable.filter(o=>o[h]===this.ccdv[l][u].Name);for(const o of t)o[this.COls[l]]=this.ccdv[l][u].NodeID}}FillLookupFields(){let e=!1;for(const s of this.lookupQuery)for(const[l,i]of Object.entries(s))if(""!==i){const u=I.d.document.SetImportLookupData(`<XML>${i}</XML>`,l,I.d.SessionManager.CompanyIndex);this.lookupdv.push(l,u[u.Table.length-1]),e=!0}if(e)for(const s of this.lookupQuery)for(const[l,i]of Object.entries(s))if(""!==i)for(let u=0;u<this.lookupdv[l].length;u++){const h=this.COls[l].replace("_Key",""),t=this.lookupdv[l][u].Name,o=this.ExcelTable.filter(r=>r[h]===t);for(const r of o)r[this.COls[l]]=this.lookupdv[l][u].NodeID}}ConstructFormulaFields(e){let l;if(new At.PE,this.fldDict=new He.bT,l.setFieldDetails("RATE",1,1,"",0,!1,!1),e.set("RATE",l),l.setFieldDetails("NET",2,1,"",0,!1,!1),e.set("NET",l),l.setFieldDetails("AVGRATE",2,1,"",0,!1,!1),e.set("AVGRATE",l),l.setFieldDetails("QTY",3,1,"",0,!1,!1),e.set("QTY",l),l.setFieldDetails("GROSS",3,1,"",0,!1,!1),e.set("GROSS",l),l.setFieldDetails("LASTPURCHASERATE",2,1,"",0,!1,!1),e.set("LASTPURCHASERATE",l),l.setFieldDetails("LASTLANDINGRATE",2,1,"",0,!1,!1),e.set("LASTLANDINGRATE",l),l.setFieldDetails("CONVERSIONQTY",3,1,"",0,!1,!1),e.set("CONVERSIONQTY",l),l.setFieldDetails("UNITS",3,1,"",0,!1,!1),e.set("UNITS",l),l.setFieldDetails("BASEQTY",3,1,"",1,!1,!1),e.set("BASEQTY",l),l.setFieldDetails("FreeQTY",3,1,"",1,!1,!1),e.set("FreeQTY",l),l.setFieldDetails("EXCHANGERATE",3,1,"",0,!1,!1),e.set("EXCHANGERATE",l),this.CostCenterFieldsAllTables.Tables.length>0)for(const i of this.costCenterTableZero){const u=null!==i.IsColumnUserDefined&&""!==i.IsColumnUserDefined.toString()&&"true"===i.IsColumnUserDefined.toString(),h=i.SysColumnName?.toString()||"",t=i.ResourceData?.toString().replace(/\*$/,"")||"";u&&h.includes("dcNum")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l),l.setFieldDetails("Calc"+t,3,1,"",0,!1,!1),e.set("Calc"+t,l)),40067===parseInt(this.Feature.SelectedValue)?(u&&h.includes("dcCCNID")&&(l.setFieldDetails(h,3,1,"",0,!1,!1),e.set(h,l)),u&&h.includes("dcAlpha")&&(l.setFieldDetails(h,3,1,"",0,!1,!1),e.set(h,l))):(u&&h.includes("dcCCNID")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l)),u&&h.includes("dcAlpha")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l)))}}SetFieldValue(e,s,l){""!=l.Trim()?e[s].setFieldValue(l):e[s].setFieldValue(0)}GetWorkFlow(e){let l=e,i=this.CostCenterFieldsAllTables.Tables[9].filter(u=>1===u.Action||6===u.Action);for(let u=0;u<i.length;u++){if(""===i[u].Expression?.toString().trim())return parseInt(i[u].WorkFlowID);try{null==this.eval&&(this.fldDict=new He.bT);const h=this.eval.EvaluateExpression(i[u].Expression,l);if(null!==h&&"1"===h.toString())return parseInt(i[u].WorkFlowID)}catch(h){Logger.ErrorLog("ImportUtilitViewModel: GetWorkFlow error - "+h.message)}}return 0}BuildCCXML(e,s){let l="<XML>";for(const i of this.grData.Table){if(null===i[1]||""===i[1]||"0"===i[1])continue;const u=s.filter(h=>h.CostCenterColID==i[1]);if(u.length>0){const h=u[0];if(h.IsColumnUserDefined&&"LISTBOX"===h.ColumnDataType){const o=e[`${i[0]}_Key`];if(o&&parseInt(o)>0){const r=parseInt(h.ColumnCostCenterID);(2===r||3===r||r>5e4)&&(l+=`<Row CostCenterID="${r}" NODEID="${o}" />`)}}}}return l+="</XML>",l}CalculateAVGValue(e){e[this.GrossField]=parseFloat(e[this.QtyField])*parseFloat(e[this.RateField])}validateBatchInfo(e){Logger.InfoLog("ValidateBatchInfo: entering Quantity check"),e.forEach(s=>{if(""!==s.BatchID?.toString()){let l=0;l=parseFloat(s.BalQty)||0;const i=this.ExcelTable.filter(u=>u.BatchID===s.BatchID);if(i.length>0){let u=parseFloat(s.BalQty)||0,h=0;i.forEach(t=>{const o=t[this.QtyField];o&&!isNaN(parseFloat(o))&&(h=parseFloat(o),u-=h)}),s.BalQty=u}}}),Logger.InfoLog("ValidateBatchInfo: exiting Quantity check")}addBatchInformation(e){Logger.info("Entering AddBatchInformation");const l=Number(I.d.SessionManager.Preferences["Maintain Dimensionwise Batches"]||0),i=[...this.costCenterTableZero],u=[];let h=!1,t="",o="";for(const r of this.grData.Table){if(!r[1]||"0"===r[1])continue;const m=i.filter(c=>c.CostCenterColID===r[1].toString());if(m.length>0){const c=m[0];l>0&&c.ColumnCostCenterID.toString()===l.toString()?(t=r[0],h=!0):"50002"===c.ColumnCostCenterID.toString()&&I.d.SessionManager.Preferences.EnableLocationWise&&I.d.SessionManager.Preferences["LW Batches"]?o=r[0]:["int","numeric","float"].includes(c.UserColumnType.toLowerCase())&&"0"===c.IsCalculate&&""===c.Formula&&u.push(se._p.ComboBoxItems_2(r[0],c.UserColumnType.toLowerCase()))}}for(let r=0;r<e.length;r++)try{const m=this.DocDv[r];if(!m[this.ProductFieldName+"_Key"]||"1"===m.IsNewRow)continue;const c=Number(m[this.ProductFieldName+"_Key"]);new Date(m[this.DocDateField]),this.ScreenObject.CostCenterID=Number(this.Feature.SelectedValue),this.ScreenObject.LocationID=0;let a=-1;h&&m[t]&&(a=Number(m[t+"_Key"]||-1)),o&&(this.ScreenObject.LocationID=Number(m[o+"_Key"]));const g=this.ScreenObject.GetProductwiseBatches(c,0,this.VoucherType,null,a,!0,"");let p=Number(m[this.QtyField])||0;const T=Number(m[this.GrossField])||0,d=Number(m[this.RateField])||0;for(const S of u)S.Aliasname=m[S.Name]||"0";if(p>0){let S=p,F=0,C=0;this.validateBatchInfo(g[0]);for(const f of g[0]){if(0===S)break;let b=Number(f.BalQty)||0;if(0===b)continue;const w=()=>{const R={...m};R.BSRNO=r,R.BATCHNUMBER_Sys=f.BATCHNUMBER||"",R.BatchID=f.BatchID||"",R[this.QtyField]=b,this.GrossField&&R[this.RateField]&&(R[this.GrossField]=b*Number(R[this.RateField])),C=b*d;for(const P of u)P.Aliasname&&Number(P.Aliasname)>0&&(R[P.Name]=C/T*Number(P.Aliasname));R.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(m)+1,0,R)};if(S>=b){if(0===F){m.BATCHNUMBER_Sys=f.BATCHNUMBER,m.BatchID=f.BatchID,m[this.QtyField]=b,m.BSRNO=r,this.ExcelTable.includes(this.GrossField)&&m[this.RateField]&&(m[this.GrossField]=b*Number(m[this.RateField])),C=b*d;for(const R of u)R.Aliasname&&Number(R.Aliasname)>0&&(m[R.Name]=C/T*Number(R.Aliasname))}else w();F++,S-=b}else 0===F?(m.BATCHNUMBER_Sys=f.BATCHNUMBER,m.BatchID=f.BatchID,m[this.QtyField]=S):(b=S,w()),F++,S=0}if(S>0&&g[0].length>0){const f={...m};f.BSRNO=r,f.BATCHNUMBER_Sys="",f.BatchID="",f[this.QtyField]=S,f[this.RateField]&&(f[this.GrossField]=S*Number(f[this.RateField])),C=S*d;for(const b of u)b.Aliasname&&Number(b.Aliasname)>0&&(f[b.Name]=C/T*Number(b.Aliasname));f.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(m)+1,0,f)}}}catch(m){Logger.error("AddBatchInformation : "+m.message)}return Logger.info("Exiting AddBatchInformation"),this.ExcelTable}getValidXml(e){return e?.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")||""}importDocumentEdit(){if(0===this.grData.Table.filter(i=>Number(i.FeatureFieldName)>0).length)return this.DisplayMessage="Select atleast one field for Update",void(this.MessageVisibility=!0);let s=0;const l=[...this.costCenterTableZero];for(let i=0;i<this.ExcelTable.length;i++){let u="",h="";for(let r=0;r<this.grData.Table.length;r++){const m=this.grData[r];if(!m.FeatureFieldName)continue;const c=l.find(n=>n.CostCenterColID===m.FeatureFieldName.toString());if(c){const n=this.ExcelTable[i][m.FieldName];Number(m.FeatureFieldName)<0?h+=`${c.SysColumnName}='${n}' AND `:u+=`${c.SysColumnName}='${n}',`}}u.endsWith(",")&&(u=u.slice(0,-1)),h.endsWith("AND ")&&(h=h.slice(0,-4));let t=`UPDATE INV_DocDetails SET ${u}`;h&&(t+=` WHERE ${h}`),t+=`; UPDATE ACC_DocDetails SET ${u}`,h&&(t+=` WHERE ${h}`),I.d.common.GetDataSetQuery(t)&&(s++,this.FailedRecourdList.push({Message:t,Name:""})),this.ImportedCount="Imported :"+(i+1-s),this.FailedCount=`Failed :${s}`}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage=`Import completed ( Total :${this.ExcelTable.length} ${this.ImportedCount} ${this.FailedCount} )`,this.MessageVisibility=!0}ImportDocument(){try{Logger.InfoLog("Entering ImportDocument ");let d,u=!0,h=!1,t=!1,o=!1,r=!1,m=!1,c=!1,n=!1,a=!1,g=0,p=0,T=0,S=0;if(this.CostCenterFieldsAllTables.Tables.length>2&&Object.keys(this.CostCenterFieldsAllTables.Tables[2]).includes("DocumentType")&&(S=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)),this._DocumentType=S,38==this._DocumentType){const y=I.d.document.GetDataSet("\n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                      where Name='Registers'\n  \n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                              where Name='PosShifts' and Value is not null and ISNUMERIC(Value)=1");y&&y.Tables?.length>0&&(y.Tables[0]?.Rows?.length>0&&y.Tables[0].Rows[0].Value&&""!==y.Tables[0].Rows[0].Value.toString()&&(this.PosRegisterDim=Number(y.Tables[0].Rows[0].Value)),y.Tables.length>1&&y.Tables[1].Rows?.length>0&&y.Tables[1].Rows[0].Value&&""!==y.Tables[1].Rows[0].Value.toString()&&(this.PosShiftDim=Number(y.Tables[1].Rows[0].Value))),[1,2,3,4,6,13,25,26,27,31,34,39].includes(S)?this.VoucherType=1:[11,38,5,7,9,24,33,10,8,12].includes(S)&&(this.VoucherType=-1);let C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DonotupdateAccounts"===Y.PrefName);if(C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DonotupdateInventory"===Y.PrefName),C.length>0&&C[0].PrefValue&&(this.DonotUpdateInventory="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DuplicateProduct_IncrementQuantity"===Y.PrefName),C.length>0&&C[0].PrefValue&&(h="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DuplicateProductClubBins"===Y.PrefName),C.length>0&&C[0].PrefValue&&(t="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"AutoBatches"===Y.PrefName),C.length>0&&C[0].PrefValue&&(o="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DumpStockCodes"===Y.PrefName),C.length>0&&C[0].PrefValue&&(m="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DimWiseCurrency"===Y.PrefName),C.length>0&&C[0].PrefValue&&"true"===C[0].PrefValue.toLowerCase()){const Y=this.CostCenterFieldsAllTables.Tables[3].find(Q=>"CurrencyDim"===Q.PrefName);Y&&Y.PrefValue&&(p=parseInt(Y.PrefValue,10))}C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DontSaveIf_QtyIsZero"===Y.PrefName),C.length>0&&C[0].PrefValue&&(c="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DontSaveIf_RateZero"===Y.PrefName),C.length>0&&C[0].PrefValue&&(a="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"DontSaveIf_ValueZero"===Y.PrefName),C.length>0&&C[0].PrefValue&&(a="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter(Y=>"BatchBasedon"===Y.PrefName),C.length>0&&C[0].PrefValue&&(this.BatchBasedon=C[0].PrefValue),t&&(h=!0),this.CostCenterFieldsAllTables.Tables.length>5&&this.CostCenterFieldsAllTables.Tables[5].Columns.includes("name")&&(C=this.CostCenterFieldsAllTables.Tables[5].Rows.filter(Y=>"BinsDimension"===Y.name),C.length>0&&C[0].value&&parseInt(C[0].value,10)>5e4&&(g=parseInt(C[0].value,10)));let f="",b="",w="",R="",P="",U="",x="",G="";if(this.ProfileID>-20&&this.ProfileID<0){this.ExcelTable.includes("Uniqu")||this.ExcelTable.push("Uniqu");let Y=[];if(Y.push("<XML>"),this.ExcelTable.includes("IsNewRow")){this.ExcelTable.filter(J=>"1"!==J.IsNewRow);for(let J=0;J<this.ExcelTable.length;J++){const Z=this.ExcelTable[J];if(Z.ProductCode&&(!this.ExcelTable.includes("RevenUStatus")||"Passed"!=this.ExcelTable[J].RevenUStatus.toString())){Logger.debug(`ImportUtility-RowNo ${J}`);let Re=`<Row Seq="${J}" `;Re+=`PCode="${k.Dw.GetValidXml(Z.ProductCode)}" `,Re+=`Facility="${k.Dw.GetValidXml(Z.Facility)}" `,this.ExcelTable.includes("businessunit")?Re+=`BUnit="${k.Dw.GetValidXml(Z.businessunit)}" `:this.ExcelTable.includes("businessunit")&&(Re+=`BUnit="${k.Dw.GetValidXml(Z["business unit"])}" `),Re+=`Department="${k.Dw.GetValidXml(Z.Department)}" `,Re+=`WareHouse="${k.Dw.GetValidXml(Z.Store)}" `,Re+=`DocDate="${this.formatDate(Z.DocDate)}" `,Z.Uniqu=Z.DocNo+Z.ProductCode+Z.Department+Z.Store,Re+="/>",Y.push(Re)}}Y.push("</XML>");const re=I.d.document.GetTMOImport(Y);this.ExcelTable.includes("Department_Key")||this.ExcelTable.push("Department_Key"),this.ExcelTable.includes("Store_Key")||this.ExcelTable.push("Store_Key"),this.ExcelTable.includes("Facility_Key")||this.ExcelTable.push("Facility_Key"),this.ExcelTable.includes("businessunit")&&!this.ExcelTable.includes("BusinessUnit_Key")?this.ExcelTable.push("BusinessUnit_Key"):this.ExcelTable.includes("business unit")&&!this.ExcelTable.includes("Business Unit_Key")&&this.ExcelTable.push("Business Unit_Key"),this.ExcelTable.includes("Rate")||this.ExcelTable.push("Rate"),this.ExcelTable.includes("Gross")||this.ExcelTable.push("Gross"),this.ExcelTable.includes("TMOCODE")&&this.ExcelTable.Remove("TMOCODE"),this.ExcelTable.push("TMOCODE");const O=this.costCenterTableZero.filter(J=>"ProductID"==J.SysColumnName);if(O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="TMOCODE",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"dcalpha1"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Uniqu",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"dcalpha1"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Rate",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"Gross"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Gross",this.grData.Table.push(J)}this.ExcelTable.includes("TMOCODE_Key")||this.ExcelTable.push("TMOCODE_Key"),this.ExcelTable.includes("Green Code")||this.ExcelTable.push("Green Code"),this.ExcelTable.includes("RevenUReason")||this.ExcelTable.push("RevenUReason"),this.ExcelTable.includes("RevenUStatus")||this.ExcelTable.push("RevenUStatus"),this.ExcelTable.includes("Cr")||this.ExcelTable.push("Cr"),this.ExcelTable.includes("DB")||this.ExcelTable.push("DB"),this.ExcelTable.includes("UOMID")||this.ExcelTable.push("UOMID"),P="CreditAccount",U="DebitAccount";const me=[];for(const J of this.grData.Table){if(null==J[1]||""==J[1].toString()||"0"==J[1].toString())continue;const Z=this.costCenterTableZero.filter(Re=>Re.CostCenterColID===Re[1]);Z.length>0&&("int"==Z[0].UserColumnType.toString().toLowerCase()||"numeric"==Z[0].UserColumnType.toString().toLowerCase()||"float"==Z[0].UserColumnType.toString().toLowerCase())&&null!=Z[0].IsCalculate&&""!=Z[0].IsCalculate.toString()&&"0"==Z[0].IsCalculate.toString()&&""==Z[0].Formula.toString()&&me.push(se._p.ComboBoxItems_2(J[0].toString(),Z[0].UserColumnType.toString().toLowerCase())),Z.length>0&&"FLOAT"==Z[0].ColumnDataType.toString().ToUpper()&&("quantity"==Z[0].SysColumnName.toString().toLowerCase()?this.QtyField=J[0].toString():"rate"==Z[0].SysColumnName.toString().toLowerCase()?this.RateField=J[0].toString():"avgrate"==Z[0].SysColumnName.toString().toLowerCase()?(this.isAvgrate=!0,this.RateField=J[0].toString()):"FreeQTY"==Z[0].SysColumnName.toString()?R=J[0].toString():("gross"==Z[0].SysColumnName.toString().toLowerCase()||"avgratevalue"==Z[0].SysColumnName.toString().toLowerCase())&&(this.GrossField=J[0].toString()))}let ge=new He.bT,Fe=new He.bT;for(d=0;d<this.ExcelTable.length;d++){if(this.ExcelTable.includes("IsNewRow")&&"1"==this.ExcelTable[d].IsNewRow.toString())continue;let J=null;if(J=re.Tables[0].filter(1==this.VoucherType?Z=>Z.ProductID>0&&Z.Seq===d.toString():Z=>Z.BalQty>0&&Z.Seq===d.toString()),J.length>0){if(this.ExcelTable[d].Facility_Key=J[0].Loc,this.ExcelTable[d].Store_Key=J[0].Store,this.ExcelTable[d].Department_Key=J[0].Dep,this.ExcelTable.includes("businessunit")?this.ExcelTable[d].BusinessUnit_Key=J[0].Div:this.ExcelTable.includes("business unit")&&(this.ExcelTable[d]["Business Unit_Key"]=J[0].Div),this.ExcelTable[d].TMOCODE=J[0].ProductCode,this.ExcelTable[d].TMOCODE_Key=J[0].ProductID,this.ExcelTable[d]["Green Code"]=J[0].GreenCode,this.ExcelTable[d].UOMID=J[0].UOMID,this.ExcelTable[d].Cr=J[0].PurchaseAccountID,this.ExcelTable[d].DB=J[0].ClosingStockAccountID,"5"==J[0].ProductTypeid.toString()){this.ExcelTable.includes("BATCHNUMBER_Sys")||(this.ExcelTable.push("BATCHNUMBER_Sys"),this.ExcelTable.push("BatchID"),this.ExcelTable.push("IsNewRow"),this.ExcelTable.push("BSRNO"));let _t,Ce,Z=0,Re=0,Xe=0,Gt=0,Bt=0,dt=0;if(Z=parseFloat(this.ExcelTable[d][this.QtyField].toString().Trim()),Xe=parseFloat(this.ExcelTable[d][this.GrossField].toString().Trim()),Gt=parseFloat(this.ExcelTable[d][this.RateField].toString().Trim()),Re=Z,1==this.VoucherType){let ye=I.d.SessionManager.document.GetDataSet('select top 50 a.InvDocDetailsid,uomconvertedqty BalQty,a.docdate,a.BatchID,c.Batchnumber from Inv_DocDetails a with(nolock) join INV_Batches c on a.BatchID=c.BatchID  and c.STATUSID = 77 join com_docccdata b on a.invdocdetailsid=b.invdocdetailsid \n                                          where isqtyignored = 0 and dcCCNID9 = " + drprrows[0]["Store"].toString() + @"  and a.productid = " + drprrows[0]["ProductID"].toString() + ((complete.ContainsKey(drprrows[0]["ProductID"].toString())) ? " and a.InvDocDetailsid not in (" + complete[drprrows[0]["ProductID"].toString()] + ") " : "") + " and vouchertype = -1 order by docdate desc'),Me=parseFloat(this.ExcelTable[d].Qty.toString().Trim());Re=Me,dt=0;for(const Se of ye.Tables[0])if(""!=Se.BatchID.toString()){let je=0;je=parseFloat(Se.BalQty.toString());const we=!1;if(Object.keys(Fe).includes(Se.InvDocDetailsid.toString())&&(je-=Fe[Se.InvDocDetailsid.toString()]),je>0){if(0==dt)Ce=this.ExcelTable[d];else{const ze=this.ExcelTable.filter(it=>it.BSRNO===d.toString()&&it.BatchID===Se.BatchID.toString());if(ze.length>0)Ce=ze[0];else{let it={};for(const Xt of this.ExcelTable)it[Xt.ColumnName]=this.ExcelTable[d][Xt.ColumnName];it.IsNewRow="1",this.ExcelTable.push(it)}}if(dt++,Me>=je?(Ce.Qty=we&&""!=Ce.Qty.toString()?parseInt(Ce.Qty.toString())+je:je,Me-=je,Object.keys(ge).includes(J[0].ProductID.toString())?ge[J[0].ProductID.toString()]+=","+Se.InvDocDetailsid.toString():ge.push(J[0].ProductID.toString(),Se.InvDocDetailsid.toString()),Object.keys(Fe).includes(Se.InvDocDetailsid.toString())&&Fe.Remove(Se.InvDocDetailsid.toString())):(Ce.Qty=we&&""!=Ce.Qty.toString()?N.J0.Int(Ce.Qty.toString())+Me:Me,Fe.ContainsKey(Se.InvDocDetailsid.toString())?Fe[Se.InvDocDetailsid.toString()]+=Me:Fe.push(Se.InvDocDetailsid.toString(),Me),Me=0),Ce.BATCHNUMBER_Sys=Se.Batchnumber.toString(),Ce.BatchID=Se.BatchID.toString(),Ce.BSRNO=d,0==Me)break}}if(Me>0)if(new Date((new Date).getFullYear()+3,12,31),ye=I.d.SessionManager.document('declare @lft bigint\n  \n                                      select @lft=BatchID from[INV_Batches] WITH(NOLOCK)\n                                        where[ProductID] = " + drprrows[0]["ProductID"].toString() + @" and[BatchNumber] = \'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\'\n\n                                        if (@lft is null)\n                                        BEGIN\n                                          select @lft=rgt from[INV_Batches] WITH(NOLOCK)\n                                          where batchid = 1\n  \n                                          INSERT INTO[INV_Batches]([BatchNumber], [ExpiryDate], [StatusID], [ProductID], [Depth], [ParentID], [lft], [rgt]\n                                            , [IsGroup], [CompanyGUID], [GUID], [CreatedBy], [CreatedDate])\n                                        VALUES(\'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\', convert(float, convert(datetime, \'" + dtExp.toLocaleDateString("dd/MMM/yyyy") + @"\')), 77, " + drprrows[0]["ProductID"].toString() + @", 1, 1, @lft, @lft + 1, 0, \'admin\', newid(), \'admin\', convert(float, convert(datetime, \'" + new Date().toLocaleDateString("dd/MMM/yyyy") + @"\')))\n      \n                                          select @@identity\n\n                                        update[INV_Batches] \n                                          set rgt = @lft + 2\n                                          where batchid = 1\n                                        END\n                                        ELSE \n                                          select @lft'),null!=ye&&ye.Tables.length>0&&ye.Tables[0].Rows.length>0&&!ye.Tables[0].includes("ErrorMessage"))if(Re!=Me){let we={};for(const ze of this.ExcelTable)we[ze.ColumnName]=this.ExcelTable[d][ze.ColumnName];we.IsNewRow="1",we.BSRNO=d,we.BatchID=ye.Tables[0].Rows[0][0].toString(),we.BATCHNUMBER_Sys="SK"+("5"==J[0].Loc.toString()?"SH":"MCA")+"BATCH",we.Qty=Me,this.ExcelTable.push(we)}else this.ExcelTable[d].BSRNO=d,this.ExcelTable[d].BatchID=ye.Tables[0].Rows[0][0].toString(),this.ExcelTable[d].Qty=Me,this.ExcelTable[d].BATCHNUMBER_Sys="SK"+("5"==J[0].Loc.toString()?"SH":"MCA")+"BATCH";else if(Re!=Me){let we={};for(const ze of this.ExcelTable)we[ze.ColumnName]=this.ExcelTable[d][ze.ColumnName];we.IsNewRow="1",we.BSRNO=d,we.BatchID=0,we.Qty=Me,this.ExcelTable.push(we)}}else{var s=re.Tables[0].Compute("sum(BalQty)","Seq="+d.toString());if(null!=s&&N.J0.Int(s)>=Z){for(let Ee of me)Ee.Aliasname=this.ExcelTable.includes(Ee.Name)&&""!=this.ExcelTable[d][Ee.Name].toString()?this.ExcelTable[d][Ee.Name].toString():"0";for(const Ee of J)if(""!=Ee.BatchID.toString()){let ye;ye=0,ye=parseFloat(Ee.BalQty.toString());let yt=ye.toString();I.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=I.d.SessionManager.Preferences.DecimalsinQty&&(yt=ye.toString("N"+I.d.SessionManager.Preferences.DecimalsinQty)),ye=N.J0.Int(yt);const Me=this.ExcelTable.filter(Se=>Se.BatchID===Ee.BatchID.toString());if(Me.length>0){Bt=0;for(let Se=0;Se<Me.length;Se++)""!=Me[Se][this.QtyField].toString()&&parseFloat(Me[Se][this.QtyField].toString())&&(ye-=Bt)}if(ye>0){if(0==dt)Ce=this.ExcelTable[d];else{let Se={};for(const je of this.ExcelTable)Se[je.ColumnName]=this.ExcelTable[d][je.ColumnName];Se.IsNewRow="1",this.ExcelTable.push(Se)}dt++,Ce.TMOCODE=Ee.ProductCode,Ce.TMOCODE_Key=Ee.ProductID,Ce["Green Code"]=Ee.GreenCode,Ce.UOMID=Ee.UOMID,Ce.Cr=Ee.PurchaseAccountID,Ce.DB=Ee.ClosingStockAccountID,Z>=ye?(Ce[this.QtyField]=ye,Z-=ye):(Ce[this.QtyField]=Z,Z=0),Ce.BATCHNUMBER_Sys=Ee.Batchnumber.toString(),Ce.BatchID=Ee.BatchID.toString(),Ce.BSRNO=d,this.ExcelTable.includes(this.GrossField)&&""==this.ExcelTable.GrossField.Expression&&""!=Ce.RateField.toString()&&(Ce.GrossField=N.J0.Int(ye)*N.J0.Int(Ce.RateField)),_t=ye*Gt;for(const Se of me)null!=Se.Aliasname&&""!=Se.Aliasname.toString()&&N.J0.Int(Se.Aliasname)>0&&(Ce[Se.Name]=_t/Xe*N.J0.Int(Se.Aliasname));if(0==Z)break}}if(Z>0&&Re!=Z){Ce={};for(const Ee of this.ExcelTable)Ce[Ee.ColumnName]=this.ExcelTable[d][Ee.ColumnName];Ce.IsNewRow="1",Ce.BSRNO=d,Ce.QtyField=Z,this.ExcelTable.push(Ce)}}}}}else J=re.Tables[0].filter(Z=>Z.ProductID&&Z.Seq==d.i.toString()),J.length>0&&(this.ExcelTable[d].Facility_Key=J[0].Loc,this.ExcelTable[d].Store_Key=J[0].Store,this.ExcelTable[d].Department_Key=J[0].Dep,this.ExcelTable.includes("businessunit")?this.ExcelTable[d].BusinessUnit_Key=J[0].Div:this.ExcelTable.includes("business unit")&&(this.ExcelTable[d]["Business Unit_Key"]=J[0].Div),this.ExcelTable[d].TMOCODE=J[0].ProductCode,this.ExcelTable[d].TMOCODE_Key=J[0].ProductID,this.ExcelTable[d]["Green Code"]=J[0].GreenCode,this.ExcelTable[d].UOMID=J[0].UOMID,this.ExcelTable[d].Cr=J[0].PurchaseAccountID,this.ExcelTable[d].DB=J[0].ClosingStockAccountID)}}if(!this.ScanDocument(h,t,g,m))return;if(this.IsInventory=(0,B.yG0)(this.CostCenterFieldsAllTables.Tables[2][0].IsInventory.toString()),""==f&&""==b&&!(this.ProfileID>-20&&this.ProfileID<0))return this.DisplayMessage="Document No. Not Exists",void(this.MessageVisibility=!0);if(""==this.DocDateField)return this.DisplayMessage="Doc Date Not Exists",void(this.MessageVisibility=!0);if(38==this._DocumentType){if(""==this.PosRegisterField)return this.DisplayMessage="Pos register does not Exists",void(this.MessageVisibility=!0);if(""==this.PosShiftField)return this.DisplayMessage="Pos shift does not Exists",void(this.MessageVisibility=!0)}if(16!=S&&17!=S&&28!=S&&29!=S&&3!=S&&8!=S&&13!=S&&31!=S&&32!=S){if(this.FillAccountValues(),""==P)return this.DisplayMessage="Credit account does not Exists",void(this.MessageVisibility=!0);if(""==U)return this.DisplayMessage="Debit account does not Exists",void(this.MessageVisibility=!0)}if(this.IsInventory)if(40062==parseInt(this.Feature.SelectedValue)||40067==parseInt(this.Feature.SelectedValue)||40068==parseInt(this.Feature.SelectedValue)||40051==parseInt(this.Feature.SelectedValue)||40069==parseInt(this.Feature.SelectedValue)||40089==parseInt(this.Feature.SelectedValue))this.QtyField="0",this.GrossField="0",this.RateField="0";else{if(""==this.QtyField)return this.DisplayMessage="Quantity does not Exists",void(this.MessageVisibility=!0);if(c&&(C=this.ExcelTable.filter(re=>"0"===re.QtyField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroQty")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0);if(""==this.RateField)return this.DisplayMessage="Rate does not Exists",void(this.MessageVisibility=!0);if(n&&(C=this.ExcelTable.filter(re=>"0"===re.RateField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroRate")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0);if(""==this.GrossField)return this.DisplayMessage="Value does not Exists",void(this.MessageVisibility=!0);if(a&&(C=this.ExcelTable.filter(re=>"0"===re.GrossField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroValue")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0)}this.FillLookupFields(),this.DoNotCreateCostCenter||this.FillCostCenterFields(!1);const ie=this.costCenterTableZero;ie.filter(re=>"AccountId"===re.SysColumnName||"AccountIdCode"===re.SysColumnName);const A=ie[0].CostCenterColID,q=ie[1].CostCenterColID;if(ie.length>1&&2==this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q).length)return this.DisplayMessage="Both Account Code & Name Exists",void(this.MessageVisibility=!0);if(ie.filter(re=>"DebitAccount"===re.SysColumnName||"DebitAccountCode"===re.SysColumnName),ie.length>1&&2==this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q).length)return this.DisplayMessage="Both DebitAccount Code & Name Exists",void(this.MessageVisibility=!0);if(ie.filter(re=>"CreditAccount"===re.SysColumnName||"CreditAccountCode"===re.SysColumnName),ie.length>1)return this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q),this.DisplayMessage="Both CreditAccount Code & Name Exists",void(this.MessageVisibility=!0)}let ee=0,$=0;ee=I.d.SessionManager.Preferences["Maintain Dimensionwise stock"].toString();let j=!1;j=I.d.SessionManager.Preferences["Location Stock"];let Ne,W=!1,le="",de="";const E=this.costCenterTableZero;if(j||ee>0)for(const Y of this.grData.Table)null!=Y[1]&&""!=Y[1].toString()&&"0"!=Y[1].toString()&&(E.filter(ie=>ie.CostCenterColID===ie[1].toString()),E.length>0&&ee>0&&E[0].ColumnCostCenterID.toString()==ee.toString()&&(le=Y[0].toString(),W=!0),E.length>0&&j&&"50002"==E[0].ColumnCostCenterID.toString()&&I.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,B.yG0)(I.d.SessionManager.Preferences.EnableLocationWise)&&(de=Y[0].toString()));this.DocDv=this.ExcelTable,this.ProfileID>-20&&this.ProfileID<0&&(this.ExcelTable.includes("RevenUStatus")&&this.DocDv.filter(Y=>null==Y.RevenUStatus||"Passed"==Y.RevenUStatus),this.ExcelTable.includes("IsNewRow")?this.DocDv.sort((Y,Q)=>new Date(Y[this.DocDateField]||"").getTime()-new Date(Q[this.DocDateField]||"").getTime()||Number(Y.BSRNO||0)-Number(Q.BSRNO||0)||Number(Y.IsNewRow||0)-Number(Q.IsNewRow||0)):this.DocDv.sort((Y,Q)=>new Date(Y[this.DocDateField]||"").getTime()-new Date(Q[this.DocDateField]||"").getTime())),!(this.ProfileID>-20&&this.ProfileID<0)&&this.ExcelTable.includes("IMPORT_STATUS")&&this.DocDv.filter(Y=>null==Y.IMPORT_STATUS||"PASS"==Y.IMPORT_STATUS),o&&-1==this.VoucherType&&!(this.ProfileID>-20&&this.ProfileID<0)&&(this.ExcelTable.includes("BATCHNUMBER_Sys")||(this.ExcelTable.push("BATCHNUMBER_Sys"),this.ExcelTable.push("BatchID"),this.ExcelTable.push("IsNewRow"),this.ExcelTable.push("BSRNO"),this.ExcelTable=this.addBatchInformation(this.DocDv)));let De,Ke,v,ne,ce,pe,Ye,he,Ae,be,Te,ve,Ge,Je,V=0,K=0,Ie=0,M=0,_e=0,_="",ae="",L="",X="",We=[];We.push("AccountID"),We.push("Amount"),We.push("IsCredit"),We.push("AccountName"),this.ProgressMax=N.J0.Int(this.DocDv.length);let Ze,Ve,tt,ke="",rt="",Qe="",St="",pt="",nt="",$e="",at="",vt="",bi="",Ot="",ut=!1,Ut=!1,kt=!1,qe=1,fe=1,ht=0,Oe=1;for(this.IsInventory||De.append("<DocumentXML>"),Ke.append("<AttachmentsXML>"),d=0;d<this.DocDv.length;d++,qe++,this.ProgressValue++){if(Logger.DebugLog("ImportUtility-seqNo "+qe.toString()),ht=0,K=Ie,_=ae,rt=Qe,""!=b){if(""==this.DocDv[d][b].toString().Trim())continue;let Q;Q=""!=this.Delimiter.toString()?this.DocDv[d][b].toString().Trim().Split(this.Delimiter[0]):this.DocDv[d][b].toString().Trim().Split(),ae=Q[Q.length()-1],Ie=N.J0.Int(Q[Q.length()-1]),Q.length()>=2&&(Qe=Q[Q.length()-2])}else{if(""!=f){if(""==this.DocDv[d][f].toString().Trim())continue;Ie=N.J0.Int(this.DocDv[d][f].toString().Trim()),ae=this.DocDv[d][f].toString().Trim()}else if(this.ProfileID>-20&&this.ProfileID<0){if(""==this.DocDv[d][w].toString().Trim())continue;if(""==this.DocDv[d].TMOCODE_Key.toString().Trim()){this.DocDv[d].RevenUStatus="Failed",this.DocDv[d].RevenUReason="Product not found",fe++,V++;continue}if(""==this.DocDv[d].Facility_Key.toString().Trim()){this.DocDv[d].RevenUStatus="Failed",this.DocDv[d].RevenUReason="Facility not found",fe++,V++;continue}if(""==this.DocDv[d].Store_Key.toString().Trim()){this.DocDv[d].RevenUStatus="Failed",this.DocDv[d].RevenUReason="Store not found",fe++,V++;continue}let Q;Q.append("<PXML>"),Q.append("<Row "),Q.append(` ProductID="${this.DocDv[d].TMOCODE_Key}" `),Q.append(' QTY="1" '),Q.append(' DETAILSID="0" '),Q.append(` avgwhere=" and dcccnid2=${this.DocDv[d].Facility_Key} and dcccnid9=${this.DocDv[d].Store_Key}"`),Q.append(" ></Row>"),Q.append("</PXML>");const ie=this.ScreenObject.GetReconcileAvgRate(Q.toString(),(0,Ue._U)(this.DocDv[d][w].toString()));null!=ie&&ie.Tables.length>0&&ie.Tables[0].includes("AvgRate")&&ie.Tables[0].Rows.length>0&&(this.DocDv[d].Rate=ie.Tables[0].Rows[0].AvgRate,""!=this.DocDv[d].Qty.toString()&&""!=ie.Tables[0].Rows[0].AvgRate.toString()&&(this.DocDv[d].Gross=N.J0.Int(this.DocDv[d].Qty.toString())*N.J0.Int(ie.Tables[0].Rows[0].AvgRate.toString())))}Qe=""!=this.DocPrefixField?this.DocDv[d].DocPrefixField.toString():""}if((K!=Ie||this.PartialSave||rt!=Qe||d>0&&this.ProfileID>-20&&this.ProfileID<0&&(!this.ExcelTable.includes("IsNewRow")||"1"!=this.DocDv[d].IsNewRow.toString()))&&null!=De.toString()&&"<DocumentXML>"!=De.toString()){this.IsInventory||De.Append("</DocumentXML>"),Ke.Append("</AttachmentsXML>"),this.BulkSave&&(v.Insert(0,"<DocXML>"),ne.Insert(0,"<NumXML>"),ce.Insert(0,"<TextXML>"),pe.Insert(0,"<CCXML>"),De.Insert(0,"<AccXML>"),Ge.Insert(0,"<EXTRAXML>"),Je.Insert(0,"<DocExtraXML>"),v.Append("</DocXML>"),ne.Append("</NumXML>"),ce.Append("</TextXML>"),pe.Append("</CCXML>"),De.Append("</AccXML>"),Ge.Append("</EXTRAXML>"),Je.Append("</DocExtraXML>"),this.argParam=[De.toString(),v.toString(),ne.toString(),ce.toString(),pe.toString(),Ge.toString(),Je.toString()],Logger.DebugLog("BulkImportUtility-Rows "+De.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+ne.toString()),Logger.DebugLog("BulkImportUtility-Text "+ce.toString()),Logger.DebugLog("BulkImportUtility-CC "+pe.toString())),K!=Ie&&(this.PrevDocID=0);let Q=0;this.strSerial.length>0&&(Q=this.strSerial.length),this.strSerial.length>0&&this.strSerial.length!=Q&&(this.DocDv[d-fe].xIMP_STATUSx="FAIL",this.DocDv[d-fe].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(d-fe),V++,this.FailedRecourdList.push({Message:this.ErrorMessage,Name:Qe+"-"+ae}));let ie=this.SaveDocument($,rt,_,St,pt,nt,this.IsInventory,De.toString(),Ke.toString(),We,at,M,_e,this.fldDict,Oe,Ve,this.argParam);if($=ie.docId,this.ErrorMessage=ie.errorMessage,$<1){if(this.DocDv[d-fe].xIMP_STATUSx="FAIL",this.DocDv[d-fe].IMPORT_MESSAGE=this.ErrorMessage,this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[d-fe].RevenUStatus="Failed",this.DocDv[d-fe].RevenUReason=this.ErrorMessage),V++,!(this.ProfileID>-20&&this.ProfileID<0)){for(let q=0;q<this.grData.Table.length;q++)if(this.DocDv.filter(""!=f?re=>re.DocNumberField==re.PreviousDocNumber:re=>re.VoucherNoField==re.PreviousDocNumber),this.DocDv.includes(this.grData.Table[q][0].toString()+"_Key")&&this.DocDv.length>0)for(let re=0;re<this.DocDv.length;re++)""==this.DocDv[re][this.grData.Table[q][0].toString()+"_Key"].toString()&&this.FailedRecourdList.push({Message:"Invalid "+this.grData.Table[q][0].toString()+" at Row No:"+(re+1),Name:Qe+"-"+_});let A;A=this.ExcelTable.includes("IMPORT_STATUS")?this.DocDv.filter(q=>null==this.DocDv.IMPORT_STATUS||"PASS"==this.DocDv.IMPORT_STATUS):[]}this.FailedRecourdList.push({Message:this.ErrorMessage,Name:rt+"-"+_}),this.strSerial=[]}else this.DocDv[d-fe].xIMP_STATUSx="PASS",this.DocDv[d-fe].IMPORT_MESSAGE="",this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[d-fe].RevenUStatus="pass",this.DocDv[d-fe].RevenUReason=this.ErrorMessage),T++,this.strSerial=[];this.ImportedCount=this.IsSaveDocValidate?"Valid :"+T.toString():"Imported :"+T.toString(),this.FailedCount="Failed :"+V.toString(),St="",pt="",nt="",(!(this.ProfileID>-20&&this.ProfileID<0)||this.DocDv[d][w].toString().Trim()!=this.PrevDocDate)&&(qe=1),at="",fe=1,De="",Ke="",We=[],_e=0,M=0,this.BulkSave&&(v="",ne="",ce="",pe=""),this.IsInventory||De.Append("<DocumentXML>"),Ke.Append("<AttachmentsXML>")}if(40079==N.J0.Int(this.Feature.SelectedValue)){for(const A of this.grData.Table)if(null!=A[1]&&""!=A[1].toString()&&"0"!=A[1].toString()&&(E.filter(q=>q.CostCenterColID==q[1].toString()),E.length>0)){let q=E[0].SysColumnName.toString();Logger.InfoLog("ImportCosCenters Columnname ="+q),"dcalpha1"==q.toLowerCase()?(0,Ue._U)(this.DocDv[d][A.FieldName.toString()]):"dcccnid51"==q.toLowerCase()&&(bi=this.DocDv[d][A.FieldName.toString()+"_Key"].toString(),Ot=this.DocDv[d][A.FieldName.toString()])}let ie=I.d.document.GetDataSet('SELECT * FROM INV_DOCDETAILS I WITH(NOLOCK)\n                                          JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          WHERE CostCenterID = 40079 AND ISDATE(t.dcAlpha1) = 1 AND c.dcCCNID51 = " + EmpID + " AND CONVERT(DATETIME, t.dcAlpha1) = CONVERT(DATETIME, \'" + PayrollMonth + "\')');if(null!=ie&&ie.Rows.length>0){this.DisplayMessage="Attendance Dimension Wise already Posted For the Month",V++,this.FailedRecourdList.push({Name:Ot.toString(),Message:this.DisplayMessage});continue}}this.ProfileID>-20&&this.ProfileID<0&&(this.ExcelTable.includes("IsNewRow")&&"1"==this.DocDv[d].IsNewRow.toString()?fe++:this.DocDv[d].Uniqu.toString());let Y=0;do{if(1==Y&&(ht=0),this.BulkSave||(this.IsInventory&&De.Append("\x11"),De.Append("<Row>"),De.Append("<AccountsXML>"),v=" ",ne=" ",ce=" ",pe=" ",ve=" ",he=" ",Ae=" ",Ye=" ",be=" ",tt=0,Ve=1,Oe=1),p>5e4&&(E.filter(A=>A.SysTableName==A.COM_DocCCData&&A.ColumnCostCenterID==A.CurrencyDim),E.length>0)){let A=this.grData.Table.filter(q=>q.FeatureFieldName==E[0].CostCenterColID.toString());A.length>0&&this.DocDv.includes(A[0].FieldName.toString()+"_Curr")&&null!=this.DocDv[d][A[0].FieldName.toString()+"_Curr"]&&""!=this.DocDv[d][A[0].FieldName.toString()+"_Curr"].toString()&&parseInt(this.DocDv[d][A[0].FieldName.toString()+"_Curr"].toString())}kt=!1,ke="",Ze=!1,$e="",vt="",ut=!1,this.BulkSave?(v.Append('<Transactions  DocSeqNo="'+qe.toString()+'" '),ne.Append('<Numeric  DocSeqNo="'+qe.toString()+'" '),pe.Append('<CostCenters  DocSeqNo="'+qe.toString()+'" '),ce.Append('<Alpha  DocSeqNo="'+qe.toString()+'" ')):(v.Append('<Transactions DocSeqNo="'+qe.toString()+'" '),ne.Append('<Numeric Query="'),ce.Append('<Alpha Query="'),pe.Append('<CostCenters Query="')),v.Append(this.DoNotCreateCostCenter?'Create="0" ':'Create="1" '),v.Append('DocDetailsID="0" ');let Q,ie=!1;this.IsInventory&&this.DocDv.includes(this.ProductFieldName+"_PrdTypeID")&&!N.J0.StringIsNullOrEmpty(this.DocDv[d][this.ProductFieldName+"_PrdTypeID"].toString())&&(this.ProductTypeID=N.J0.Int(this.DocDv[d][this.ProductFieldName+"_PrdTypeID"]));for(const A of this.grData.Table)if(null!=A[1]&&""!=A[1].toString()&&"0"!=A[1].toString()&&(E.filter(q=>q.CostCenterColID==q[1].toString()),E.length>0)){Q=E[0].SysColumnName.toString();let re,q="";if(this.fldDict.ContainsKey(E[0].ResourceData.toString().TrimEnd("*"))&&this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),("voucherno"==Q.toLowerCase()||"docnumber"==Q.toLowerCase())&&this.IsUpdate){let O="";O=this.IsInventory?N.J0.StringIsNullOrEmpty(this.DocPrefixField)?'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo ':N.J0.StringIsNullOrEmpty(this.DocPrefixField)?'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND  DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo';const H=I.d.document.GetDataSet(O);null!=H&&H.Tables[0].Rows.length>0&&($=N.J0.Int(H.Tables[0].Rows[0].DocID.toString()))}if(this.isAvgrate&&"AVGRATE"==Q.ToUpper()){this.BuildCCXML(this.DocDv[d].Row,E);let ue,H=N.J0.Int(this.DocDv[d][this.ProductFieldName+"_Key"]),te=N.J0.Int(this.DocDv[d][this.QtyField]);ue=(0,Ue._U)(this.DocDv[d][w].toString()),this.ScreenObject.DocDate.Date=ue.Date,this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue),this.ScreenObject.AvgrateExists=!0,this.ScreenObject.LocationID=0,""!=de&&(this.ScreenObject.LocationID=N.J0.Int(this.DocDv[d][de+"_Key"].toString()));let me=0;W&&""!=le&&(me=N.J0.Int(this.DocDv[d][le+"_Key"].toString()));const ge=this.ScreenObject.GetProductTypeDetails(H.toString(),ue.Date,1,te,"0",null,!1,"",!0,me,null);if(null!=ge&&ge.Tables.length>0&&ge.Tables[0].includes("AvgRate")&&""!=ge.Tables[0].Rows[0].AvgRate.toString()){let Fe=0;Fe=N.J0.Int(N.J0.Int(ge.Tables[0].Rows[0].AvgRate.toString()("N"+I.d.SessionManager.Preferences.DecimalsinAmount))),this.DocDv[d][A.FieldName.toString()]=Fe,this.fldDict["RATE"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),this.DocDv[d][this.GrossField]=N.J0.Int(te*N.J0.Int(this.DocDv[d][this.RateField]("N"+I.d.SessionManager.Preferences.DecimalsinAmount)))}}else"RATE"==Q.ToUpper()&&this.fldDict["RATE"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]);if("quantity"==Q.toLowerCase()&&this.fldDict["QTY"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),"FreeQTY"==Q&&this.fldDict["FreeQTY"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),"EXCHANGERATE"==Q.ToUpper()&&(this.fldDict["EXCHANGERATE"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),Ve=N.J0.Int(this.DocDv[d][A.FieldName.toString()])),"gross"==Q.toLowerCase()&&this.fldDict["GROSS"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]),"docdate"==Q.toLowerCase())St=this.DocDv[d][A.FieldName.toString().Trim()];else if("duedate"==Q.toLowerCase())pt=this.DocDv[d][A.FieldName.toString().Trim()];else if("billno"==Q.toLowerCase())nt=this.DocDv[d][A.FieldName.toString()].replace("&","&amp;").Trim(),v.Append(Q+'="'+nt+'" ');else if("billwisedocno"==Q.toLowerCase())at=this.DocDv[d][A.FieldName.toString().Trim()];else if("accountid"==Q.toLowerCase())ke=this.DocDv[d][A.FieldName.toString().Trim()];else if("accountidcode"==Q.toLowerCase())ke=this.DocDv[d][A.FieldName.toString().Trim()],Ze=!0;else if("refno"==Q.toLowerCase()&&this.IsSnoBasedLinking&&Object.keys(this.ccdv).includes("400")&&Object.keys(this.ccdv).includes("43")){let O=null;var l=this.grData.Table.filter(H=>"-501"==H.FeatureFieldName);l.length>0&&(O=this.ccdv[400].ToTable().filter(H=>H.VoucherNo==this.ExcelTable[d][A[0].toString()].Trim()&&H.DocSeqNo==this.ExcelTable[d][l[0][0].toString()].Trim())),O.length()>0&&(v.Append(' LinkedInvDocDetailsID="').Append(O[0].InvDocDetailsID.toString()).Append('" '),v.Append(' RefNO="').Append(this.ExcelTable[d][A[0].toString()].Trim()).Append('" '),O=this.ccdv[43].ToTable().filter(H=>H.CostCenterIDLinked==O[0].CostCenterID.toString()),O.length()>0&&v.Append(' LinkedFieldName="').Append(O[0].SysColumnName.toString()).Append('" '))}else if("Batchno"==E[0].SysColumnName.toString()||"MfgDate"==E[0].SysColumnName.toString()||"ExpDate"==E[0].SysColumnName.toString()){if("MfgDate"==E[0].SysColumnName.toString()||"ExpDate"==E[0].SysColumnName.toString()){let O;O=(0,Ue._U)(this.DocDv[d][A.FieldName.toString().Trim()]),O&&be.Append(" "+E[0].SysColumnName.toString()).Append('="').Append(O.toLocaleDateString("dd/MMM/yyyy")).Append('" ')}else if(1==this.VoucherType){be.Append(' BatchID="0" '+E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString().Trim()]).Append('" ');try{if(this.ControlGen=new gt.ControlGenerator,this.ControlGen.LoadScreen_2(this,16),this.ControlGen.InitAutoCode(this.ControlGen.Data.Tables[9],!1),this.ControlGen.IsAutoCode&&(this.ControlGen.SetAutoCode(this.BatchCode,!1,1,this.ControlGen.Data.Tables[9]),!N.J0.StringIsNullOrEmpty(this.BatchCode.Text))){let O=0,H=0,te="";if(O=N.J0.Int(this.BatchCode.Text),d>0&&O>0){if(O+=d,H=N.J0.Int(this.ControlGen.Data.Tables[9].Rows[0].CodeNumberLength.toString()),H-=O.toString().length,H>0)for(let ue=0;ue<H;ue++)te+="0";this.BatchCode.Text=te+O.toString(),be.Append(" BatchCode").Append('="').Append(this.BatchCode.Text.Trim()).Append('" '),be.Append(" BatchCurrID").Append('="').Append(O).Append('" ')}else be.Append(" BatchCode").Append('="').Append(this.BatchCode.Text.Trim()).Append('" '),be.Append(" BatchCurrID").Append('="').Append(O).Append('" ')}}catch{}}else if(!o){let O=0;const H=N.J0.Int(this.DocDv[d][this.ProductFieldName+"_Key"]);let te,ue;te=(0,Ue._U)(this.DocDv[d][w].toString()),this.ScreenObject.DocDate.Date=te.Date,this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue),""!=de&&(this.ScreenObject.LocationID=N.J0.Int(this.DocDv[d][de+"_Key"].toString())),W&&""!=le&&(ue=(0,Ue._U)(this.DocDv[d][le+"_Key"].toString()));const me=this.ScreenObject.GetProductwiseBatches(H,O,this.VoucherType,null,ue,!0,"");if(null!=me&&me.Tables.length>0&&me.Tables[0].Rows.length>0&&!me.Tables[0].includes("ErrorMessage"))for(let ge of me.Tables[0].Rows)if(ge.BATCHNUMBER.toString()==this.DocDv[d][A.FieldName.toString().Trim()]){be.Append(' BatchID="'+ge.BatchID.toString()+'" '+E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString().Trim()]).Append('" Quantity="'+this.DocDv[d][this.QtyField].toString().Trim()+'"');break}}}else if("SerialNo"==E[0].SysColumnName.toString()){r=!0;let O=null;-1==this.VoucherType&&null!=this.DocDv[d][this.ProductFieldName+"_Key"]&&""!=this.DocDv[d][this.ProductFieldName+"_Key"].toString()&&(O=I.d.document.GetSerialNumberScreenDetails(parseInt(this.DocDv.ProductFieldName_Key),0,0,0,0,!1,""));let H=this.DocDv[d][A.FieldName.toString().Trim()].Split(",");if(H.length>0){Te.Append("<xml>");for(let te=0;te<H.length;te++){if(Te.Append("<Row "),Te.Append(" SerialProductID").Append('="0" '),Te.Append(" SerialNumber").Append('="').Append(k.Dw.GetValidXml(H[te].toString()).Trim()).Append('" '),0==te&&(this.strSerial=this.strSerial.concat(H)),1==this.VoucherType)Te.Append(" StatusID").Append('="157" '),Te.Append(" RefInvDocDetailsID").Append('="0" '),Te.Append(" IsAvailable").Append('="1" '),Te.Append(" SerialGUID").Append('="').Append(N.J0.NewGuid().toString()).Append('" ');else if(-1==this.VoucherType&&(Te.Append(" StatusID").Append('="158" '),null!=O&&O.Tables.length>1&&O.Tables[1].Rows.length>0)){let ue=O.Tables[1].filter(me=>me["SerialNumber="]==H[te].toString().Trim()+"'");null!=ue&&ue.length()>0&&(Te.Append(' RefInvDocDetailsID="').Append(ue[0].InvDocDetailsID.toString()).Append('" '),Te.Append(" IsAvailable").Append('="0" '),Te.Append(" SerialGUID").Append('="').Append(ue[0].SerialGUID.toString()).Append('" '))}Te.Append(" ></Row>")}Te.Append("</xml>")}}else if("DebitAmount"==E[0].SysColumnName.toString()&&null!=this.DocDv[d][A.FieldName.toString()]&&""!=this.DocDv[d][A.FieldName.toString().Trim()]&&N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])>0)tt=N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()]),""!=x&&""!=this.DocDv[d][x+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[d][x+"_Key"].toString())),""!=G&&""!=this.DocDv[d][G].toString()&&(Ve=N.J0.Int(this.DocDv[d][G].toString())),v.Append(this.ScreenObject.GetAccountTransaction(ke,"PactReservedAccount",Ze,tt.toString(),Oe,Ve));else if("CreditAmount"==E[0].SysColumnName.toString()&&null!=this.DocDv[d][A.FieldName.toString()]&&""!=this.DocDv[d][A.FieldName.toString().Trim()]&&N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])>0)tt=N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()]),""!=x&&""!=this.DocDv[d][x+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[d][x+"_Key"].toString())),""!=G&&""!=this.DocDv[d][G].toString()&&(Ve=N.J0.Int(this.DocDv[d][G].toString())),v.Append(this.ScreenObject.GetAccountTransaction("PactReservedAccount",ke,Ze,tt.toString(),Oe,Ve));else if("Attachments"==E[0].SysColumnName.toString())try{X=this.DocDv[d][A.FieldName.toString().Trim()];let O=X.split(";");for(let H in O);}catch{L=""}else if(null!=E[0].IsColumnUserDefined&&""!=E[0].IsColumnUserDefined.toString()&&(0,B.yG0)(E[0].IsColumnUserDefined.toString())){if("LISTBOX"==E[0].ColumnDataType.toString())5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&m&&I.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&I.d.SessionManager.Preferences.POSItemCodeDimension==E[0].ColumnCostCenterID.toString()&&""!=this.DocDv[d][A.FieldName.toString()]?v.toString().Contains("StockCode=")||v.Append(' StockCode="').Append(this.DocDv[d][A.FieldName.toString().Trim()]).Append('" '):""!=this.DocDv[d][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"])>0&&(5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)&&1==Y?E[0].UserColumnName.toString().Contains("TO")&&""!=this.DocDv[d][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"])>0&&(this.BulkSave?Ye.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):Ye.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")):E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("CCNID")?ve.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", "):5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)&&0==Y&&!E[0].UserColumnName.toString().Contains("TO")&&""!=this.DocDv[d][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"])>0?this.BulkSave?pe.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):pe.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", "):5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&""!=this.DocDv[d][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"])>0&&(this.BulkSave?pe.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):pe.toString().Contains(E[0].SysColumnName.toString()+"=")||pe.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")),"dcccnid2"==E[0].SysColumnName.toString().toLowerCase()?_e=N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==E[0].SysColumnName.toString().toLowerCase()&&(M=N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim())),40067==N.J0.Int(this.Feature.SelectedValue)&&this.fldDict["GROSS"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString()]));else if("CostCenterString"==E[0].ColumnDataType.toString()){if(5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&""!=this.DocDv[d][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"])>0){let O="dcCCNID"+(N.J0.Int(E[0].CostcenterID.toString())-5e4);pe.toString().Contains(O)||(this.BulkSave?pe.Append(O).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):pe.Append(O).Append("=").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")),"dcccnid2"==O.toLowerCase()?_e=N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==O.toLowerCase()&&(M=N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()))}}else if("TEXT"==E[0].ColumnDataType.toString()||"String"==E[0].ColumnDataType.toString()||"COMBOBOX"==E[0].ColumnDataType.toString()){let O=0;if(O=N.J0.Int(E[0].ColumnCostCenterID.toString()),44==O)E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("Alpha")?Ae.Append(Q).Append("='").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', "):this.BulkSave?ce.Append(Q).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):ce.Append(Q).Append("=N'").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ");else if(O>0)this.BulkSave?ce.Append(Q).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):ce.Append(Q).Append("=N'").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ");else if(E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("Alpha"))Ae.Append(Q).Append("='").Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append("', ");else if(E[0].UserColumnType.toString().toLowerCase().Contains("date")){let H;if(H=(0,Ue._U)(this.DocDv[d][A.FieldName.toString().Trim()]),this.EDate)if("date"==E[0].UserColumnType.toString().toLowerCase()){if(this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")).Append("', "),40067==N.J0.Int(this.Feature.SelectedValue)){let te;this.fldDict["Date"+E[0].SysColumnName.toString().TrimEnd("*")].setFieldValue(this.EDate.toLocaleDateString("dd/MMM/yyyy")[d][A.FieldName.toString()]),te=this.GetDailyAttendanceDetails(0,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),H.Date,0,0,"",""),te&&ce.Append(te)}}else if("datetime"==E[0].UserColumnType.toString().toLowerCase())if(40067==N.J0.Int(this.Feature.SelectedValue)){let te,ue,me;if(H=(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult().toString()+" "+this.DocDv[d][A.FieldName.toString().Trim()]),this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+H.TimeOfDay.toString()).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+H.TimeOfDay.toString()).Append("', "),this.fldDict["Date"+E[0].SysColumnName.toString().TrimEnd("*")].setFieldValue(this.EDate.toLocaleDateString("dd/MMM/yyyy")[d][A.FieldName.toString()]),te=this.GetDailyAttendanceDetails(2,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),H.Date,0,0,this.fldDict.dcAlpha2.getFieldResult().toString(),this.fldDict.dcAlpha3.getFieldResult().toString()),""!=te.toString()){ne.Append(te);let ge=this.GetDailyAttendanceDetails(1,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult()),ue,me,"","");null!=ge&&ne.Append(ge),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1"')}}else this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")).Append("', ")}else if("attachment"==E[0].UserColumnType.toString().toLowerCase())try{X=this.DocDv[d][A.FieldName.toString().Trim()]}catch{L=""}else if(40068==N.J0.Int(this.Feature.SelectedValue)&&(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString()]).Trim().toLowerCase().Contains("earning")||k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString()]).Trim().toLowerCase().Contains("deduction")))k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString()]).Trim().toLowerCase().Contains("earning")?this.BulkSave?ce.Append(Q).Append('="').Append(2).Append('" '):ce.Append(Q).Append("=N'").Append(2).Append("', "):k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString()]).Trim().toLowerCase().Contains("deduction")&&(this.BulkSave?ce.Append(Q).Append('="').Append(3).Append('" '):ce.Append(Q).Append("=N'").Append(3).Append("', ")),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ');else{let H=this.DocDv[d][A.FieldName.toString().Trim()];if(H.Contains("\n")){let te=N.J0.Int(I.d.SessionManager.Preferences.CtrlTFontSize),ue=H.Split("\n");if(null!=ue&&ue.length>0){let me='"',ge="<FlowDocument FontFamily="+me+I.d.SessionManager.Preferences.CtrlTFontName+me+" FontSize="+me+te+me+" xmlns="+me+"http://schemas.microsoft.com/winfx/2006/xaml/presentation"+me+">";for(let Fe=0;Fe<ue.length;Fe++)ge+="<Paragraph>"+k.Dw.GetValidTextXml(ue[Fe])+"</Paragraph>";ge+="</FlowDocument>",this.BulkSave?ce.Append(Q).Append('="').Append(k.Dw.GetValidXml(ge)).Append('" '):ce.Append(Q).Append("=N'").Append(k.Dw.GetValidXml(ge)).Append("', ")}}else this.BulkSave?ce.Append(Q).Append('="').Append(k.Dw.GetValidTextXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '):(ce.Append(Q).Append("=N'").Append(k.Dw.GetValidTextXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append("', "),this.IsInventory&&5==this.ProductTypeID&&!N.J0.StringIsNullOrEmpty(this.BatchBasedon)&&Q.toLowerCase()==this.BatchBasedon.toLowerCase()&&"1"==this.DocDv[d][A.FieldName.toString()]&&(this.IgnoreBatch=1))}}else if(null!=this.DocDv[d][A.FieldName.toString()]&&""!=this.DocDv[d][A.FieldName.toString().Trim()])if("ProductString"==E[0].ColumnDataType.toString())this.DocDv.includes("TempProductName")&&""!=this.DocDv[d].TempProductName.toString().Trim()?v.Append("ProductID").Append('="').Append(k.Dw.GetValidXml(this.DocDv[d].TempProductName.toString().Trim())).Append('" '):this.DocDv.includes("TempProductCode")&&v.Append(' IsProductCode="1" ProductID').Append('="').Append(k.Dw.GetValidXml(this.DocDv[d].TempProductCode.toString().Trim())).Append('" ');else if(null!=E[0].IsCalculate&&""!=E[0].IsCalculate.toString()&&"0"==E[0].IsCalculate.toString()&&""!=E[0].Formula.toString()){this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append(", ");let O="";try{let H=this.fldDict;q=I.d.eval.EvaluateExpression(E[0].Formula.toString(),H).toString(),this.BulkSave?(ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(q).Append('" '),ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(q).Append('" ')):(ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(q).Append(", "),ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(q).Append(", ")),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(q)}catch(H){return this.DisplayMessage="Error during calculating formula  "+E[0].Formula.toString()+" , Message :"+H.Message,void(this.MessageVisibility=!0)}for(const[H,te]of Object.entries(this.fldDict))O=O+"\n "+H+"=:"+te.toString()}else if("CostCenterString"!=E[0].ColumnDataType.toString())if(40067==N.J0.Int(this.Feature.SelectedValue)&&"36560"==String(A.FeatureFieldName)){let O="";if(""!=this.DocDv[d][A.FieldName.toString()])O=this.DocDv[d][A.FieldName.toString().Trim()],this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString().Trim()]),this.BulkSave?ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '):ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append(", ");else{let te;te=this.fldDict.dcAlpha3.getFieldResult()-this.fldDict.dcAlpha2.getFieldResult(),O=te.Hours+"."+te.Minutes,this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(O)).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(O)).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(O.toString()),this.BulkSave?ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(N.J0.Int(O)).Append('" '):ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(N.J0.Int(O)).Append(", ")}let H=this.GetDailyAttendanceDetails(1,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult()),this.intValidDay,N.J0.Int(O),"","");""!=String(H)&&ne.Append(H),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ')}else this.BulkSave?(ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString().Trim()]),ne.Append("dcCalcNum"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),I.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,B.yG0)(I.d.SessionManager.Preferences["Use Foreign Currency"])&&(ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])*Ve).Append('" '),ne.Append("dcCurrID"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(Oe).Append('" '),ne.Append("dcExchRT"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(Ve).Append('" '))):(ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[d][A.FieldName.toString().Trim()]),ne.Append("dcCalcNum"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append(", "),I.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,B.yG0)(I.d.SessionManager.Preferences["Use Foreign Currency"])&&(ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])*Ve).Append(", "),ne.Append("dcCurrID"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(Oe).Append(", "),ne.Append("dcExchRT"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(Ve).Append(", ")))}else if("DATE"==E[0].ColumnDataType.toString())Ne=(0,Ue._U)(this.DocDv[d][A.FieldName.toString()]),Ne&&(E[0].UserColumnName.toString().Contains("Batch_")&&!E[0].SysColumnName.toString().Contains("alpha")&&he.Append(Q).Append("='").Append(Ne.toLocaleDateString("dd/MMM/yyyy")).Append("', "),""!=this.DocDv[d][A.FieldName.toString().Trim()]&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(Ne.toLocaleDateString("dd/MMM/yyyy")).Append('" '));else if("quantity"!=Q.toLowerCase()&&"FreeQTY"!=Q||v.toString().Contains("Quantity="))if("AVGRATE"!=E[0].SysColumnName.toString()&&"AVGRATEVALUE"!=E[0].SysColumnName.toString()||"FLOAT"!=E[0].ColumnDataType.toString()||null==this.DocDv[d][A.FieldName.toString()]||""==this.DocDv[d][A.FieldName.toString().Trim()])if((E[0].SysColumnName.toString().EndsWith("Rate")||E[0].SysColumnName.toString().EndsWith("ExchRT"))&&E[0].UserColumnName.toString().Contains("Batch_")){let O=0;O=parseFloat(this.DocDv[d][A.FieldName.toString().Trim()]),O>0&&he.Append(E[0].SysColumnName.toString()).Append("='").Append(O).Append("', ")}else if("Amount"!=E[0].SysColumnName.toString()&&"FLOAT"==E[0].ColumnDataType.toString()&&null!=this.DocDv[d][A.FieldName.toString()]&&""!=this.DocDv[d][A.FieldName.toString().Trim()]&&"ExchangeRate"!=E[0].SysColumnName.toString())v.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ');else if("ProductString"==E[0].ColumnDataType.toString())this.DocDv.includes("TempProductName")&&""!=this.DocDv[d].TempProductName.toString().Trim()?v.Append("ProductID").Append('="').Append(k.Dw.GetValidXml(this.DocDv[d].TempProductName.toString().Trim())).Append('" '):this.DocDv.includes("TempProductCode")&&v.Append(' IsProductCode="1" ProductID').Append('="').Append(k.Dw.GetValidXml(this.DocDv[d].TempProductCode.toString().Trim())).Append('" '),v.Append(' IsProductBarcode="1" ');else if("ProductID"==E[0].SysColumnName.toString())if(ie=!0,this.BulkSave)v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString()).Append('" ');else if(this.ProfileID>-20&&this.ProfileID<0&&this.ExcelTable.includes("TMOCODE_Key"))v.Append(' IsProductBarcode="0" '),v.Append(' IsProductCode="2" '),v.Append(' ProductID="').Append(this.DocDv[d].TMOCODE_Key.toString().Trim()).Append('" ');else if(this.IsProductwiseBarcode){let O=!1;E.includes("parentccdefaultcolid")&&"261"==E[0].parentccdefaultcolid.toString().toLowerCase()&&(v.Append(' IsProductCode="1" '),O=!0),this.ReadBarcode(O,this.DocDv[d],this.DocDv[d][A.FieldName.toString().Trim()],A.FieldName.toString()),v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),v.Append(' IsProductBarcode="1" ')}else v.Append(' IsProductBarcode="0" '),E.includes("parentccdefaultcolid")&&"261"==E[0].parentccdefaultcolid.toString().toLowerCase()?(v.Append(' IsProductCode="1" '),v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ')):v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ');else if("CurrencyID"==E[0].SysColumnName.toString())Oe=N.J0.Int(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim());else if("ExchangeRate"==E[0].SysColumnName.toString())Ve=N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()]);else if(E[0].SysColumnName.toString().EndsWith("CurrID")&&E[0].UserColumnName.toString().Contains("Batch_")){let O=this.CostCenterFieldsAllTables.Tables[6];O.RowFilter="IsBaseCurrency='True'",O.length>0&&he.Append(E[0].SysColumnName.toString()).Append("='").Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ")}else if("ExchangeRate"==E[0].SysColumnName.toString())kt&&(Ve=N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()]));else if("DebitAccount"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(d,2,E[0].SysColumnName.toString(),!1,!0),v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString()).Append('" '),ke=this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):(ke=this.DocDv[d][A.FieldName.toString().Trim()],this.IsInventory&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '));else if("DebitAccountCode"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(d,2,E[0].SysColumnName.toString(),!1,!0),v.Append(' DebitAccount="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString()).Append('" '),ke=this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):(ke=this.DocDv[d][A.FieldName.toString().Trim()],Ze=!0,this.IsInventory&&(v.Append(' DebitAccount="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),Ze&&v.Append(' DrAccCode="1" ')));else if("CreditAccount"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(d,2,E[0].SysColumnName.toString(),!1,!0),v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString()).Append('" '),$e=this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):($e=this.DocDv[d][A.FieldName.toString().Trim()],this.IsInventory&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '));else if("CreditAccountCode"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(d,2,E[0].SysColumnName.toString(),!1,!0),v.Append(' CreditAccount="').Append(this.DocDv[d][A.FieldName.toString()+"_Key"].toString()).Append('" '),$e=this.DocDv[d][A.FieldName.toString()+"_Key"].toString().Trim()):($e=this.DocDv[d][A.FieldName.toString().Trim()],ut=!0,this.IsInventory&&(v.Append(' CreditAccount="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),ut&&v.Append(' CrAccCode="1" ')));else if("Unit"==E[0].SysColumnName.toString()){if(vt=this.DocDv[d][A.FieldName.toString().Trim()],Ut=!0,this.IsInventory)if(this.ExcelTable.includes(A.FieldName+"_Key")){let O;if(v.Append(' Unit="').Append(this.DocDv[d][A.FieldName+"_Key"].toString().Trim()).Append('" '),O=this.ExcelTable.includes(this.ProductFieldName+"_Key")&&N.J0.StringIsNullOrEmpty(this.DocDv[d][this.ProductFieldName+"_Key"].toString())?I.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(this.DocDv[d][A.FieldName+"_Key"])+" WHERE P.ProductID = 1"):I.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(this.DocDv[d][A.FieldName+"_Key"])+" WHERE P.ProductID = "+N.J0.Int(this.DocDv[d][this.ProductFieldName+"_Key"])),null!=O&&O.Tables.length>0&&O.Tables[0].Rows.length>0)if(O.Tables[0].includes("Conversion")&&""!=O.Tables[0].Rows[0].Conversion.toString()){let H=1;H=parseFloat(O.Tables[0].Rows[0].Conversion.toString()),v.Append(' UOMConversion="').Append(H.toString()).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[d][this.QtyField].toString().Trim())*H).Append('" ')}else v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[d][this.QtyField].toString().Trim())).Append('" ');else v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[d][this.QtyField].toString().Trim())).Append('" ')}else Ut&&(v.Append(' Unit="1" '),v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[d][this.QtyField].toString().Trim())).Append('" '))}else if("Amount"!=E[0].SysColumnName.toString()||this.IsInventory)""!=E[0].SysColumnName.toString()&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ');else{let O="",H="";""!=ke?O=ke:""!=U&&(O=this.DocDv[d][U].toString().Trim(),Ze=this.IsDrFieldCode),""!=$e?H=$e:""!=P&&(H=this.DocDv[d][P].toString().Trim(),ut=this.IsCrFieldCode),tt=N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()]),""!=x&&""!=this.DocDv[d][x+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[d][x+"_Key"].toString())),""!=G&&""!=this.DocDv[d][G].toString()&&(Ve=N.J0.Int(this.DocDv[d][G].toString())),v.Append(this.getAccountTransaction(O,H,Ze,ut,tt.toString(),Oe,Ve))}else"AVGRATE"==E[0].SysColumnName.toString()?(v.Append("Rate").Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),v.Append("AverageRate").Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ')):v.Append("Gross").Append('="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ');else{let O;O=O=parseFloat(this.DocDv[d][R].toString()),""!=R&&this.DocDv.includes(R)&&""!=this.DocDv[d][R].toString()&&O&&N.J0.Int(this.DocDv[d][R].toString())>0?(v.Append(' Quantity="').Append(N.J0.Int(this.DocDv[d][R].toString().Trim())).Append('" '),v.Append(' IsQtyFreeOffer="1" ')):"quantity"==Q.toLowerCase()&&(v.Append(' Quantity="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" '),""==this.UnitFieldName.Trim()&&(v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[d][A.FieldName.toString().Trim()])).Append('" ')))}if(null!=E[0].PostingType&&""!=E[0].PostingType.toString()&&this.IsInventory){if(""==q&&(q=this.DocDv[d][A.FieldName.toString().Trim()]),re=parseFloat(q),!u&&(3==N.J0.Int(E[0].PostingType.toString())||4==N.J0.Int(E[0].PostingType.toString()))&&""!=q&&re&&0!=N.J0.Int(q)){let O;O.Append("<Accounts "),this.BulkSave&&O.Append('DocSeqNo="'+(d+1).toString()+'" ');let H="",te="";var i;""!=E[0].DrRefColID.toString()&&N.J0.Int(E[0].DrRefColID.toString())>0?(i=this.grData.Table.filter(ue=>ue.FeatureFieldName==E[0].DrRefID.toString())).length>0?H=this.ExcelTable.includes(i[0].FieldName.toString()+"_Key")&&""!=this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString()?this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),0,this.DocDv[d][i[0].FieldName.toString()]).toString():(i=this.costCenterTableZero.filter(ue=>ue.CostcenterColID===E[0].DrRefID.toString())).length>0&&("2"==i[0].Columncostcenterid.toString()?(this.costCenterTableZero.filter(ue=>ue.SysColumnName===i[0].SysColumnName.toString()+"Code"),i=this.costCenterTableZero.filter(ue=>ue.SysColumnName===i[0].SysColumnName.toString()+"Code")):i=this.costCenterTableZero.filter(ue=>ue.SysColumnName===i[0].SysColumnName.toString()+"' AND CostcenterColID<>"+i[0].CostcenterColID.toString()),i.length>0&&(i=this.grData.Table.filter(ue=>ue.FeatureFieldName==i[0].CostcenterColID.toString())).length>0&&(H=this.ExcelTable.includes(i[0].FieldName.toString()+"_Key")&&""!=this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString()?this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),N.J0.Int(this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString())).toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),0,this.DocDv[d][i[0].FieldName.toString()],!0).toString())):null!=E[0].DebitAccount&&""!=E[0].DebitAccount.toString()&&N.J0.Int(E[0].DebitAccount.toString())>0?H=E[0].DebitAccount.toString():""!=ke?H=ke:""!=U&&(this.BulkSave?(this.CheckBulkCostCenterField(d,2,U,!1,!0),H=this.DocDv[d][U+"_Key"].toString().Trim()):H=this.DocDv[d][U].toString().Trim()),""!=E[0].CrRefColID.toString()&&N.J0.Int(E[0].CrRefColID.toString())>0?(i=this.grData.Table.filter(me=>me.FeatureFieldName==i[0].CrRefID.toString())).length>0?te=this.ExcelTable.includes(i[0].FieldName.toString()+"_Key")&&""!=this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString()?this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),0,this.DocDv[d][i[0].FieldName.toString()]).toString():(i=this.costCenterTableZero.filter(me=>me.CostcenterColID===i[0].CrRefID.toString())).length>0&&(i="2"==i[0].Columncostcenterid.toString()?this.costCenterTableZero.filter(me=>me.SysColumnName===i[0].SysColumnName.toString()+"Code"):this.costCenterTableZero.filter(me=>me.SysColumnName===i[0].SysColumnName.toString()+"' AND CostcenterColID<>"+i[0].CostcenterColID.toString())).length>0&&(i=this.grData.Table.filter(me=>me.FeatureFieldName==i[0].CostcenterColID.toString())).length>0&&(te=this.ExcelTable.includes(i[0].FieldName.toString()+"_Key")&&""!=this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString()?this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),N.J0.Int(this.DocDv[d][i[0].FieldName.toString()+"_Key"].toString())).toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),0,this.DocDv[d][i[0].FieldName.toString()],!0).toString()):null!=E[0].CreditAccount&&""!=E[0].CreditAccount.toString()&&N.J0.Int(E[0].CreditAccount.toString())>0?te=E[0].CreditAccount.toString():""!=$e?te=$e:""!=P&&(this.BulkSave?(this.CheckBulkCostCenterField(d,2,P,!1,!0),te=this.DocDv[d][P+"_Key"].toString().Trim()):te=this.DocDv[d][P].toString().Trim()),O.Append(this.getAccountTransaction(H.toString(),te.toString(),!1,!1,q,Oe,Ve)),O.Append(" ></Accounts>"),De.Append(O.toString()),this.FillBillWiseDt(We,te.toString(),q,!0),this.FillBillWiseDt(We,H.toString(),q,!1)}(2==N.J0.Int(E[0].PostingType.toString())||4==N.J0.Int(E[0].PostingType.toString()))&&""!=q&&re&&0!=N.J0.Int(q)&&(ht+=N.J0.Int(q))}38==this._DocumentType&&("5"==E[0].SectionID.toString()||"6"==E[0].SectionID.toString()||"7"==E[0].SectionID.toString()||"8"==E[0].SectionID.toString()||"9"==E[0].SectionID.toString()||"10"==E[0].SectionID.toString()||"11"==E[0].SectionID.toString()||"12"==E[0].SectionID.toString()||"13"==E[0].SectionID.toString())&&""!=this.DocDv[d][A.FieldName.toString()]&&(this.PosPayModesXML.Append('<XML Amount="').Append(this.DocDv[d][A.FieldName.toString()]).Append('" '),this.PosPayModesXML.Append(' AvailAmount="').Append("").Append('" '),this.PosPayModesXML.Append(' DBColumnName="').Append(Q).Append('" '),this.PosPayModesXML.Append(' Type="').Append(E[0].SectionID.toString()).Append('" '),this.PosPayModesXML.Append(' DocDate="').Append((0,Ue._U)(this.DocDv[d][w].toString())).Append('" '),this.PosPayModesXML.Append(' RegisterID="').Append(this.DocDv[d][this.PosRegisterField+"_Key"].toString()).Append('" '),this.PosPayModesXML.Append(' ShiftID="').Append(this.DocDv[d][this.PosShiftField+"_Key"].toString()).Append('" '),this.PosPayModesXML.Append(" />"))}this.IsInventory&&(v.Append(this.DonotUpdateInventory?'IsQtyIgnored="1" ':'IsQtyIgnored="0" '),v.Append('StockValue="').Append((ht*Ve).toString()).Append('" '),v.Append('StockValueFC="').Append(ht.toString()).Append('" '),v.Append('CurrencyID="').Append(Oe.toString()).Append('" '),v.Append('ExchangeRate="').Append(Ve.toString()).Append('" '),ie||(E.filter(A=>"Productid"==A.SysColumnName),this.ProductID=N.J0.Int(E[0].UserDefaultValue.toString()),E.length>0&&""!=E[0].UserDefaultValue.toString()&&this.ProductID&&this.ProductID>0&&v.Append(' ProductID="').Append(this.ProductID.toString()).Append('" IsProductCode="2" '))),(3==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||8==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||13==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString()))&&(3==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||13==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||8==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString()))&&(v.toString().Contains("DebitAccount=")||v.Append('DebitAccount="PactReservedAccount" '),v.toString().Contains("CreditAccount=")||v.Append(' CreditAccount="PactReservedAccount" ')),40062==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="-62" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="-62"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40051==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40069==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40089==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&1==Y?(this.BulkSave?pe.Append(Ye).Append(" ></CostCenters>"):pe.Append(Ye).Append('" ></CostCenters>'),v.Append(' VoucherType="1" ')):(pe.Append(this.BulkSave?" ></CostCenters>":'" ></CostCenters>'),5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&v.Append(' VoucherType="-1" ')),!this.IsInventory&&!N.J0.StringIsNullOrEmpty(at)&&v.Append(' BillWiseDocNo="').Append(at).Append('" '),v.Append(" ></Transactions>"),this.BulkSave?(ne.Append(" ></Numeric>"),ce.Append(" ></Alpha>")):(ne.Append('" ></Numeric>'),ce.Append('" ></Alpha>'),De.Append("</AccountsXML>")),(o&&-1==this.VoucherType&&!r||1==this.VoucherType&&this.ProfileID>-20&&this.ProfileID<0)&&""!=this.DocDv[d].BATCHNUMBER_Sys.toString()&&""!=this.DocDv[d][this.QtyField].toString()&&N.J0.Int(this.DocDv[d][this.QtyField].toString())>0&&be.Append('  ProductID="'+this.ProductID+'" Batchno="'+this.DocDv[d].BATCHNUMBER_Sys.toString()+'" BatchID="'+this.DocDv[d].BatchID.toString()+'" Quantity="'+this.DocDv[d][this.QtyField].toString()+'" '),be.length>0&&(be.Insert(0,"<xml><Row  "),be.Append(1==this.VoucherType?'  StaticFieldsQuery="'+he+'"   TextFields="'+Ae+'"   CCFields="'+ve+'" ></Row></xml> ':" ></Row></xml> ")),this.BulkSave||(De.Append(v.toString()+ne.toString()+ce.toString()+pe.toString()+"<EXTRAXML>"+be+Te+"</EXTRAXML>"),De.Append("</Row>")),Y++}while(5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&1==Y);be=" ",Te=" "}if(this.IsInventory||De.Append("</DocumentXML>"),Ke.Append("</AttachmentsXML>"),this.IsInventory&&this.FillLocRefVisibility&&this.FillLocalReference&&this.DocItems.Items.length>0&&5==this.ProductTypeID&&!N.J0.StringIsNullOrEmpty(this.BatchBasedon)){let Y="",Q="",ie=null;for(let A=0;A<this.DocItems.Items.length;A++)if(this.DocItems.Items[A].IsChecked){let q=this.costCenterTableZero.filter(O=>O.CostcenterColID===this.DocItems.Items[A].Value),re=this.grData.Table.filter(O=>O.CostcenterColID===this.DocItems.Items[A].Value);if(re.length>0&&(Q=this.IsCode?2==N.J0.Int(q[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(q[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(q[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(q[0].ColumnCostCenterID)?"ProductName":"Name",Y="SELECT "+q[0].ParentCostCenterColSysName+" ID FROM "+q[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+Q+"='"+this.DocDv[d-1][re[0].FieldName.toString()]+"'",ie=I.d.document.GetDataSet(Y),null!=ie&&ie.length>0)){Y="";let O=[];O.push(this.DocItems.Items[A].Value),O.push(this.Feature.SelectedValue),O.push(ie[0].ID.toString()),O.push(new Date("dd/MMM/yyyy")),O.push(0),O.push("<XML></XML>"),O.push(0),O.push(I.d.SessionManager.LanguageID);let H=I.d.document.GetReferenceData(JSON.stringify(O));if(null!=H&&H.Tables[0].Rows.length>0)for(let te=0;te<H.Tables[0].Columns.length;te++)H.Tables[0].Columns[te].ColumnName.toString().toLowerCase()==this.BatchBasedon.toLowerCase()&&"1"==H.Tables[0].Rows[0][H.Tables[0].Columns[te].ColumnName.toString()]&&(this.IgnoreBatch=1)}}}if(""!=De.toString()){if(this.BulkSave){v.Insert(0,"<DocXML>"),ne.Insert(0,"<NumXML>"),ce.Insert(0,"<TextXML>"),pe.Insert(0,"<CCXML>"),De.Insert(0,"<AccXML>"),Ge.Insert(0,"<EXTRAXML>"),Je.Insert(0,"<DocExtraXML>"),v.Append("</DocXML>"),ne.Append("</NumXML>"),ce.Append("</TextXML>"),pe.Append("</CCXML>"),De.Append("</AccXML>"),Ge.Append("</EXTRAXML>"),Je.Append("</DocExtraXML>");let ie=[];ie.push(De.toString()),ie.push(v.toString()),ie.push(ne.toString()),ie.push(ce.toString()),ie.push(pe.toString()),ie.push(Ge.toString()),ie.push(Je.toString()),Logger.DebugLog("BulkImportUtility-Rows "+De.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+ne.toString()),Logger.DebugLog("BulkImportUtility-Text "+ce.toString()),Logger.DebugLog("BulkImportUtility-CC "+pe.toString())}K!=Ie&&(this.PrevDocID=0);let Y=0;this.strSerial.length>0&&(Y=this.strSerial.length),this.strSerial.length>0&&this.strSerial.length!=Y&&(this.DocDv[d-fe].xIMP_STATUSx="FAIL",this.DocDv[d-fe].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(d-fe),V++,this.FailedRecourdList.push({Name:Qe+"-"+ae,Message:this.ErrorMessage}),this.strSerial=[]);let Q=this.SaveDocument($,rt,_,St,pt,nt,this.IsInventory,De.toString(),Ke.toString(),We,at,M,_e,this.fldDict,Oe,Ve,this.argParam);if($=Q.docId,this.ErrorMessage=Q.errorMessage,$<1){if(this.DocDv[d-fe].xIMP_STATUSx="FAIL",this.DocDv[d-fe].IMPORT_MESSAGE=this.ErrorMessage,this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[d-fe].RevenUStatus="Failed",this.DocDv[d-fe].RevenUReason=this.ErrorMessage),V++,!(this.ProfileID>-20&&this.ProfileID<0)){for(let A=0;A<this.grData.Table.length;A++)if(this.DocDv.filter(""!=f?q=>q.DocNumberField==ae:q=>q.VoucherNoField==ae),this.DocDv.includes(this.grData.Table[A][0].toString()+"_Key")&&this.DocDv.length>0)for(let q=0;q<this.DocDv.length;q++)""==this.DocDv[q][this.grData.Table[A][0].toString()+"_Key"].toString()&&this.FailedRecourdList.push({Name:Qe+"-"+ae,Message:"Invalid "+this.grData.Table[A][0].toString()+" at Row No:"+(q+1)});let ie;ie=this.ExcelTable.includes("IMPORT_STATUS")?this.DocDv.filter(A=>null==A.IMPORT_STATUS||"PASS"==A.IMPORT_STATUS):""}this.FailedRecourdList.push({Name:Qe+"-"+ae,Message:this.ErrorMessage}),this.strSerial=[]}else this.DocDv[d-fe].xIMP_STATUSx="PASS",this.DocDv[d-fe].IMPORT_MESSAGE="",this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[d-fe].RevenUStatus="pass",this.DocDv[d-fe].RevenUReason=this.ErrorMessage),T++,this.strSerial=[];if(this.IgnoreBatch=0,null!=this.ErrorMessage&&this.ErrorMessage.Contains("Saved")&&this.FillLocRefVisibility&&this.FillLocalReference&&this.DocItems.Items.length>0){let ie="",A="",q="",O=null;this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue);const H=this.ScreenObject.GetProductTypeDetails(this.DocDv[d-1][this.ProductFieldName+"_Key"].toString(),(0,Ue._U)(this.DocDv[d-1][w].toString()),1,N.J0.Int(this.DocDv[d-1][this.QtyField]),"0",null,!1,"",!0,0,null);null!=H&&H.Tables.length>4&&H.Tables[4].Rows.length>0&&H.Tables[4].Columns[0].ColumnName.Contains("SysColumnName")&&(ie='"UPDATE TXT SET " + dsPrd.Tables[4].Rows[0]["SysColumnName"].toString() + "=" + dsPrd.Tables[4].Rows[0]["Value"].toString() + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNUMData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(ie));for(let te=0;te<this.DocItems.Items.length;te++)if(this.DocItems.Items[te].IsChecked){let ue=this.costCenterTableZero.filter(ge=>ge.CostcenterColID===this.DocItems.Items[te].Value),me=this.grData.Table.filter(ge=>ge.FeatureFieldName===this.DocItems.Items[te].Value);if(me.length>0&&(q=this.IsCode?2==N.J0.Int(ue[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(ue[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(ue[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(ue[0].ColumnCostCenterID)?"ProductName":"Name",ie="SELECT "+ue[0].ParentCostCenterColSysName+" ID FROM "+ue[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+q+"='"+this.DocDv[d-1][me[0].FieldName.toString()]+"'",O=I.d.document.GetDataSet(ie),null!=O&&O.length>0)){ie="";let ge=[];ge.push(this.DocItems.Items[te].Value),ge.push(this.Feature.SelectedValue),ge.push(O[0].ID.toString()),ge.push(new Date("dd/MMM/yyyy")),ge.push(0),ge.push("<XML></XML>"),ge.push(0),ge.push(I.d.SessionManager.LanguageID);const Fe=I.d.document.GetReferenceData(JSON.stringify(ge));if(null!=Fe&&Fe.Tables[0].Rows.length>0)for(let J=0;J<Fe.Tables[0].length;J++)A=Fe.Tables[0].Columns[J].ColumnName.toString(),A.Contains("dcAlpha")&&!A.endsWith("Name")?(ie='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=\'" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(ie)):A.Contains("dcAlpha")&&A.endsWith("Name")?(ie='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString().replace("Name", "") + "=\'" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                         JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                         WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(ie)):A.Contains("dcNum")||A.Contains("dcCalcNum")?(ie='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNumData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(ie)):A.Contains("dcCCNID")&&!A.Contains("Group")&&!A.Contains("Name")&&!A.Contains("Code")&&!A.Contains("lft")&&!A.Contains("rgt")&&(ie='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocCCData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(ie))}}}}if(this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount=this.IsSaveDocValidate?"Valid :"+T.toString():"Imported :"+T.toString(),this.FailedCount="Failed :"+V.toString(),this.RefreshGrid=!this.RefreshGrid,this.grData.RefreshGrid=!0,this.MessageVisibility=!0,this.DisplayMessage=this.IsSaveDocValidate?"Validation completed ( Total :"+(T+V).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )":"Import completed ( Total :"+(T+V).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.ProfileID>-20&&this.ProfileID<0)if(this.UpdateStatusInExcel)try{const Y=this.workbookK,Q=Y.SheetNames[0];let A=et.Wp.sheet_to_json(Y.Sheets[Q],{header:1}),q=A[0];const re=Z=>(q.includes(Z)||(q.push(Z),A[0]=q),q.indexOf(Z));let O=re("TMOCODE"),H=re("Green Code"),te=re("RevenUStatus"),ue=re("RevenUReason");for(let Z=1;Z<A.length;Z++){if("1"===this.ExcelTable[Z-1]?.IsNewRow)continue;let Xe=A[Z];(!Xe[te]||"Passed"!==Xe[te])&&("pass"===this.ExcelTable[Z-1]?.RevenUStatus?(Xe[te]="Passed",this.ExcelTable[Z-1].RevenUStatus="Passed"):Xe[te]=this.ExcelTable[Z-1]?.RevenUStatus||"",Xe[O]=this.ExcelTable[Z-1]?.TMOCODE||"",Xe[H]=this.ExcelTable[Z-1]?.["Green Code"]||"",Xe[ue]=this.ExcelTable[Z-1]?.RevenUReason||""),A[Z]=Xe}const me=et.Wp.aoa_to_sheet(A);Y.Sheets[Q]=me;const ge=et.M9(Y,{bookType:"xlsx",type:"array"}),Fe=new Blob([ge],{type:"application/octet-stream"}),J=document.createElement("a");J.href=URL.createObjectURL(Fe),J.download="Updated_File.xlsx",J.click()}catch(Y){console.error("Error updating Excel:",Y)}else this.UpdateExcelSheet()}}catch(u){Logger.ErrorLog("importuitlity","ImportDocument ",u.Message,u)}Logger.InfoLog("Exiting ImportDocument ")}setQuery(){let e,s,l;const i=parseInt(this.Feature.SelectedValue,10);let u="";const h="INV_DocDetails";u="acc_docdetails"===h.toLowerCase()?"D.AccDocDetailsID":"D.InvDocDetailsID";let r,m,c,n,t=[],o=[],a=0;const g={};g[h]="D",t.push(u),o.push(`${h} D with(nolock)`);for(const T of this.grData.Table){if(s=this.costCenterTableZero.filter(d=>d.CostCenterColID===parseInt(T[1],10)),e=s[0],c="T"+a,m=e.SysTableName||h,r=e.SysColumnName,l=null!=e.ColumnCostCenterID?parseInt(e.ColumnCostCenterID,10):0,i>4e4)if("COM_DocTextData"===m)if(g.COM_DocTextData||(g.COM_DocTextData="TXT",o.push(`INNER JOIN COM_DocTextData TXT with(nolock) ON TXT.${u}=D.${u}`)),"DATE"===e.ColumnDataType)r=`convert(datetime,${r})`,t.push(`'' AS C${a}`),t.push(`${r} AS C${a}_Key`);else if("LISTBOX"===e.UserColumnType){let d;if("44"===e.ColumnCostCenterID.toString())d=`,case when ${r} is not null and isnumeric(${r})=1 then (SELECT Name FROM COM_Lookup with(nolock) WHERE NodeID=${r}) else '' end`;else{let S,F,y,C=I.d.report.GetTableColumns(parseInt(e.ColumnCostCenterID));C.TableName=S,C.PrimaryKey=F,C.ColumnName=y,d=`,case when ${r} is not null and isnumeric(${r})=1 then (SELECT ${y} FROM ${S} with(nolock) WHERE ${F}=${r}) else '' end`}t.push(`${d} AS C${a}`),t.push(`case when isnumeric(${r})=1 then ${r} else convert(bigint,-1) end AS C${a}_Key`)}else"LOOKUP"===e.UserColumnType?(t.push(`${r} AS C${a}`),t.push(`${r} AS C${a}_Key`)):t.push(`${r} AS C${a}`);else"COM_DocNumData"===m?(g.COM_DocNumData||(g.COM_DocNumData="NUM",o.push(`INNER JOIN COM_DocNumData NUM with(nolock) ON NUM.${u}=D.${u}`)),t.push(`${r} AS C${a}`)):"COM_DocCCData"===m?(g.COM_DocCCData||(g.COM_DocCCData="DCC",n="acc_docdetails"===h.toLowerCase()?"AccDocDetailsID":"InvDocDetailsID",o.push(`INNER JOIN COM_DocCCData DCC with(nolock) ON DCC.${n}=D.${n}`)),g[r]||(g[r]=c,o.push(`INNER JOIN ${e.ParentCostCenterSysName} ${c} with(nolock) ON ${c}.NodeID=DCC.${r}`)),t.push(`${g[r]}.${this.IsCode?"Code":"Name"} AS C${a}`)):l>0&&!["AccountTypeID","StatusID"].includes(r)?(g[r]||(g[r]=c,o.push(`INNER JOIN ${e.ParentCostCenterSysName} ${g[r]} with(nolock) ON ${g[r]}.${e.ParentCostCenterColSysName}=D.${r}`)),t.push(`${g[r]}.${this.getColumnName(e)} AS C${a}`)):(r=`D.${r}`,"DATE"===e.ColumnDataType?(r=`convert(datetime,${r})`,t.push(`${r} AS C${a}`)):t.push(`${r} AS C${a}`));a++}let p="SELECT "+t.join(", ")+" FROM "+o.join(" ");return p+=" WHERE ",p+=i>4e4&&i<5e4?`D.CostCenterID=${i} AND D.DocID in (${this.SavedIDs})`:`D.NodeID in (${this.SavedIDs})`,p}getColumnName(e){let s;s="parentid"===e.SysColumnName.toString().toLowerCase()?parseInt(this.Feature.SelectedValue,10):parseInt(e.ColumnCostCenterID,10);let l=0;const i=parseInt(e.ParentCCDefaultColID,10);return isNaN(i)||(l=i),2===s?238===l?"AccountCode":"AccountName":3===s?261===l?"ProductCode":"ProductName":16===s?"BatchNumber":"Name"}ReadBarcode(e,s,l,i){let u=[],h="";h=l,u.push("<XML>"),u.push('<Row CostcenterID="3"'),u.push(e?' syscolname="ProductCode"':' syscolname="ProductName"'),u.push(` value="${l}" />`),""!==u.join("")&&u.push("</XML>");let t=I.d.document.GetCCValues_xml(u.join("")),o=!1;if(t&&t.length>0&&t[0].length>0&&t[0][0].hasOwnProperty("CostCenterID"))for(let r=0;r<t[0].length;r++)s[i]=e?t[0][r].Code?.toString()||"":t[0][r].Name?.toString()||"",o=!0;return o}getAccountTransaction(e,s,l,i,u,h,t){let o=[],r=parseFloat(u);return r<0?(o.push(`DebitAccount="${k.Dw.GetValidXml(s)}" `),o.push(`CreditAccount="${k.Dw.GetValidXml(e)}" `),o.push(`Amount="${(r*t*-1).toString()}" `),o.push(`AmtFc="${(-1*r).toString()}" `),o.push('IsNegative="1" '),l&&o.push(' CrAccCode="1" '),i&&o.push(' DrAccCode="1" ')):r>0&&(o.push(`DebitAccount="${k.Dw.GetValidXml(e)}" `),o.push(`CreditAccount="${k.Dw.GetValidXml(s)}" `),o.push(`Amount="${(r*t).toString()}" `),o.push(`AmtFc="${r.toString()}" `),i&&o.push(' CrAccCode="1" '),l&&o.push(' DrAccCode="1" ')),o.push(`CurrencyID="${h.toString()}" `),o.push(`ExchangeRate="${t.toString()}" `),o.join("")}FillBillWiseDt(e,s,l,i){let u,h;u=parseFloat(l),u<0&&(i=!i,u*=-1);const t=s.replace(/'/g,"''").replace(/&/g,"&amp;"),o=e.filter(r=>r.AccountID===t);if(o.length>0)if(h=o[0],!!h.IsCredit!==i){const r=parseFloat(h.Amount.toString());if(r>u)h.Amount=parseFloat(h.Amount.toString())-u;else if(r<u)h.Amount=u-r,h.IsCredit=i;else if(r===u){const m=e.indexOf(h);m>-1&&e.splice(m,1)}}else h.Amount=parseFloat(h.Amount.toString())+u;else h={AccountID:s,Amount:u,IsCredit:i},e.push(h)}SaveDocument(e,s,l,i,u,h,t,o,r,m,c,n,a,g,p,T,d){const S=[];S.push(this.Feature.SelectedValue),S.push(e),S.push(s),S.push(l),S.push(this.formatDDMMMYYYY(i)),S.push(""!==u?this.formatDDMMMYYYY(u):null),S.push(h);const F=!0===window.BulkSave;if(F&&t?(S.push(d[0]),S.push(d[1]),S.push(d[2]),S.push(d[3]),S.push(d[4]),S.push(d[5]),S.push(d[6])):S.push(o),t){let b="";if(m.length>0){if(b+="<BillWise> ",c.Contains(";")){let w=c.split(";");for(let R=0;R<w.length;R++)if(""!=w[R].toString())for(let P of m){b+="<Row ",b+='DocSeqNo="1" ',b+='AccountID="'+P.AccountID.toString()+'" ',b+=' IsNewReference="0" ',b+=' Narration="" ';let U=0;if(w[R].toString().Contains("~")){let x=w[R].split("~");x.length>1&&""!=x[1].toString()&&(U=parseFloat(x[1].toString()))}if(0==U&&(U=parseFloat(P.Amount.toString())),(0,B.yG0)(P.IsCredit.toString())?(b+='AdjAmount="-'+U*T+'" ',b+='AmountFC="-'+U+'" '):(b+='AdjAmount="'+U*T+'" ',b+='AmountFC="'+U+'" '),b+='AdjCurrID="'+p.toString()+'" ',b+='AdjExchRT="'+T.toString()+'" ',w[R].toString().Contains("~")){let x=w[R].split("~");x.length>1&&""!=x[1].toString()&&(b+='RefDocNo="'+x[0]+'" ')}else b+='RefDocNo="'+w[R]+'" ';b+='IsDocPDC="0" ',b+=" ></Row>"}}else for(let w=0;w<m.length;w++)b+="<Row ",b+='DocSeqNo="1" ',b+='AccountID="'+m[w].AccountID.toString()+'" ',b+=' IsNewReference="1" ',b+=' Narration="" ',(0,B.yG0)(m[w].IsCredit.toString())?(b+='AdjAmount="-'+(parseFloat(m[w].Amount.toString())*T).toString()+'" ',b+='AmountFC="-'+m[w].Amount.toString()+'" '):(b+='AdjAmount="'+(parseFloat(m[w].Amount.toString())*T).toString()+'" ',b+='AmountFC="'+m[w].Amount.toString()+'" '),b+='AdjCurrID="'+p+'" ',b+='AdjExchRT="'+T+'" ',b+='RefDocNo="'+c+'" ',b+='IsDocPDC="0" ',b+=" ></Row>";b+=" </BillWise>"}b.replace("&","&amp;"),S.push(b.toString())}S.push(""),S.push(r);const y=window.ProfileID??0,C=window.UniquNo??"";if(y>-20&&y<0){const b=new Date(i);if(this.formatDDMMMYYYY(b)===this.formatDDMMMYYYY(new Date)&&(4===a||5===a))return{docId:-999,errorMessage:"Transactions cannot be processed for Current Date"};S.push(this.PrevDocID>0&&i===this.PrevDocDate?`<XML ImpDocID="${this.PrevDocID.toString()}"  UniquNo="${4===a||5===a?C:""}" />`:`<XML ImpDocID="0" UniquNo="${4===a||5===a?C:""}" />`)}else{let b="",w="";const R=new Date(i),P=R.getMonth()+1;b=P>=I.d.SessionManager.AccountingFromMonth?`1/${this.formatMonthName(I.d.SessionManager.AccountingFromMonth)}/${R.getFullYear()}`:`1/${this.formatMonthName(I.d.SessionManager.AccountingFromMonth)}/${R.getFullYear()-1}`,w=P<I.d.SessionManager.AccountingFromMonth?`${this.daysInMonth(R.getFullYear(),I.d.SessionManager.AccountingToMonth)}/${this.formatMonthName(I.d.SessionManager.AccountingToMonth)}/${R.getFullYear()}`:`${this.daysInMonth(R.getFullYear()+1,I.d.SessionManager.AccountingToMonth)}/${this.formatMonthName(I.d.SessionManager.AccountingToMonth)}/${R.getFullYear()+1}`;const U=!0===window.PartialSave,x=window.ProductTypeID??0,G=window.BatchBasedon??"",ee=window.IgnoreBatch??0;F&&t?S.push(`<XML  FinancialSartDate="${b}" FinancialEndDate="${w}" ${this.getQuery()} ><ScheduleActivityXml></ScheduleActivityXml></XML>`):U&&this.PrevDocID>0&&i===this.PrevDocDate?S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${w}" ImpDocID="${this.PrevDocID.toString()}"  UniquNo="${4===a||5===a?C:""}" />`):t&&5===x&&""!==G&&1===ee?S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${w}" IgnoreBatches="${ee}" />`):38===this._DocumentType?(S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${w}" ><ScheduleActivityXml></ScheduleActivityXml> <PosPayModes>${this.PosPayModesXML.toString()}</PosPayModes></XML>`),this.PosPayModesXML.clear()):S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${w}" />`)}F&&S.push("<ProjectPlanXml />"),S.push("true"),S.push(a),S.push(n),S.push(this.GetWorkFlow(g)),S.push(I.d.SessionManager.RoleID),t&&S.push(""),S.push(0),S.push(0),S.push(I.d.SessionManager.CompanyGUID),S.push(I.d.SessionManager.UserName),S.push(I.d.SessionManager.UserID),S.push(I.d.SessionManager.LanguageID),S.push(I.d.SessionManager.IsOffline);let f="";if(this.IsSaveDocValidate){const w=I.d.document.SetTempInvDocument_Validate(S).ds;return w&&w.tables&&w.tables.length>0&&w.tables[0]&&w.tables[0].length>0&&w.tables[0].sErrors&&w.tables[0].sErrors.length>0?(f=w.tables[0].sErrors,e=-1234567890):(f="",e=1234567890),{docId:e,errorMessage:f}}{let w;return this.IsInventory?this.BulkSave&&(w=I.d.document.SetTempBulkInvDoc(S)):w=I.d.document.SetTempAccDocument(S),f=w.msg||"",(e=w.docId||0)>0&&(this.PrevDocID=e||0,this.PrevDocDate=i||"",this.SavedIDs.length>0&&(this.SavedIDs+=","),this.SavedIDs+=e.toString()),{docId:e,errorMessage:f}}}getQuery(){let e="";const s=new Be,l=new Be,i=new Be,u=new Be,h=new Be,t=new Be,o=new Be,r=new Be,m=new Be,c=this.costCenterTableZero.filter(n=>String(n.Costcenterid)===String(this.Feature.SelectedValue));for(let n=0;n<c.length;n++){const a=String(c[n].SysColumnName).toLowerCase();a.startsWith("dcnum")?(s.append(c[n].SysColumnName).append(","),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(s.append("dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append(","),s.append("dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append(","),s.append("dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append(",")),s.append("dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append(","),u.append("X.value('@").append(c[n].SysColumnName).append("','Float'),"),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(u.append("X.value('@dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),")),u.append("X.value('@dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("','Float'),"),this.ScreenObject.DocID>0&&(o.append(c[n].SysColumnName).append("="),o.append("X.value('@").append(c[n].SysColumnName).append("','Float'),"),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(o.append("dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),o.append("dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),o.append("dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),")),o.append("dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("="),o.append("X.value('@dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("','Float'),"))):a.startsWith("dcalpha")?(i.append(c[n].SysColumnName).append(","),t.append("X.value('@").append(c[n].SysColumnName).append("','Nvarchar(max)'),"),this.ScreenObject.DocID>0&&(m.append(c[n].SysColumnName).append("="),m.append("X.value('@").append(c[n].SysColumnName).append("','Nvarchar(max)'),"))):a.startsWith("dcccnid")&&(l.append(c[n].SysColumnName).append(","),h.append("isnull(X.value('@").append(c[n].SysColumnName).append("','BIGINT'),1),"),this.ScreenObject.DocID>0&&(r.append(c[n].SysColumnName).append("="),r.append("isnull(X.value('@").append(c[n].SysColumnName).append("','BIGINT'),1),")))}return e+=' NumCols="'+s.toString()+'" ',e+=' TextCols="'+i.toString()+'" ',e+=' CCCols="'+l.toString()+'" ',e+=' NumSelCols="'+u.toString()+'" ',e+=' TextSelCols="'+t.toString()+'" ',e+=' CCSelCols="'+h.toString()+'" ',this.ScreenObject.DocID>0&&(e+=' NumUpdateCols="'+o.toString()+'" ',e+=' TextUpdateCols="'+m.toString()+'" ',e+=' CCUpdateCols="'+r.toString()+'" '),e.toString()}ClearVaraiables(){this.ccdv=[],this.CCQuery=[],this.CCQueryData.Items=[],this.IsScaned=!1,this.IsPreviewDataOk=!1,this.COls=[],this.temp=[],this.GroupExists=!1,this.lookupdv=[],this.lookupQuery=[],this.lookuptemp=[],this.NotesList=[],this.ErrorList=[],this.RulesList=[]}OnImportData(e){this.IsSaveDocValidate=!1,this.ImportingMessage="Importing Data Please Wait....",this.ImportDataClick()}ImportDataClick(){if(N.J0.Int(this.Feature.SelectedValue),null==this.ActualFileName||""===this.ActualFileName)return Logger.InfoLog("Entered into  SelectFiletoImport..."),this.DisplayMessage=I.d.GetResource("SelectFiletoImport"),this.MessageVisibility=!0,this.ImportVisbility=!0,void Logger.InfoLog("Exited into  SelectFiletoImport...");{const l=I.d.common.GetDataSet("DOC0844",this.Feature.SelectedValue);if(!this.IsUpdate&&l.Tables[1]&&l.Tables[1].length>0&&this.Feature.SelectedItem.Name.ToString().toUpperCase()==l.Tables[1][0].Name.ToString().toUpperCase()&&(N.J0.Int(this.Feature.SelectedValue)<4e4||N.J0.Int(this.Feature.SelectedValue)>=5e4)&&!this.IsUpdate&&l.Tables[1].length>0&&this.Feature.SelectedItem.Name.toUpperCase()===l.Tables[1][0].Name.toUpperCase()&&(Number(this.Feature.SelectedValue)<4e4||Number(this.Feature.SelectedValue)>=5e4)&&l&&l.Tables[0].length>0){if(!this.ExcelTable.includes("CodeNumber"))return this.DisplayMessage="CodeNumber Mandatory While Using Auto Code",void(this.MessageVisibility=!0);if(!this.ExcelTable.includes("CodePrefix"))return this.DisplayMessage="CodePrefix Mandatory While Using Auto Code",void(this.MessageVisibility=!0)}if(this.ValidateBeforeImport){if(this.grData.Table.length>0&&("40"!==this.Feature.SelectedValue||"Dimension Wise Price Chart"!==this.Feature.SelectedItem.Name)){const i=Object.values(this.grData.Table.reduce((u,h)=>{const t=h.FeatureFieldName;return u[t]||(u[t]={Name:t,ColCount:0}),u[t].ColCount++,u},{})).sort((u,h)=>u.Name.localeCompare(h.Name));for(const[u,h]of Object.entries(i))if(u.ColCount>1&&u.Name){const t=this.grData.Table.filter(o=>o.FeatureFieldName===u.Name);if(t.length>1)return this.DisplayMessage="Duplicate fields selected at Rows "+(this.grData.Table.indexOf(t[0])+1)+" & "+(this.grData.Table.indexOf(t[1])+1),void(this.MessageVisibility=!0)}}if(!this.ValidateExcelData())return}Logger.InfoLog("After ValidateBeforeImport check..."),this.FailedRecourdList=[],this.ProgressVisbility=!0,this.ProgressValue=0,this.ImportVisbility=!1,this.MessageVisibility=!1,this.ImportedCount="",this.FailedCount="",Logger.InfoLog("Before ClearVaraiables()..."),this.ClearVaraiables(),Logger.InfoLog("After ClearVaraiables()..."),Logger.InfoLog("Before  ExcelTable check..."),null!=this.ExcelTable&&(Logger.InfoLog("ExcelTable is not null... Rows :: "+this.ExcelTable.length),("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue||Number(this.Feature.SelectedValue)>5e4&&Number(this.Feature.SelectedValue)<=50075)&&("Account Dimension wise Cr/Dr Limits"!==this.Feature.SelectedItem.Name&&"Account Report Template"!==this.Feature.SelectedItem.Name&&"Account Contacts"!==this.Feature.SelectedItem.Name&&"Account Address"!==this.Feature.SelectedItem.Name||"2"!==this.Feature.SelectedValue)&&("KIT PRODUCTS"!==this.Feature.SelectedItem.Name.toUpperCase()&&"Product QC"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!==this.Feature.SelectedItem.Name&&"Products With Vendor Multiple Barcode"!==this.Feature.SelectedItem.Name&&"PRODUCTS WISE BINS"!==this.Feature.SelectedItem.Name.toUpperCase()||"3"!==this.Feature.SelectedValue)&&"JOB OUTPUT"!==this.Feature.SelectedItem.Name.toUpperCase()&&"PRODUCTS WITH SUBSTITUTES"!==this.Feature.SelectedItem.Name.toUpperCase()?(Logger.InfoLog("Before groupmethod()..."),this.groupmethod(),Logger.InfoLog("After groupmethod()...")):(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<5e4&&(this.MapDebitCreditAccountFields(),this.CheckAvgRateexists()),this.ProgressMax=this.ExcelTable.length))}}ValidateExcelData(){if(this.IsUpdate)return!0;try{const e=Number(this.Feature.SelectedValue);if(2===e||3===e||e>5e4||e>4e4&&e<5e4){if(this.ExcelTable&&this.ExcelTable.length>0){const s=[...this.ExcelTable];if(e>4e4&&e<5e4){if(this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const l=this.costCenterTableZero.filter(i=>i.CostCenterID===e&&1===i.IsMandatory);if(l.length>0)for(const i of l){let u=this.grData.Table.filter(h=>h.FeatureFieldName===String(i.CostCenterColID));if(!u||0===u.length){let h=!1;const t=String(i.SysColumnName).toUpperCase();if("PRODUCTID"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&r.SysColumnName===t&&r.CostCenterColID!==i.CostCenterColID);for(const r of o)if(this.grData.Table.some(m=>m.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}else if("DEBITACCOUNT"===t||"DEBITACCOUNTCODE"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&("DebitAccount"===r.SysColumnName||"DebitAccountCode"===r.SysColumnName)&&r.CostCenterColID!==i.CostCenterColID);for(const r of o)if(this.grData.Table.some(m=>m.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}else if("CREDITACCOUNT"===t||"CREDITACCOUNTCODE"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&("CreditAccount"===r.SysColumnName||"CreditAccountCode"===r.SysColumnName)&&r.CostCenterColID!==i.CostCenterColID);for(const r of o)if(this.grData.Table.some(m=>m.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}if(!h)return this.DisplayMessage=`${i.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}}}else if((2===e||3===e||e>5e4)&&this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const l=this.costCenterTableZero.filter(i=>i.CostCenterID===e&&1===i.IsMandatory);if(l.length>0)for(const i of l){let u=String(i.SysColumnName||"").trim().toUpperCase();if(""===u||2===e&&["ACCOUNTID","PARENTID","ACCOUNTTYPEID","STATUSID","ISGROUP","ACCOUNTGROUP"].includes(u)||3===e&&["PRODUCTID","PARENTID","PRODUCTTYPEID","VALUATIONID","STATUSID","ISLOTWISE","PRODUCTGROUP"].includes(u)||e>5e4&&"ISGROUP"===u)continue;const h=this.grData.Table.filter(t=>t.FeatureFieldName===String(i.CostCenterColID));if(!h||0===h.length)return this.DisplayMessage=`${i.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}if(this.grData.Table.length>0)for(let l=0;l<s.length;l++)for(let i=0;i<this.grData.Table.length;i++){if(!this.grData.Table[i].FeatureFieldName)continue;const u=this.costCenterTableZero.filter(h=>String(h.CostCenterColID)===this.grData.Table[i].FeatureFieldName);if(u.length>0){const h=this.grData.Table[i].FieldName,t=String(u[0].UserColumnType||"").trim().toUpperCase();if(this.costCenterTableZero[0].hasOwnProperty("IsMandatory")&&u[0].IsMandatory&&"0"!==u[0].IsMandatory){const m=String(s[l][h]||"").trim();if(["NUMERIC","BIGINT","FLOAT","INT"].includes(t)&&(""===m||isNaN(Number(m))||0===Number(m)))return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory/invalid, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1;if(""===m)return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1}if(["DATE","DATETIME","FIXEDDATE","FIXEDDATETIME"].includes(t)){const r=String(s[l][h]||"").trim();if(""!==r){const m=new Date(r);if(isNaN(m.getTime())||1===m.getFullYear())return this.DisplayMessage=`${u[0].ResourceData} - field data is invalid, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1}}}}return!0}return this.DisplayMessage="Excel data not found.",this.MessageVisibility=!0,!1}return!0}catch(e){return this.DisplayMessage=e.message,this.MessageVisibility=!0,Logger.ErrorLog(`Exception :: ValidateExcelData() - Message :: ${e.message}\nStack Trace :: ${e.stack}`),!1}}ImportEmployeeData(){let e=0,s=0,l=0,u=0,t="",o="",r="",m=!0,c=[],n=null,g=null,p=null;this.GradeFromDate=new Date(this.dtValue.getFullYear(),0,1),this.LocFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DeptFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DesgFromDate=new Date(this.dtValue.getFullYear(),0,1);let T=this.costCenterTableZero,d=this.costCenterTableZero;this.objCG.Data=I.d.common.GetScreenInfo(50051),console.log(" this.objCG.Data",this.objCG.Data),this.objCG.IsEmpImport=!0,this.objCG.InitAutoCode(this.objCG.Data.Tables[7],!1);let S=null,F=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().Length>0&&(F=new N.VB,F.LoadXml(this.CodeDef[0].PrefixContent.toString()));for(let C=0;C<this.ExcelTable.length;C++){this.objEmp=new Ct.h,null!=F&&(S=this.GetCodeData(this.ExcelTable[C],0));for(let f=0;f<this.grData.Table.length;f++){if(g=this.ExcelDataColumn.indexOf(this.DtImport[f].FieldName),null==this.grData.Table[f].FeatureFieldName||""==this.grData.Table[f].FeatureFieldName.toString())continue;const w=T.filter(R=>R.CostCenterColID==this.grData.Table[f].FeatureFieldName.toString());if(w.length>0){let R=w[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+R),R){case"Code":this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g),0==this.IsUpdate?""==this.objEmp.EmpCode&&(this.objEmp.EmpCode=this.ExcelTable[C][g]):this.objEmp.EmpCode=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()];break;case"Name":0==this.objEmp.SelectedNodeID&&(this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g)),""==this.objEmp.EmpCode.toString()&&0==this.IsUpdate&&null==this.objEmp.EmpCode&&(this.objEmp.EmpCode=""),this.objEmp.EmpName=this.ExcelTable[C][g];break;case"ParentGroupName":this.objEmp.SelectedNodeID=N.J0.StringIsNullOrEmpty(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()+"_Key"].toString())?1:N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()+"_Key"].toString());break;case"CodePrefix":null==S&&(this.objEmp.CodePrefix=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"CodeNumber":null==S&&(this.objEmp.CodeNumber=N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"AliasName":this.objEmp.EmpAliasName=this.ExcelTable[C][g];break;case"StatusID":const P=this.objCG.Data.Tables[3].filter(U=>U.Status==this.ExcelTable[C][g]);P.length>0?this.objEmp.StatusID=N.J0.Int(P[0].StatusID):(n=I.d.document.GetEmpImportDetails(0,this.ExcelTable[C][g],0),this.objEmp.StatusID=N.J0.Int(n.Tables[0].StatusID));break;case"RptManager":if("null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]){let U;1==this.IsCode&&(U=I.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Code='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=U&&U.Rows.length>0?N.J0.Int(U.Rows[0].NodeId.toString()):0),0==this.IsCode&&(U=I.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=U&&U.Rows.length>0?N.J0.Int(U.Rows[0].NodeId.toString()):0)}else this.objEmp.RptManager=0;break;case"EmpType":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.EmpTypeID=N.J0.Int(this.objCG.Data.Tables[8][0].NodeID):(n=I.d.document.GetEmpImportDetails(1,this.ExcelTable[C][this.grData.Table[f].FieldName.toString()],104),this.objEmp.EmpTypeID=N.J0.Int(n.Tables[0].Rows[0].NodeID))):this.objEmp.EmpTypeID=0;break;case"Gender":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.Gender=this.objCG.Data.Tables[8][0].NodeID.toString():(n=I.d.document.GetEmpImportDetails(1,this.ExcelTable[C][this.grData.Table[f].FieldName.toString()],104),this.objEmp.Gender=n.Tables[0].Rows[0].NodeID.toString())):this.objEmp.Gender="0";break;case"DOJ":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.DOJ=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()])),this.Doj=this.objEmp.DOJ;break;case"DOB":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.DOB=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"ProbationDays":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.ProbationDays=N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"DOConfirmation":this.objEmp.DOConfirmation="null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]):this.objEmp.DOJ.AddDays(this.objEmp.ProbationDays);break;case"Assigned_VacDaysPeriod":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.strVacDayPeriod=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"CurrencyID":this.CostCenterFieldsAllTables.Tables[2].filter(U=>U.Name==this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]),this.intCurrencyID=this.CostCenterFieldsAllTables.Tables[2].length>0?N.J0.Int(this.CostCenterFieldsAllTables.Tables[2][0].CurrencyID):1;break;case"GradeFromDate":"null"!=this.CostCenterFieldsAllTables[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.GradeFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Grade");break;case"LocFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.LocFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Loc");break;case"DeptFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DeptFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Dept");break;case"DesgFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DesgFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Desg");break;case"GradeRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.GradeRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"LocRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.LocRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DeptRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DeptRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DesgRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DesgRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DimensionImage":try{this.grData.Table[f].FieldName.toString()}catch{o=""}break;case"Attachments":if("50051"==this.Feature.SelectedValue)try{let U=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()];U.Length>0&&U.Split(";")}catch{r=""}break;default:if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let U=I.d.document.GetDataSet("Select NodeID,Code,Name FROM COM_CC50051 WITH(NOLOCK) WHERE "+this.UpdateBasedOn.SelectedValue+" = '"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"' ");null!=U&&U.Rows.length>0&&(this.objEmp.EmpCode=U.Rows[0].Code.toString(),this.objEmp.EmpName=U.Rows[0].Name.toString())}}}}if(1==this.IsUpdate&&null!=this.objEmp.EmpCode.toString()&&""!=this.objEmp.EmpName.toString()){if(u=0,1==this.IsUpdate&&0==this.IsCode&&(c=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+this.objEmp.EmpName+"'")),1==this.IsUpdate&&1==this.IsCode&&(c=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+this.objEmp.EmpCode+"'")),c.length>0&&(u=N.J0.Int(c[0].NodeID),this.objEmp.GUID=c[0].GUID.toString(),this.objEmp.EmpCode=c[0].Code.toString(),this.objEmp.CodePrefix=c[0].CodePrefix.toString(),this.objEmp.CodeNumber=N.J0.Int(c[0].CodeNumber),this.objEmp.SelectedNodeID=N.J0.Int(c[0].ParentID),this.dsEdit=this.objEmpEss.GetEmpMasterDetails(),0)){if(d.filter(f=>"COM_CC50051"==f.sysTableName),d.length>0)for(let f=0;f<d.length;f++){let b=d[f].SysColumnName.toString(),w=d[f].CostCenterColID.toString();switch(Logger.InfoLog("ImportCosCenters-Update Columnname ="+b),this.drupd=this.grData.Table.filter(R=>R.FeatureFieldName==w),b){case"AliasName":0==this.drupd.length&&(this.objEmp.EmpAliasName=p.Tables[0].Rows[0].AliasName.toString());break;case"StatusID":0==this.drupd.length&&(this.objEmp.StatusID=N.J0.Int(p.Tables[0].Rows[0].StatusID.toString()));break;case"EmpType":0==this.drupd.length&&(this.objEmp.EmpTypeID=N.J0.Int(p.Tables[0].Rows[0].EmpType.toString()));break;case"Gender":0==this.drupd.length&&(this.objEmp.Gender=p.Tables[0].Rows[0].Gender.toString());break;case"RptManager":N.J0.Int(w.toString())>0&&0==this.drupd.length&&(this.objEmp.RptManager=N.J0.Int(p.Tables[0].Rows[0].RptManager.toString()));break;case"DOJ":0==this.drupd.length?(this.dtValue=new Date(p.Tables[0][0].cDOJ.toString()),this.objEmp.DOJ=new Date(this.dtValue),this.Doj=this.objEmp.DOJ):""==t.toString()?(this.strHistoryMsg="",c=I.d.document.GetDataSet("select Top 1 Convert(DateTime,FromDate) FromDate From COM_HistoryDetails with(nolock) Where CostCenterID=50051 and HistoryCCID=50053 And NodeID='"+u.toString()+"' Order By Convert(DateTime,FromDate)"),c.length>0&&this.Doj.toLocaleDateString("MMM/yyyy")!=new Date(c[0].FromDate).toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with history dimensions")):("Grade"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.GradeFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with grade dimension"),"Loc"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.LocFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with location dimension"),"Dept"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DeptFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with department dimension"),"Desg"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DesgFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with designation dimension"));break;case"DOB":0==this.drupd.length&&(this.dtValue=new Date(p.Tables[0][0].cDOB.toString()),this.objEmp.DOB=new Date(this.dtValue));break;case"ProbationDays":0==this.drupd.length&&(this.objEmp.ProbationDays=N.J0.Int(p.Tables[0][0].ProbationDays.toString()));break;case"DOConfirmation":0==this.drupd.length&&(this.dtValue=new Date(p.Tables[0][0].cDOConfirmation.toString()),this.objEmp.DOConfirmation=new Date(this.dtValue));break;case"CurrencyID":0==this.drupd.length&&(this.intCurrencyID=""!=p.Tables[0][0].CurrencyID.toString()?N.J0.Int(p.Tables[0][0].CurrencyID.toString()):1)}}p.Tables[7].Rows.length>0&&(this.EmpGrade=N.J0.Int(p.Tables[7][0].CCNID53.toString()))}0==u?(s++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"No Employee Exist"}),m=!1):(m=!0,""!=this.strHistoryMsg.toString()?(s++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.strHistoryMsg.toString()}),m=!1):(this.strHistoryMsg="",this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,C,g),""!=this.strHistoryMsg.toString()&&(s++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"Dependency with code/fromdate in history dimensions"}),m=!1)))}if(1==m&&(this.objEmp.NodeID=u,this.objEmp.NotesXML="",this.objEmp.ContactsXML="",this.objEmp.AddressXML="",o.length>0&&(o="<AttachmentsXML>"+o+"</AttachmentsXML>"),r.length>0&&(r="<AttachmentsXML>"+r+"</AttachmentsXML>"),this.objEmp.AttachmetsXML=r+o,this.objEmp.CustomFieldsQuery=this.GetCustomFieldsQuery(this.objCG.Data,null,C,g),""!=this.IDHistoryMessage.toString()&&(s++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.IDHistoryMessage.toString()}),m=!1),1==m)){this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,C,g);let f="";if("TRUE"==I.d.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&I.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")){if(null!=this.objEmp.CustomCostCenterFieldsQuery&&this.objEmp.CustomCostCenterFieldsQuery.length>0){let w=this.objEmp.CustomCostCenterFieldsQuery.split(",");if(w.length>0)for(let R=0;R<w.length;R++)null!=w[R]&&w[R].Contains("CCNID2=")&&(f+='<Row  CostCenterId="50002" NodeID="'+w[R].replace("'","").substring(8)+'" />')}""==f?this.objEmp.CCMapXML="":this.objEmp.CCMapXML+="<XML>"+f+"</XML>"}else this.objEmp.CCMapXML="";this.objEmp.HistoryXML=this.HistoryCCXML,this.objEmp.DocumentsXML="",this.objEmp.IDHistoryXML=this.HistoryCCXML,this.objEmp.PaymentModeXML=this.PaymentModeXML,this.objEmp.AccLinkXML=this.SetComponentAccountMapping(null,u,C),this.objEmp.PrimaryContactQuery="",this.objEmp.PayQuery=this.GetEmployeePayQuery(null,C,u),this.objEmp.dsPayStructure=""!=this.objEmp.PayQuery.toString()?"True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1):null,0==this.objEmp.StatusID&&(this.objEmp.StatusID=""!=I.d.SessionManager.Preferences.DefaultEmpStatus?N.J0.Int(I.d.SessionManager.Preferences.DefaultEmpStatus):250),this.objEmp.IsImport=!0,this.objEmp.RotationalLeave="";let b=0;this.objEmpEss.SaveEmpMaster("","SaveEmpMaster").subscribe(w=>{this.DisplayMessage=w.Message,b=w.RetValue,l=b,l<0?(s++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.DisplayMessage})):e++},w=>{console.log("Employee Master Save : "+JSON.stringify(w))})}this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+s.toString()}let y=s+e;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+y.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCustomFieldsQuery(e,s,l,i){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomFieldsQuery");let t,m,h=null,o="",r="",c="",n="",a="",g="",p="",T="",d="",S="",F="",y=["Code","Name","StatusID","AliasName","EmpType","RptManager","DOJ","DOB","Gender","ProbationDays","DOConfirmation"],C=e.Tables[0].filter(b=>!y.includes(b.SysColumnName));if(C.length>0){for(let b=0;b<=C.length-1;b++)for(let w=0;w<this.grData.Table.length;w++)if(null!=this.grData.Table[w].FeatureFieldName&&""!=this.grData.Table[w].FeatureFieldName.toString()&&C[b].CostCenterColID.toString()==this.grData.Table[w].FeatureFieldName.toString()){if(("PassportNo"==C[b].SysColumnName.toString()||"VisaNo"==C[b].SysColumnName.toString()||"IqamaNo"==C[b].SysColumnName.toString()||"ContractNo"==C[b].SysColumnName.toString()||"IDNo"==C[b].SysColumnName.toString()||"LicenseNo"==C[b].SysColumnName.toString()||"MedicalNo"==C[b].SysColumnName.toString())&&(p="",T="",d="",S="",F="",t=this.ExcelTable[l][i],null!=t&&""!=t)){c+='<Row Number="'+t+'"';let R=e.Tables[0];R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"IssDate'";let P=this.grData.Table.filter(G=>G.FeatureFieldName==R[0].CostCenterColID.toString()),U=new Date;if(R.length>0&&null!=P&&P.length>0){let G=new Date;(""==this.ExcelTable[l][P[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][P[0].FieldName.toString().Trim()]))&&(p=G.toLocaleDateString("dd/MMM/yyyy"))}if(R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"ExpDate'",R.length>0){let G=P;null!=G&&G.length>0&&(""==this.ExcelTable[l][G[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][G[0].FieldName.toString().Trim()]))&&(T=U.toLocaleDateString("dd/MMM/yyyy"))}if(null!=p&&""!=p&&p.length>0){if(null!=T&&""!=T&&T.length>0&&new Date(p)>new Date(T)&&(this.IDHistoryMessage+=C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+" ExpDate Should be greater than IssDate "),c+=' IssDate="'+new Date(p).toLocaleDateString("dd MMM yyyy")+'"',null!=T&&""!=T&&T.length>0&&(c+=' ExpDate="'+new Date(T).toLocaleDateString("dd MMM yyyy")+'"'),"ContractNo"==C[b].SysColumnName.toString()){if(R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"ExtendDate'",R.length>0){let G=P;null!=G&&G.length>0&&(""==this.ExcelTable[l][G[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][G[0].FieldName.toString().Trim()]))&&(d=U.toLocaleDateString("dd/MMM/yyyy"))}null!=d&&""!=d&&d.length>0&&(c+=' ExtendDate="'+new Date(d).toLocaleDateString("dd MMM yyyy")+'"')}if("VisaNo"==C[b].SysColumnName.toString()&&I.d.SessionManager.Preferences.ContainsKey("CountryDimension")&&""!=I.d.SessionManager.Preferences.CountryDimension&&parseInt(I.d.SessionManager.Preferences.CountryDimension)>0){let G=this.grData.Table.filter(ee=>"-14"==ee.FeatureFieldName);if(null!=G&&G.length>0&&(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][G[0].FieldName.toString()],parseInt(I.d.SessionManager.Preferences.CountryDimension)),h.Tables.length>0))for(let ee=0;ee<h.Tables.length;ee++)h.Tables[ee].includes("NodeID")&&(S=String(h.Tables[ee][0].NodeID));null!=S&&""!=S&&S.length>0&&(c+=' Country="'+S.toString()+'"'),G=this.grData.Table.filter(ee=>"-15"==ee.FeatureFieldName),null!=G&&G.length>0&&""!=this.ExcelTable[l][G[0].FieldName.toString().Trim()]&&(F=this.ExcelTable[l][G[0].FieldName.toString()]),null!=F&&""!=F&&F.length>0&&(c+=' IsDefault="'+F.toString()+'"')}}let x="";if("PassportNo"==C[b].SysColumnName.toString()?x="-51001":"VisaNo"==C[b].SysColumnName.toString()?x="-51002":"IqamaNo"==C[b].SysColumnName.toString()?x="-51003":"ContractNo"==C[b].SysColumnName.toString()?x="-51004":"IDNo"==C[b].SysColumnName.toString()?x="-51005":"LicenseNo"==C[b].SysColumnName.toString()?x="-51006":"MedicalNo"==C[b].SysColumnName.toString()&&(x="-51007"),c+=' DType="'+x+'"',c+=' sDType="'+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+'"',null!=s){let G=s;G.filter(ee=>ee.DType==x),G.Sort="Field2 DESC",null!=p&&""!=p&&p.length>0&&G.length>0&&""!=G[0].Field5.toString()&&new Date(p)<new Date(parseFloat(G[0].Field5)).AddDays(2)&&(this.IDHistoryMessage+=C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+" IssDate Should be greater than "+new Date(parseFloat(G[0].Field5)).AddDays(2).toLocaleDateString("dd MMM yyyy")+" "),c+=G.length>0?' SNo="'+G.length+'1"':' SNo="1"'}else c+=' SNo="1"';c+="/>"}if("PaymentMode"==C[b].SysColumnName.toString()&&(t=this.ExcelTable[l][i],null!=t&&""!=t)){n+='<Row PaymentMode="'+t+'"',t="";let R=e.Tables[0];if(R.RowFilter="SysColumnName='iBank'",R.length>0){let P=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());if(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][P[0].FieldName.toString()],parseInt(R[0].ColumnCostCenterID)),h.Tables.length>0)for(let U=0;U<h.Tables.length;U++)h.Tables[U].includes("NodeID")&&(t=String(h.Tables[U][0].NodeID))}if(n+=null!=t&&""!=t?' iBank="'+t+'"':' iBank="0"',R.RowFilter="SysColumnName='BankAccNo'",t="",R.length>0){let P=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());null!=P&&P.length>0&&(t=this.ExcelTable[l][P[0].FieldName.toString()])}if(n+=' BankAccNo="'+t+'"',R.RowFilter="SysColumnName='IBANNo'",t="",R.length>0){let P=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());null!=P&&P.length>0&&(t=this.ExcelTable[l][P[0].FieldName.toString()])}if(n+=' IBANNo="'+t+'"',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',null!=s){let P=s;P.filter(U=>"-51011"==U.DType),P.Sort="Field2 DESC",n+=P.length>0?' SNo="'+P.length+'1"':' SNo="1"'}else n+=' SNo="1"';n+="/>"}if("text"==C[b].UserColumnType.toString().toLowerCase())"30406"==C[b].CostCenterColID.toString()||"30407"==C[b].CostCenterColID.toString()?"Bank Transfer"==o.toString()?(t=this.ExcelTable[l][i],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):("Cash"==o.toString()||"Cheque"==o.toString()||"Demand Draft"==o.toString())&&(t="",r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):"PAY_EmpPay"!=C[b].SysTableName.toString()&&"PAY_EmpAccountsLinking"!=C[b].SysTableName.toString()&&(t=this.ExcelTable[l][i],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combobox"==C[b].UserColumnType.toString().toLowerCase())"30366"==C[b].CostCenterColID.toString()||"36894"==C[b].CostCenterColID.toString()||"30367"==C[b].CostCenterColID.toString()?(t="","null"!=this.ExcelTable[l][i].toString()&&""!=this.ExcelTable[l][i]&&(e.Tables[8].RowFilter="Name='"+this.ExcelTable[l][i]+"'",e.Tables[8].length>0?t=String(e.Tables[8][0].NodeID):("30366"==C[b].CostCenterColID.toString()?h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][i],108):"36894"==C[b].CostCenterColID.toString()?h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][i],114):"30367"==C[b].CostCenterColID.toString()&&(h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][i],122)),t=String(h.Tables[0][0].NodeID))),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):"RoleID"==C[b].SysColumnName.toString()?(t="",m=I.d.document.GetDataSet("select RoleID from ADM_PRoles where Name='"+this.ExcelTable[l][i]+"'"),null!=m&&m.length>0&&(t=m.Rows[0].RoleID.toString()),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):(t=this.ExcelTable[l][i],"PaymentMode"==C[b].SysColumnName.toString()&&(o=t),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combotextvalue"==C[b].UserColumnType.toString().toLowerCase()&&"30366"!=C[b].CostCenterColID.toString()&&"36894"!=C[b].CostCenterColID.toString())""!=this.strVacDayPeriod.toString()&&(t=this.ExcelTable[l][i],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',",t=this.strVacDayPeriod,r+="VacDaysPeriod=N'"+t.replace("'","''")+"',");else if("date"==C[b].UserColumnType.toString().toLowerCase())t=this.ExcelTable[l][i],""!=t&&(t=new Date(t).toLocaleDateString("dd/MMM/yyyy"),C[b].SysColumnName.toString().toLowerCase().Contains("ccalpha")?r+=C[b].SysColumnName+"=N'"+t+"',":r+=C[b].SysColumnName+"=CONVERT(FLOAT,CONVERT(DATETIME,'"+t+"')),");else if("COM_CC50051"==C[b].SysTableName.toString()&&"listbox"==C[b].UserColumnType.toString().toLowerCase()){if(t="","30117"==C[b].CostCenterColID.toString())t=this.intCurrencyID.toString(),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',";else if("30402"==C[b].CostCenterColID.toString()&&"Bank Transfer"==o.toString()){if(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][i],parseInt(C[b].ColumnCostCenterID)),h.Tables.length>0)for(let R=0;R<h.Tables.length;R++)h.Tables[R].includes("NodeID")&&(t=String(h.Tables[R][0].NodeID));r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"}else if("30003"!=C[b].CostCenterColID.toString()&&"30402"!=C[b].CostCenterColID.toString()&&"30117"!=C[b].CostCenterColID.toString()){if(h=null!=C[b].ColumnCostCenterID&&null!=C[b].ColumnCostCenterID&&"44"==C[b].ColumnCostCenterID.toString()?I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][i],parseInt(C[b].ColumnCostCenterID)):I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][i],parseInt(C[b].ColumnCostCenterID)),h.Tables.length>0)for(let R=0;R<h.Tables.length;R++)h.Tables[R].includes("NodeID")&&(t=String(h.Tables[R][0].NodeID));r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"}}else if("checkedlistbox"==C[b].UserColumnType.toString().toLowerCase()){if("checkinoutdevice"==C[b].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[l][i],""!=t&&(r+=C[b].SysColumnName+"=N'"+t+"',")),"attsetdimnodes"==C[b].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[l][i],""!=t)){let R=t.split(",");if(I.d.SessionManager.Preferences.ContainsKey("AttendanceDimension")&&""!=I.d.SessionManager.Preferences.AttendanceDimension.toString()&&"4"!=I.d.SessionManager.Preferences.AttendanceDimension.toString()){let P="SELECT NodeID,Code,Name FROM "+this.ScreenObject.GetTableName(parseInt(I.d.SessionManager.Preferences.AttendanceDimension))+" WITH(NOLOCK) WHERE IsGroup=0",U=I.d.document.GetDataSet(P);if(null!=U&&U.length>0){let x,G="";for(var f of R)""!=f.toString()&&(x=U.filter(ee=>ee.Name==ee.toString()),null!=x&&x.length>0&&(null!=G&&G.length>0&&(G+=","),G+=x[0].NodeID));r+=C[b].SysColumnName+"=N'"+G+"',"}}}}else("radiobutton"==C[b].UserColumnType.toString().toLowerCase()||"checkbox"==C[b].UserColumnType.toString().toLowerCase())&&(t=this.ExcelTable[l][i],""!=t&&(r+=C[b].SysColumnName+"=N'"+t+"',"))}null!=c&&c.length>0&&(a="<XML>"+c+"</XML>"),null!=n&&n.length>0?g="<XML>"+n+"</XML>":this.IsUpdate||(n+='<Row PaymentMode="Cash"',n+=' iBank="0"',n+=' BankAccNo=""',n+=' IBANNo=""',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',n+=' SNo="1"',n+="/>",g="<XML>"+n+"</XML>")}return r.toString()}GetCustomCostCenterFieldsQuery(e,s,l,i){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomCostCenterFieldsQuery");let h,t="",o="",r="",m=null,c=e.Tables[0].filter(n=>null!==n.SectionID||0);if(c.length>0){for(let n=0;n<=c.length-1;n++)for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&c[n].CostCenterColID.toString()==this.grData.Table[a].FeatureFieldName.toString())if("COM_CCCCDATA"==c[n].SysTableName.toString()&&"listbox"==c[n].UserColumnType.toString().toLowerCase()&&""==c[n].UserProbableValues.toString()){if(h="","null"!=this.ExcelTable[l][i].toLowerCase().toString()&&""!=this.ExcelTable[l][i].toString()&&"CurrencyID"!=c[n].SysColumnName.toString()&&"iBank"!=c[n].SysColumnName.toString()){if(m=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][i].toString(),parseInt(c[n].ColumnCostCenterID)),m.Tables.length>0)for(let g=0;g<m.Tables.length;g++)m.Tables[g].includes("NodeID")&&(h=String(m.Tables[g][0].NodeID));r+=c[n].SysColumnName+"=N'"+h.replace("'","''")+"',"}}else if("listbox"==c[n].UserColumnType.toString().toLowerCase()&&("H"==c[n].UserProbableValues.toString().toUpperCase()||"HP2"==c[n].UserProbableValues.toString().toUpperCase()||"HP3"==c[n].UserProbableValues.toString().toUpperCase())){if(h="","null"!=this.ExcelTable[l][i].toLowerCase().toString()&&""!=this.ExcelTable[l][i].toString()&&(m=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][i].toString(),parseInt(c[n].ColumnCostCenterID)),m.Tables.length>0))for(let g=0;g<m.Tables.length;g++)m.Tables[g].includes("NodeID")&&(h=String(m.Tables[g][0].NodeID));if(r+=c[n].SysColumnName+"=N'"+h.replace("'","''")+"',",""!=h.toString())if(null!=s){let g=s;g.RowFilter="CCID='"+parseInt(c[n].ColumnCostCenterID)+"'";let p=new Date,T=new Date;if(g.length>1){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",50053==parseInt(c[n].ColumnCostCenterID))p=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.GradeFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")||this.GradeFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(c[n].ColumnCostCenterID))p=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.LocFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")||this.LocFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.DesgFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DesgFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.DeptFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DeptFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let d=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"000");if(null!=d&&d.length>0){let F=new Date;(""==this.ExcelTable[l][d[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][d[0].FieldName.toString().Trim()]))&&(p=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",F<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&F<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date")}if("HP3"==c[n].UserProbableValues.toString().toUpperCase()){let F=this.grData.Table.filter(y=>y.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=F&&F.length>0&&((""==this.ExcelTable[l][F[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][F[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}let S=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"002");if(null!=S&&S.length>0){let F="";F=this.ExcelTable[l][S[0].FieldName.toString().Trim()],t=t+" Remarks='"+F+"'"}}t+=" Modified='1' />",new Date(g[g.length-1].FromDate).toLocaleDateString("MMM/yyyy")==p.toLocaleDateString("MMM/yyyy")&&"HP3"!=c[n].UserProbableValues.toString().toUpperCase()?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==c[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(p.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>")}else if(1==g.length){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",50053==parseInt(c[n].ColumnCostCenterID))p=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.GradeFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(c[n].ColumnCostCenterID))p=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.LocFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DesgFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DeptFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let d=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"000");if(null!=d&&d.length>0&&((""==this.ExcelTable[l][d[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][d[0].FieldName.toString().Trim()]))&&(p=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.EDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date")),"HP3"==c[n].UserProbableValues.toString().toUpperCase()){let F=this.grData.Table.filter(y=>y.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=F&&F.length>0&&((""==this.ExcelTable[l][F[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][F[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}let S=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"002");if(null!=S&&S.length>0){let F="";F=this.ExcelTable[l][S[0].FieldName.toString().Trim()],t=t+" Remarks='"+F+"'"}}t+=" Modified='1' />",this.Doj.toLocaleDateString("MMM/yyyy")!=p.toLocaleDateString("MMM/yyyy")?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==c[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(p.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>")}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==c[n].UserProbableValues.toString().toUpperCase()){let d=this.grData.Table.filter(S=>S.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=d&&d.length>0&&((""==this.ExcelTable[l][d[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][d[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==c[n].UserProbableValues.toString().toUpperCase()){let g=new Date,p=this.grData.Table.filter(T=>T.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=p&&p.length>0&&((""==this.ExcelTable[l][p[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][p[0].FieldName.toString().Trim()]))&&(g=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+g.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}""!=t.toString()&&(o="<History>"+t+"</History>")}return r.toString()}GetEmployeeGroupID(e){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeeGroupID");let s=0,i=(new gt.ControlGenerator,this.costCenterTableZero),u=null;if(i.filter(t=>"3003"==t.CostCenterColID).length>0&&(u=this.ExcelTable.includes(i[0].UserColumnName.toString())?I.d.document.GetEmpImportDetails(2,this.ExcelTable[e][i[0].UserColumnName.toString()],0):I.d.document.GetEmpImportDetails(2,"Employee",0),u.Tables.length>0))for(let t=0;t<u.Tables.length;t++)u.Tables[t].includes("NodeID")&&(s=parseInt(u.Tables[t][0].NodeID));return s}GetEmployeePayQuery(e,s,l){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeePayrollQuery");let i="",u=0,h=this.costCenterTableZero;if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("EarComponentID"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("DedComponentID"),this.dtPayrollD.push("NodeID"),this.dsPayStructure="True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let t=[],o=this.dsPayStructure.Tables[0];o.RowFilter="Type=1 AND Applicable='Yes' AND FieldType<>'OverTime'";for(let r=0;r<o.length;r++)t={},t.SlNo=(r+1).toString(),t.Earnings=o[r].ComponentName.toString(),t.EarSNo=o[r].SNo.toString(),t.EarFormula=o[r].Formula.toString(),t.EarRoff=o[r].ROff.toString(),t.EarValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),t.EarAddToNet=o[r].AddToNet.toString(),t.EarFType=o[r].FieldType.toString(),"EmployeeMaster"!=t.EarFType.toString()&&(t.Earnings_GRAY="1",t.EarValue_GRAY="1"),t.EarComponentID=o[r].ComponentID.toString(),t.NodeID=o[r].CostCenterColID.toString(),this.dtPayrollE.push(t);o.RowFilter="Type=2 AND Applicable='Yes' AND FieldType<>'NetSalary' AND FieldType<>'OverTime'";for(let r=0;r<o.length;r++)t={},t.SlNo=(r+1).toString(),t.Deductions=o[r].ComponentName.toString(),t.DedSNo=o[r].SNo.toString(),t.DedFormula=o[r].Formula.toString(),t.DedROff=o[r].ROff.toString(),t.DedValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),t.DedAddToNet=o[r].AddToNet.toString(),t.DedFType=o[r].FieldType.toString(),"EmployeeMaster"!=t.DedFType.toString()&&(t.Deductions_GRAY="1",t.DedValue_GRAY="1"),t.DedComponentID=o[r].ComponentID.toString(),t.NodeID=o[r].CostCenterColID.toString(),this.dtPayrollD.push(t)}if(h.filter(t=>"PAY_EmpPay"==t.sysTableName),h.length>0)for(let t=0;t<h.length;t++)for(let o=0;o<this.grData.Table.length;o++)null==this.grData.Table.FeatureFieldName||""==this.grData.Table.FeatureFieldName.toString()||"float"==h[t].ColumnDataType.toString().toLowerCase()&&h[t].CostCenterColID.toString()==this.grData.Table.FeatureFieldName.toString()&&("BasicMonthly"==h[t].sysColumnName.toString()?(u=parseFloat(this.ExcelTable[s][this.grData.Table.FieldName.toString()]),i+=h[t].SysColumnName.toString()+"="+u+",",null!=e&&(e[0].BasicMonthly=u)):"-1"!=h[t].UserDefaultValue.toString()&&(i+=h[t].SysColumnName.toString()+"="+this.ExcelTable[s][this.grData.Table.FieldName.toString()]+","));if(null!=e){let t=e;if(t.Sort="EffectFrom DESC,SeqNo DESC",t.length>0){for(let o=0;o<this.dtPayrollE.length;o++)null!=this.dtPayrollE[o].EarSNo&&null!=this.dtPayrollE[o].EarSNo&&""!=this.dtPayrollE[o].EarSNo.toString()&&(this.dtPayrollE[o].EarValue=parseFloat(t[0]["Earning"+this.dtPayrollE[o].EarSNo]).ToString(I.d.SessionManager.sPayrollDecimals));for(let o=0;o<this.dtPayrollD.length;o++)null!=this.dtPayrollD[o].DedSNo&&null!=this.dtPayrollD[o].DedSNo&&""!=this.dtPayrollD[o].DedSNo.toString()&&(this.dtPayrollD[o].DedValue=parseFloat(t[0]["Deduction"+this.dtPayrollD[o].DedSNo]).ToString(I.d.SessionManager.sPayrollDecimals))}}if(this.ExecuteFormulas(u,s,l),null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let t=0;t<this.dtPayrollE.length;t++)null!=this.dtPayrollE[t].EarSNo&&null!=this.dtPayrollE[t].EarSNo&&""!=this.dtPayrollE[t].EarSNo.toString()&&""!=this.dtPayrollE[t].EarValue.toString().Trim()&&(i+="Earning"+this.dtPayrollE[t].EarSNo+"="+this.dtPayrollE[t].EarValue.toString().replace(",","")+",");if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let t=0;t<this.dtPayrollD.length;t++)null!=this.dtPayrollD[t].DedSNo&&null!=this.dtPayrollD[t].DedSNo&&""!=this.dtPayrollD[t].DedSNo.toString()&&""!=this.dtPayrollD[t].DedValue.toString().Trim()&&(i+="Deduction"+this.dtPayrollD[t].DedSNo+"="+this.dtPayrollD[t].DedValue.toString().replace(",","")+",");return""!=i.toString()&&(i+="NetSalary="+(this.totEarnings-this.totDeductions).toString()+","),i}ExecuteFormulas(e,s,l){const i=I.d.report.GetDataTable("IMP002",String(l));let t,u=30,h=(0).ToString(I.d.SessionManager.sPayrollDecimals);this.totEarnings=0,this.totDeductions=0,u="Actual Days"==I.d.SessionManager.Preferences.EmpMasterPayDays?I.d.SessionManager.PayrollMonthEnd.Subtract(I.d.SessionManager.PayrollMonthStart).Days+1:parseInt(I.d.SessionManager.Preferences.EmpMasterPayDays),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.fldDict=new He.bT,t=new Pe("Basic",""),this.fldDict.Basic=t,this.fldDict.Basic.setFieldValue(e),t=new Pe("TotalDays",""),this.fldDict.TotalDays=t,this.fldDict.TotalDays.setFieldValue(u),t=new Pe("DaysAttended",""),this.fldDict.DaysAttended=t,this.fldDict.DaysAttended.setFieldValue(u),t=new Pe("PayrollMonthNo",""),this.fldDict.PayrollMonthNo=t,this.fldDict.PayrollMonthNo.setFieldValue(I.d.SessionManager.PayrollMonth.getMonth()+1),t=new Pe("PayrollYearNo",""),this.fldDict.PayrollYearNo=t,this.fldDict.PayrollYearNo.setFieldValue(I.d.SessionManager.PayrollMonth.getFullYear()),t=new Pe("DOJMonth",""),this.fldDict.DOJMonth=t,i.length>0&&i[0].CDOJ&&""!==i[0].CDOJ.toString()?this.fldDict.DOJMonth.setFieldValue(new Date(i[0].CDOJ).getMonth()+1):this.fldDict.DOJMonth.setFieldValue(new Date(this.Doj).getMonth()+1),t=new Pe("DOJYear",""),this.fldDict.DOJYear=t,i.length>0&&i[0].CDOJ&&""!==i[0].CDOJ.toString()?this.fldDict.DOJYear.setFieldValue(new Date(i[0].CDOJ).getFullYear()):this.fldDict.DOJYear.setFieldValue(new Date(this.Doj).getFullYear()),t=new Pe("DORMonth",""),this.fldDict.DORMonth=t,i.length>0&&i[0].CDORelieve&&""!==i[0].CDORelieve.toString()?this.fldDict.DORMonth.setFieldValue(new Date(i[0].CDORelieve).getMonth()+1):this.fldDict.DORMonth.setFieldValue(1),t=new Pe("DORYear",""),this.fldDict.DORYear=t,i.length>0&&i[0].CDORelieve&&""!==i[0].CDORelieve.toString()?this.fldDict.DORYear.setFieldValue(new Date(i[0].CDORelieve).getFullYear()):this.fldDict.DORYear.setFieldValue(2200);let o=this.grData.Table;const r=this.dsEmpPay(1);let m;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(t=new Pe(this.dtPayrollE[n].Earnings,""),this.fldDict[this.dtPayrollE[n].Earnings]=t,m=this.dsPayStructure[0].filter(a=>a.CostCenterColID===this.dtPayrollE[n].NodeID.toString()),m.length>0&&(m=r[0].filter(a=>a.ComponentID===m[0].ComponentID.toString()),m.length>0)){const a=o.find(g=>g.FeatureFieldName===m[0].CostCenterColID.toString());if(a){const g=this.ExcelTable[s][a.FieldName];this.dtPayrollE[n].EarValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),t=new Pe("Calc"+this.dtPayrollE[n].Earnings,""),this.fldDict["Calc"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),t=new Pe("Arr_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Arr_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Arr_"+this.dtPayrollE[n].Earnings].setFieldValue(0),t=new Pe("Adj_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Adj_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Adj_"+this.dtPayrollE[n].Earnings].setFieldValue(0)}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(t=new Pe(this.dtPayrollD[n].Deductions,""),this.fldDict[this.dtPayrollD[n].Deductions]=t,m=this.dsPayStructure[0].filter(a=>a.CostCenterColID===this.dtPayrollD[n].NodeID.toString()),m.length>0&&(m=r[0].filter(a=>a.ComponentID===m[0].ComponentID.toString()),m.length>0)){const a=o.find(g=>g.FeatureFieldName===m[0].CostCenterColID.toString());if(a){const g=this.ExcelTable[s][a.FieldName];this.dtPayrollD[n].DedValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollD[n].Deductions].setFieldValue(this.dtPayrollD[n].DedValue),t=new Pe("Calc"+this.dtPayrollD[n].Deductions,""),this.fldDict["Calc"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Calc"+this.dtPayrollD[n].Deductions].setFieldValue(this.dtPayrollD[n].DedValue),t=new Pe("Arr_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Arr_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Arr_"+this.dtPayrollD[n].Deductions].setFieldValue(0),t=new Pe("Adj_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Adj_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Adj_"+this.dtPayrollD[n].Deductions].setFieldValue(0)}const c=this.fldDict;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(this.dtPayrollE[n].EarFormula)try{h=parseFloat(I.d.eval.EvaluateExpression(this.dtPayrollE[n].EarFormula.toString(),c)).ToString(I.d.SessionManager.sPayrollDecimals),this.dtPayrollE[n].EarValue=this.RoundOffValue(parseFloat(h),parseFloat(this.dtPayrollE[n].EarROff)),this.fldDict[this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue)}catch{}this.dtPayrollE[n].EarAddToNet&&("Net"===this.dtPayrollE[n].EarAddToNet||"NetAndTax"===this.dtPayrollE[n].EarAddToNet)&&(this.totEarnings+=parseFloat(this.dtPayrollE[n].EarValue))}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(this.dtPayrollD[n].DedFormula)try{if(h=parseFloat(I.d.eval.EvaluateExpression(this.dtPayrollE[n].DedFormula.toString(),c)).ToString(I.d.SessionManager.sPayrollDecimals),"ESI"==this.dtPayrollD[n].Deductions.toString().ToUpper())h=Math.max(parseFloat(h)).ToString(I.d.SessionManager.sPayrollDecimals);else if("PT"==this.dtPayrollD[n].Deductions.toString().ToUpper()){let a=h.replace(",","");h=(0).ToString(I.d.SessionManager.sPayrollDecimals);let g=this.dsPayStructure.Tables[0].length>0?this.dsPayStructure.Tables[0]:this.dsPayStructure.Tables[1];if(g.length>0){let T,d,S;if(new Date(g[0].PayrollMonth),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let C=0;C=N.J0.GetEmployeeGrade(l.toString(),T,d,S)}let y=I.d.document.GetDataSet(`\nDECLARE @SQL NVARCHAR(MAX),@Val nvarchar(50),@Val2 nvarchar(50),@PayrollMonth NVARCHAR(100),@PayrollStart NVARCHAR(100),@PayrollEnd NVARCHAR(100)\nSET @PayrollMonth='" + dtPM.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollStart='" + dtPMS.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollEnd='" + dtPME.toLocaleDateString("dd/MMM/yyyy") + @"'\n\nSELECT @Val= Value FROM ADM_GlobalPreferences WITH(NOLOCK) WHERE Name='PayrollPTDimension'\nIF(@Val IS NOT NULL AND @Val<>'' and CONVERT(INT,@Val)>50000)\nBEGIN\nSelect @Val2='CCNID'+CONVERT(NVARCHAR,(CONVERT(INT,@Val)-50000))\nSET @SQL='\tSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) \nWHERE NodeID IN(" + EmpNodeID + @")AND CostCenterID=50051 AND HistoryCCID='+@Val+'   \nAND (CONVERT(DATETIME,FromDate)<=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR CONVERT(DATETIME,FromDate) BETWEEN CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollStart)+''') AND CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollEnd)+''')) \nAND (CONVERT(DATETIME,ToDate)>=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR ToDate IS NULL) \n\nSELECT NodeID as EmpSeqNo,'+@Val2+' as PTDimension FROM COM_CCCCDATA WITH(NOLOCK) WHERE CostCenterID=50051 AND NodeID=" + ${l}\n\nEXEC(@SQL)\n\nEND\nELSE\nBEGIN\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\n\nEND\n\nSELECT CONVERT(DATETIME,PayrollDate) as PayrollMonth,*\nFROM PAY_PayrollPT WITH(NOLOCK) \nWHERE CONVERT(DATETIME,PayrollDate)=@PayrollMonth `);if(null!=y&&y.Tables.length>0){let C="1";y.Tables[0].length>0?C=y.Tables[0].Rows[0].PTDimension.toString():y.Tables[1].length>0&&(C=y.Tables[1].Rows[0].PTDimension.toString());let f=y.Tables[2];if(y.Tables[0].length>0||y.Tables[1].length>0){let b=y.Tables[2];if(b.RowFilter="NodeID="+C+" AND Formula<>''",null!=b&&b.length>0&&null!=b[0].Formula&&null!=b[0].Formula&&""!=b[0].Formula.toString().Trim()){let w=this.fldDict;h=parseFloat(I.d.eval.EvaluateExpression(b[0].Formula.toString(),w)).toString()}else f.RowFilter="NodeID="+C+" AND FromSlab<="+a+" AND ToSlab>="+a,f.length>0&&(h=f[0].Amount.toString())}}}}this.dtPayrollD[n].DedValue=this.RoundOffValue(parseFloat(h),parseFloat(this.dtPayrollD[n].DedROff)),this.fldDict[this.dtPayrollD[n].Deductions.toString()].setFieldValue(this.dtPayrollD[n].DedValue.toString()),this.fldDict["Calc"+this.dtPayrollD[n].Deductions.toString()].setFieldValue(this.dtPayrollD[n].DedValue.toString())}catch{}this.dtPayrollD[n].DedAddToNet&&("Net"===this.dtPayrollD[n].DedAddToNet||"NetAndTax"===this.dtPayrollD[n].DedAddToNet)&&(this.totDeductions+=parseFloat(this.dtPayrollD[n].DedValue))}this.dblNetSalary=this.totEarnings-this.totDeductions}SetComponentAccountMapping(e,s,l){Logger.InfoLog("ImportEmployeeData:: Inside SetComponentAccountMapping");let i=[],u=[...this.costCenterTableZero],h=[],t=[],o=null,r=[];const m=n=>{r.push({EmpSeqNo:n.EmpSeqNo||"",ComponentID:n.ComponentID||"",ComponentName:n.ComponentName||"",UserDefaultValue:n.UserDefaultValue||"",Type:n.Type||"",SNo:n.SNo||"",DebitAccountID:n.DebitAccountID||"",CreditAccountID:n.CreditAccountID||"",Flag:n.Flag||""})};if(this.dsPayStructure=this.dsEmpPay(this.EmpGrade),this.dsPayStructure&&this.dsPayStructure[0]&&this.dsPayStructure[0].length>0){let n=this.dsPayStructure[0].filter(a=>["1","2","3"].includes(a.Type?.toString()));m({EmpSeqNo:s.toString(),ComponentID:"-301",ComponentName:"SalaryAccID",UserDefaultValue:"-2",Type:"-301",SNo:"-301",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"}),m({EmpSeqNo:s.toString(),ComponentID:"-302",ComponentName:"PayableAccID",UserDefaultValue:"-2",Type:"-302",SNo:"-302",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"});for(let a=0;a<n.length;a++)m({EmpSeqNo:s.toString(),ComponentID:n[a].ComponentID.toString(),ComponentName:n[a].ComponentName+"_Acc",UserDefaultValue:"-2",Type:n[a].Type.toString(),SNo:n[a].SNo.toString(),DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"})}if(e&&e.length>0)for(let n=0;n<r.length;n++)if(r[n].ComponentID){let a=e.filter(g=>g.ComponentID?.toString()===r[n].ComponentID.toString());a.length>0&&(r[n].DebitAccountID=a[0].DebitAccountID.toString(),r[n].CreditAccountID=a[0].CreditAccountID.toString(),r[n].Flag="0")}h=[...r];let c=u.filter(n=>"PAY_EmpAccountsLinking"===n.sysTableName||["SalaryAccID","PayableAccID"].includes(n.SysColumnName)).sort((n,a)=>n.SysColumnName.localeCompare(a.SysColumnName,void 0,{sensitivity:"base"}));if(c.length>0){for(let n=0;n<c.length;n++)for(let a=0;a<this.grData.Table.length;a++)if(this.grData.Table.FeatureFieldName&&("text"===c[n].ColumnDataType.toLowerCase()&&c[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()||c[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()&&["SalaryAccID","PayableAccID"].includes(c[n].SysColumnName.toString()))){let g=c[n].SysColumnName.toString();if(h.filter(T=>T.ComponentName===g).length>0){if(("-2"===c[n].UserDefaultValue.toString()||["SalaryAccID","PayableAccID"].includes(g))&&(t=r.filter(T=>T.ComponentName===g),t.length>0)){let T=this.ExcelTable[l][this.grData[a].FieldName.toString()];if(T&&""!==T.toString()){if(o=I.d.document.GetEmpImportDetails(3,T.toString(),2),o&&o.length>0)for(let d=0;d<o.length;d++)void 0!==o[d][0]?.NodeID&&(t[0].DebitAccountID=o[d][0].NodeID.toString());t[0].Flag="0"}}if("-3"===c[n].UserDefaultValue.toString()&&(t=r.filter(T=>T.ComponentName===g),t.length>0)){let T=this.ExcelTable[l][this.grData[a].FieldName.toString()];if(T&&""!==T.toString()){if(o=I.d.document.GetEmpImportDetails(3,T.toString(),2),o&&o.length>0)for(let d=0;d<o.length;d++)void 0!==o[d][0]?.NodeID&&(t[0].CreditAccountID=o[d][0].NodeID.toString());t[0].Flag="0"}}}}if(h=r.filter(n=>"0"===n.Flag?.toString()),h.length>0){i.push("<Rows>");for(let n=0;n<h.length;n++)i.push(`<Row EmpSeqNo="${s.toString()}" ComponentID="${h[n].ComponentID.toString()}" Type="${h[n].Type.toString()}" SNo="${h[n].SNo.toString()}" DebitAccountID="${h[n].DebitAccountID.toString()}" CreditAccountID="${h[n].CreditAccountID.toString()}" />`);i.push("</Rows>")}}return i.join("")}RoundOffValue(e,s){if(s>0&&e>0){let l=0,i=!1;l=e%s,l>0&&(s/l<=2&&(i=!0),e-=l,i&&(e+=s))}return e.ToString(I.d.SessionManager.sPayrollDecimals).replace(",","")}dsEmpPay(e){return this.dsEmpPayWithDate(e,null)}dsEmpPayWithDate(e,s){let l=`\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,8,len(SysColumnName)-7)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Earning%' \n          and a.Type=1 and a.GradeID=${e}\n        `;l+=null===s?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=`\n          union\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,10,len(SysColumnName)-9)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Deduction%' \n          and a.Type=2 and a.GradeID=${e}\n        `,l+=null===s?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=`\n          union\n          SELECT a.NodeID CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE a.GradeID=${e} and a.Type in(3,4)\n        `,l+=null===s?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=" Order By a.Type,a.SNo ";let i=null;return I.d.report.DataSetAsyn("RPT022",l.toString()).then(u=>{i=u.Tables[0]}).catch(u=>{alert(u)}),i}ImportEmployeeDocuments(){let e,s=0,l=0,i=0,u=0,h=0,m="",c="",n=[],a=[],g=this.costCenterTableZero,p=this.grData.Table;if(p.filter(d=>"-251"==d.FeatureFieldName),!(p.length>0))return this.DisplayMessage="Please select employee field",void(this.MessageVisibility=!0);if(p[0].FieldName.toString(),this.grData.Table.length>0){let d=this.costCenterTableZero.filter(F=>F.syscolumnname==F.Field1),S=this.grData.Table;if(S.filter(F=>F.FeatureFieldName==d[0].costcentercolid.toString()),S.length<=0)return this.DisplayMessage="Please select "+d[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0);if(d=this.costCenterTableZero.filter(F=>F.syscolumnname==F.Field2),S.filter(F=>F.FeatureFieldName==d[0].costcentercolid.toString()),S.length<=0)return this.DisplayMessage="Please select "+d[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0)}for(let d=0;d<this.ExcelTable.length;d++){e=new Ct.h;for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(g.filter(y=>y.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),g.length>0)){let y=g[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+y),y){case"Pay_Employee":e.EmpCode=this.ExcelTable[d][this.grData.Table[F].FieldName.toString()],e.EmpName=this.ExcelTable[d][this.grData.Table[F].FieldName.toString()],n=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),n.length>0?(h=parseInt(n[0].NodeID),e.EmpCode=n[0].Code.toString(),e.EmpName=n[0].Name.toString()):(a=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'"),a.length>0&&(h=parseInt(a[0].NodeID),e.EmpCode=a[0].Code.toString(),e.EmpName=a[0].Name.toString()));break;case"Field1":if(m=this.ExcelTable[d][this.grData.Table[F].FieldName.toString()],""==m||null==m)return this.DisplayMessage="Import completed ( Total :"+(l+s).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",c=c+"please check Name at Row No "+(d+1).toString()+"in Excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:c}),void(this.ListVisbility=!0);break;case"Field2":if(m=this.ExcelTable[d][this.grData.Table[F].FieldName.toString()],""==m||null==m)return this.DisplayMessage="Import completed ( Total :"+(l+s).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",c=c+"please check DateOfBirth at Row No "+(d+1).toString()+" in excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:c}),void(this.ListVisbility=!0)}}e.NodeID=h,e.DocumentsXML=this.GetEmpDocumentXML(h,this.IsUpdate,this.costCenterTableZero,d),u=e.SaveEmpDocuments(),i=u,i<0?(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):s++}this.ImportedCount="Imported :"+s.toString(),this.FailedCount="Failed :"+l.toString();let T=l+s;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+T.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpDocumentXML(e,s,l,i){Logger.InfoLog("ImportEmployeeDocument::Entering GetEmpDocumentXML");let u="",h="",t="",o="",r="",m=l,c=[];if(m.RowFilter="sysTableName='PAY_EmpDetail' ",m.length>0){if(s){let n=m.Table.filter(g=>g.syscolumnname==g.Field1&&g.syscolumnname==this.Feature.SelectedValue.toString()),a=I.d.document.GetDataSet("select * from pay_Empdetail where DType="+this.Feature.SelectedValue.toString()+" and EmployeeId="+e+" and Field1= '"+this.ExcelTable[i][n[0].FieldName.toString().toLowerCase()].toString()+"'");a.length>0&&null!=a?(r+='<Row Action="MODIFY"',r+=' NodeID="'+a.Rows[0].NodeId.toString()+'"'):(r+='<Row Action="NEW"',r+=' NodeID="0"')}else r+='<Row Action="NEW"',r+=' NodeID="0"';r+=' DType="'+this.Feature.SelectedValue.toString()+'"';for(let n=0;n<this.grData.Table.length;n++)for(let a=0;a<m.length;a++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&m[a].CostCenterColID.toString()==this.grData.Table[n].FeatureFieldName.toString())if("combobox"==m[a].UserColumnType.toString().toLowerCase()&&m[a].sysColumnName.toString().toLowerCase().Contains("field")){if(u="","null"!=this.ExcelTable[i][this.grData.Table[n].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[i][this.grData.Table[n].FieldName.toString()])if("44"==m[a].ColumnCostCenterID.toString()){c=I.d.document.GetEmpImportDetails(1,this.ExcelTable[i][this.grData.Table[n].FieldName.toString()],parseInt(m[a].ColumnCCListViewTypeID.toString()));for(let g=0;g<c.length;g++)c[g].includes("NodeID")&&(u=String(c[g][0].NodeID))}else u=this.ExcelTable[i][this.grData.Table[n].FieldName.toString()];h+=m[a].sysColumnName.toString()+"=N'"+u.replace("'","''")+"',"}else if("listbox"==m[a].UserColumnType.toString().toLowerCase()&&m[a].sysColumnName.toString().toLowerCase().Contains("ccnid")){if(u="",c=I.d.document.GetEmpImportDetails(3,this.ExcelTable[i][this.grData.Table[n].FieldName.toString()],parseInt(m[a].ColumnCostCenterID)),c.length>0)for(let g=0;g<c.length;g++)c[g].includes("NodeID")&&(u=String(c[g][0].NodeID));o+=m[a].SysColumnName+"=N'"+u.replace("'","''")+"',"}else"text"==m[a].UserColumnType.toString().toLowerCase()&&m[a].sysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=m[a].sysColumnName.toString()+"=N'"+this.ExcelTable[i][this.grData.Table[n].FieldName.toString()]+"',":"date"==m[a].UserColumnType.toString().toLowerCase()&&(m[a].sysColumnName.toString().toLowerCase().Contains("field")||m[a].sysColumnName.toString().toLowerCase().Contains("ccalpha"))?(u=this.ExcelTable[i][this.grData.Table[n].FieldName.toString()],""!=u&&(u=new Date(u).toLocaleDateString("dd/MMM/yyyy"),m[a].SysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=m[a].sysColumnName.toString()+"=N'"+this.ExcelTable[i][this.grData.Table[n].FieldName.toString()]+"',":h+=m[a].sysColumnName.toString()+"=N'"+this.ExcelTable[i][this.grData.Table[n].FieldName.toString()]+"',")):"EmployeeID"==m[a].sysColumnName.toString()&&""!=m[a].sysColumnName.toString()?h+=m[a].sysColumnName.toString()+"="+e+",":h+=m[a].sysColumnName.toString()+"=N'"+this.ExcelTable[i][this.grData.Table[n].FieldName.toString()]+"',";r+=' StaticFields ="'+h.toString().Trim(",")+'" ',r+=' ExtraTextFields ="'+t.toString().Trim(",")+'" ',r+=' CCFields ="'+o.toString().Trim(",")+'" ',r+="/>"}return r.length>0&&(r.Insert(0,"<Data>"),r+="</Data>"),Logger.InfoLog("ImportEmployeeDocument::Exiting GetEmpDocumentXML which RETURN XML="+r),r.toString()}ImportEmployeeAppraisal(){let e=new Ct.h,s=0,l=0,i=0,u=!0,h=!1,o="",r=[],m=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++){e=new Ct.h,u=!0,o="";let g=0;for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(m.filter(d=>d.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),m.length>0)){let d=m[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+d),d){case"Code":e.EmpCode=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()];break;case"Name":e.EmpName=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()];break;case"EffectFromDate":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtEffectFrom=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"ActAppraisalFrom":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtActAppraisalFrom=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"NextAppraisalDate":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtNextAppraisalDate=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"BasicMonthly":h=!0,this.dblBasicMonthly=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AnnualCTC":this.dblAnnualCTC=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AppraisalRemarks":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.AppraisalRemarks=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AppraisalReason":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.AppraisalReason=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"Percentage":h=!0,"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dblPercentage=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]))}}let p=I.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'");if(p.length>0&&1==this.IsCode?(i=parseInt(p.Rows[0].NodeID),e.EmpCode=p.Rows[0].Code.toString(),e.EmpName=p.Rows[0].Name.toString(),e.DOJ=new Date(p.Rows[0].DateOfJoining.toString()),this.Doj=e.DOJ):(r=I.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),r.length>0&&(i=parseInt(r[0].NodeID),e.EmpCode=r[0].Code.toString(),e.EmpName=r[0].Name.toString(),e.DOJ=new Date(r[0].DateOfJoining.toString()),this.Doj=e.DOJ)),null!=this.Doj&&(this.dtEffectFrom<this.Doj||this.dtActAppraisalFrom<this.Doj)&&(o="EffectFrom and ApplyFrom should be Grater than or Equal to the Date of Joining."),""==o.toString()){let d=I.d.document.GetDataSet('Select * From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + lngNodeID + @" AND SeqNo<>" + 0 + @"\n                            AND Month(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Month + " AND YEAR(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Year');null!=d&&d.length>0&&(this.IsUpdate?g=parseFloat(d.Rows[0].SeqNo.toString()):o="Appraisals already defined for this Month, Can't allow More than once.")}if(""==o.toString()&&"False"==I.d.SessionManager.Preferences.AllowAppraisalIfProcessed&&I.d.document.GetDataSet('SELECT TOP 1 CONVERT(DATETIME,a.DueDate) as PayrollMonth  \n                                                FROM INV_DocDetails a WITH(NOLOCK) \n                                                JOIN COM_DocCCData b WITH(NOLOCK) ON b.InvDocDetailsID=a.InvDocDetailsID\n                                                JOIN COM_DocTextData d WITH(NOLOCK) ON d.InvDocDetailsID=a.InvDocDetailsID\n                                                WHERE a.CostCenterID=40054 and a.StatusID=369 AND b.dcCCNID51=" + lngNodeID + @" \n                                                AND ( CONVERT(DATETIME,d.dcAlpha17) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' OR CONVERT(DATETIME,d.dcAlpha18) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' )').length>0&&(o="Appraisal can not be processed. Because already processed payrolls exists."),""!=o.toString()&&(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:o.toString()}),u=!1),u){e.NodeID=i;let T=[];T.push(i),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.RoleID),T.push(I.d.SessionManager.LanguageID),this.dsEmpEdit=this.objEmpEss.GetEmpMasterDetails(),null!=this.dsEmpEdit&&this.dsEmpEdit.Tables.length>0?("True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()&&this.dsEmpEdit.Tables[7].length>0&&(this.EmpGrade=parseInt(this.dsEmpEdit.Tables[7][0].CCNID53.toString())),e.DocumentsXML=this.GetEmpAppraisal(i,!1,this.costCenterTableZero,n,this.dsEmpEdit.Tables[14],h)):e.DocumentsXML=this.GetEmpAppraisal(i,!1,this.costCenterTableZero,n,null,h),null==I.d.document.GetDataSet(e.DocumentsXML)?(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):s++}}this.ImportedCount="Imported :"+s.toString(),this.FailedCount="Failed :"+l.toString();let c=l+s;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+c.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpAppraisal(e,s,l,i,u,h){Logger.InfoLog("ImportEmployeeAppraisal::Entering GetEmpAppraisal");let t="",o="",r="",m=0;this.dtPayrollE=[],this.dtPayrollD=[];let c=this.costCenterTableZero;if(c.filter(n=>n.sysTableName==n.PAY_EmpPay||n.sysColumnName==n.Percentage),c.length>0){if(h){if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("NodeID"),this.dtPayrollD=[],this.dtPayrollE=[],this.dsPayStructure=this.dsEmpPay(this.EmpGrade),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let n={},a=this.dsPayStructure.Tables[0];a.filter(g=>1==g.Type&&"Yes"==g.Applicable&&"OverTime"==g.FieldType);for(let g=0;g<a.length;g++)n={},n.SlNo=(g+1).toString(),n.Earnings=a[g].ComponentName.toString(),n.EarSNo=a[g].SNo.toString(),n.EarFormula=a[g].Formula.toString(),n.EarRoff=a[g].ROff.toString(),n.EarValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),n.EarAddToNet=a[g].AddToNet.toString(),n.EarFType=a[g].FieldType.toString(),"EmployeeMaster"!=n.EarFType.toString()&&(n.Earnings_GRAY="1",n.EarValue_GRAY="1"),n.NodeID=a[g].CostCenterColID.toString(),this.dtPayrollE.push(n);a.filter(g=>2==g.Type&&"Yes"==g.Applicable&&"NetSalary"==g.FieldType&&"OverTime"==g.FieldType);for(let g=0;g<a.length;g++)n={},n.SlNo=(g+1).toString(),n.Deductions=a[g].ComponentName.toString(),n.DedSNo=a[g].SNo.toString(),n.DedFormula=a[g].Formula.toString(),n.DedROff=a[g].ROff.toString(),n.DedValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),n.DedAddToNet=a[g].AddToNet.toString(),n.DedFType=a[g].FieldType.toString(),"EmployeeMaster"!=n.DedFType.toString()&&(n.Deductions_GRAY="1",n.DedValue_GRAY="1"),n.NodeID=a[g].CostCenterColID.toString(),this.dtPayrollD.push(n)}if(null!=u){let n=u;if(n.Sort="EffectFrom DESC,SeqNo DESC",n.length>0){for(let a=0;a<this.dtPayrollE.length;a++)null!=this.dtPayrollE[a].EarSNo&&null!=this.dtPayrollE[a].EarSNo&&""!=this.dtPayrollE[a].EarSNo.toString()&&(this.dtPayrollE[a].EarValue=parseFloat(n[0]["Earning"+this.dtPayrollE[a].EarSNo]).ToString(I.d.SessionManager.sPayrollDecimals));for(let a=0;a<this.dtPayrollD.length;a++)null!=this.dtPayrollD[a].DedSNo&&null!=this.dtPayrollD[a].DedSNo&&""!=this.dtPayrollD[a].DedSNo.toString()&&(this.dtPayrollD[a].DedValue=parseFloat(n[0]["Deduction"+this.dtPayrollD[a].DedSNo]).ToString(I.d.SessionManager.sPayrollDecimals))}}}for(let n=0;n<c.length;n++)for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&"float"==c[n].ColumnDataType.toString().toLowerCase()&&c[n].CostCenterColID.toString()==this.grData.Table[a].FeatureFieldName.toString())if("BasicMonthly"==c[n].sysColumnName.toString())m=parseFloat(this.ExcelTable[i][this.grData.Table[a].FieldName.toString()]),r+=c[n].SysColumnName.toString()+"="+m+",",this.dblNetSalary=0,this.ExecuteFormulas(m,i,e);else if("Percentage"==c[n].sysColumnName.toString()){let g=0,p=0;if(this.dblPercentage>0){let d=I.d.document.GetDataSet('Select EmployeeID,SeqNo,Convert(DateTime,EffectFrom) EffectFrom,BasicMonthly From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + EmpNode + @" AND SeqNo<>" + 0 + @"\n                            AND Convert(DateTime,EffectFrom)<=CONVERT(DATETIME,\'" + dtEffectFrom.toLocaleDateString("dd MMM yyyy") + "\') ORDER BY EffectFrom DESC');null!=d&&d.length>0&&(p=parseFloat(d.Rows[0].BasicMonthly.toString())),g=p*this.dblPercentage/100,p+=g,this.dblBasicMonthly=p,this.dblNetSalary=0,this.ExecuteFormulas(this.dblBasicMonthly,i,e)}}else"-1"!=c[n].UserDefaultValue.toString()&&(r+=c[n].SysColumnName.toString()+"="+this.ExcelTable[i][this.grData.Table[a].FieldName.toString()]+",")}if(this.IsUpdate){if(this.EditSeqNo>0){if(t+="UPDATE PAY_EmpPay SET EffectFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),ApplyFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),NetSalary=",t+=this.dblNetSalary,t+=",BasicMonthly=",t+=this.dblBasicMonthly,t+=",AnnualCTC=",t+=this.dblAnnualCTC,t+=",Remarks='",t+=this.AppraisalRemarks.Append("'"),t+=",Reason='",t+=this.AppraisalReason.Append("'"),t+=",ModifiedBy='",t+=I.d.SessionManager.UserName,t+="'",t+=",ModifiedDate=CONVERT(FLOAT,GETDATE())",t+=this.dblPercentage>0?",Percentage="+this.dblPercentage:",Percentage=0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString()+"="+this.dtPayrollE[n].EarValue.toString);if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString()+"="+this.dtPayrollD[n].DedValue.toString);t+=" WHERE SeqNo="+this.EditSeqNo}}else{if(t+="INSERT INTO PAY_EmpPay(EmployeeID,EffectFrom,ApplyFrom,NetSalary,BasicMonthly,AnnualCTC,Remarks,Reason,CreatedBy,CreatedDate,ModifiedDate,Percentage",o+="VALUES("+e+",CONVERT(INT,CONVERT(DATETIME,'"+this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy")+"')),CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy")+"')),",o+=this.dblNetSalary,o+=","+this.dblBasicMonthly,o+=","+this.dblAnnualCTC,o+=",'"+this.AppraisalRemarks+"'",o+=",'"+this.AppraisalReason+"'",o+=",'"+I.d.SessionManager.UserName+"'",o+=",CONVERT(FLOAT,GETDATE())",o+=",CONVERT(FLOAT,GETDATE())",o+=this.dblPercentage>0?","+this.dblPercentage:",0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString(),o+=","+this.dtPayrollE[n].EarValue.toString());if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString(),o+=","+this.dtPayrollD[n].DedValue.toString());t+=")"+o.toString()+")",new Date(this.dtNextAppraisalDate.toLocaleDateString("MMM yyyy"))>new Date(this.dtActAppraisalFrom.toLocaleDateString("MMM yyyy"))?t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtNextAppraisalDate.toLocaleString("dd/MMM/yyyy")+"')) WHERE NodeID="+e:t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.AddMonths(1).Date.toString()+"')) WHERE NodeID="+e}return Logger.InfoLog("ImportEmployeeAppraisal::Exiting GetEmpAppraisalXML which RETURN XML="+t),t.toString()}FillQtyRateCombo(){this.QtyRateVisible=!0,this.QtyCombo.Items.Clear(),this.RateCombo.Items.Clear(),this.QtyCombo.Items.push(se._p.ComboBoxItems_2("","")),this.RateCombo.Items.push(se._p.ComboBoxItems_2("",""));for(const e of this.ExcelTable)(e.DataType==typeof parseFloat||e.DataType==typeof Jt.aig)&&(this.QtyCombo.Items.push(se._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)),this.RateCombo.Items.push(se._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)));this.RateCombo.Items.push(se._p.ComboBoxItems_2("AVGRATE","AVGRATE"))}CheckAvgRateexists(){let e=this.costCenterTableZero;if(this.IsQtyChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let s of this.grData.Table)if("GrossValue"==s.FieldName.toString()){this.grData.Table.Remove(s);break}}if(this.ExcelTable.includes("QuantityValue")){this.ExcelTable.Remove("QuantityValue");for(let s of this.grData.Table)if("QuantityValue"==s.FieldName.toString()){this.grData.Table.Remove(s);break}}if(null!=this.QtyText.Text&&""!=this.QtyText.Text){let s=0;if(s=N.J0.Int(this.QtyText.Text),!this.ExcelTable.some(l=>"QuantityValue"===l.columnName)&&s>0){let l={ColumnName:"QuantityValue",DataType:"number",DefaultValue:N.J0.Int(s)};if(this.ExcelTable.push(l),e=this.costCenterTableZero,e.filter(i=>"Quantity"==i.SysColumnName),!(e.length>0))return this.DisplayMessage="Quantity field doesnot exists",void(this.MessageVisibility=!0);{let i={FieldName:"QuantityValue"};i.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(i)}}}else if(null!=this.QtyCombo.SelectedValue&&""!=this.QtyCombo.SelectedValue&&!this.ExcelTable.includes("QuantityValue")){let s=0;if(s=N.J0.Int(this.QtyText.Text),this.ExcelTable.push({ColumnName:"QuantityValue",DataType:"number",Expression:this.QtyCombo.SelectedValue}),e.filter(i=>"Quantity"==i.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let i={FieldName:"QuantityValue"};i.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(i)}}}if(this.IsRateChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let s of this.grData.Table)if("GrossValue"==s.FieldName.toString()){this.grData.Table.Remove(s);break}}if(this.ExcelTable.includes("RateValue")){this.ExcelTable.Remove("RateValue");for(let s in this.grData.Table)if("RateValue"==s.FieldName.toString()){this.grData.Table.Remove(s);break}}if(null!=this.RateText.Text&&""!=this.RateText.Text){let s=0;if(s=parseFloat(this.RateText.Text),!this.ExcelTable.includes("RateValue")&&s>0){if(this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",ReadOnly:!1}),e=this.costCenterTableZero,e.filter(i=>"Quantity"==i.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let i={FieldName:"RateValue"};i.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(i)}}}else if("AVGRATE"==this.RateCombo.SelectedValue){let s;this.ExcelTable.includes("AVGRATE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),s={},s.FieldName="AVGRATE",s.FeatureFieldName="-27",this.grData.Table.push(s)),this.ExcelTable.includes("AVGRATEVALUE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),s={},s.FieldName="AVGRATEVALUE",s.FeatureFieldName="-28",this.grData.Table.push(s))}else if(null!=this.RateCombo.SelectedValue&&""!=this.RateCombo.SelectedValue&&!this.ExcelTable.includes("RateValue")){let s=0;if(s=parseFloat(this.QtyText.Text),this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",Expression:this.RateCombo.SelectedValue,ReadOnly:!1}),e.filter(i=>"Quantity"==i.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let i={FieldName:"RateValue"};i.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(i)}}}if(this.IsQtyChecked||this.IsRateChecked&&"AVGRATE"!=this.RateCombo.SelectedValue){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let i of this.grData.Table)if("GrossValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}let s,l;if(e.filter(i=>"Quantity"==i.SysColumnName),e.length>0){let i=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());i.length>0&&(s=i[0].FieldName.toString())}if(e.filter(i=>"Quantity"==i.SysColumnName),e.length>0){let i=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());i.length>0&&(l=i[0].FieldName.toString())}if(""!=l&&""!=s&&(this.ExcelTable.push({ColumnName:"GrossValue",DataType:"number",Expression:l*s,ReadOnly:!1}),e=this.costCenterTableZero,e.filter(u=>"Gross"==u.SysColumnName),e.length>0)){let u={FieldName:"GrossValue"};u.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(u)}}}Importbackgroundprocess(){this.ProgressVisbility=!0,this.ImportVisbility=!1,this.ProgressMax=this.ExcelTable.length,this.worker1_DoWork()}groupmethod(){for(let e of this.grData.Table){let s=this.costCenterTableZero;if(""!=e.FeatureFieldName.toString()){const l=s.filter(i=>i.CostCenterColID==e.FeatureFieldName.toString());if(l.length>0){let i=l[0].SysColumnName.toString();if("group"==i.toLowerCase()||"isgroup"==i.toLowerCase()||"parentid"==i.toLowerCase()){this.GroupExists=!0,this.tempfield=e.FieldName.toString();break}}}}if(this.ProgressVisbility=!1,this.ImportVisbility=!0,this.DisplayMessage="Scanning of data is in process, please wait...",this.MessageVisibility=!0,this.GroupExists){this.IsExcel?(this.ExcelTable=[],this.dvMain=this.dsexcel):this.dvMain=this.ExcelTable;try{this.dvMain.filter(e=>"1"==e.tempfield||"YES"==e.tempfield),this.ExcelTable.length>0?this.GroupsImport=!0:this.ExcelTable=this.dvMain,this.onPreviewDataClick(),this.DisplayMessage="",this.MessageVisibility=!1,this.GroupExists=!1,this.IsPreviewDataOk&&this.Importbackgroundprocess()}catch(e){return this.DisplayMessage=e.Message,Logger.ErrorLog(" Message: - "+e.stack),void(this.MessageVisibility=!0)}}else this.onPreviewDataClick(),this.IsPreviewDataOk&&(this.DisplayMessage="",this.MessageVisibility=!1,this.Importbackgroundprocess())}worker1_DoWork(){"50051"==this.Feature.SelectedValue.toString()?"PAYROLL EMPLOYEE_APPRAISAL"==this.Feature.SelectedItem.Name.toString().toUpperCase()?this.ImportEmployeeAppraisal():this.ImportEmployeeData():this.ImportCosCenters()}worker1_RunWorkerCompleted(e,s){if(this.ProgressVisbility=!1,this.ImportVisbility=!0,this.GroupExists){this.ClearVaraiables();try{this.ExcelTable=[],this.dvMain.filter(l=>"0"==l.tempfield||"NO"==l.tempfield),this.ExcelTable=this.dvMain,this.GroupsImport=!1,this.onPreviewDataClick(),this.DisplayMessage="",this.MessageVisibility=!1,this.GroupExists=!1,this.IsPreviewDataOk&&this.Importbackgroundprocess()}catch(l){return this.DisplayMessage=l.Message,Logger.ErrorLog(" Message: - "+l.stack),void(this.MessageVisibility=!0)}}}worker_RunWorkerCompleted(e,s){if(Logger.InfoLog("Entered into  worker_RunWorkerCompleted()..."),this.ProgressVisbility=!1,this.ImportVisbility=!0,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){if(this.isCreditRowAdded)for(let l of this.grData.Table)"CreditAccount"==l[0].toString()&&this.grData.Table.Remove(l);if(this.isDebitRowAdded)for(let l of this.grData.Table)if("DebitAccount"==l[0].toString()){this.grData.Table.Remove(l);break}this.isCreditRowAdded=!1,this.isDebitRowAdded=!1}Logger.InfoLog("Exit from worker_RunWorkerCompleted()...")}ImportMonthlyPayroll(){}ImportAccountDimwiseCrDrLimits(){let e=this.costCenterTableZero,s=0,l="",i="",u="",h=[],t=[];t=this.ExcelTable;let o="";this.ScanServiceDimensionFields(!1);let r="",m="",c=this.grData.Table;if(c.filter(n=>"238"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"239"==n.FeatureFieldName),c.length>0&&(m=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strCodeColumn==o)):""!=this.ExcelTable[n][m].toString()&&(o=this.ExcelTable[n][m].toString(),t.filter(a=>a.strNameColumn==o)),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){for(let T=0;T<t.length;T++){u+="<Row ",u+=' Sno="'+T+'1" ';for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"CCNID2":u+=" LocationID ='"+t[T][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CCNID1":u+=" DivisionID ='"+t[T][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Dimension":u+=" DimensionID ='"+t[T][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Currency":u+=" CurrencyID ='"+t[T][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CreditDays":u+=" CreditDays ='"+t[T][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"CreditLimit":u+=" Credit ='"+t[T][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"DebitDays":u+=" DebitDays ='"+t[T][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"DebitLimit":u+=" Debit ='"+t[T][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"AccountCode":0==T&&(l=t[T][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode&&h.push(se._p.ComboBoxItems_1(l)));break;case"AccountName":0==T&&(i=t[T][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode||h.push(se._p.ComboBoxItems_1(i)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let a,g,p=[];p.push(u.toString()),p.push(i),p.push(l),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),g=I.d.document.SetImportDataToAccLocDivLimits(p),a=g,g<=0&&(s++,this.FailedRecourdList.push({Name:" Account  Name : "+o,Message:a})),u="",this.ImportedCount="Imported :"+(n+t.length-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountReportTemplate(){let e=this.costCenterTableZero,s=null;this.CostCenterFieldsAllTables.length>1&&(s=this.CostCenterFieldsAllTables[1]);let l=0,i="",u="",h="",t=[],o=[];o=this.ExcelTable;let r="",m="",c="",n=this.grData.Table;if(n.filter(a=>"238"==a.FeatureFieldName),n.length>0&&(m=n[0].FieldName.toString()),n.filter(a=>"239"==a.FeatureFieldName),n.length>0&&(c=n[0].FieldName.toString()),this.grData.Table=n,this.IsCode&&""==m)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==c)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[a][m].toString()&&(r=this.ExcelTable[a][m].toString(),o.filter(g=>g.strCodeColumn==k.Dw.GetValidXml(r))):""!=this.ExcelTable[a][c].toString()&&(r=this.ExcelTable[a][c].toString(),o.filter(g=>g.strNameColumn==k.Dw.GetValidXml(r))),0==t.filter(g=>g.Name.toUpperCase()==r.toUpperCase()).length){for(let d=0;d<o.length;d++){h+="<Row ",h+=' Sno="'+d+'1" ';let S=0;for(let F=0;F<this.grData.Table.length;F++){let y=null;if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(o.filter(C=>C.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"TemplateNodeID":if(y=s.Select(null==s||this.IsCode?f=>f.Code==o[d][this.grData.Table[F].FieldName.toString()]&&1==f.Depth:f=>f.Name==o[d][this.grData.Table[F].FieldName.toString()]&&1==f.Depth),!(y.length>0))return this.DisplayMessage="Only Level 1 groups are allowed at Row "+(d+1),void(this.MessageVisibility=!0);h+=' TemplateNodeID ="'+y[0].NodeID.toString()+'"',S=parseInt(y[0].NodeID.toString());break;case"DrNodeID":if(y=s.Select(" NodeID='"+S+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(d+1),void(this.MessageVisibility=!0);{let f=0,b=0;if(f=parseInt(y[0].lft.toString()),b=parseInt(y[0].rgt.toString()),y=s.Select(this.IsCode?"Code ='"+o[d][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'":"Name ='"+o[d][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(d+1),void(this.MessageVisibility=!0);h+=' DrNodeID ="'+y[0].NodeID.toString()+'"'}break;case"CrNodeID":if(y=s.Select(" NodeID='"+S+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(d+1),void(this.MessageVisibility=!0);{let f=0,b=0;if(f=parseInt(y[0].lft.toString()),b=parseInt(y[0].rgt.toString()),y=s.Select(this.IsCode?"Code ='"+o[d][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'":"Name ='"+o[d][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(d+1),void(this.MessageVisibility=!0);h+=' CrNodeID ="'+y[0].NodeID.toString()+'"'}break;case"RTDate":{let f;if(f=""!=o[d][this.grData.Table[F].FieldName.toString().Trim()]&&N.J0.isValidDate(o[d][this.grData.Table[F].FieldName.toString().Trim()]),f)h+=' RTDate="'+new Date(f.Year,f.Month,1).toLocaleDateString("dd/MMM/yyyy")+'"';else if(""!=o[d][this.grData.Table[F].FieldName.toString().Trim()])return this.DisplayMessage="Invalid Date at Row "+(d+1),void(this.MessageVisibility=!0)}break;case"RTGroup":h+=' RTGroup="'+o[d][this.grData.Table[F].FieldName.toString()]+'"';break;case"AccountCode":0==d&&(i=o[d][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode&&t.push(se._p.ComboBoxItems_1(i)));break;case"AccountName":0==d&&(u=o[d][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode||t.push(se._p.ComboBoxItems_1(u)))}}h+="></Row>"}h.Insert(0,"<XML>"),h+="</XML>";let g,T,p=[];p.push(h.toString()),p.push(u),p.push(i),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),T=I.d.document.SetImportDataToAccReportTemplate(p),T<=0&&(l++,this.FailedRecourdList.push({Name:" Account  Name : "+r,Message:g})),h="",this.ImportedCount="Imported :"+(a+o.length-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWiseBins(){let e=this.costCenterTableZero,s=0,l="",i="",u="",h=[],t=[];t=this.ExcelTable;let o="",r="",m="",c=this.grData.Table;if(c.filter(n=>"261"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"262"==n.FeatureFieldName),c.length>0&&(m=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strPCodeColumn==o.replace("'","''"))):""!=this.ExcelTable[n][m].toString()&&(o=this.ExcelTable[n][m].toString(),t.filter(a=>a.strPNameColumn==o.replace("'","''"))),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){for(let T=0;T<t.length;T++){u+="<Row ",u+=' Sno="'+T+'1" ';for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"BinDimension":u+=" Bin ='"+k.Dw.GetValidTextXml(t[T][this.grData.Table[d].FieldName.toString().Trim()])+"'  ";break;case"Capacity":u+=" Capacity ='"+t[T][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"IsDefault":"true"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"yes"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"y"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"1"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"on"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="1" ':u+=e[0].SysColumnName.toString()+' ="0" ';break;case"StatusID":"in active"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"2"==t[T][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="2" ':u+=e[0].SysColumnName.toString()+' ="1" ';break;case"DimesionWiseBin":u+=" DimesionWiseBin ='"+k.Dw.GetValidTextXml(t[T][this.grData.Table[d].FieldName.toString().Trim()])+"'  ";break;case"ProductCode":0==T&&(l=t[T][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode&&h.push(se._p.ComboBoxItems_1(l.replace("'","''"))));break;case"ProductName":0==T&&(i=t[T][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode||h.push(se._p.ComboBoxItems_1(i.replace("'","''"))))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let a,p,g=[];g.push(u.toString()),g.push(i),g.push(l),g.push(this.IsCode),g.push(I.d.SessionManager.CompanyIndex),p=I.d.document.SetImportDataToProductBins(g),p<=0&&(s++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:a})),u="",this.ImportedCount="Imported :"+(n+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWithSubstitues(){let e=this.costCenterTableZero,s=0,l=0,i=0,u="",h="",t="",o="",r="",m=[],c=[];c=this.ExcelTable;let a="",g=this.grData.Table;g.filter(p=>"11386"==p.FeatureFieldName),g.length>0&&(o=g[0].FieldName.toString());for(let p=0;p<this.ExcelTable.length;p++,this.ProgressValue++)if(a=this.ExcelTable[i][o].toString(),c.filter(T=>T.strGroupColumn==a),0==m.filter(T=>T.Name.toUpperCase()==a.toUpperCase()).length){for(let y=0;y<c.length;y++){r+="<Row ";for(let C=0;C<this.grData.Table.length;C++)if(null!=this.grData.Table[C].FeatureFieldName&&""!=this.grData.Table[C].FeatureFieldName.toString()&&(e.filter(f=>f.CostCenterColID==this.grData.Table[C].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"SNO":r+=" SNO ='"+c[y][this.grData.Table[C].FieldName.toString().Trim()]+"'  ";break;case"ProductCode":0==y&&(u=c[y][this.grData.Table[C].FieldName.toString().Trim()],this.IsCode&&m.push(se._p.ComboBoxItems_1(u)));break;case"ProductName":0==y&&(h=c[y][this.grData.Table[C].FieldName.toString().Trim()],this.IsCode||m.push(se._p.ComboBoxItems_1(h)));break;case"SubstituteGroupName":t=c[y][this.grData.Table[C].FieldName.toString()];break;case"SubstituteProduct":r+=" SubProduct ='"+c[y][this.grData.Table[C].FieldName.toString().Trim()]+"'  "}r+=' ExRowNo="'+i+'" ></Row>',i+=1}r.Insert(0,"<SubstituteXML>"),r+="</SubstituteXML>",p=i;let d=[];d.push(h),d.push(u),d.push(t),d.push(r.toString()),d.push(this.IsCode),d.push(I.d.SessionManager.CompanyIndex);let F=I.d.document.SetImportDataToProductSubstitutes(d);if(null!=F&&F.Tables[0].length>0)for(let y=0;y<F.Tables[0].length;y++)"Success"==F.Tables[0][y].Status.toString()?(l++,this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].xIMP_STATUSx="PASS",this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].IMPORT_MESSAGE=F.Tables[0][y].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:F.Tables[0][y].SMessage.toString()})):"Fail"==F.Tables[0][y].Status.toString()&&(s++,this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].xIMP_STATUSx="FAIL",this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].IMPORT_MESSAGE=F.Tables[0][y].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:F.Tables[0][y].SMessage.toString()}));r="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportKitProducts(){let e=this.costCenterTableZero,s=0,l="",i="",u="",h=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let o="",r="",m="",c=this.grData.Table;if(c.filter(n=>"261"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"262"==n.FeatureFieldName),c.length>0&&(m=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strPCodeColumn==o)):""!=this.ExcelTable[n][m].toString()&&(o=this.ExcelTable[n][m].toString(),t.filter(a=>a.strGroupColumn==o)),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){let a=!1;for(let d=0;d<t.length;d++){a=!1,u+="<Row ",u+=' RowNo="'+d+'1" ';for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Kit_Product":if(""==t[d][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()||a)return this.DisplayMessage="Error Invalid Kit Product @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[d][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+"'  ",a=!0;break;case"Kit_Product_Code":if(""==t[d][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()||a)return this.DisplayMessage="Error Invalid Kit Product Code @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[d][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+"'  ",a=!0;break;case"Kit_Qty":if(""==t[d][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit Qty @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Qty ='"+t[d][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Kit_UOM":if(""==t[d][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);{let y=this.grData.Table.filter(f=>"-34"==f.FeatureFieldName),C=null;if(y.length>0?C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[d][this.grData.Table[S].FieldName.toString().Trim()]+"' and ProductCode='"+this.ExcelTable[n][y[0].FieldName.toString().Trim()].replace("'","''")+"'"):(y=this.grData.Table.filter(f=>"-30"==f.FeatureFieldName),y.length>0&&(C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[d][this.grData.Table[S].FieldName.toString().Trim()]+"' and ProductName='"+this.ExcelTable[n][y[0].FieldName.toString().Trim()].replace("'","''")+"'"))),(null==C||0==C.length)&&(C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[d][this.grData.Table[S].FieldName.toString().Trim()]+"'  and (ProductName is null or ProductName='DynamicSet')")),!(C.length>0))return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Unit ='"+C[0].UOMID.toString()+"'"}break;case"Kit_Rate":if(""==t[d][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid rate @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Rate ='"+t[d][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Kit_Link":""==t[d][this.grData.Table[S].FieldName.toString().Trim()]||"OPTIONAL"!=t[d][this.grData.Table[S].FieldName.toString().Trim()].toUpperCase()&&"O"!=t[d][this.grData.Table[S].FieldName.toString().Trim()]&&"1"!=t[d][this.grData.Table[S].FieldName.toString().Trim()]?""!=t[d][this.grData.Table[S].FieldName.toString().Trim()]&&("MANDATORY"==t[d][this.grData.Table[S].FieldName.toString().Trim()]||"M"==t[d][this.grData.Table[S].FieldName.toString().Trim()]||"2"==t[d][this.grData.Table[S].FieldName.toString().Trim()])&&(u+=" LINK ='2'"):u+=" LINK ='1'";break;case"ProductCode":0==d&&(l=t[d][this.grData.Table[S].FieldName.toString().Trim()],this.IsCode&&h.push(se._p.ComboBoxItems_1(l)));break;case"ProductName":0==d&&(i=t[d][this.grData.Table[S].FieldName.toString().Trim()],this.IsCode||h.push(se._p.ComboBoxItems_1(i)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let g,T,p=[];p.push(i),p.push(l),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyIndex),T=I.d.document.SetImportKitProducts(p),T<=0&&(s++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:g})),u="",this.ImportedCount="Imported :"+(n+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAttachments(){let e=this.costCenterTableZero,s=0,l=0,i="",u="";if(!this.ScanCostCenterFields(!1))return;let h="",t="",o=[],r=[];r=this.ExcelTable;let m="",c="",n="",a=this.grData.Table;if(a.filter(g=>"12"==g.FeatureFieldName),a.length>0&&(c=a[0].FieldName.toString()),a.filter(g=>"13"==g.FeatureFieldName),a.length>0&&(n=a[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(this.IsCode&&""==c)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==n)return this.DisplayMessage="Please select name field",void(this.MessageVisibility=!0);for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[g][c].toString()&&(m=this.ExcelTable[g][c].toString(),r.filter(p=>p.strPCodeColumn==m)):""!=this.ExcelTable[g][n].toString()&&(m=this.ExcelTable[g][n].toString(),r.filter(p=>p.strPNameColumn==m)),!o.Contains(m.toUpperCase())){for(let S=0;S<r.length;S++){h+='<Row Action="NEW" ';for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(e.filter(y=>y.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),e.length>0)){let y=e[0].SysColumnName.toString();switch(y){case"Type":""!=r[S][this.grData.Table[F].FieldName.toString()+"_Key"].toString().Trim()&&(h+=' Type ="'+r[S][this.grData.Table[F].FieldName.toString()+"_Key"].toString().Trim()+'"  ');break;case"IssueDate":case"Validtill":{let C;C=N.J0.isValidDate(r[S][this.grData.Table[F].FieldName.toString().Trim()]),C&&(h+=y+'="'+C.toLocaleDateString("dd/MMM/yyyy")+'" ');break}case"FileDescription":case"Remarks":case"DocNo":case"RefNo":h+=y+'="'+r[S][this.grData.Table[F].FieldName.toString().Trim()]+'"  ';break;case"stat":case"status":"active"==r[S][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"1"==r[S][this.grData.Table[F].FieldName.toString().Trim()]?h+='stat="1"  ':h+='stat="0"  ';break;case"FileName":break;case"Code":0==S&&(i=r[S][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode&&o.push(i.toUpperCase()));break;case"Name":0==S&&(u=r[S][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode||o.push(u.toUpperCase()))}}h+="></Row>"}if(0==t.toString().length){t+="<Detxml ";for(let S=0;S<this.grData.Table.length;S++)null==this.grData.Table[S].FeatureFieldName||""==this.grData.Table[S].FeatureFieldName.toString()||(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0&&"1"==e[0].IsUnique.toString()&&(t+=" "+e[0].SysColumnName.toString()+'="1" '+e[0].SysColumnName.toString()+'Text="'+e[0].ResourceData.toString()+'" '));t+="></Detxml>",h+=t.toString()}else h+=t.toString();h.Insert(0,"<AttachmentsXML>"),h+="</AttachmentsXML>";let p,d,T=[];T.push(h.toString()),T.push(this.QtyCombo.SelectedValue),T.push(u),T.push(i),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyIndex),d=I.d.document.ImportAttachments(T),d>0?l++:d<=0&&(s++,this.FailedRecourdList.push({Name:" Product  Name : "+m,Message:p})),h="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportQCProducts(){let e=this.costCenterTableZero,s=0,l="",i="",u="",h=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let o="",r="",m="",c=this.grData.Table;if(c.filter(a=>"261"==a.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(a=>"262"==a.FeatureFieldName),c.length>0&&(m=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[a][r].toString()&&(o=this.ExcelTable[a][r].toString(),t.filter(g=>g.strPCodeColumn==o)):""!=this.ExcelTable[a][m].toString()&&(o=this.ExcelTable[a][m].toString(),t.filter(g=>g.strPNameColumn==o)),!h.includes(o.toUpperCase())){let g;for(let S=0;S<t.length;S++){u+="<Row ",u+=' RowNo="'+S+'1" ';let F=!1;for(let y=0;y<this.grData.Table.length;y++)if(null!=this.grData.Table[y].FeatureFieldName&&""!=this.grData.Table[y].FeatureFieldName.toString()&&(e.filter(C=>C.CostCenterColID==this.grData.Table[y].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"QC Name":case"QC Code":if(""==t[S][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim())return this.DisplayMessage="Error Invalid Kit QC @ row "+(a+1),void(this.MessageVisibility=!0);F||(u+=" TestCaseID ='"+t[S][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim()+"'  ",F=!0);break;case"Document":if(""!=t[S][this.grData.Table[y].FieldName.toString().Trim()]){var n=this.Feature.Items.firstOrDefault(f=>f.Name.toLowerCase()==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase());if(null==n)return this.DisplayMessage="Error Document @ row "+(a+1),void(this.MessageVisibility=!0);u+=" Document ='"+n+"'  "}break;case"Type":"numeric"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" Type ='0' ":u+=" Type ='1' ";break;case"Min":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Min ='"+g+"'  ");break;case"Max":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Max ='"+g+"'  ");break;case"Probable val":u+=" Probableval ='"+t[S][this.grData.Table[y].FieldName.toString().Trim()]+"'  ";break;case"Sample":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Sample ='"+g+"'  ");break;case"SampleType":"value"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='0'  ":"number"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='1'  ":"percentage value"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='2'  ":"percentage number"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()&&(u+=" SampleType ='3'  ");break;case"Observation":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Observation ='"+g+"'  ");break;case"Varience":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Varience ='"+g+"'  ");break;case"ProductCode":0==S&&(l=t[S][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode&&h.push(l.toUpperCase()));break;case"ProductName":0==S&&(i=t[S][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode||h.push(i.toUpperCase()))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let p,d,T=[];T.push(u.toString()),T.push(i),T.push(l),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyIndex),d=I.d.document.ImportQCProducts(T),d<=0&&(s++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:p})),u="",this.ImportedCount="Imported :"+(a+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ReturnMultipleAddress(e,s,l){let i=null,u=null,h=null,t="";for(let o=0;o<e.length;o++){let r;if(i="",u="",h="",r=this.grData.Table.filter(l?m=>"26707"==m.FeatureFieldName:m=>"24321"==m.FeatureFieldName),!l&&r.length>0&&""!=e[o][r[0][0].toString()]&&"Primary"==e[o][r[0][0].toString()]?t+='<Rows Action="NEW"':t+='<Row Action="NEW"',r.length>0)try{t+=l?' AddressTypeID="'+e[o][r[0][0].toString()]!=""&&"Address"==e[o][r[0][0].toString()]?"1":""!=e[o][r[0][0].toString()]&&"Billing"==e[o][r[0][0].toString()]?"2":""!=e[o][r[0][0].toString()]&&"Shipping"==e[o][r[0][0].toString()]?"3":'0"':' AddressTypeID="'+e[o][r[0][0].toString()]!=""&&"Primary"==e[o][r[0][0].toString()]?"1":""!=e[o][r[0][0].toString()]&&"Secondary"==e[o][r[0][0].toString()]?"2":'0"'}catch(m){Logger.ErrorLog("ReturnMultipleAddress, Error Message :"+m.Message)}else t+=' AddressTypeID="2"';for(let m=0;m<this.grData.Table.length;m++)null==this.grData.Table[m].FeatureFieldName||""==this.grData.Table[m].FeatureFieldName.toString()||(s.filter(c=>c.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),26707!=parseInt(this.grData.Table[m].FeatureFieldName)&&24321!=parseInt(this.grData.Table[m].FeatureFieldName)&&s.length>0&&(null!=this.lstAddressFields&&this.lstAddressFields.filter(c=>c==parseInt(this.grData.Table[m].FeatureFieldName)).length>0||null!=this.lstContactFields&&this.lstContactFields.filter(c=>c==parseInt(this.grData.Table[m].FeatureFieldName)).length>0)&&(s[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=s[0].SysColumnName.toString().replace("Contact_","")+"=N'"+k.Dw.GetValidXml(e[o][this.grData.Table[m].FieldName.toString().Trim()])+"',":this.lstAddressFields.length>0&&s[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")||this.lstContactFields.length>0&&s[0].SysColumnName.toString().toUpperCase().startsWith("CONTACT_CCNID")?h+=s[0].SysColumnName.toString().replace("Contact_","")+"='"+e[o][this.grData.Table[m].FieldName.toString()+"_Key"].toString()+"',":i+=s[0].SysColumnName.toString().replace("Contact_","")+"=N'"+k.Dw.GetValidXml(e[o][this.grData.Table[m].FieldName.toString()])+"',"));t+=' StaticFields ="'+i.toString().Trim(",")+'" ',t+=' ExtraTextFields ="'+u.toString().Trim(",")+'" ',t+=' CCFields ="'+h.toString().Trim(",")+'" ',t+="/>"}return t.length>0&&(t.Insert(0,"<Data>"),t+="</Data>"),t.toString()}ValidateBudgetRow(e,s,l){this.DisplayMessage="";let i=null;if(s<=0)for(var u of(i=new Dt.zd(0,""),i.amount=l,this.ccdv))null!=(h=this.Feature.Items.filter(o=>o.Value==u.Key.toString()))&&e.includes(h.Name+"_Key")&&(e[h.Name+"_Key"].toString().length>0?i.addDimValue(e[h.Name+"_Key"].toString()):i.addDimValue("1"));else for(var u of(i=new Dt.zd,i.rowID=s,i.amount=l,this.ccdv)){var h;null!=(h=this.Feature.Items.filter(m=>m.Value==u.Key.toString()))&&e.includes(h.Name+"_Key")&&(e[h.Name+"_Key"].toString().length>0?i.addDimValue(e[h.Name+"_Key"].toString()):i.addDimValue(""))}if(this.budgetInput=[],this.budgetInput.push(this.inpRow),this.budgetInput=[],this.myBudget=new Dt.__(this.budgetTable,this.ccdv.length),this.DataCollection.Budgetid>0&&(s=this.myBudget.getDimensionRowId(s,this.inpRow)),s<=0){let o=[],r=this.myBudget.checkAddBudgetConflicts(this.inpRow,o,"");if(0!=r)return this.DisplayMessage="",this.inpRow.linkedDimRows="",this.inpRow.tempLinkedDimRows=0,this.DisplayMessage;{let m;if(this.budgetTable.length>0&&(m=this.budgetTable[this.budgetTable.length-1].RowID+1),r=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,o,m),0==r){this.myBudget.getTransactionLogSummary(o,this.strTransLog);let n=new Dt.zd(this.inpRow);n.rowID=m,this.budgetTable.push(n)}}}else{if(this.myBudget.checkEditBudgetConflicts(this.inpRow,"")>0)return this.DisplayMessage="",this.DisplayMessage;i=null,0==this.getDimensionRow(this.inpRow.rowID,i)&&this.assignDimRowValues(this.inpRow,i)}return this.DisplayMessage}getDimensionRow(e,s){for(let i=0;i<this.budgetTable.length;i++)if(this.budgetTable[i].rowID==e)return 0;return 1}assignDimRowValues(e,s){s.rowID=e.rowID,s.amount=e.amount,s.budgetUsed=e.budgetUsed,s.linkedDimRows=e.linkedDimRows,s.nAnys=e.nAnys,s.nAnysComputed=e.nAnysComputed,s.tempLinkedDimRows=e.tempLinkedDimRows,s.row.Clear();for(let l=0;l<e.row.length;l++)s.row.push(e.row[l])}ImportBudget(){let e=this.costCenterTableZero;this.DataCollection=new Vt.t;for(let p=0;p<this.ExcelTable.length;p++)for(let T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(e.filter(d=>d.CostCenterColID==d[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)this.CheckCostCenterField(p,parseInt(e[0].ColumnCostCenterID.toString()),T.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){if("TOWER NAME"!=T.FieldName.toString().Trim().toUpperCase()&&"UNIT TYPE"!=T.FieldName.toString().Trim().toUpperCase()&&null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!N.J0.Int(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0);let s=0;this.FillCostCenterFields(!1),this.DataCollection.CCList="",this.DataCollection.RelationsXML="";let u,l="",i=this.grData.Table.filter(p=>"23207"==p.FeatureFieldName);if(!(i.length>0))return void(this.DisplayMessage="Profile Name Not Selected");l=i[0].FieldName.toString(),u=this.toTableDistinct(this.ExcelTable,l);let h="",t=0,o="",r=[];r=this.ExcelTable;let m="",c=I.d.document.GetDataSet(" SELECT distinct(BudgetDefID),BudgetName FROM COM_BudgetDef WITH(NOLOCK) \n            SELECT DISTINCT BudgetDefID,CostCenterID,CCCodeTypeID FROM COM_BudgetDefDims WITH(NOLOCK) "),n=c.Tables[0],a=0;for(let p=0;p<u.length;p++){if(m=u[p][l].toString().Trim(),0==m.length||(r.filter(f=>f.strBudgetNameField==m),0==r.length))continue;this.DataCollection.BudgetName=m,n.filter(f=>f.BudgetName==m),this.DataCollection.Budgetid=n.length>0?parseInt(n[0].BudgetDefID):0;let T=[],d=1,S=1,F=0,y="";for(let f=0;f<r.length;f++){d=1,S=1,y="",F=0,o+='<Row Budget="0" ',o+=' Sno="'+f+'1" ';let b="",w=[];for(let P=0;P<this.grData.Table.length;P++)if(null!=this.grData.Table[P].FeatureFieldName&&""!=this.grData.Table[P].FeatureFieldName.toString()&&(e.filter(U=>U.CostCenterColID==this.grData.Table[P].FeatureFieldName.toString()),e.length>0))switch(h="",e[0].SysColumnName.toString()){case"AnnualAmount":h=r[f][this.grData.Table[P].FieldName.toString().Trim()],""!=h&&(t=parseFloat(h));break;case"Rate":h=r[f][this.grData.Table[P].FieldName.toString().Trim()],""!=h&&(F=parseFloat(h));break;case"BudgetCode":case"BudgetName":0==f&&(h=r[f][this.grData.Table[P].FieldName.toString().Trim()],w.push(se._p.ComboBoxItems_1(h)));break;case"FinYearStartDate":0==f&&(h=r[f][this.grData.Table[P].FieldName.toString().Trim()],this.DataCollection.StartYear=new Date(h));break;case"BudgetType":if(0==f){switch(h=r[f][this.grData.Table[P].FieldName.toString().Trim()],h.toUpperCase().split(" ")[0]){case"ANNAUL":this.BudgetType=0;break;case"HALFYEARLY":this.BudgetType=1;break;case"MONTHLY":this.BudgetType=3;break;case"QUATERLY":this.BudgetType=2}this.DataCollection.BudgetTypeID=this.BudgetType,this.DataCollection.BudgetType=h}break;case"CarryForward":y=r[f][this.grData.Table[P].FieldName.toString().Trim()],"monthly"==y.toLowerCase()?y="M":"half yearly"==y.toLowerCase()?y="H":"quarterly"==y.toLowerCase()?y="Q":"yearly"==y.toLowerCase()&&(y="Y");break;case"Currency":d=parseInt(r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString().Trim()),S=parseFloat(r[f].ExchangeRate.toString().Trim());break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&("2"==e[0].ColumnCostCenterID.toString()?(b+="AccountID ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"' ",o+="AccountID ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"'  "):"3"==e[0].ColumnCostCenterID.toString()?(b+="ProductID ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"' ",o+="ProductID ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"'  "):(b+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"' ",o+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+r[f][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"'  "))}if(T.Contains(b))return void(this.DisplayMessage="Duplicate Dimensions At Row No : "+(this.ExcelTable.indexOf(r[f].Row)+1));if(T.push(b),0==this.DataCollection.BudgetTypeID)o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+d+'" ',o+=' ExchangeRate="'+S+'" ';else if(1==this.DataCollection.BudgetTypeID){t=0;for(let P=0;P<this.grData.Table.length;P++)null==this.grData.Table[P].FeatureFieldName||""==this.grData.Table[P].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[P].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("YEARH")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[P].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[P].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[P].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+d+'" ',o+=' ExchangeRate="'+S+'" '}else if(2==this.DataCollection.BudgetTypeID){t=0;for(let P=0;P<this.grData.Table.length;P++)null==this.grData.Table[P].FeatureFieldName||""==this.grData.Table[P].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[P].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("QTR")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[P].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[P].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[P].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+d+'" ',o+=' ExchangeRate="'+S+'" '}else if(3==this.DataCollection.BudgetTypeID){t=0;for(let P=0;P<this.grData.Table.length;P++)null==this.grData.Table[P].FeatureFieldName||""==this.grData.Table[P].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[P].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("MONTH")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[P].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[P].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[P].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+d+'" ',o+=' ExchangeRate="'+S+'" '}if(o+="></Row>",!this.IsUpdate&&this.DataCollection.Budgetid>0)return this.DisplayMessage="Duplicate Budget Name ="+this.DataCollection.BudgetName,void(this.MessageVisibility=!0);if(this.DisplayMessage=this.ValidateBudgetRow(r[f].Row,0,t),null==this.DisplayMessage&&(this.DisplayMessage=""),this.DisplayMessage.length>0)return void(this.MessageVisibility=!0)}if(this.DataCollection.Status=1,o.Insert(0,"<XML>"),o+="</XML>",this.DataCollection.SbXML=o.toString(),null!=this.ccdv)for(var g of this.ccdv){this.DataCollection.NumDimensions++;let f=c.Tables[1].Select("CostCenterID="+g.Key+" and BudgetDefID="+this.DataCollection.Budgetid);this.DataCollection.CCList+='<Row CC="'+g.Key+'" CCCodeTypeID="'+(null!=f&&f.length>0&&!N.J0.IsEmpty(f[0].CCCodeTypeID.toString())?f[0].CCCodeTypeID.toString():"0")+'"/>'}this.DataCollection.CCList.length>0&&(this.DataCollection.CCList="<XML>"+this.DataCollection.CCList+"</XML>"),this.DataCollection.RelationsXML=o.toString(),this.DataCollection.SelectedNodeID=1;let C=0;this.DataCollection.IsAppend=this.AppendData,this.DisplayMessage=this.DataCollection.SetImportBudget(),C<=0&&(s++,this.FailedRecourdList.push({Name:" Budget  Name : "+m,Message:this.DisplayMessage})),o="",a+=r.length,this.ImportedCount="Imported :"+(p+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+"(Rows), "+u.length+"(Profiles) "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}static ReturnAnnaulAmount(e,s){}ImportAccountContacts(){let e=this.costCenterTableZero;for(let r=0;r<this.ExcelTable.length;r++)for(let m of this.grData.Table)if(null!=m[1]&&""!=m[1].toString()&&"0"!=m[1].toString()&&(e.filter(c=>c.CostCenterColID==c[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(r,parseInt(e[0].ColumnCCListViewTypeID.toString()),m.FieldName.toString()):this.CheckCostCenterField(r,parseInt(e[0].ColumnCostCenterID.toString()),m.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){if(null!=this.ExcelTable[r][m.FieldName.toString()]&&""!=this.ExcelTable[r][m.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[r][m.FieldName.toString().Trim()]))return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[r][m.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let c;if(c=null!=this.ExcelTable[r][m.FieldName.toString()]&&""!=this.ExcelTable[r][m.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[r][m.FieldName.toString().Trim()]),c)return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[r][m.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[r][m.FieldName.toString().Trim()]))return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[r][m.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0);let s=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let l="",i="",u="",h="",t=0,o=2;for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){l="",i="",u="",t=0,o=2,h="";for(let c=0;c<this.grData.Table.length;c++)if(null!=this.grData.Table[c].FeatureFieldName&&""!=this.grData.Table[c].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[c].FeatureFieldName.toString()),e.length>0)){let n=e[0].SysColumnName.toString();switch(n){case"ContactTypeID":case"AddressTypeID":o="primary"==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()].toLowerCase()?1:2;break;case"FeaturePK":null!=this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"]&&""!=this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()&&(t=parseInt(this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString().Trim()));break;case"Status":"in active"==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()].toLowerCase()?i+=n+" =404, ":i+=n+" =403, ";break;case"FirstName":h=k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()]),i+=n+" =N'"+h+"', ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":i+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?l+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":i+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()]?i+=n+" ='0', ":i+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()])+"', "}}let m;if(t>0){let c=[];c.push(parseInt(this.Feature.SelectedValue)),c.push(t),c.push(o),c.push(i),c.push(u),c.push(l),c.push(I.d.SessionManager.UserName),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.RoleID),c.push(I.d.SessionManager.LanguageID),m=I.d.document.SetImportContracts(c),m<=0&&(s++,this.FailedRecourdList.push({Name:"Name : "+h,Message:m}))}else s++,this.FailedRecourdList.push({Name:"Name : "+h,Message:"Account not found"});this.ImportedCount="Imported :"+(r+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountAddress(){let e=this.costCenterTableZero,s="",l="";for(let n=0;n<this.ExcelTable.length;n++)for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(e.filter(g=>g.CostCenterColID==g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),a.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),a.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){let g;if(g=null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]),g)return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}let i=0,u=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let h="",t="",o="",r="",m=0,c=1;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++){h="",t="",o="",m=0,c=1,r="";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),e.length>0)){let d=e[0].SysColumnName.toString();switch(d){case"AddressTypeID":c="address"==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()?1:"billing"==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()?2:3;break;case"AccountCode":null!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(s=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]);break;case"AccountName":null!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(l=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]);break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?o+=d+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":t+=d+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?h+=d+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":t+=d+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?o+=d+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]?t+=d+" ='0', ":t+=d+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()])+"', "}}let a,g=[];g.push(parseInt(s)),g.push(l),g.push(c),g.push(t),g.push(o),g.push(h),g.push(this.IsCode),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.RoleID),g.push(I.d.SessionManager.LanguageID),a=I.d.document.SetImportAddress(g),a<=0?(i++,this.FailedRecourdList.push({Name:"Name : "+r,Message:a}),this.ExcelTable[n].xIMP_STATUSx="FAIL",this.ExcelTable[n].IMPORT_MESSAGE=a):(u++,this.FailedRecourdList.push({Name:"Name : "+r,Message:a}),this.ExcelTable[n].xIMP_STATUSx="PASS",this.ExcelTable[n].IMPORT_MESSAGE=a),this.ImportedCount="Imported :"+u.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportDimensionMove(){let e;if(e=this.grData.Table.filter(n=>"-1"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Grop Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-2"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Node Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-3"==n.FeatureFieldName||"-4"==n.FeatureFieldName),!(e.length>0))return this.DisplayMessage="Dimension Field Not Found",void(this.MessageVisibility=!0);let l,i,u,h,t,o,r,s=0,m=new Ht.d,c=this.costCenterTableZero;for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&"-4"!=this.grData.Table[n].FeatureFieldName.toString()&&(this.ExcelTable.includes(this.grData.Table[n].FieldName.toString()+"_Key")||this.ExcelTable.push(this.grData.Table[n].FieldName.toString()+"_Key"),"-3"==this.grData.Table[n].FeatureFieldName.toString()&&this.grData.Table.filter(a=>"-4"==a.FeatureFieldName).length>0))for(let a=0;a<this.ExcelTable.length;a++)this.ExcelTable[a][this.grData.Table[n].FieldName.toString()+"_Key"]=this.ExcelTable[a][this.grData.Table.filter(g=>"-4"==g.FeatureFieldName)[0].FieldName.toString()];for(let n=0;n<this.ExcelTable.length;n++){l=i=u=h=0,r=o=t="";for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&(c.filter(g=>g.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),c.length>0))switch(t=c[0].SysColumnName.toString(),t){case"DimensionID":l=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()]);break;case"DimensionName":""==this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString()&&this.CheckCostCenterField(n,5,this.grData.Table[a].FieldName.toString(),!1,this.IsCode),l=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString());break;case"Node":this.CheckCostCenterField(n,parseInt(l),this.grData.Table[a].FieldName.toString(),!1,this.IsCode),r=this.ExcelTable[n][this.grData.Table[a].FieldName.toString().Trim()],i=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString());break;case"Group":this.CheckCostCenterField(n,parseInt(l),this.grData.Table[a].FieldName.toString(),!1,this.IsCode),o=this.ExcelTable[n][this.grData.Table[a].FieldName.toString()],u=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString())}t=m.MoveCostCenter(l,i.toString(),u,0),s++,this.FailedRecourdList.push({Name:"Node : "+r+" ; Group : "+o,Message:t}),this.ImportedCount="Imported :"+(n+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLeadsWithProduct(){let e=this.costCenterTableZero,s=0,l="",i="",u="",h="",t="",o="",r="",m=[];if(!this.ExcelTable.includes("Company")&&!this.ExcelTable.includes("LeadCode"))return this.DisplayMessage="Company/LeadCode should present in excel",void(this.MessageVisibility=!0);for(let p=0;p<this.ExcelTable.length;p++)for(const T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(e.filter(d=>d.CostCenterColID===d[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(p,parseInt(e[0].ColumnCCListViewTypeID.toString()),T.FieldName.toString()):this.CheckCostCenterField(p,parseInt(e[0].ColumnCostCenterID.toString()),T.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let d;if("25623"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&(d=null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]),d))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]),d)return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=!N.J0.isValidDate(this.ExcelTable[p][T.FieldName.toString().Trim()]),d)return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}this.FillCostCenterFields(!1),this.FillLookupFields();let n,c="";this.CCNodeDet=[];let a="",g=[];g=this.ExcelTable,t="",m=[];for(let p=0;p<this.ExcelTable.length;p++,this.ProgressValue++)if(this.IsCode?this.ExcelTable.includes("LeadCode")&&""!=this.ExcelTable[p].LeadCode.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[p].LeadCode.toString().Trim()),g.filter(T=>T.LeadCode==t)):this.ExcelTable.includes("Company")&&""!=this.ExcelTable[p].Company.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[p].Company.toString().Trim()),g.filter(T=>T.Company==t)),0==m.filter(T=>T.Name.toUpperCase()==t.toUpperCase()).length){let T="",d="",S="",F="";F+="<XML>",o+="<Row ";for(let b=0;b<this.grData.Table.length;b++)if(null!=this.grData.Table[b].FeatureFieldName&&""!=this.grData.Table[b].FeatureFieldName.toString()&&(e.filter(w=>w.CostCenterColID==this.grData.Table[b].FeatureFieldName.toString()&&"CRM_ProductMapping"!==w.CostCenterColID),c="",e.length>0))switch(c=e[0].SysColumnName.toString(),c){case"Code":l=this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()];break;case"Company":i=this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":o+=c+'="'+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":n=N.J0.isValidDate(this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]),n&&(o+=c+'="'+n.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":o+=c+'="'+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="0" ':"existing"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="1" ':"account"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="2" ':"customer"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()&&(o+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":d+=c+"='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;case"Email1":d+="Email='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":S+=c+"='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?c.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?T+=c+" ='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":h+=c+" ='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]?h+=c+" ='0', ":h+=c+" =N'"+k.Dw.GetValidXml(this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()])+"', "}o+=" ></Row>",F+="</XML>",r+="<XML><Row ",""!=h&&(r+=' ExtraFields ="'+h.Trim(",")+'" '),""!=S&&(r+=' TabDetails ="'+S.Trim(",")+'" '),""!=T&&(r+=' CostCenterFields ="'+T+'" '),""!=d&&(r+='ContactFields ="'+d.Trim(",")+'" '),r+=" ></Row></XML>",o.replace("&","&amp;");for(let b=0;b<g.length;b++){u="",a+="<Row ",a+=' Sno="'+b+'1" ';for(let w=0;w<this.grData.Table.length;w++)if(null!=this.grData.Table[w].FeatureFieldName&&""!=this.grData.Table[w].FeatureFieldName.toString()&&(e.filter(R=>R.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()&&"CRM_ProductMapping"!==R.CostCenterColID),e.length>0))switch(c=e[0].SysColumnName.toString(),c){case"ProductID":a+=" Product ='"+g[b][this.grData.Table[w].FieldName.toString()]+"'  ";break;case"CRMProduct":a+=" CRMProduct ='"+g[b][this.grData.Table[w].FieldName.toString()]+"'  ";break;case"Description":a+=" Description ='"+g[b][this.grData.Table[w].FieldName.toString()]+"'  ";break;case"Quantity":a+=" Quantity ='"+g[b][this.grData.Table[w].FieldName.toString()]+"'  ";break;case"Code":0==b&&(l=g[b][this.grData.Table[w].FieldName.toString().Trim()],this.IsCode&&m.push(se._p.ComboBoxItems_1(l)));break;case"Company":0==b&&(i=g[b][this.grData.Table[w].FieldName.toString().Trim()],this.IsCode||m.push(se._p.ComboBoxItems_1(i)));break;default:this.ExcelTable.includes(this.grData.Table[w].FieldName.toString()+"_Key")?u+=e[0].SysColumnName.toString()+" =N'"+g[b][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==g[b][this.grData.Table[w].FieldName.toString().Trim()]?u+=e[0].SysColumnName.toString()+" ='0', ":u+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(g[b][this.grData.Table[w].FieldName.toString().Trim()])+"', "}""!=u&&(a+=' ExtraFields ="'+u.Trim(",")+'" '),a+="></Row>",u="",b>0&&p++}a.Insert(0,"<XML>"),a+="</XML>";let y,f,C=[];C.push(a.toString()),C.push(i),C.push(this.IsCode),C.push(o.toString()),C.push(r.toString()),C.push(this.IsDuplicateNameAllowed),C.push(this.IsAutoCodeGen),C.push(this.IsUpdate),C.push(I.d.SessionManager.CompanyIndex),C.push(I.d.SessionManager.UserName),C.push(I.d.SessionManager.UserID),C.push(I.d.SessionManager.RoleID),C.push(I.d.SessionManager.LanguageID),f=I.d.document.SetImportDataToLeadProducts(C),f<=0&&(s++,this.FailedRecourdList.push({Name:" Company Name : "+t,Message:y})),a="",o="",r="",u="",h="",S="",T="",d="",this.ImportedCount="Imported :"+(p+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLeads(){let e=this.costCenterTableZero;for(let o=0;o<this.ExcelTable.length;o++)for(let r of this.grData.Table)if(null!=r[1]&&""!=r[1].toString()&&"0"!=r[1].toString()&&(e.filter(m=>m.CostCenterColID===m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(o,parseInt(e[0].ColumnCCListViewTypeID.toString()),r.FieldName.toString()):this.CheckCostCenterField(o,parseInt(e[0].ColumnCostCenterID.toString()),r.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let m;if("25623"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&(m=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),m))return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),m)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=!N.J0.isValidDate(this.ExcelTable[o][r.FieldName.toString().Trim()]),m)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}let s=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,l="",i="",u="",h="";this.CCNodeDet=[];for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){let r="",m="",c="",n="",a="";a+="<XML>",h+="<Row ";for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),l="",e.length>0))switch(l=e[0].SysColumnName.toString(),l){case"Code":i=this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()];break;case"Company":u=this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":h+=l+'="'+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":t=N.J0.isValidDate(this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]),t&&(h+=l+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":h+=l+'="'+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="0" ':"existing"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="1" ':"account"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="2" ':"customer"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()&&(h+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":c+=l+"='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Email1":c+="Email='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":n+=l+"='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?l.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?r+=l+" ='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":m+=l+" ='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]?m+=l+" ='0', ":m+=l+" =N'"+k.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()])+"', "}h+=" ></Row>",a+="</XML>";let g="";g+="<XML><Row ",""!=m&&(g+=' ExtraFields ="'+m.Trim(",")+'" '),""!=n&&(g+=' TabDetails ="'+n.Trim(",")+'" '),""!=r&&(g+=' CostCenterFields ="'+r+'" '),""!=c&&(g+='ContactFields ="'+c.Trim(",")+'" '),g+=" ></Row></XML>",h.replace("&","&amp;");let p,T=[];T.push(h.toString()),T.push(g.toString()),T.push(parseInt(this.Feature.SelectedValue)),T.push(i),T.push(u),T.push(this.IsUpdate),T.push(this.IsCode),T.push(this.IsUpdate),T.push(I.d.SessionManager.CompanyIndex),T.push(I.d.SessionManager.UserName),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.RoleID),T.push(I.d.SessionManager.LanguageID),p=I.d.document.SetImportDataToCRM(T),p<=0&&(s++,this.FailedRecourdList.push({Name:"Code : "+i+" ; Name : "+u,Message:p})),h="",this.ImportedCount="Imported :"+(o+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCases(){let e=this.costCenterTableZero;for(let o=0;o<this.ExcelTable.length;o++)for(let r of this.grData.Table)if(null!=r[1]&&""!=r[1].toString()&&"0"!=r[1].toString()&&(e.filter(m=>m.CostCenterColID===m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(o,parseInt(e[0].ColumnCCListViewTypeID.toString()),r.FieldName.toString()):this.CheckCostCenterField(o,parseInt(e[0].ColumnCostCenterID.toString()),r.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let m;if("24238"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&(m=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),m))return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),m)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=!N.J0.isValidDate(this.ExcelTable[o][r.FieldName.toString().Trim()]),m)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}let s=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,l="",i="",u="",h="";this.CCNodeDet=[];for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){let r="",m="";h+="<Row ";for(let p=0;p<this.grData.Table.length;p++)if(null!=this.grData.Table[p].FeatureFieldName&&""!=this.grData.Table[p].FeatureFieldName.toString()&&"-200"!=this.grData.Table[p].FeatureFieldName.toString()&&(e.filter(T=>T.CostCenterColID===this.grData.Table[p].FeatureFieldName.toString()),l="",e.length>0))switch(l=e[0].SysColumnName.toString(),l){case"CaseNumber":i=this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()];break;case"CustomerID":u=this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()];break;case"CreatedBy":case"Subject":case"AssignedTo":case"ParentID":case"IsGroup":h+=l+'="'+this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]+'" ';break;case"CreatedDate":case"CreateDate":case"CloseDate":case"AssignedDate":t=N.J0.isValidDate(this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]),t&&(h+=l+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"CasePriorityLookupID":case"CaseOriginLookupID":case"CaseTypeLookupID":case"ServiceLvlLookupID":case"StatusID":case"BillingMethod":h+=l+'="'+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"account"==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()].toLowerCase()?h+=l+'="1" ':"customer"==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()].toLowerCase()&&(h+=l+'="2" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?l.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?r+=l+" ='"+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString()+"', ":m+=l+" ='"+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]?m+=l+" ='0', ":m+=l+" =N'"+k.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()])+"', "}h+=" ></Row>";let c="";c+="<XML><Row ",""!=m&&(c+=' ExtraFields ="'+m.Trim(",")+'" '),""!=r&&(c+=' CostCenterFields ="'+r+'" '),c+=" ></Row></XML>",h.replace("&","&amp;");let n,a=[];a.push(h.toString()),a.push(c.toString()),a.push(parseInt(this.Feature.SelectedValue)),a.push(i),a.push(u),a.push(this.IsUpdate),a.push(this.IsCode),a.push(this.IsUpdate),a.push(I.d.SessionManager.CompanyIndex),a.push(I.d.SessionManager.UserName),a.push(I.d.SessionManager.UserID),a.push(I.d.SessionManager.RoleID),a.push(I.d.SessionManager.LanguageID),n=I.d.document.SetImportDataToCRM(a),n<=0&&(s++,this.FailedRecourdList.push({Name:"Code : "+i+" ; Name : "+u,Message:n})),h="",this.ImportedCount="Imported :"+(o+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportFollowUps(){let e=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++)for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(e.filter(g=>g.CostCenterColID===g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),a.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),a.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let g;if(g=null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]),g)return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]))return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[n][a.FieldName.toString().Trim()]))return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0);let s=0,l=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,i="",u="",h="",o=[],r="",m="",c=this.grData.Table;if(e.filter(n=>"-1"===n.FeatureFieldName),c.length>0&&(m=c[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(""==m)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);c=this.ExcelTable;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(""!=this.ExcelTable[n][m].toString()&&(r=this.ExcelTable[n][m].toString(),c.filter(a=>a.strPCodeColumn===r)),!o.Contains(r.toUpperCase())){for(let T=0;T<c.length;T++){h+="<Row ";for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID===this.grData.Table[d].FeatureFieldName.toString()),e.length>0))switch(i=e[0].SysColumnName.toString(),i){case"Code":u=c[T][this.grData.Table[d].FieldName.toString().Trim()],o.push(u.toUpperCase());break;case"Feedback":h+=i+' ="'+k.Dw.GetValidXml(c[T][this.grData.Table[d].FieldName.toString().Trim()]).replace("\n","~")+'" ';break;case"Date":t=N.J0.isValidDate(c[T][this.grData.Table[d].FieldName.toString().Trim()]),t&&(h+=i+'="'+t.toString("dd/MMM/yyyy hh:mm:ss tt")+'" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?h+=i+' ="'+c[T][this.grData.Table[d].FieldName.toString()+"_Key"].toString()+'" ':h+=i+' ="'+k.Dw.GetValidXml(c[T][this.grData.Table[d].FieldName.toString().Trim()])+'" '}h+="></Row>"}let a,g=[];g.push(h.toString()),g.push(""),g.push(parseInt(this.Feature.SelectedValue)),g.push(u),g.push(this.QtyCombo.SelectedValue),g.push(this.IsUpdate),g.push(this.IsCode),g.push(this.IsUpdate),g.push(I.d.SessionManager.CompanyIndex),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.RoleID),g.push(I.d.SessionManager.LanguageID),a=I.d.document.SetImportDataToCRM(g),a<=0?(s++,this.FailedRecourdList.push({Name:" Code : "+r,Message:a})):l++,h="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCRMCustomers(e){let s=this.costCenterTableZero;if(!this.ExcelTable.includes("CustomerName")&&!this.ExcelTable.includes("CustomerCode"))return this.DisplayMessage="CustomerName/CustomerCode should present in excel",void(this.MessageVisibility=!0);if(!this.ScanCostCenterFields(!1))return;let l=0,i="",u=[],h=[];h=this.ExcelTable;let t="",o=null,r=[],m=[],c=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(c=new N.VB,c.LoadXml(this.CodeDef[0].PrefixContent.toString())),i+="<XML>";for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(null!=c&&(o=this.GetCodeData(this.ExcelTable[n],0)),this.IsCode?this.ExcelTable.includes("CustomerCode")&&""!=this.ExcelTable[n].CustomerCode.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[n].CustomerCode.toString().Trim()),h.filter(a=>a.CustomerCode===t)):this.ExcelTable.includes("CustomerName")&&""!=this.ExcelTable[n].CustomerName.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[n].CustomerName.toString().Trim()),h.filter(a=>a.CustomerName===t)),0==u.filter(a=>a.Name.toUpperCase()==t.toUpperCase()).length){r.length=0;let le,a=!1,g=!1,p=!1,T=!1,d=!1,S=!1,F=!1,y=!1,C=!1,f="",b="",w="",R="",P="",U="",x="",G="",ee="",$=0,j=0,W="";m.length=0,i+="<Row ";for(let V=0;V<this.grData.Table.length;V++)if(null!=this.grData.Table[V].FeatureFieldName&&""!=this.grData.Table[V].FeatureFieldName.toString()&&(s.filter(K=>K.CostCenterColID==this.grData.Table[V].FeatureFieldName.toString()&&K.SysTableName!=K.Com_Contacts&&K.usercolumnname!=K.Contact_),s.length>0)){let K=s[0].SysColumnName.toString();switch(K){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][1].length>0&&(i+='StatusID ="'+this.CostCenterFieldsAllTables[1][1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(i+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":i+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(i+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":S=!0,this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][3].length>0?i+='ValuationID ="'+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+'" ':S=!1;break;case"UOMID":d=!0,U+="UOMID ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":i+='PurchaseAccount ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ',g=!0;break;case"SalesAccountID":case"SalesAccount":a=!0,i+='SalesAccount ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":y=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?U+=s[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?U+=s[0].SysColumnName.toString()+" ='2', ":U+=s[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":F=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?U+=s[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?U+=s[0].SysColumnName.toString()+" ='2', ":U+=s[0].SysColumnName.toString()+" ='0', ";break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":i+=s[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].Contains("-")){let Ie=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].split("-");$=Ie.length>0&&N.J0.Int(Ie[0]),$?$=parseInt(Ie[0]):($=0,j=Ie.length>1&&N.J0.Int(Ie[1])),j=j?parseInt(Ie[1]):0}else $=N.J0.Int(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])?parseInt(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==o&&(i+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" '),this.IsCode&&u.push(se._p.ComboBoxItems_1(k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])));break;case"CodePrefix":case"CodeNumber":null==o&&(i+=K+'="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":i+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ',b=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()],this.IsCode||u.push(se._p.ComboBoxItems_1(b));break;case"ParentGroup":case"ParentGroupName":i+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+'" ';break;case"AccountId":case"CustomerId":"65"==this.Feature.SelectedValue.toString()&&("CustomerId"==s[0].SysColumnName.toString()?R+=" CCID='83'  CustomerName ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]+"'  ":"AccountId"==s[0].SysColumnName.toString()&&(R+=" CCID='2'   CustomerName ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]+"'  "));break;case"Group":case"isGroup":case"IsGroup":case"IsBillwise":C=!0,"true"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()?i+=s[0].SysColumnName.toString()+' ="1" ':i+=s[0].SysColumnName.toString()+' ="0" ';break;case"ParentID":"3"==this.Feature.SelectedValue&&("true"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toLowerCase()?i+='IsGroup="1" ':i+='IsGroup ="0" ');break;case"COGSAccountID":this.ExcelTable.includes(this.grData.Table[V].FieldName.toString()+"_Key")&&(U+=s[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"', "),p=!0;break;case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[V].FieldName.toString()+"_Key")&&(U+=s[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"', "),T=!0;break;case"Assigned_Locations":case"Assigned_Insurance":r+=this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString();break;case"Base_Name":m.push({BaseName:this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]});break;case"Base_Conversion":m.push({Conversion:this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]});break;case"Conversion_UnitName":m.push({UnitName:this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]});break;case"Conversion_UnitValue":m.push({ConversionUnit:this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]});break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[V].FieldName.toString()+"_Key")&&(G+="Product ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?""!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]||"M"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]||"2"==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])&&(G+=s[0].SysColumnName.toString()+" ='2'  "):G+=s[0].SysColumnName.toString()+" ='1'  ";break;case"ProductImage":if("3"==this.Feature.SelectedValue)try{this.grData.Table[V].FieldName.toString()}catch{P=""}break;case"SubstituteGroup":w+="GroupName ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()]+"'  ";break;default:null!=s[0].ColumnCostCenterID&&""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID.toString())>0?null!=s[0].IsColumnUserDefined&&""!=s[0].IsColumnUserDefined.toString()&&(0,B.yG0)(s[0].IsColumnUserDefined.toString())?""!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()?f+=s[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"', ":f+=s[0].SysColumnName.toString()+" ='1', ":U+=s[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[V].FieldName.toString()+"_Key"].toString()+"', ":null!=s[0].IsColumnUserDefined&&""!=s[0].IsColumnUserDefined.toString()&&(0,B.yG0)(s[0].IsColumnUserDefined.toString())?null!=s[0].SysColumnName&&s[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(W+=s[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+"', "):s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()]?U+=s[0].SysColumnName.toString()+" ='0', ":U+=s[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[V].FieldName.toString().Trim()])+"', "}}if(null!=o&&(i+='AccountCode="'+o.Code.toString()+'" ',i+='CodePrefix="'+o.Prefix.toString()+o.Suffix.toString()+'" ',i+='CodeNumber="'+o.Number.toString()+'"'),g||(3==parseInt(this.Feature.SelectedValue)?s.filter(V=>"SysColumnName"===V.SysColumnName):s.filter(V=>"PurchaseAccount"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" =N'"+s[0].UserDefaultValue.toString()+"', ")),a||(3==parseInt(this.Feature.SelectedValue)?s.filter(V=>"SalesAccountID"===V.SysColumnName):s.filter(V=>"SalesAccount"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" =N'"+s[0].UserDefaultValue.toString()+"', ")),!S&&this.CostCenterFieldsAllTables[1].length>6&&(this.CostCenterFieldsAllTables[1][6].RowFilter="Name='DefaultProductValuation'",this.CostCenterFieldsAllTables[1][6].length>0?(this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.CostCenterFieldsAllTables[1][6][0].Value.toString()+"'",3==parseInt(this.Feature.SelectedValue)&&s.filter(V=>"ValuationID"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" ='"+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+"', ")):(s.filter(V=>"ValuationID"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" ='"+s[0].UserDefaultValue.toString()+"', "))),p||(s.filter(V=>"COGSAccountID"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" ='"+s[0].UserDefaultValue.toString()+"', ")),T||(s.filter(V=>"ClosingStockAccountID"===V.SysColumnName),s.length>0&&(U+=s[0].SysColumnName.toString()+" ='"+s[0].UserDefaultValue.toString()+"', ")),d||(s.filter(V=>"UOMID"===V.SysColumnName),s.length>0?U+=s[0].SysColumnName.toString()+" ='"+s[0].UserDefaultValue.toString()+"', ":""!=this.Feature.SelectedValue&&null!=this.Feature.SelectedValue&&2!=parseInt(this.Feature.SelectedValue)&&65!=parseInt(this.Feature.SelectedValue)&&51!=parseInt(this.Feature.SelectedValue)&&(U+=" UOMID ='1', ")),!C){let V=!1;V=(0,B.yG0)(I.d.SessionManager.Preferences.On.toString()),i+=V?'IsBillwise ="1" ':' IsBillwise="0" '}if(!y&&"2"==this.Feature.SelectedValue&&(U+=" DrOptionID='0', "),!F&&"2"==this.Feature.SelectedValue&&(U+=" CrOptionID='0', "),""!=U&&(i+='ExtraFields ="'+U.substring(0,U.length-2)+'" '),null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name?ee="One-One":null!=this.Feature.SelectedItem&&"Product With Services(Many-One)"==this.Feature.SelectedItem.Name&&(ee="Many-One"),""!=ee&&(i+='LinkOption="'+ee+'"  '),""!=G&&(i+='LinkFields ="'+G.substring(0,G.length-2)+'" '),""!=w&&(i+='Substitutes ="'+w.substring(0,w.length-2)+'" '),""!=R&&(i+='CustomerName ="'+R.substring(0,R.length-2)+'" '),""!=P&&(i+='ProductImage ="'+P+'" '),""!=W&&(i+='ExtraUserDefinedFields ="'+W.substring(0,W.length-2)+'" '),""!=f&&(i+='CostCenterFields ="'+f.substring(0,f.length-2)+'" '),""!=x&&(i+='PrimaryContactQuery ="'+x.substring(0,x.length-2)+'" '),m.toString().length>0&&(m.toString().includes("Conversion=")||m.push({Conversion:"1",ProductWiseUOM:m.toString()})),""==b)continue;r.length>0&&r.Insert(0,"<XML>"),i+=" ></Row>",i+="</XML>";let de=[],E=this.ReturnMultipleAddress(h,s,e);de.push(i.toString()),de.push(r.toString()),de.push(E),de.push(parseInt(this.Feature.SelectedValue)),de.push(I.d.SessionManager.CompanyIndex),de.push(I.d.SessionManager.UserName),de.push(I.d.SessionManager.UserID),de.push(I.d.SessionManager.RoleID),de.push(I.d.SessionManager.LanguageID),le=I.d.document.SetImportCRMCustomerData(de),le>0&&(l++,this.FailedRecourdList.push({Name:b,Message:le})),i="",i+="<XML>",this.ImportedCount="Imported :"+(n+1-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}toTableDistinct(e,s){const l=new Set,i=[];for(const u of e){const h=u[s];l.has(h)||(l.add(h),i.push({[s]:h}))}return i}ImportUOM(){let e=this.GetBomFieldName("FeatureFieldName=-1");if(""==e)return this.DisplayMessage="Base Name Not Exists",void(this.MessageVisibility=!0);const s=this.GetBomFieldName("FeatureFieldName=-2");if(""==s)return this.DisplayMessage="Unit Name Not Exists",void(this.MessageVisibility=!0);const l=this.GetBomFieldName("FeatureFieldName=-3");if(""==s)return this.DisplayMessage="Conversion Not Exists",void(this.MessageVisibility=!0);let i=0,u=0,h=0;const t=this.CostCenterFieldsAllTables.Tables[1];let o=[];o=this.toTableDistinct(this.ExcelTable,e),o.includes(e)||o.push(e),o.includes("BaseID")||o.push("BaseID"),o.includes("UOMID")||o.push("UOMID"),o.includes("Conversion")||o.push("Conversion"),o.includes("UOMXML")||o.push("UOMXML");for(let g=0;g<o.length;g++)t.filter(p=>p.BaseName===o[e].toString().Trim().replace("'","''")),t.length>0?(o.BaseID=t[0].BaseID,o.UOMID=t[0].UOMID,o.Conversion=t[0].Conversion):o.BaseID=-100;this.ExcelTable.includes("UOMID")||this.ExcelTable.push("UOMID");for(let g=0;g<this.ExcelTable.length;g++)t.filter(p=>p.BaseName===this.ExcelTable[g][e].toString().Trim().replace("'","''")&&p.UnitName==this.ExcelTable[g][s].toString().Trim().replace("'","''")),t.length>0&&(this.ExcelTable[g].UOMID=t[0].UOMID);let m,c,r=this.ExcelTable;for(let g=0;g<o.length;g++)if(r.filter(p=>p.BaseName===o[e].toString()),r.length>0){c=1,m="",m+="<XML>",""!=o.BaseID.toString()&&"-100"!=o.BaseID.toString()&&(m+="<Row RowNo='1'",m+=" PrimaryKey='"+o.UOMID+"'",m+=" MapAction='UPDATE'",m+=" UName='"+o[e]+"'",m+=" ConversionRate='"+o.Conversion+"' />",c=2);for(let p=0;p<r.length;p++)m+="<Row RowNo='"+(p+c)+"'",""!=r[p].UOMID.toString()?(m+=" PrimaryKey='"+r[p].UOMID.toString()+"'",m+=" MapAction='UPDATE'"):(m+=" PrimaryKey='0'",m+=" MapAction='NEW'"),m+=" UName='"+r[p][s].toString()+"'",m+=" ConversionRate='"+r[p][l].toString()+"' />";m+="</XML>",o.UOMXML=m.toString(),m.Clear()}let n=null;for(let g=0;g<o.length;g++,this.ProgressValue++)n=[],n.push(o[e].toString()),n.push(o.BaseID.toString()),n.push(o.UOMXML.toString()),n.push(!1),n.push(I.d.SessionManager.CompanyGUID),n.push(I.d.SessionManager.UserName),n.push(I.d.SessionManager.RoleID),n.push(I.d.SessionManager.LanguageID),I.d.inventory.AddUOM(n,"AddUOM").subscribe(p=>{this.DisplayMessage=p.Message,h=p.RetValue,this.MessageVisibility=!0},p=>{alert(JSON.stringify(p))}),h<0?(u++,this.FailedRecourdList.push({Name:o[e].toString(),Message:this.ErrorMessage})):i++,this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+u.toString();let a=u+i;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+a.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportMultipleStageBoms(){if(!this.ScanCostCenterFields(!0))return;let e=this.GetBomFieldName("FeatureFieldName=555026");if(""==e)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);let s=0,l=0,i=1,u=1,h=1,t=0,o=51,r=0,m="",c="",n="",a="",g="",p=0,T=0,d=0,S="",F="",y="",C="",f=0;var b=new b,w=new b;const R=this.CostCenterFieldsAllTables.Tables[0];let P=this.ExcelTable;const U=this.grData.Table;let de,x=null,G="",ee="",$="",j="",W=this.ExcelTable,le=this.ExcelTable;for(let V=W.length-1;V>0;V--)U.length>0&&(le.includes(W[V].ColumnName+"_Key")&&le.Remove(W[V].ColumnName+"_Key"),le.Remove(W[V].ColumnName)),U.filter(K=>K.FeatureFieldName<"0"&&K.FeatureFieldName==W[V].ColumnName),U.length>0&&(le.includes(W[V].ColumnName+"_Key")&&W.Remove(W[V].ColumnName+"_Key"),W.Remove(W[V].ColumnName));for(let V=0;V<W.length;V++)de.push(W[V].ColumnName);W=this.toTableDistinct(P,de);for(let V=0;V<le.length;V++)de.push(le[V].ColumnName);le=this.toTableDistinct(P,de);const Ne=le;le.includes("StagesXML")||W.push("StagesXML"),le.includes("BOMProductXML")||W.push("BOMProductXML"),le.includes("BOMExpenseXML")||W.push("BOMExpenseXML"),le.includes("BOMResourceXML")||W.push("BOMResourceXML");for(let V=0;V<W.length;V++){if(Ne.filter(K=>K.BomName<W[V][e].toString().replace("'","''")),G+="<Stages>",Ne.length>0)for(let K=0;K<Ne.length;K++)m=this.GetFieldValue("FeatureFieldName=-11",Ne[K]),G+='<Stage ID="-'+m+'" ',G+='StageNodeID="'+this.GetFieldValue("FeatureFieldName=-10",Ne[K])+'" ',G+='Parent="1" ',G+='lft="'+m+'" ',G+='Depth="1" />';if(G+="</Stages>",W[V].StagesXML=G.toString(),G="",P.filter(K=>K.BomName<W[V][e].toString().replace("'","''")),P.length>0){ee+="<BOMProductXML>",$+="<BOMExpenseXML>",j+="<BOMResourceXML>";for(let K=0;K<P.length;K++)C=this.GetFieldValue("FeatureFieldName=-9",P[K]).toUpperCase(),"IP"==C||"OP"==C?(ee+="<Row ",ee+=" BOMProductID='0'",ee+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",P[K])+"'",ee+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",P[K])+"'",p=parseFloat(this.GetFieldValue("FeatureFieldName=-2",P[K])),ee+=" Quantity='"+p+"'",ee+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",P[K])+"'",T=parseFloat(this.GetFieldValue("FeatureFieldName=-4",P[K])),ee+=" UnitPrice='"+T+"'","IP"==C?(ee+=" ProductUse='1'",ee+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",P[K])+"'",m=this.GetFieldValue("FeatureFieldName=-7",P[K]).toUpperCase(),ee+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",P[K]).toUpperCase(),ee+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'"):"OP"==C&&(ee+=" ProductUse='2'"),d=parseFloat(this.GetFieldValue("FeatureFieldName=-5",P[K])),d>0||(d=p*T),ee+=" Value='"+d+"'/>"):"EXPENSES"==C?($+="<Row ",$+=" ExpenseID='0'",$+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",P[K])+"'",$+=" Name='"+this.GetFieldValue("FeatureFieldName=-12",P[K])+"'",$+=" ResourceID='1'",$+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-13",P[K])+"'",$+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-14",P[K])+"'",m=this.GetFieldValue("FeatureFieldName=-7",P[K]).toUpperCase(),$+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",P[K]).toUpperCase(),$+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'",$+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",P[K])+"'/>"):"MACHINES"==C&&(j+="<Row ",j+=" BOMResourceID='0'",j+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",P[K])+"'",j+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-15",P[K])+"'",j+=" Hours='"+this.GetFieldValue("FeatureFieldName=-16",P[K])+"'",j+=" Options='"+this.GetFieldValue("FeatureFieldName=-17",P[K])+"'",j+=" MachineDim1='"+this.GetFieldValue("FeatureFieldName=-18",P[K])+"'",j+=" MachineDim2='"+this.GetFieldValue("FeatureFieldName=-19",P[K])+"'",m=this.GetFieldValue("FeatureFieldName=-7",P[K]).toUpperCase(),j+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",P[K]).toUpperCase(),j+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'",j+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",P[K])+"'/>");ee+="</BOMProductXML>",W[V].BOMProductXML=ee.toString(),ee="",$+="</BOMExpenseXML>",W[V].BOMExpenseXML=$.toString(),$="",j+="</BOMResourceXML>",W[V].BOMResourceXML=j.toString(),j=""}}for(let V=0;V<W.length;V++,this.ProgressValue++){i=1,u=1,h=1,t=0,o=51,r=0,c="",n="",a="",g="",S="",F="",y="",b=new b;for(let K=0;K<this.grData.Table.length;K++)if(null!=this.grData.Table[K].FeatureFieldName&&""!=this.grData.Table[K].FeatureFieldName.toString()&&!this.grData.Table[K].FeatureFieldName.toString().startsWith("-")&&(P.filter(Ie=>Ie.CostCenterColID===this.grData.Table[K].FeatureFieldName.toString()),R.length>0))switch(R[0].SysColumnName.toString()){case"BOMCode":c=W[V][this.grData.Table[K].FieldName.toString()];break;case"BOMName":n=W[V][this.grData.Table[K].FieldName.toString()];break;case"Date":b=N.J0.isValidDate(W[V][this.grData.Table[K].FieldName.toString().Trim()]);break;case"ProductID":r=parseInt(W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Packing":y=W[V][this.grData.Table[K].FieldName.toString()];break;case"UOMID":t=parseInt(W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"FPQty":g=W[V][this.grData.Table[K].FieldName.toString()];break;case"LocationID":u=parseInt(W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"DivisionID":h=parseInt(W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Group":i=parseInt(W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Description":a=W[V][this.grData.Table[K].FieldName.toString()];break;case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+W[V][this.grData.Table[K].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(o=parseInt(this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()));break;default:null!=R[0].ColumnCostCenterID&&""!=R[0].ColumnCostCenterID.toString()&&parseInt(R[0].ColumnCostCenterID.toString())>0?44==parseInt(R[0].ColumnCostCenterID.toString())?R[0].SysColumnName.toString().Contains("Alpha")&&(S+=R[0].SysColumnName.toString()+" ='"+W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', "):R[0].SysColumnName.toString().Contains("Alpha")?S+=R[0].SysColumnName.toString()+" ='"+W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', ":null!=R[0].IsColumnUserDefined&&""!=R[0].IsColumnUserDefined.toString()&&(0,B.yG0)(R[0].IsColumnUserDefined.toString())&&(le.includes(this.grData.Table[K].FieldName.toString()+"_Key")&&""!=W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString()&&"0"!=W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString()?F+=R[0].SysColumnName.toString()+" ='"+W[V][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', ":F+=R[0].SysColumnName.toString()+" ='1', "):null!=R[0].SysColumnName&&R[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(R.Table.Columns.Contains("UserColumnType")&&R[0].UserColumnType.toString().toLowerCase().Contains("date")||R[0].ColumnDataType&&R[0].ColumnDataType.toString().toLowerCase().Contains("date")?(w=new b,(w=""==W[V][this.grData.Table[K].FieldName.toString().Trim()]||N.J0.isValidDate(W[V][this.grData.Table[K].FieldName.toString().Trim()]))&&(S+=R[0].SysColumnName.toString()+" ='"+w.Date.toLocaleDateString("dd/MMM/yyyy")+"', ")):S+=R[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(W[V][this.grData.Table[K].FieldName.toString().Trim()].replace("'","''"))+"', ")}x=new Rt.b,x.BOMID=0,x.Code=c,x.Name=n,x.Date=b,x.ProductID=r,x.Packing=y,x.UOMID=t,x.FPQty=parseFloat(g),x.FPQty<=0&&(x.FPQty=1),x.LocationID=u,x.DivisionID=h,x.group=!1,x.selectednodeid=i,x.Desc=a,x.StatusID=o,x.StageXML=W[V].StagesXML.toString(),x.BOMProductXML=W[V].BOMProductXML.toString(),x.BOMExpenseXML=W[V].BOMExpenseXML.toString(),x.BOMResourceXML=W[V].BOMResourceXML.toString(),x.CustomFieldsQuery=S,x.CustomCCQuery=F,x.WID=0,f=this.DisplayMessage=x.AddMultiStageBOM(),f<0?(l++,this.FailedRecourdList.push({Name:n,Message:this.ErrorMessage})):s++,this.ImportedCount="Imported :"+s.toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+(l+s).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportBoms(){if(!this.ScanCostCenterFields(!0))return;let e=0,s=0,i=this.ExcelTable,u="",h="",t=this.GetBomFieldName("FeatureFieldName=555026"),o="",r="",m="";if(""==t)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);i.sort((a,g)=>a.BomName.localeCompare(g.BomName)),o+="<BOMProductXML>",r+="<BOMExpenseXML>",m+="<BOMResourceXML>";for(let a=0;a<i.length;a++,this.ProgressValue++)u=h,h=i[a][t].toString(),u!=h&&a>0&&(o+="</BOMProductXML>",r+="</BOMExpenseXML>",m+="</BOMResourceXML>",this.SaveBom(i[a-1],o.toString(),r.toString(),m.toString())<0?(s++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+s.toString(),o="",r="",m="",o+="<BOMProductXML>",r+="<BOMExpenseXML>",m+="<BOMResourceXML>"),""!=this.GetFieldValue("FeatureFieldName=-1",i[a])?(o+="<Row ",o+=" BOMProductID='0'",o+=" ProductUse='1'",o+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",i[a])+"'",o+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",i[a])+"'",o+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",i[a])+"'",o+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",i[a])+"'",o+=" Action='New'",o+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",i[a])+"'",o+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",i[a])+"'/>"):""!=this.GetFieldValue("FeatureFieldName=-12",i[a])&&(o+="<Row ",o+=" BOMProductID='0'",o+=" ProductUse='2'",o+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-12",i[a])+"'",o+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",i[a])+"'",o+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",i[a])+"'",o+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",i[a])+"'",o+=" Action='New'",o+=" Value='"+this.GetFieldValue("FeatureFieldName=-6",i[a])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-7",i[a])&&(r+="<Row ",r+=" ExpenseID='0'",r+=" ResourceID='1'",r+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-7",i[a])+"'",""!=this.GetFieldValue("FeatureFieldName=-15",i[a])&&(r+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-15",i[a])+"'"),r+=" Action='New'",r+=" Value='"+this.GetFieldValue("FeatureFieldName=-8",i[a])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-9",i[a])&&(m+="<Row ",m+=" BOMResourceID='0'",m+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-9",i[a])+"'",m+=" Hours='"+this.GetFieldValue("FeatureFieldName=-10",i[a])+"'",m+=" Action='New'",m+=" Value='"+this.GetFieldValue("FeatureFieldName=-11",i[a])+"'/>");o+="</BOMProductXML>",r+="</BOMExpenseXML>",m+="</BOMResourceXML>",this.SaveBom(i[i.length-1],o.toString(),r.toString(),m.toString())<0?(s++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+s.toString(),this.DisplayMessage="Import completed ( Total :"+(s+e).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SaveBom(e,s,l,i){let u,h=new Rt.b;return h.BOMID=0,h.Code=this.GetFieldValue("FeatureFieldName=555025",e),h.Name=this.GetFieldValue("FeatureFieldName=555026",e),""!=this.GetFieldValue("FeatureFieldName=23902",e)&&(h.Date=new Date(this.GetFieldValue("FeatureFieldName=23902",e))),h.ProductID=parseInt(this.GetFieldValue("FeatureFieldName=23899",e)),""!=this.GetFieldValue("FeatureFieldName=23900",e)&&(h.LocationID=parseInt(this.GetFieldValue("FeatureFieldName=23900",e))),""!=this.GetFieldValue("FeatureFieldName=23901",e)&&(h.DivisionID=parseInt(this.GetFieldValue("FeatureFieldName=23901",e))),h.group=!1,h.selectednodeid=0,h.Desc=this.GetFieldValue("FeatureFieldName=23903",e),h.StatusID=51,h.BOMProductXML=s,h.BOMExpenseXML=l,h.BOMResourceXML=i,h.CustomFieldsQuery="",h.CustomCCQuery="",u=h.AddBOM(""),u}GetBomFieldName(e){let s="";const l=this.grData.Table,i=this.CostCenterFieldsAllTables.Tables[0],[u,h]=e.split("=");return l.filter(t=>t[u.trim()]?.toString()===h.trim()),l.length>0&&(i.filter(t=>t.CostCenterColID===l[0][1].toString()),s=i.length>0&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0?l[0][0].toString()+"_Key":l[0][0].toString()),s}GetFieldValue(e,s){let l=this.GetBomFieldName(e);return s.includes(l)?s[l].toString().Trim():""}ReadStructure(e,s){const l=new DOMParser,i=l.parseFromString(e,"application/xml");if(i){const u=i.childNodes[0];this.Feature.SelectedValue=u.attributes[0].value,this.Feature.SetSelectedItem_2(u.attributes[1].value,u.attributes[0].value),this._FeatureSelectedValue=this.Feature.SelectedItem.Aliasname,s&&this.OnSelectionChanged(null),this.IsDuplicateNameAllowed=u.attributes.length>2&&"1"===u.attributes[2].value&&"IsDuplicate"===u.attributes[2].name,this.IsAutoCodeGen=u.attributes.length>3&&"1"===u.attributes[3].value&&"IsCodeAutoGen"===u.attributes[3].name,this.IsUpdate=u.attributes.length>4&&"1"===u.attributes[4].value&&"IsUpdate"===u.attributes[4].name,this.IsCode=u.attributes.length>5&&"1"===u.attributes[5].value&&"IsCodeBase"===u.attributes[5].name,this.IsProductwiseBarcode=u.attributes.length>6&&"1"===u.attributes[6].value&&"IsProductwiseBarcode"===u.attributes[6].name,this.BulkSave=u.attributes.length>7&&"1"===u.attributes[7].value&&"IsBulkSave"===u.attributes[7].name,null!==u.getAttribute("ValidateBeforeImport")&&(this.ValidateBeforeImport="1"===u.getAttribute("ValidateBeforeImport")),null!==u.getAttribute("UpdateStatusInExcel")&&(this.UpdateStatusInExcel="1"===u.getAttribute("UpdateStatusInExcel")),null!==u.getAttribute("AppendData")&&(this.AppendData="1"===u.getAttribute("AppendData")),null!==u.getAttribute("FillLocalReference")&&(this.FillLocalReference="1"===u.getAttribute("FillLocalReference")),Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4&&this.QtyRateVisible&&(null!==u.getAttribute("IsQtyChecked")&&(this.IsQtyChecked="true"===u.getAttribute("IsQtyChecked")),null!==u.getAttribute("QtyText")&&(this.QtyText.Text=u.getAttribute("QtyText")),null!==u.getAttribute("QtyCombo")&&(this.QtyCombo.SelectedValue=u.getAttribute("QtyCombo")),null!==u.getAttribute("IsRateChecked")&&(this.IsRateChecked="true"===u.getAttribute("IsRateChecked")),null!==u.getAttribute("RateText")&&(this.RateText.Text=u.getAttribute("RateText")),null!==u.getAttribute("RateCombo")&&(this.RateCombo.SelectedValue=u.getAttribute("RateCombo"))),null!==u.getAttribute("DoNotCreateCostCenter")&&(this.DoNotCreateCostCenter="1"===u.getAttribute("DoNotCreateCostCenter")),(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4||93===Number(this.Feature.SelectedValue))&&this.LoadDocItems();for(let h=1;h<u.childNodes.length;h++){const t=u.childNodes[h];if(t.nodeName)for(let o=0;o<this.grData.Table.length;o++)""!==t.nodeName&&"Localref"!==t.nodeName&&(o+1).toString()===t.attributes[0].value&&(this.grData.Table[o].FeatureFieldName=t.attributes[2].value.toString())}this.grData.RefreshColumns();for(let h=0;h<u.childNodes.length;h++){const t=u.childNodes[h];if("Localref"===t.nodeName){const r=l.parseFromString(t.outerHTML,"application/xml").childNodes[0];for(let m=0;m<r.childNodes.length;m++){const c=r.childNodes[m];for(let n=0;n<this.DocItems.Items.length;n++)this.DocItems.Items[n].Value===c.attributes[2].value&&(this.DocItems.Items[n].IsChecked=!0)}}}this.grData.RefreshColumns()}}LoadDocItems(){let e=I.d.document.GetDataSet('select distinct d.CostCenterColID,r.ResourceData from ADM_CostCenterDef c WITH(NOLOCK)\n                        JOIN ADM_CostCenterDef d WITH(NOLOCK) ON d.CostCenterColID = C.LocalReference  \n                        JOIN COM_LanguageResources r WITH(NOLOCK) ON r.ResourceID = d.ResourceID\n                        where LanguageID=" + BaseService.SessionManager.LanguageID + " and  c.CostCenterID=" + Feature.SelectedValue + " and c.LocalReference is not null and c.LocalReference<>0');if(null!=e&&e.Tables[0].length>0&&0==this.DocItems.Items.length)for(let s=0;s<e.Tables[0].length;s++)this.DocItems.Items.push(se.oN.CheckedListBoxItem_2(e.Tables[0][s].ResourceData.toString(),e.Tables[0][s].CostCenterColID.toString()))}OnSave(e){var s=this;if(e.toString().Contains("Save")){let i="";if(this.grData.Table.length>0)if(N.J0.IsEmpty(this.Feature.SelectedValue)||"70"!=this.Feature.SelectedValue.toString()){i+='<XML Parent="'+this.Feature.SelectedValue+'" ParentName="'+N.J0.EncodeXML(this.Feature.SelectedItem.Name)+'"',i+=' IsDuplicate="'+(0,B.yG0)(this.IsDuplicateNameAllowed)+'" ',i+=' IsCodeAutoGen="'+(0,B.yG0)(this.IsAutoCodeGen)+'" ',i+=' IsUpdate="'+(0,B.yG0)(this.IsUpdate)+'" ',i+=' IsCodeBase="'+(0,B.yG0)(this.IsCode)+'"  ',i+=' IsProductwiseBarcode="'+(0,B.yG0)(this.IsProductwiseBarcode)+'" ',i+=' IsBulkSave="'+(0,B.yG0)(this.BulkSave)+'"   ',i+=' ValidateBeforeImport="'+(0,B.yG0)(this.ValidateBeforeImport)+'" ',i+=' UpdateStatusInExcel="'+(0,B.yG0)(this.UpdateStatusInExcel)+'" ',i+=' AppendData="'+(0,B.yG0)(this.AppendData)+'" ',i+=' FillLocalReference="'+(0,B.yG0)(this.FillLocalReference)+'" ',parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<=5e4&&this.QtyRateVisible&&(i+=' IsQtyChecked="'+this.IsQtyChecked+'" ',i+=' QtyText="'+this.QtyText.Text+'" ',i+=' QtyCombo="'+this.QtyCombo.SelectedValue+'" ',i+=' IsRateChecked="'+this.IsRateChecked+'" ',i+=' RateText="'+this.RateText.Text+'" ',i+=' RateCombo="'+this.RateCombo.SelectedValue+'" '),i+=' DoNotCreateCostCenter="'+(0,B.yG0)(this.DoNotCreateCostCenter)+'" ',i+=" > ";for(let u=0;u<this.grData.Table.length;u++)""!=this.grData.Table[u].FeatureFieldName&&null!=this.grData.Table[u].FeatureFieldName&&null!=this.grData.Table[u].FeatureFieldName&&(i+="<Row   ",i+=' RowNo="'+(u+1)+'"',i+=' FieldName="'+this.grData.Table[u].FieldName.toString()+'"',i+=' FeatureFieldName="'+N.J0.EncodeXML(this.grData.Table[u].FeatureFieldName.toString())+'"',i+="/>");if(this.DocItems.Items.length>0&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<=5e4||93==parseInt(this.Feature.SelectedValue)){let u=0;i+="<Localref>";for(let h=0;h<this.DocItems.Items.length;h++)this.DocItems.Items[h].IsChecked&&(u++,i+='<Row RowNo="'+u+'" ResData="'+this.DocItems.Items[h].Name+'" ColID="'+this.DocItems.Items[h].Value+'" />');i+="</Localref>"}if(i+="</XML>","SaveProfile"==e.toString()){if(null==this.ProfileName.Text||""==this.ProfileName.Text)return this.DisplayMessage="Enter Profile name",void(this.MessageVisibility=!0);{let u,h;h=I.d.document.SaveImportDetails(this.ProfileID,this.ProfileName.Text,this.ActualFileName,i.toString(),!1),this.DisplayMessage=h?.Message,u=h?.RetValue,this.MessageVisibility=!0,u>0&&(this.ProfileID=u)}}else if("SaveRim"==e.toString()){const u=i.toString?i.toString():i,h=new Blob([u],{type:"text/plain;charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(h),t.download="export.rim";try{console.log("ImportUtilityViewModel::Entering SaveFile"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href),this.DisplayMessage="Saved file successfully",this.MessageVisibility=!0,console.log("ImportUtilityViewModel::Exiting SaveFile")}catch(o){this.DisplayMessage="Error in Exporting",this.MessageVisibility=!0,console.error("ImportUtilityViewModel::Error SaveFile",o)}}}else{if(!(this.BankAccounts.SelectedValue>0))return this.DisplayMessage=I.d.GetResource("SelectBankAccount"),void(this.MessageVisibility=!0);i+='<XML Parent="'+this.Feature.SelectedValue+'" ParentName="'+this.Feature.SelectedItem.Name+'"',i+=' IsDuplicate="'+(0,B.yG0)(this.IsDuplicateNameAllowed)+'" ',i+=' IsCodeAutoGen="'+(0,B.yG0)(this.IsAutoCodeGen)+'" ',i+=' IsUpdate="'+(0,B.yG0)(this.IsUpdate)+'" ',i+=' IsCodeBase="'+(0,B.yG0)(this.IsCode)+'"   ',i+=' IsProductwiseBarcode="'+(0,B.yG0)(this.IsProductwiseBarcode)+'" ',i+=' IsBulkSave="'+(0,B.yG0)(this.BulkSave)+'" ',i+=' ValidateBeforeImport="'+(0,B.yG0)(this.ValidateBeforeImport)+'" ',i+=' UpdateStatusInExcel="'+(0,B.yG0)(this.UpdateStatusInExcel)+'" ',i+=' AppendData="'+(0,B.yG0)(this.AppendData)+'" ',i+=' FillLocalReference="'+(0,B.yG0)(this.FillLocalReference)+'" ',i+=" > ",i+="<Row   ";for(let h=0;h<this.grData.Table.length;h++)if(""!=this.grData.Table[h].FeatureFieldName.toString()&&null!=this.grData.Table[h].FeatureFieldName){const t=this.ImportCols[1].ComboData.Table.Rows;for(const o of t)this.grData.Table[h].FeatureFieldName.toString()==o.CostCenterColID.toString()&&(i+=o.SysColumnName.toString()+'="'+this.grData.Table[h].FieldName.toString()+'" ')}i+="/>",i+="</XML>",this.DisplayMessage=I.d.document.SaveBRSDetails(i.toString(),this.BankAccounts.SelectedValue),this.MessageVisibility=!0}}else if("Open"==e.toString()){console.log("ImportUtilityViewModel::Entering OpenFile");const i=document.createElement("input");i.type="file",i.accept=".rim",i.onchange=function(){var u=(0,Le.A)(function*(h){const t=h.target;if(!t.files||0===t.files.length)return;const o=t.files[0];try{const r=yield o.text();s.ReadStructure(r,!1)}catch(r){console.error("ImportUtilityViewModel::Error OpenFile",r)}finally{document.body.removeChild(i)}});return function(h){return u.apply(this,arguments)}}(),document.body.appendChild(i),i.click()}else if("Define"==e.toString()){if(this.LoadDocItems(),this.DocItems.Items.length>0)var l=new Wt.o;l.PactListBoxViewModel_1(this.DocItems.Items,I.d.GetResource("DDesigner_LRef")),I.d.page.ShowDialog(l,$t.f,{ShowCenter:!0,Title:I.d.GetResource("DDesigner_LRef")})}else if("Preview"==e.toString())try{if(parseInt(this.Feature.SelectedValue.toString())>4e4&&parseInt(this.Feature.SelectedValue.toString())<5e4?this.ScanDocument(!1,!1,0,!1):this.IsScaned||this.ScanCostCenterFields(!1),this.IsScaned&&this.CCQuery.length>0)for(let u of this.CCQueryData.Items)if(""!=u.Value&&this.grData.Table.filter(t=>t.FieldName==t.Name).length>0){let t=new xe.AddNoteViewModel;t.NoteID=0,u.Value.split(",");let r=this.grData.Table.filter(m=>m.FieldName==m.Name&&"-16"==m.FeatureFieldName);if(r.length>0)t.Note.Text="New Group("+u.Name+") will be created ";else if(r=this.grData.Table.filter(m=>m.FieldName==m.Name),r.length>0){const m=this.CostCenterFieldsAllTables.Tables[0];m.filter(c=>c.CostCenterColID===r[0].FeatureFieldName.toString()),m.length>0&&(t.Note.Text="New Dimension, "+m[0].UserColumnName.toString()+" ("+u.Name+") will be created ")}else t.Note.Text="New Dimension,  "+u.Name+" will be created ";t.Note.ToolTipDescription=u.Value,t.Note.Label=u.Name,this.NotesList.push(t)}if(this.ExcelTable.length>0){if(0!=(this.NotesList?.length??0)||0!=(this.ErrorList?.length??0)||0!=(this.RulesList?.length??0)||!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4&&parseInt(this.Feature.SelectedValue)<=50075)){let u=this.ExcelTable,h=new Zt;return h.PreviewDataViewModel(u,this),I.d.page.ShowDialog(h,Ti,{ShowCenter:!0,Title:""}),void console.log("afterClosePopup")}this.IsPreviewDataOk=!0,this.IsScaned||(null!=this.dsexcel&&(this.dsexcel=[]),this.ExcelTable=this.dsexcel[0])}}catch(i){Logger.ErrorLog("ImportUtilityViewModel::Error OpenFile",i.message)}else if("ExportFailedRecords"==e.toString()){const i=m=>null==m?"":String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),u=[];u.push("<html><body style='color:blac;background-color:white;'>"),u.push("<style>"),u.push(".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt}"),u.push(".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}"),u.push("</style>"),u.push("<table border=1 width='450' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >"),u.push("<tr>"),u.push("<tr><td class='hdr'><b>Sno<b></td>"),u.push("<td class='hdr' width='150'><b>Failed Records<b></td>"),u.push("<td class='hdr' width='250'><b>Message<b></td></tr>"),u.push("</tr>");for(let m=0;m<this.FailedRecourdList.length;m++){const c=this.FailedRecourdList[m]||{Name:"",Message:""};u.push(`<tr${m%2==1?"class='alt'":""}>`),u.push(`<td align='left' >${m+1} </td>`),u.push(`<td align='left' > ${i(c.Name)}</td>`),u.push(`<td align='left' >${i(c.Message)}</td>`),u.push("</tr>")}u.push("</table>"),u.push("</body></html>");const h=u.join(""),t=new Blob([h],{type:"applicaton/vnd.ms-excel"}),o=document.createElement("a"),r=URL.createObjectURL(t);o.setAttribute("href",r),o.setAttribute("download","ExportedRecords.xls"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if("Verify"==e.toString()){if(0==this.SavedIDs.length)return void(this.DisplayMessage="No records saved");let i,u,h=0,t="";t+="<PactRevenURpts>\n                < ID />\n                <Name>Import </Name>\n                < PactRevenURptDef >\n                <Name>Import </Name>\n                < ArabicName > Report </ArabicName>\n                < TotalColumns > 3 </TotalColumns>\n                < TotalGroups > 0 </TotalGroups>\n                < GridLines > 3 </GridLines>\n                < VAlign > Bottom </VAlign>\n                < Columns >\n                <HeaderHeight>30 </HeaderHeight>\n                < RowHeight > 22 </RowHeight>\n                < SubRowHeight > 22 </SubRowHeight>";for(let m of this.grData.Table)i=this.CostCenterFieldsAllTables.Tables[0].filter(c=>c.CostCenterColID==m[1].toString()),u=i[0],t+='<ColumnDef><Identity><ID>C" + colCnt + @"</ID>\n                    < Sequence > " + colCnt + @" </Sequence>\n                    < Caption > " + row[0].toString() + @" </Caption>\n                    < Category > 103 </Category>\n                    < Field > 26445 </Field>\n                    < SelectedField > 25543 </SelectedField>\n                ',"DATE"==u.ColumnDataType.toString()?t+="<Type>STRING</Type>":"FLOAT"==u.ColumnDataType.toString()?t+="<Type>FLOAT</Type>":t+="<Type>STRING</Type>",t+="</Identity>\n                    < Width > 120 </Width>\n                    < HeaderAppearance >\n                    <Alignment>Center </Alignment>\n                    < Font > Calibri </Font>\n                    < FontSize > 12 </FontSize>\n                    < FontBold > True </FontBold>\n                    </HeaderAppearance>\n                    < DataAppearance > ","FLOAT"==u.ColumnDataType.toString()&&(t+="<Alignment>Right</Alignment>"),t+="<Alignment>Left</Alignment>",t+="<Font>Calibri</Font>\n                    < FontSize > 13 </FontSize>\n                    </DataAppearance>","DATE"==u.ColumnDataType.toString()?t+="<Format><DateType>dd/MMM/yyyy</DateType></Format>":"FLOAT"==u.ColumnDataType.toString()?t+="<Format>\n                        < Decimals > -1 </Decimals>\n                        < Commas > -1 </Commas>\n                        </Format>":t+="<Format></Format>",t+="</ColumnDef>",h++;t+="</Columns>\n                < Groups > </Groups>\n                < ReportTotal >\n                <Identity>\n                <ID></ID>\n                < Prefix > REPORT TOTAL </Prefix>\n                    < ShowCaption > 1 </ShowCaption>\n                    < Level > 0 </Level>\n                    </Identity>\n                    < Appearance >\n                    <ShowUnder></ShowUnder>\n                    < Width > -1 </Width>\n                    < Height > 22 </Height>\n                    < Border > 0 </Border>\n                    < Visibility > 0 </Visibility>\n                    < Font > Calibri </Font>\n                    < Alignment > Left </Alignment>\n                    < FontSize > 14 </FontSize>\n                    < FontBold > True </FontBold>\n                    </Appearance>\n                    < Format >\n                    <Decimals>2 </Decimals>\n                    < Commas > 1 </Commas>\n                    </Format>\n                    < Columns >\n                    </Columns>\n                    </ReportTotal>\n\n                    </PactRevenURptDef>\n                    < Filters >\n                    <PreDataFetch>\n                    <TreeFilter></TreeFilter>\n                    < FieldFilter > </FieldFilter>\n                    </PreDataFetch>\n                    < PostDataFetch > </PostDataFetch>\n                    </Filters>\n                    </PactRevenURpts>";let o=[];o.push("ReportName"),o.push("ReportTypeID"),o.push("ReportID"),o.push("ReportTypeName"),o.push("IsUserDefined"),o.push("ReportDefnXML"),o.push("StaticReportType"),o.push("DefaultPreferences"),o.push("CustomPreferences"),o.push("TreeXML"),o.push("ReportBody"),o.push("ReportHeader"),o.push("PageHeader"),o.push("PageFooter"),o.push("ReportFooter"),o.push("RowColumnReportsMap"),o.push("KPIXML"),o.push("QUERY"),o.push("MatrixXML"),o.push("FormulaFields");let r={ReportID:0,ReportName:"Import",ReportTypeID:0,ReportTypeName:"Grid",IsUserDefined:1};r.ReportDefnXML=t.toString(),r.StaticReportType=0,r.DefaultPreferences="",r.CustomPreferences="<XML><HideCostCenterTree>1</HideCostCenterTree><HidePrefetch>1</HidePrefetch></XML>",r.TreeXML="",r.ReportBody="",r.ReportHeader="",r.PageHeader="",r.PageFooter="",r.ReportFooter="",r.FormulaFields="",r.QUERY=this.setQuery(),r.MatrixXML="",o.push(r)}else"Validate"==e.toString()&&(this.IsSaveDocValidate=!0,this.ImportingMessage="Validating Data Please Wait....",this.ImportDataClick())}ScanCostCenterFields(e){if(this.IsScaned)return!0;this.NotesList=[],this.Previewinfo="";let c,T,s=null,l=null,i=null,h=!1,t=!1,o=!1,r=!1,p="";Logger.InfoLog("ImportCosCenters --\x3eEntering ScanCostCenterFields reading excel data for filling id of Account/Product/Dimensions"),3==parseInt(this.Feature.SelectedValue)?(T=this.CostCenterFieldsAllTables.Tables[8].filter(S=>"NameSameasCode"==S.Name),T.length>0&&(this.NameSameasCode=(0,B.yG0)(T[0].Value))):parseInt(this.Feature.SelectedValue)>5e4&&(T=this.CostCenterFieldsAllTables.Tables[6].filter(S=>"NameSameasCode"==S.Name),T.length>0&&(this.NameSameasCode=(0,B.yG0)(T[0].Value)));for(let S=0;S<this.ExcelTable.length;S++)for(let F of this.grData.Table){let y=this.ExcelDataColumn.indexOf(F.FieldName);const C=F.FeatureFieldName;if(null!=C&&""!=C.toString()&&"0"!=C.toString()&&(s=this.CostCenterFieldsAllTables.Tables[0].filter(f=>f.CostCenterColID==C.toString()),s.length>0)){if(s[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&s[0].SysColumnName.toString().endsWith("_FromDate")&&s[0].CostCenterColID.toString().endsWith("000")||s[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&s[0].SysColumnName.toString().endsWith("_ToDate")&&s[0].CostCenterColID.toString().endsWith("001")||s[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&s[0].SysColumnName.toString().endsWith("_Remarks")&&s[0].CostCenterColID.toString().endsWith("002"))continue;if("AccountName"==s[0].SysColumnName.toString()&&"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==s[0].SysColumnName.toString()||"BOMName"==s[0].SysColumnName.toString()||"Name"==s[0].SysColumnName.toString()||"FirstName"==s[0].SysColumnName.toString()||"Company"==s[0].SysColumnName.toString()||"CaseNumber"==s[0].SysColumnName.toString()||"ProductName"==s[0].SysColumnName.toString()||"BaseName"==s[0].SysColumnName.toString()||"BatchNumber"==s[0].SysColumnName.toString()||"ProfileName"==s[0].SysColumnName.toString())h=!0;else if("IsBillwise"==s[0].SysColumnName.toString()||"IsGroup"==s[0].SysColumnName.toString()){if("IsBillwise"==s[0].SysColumnName.toString()&&(o=!0),"yes"!=this.ExcelTable[S][y].toLowerCase()&&"no"!=this.ExcelTable[S][y].toLowerCase()&&!(0,B.yG0)(this.ExcelTable[S][y])){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage=o?"Incorrect Billwise information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", expected Yes/No]":"Incorrect Group information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", expected Yes/No] at Excel ColumnName "+this.ExcelTable[F.FieldName.toString()],this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(f);let b=new xe.AddNoteViewModel;b.NoteID=0;let w=String(S+1),R=this.ExcelTable[S][y];b.Note.Text=o?`Incorrect Billwise information at Row  ${w}, ${R}, expected Yes/No`:`Incorrect Group information at Row " ${w}, ${R},expected Yes/No] at Excel ColumnName  ${R}`,this.ErrorList.push(b)}}}else if("UOMID"==s[0].SysColumnName.toString()||"unit"==s[0].SysColumnName.toString().toLowerCase()||"PurchaseUOM"==s[0].SysColumnName.toString()){let f=this.ExcelTable.includes[F.FieldName.toString()].ColumnName+"_Key";this.ExcelTable.includes(f)||(this.ExcelTable.push(f),this.temp.includes(parseInt(s[0].ColumnCostCenterID.toString()))||this.temp.push(parseInt(s[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[S][y]&&(c=4,i=l=null,e?(c=2,""!=s[0].CostCenterColID.toString()&&parseInt(s[0].CostCenterColID.toString())>0?(i=this.CostCenterFieldsAllTables.Tables[0].filter(b=>"ProductID"==b.SysColumnName&&b.CostCenterColID>0),i.length>0&&(l=this.grData.Table.filter(b=>b.FeatureFieldName==i[0].CostCenterColID.toString()))):(l=this.grData.Table.filter(b=>"-1"==b.FeatureFieldName),0==l.length&&(l=this.grData.Table.filter(b=>"-12"==b.FeatureFieldName))),l.length>0&&(this.CostCenterFieldsAllTables.Tables[c].RowFilter=this.IsCode?"UnitName='"+this.ExcelTable[S][y]+"' and ProductCode='"+this.ExcelTable[S][l[0].FieldName.toString().Trim()].replace("'","''")+"'":"UnitName='"+this.ExcelTable[S][y]+"' and ProductName='"+this.ExcelTable[S][l[0].FieldName.toString().Trim()].replace("'","''")+"'"),0==this.CostCenterFieldsAllTables.Tables[c].length&&(this.CostCenterFieldsAllTables.Tables[c].RowFilter="UnitName='"+this.ExcelTable[S][y]+"'  and (ProductName is null or ProductName='DynamicSet')")):(""!=s[0].CostCenterColID.toString()&&parseInt(s[0].CostCenterColID.toString())>0&&(i=this.CostCenterFieldsAllTables.Tables[0].filter(this.IsCode?b=>"ProductCode"==b.SysColumnName&&b.CostCenterColID>0:b=>"ProductName"==b.SysColumnName&&b.CostCenterColID>0),i.length>0&&(l=this.grData.Table.filter(b=>b.FeatureFieldName==i[0].CostCenterColID.toString()))),l.length>0?(this.CostCenterFieldsAllTables.Tables[c].RowFilter=this.IsCode?"UnitName='"+this.ExcelTable[S][y]+"' and ProductCode='"+this.ExcelTable[S][l[0].FieldName.toString().Trim()].replace("'","''")+"'":"UnitName='"+this.ExcelTable[S][y]+"' and ProductName='"+this.ExcelTable[S][l[0].FieldName.toString().Trim()].replace("'","''")+"'",0==this.CostCenterFieldsAllTables.Tables[c].length&&(this.CostCenterFieldsAllTables.Tables[c].RowFilter="UnitName='"+this.ExcelTable[S][y].replace("'","''")+"'")):this.CostCenterFieldsAllTables.Tables[c].RowFilter="UnitName='"+this.ExcelTable[S][y].replace("'","''")+"'"),this.CostCenterFieldsAllTables.Tables[c].length>0?this.ExcelTable[S][f]=this.CostCenterFieldsAllTables.Tables[c][0].UOMID.toString():(this.temp.includes(parseInt(s[0].ColumnCostCenterID.toString()))||this.temp.push(parseInt(s[0].ColumnCostCenterID.toString())),this.temp[parseInt(s[0].ColumnCostCenterID.toString())].Contains(this.ExcelTable[S][y].toLowerCase())||(this.temp[parseInt(s[0].ColumnCostCenterID.toString())].push(this.ExcelTable[S][y].toLowerCase()),this.Uomsb+="<Row  PrimaryKey='0' UName='"+k.Dw.GetValidXml(this.ExcelTable[S][y])+"'  ConversionRate='1' MapAction='NEW' />")))}else if("SubstituteGroup"==s[0].SysColumnName.toString()||"SubstituteProduct"==s[0].SysColumnName.toString())this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,!1);else if(s[0].SysColumnName.toString().startsWith("Assigned_")&&parseInt(s[0].ColumnCostCenterID)>0)"7"==this.Feature.SelectedValue?this.CheckAssignedCostCenters(S,parseInt(s[0].ColumnCostCenterID),F.FieldName.toString(),this.IsCode):""!=s[0].CostCenterColID.toString()&&parseInt(s[0].CostCenterColID.toString())>0?this.CheckAssignedCostCenters(S,parseInt(s[0].ColumnCostCenterID),F.FieldName.toString(),!0):this.CheckAssignedCostCenters(S,parseInt(s[0].ColumnCostCenterID),F.FieldName.toString(),!1);else if(null!=s[0].ColumnCostCenterID&&""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID.toString())>0)""!=this.ExcelTable[S][y]&&("Cross Dimension"==this.Feature.SelectedItem.Name&&this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode),44==parseInt(s[0].ColumnCostCenterID)?this.CheckLookupField(S,parseInt(s[0].ColumnCCListViewTypeID.toString()),F.FieldName.toString()):"76"==this.Feature.SelectedValue&&"Bill Of Materials With Multiple Stage"==this.Feature.SelectedItem.Name?this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode):"Job Output"==this.Feature.SelectedItem.Name&&"Code"==s[0].SysColumnName.toString()?this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,!0):"Job Output"==this.Feature.SelectedItem.Name&&-158!=parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,this.IsCode):-1==parseInt(F.FeatureFieldName)||-12==parseInt(F.FeatureFieldName)||-7==parseInt(F.FeatureFieldName)||-9==parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,!1):parseInt(F.FeatureFieldName)>0||-16==parseInt(F.FeatureFieldName)||-30==parseInt(F.FeatureFieldName)||-23==parseInt(F.FeatureFieldName)||-29==parseInt(F.FeatureFieldName)||-30==parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode):this.CheckCostCenterField(S,parseInt(s[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,!0));else if("StatusID"!=s[0].SysColumnName.toString()&&("RoleID"!=s[0].SysColumnName.toString()||50051!=parseInt(s[0].CostCenterID)))if("AccountTypeID"==s[0].SysColumnName.toString()){if(t=!0,i=null,i=this.CostCenterFieldsAllTables.Tables[2].filter(f=>f.ResourceData==this.ExcelTable[S][y]),0==i.length){p="";for(let f of this.CostCenterFieldsAllTables.Tables[2])p+=f.ResourceData.toString()+",";if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect Account Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : "+p.substring(0,p.length-1)+"]",this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Account Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : "+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}}else if("Contact_ContactTypeID"==s[0].SysColumnName.toString()){if(p="",p=this.ExcelTable[S][y],"Primary"!=p&&"Secondary"!=p){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect contact Type  information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values 'Primary, Secondary]",this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect contact Type  information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values 'Primary, Secondary]",this.ErrorList.push(f)}}}else if("ProductTypeID"==s[0].SysColumnName.toString()){t=!0,i=null,i=this.CostCenterFieldsAllTables.Tables[2].filter(f=>f.ResourceData==this.ExcelTable[S][y]),p="";for(let f of this.CostCenterFieldsAllTables.Tables[2])p+=f.ResourceData.toString()+",";if(0==i.length){let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Product Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : -"+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}else if("ValuationID"==s[0].SysColumnName.toString()){r=!0,p="";for(let f of this.CostCenterFieldsAllTables.Tables[3])p+=f.ResourceData.toString()+",";if("FIFO"!=this.ExcelTable[S][y]&&"LIFO"!=this.ExcelTable[S][y]&&"Weighted Average"!=this.ExcelTable[S][y]&&""!=this.ExcelTable[S][y]){let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Valuation Method at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+" , Expected values :- "+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}else if(s[0].ColumnDataType&&"int"==s[0].ColumnDataType.toString().toLowerCase()||s[0].ColumnDataType&&"bigint"==s[0].ColumnDataType.toString().toLowerCase()){if(!parseInt(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" information at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" information at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.ErrorList.push(f)}}}else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){if(""!=this.ExcelTable[S][y]&&!parseFloat(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+"]",this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.ErrorList.push(f)}}}else if(s[0].ColumnDataType&&"datetime"==s[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected Date in format 'dd/MMM/yyy']",this.MessageVisibility=!0,!1;{let f=new xe.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected Date in format 'dd/MMM/yyy']",this.ErrorList.push(f)}}}}let d=h;if("50051"==this.Feature.SelectedValue){let S="",F="",y="",C=null;const f=this.grData.Table;if(C=f.filter(b=>"30000"==b.FeatureFieldName),C.length>0&&(S=C[0].FieldName.toString()),C=f.filter(b=>"30001"==b.FeatureFieldName),C.length>0&&(F=C[0].FieldName.toString()),this.IsCode&&""==S)return this.DisplayMessage="Please select employee code field",this.MessageVisibility=!0,!1;if(!this.IsCode&&""==F&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select employee name field",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""==F&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select Based on Unique Field to Update",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let b=this.CostCenterFieldsAllTables.Tables[0].Select("SysColumnName='"+this.UpdateBasedOn.SelectedValue+"'");if(null!=b&&b.length>0&&(y=b[0].SysColumnName.toString(),C=f.filter(w=>w.FeatureFieldName==b[0].CostCenterColID.toString()),0==C.length))return this.DisplayMessage="Please select Employee - "+b[0].UserColumnName.toString()+" field in the Mappings",this.MessageVisibility=!0,!1}this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue&&(d=!0)}if(!d&&!h&&this.ExcelTable.length>0&&!this.NameSameasCode&&"10"!=this.Feature.SelectedValue)return this.DisplayMessage="Name does not exists",this.MessageVisibility=!0,!1;if(("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue)&&!t&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new xe.AddNoteViewModel;S.NoteID=0,S.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(S)}if(!o&&"2"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new xe.AddNoteViewModel;S.NoteID=0,S.Note.Text="Bill wise is not set for Debtors / Creditors type of account, by default it will set to Yes",this.RulesList.push(S)}if(!r&&"3"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new xe.AddNoteViewModel;S.NoteID=0,S.Note.Text="Valuation method is not set product, by default it will set to defined at product preferences",this.RulesList.push(S)}return!0}extradataImport(e,s,l){this.FillLookupFields(),this.DoNotCreateCostCenter||this.FillCostCenterFields(!1);let i=[];if(""!=s.toString()){Logger.InfoLog("ScanCostCenterFields: Importing UOM Dat values="+s.toString()),s+="</XML>",i.push(""),i.push(0),i.push("<XML>"+s.toString()),i.push(1),i.push(I.d.SessionManager.CompanyGUID),i.push(I.d.SessionManager.UserName),i.push(I.d.SessionManager.RoleID),i.push(I.d.SessionManager.LanguageID);let u=I.d.document.AddUOMWithDataset(i);if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("ErrorMessage"))return this.DisplayMessage=u.Tables[0][0].ErrorMessage.toString(),!1;for(let h=0;h<u.Tables[0].length;h++){const t=u.Tables[0][h].UnitName.toString().replace("*","**"),o=this.ExcelTable[l.replace("_Key","")],r=this.ExcelTable.filter(m=>m[o]?.toString()===t);if(r.length>0)for(let m of r)m[l]=u.Tables[0][h].UOMID.toString()}}return!0}ScanServiceDimensionFields(e){const s=this.CostCenterFieldsAllTables.Tables[0];let l=null;new Be;for(let u=0;u<this.ExcelTable.length;u++)for(let h of this.grData.Table)if(null!=h.FeatureFieldName&&""!=h.FeatureFieldName.toString()&&"0"!=h.FeatureFieldName.toString()&&(l=s.filter(t=>t.CostCenterColID==h.FeatureFieldName.toString()),l.length>0&&null!=l[0].ColumnCostCenterID&&""!=l[0].ColumnCostCenterID.toString()&&parseInt(l[0].ColumnCostCenterID.toString())>0))if(""!=this.ExcelTable[u][h.FieldName.toString()]&&"3"==this.Feature.SelectedValue)this.CheckCostCenterField(u,parseInt(s[0].ColumnCostCenterID.toString()),h.FieldName.toString(),e,!1);else if(""!=this.ExcelTable[u][h.FieldName.toString()]&&"Account Dimension wise Cr/Dr Limits"==this.Feature.SelectedItem.Name){if(this.IsCode){let t=this.ExcelTable[h.FieldName.toString()].ColumnName+"_Name";this.ExcelTable.includes(t)||this.ExcelTable.push(t)}this.CheckCostCenterField(u,parseInt(s[0].ColumnCostCenterID.toString()),h.FieldName.toString(),e,this.IsCode)}return this.FillCostCenterFields(e),!0}ImportServicestoDimension(){const e=this.CostCenterFieldsAllTables.Tables[0];if(!this.ScanServiceDimensionFields(!1))return;let s=0,l="",i=[];l+="<XML>";for(let u=0;u<this.ExcelTable.length;u++,this.ProgressValue++){i.length=0;let r,h="",t="",o="";l+="<Row ";for(let c=0;c<this.grData.Table.length;c++)if(null!=this.grData.Table[c].FeatureFieldName&&""!=this.grData.Table[c].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[c].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Dimension":o="CostCenterID='"+this.CostCenterid.toString()+"'  NodeID='"+this.ExcelTable[u][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ";break;case"ServiceName":"3"==this.Feature.SelectedValue.toString()&&(l+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()])+'" ',h=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]),this.ExcelTable.includes(this.grData.Table[c].FieldName.toString()+"_Key")&&(t+="Product ='"+this.ExcelTable[u][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]?""!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"M"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"2"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()])&&(t+=e[0].SysColumnName.toString()+" ='2'  "):t+=e[0].SysColumnName.toString()+" ='1'  "}if(""!=o&&(l+='LinkOption="'+o.substring(0,o.length-2)+'"  '),""!=t&&(l+='LinkFields ="'+t.substring(0,t.length-2)+'" '),""==h)continue;l+=" ></Row>",l+="</XML>";let m=[];m.push(l.toString()),m.push(this.Feature.SelectedValue),m.push(I.d.SessionManager.CompanyIndex),r=I.d.document.SetImportServicetoDimension(m),r>0&&(s++,this.FailedRecourdList.push({Name:h,Message:r})),l="",l+="<XML>",this.ImportedCount="Imported :"+(u+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}onPreviewcallback(){this.IsPreviewDataOk&&this.ImportCosCenters()}onPreviewDataClick(){this.IsScaned=!1,this.ScanCostCenterFields(!1)&&(this.IsScaned=!0,this.OnSave("Preview"))}ImportCosCenters(){Logger.InfoLog("Entering ImportCosCenters ");const e=this.costCenterTableZero;if(("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>=5e4&&parseInt(this.Feature.SelectedValue)<=50075)&&!this.IsScaned)this.onPreviewDataClick();else if(!this.ScanCostCenterFields(!1))return;if(!this.extradataImport(!1,this.Uomsb,this.UomCol))return;this.GroupsImport&&0==this.GroupTotCount&&(this.GroupfailCount=0,this.GroupTotCount=0),Logger.InfoLog("After validating data");let t,r,s=0,l=0,i="",u=null,h="",o="",m=null;if(null!=this.CodeDef&&this.IsAutoCodeGen){Logger.InfoLog("check for code information from defination");let M=this.CodeDef.filter(_e=>0==_e.IsName||null==_e.IsName);M.length>0&&M[0].PrefixContent.toString().length>0&&(m=new N.VB,m.LoadXml(M[0].PrefixContent.toString()))}h+="<XML>",o+="<History>";let c=!1,n=!1,a=!1,g=!1,p=!1,T=!1,d=!1,S=!1,F=!1,y=!1,C=0,f=0,b=0,w=0,R=0,P="",U="",x="",G="",ee="",$="",j="",W="",le="",de="",Ne="",E="",V=null;for(let M=0;M<this.ExcelTable.length;M++,this.ProgressValue++){if("PASS"==this.ExcelTable[M].IMPORT_STATUS){l++;continue}if(Logger.InfoLog("Excel table row no:"+M+1),t="",c=!1,n=!1,a=!1,g=!1,p=!1,T=!1,d=!1,S=!1,F=!1,y=!1,C=0,f=0,b=0,w=0,P="",U="",x="",G="",ee="",$="",j="",W="",le="",de="",Ne="",E="",r="",null!=m&&(Logger.InfoLog("ImportCosCenters Getting code information for the row"),u=this.GetCodeData(this.ExcelTable[M],0)),this.ExcelTable.includes("IsDeleted")&&""!=this.ExcelTable[M].IsDeleted.toString()&&(0,B.yG0)(this.ExcelTable[M].IsDeleted.toString())){if(E="",E="2"==this.Feature.SelectedValue?"AccountName":"3"==this.Feature.SelectedValue?"ProductName":"Name",e.filter(ae=>ae.SysColumnName==E).length>0){let ae=this.grData.Table.filter(L=>L.FeatureFieldName==e[0].CostCenterColID.toString());ae.length>0&&(U=this.ExcelTable[M][ae[0].FieldName.toString().Trim()].toString())}s++,this.FailedRecourdList.push({Name:U,Message:"New data exist for masters"});continue}h+="<Row ";for(let _=0;_<this.grData.Table.length;_++){let L=this.ExcelDataColumn.indexOf(this.DtImport[_].FieldName);if(null==this.grData.Table[_].FeatureFieldName||""==this.grData.Table[_].FeatureFieldName.toString()||"-200"==this.grData.Table[_].FeatureFieldName.toString())continue;let X=e.filter(De=>De.CostCenterColID==this.grData.Table[_].FeatureFieldName.toString());if(X.length>0){let De=X[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+De),De){case"StatusID":const Ke=this.CostCenterFieldsAllTables.Tables[1].filter(he=>he.ResourceData==this.ExcelTable[M][L]);Ke.length>0&&(h+='StatusID ="'+Ke[0].StatusID.toString()+'" ');break;case"AccountTypeID":const v=this.CostCenterFieldsAllTables.Tables[2].filter(he=>he.ResourceData==this.ExcelTable[M][L]);if(v.length>0){h+='TypeID ="'+v[0].AccountTypeID.toString()+'" ';try{C=parseInt(v[0].AccountTypeID.toString())}catch{C=0}}break;case"CustomerTypeID":h+='TypeID ="1" ';break;case"ProductTypeID":const ne=this.CostCenterFieldsAllTables.Tables[2].filter(he=>he.ResourceData==this.ExcelTable[M][L]);ne.length>0&&(h+='TypeID ="'+ne[0].ProductTypeID.toString()+'" ');break;case"ValuationID":const ce=this.CostCenterFieldsAllTables.Tables[3].filter(he=>he.ResourceData==this.ExcelTable[M][L]);T=!0,ce.length>0?h+='ValuationID ="'+ce[0].ValuationID.toString()+'" ':T=!1;break;case"UOMID":p=!0,j+="UOMID ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseUOM":j+="PurchaseUOM ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":h+='PurchaseAccount ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ',n=!0;break;case"SalesAccountID":case"SalesAccount":c=!0,h+='SalesAccount ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ';break;case"DrOptionID":S=!0,"FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"FDOM"==this.ExcelTable[M][L].toUpperCase()||"1"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"LDOM"==this.ExcelTable[M][L].toUpperCase()||"2"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==this.ExcelTable[M][L].toUpperCase()||"BC"==this.ExcelTable[M][L].toUpperCase()||"3"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DUFDM"==this.ExcelTable[M][L].toUpperCase()||"4"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DUFDM"==this.ExcelTable[M][L].toUpperCase()||"5"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DOFDM"==this.ExcelTable[M][L].toUpperCase()||"6"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DOFDM"==this.ExcelTable[M][L].toUpperCase()||"7"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==this.ExcelTable[M][L].toUpperCase()||"LDNM"==this.ExcelTable[M][L].toUpperCase()||"8"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='8', ":j+=X[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":d=!0,"FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"FDOM"==this.ExcelTable[M][L].toUpperCase()||"1"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"LDOM"==this.ExcelTable[M][L].toUpperCase()||"2"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==this.ExcelTable[M][L].toUpperCase()||"BC"==this.ExcelTable[M][L].toUpperCase()||"3"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DUFDM"==this.ExcelTable[M][L].toUpperCase()||"4"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DUFDM"==this.ExcelTable[M][L].toUpperCase()||"5"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DOFDM"==this.ExcelTable[M][L].toUpperCase()||"6"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==this.ExcelTable[M][L].toUpperCase()||"DOFDM"==this.ExcelTable[M][L].toUpperCase()||"7"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==this.ExcelTable[M][L].toUpperCase()||"LDNM"==this.ExcelTable[M][L].toUpperCase()||"8"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='8', ":j+=X[0].SysColumnName.toString()+" ='0', ";break;case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":h+=X[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ';break;case"Year":if(this.ExcelTable[M][L].Contains("-")){let he=[];he=this.ExcelTable[M][L].split("-"),b=he.length>0&&parseInt(he[0]),b=b?parseInt(he[0]):0,w=he.length>1&&parseInt(he[1]),w=w?parseInt(he[1]):0}else b=parseInt(this.ExcelTable[M][L])?parseInt(this.ExcelTable[M][L]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==u&&(h+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" '),(3==parseInt(this.Feature.SelectedValue)||parseInt(this.Feature.SelectedValue)>5e4)&&this.NameSameasCode&&(h+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ');break;case"CodePrefix":case"CodeNumber":null==u&&(h+=De+'="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":"51"!=this.Feature.SelectedValue.toString()?(this.NameSameasCode||(h+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" '),U=this.ExcelTable[M][L]):"CustomerName"==X[0].SysColumnName.toString()?(h+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ',U=this.ExcelTable[M][L]):null!=X[0].ColumnCostCenterID&&""!=X[0].ColumnCostCenterID.toString()&&parseInt(X[0].ColumnCostCenterID.toString())>0&&(j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ");break;case"BarcodeID":h+='BarcodeID="'+this.ExcelTable[M][L]+'" ';break;case"ProductGroup":case"ParentGroupName":h+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ',N.J0.IsEmpty(this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString())?(h+='SelectedNode ="1" ',f=1):(h+='SelectedNode ="'+k.Dw.GetValidXml(this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString().Trim())+'" ',f=parseInt(this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()));break;case"AccountId":case"CustomerId":"65"==this.Feature.SelectedValue.toString()&&("CustomerId"==X[0].SysColumnName.toString()?G+=" CCID='83'  CustomerName ='"+k.Dw.GetValidXml(this.ExcelTable[M][L])+"'  ":"AccountId"==X[0].SysColumnName.toString()&&(G+=" CCID='2'   CustomerName ='"+k.Dw.GetValidXml(this.ExcelTable[M][L])+"'  "));break;case"IsGroup":case"IsBillwise":if("IsGroup"==De){if(Logger.InfoLog("Group value"+this.ExcelTable[M][L].toLowerCase()),("true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L]||"on"==this.ExcelTable[M][L].toLowerCase())&&this.CCQuery.length>0&&this.ccdv.length>0)for(var K of this.CCQuery)if(console.log("itemsCCQuery",K),""!=K.value&&K.Key.toString()==this.Feature.SelectedValue&&!y)for(let he=0;he<this.ccdv[K.Key].length;he++){const Ae=this.ccdv[K].Name.toString().replace("*","**"),be=this.ExcelTable[this.COls[K.Key].replace("_Key","")];if(this.ExcelTable.filter(ve=>ve[be]?.toString()===Ae).length>0&&this.ccdv[K.Key][he].Name.toString()==U){y=!0;break}}}else F=!0;"true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L]||"on"==this.ExcelTable[M][L].toLowerCase()?h+=X[0].SysColumnName.toString()+' ="1" ':h+=X[0].SysColumnName.toString()+' ="0" ';break;case"PlanningMethod":"mrp"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L].toLowerCase()?j+=X[0].SysColumnName.toString()+" ='1' , ":j+=X[0].SysColumnName.toString()+" ='0' , ";break;case"ProcurementMethod":"produced"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L].toLowerCase()?j+=X[0].SysColumnName.toString()+" ='1' , ":j+=X[0].SysColumnName.toString()+" ='0' , ";break;case"BinWise":"true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L].toLowerCase()||"on"==this.ExcelTable[M][L].toLowerCase()?h+=X[0].SysColumnName.toString()+' ="1" ':h+=X[0].SysColumnName.toString()+' ="0" ';break;case"IsPacking":case"BOM":this.ExcelTable.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&!N.J0.IsEmpty(this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString())&&(j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ");break;case"IsBillOfEntry":"fifo"==this.ExcelTable[M][L].toLowerCase()||"2"==this.ExcelTable[M][L]?j+=X[0].SysColumnName.toString()+" ='2' , ":"true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L]||"on"==this.ExcelTable[M][L].toLowerCase()?j+=X[0].SysColumnName.toString()+" ='1' , ":j+=X[0].SysColumnName.toString()+" ='0' , ";break;case"IsLotwise":case"IsWeightable":"true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L]||"on"==this.ExcelTable[M][L].toLowerCase()?j+=X[0].SysColumnName.toString()+" ='1' , ":j+=X[0].SysColumnName.toString()+" ='0' , ";break;case"ParentID":if("3"==this.Feature.SelectedValue)if(Logger.InfoLog("Parent value"+this.ExcelTable[M][L].toLowerCase()),"true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L].toLowerCase()||"on"==this.ExcelTable[M][L].toLowerCase()){if(h+='IsGroup="1" ',("true"==this.ExcelTable[M][L].toLowerCase()||"yes"==this.ExcelTable[M][L].toLowerCase()||"y"==this.ExcelTable[M][L].toLowerCase()||"1"==this.ExcelTable[M][L].toLowerCase()||"on"==this.ExcelTable[M][L].toLowerCase())&&this.CCQuery.length>0&&this.ccdv.length>0)for(var K of this.CCQuery)if(""!=K.value&&K.Key.toString()==this.Feature.SelectedValue&&!y)for(let Ae=0;Ae<this.ccdv[K.Key].length;Ae++){const be=this.ccdv[K].Name.toString().replace("*","**"),Te=this.ExcelTable[this.COls[K.Key].replace("_Key","")];if(this.ExcelTable.filter(Ge=>Ge[Te]?.toString()===be).length>0&&this.ccdv[K.Key][Ae].Name.toString()==U){y=!0;break}}}else h+='IsGroup ="0" ';else h+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[M][L])+'" ';break;case"COGSAccountID":this.ExcelTable.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&(j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', "),a=!0;break;case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&(j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', "),g=!0;break;case"Base_Name":r+="BaseName='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"' ";break;case"Base_Conversion":r+="Conversion='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"' ";break;case"Conversion_UnitName":r+="UnitName='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":r+="ConversionUnit='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"' ";break;case"MultiBarcode":r+="MultiBarcode='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"' ";break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&(le+="Product ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[M][L]||"OPTIONAL"!=this.ExcelTable[M][L].toUpperCase()&&"O"!=this.ExcelTable[M][L]&&"1"!=this.ExcelTable[M][L]?""!=this.ExcelTable[M][L]&&("MANDATORY"==this.ExcelTable[M][L]||"M"==this.ExcelTable[M][L]||"2"==this.ExcelTable[M][L])&&(le+=X[0].SysColumnName.toString()+" ='2'  "):le+=X[0].SysColumnName.toString()+" ='1'  ";break;case"AccountImage":case"ProductImage":case"DimensionImage":let pe;if(pe=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()],pe.length>0){let he=pe.split(";");try{pe=he[0]}catch{ee=""}try{for(let Ae=1;Ae<he.length;Ae++)pe=he[Ae]}catch{$=""}}break;case"Attachments":let Ye=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()];if(Ye.length>0){let he=Ye.split(";");try{for(let Ae of he);}catch{$=""}}break;case"SubstituteGroup":x+="GroupName ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"'  ";break;default:if(null!=X[0].ColumnCostCenterID&&""!=X[0].ColumnCostCenterID.toString()&&parseInt(X[0].ColumnCostCenterID.toString())>0&&"COM_ADDRESS"!=X[0].SysTableName.toString().toUpperCase())if(44==parseInt(X[0].ColumnCostCenterID.toString()))""!=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]&&(X[0].SysColumnName.toString().Contains("Alpha")?Ne+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ":j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ");else if(X[0].SysColumnName.toString().Contains("Alpha"))Ne+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=X[0].IsColumnUserDefined&&""!=X[0].IsColumnUserDefined.toString()&&(0,B.yG0)(X[0].IsColumnUserDefined.toString())&&!X[0].SysColumnName.toString().startsWith("Assigned_")&&"COM_ADDRESS"!=X[0].SysTableName.toString().toUpperCase()){if(this.ExcelDataColumn.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&""!=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()&&(i=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"' "),X[0].SysColumnName.toString().endsWith("_FromDate")||X[0].SysColumnName.toString().endsWith("_ToDate")||!X[0].SysColumnName.toString().startsWith("CCNID")||X[0].SysColumnName.toString().endsWith("_Remarks")?parseInt(X[0].CostCenterID.toString())>=5e4&&parseInt(X[0].CostCenterID.toString())<=50050&&3==parseInt(X[0].ColumnCostCenterID.toString())&&(P+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', "):this.ExcelDataColumn.includes(this.grData.Table[_].FieldName.toString()+"_Key")&&""!=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()?P+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ":P+=X[0].SysColumnName.toString()+" ='1', ",X[0].SysColumnName.toString().endsWith("_FromDate")){i="";let he="",Ae=new Date,be=null,Te=this.grData.Table.filter(ve=>ve.FeatureFieldName==this.grData.Table[_].FeatureFieldName.toString().substring(0,this.grData.Table[_].FeatureFieldName.toString().length-3));if(null!=Te&&Te.length>0){this.ExcelTable.includes(Te[0].FieldName.toString()+"_Key")&&""!=this.ExcelTable[M][Te[0].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[M][Te[0].FieldName.toString()+"_Key"].toString()&&(i=this.ExcelTable[M][Te[0].FieldName.toString()+"_Key"].toString()+"' ");let ve=this.grData.Table.filter(Je=>Je.FeatureFieldName==Te[0].FeatureFieldName.toString()+"001'");null!=ve&&ve.length>0&&null!=this.ExcelTable[M][ve[0].FieldName.toString()]&&null!=this.ExcelTable[M][ve[0].FieldName.toString()]&&""!=this.ExcelTable[M][ve[0].FieldName.toString()]&&(be=new Date(this.ExcelTable[M][ve[0].FieldName.toString()]));let Ge=this.grData.Table.filter(Je=>Je.FeatureFieldName==Te[0].FeatureFieldName.toString()+"002'");null!=Ge&&Ge.length>0&&(he=this.ExcelTable[M][Ge[0].FieldName.toString()])}o+="<XML><Row",(""==this.ExcelTable[M][L]||N.J0.isValidDate(this.ExcelTable[M][L]))&&(o+=" ID='0' CCID='"+X[0].ColumnCostCenterID.toString()+"' NodeID='"+i),o+="FromDate='"+Ae.toLocaleDateString("dd MMM yyyy").toString(),be.HasValue&&(o+="' ToDate='"+be.Value.toLocaleDateString("dd MMM yyyy").toString()),o+="' Modified='1' ",o+="Remarks='"+he+"' ",i="",o+="/></XML>"}}else null!=X[0].IsColumnUserDefined&&""!=X[0].IsColumnUserDefined.toString()&&(0,B.yG0)(X[0].IsColumnUserDefined.toString())&&X[0].SysColumnName.toString().startsWith("Assigned_")?t+=this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString():j+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=X[0].IsColumnUserDefined&&""!=X[0].IsColumnUserDefined.toString()&&(0,B.yG0)(X[0].IsColumnUserDefined.toString()))if(null==X[0].SysColumnName||!X[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&"COM_ADDRESS"!=X[0].SysTableName.toString().toUpperCase())null==X[0].SysColumnName||"COM_CCCCData"!=X[0].SysTableName.toString()||!X[0].SysColumnName.toString().toLowerCase().Contains("series")&&"IsManual"!=X[0].SysColumnName.toString()?W+=X[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[M][L])+"', ":P+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()]+"', ";else if(Object.keys(X[0]).includes("UserColumnType")&&X[0].UserColumnType.toString().toLowerCase().Contains("date")||X[0].ColumnDataType.toString().toLowerCase().Contains("date")){let he=this.Date;(""==this.ExcelTable[M][L]||N.J0.isValidDate(this.ExcelTable[M][L]))&&(Ne+=X[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(he).ToString("dd/MMM/yyyy")+"', ")}else"COM_ADDRESS"==X[0].SysTableName.toString().toUpperCase()&&parseInt(X[0].ColumnCostCenterID.toString())>0?W+=X[0].SysColumnName.toString()+" ='"+this.ExcelTable[M][this.grData.Table[_].FieldName.toString()+"_Key"].toString()+"', ":"COM_ADDRESS"==X[0].SysTableName.toString().toUpperCase()?W+=X[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[M][L])+"', ":Ne+=X[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[M][L])+"', ";else if("float"==X[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[M][L])j+=X[0].SysColumnName.toString()+" ='0', ";else if(Object.keys(X).includes("UserColumnType")&&X[0].UserColumnType.toString().toLowerCase().Contains("date")||X[0].ColumnDataType.toString().toLowerCase().Contains("date")){let he=this.Date;(""==this.ExcelTable[M][L]||N.J0.isValidDate(this.ExcelTable[M][L]))&&(j+=X[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(he).ToString("dd/MMM/yyyy")+"', ")}else j+=X[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[M][this.grData.Table[_].FieldName.toString().trim().replace("'","''")])+"', "}}}if(null!=u){if(u.Table.Contains("ErrorMessage"))return this.DisplayMessage=u.ErrorMessage.toString(),Logger.InfoLog("Code generation error "+u.ServerMessage.toString()),void(this.MessageVisibility=!0);h+='AccountCode="'+u.Code.toString()+'" ',h+='CodePrefix="'+u.Prefix.toString()+u.Suffix.toString()+'" ',h+='CodeNumber="'+u.Number.toString()+'" '}if("3"!=this.Feature.SelectedValue||this.IsUpdate||h.toString().Contains('IsGroup="1" ')){if(!this.IsUpdate&&!n){let _=e.filter(ae=>"PurchaseAccount"==ae.SysColumnName);if(_.length>0){let ae=_[0].UserDefaultValue;j+=_[0].SysColumnName.toString()+" =N'"+(null!=ae?ae.toString():"")+"', "}if(!c){let ae=e.filter(L=>"SalesAccount"==L.SysColumnName);if(ae.length>0){let L=ae[0].UserDefaultValue;j+=ae[0].SysColumnName.toString()+" =N'"+(null!=L?L.toString():"")+"', "}}if(!a){let ae=e.filter(L=>"COGSAccountID"==L.SysColumnName);if(ae.length>0){let L=ae[0].UserDefaultValue;j+=ae[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}}if(!g){let ae=e.filter(L=>"ClosingStockAccountID"==L.SysColumnName);if(ae.length>0){let L=ae[0].UserDefaultValue;j+=ae[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}}if(!p){let ae=e.filter(L=>"UOMID"==L.SysColumnName);if(ae.length>0){let L=ae[0].UserDefaultValue;j+=ae[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}else""!=this.Feature.SelectedValue&&null!=this.Feature.SelectedValue&&2!=parseInt(this.Feature.SelectedValue)&&65!=parseInt(this.Feature.SelectedValue)&&51!=parseInt(this.Feature.SelectedValue)&&(j+=" UOMID ='1', ")}}}else if(this.CostCenterFieldsAllTables.Tables[8].RowFilter="Name='Copygroupdatatonode'",f>0&&this.CostCenterFieldsAllTables.Tables[8].length>0&&(0,B.yG0)(this.CostCenterFieldsAllTables.Tables[8][0].Value.toString())){if(R!=f){R=f;let _=new xt.c;_.ProductID=f,V=_.GetCopyProductDetails(f)}if(null!=V&&V.Tables.length>7&&V.Tables[0].length>0&&this.CostCenterFieldsAllTables.Tables[8].length>0){Object.keys(V.Tables[0][0]).includes("CreatedDate"),Object.keys(V.Tables[0][0]).Remove("CreatedDate"),Object.keys(V.Tables[0][0]).includes("ModifiedDate")&&Object.keys(V.Tables[0][0]).Remove("ModifiedDate");for(let _=0;_<this.CostCenterFieldsAllTables.Tables[10].length;_++)this.grData.Table.find(L=>L.FeatureFieldName==this.CostCenterFieldsAllTables.Tables[10][_].CostCenterColID.toString()).length>0&&(V.Tables[0].includes(this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString())?"CurrencyID"==this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()&&""==V.Tables[0][0][this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()]?j+=this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()+" =N'1', ":j+=this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()+" =N'"+V.Tables[0][0][this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()]+"', ":V.Tables[1].includes(this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString())?Ne+=this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()+"='"+V.Tables[1][0][this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()]+"', ":V.Tables[7].includes(this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString())&&(P+=this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()+"=N'"+V.Tables[7][0][this.CostCenterFieldsAllTables.Tables[10][_].SysColumnName.toString()]+"', "))}}else{if(!n){let _=e.filter(ae=>"PurchaseAccountID"==ae.SysColumnName);_.length>0&&(j+=_[0].SysColumnName.toString()+" =N'"+_[0].UserDefaultValue.toString()+"', ")}if(!c){let _=e.filter(ae=>"SalesAccountID"==ae.SysColumnName);_.length>0&&(j+=_[0].SysColumnName.toString()+" =N'"+_[0].UserDefaultValue.toString()+"', ")}if(!T&&this.CostCenterFieldsAllTables.Tables.length>6)if(this.CostCenterFieldsAllTables.Tables[6].filter(ae=>"DefaultProductValuation"==ae.Name).length>0)this.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+this.CostCenterFieldsAllTables.Tables[6][0].Value.toString()+"'",3==parseInt(this.Feature.SelectedValue)&&e.filter(L=>"ValuationID"==L.SysColumnName).length>0&&(j+=e[0].SysColumnName.toString()+" ='"+this.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+"', ");else{let ae=e.filter(L=>"ValuationID"==L.SysColumnName);ae.length>0&&(j+=ae[0].SysColumnName.toString()+" ='"+ae[0].UserDefaultValue.toString()+"', ")}if(!a){let _=e.filter(ae=>"COGSAccountID"==ae.SysColumnName);_.length>0&&(j+=_[0].SysColumnName.toString()+" ='"+_[0].UserDefaultValue.toString()+"', ")}if(!g){let _=e.filter(ae=>"ClosingStockAccountID"==ae.SysColumnName);_.length>0&&(j+=_[0].SysColumnName.toString()+" ='"+_[0].UserDefaultValue.toString()+"', ")}if(!p){let _=e.filter(ae=>"UOMID"==ae.SysColumnName);_.length>0?j+=_[0].SysColumnName.toString()+" ='"+_[0].UserDefaultValue.toString()+"', ":null!=parseInt(this.Feature.SelectedValue)&&2!=parseInt(this.Feature.SelectedValue)&&65!=parseInt(this.Feature.SelectedValue)&&51!=parseInt(this.Feature.SelectedValue)&&(j+=" UOMID ='1', ")}}if(!F&&!this.IsUpdate){let _=!1;_=(0,B.yG0)(I.d.SessionManager.Preferences.On.toString()),"2"==this.Feature.SelectedValue&&0==C&&(C=7),h+=!_||6!=C&&7!=C?' IsBillwise="0" ':'IsBillwise ="1" '}let _e;if(y&&null!=this.Feature.SelectedValue&&("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4)&&(h+=' Move ="1" '),!S&&"2"==this.Feature.SelectedValue&&(j+=" DrOptionID='0', "),!d&&"2"==this.Feature.SelectedValue&&(j+=" CrOptionID='0', "),""!=j&&(h+='ExtraFields ="'+j.substring(0,j.length-2)+'" '),null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name?de="One-One":null!=this.Feature.SelectedItem&&"Product With Services(Many-One)"==this.Feature.SelectedItem.Name&&(de="Many-One"),""!=de&&(h+='LinkOption="'+de+'"  '),""!=le&&(h+='LinkFields ="'+le.substring(0,le.length-2)+'" '),""!=x&&(h+='Substitutes ="'+x.substring(0,x.length-2)+'" '),""!=G&&(h+='CustomerName ="'+G.substring(0,G.length-2)+'" '),""!=ee&&(h+='ProductImage ="'+ee+'" '),""!=Ne&&(h+='ExtraUserDefinedFields ="'+Ne.substring(0,Ne.length-2)+'" '),""!=P&&(h+='CostCenterFields ="'+P.substring(0,P.length-2)+'" '),""!=W&&(h+='PrimaryContactQuery ="'+W.substring(0,W.length-2)+'" '),r.toString().length>0&&(r.toString().Contains("Conversion=")||(r+="Conversion='1' "),h+='ProductWiseUOM="'+r.toString()+'" '),""!=U||!(3==parseInt(this.Feature.SelectedValue)||parseInt(this.Feature.SelectedValue)>5e4)||this.NameSameasCode){if(t.length>0&&(t.Insert(0,'<XML IsImport="1" >'),t+="</XML>"),$.length>0&&($="<XML>"+$+"</XML>"),h+=" ></Row>",h+="</XML>",o+="</History>",y){let _=I.d.document.SetImportData(h.toString(),t.toString(),o.toString(),this.Feature.SelectedValue,this.IsDuplicateNameAllowed,this.IsAutoCodeGen,this.IsUpdate,this.IsCode,$);_.RetValue>0?(this.ExcelTable[M].xIMP_STATUSx="FAIL",this.ExcelTable[M].IMPORT_MESSAGE=_e,s++,this.FailedRecourdList.push({Name:U,Message:_.Message})):(this.ExcelTable[M].xIMP_STATUSx="PASS",this.ExcelTable[M].IMPORT_MESSAGE="")}else{let _=I.d.document.SetImportData(h.toString(),t.toString(),o.toString(),this.Feature.SelectedValue,this.IsDuplicateNameAllowed,this.IsAutoCodeGen,this.IsUpdate,this.IsCode,$);_?.RetValue>0?(this.ExcelTable[M].xIMP_STATUSx="FAIL",this.ExcelTable[M].IMPORT_MESSAGE=_e,s++,this.FailedRecourdList.push({Name:U,Message:_.Message})):(this.ExcelTable[M].xIMP_STATUSx="PASS",this.ExcelTable[M].IMPORT_MESSAGE="")}h="",h+="<XML>",o="",o+="<History>",this.ImportedCount="Imported :"+(M+1-s).toString(),this.FailedCount="Failed :"+s.toString()}}let Ie=this.ExcelTable.length-l;this.GroupsImport&&(this.GroupfailCount=s,this.GroupTotCount=Ie),this.GroupTotCount>0&&this.GroupsImport?(this.ImportedCount="Imported :"+(this.GroupTotCount-this.GroupfailCount).toString(),this.FailedCount="Failed :"+this.GroupfailCount.toString()):(this.ImportedCount="Imported :"+(this.GroupTotCount+Ie-(this.GroupfailCount+s)).toString(),this.FailedCount="Failed :"+(this.GroupfailCount+s).toString()),this.ListVisbility=this.FailedRecourdList.length>0,this.UpdateExcelSheet(),this.DisplayMessage=this.GroupsImport?"Import completed ( Total :"+this.GroupTotCount.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )":"Import completed ( Total :"+(this.GroupTotCount+Ie).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportJobOutput(){let e=this.costCenterTableZero,s=0;if(!this.ScanCostCenterFields(!1))return;let l=0,u="";this.CheckProductUOMdata();let o="",n=0,a=0;n=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++){if(u+="<XML>",o=this.ExcelTable[g][n].toString(),this.lst.filter(d=>d.Name==o).length>0)continue;a+=1,u+="<Row ",u+=' RowNo="'+a+'" ';for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString())if(e.filter(S=>S.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),"Code"==e[0].SysColumnName.toString())u+='NodeID="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()+"_key"].toString()+'" ',u+='Code="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()]+'" ';else if("Name"==e[0].SysColumnName.toString())u+='Name="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()]+'" ';else if(""!=e[0].ColumnCostCenterID.toString()&&113==parseInt(e[0].ColumnCostCenterID.toString())){let S=this.CostCenterFieldsAllTables[5];S.filter(F=>F.ResourceData==this.ExcelTable[g][this.grData.Table[d].FieldName.toString()]),u+=e[0].SysColumnName.toString()+'="'+S[0].ItemArray[1].toString()+'" '}else""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()+"_key"].toString()+'" ':"-154"==e[0].CostCenterColID.toString()?u+='Qty="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()]+'" ':"-155"==e[0].CostCenterColID.toString()?"BOM"==this.ExcelTable[g][this.grData.Table[d].FieldName.toString()].toUpperCase()?u+='IsBom="0" ':"QTY"==this.ExcelTable[g][this.grData.Table[d].FieldName.toString()].toUpperCase()&&(u+='IsBom="1" '):"-157"==e[0].CostCenterColID.toString()&&(u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[d].FieldName.toString()]+'" ');u+=">",u+="</Row>",u+="</XML>";let p,T=[];T.push(u.toString()),T.push(this.Feature.SelectedValue),T.push(I.d.SessionManager.CompanyIndex),p=I.d.document.SetImportJobOutputData(T),this.DisplayMessage=p,u="",p<0&&(l++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),s++}this.ImportedCount="Imported :"+(s-l).toString(),this.FailedCount="Failed :"+l.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLookUps(){let e=this.costCenterTableZero,s=0,l=0;for(let i of this.ExcelTable){let u;this.name="";let h="",t="",o=!1;u=parseInt(this.CostCenterFieldsAllTables[1][0].NodeID);for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(a=>a.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0)){let a=e[0].SysColumnName.toString();"Code"==a&&(h=i[this.grData.Table[n].FieldName.toString()]),"Name"==a&&(this.name=i[this.grData.Table[n].FieldName.toString()]),"AliasName"==a&&(t=i[this.grData.Table[n].FieldName.toString()]),"Default"==a&&("1"==i[this.grData.Table[n].FieldName.toString()]||"yes"==i[this.grData.Table[n].FieldName.toString()].toLowerCase())&&(o=!0)}let m,c=[];c.push(parseInt(u)),c.push(h),c.push(this.name),c.push(t),c.push(1),c.push(o?1:0),c.push(""),c.push(I.d.SessionManager.CompanyGUID),c.push(I.d.SessionManager.UserName),c.push(I.d.SessionManager.RoleID),c.push(I.d.SessionManager.LanguageID),m=I.d.document.SetLookupImport(c),this.DisplayMessage=m,m<0&&(s++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),l++}this.ImportedCount="Imported :"+(l-s).toString(),this.FailedCount="Failed :"+s.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCrossDimension(){let o,e=this.costCenterTableZero,l="",i="",u=0,h=0,t="";if(!this.ScanCostCenterFields(!1))return;t+="<XML>",o+="<XML>";for(let c=0;c<this.ExcelTable.length;c++,this.ProgressValue++){t+="<Row ",o+="<Row ",t+='Sno ="'+(c+1)+'" ',o+='Sno ="'+(c+1)+'" ';for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(a=>a.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))if(l=e[0].SysColumnName.toString(),h=parseInt(e[0].ColumnCostCenterID),l.Contains("Dim_"))u=h;else switch(l){case"Document":t+='Document="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()]+'" ';break;case"CreditAccount":t+='CreditAccount="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"DebitAccount":t+='DebitAccount="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"In/From":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(c,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimIn="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"For/To":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(c,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimFor="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;default:i.Contains(h.toString())||(i+=h+",")}t+=" />",o+=" />"}t+="</XML>",o+="</XML>";let m=[];m.push(u),m.push(i),m.push(t.toString()),m.push(o.toString()),m.push(this.IsUpdate),m.push(this.IsCode),m.push(I.d.SessionManager.UserName),m.push(I.d.SessionManager.UserID),m.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SetImportCrossDimension(m),t="",o="",this.MessageVisibility=!0}ScanBatchfields(){let e=this.costCenterTableZero;for(let s of this.grData.Table)e.filter(l=>l.CostCenterColID==s[1].toString()),e.length>0&&("BatchNumber"==e[0].SysColumnName.toString()?this.batchnumberfield=e[0].SysColumnName.toString():"MfgDate"==e[0].SysColumnName.toString()?this.mfgdatefield=e[0].SysColumnName.toString():"ExpiryDate"==e[0].SysColumnName.toString()?this.expdatefield=e[0].SysColumnName.toString():"ProductID"==e[0].SysColumnName.toString()?this.productidfield=e[0].SysColumnName.toString():"BatchCode"==e[0].SysColumnName.toString()&&(this.bcodefield=e[0].SysColumnName.toString()))}ImportBatches(){let e=this.costCenterTableZero,s=this.CostCenterFieldsAllTables[this.CostCenterFieldsAllTables.length-2];if(this.ScanBatchfields(),!this.ScanCostCenterFields(!1))return;let h,l=0,i=null,u="";if(this.xDocCodeDef=null,null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(this.xDocCodeDef=new N.VB,this.xDocCodeDef.LoadXml(this.CodeDef[0].PrefixContent.toString())),""==this.batchnumberfield)return this.DisplayMessage="Batch number field is mandatory",void(this.MessageVisibility=!0);if(""==this.bcodefield&&!this.IsAutoCodeGen)return this.DisplayMessage="Batch code field  is mandatory",void(this.MessageVisibility=!0);for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){let o=!1,r="",m="",c="",n="";h.length=0;let a="",g="",p="",T="",d="",S=new Pt.Batch;u+="<Row ";for(let C=0;C<this.grData.Table.length;C++)if(null!=this.grData.Table[C].FeatureFieldName&&""!=this.grData.Table[C].FeatureFieldName.toString()&&(e.filter(f=>f.CostCenterColID==this.grData.Table[C].FeatureFieldName.toString()),e.length>0)){let f=e[0].SysColumnName.toString();switch(f){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1].length>0&&(u+='StatusID ="'+this.CostCenterFieldsAllTables[1][0].StatusID.toString()+'" ');break;case"MfgDate":let b;if(b=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),b)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);S.MfgDate=b,p=b.Date.toLocaleDateString("dd/MMM/yyyy");break;case"ExpiryDate":let w;if(w=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),w)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);S.ExpiryDate=w,g=w.Date.toLocaleDateString("dd/MMM/yyyy");break;case"RetestDate":let R;if(R=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),R)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);a=R.Date.toLocaleDateString("dd/MMM/yyyy");break;case"MRPRate":let P=0;P=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.MRPRate=P;break;case"RetailRate":let U=0;U=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.RetailRate=U;break;case"StockistRate":let x=0;x=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.StockistRate=x;break;case"ProductID":S.ProductID=parseInt(this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString().Trim());break;case"BatchCode":null==i&&(S.BatchCode=this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]);break;case"CodePrefix":case"CodeNumber":null==i&&(u+=f+'="'+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+'" ',"CodePrefix"==f?S.CodePrefix=k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]):"CodeNumber"==f&&(S.CodeNumber=parseInt(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])));break;case"BatchNumber":u+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+'" ',m=this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()],d=m;break;case"IsGroup":"true"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()?(u+=e[0].SysColumnName.toString()+' ="1" ',S.IsGroup=o=!0):(u+=e[0].SysColumnName.toString()+' ="0" ',S.IsGroup=o=!1);break;case"ParentID":""!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]&&(s.RowFilter=this.IsCode?"BatchNumber='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]+"'":"BatchCode='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]+"'",S.BatchGroup=s.length>0?parseInt(s[0].BatchID.toString()):1);break;case"VendorAccountID":this.ExcelTable.includes(this.grData.Table[C].FieldName.toString()+"_Key")&&(c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ");break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&!e[0].SysColumnName.toString().startsWith("Assigned_")?""!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()?r+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":r+=e[0].SysColumnName.toString()+" ='1', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().startsWith("Assigned_")?h+=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString():c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?T+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', ":n+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]?c+=e[0].SysColumnName.toString()+" ='0', ":c+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', "}}if(null!=this.xDocCodeDef&&(i=this.GetCodeData(this.ExcelTable[t],S.BatchGroup)),null!=i&&(S.BatchCode=i.Code.toString(),S.CodePrefix=i.Prefix.toString()+i.Suffix.toString(),S.CodeNumber=parseInt(i.Number.toString())),""!=c&&(u+='ExtraFields ="'+c.substring(0,c.length-2)+'" '),""!=T&&(u+='ExtraUserDefinedFields ="'+T.substring(0,T.length-2)+'" '),""!=r&&(u+='CostCenterFields ="'+r.substring(0,r.length-2)+'" '),""!=n&&(u+='PrimaryContactQuery ="'+n.substring(0,n.length-2)+'" '),""==d)continue;h.length>0&&(h.Insert(0,"<XML>"),h+="</XML>");let y,F=[];if(F.push(d),F.push(""!=p?S.MfgDate:""==p&&o?null:"1/JAN/1900"),F.push(""!=g?S.ExpiryDate:""==g&&o?null:"1/JAN/1900"),F.push(S.MRPRate),F.push(S.RetailRate),F.push(S.StockistRate),S.ProductID>0)F.push(S.ProductID);else{if(!o&&0==S.ProductID)return this.DisplayMessage="Product field is required",void(this.MessageVisibility=!0);F.push(0)}F.push(""!=a?a.toString():null),F.push(S.BatchGroup>1?S.BatchGroup:1),S.StaticFieldsQuery=c,S.CustomFieldsQuery=T,S.CustomCostCenterFieldsQuery=r,Pt.Batch.QuickAddBatch(y,F,!1),y<=0&&(l++,this.FailedRecourdList.push({Name:d,Message:y})),this.ImportedCount="Imported :"+(t+1-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckDetails(e,s){for(let l of this.lst)if(l.Name==e&&l.Value==s)return!1;return!0}ImportProductwiseMultipleUOM(){let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let s=0,l=0,i="",u="",h="";this.CheckProductUOMdata(),i+="<XML>";let t="",o=0;o=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){if(t=this.ExcelTable[r][o].toString(),this.lst.filter(b=>b.Name==t).length>0)continue;this.lst.push(se._p.ComboBoxItems_1(t));let y,m="",c="",n="",a="",g="",p="",T="",d=0,S=0,F="";i+="<Row ";for(let b=0;b<this.grData.Table.length;b++)if(null!=this.grData.Table[b].FeatureFieldName&&""!=this.grData.Table[b].FeatureFieldName.toString()&&(e.filter(w=>w.CostCenterColID==this.grData.Table[b].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(i+='StatusID ="'+this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(i+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":i+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(i+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":this.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[3].length>0&&(i+='ValuationID ="'+this.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+'" ');break;case"UOMID":a+="UOMID ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":i+='PurchaseAccount ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"SalesAccountID":case"SalesAccount":i+='SalesAccount ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":case"CrOptionID":"FIRST DAY OF MONTH"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='2', ":a+=e[0].SysColumnName.toString()+" ='0', ";break;case"CodePrefix":i+='CodePrefix ="'+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+'" ';break;case"CodeNumber":i+='CodeNumber ="'+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+'" ';break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":i+=e[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].Contains("-")){let R=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].split("-");d=R.length>0&&parseInt(R[0]),d=d?parseInt(R[0]):0,S=R.length>1&&parseInt(R[1])?parseInt(R[1]):0}else d=parseInt(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])?parseInt(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]):0;break;case"AccountCode":case"ProductCode":case"CustomerCode":case"Code":i+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"AccountName":case"CustomerName":case"Name":case"ProductName":"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==e[0].SysColumnName.toString()?(i+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ',c=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]):null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&(a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ");break;case"ParentGroupName":i+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"ParentID":case"IsBillwise":"true"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?i+=e[0].SysColumnName.toString()+' ="1" ':i+=e[0].SysColumnName.toString()+' ="0" ';break;case"COGSAccountID":case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[b].FieldName.toString()+"_Key")&&(a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ");break;case"Assigned_Locations":case"Assigned_Dimension":u+=this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString();break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[b].FieldName.toString()+"_Key")&&(p+="Product ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?""!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"M"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"2"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])&&(p+=e[0].SysColumnName.toString()+" ='2'  "):p+=e[0].SysColumnName.toString()+" ='1'  ";break;case"SubstituteGroup":n+="GroupName ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+"'  ";break;default:if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString())?m+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,B.yG0)(e[0].IsColumnUserDefined.toString()))null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?F+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', ":g+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', ";else{if("-19"==e[0].CostCenterColID.toString()||"-20"==e[0].CostCenterColID.toString()||"-21"==e[0].CostCenterColID.toString()||"-22"==e[0].CostCenterColID.toString())continue;e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='0', ":a+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', "}}if(""!=T&&(i+='LinkOption="'+T+'"  '),""!=p&&(i+='LinkFields ="'+p.substring(0,p.length-2)+'" '),""!=n&&(i+='Substitutes ="'+n.substring(0,n.length-2)+'" '),""!=this.ExcelTable[r].ProductwiseUOMConversion.toString()&&(h+=this.ExcelTable[r].ProductwiseUOMConversion.toString()),""==c)continue;i+=" ></Row>",i+="</XML>";let f=[];f.push(i.toString()),f.push(u.toString()),f.push(h.toString()),f.push(this.IsDuplicateNameAllowed),f.push(this.IsAutoCodeGen),f.push(!1),f.push(this.Feature.SelectedValue),f.push(this.IsUpdate),f.push(this.IsCode),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductWithMultipleUOM(f)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[r].ProductwiseUOMConversionCount.toString()?s+=parseInt(this.ExcelTable[r].ProductwiseUOMConversionCount.toString()):s++,this.FailedRecourdList.push({Name:c,Message:y})):l+=parseInt(this.ExcelTable[r].ProductwiseUOMConversionCount.toString()),i="",i+="<XML>",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseMultipleUOMBarcode(){if(!this.ScanCostCenterFields(!1))return;let s=0,l=0,i="";this.CheckProductUOMdata();let u="",h=0;h=this.IsCode?this.codecolnum:this.namecolnum,this.lst.Clear();for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){if(u=this.ExcelTable[t][h].toString(),this.lst.filter(m=>m.Name==u).length>0)continue;this.lst.push(se._p.ComboBoxItems_1(u)),""!=this.ExcelTable[t].ProductwiseUOMConversion.toString()&&(i+=this.ExcelTable[t].ProductwiseUOMConversion.toString());let o,r=[];r.push(u),r.push(i.toString()),r.push(this.IsUpdate),r.push(this.IsCode),r.push(I.d.SessionManager.CompanyGUID),r.push(I.d.SessionManager.UserName),r.push(I.d.SessionManager.UserID),r.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductWithMultipleUOMBarcode(r)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[t].ProductwiseUOMConversionCount.toString()?s+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()):s++,this.FailedRecourdList.push({Name:u,Message:o})):l+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()),this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}FillUnitRates(){this.costCenterTableZero=[];let e={CostCenterColID:"-1"};e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitCode",e.ResourceData="Unit Code",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-2",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitName",e.ResourceData="Unit Name",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-3",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Amount",e.ResourceData="Amount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-4",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Discount",e.ResourceData="Discount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-5",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="AnnualRent",e.ResourceData="AnnualRent",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-6",e.CostcenterID=this.Feature.SelectedValue,e.ColumnDataType="DATE",e.SysColumnName="WEF",e.ResourceData="WEF",this.costCenterTableZero.push(e)}FillUnitRateXML(){let e=this.costCenterTableZero,s="",l="",i="",t=0,o=0;for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":this.IsCode&&(t=r,l=this.grData.Table[r].FieldName.toString());break;case"UnitName":this.IsCode||(o=r,i=this.grData.Table[r].FieldName.toString())}if(t>0||o>0){this.ExcelTable.includes("UnitRatexml")||this.ExcelTable.push("UnitRatexml"),this.lst.Clear(),this.excelview=this.ExcelTable;let r,m="",c=0;c=this.IsCode?t:o;for(let n=0;n<this.ExcelTable.length;n++)if(r=this.ExcelTable[n][c].toString(),0==this.lst.filter(a=>a.Name==r).length){this.lst.push(se._p.ComboBoxItems_1(r)),this.excelview.filter(this.IsCode?T=>T.colcode==r:T=>T.colname==r),m+="<XML>";let g,p,a=0;for(let T of this.excelview){m+="<Row  ",m+=" UnitRateID='0'  ",m+=" Action=\"NEW\"  MapAction='0'  ";for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":p=N.J0.Int(T[this.grData.Table[d].FieldName.toString()]),p&&(s+="Amount='"+p+"' ");break;case"Discount":p=N.J0.Int(T[this.grData.Table[d].FieldName.toString()]),p&&(s+="Discount='"+p+"' ");break;case"AnnualRent":p=N.J0.Int(T[this.grData.Table[d].FieldName.toString()]),p&&(s+="AnnualRent='"+p+"' ");break;case"WEF":g=N.J0.isValidDate(T[this.grData.Table[d].FieldName.toString()]),g&&(s+="WEF='"+g.toString("dd/MMMyyyyy")+"' ")}m+=s.toString(),m+="/>",a++}m+="</XML>";for(let T of this.ExcelTable)T[c].toString()==r&&(T.UnitRatexml=m.toString())}}}ImportUnitRates(){this.DisplayMessage="",this.MessageVisibility=!1;let o,e=this.costCenterTableZero,s=0,l="",i="",u="",h="";for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":l=this.grData.Table[r].FieldName.toString();break;case"UnitName":i=this.grData.Table[r].FieldName.toString()}if(this.lst.Clear(),this.excelview=this.ExcelTable,""!=l||""!=i)for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){if(o=""!=l?this.ExcelTable[r][l].toString():this.ExcelTable[r][i].toString(),0==this.lst.filter(m=>m.Name==o).length){this.lst.push(se._p.ComboBoxItems_1(o)),this.excelview.filter(""!=l?a=>a.colcode==o:a=>a.colname==o),""!=l&&(u=this.ExcelTable[r][l].toString()),""!=i&&(h=this.ExcelTable[r][i].toString());let c,n,m=0;if(this.excelview.length>0){let a="";a+="<XML>";for(let p of this.excelview){a+="<Row  ",a+=" UnitRateID='0'  ",a+=" Action=\"NEW\"  MapAction='0'  ";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":n=N.J0.Int(p[this.grData.Table[T].FieldName.toString()]),c=N.J0.isValidDate(p[this.grData.Table[T].FieldName.toString()]),n&&(a+="Amount='"+n+"' ");break;case"Discount":n&&(a+="Discount='"+n+"' ");break;case"AnnualRent":n&&(a+="AnnualRent='"+n+"' ");break;case"WEF":c&&(a+="WithEffFrom='"+c.toLocaleDateString("dd/MMM/yyyy")+"' ")}a+="/>",m++}a+="</XML>";let g=[];g.push(u),g.push(h),g.push(a.toString()),g.push(I.d.SessionManager.CompanyGUID),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.LanguageID),I.d.document.SetImportUnitRates(g)<0&&(s++,this.FailedRecourdList.push({Name:o,Message:void 0}))}}this.ImportedCount="Imported :"+(this.lst.length+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseVendorMultipleBarcode(){this.DisplayMessage="",this.MessageVisibility=!1;let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let s=0,l="",i="",t="",o="";this.CheckProductVendorMultipleBarcode();let r,m=0,c=0;for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&(e.filter(g=>g.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(m=a,l=this.grData.Table[a].FieldName.toString());break;case"ProductName":this.IsCode||(c=a,i=this.grData.Table[a].FieldName.toString())}this.lst.Clear();let n=0;n=this.IsCode?m:c,t+="<XML>";for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++){let g="";if(r=this.ExcelTable[a][n].toString(),0==this.lst.filter(p=>p.Name==r).length){t+="<Row ",this.lst.push(se._p.ComboBoxItems_1(r));for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":t+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[a][this.grData.Table[d].FieldName.toString().Trim()])+'" ';break;case"ProductName":t+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[a][this.grData.Table[d].FieldName.toString().Trim()])+'" ',g=this.ExcelTable[a][this.grData.Table[d].FieldName.toString().Trim()]}let p;if(""==g)continue;t+=" ></Row>",t+="</XML>",""!=this.ExcelTable[a].ProdVendorMulBarcode.toString()&&(o+=this.ExcelTable[a].ProdVendorMulBarcode.toString());let T=[];T.push(t.toString()),T.push(o.toString()),T.push(this.Feature.SelectedValue),T.push(this.IsDuplicateNameAllowed),T.push(this.IsUpdate),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyGUID),T.push(I.d.SessionManager.UserName),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductVendorMultipleBarcode(T)<0&&(s++,this.FailedRecourdList.push({Name:g,Message:p}))}t="",t+="<XML>",this.ImportedCount="Imported :"+(a+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckProductUOMdata(){let e=this.costCenterTableZero,s="";for(let l=0;l<this.grData.Table.length&&"-19"!=this.grData.Table[l][1].toString();l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&(e.filter(i=>i.CostCenterColID==this.grData.Table[l].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(this.codecolnum=l,this.colcode=this.grData.Table[l].FieldName.toString());break;case"ProductName":this.IsCode||(this.namecolnum=l,this.colname=this.grData.Table[l].FieldName.toString())}if(this.columnexist){this.ExcelTable.includes("ProductwiseUOMConversion")||(this.ExcelTable.push("ProductwiseUOMConversion"),this.ExcelTable.push("ProductwiseUOMConversionCount")),this.lst.Clear(),this.excelview=this.ExcelTable;let i,l="",u=0;u=this.IsCode?this.codecolnum:this.namecolnum;for(let h=0;h<this.ExcelTable.length;h++)if(i=this.ExcelTable[h][u].toString(),0==this.lst.filter(t=>t.Name==i).length){this.lst.push(se._p.ComboBoxItems_1(i)),this.excelview.filter(this.IsCode?o=>o.colcode==i:o=>o.colname==i),l+="<Data>";let t=0;for(let o of this.excelview){l+="<Row RowNo='"+(t+1)+"'    ",l+=" UnitiD='0'  ",l+=" Action=\"NEW\"  MapAction='0'  ",l+=" BaseID='-100'  ";for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[h].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Base_Name":s+="BaseName='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Base_Conversion":s+="Conversion='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Conversion_UnitName":s+="UnitName='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":s+="ConversionUnit='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"MultiBarcode":s+="MultiBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"BaseMultiBarcode":s+="BaseMultiBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"UOM_Barcode":""!=o[this.grData.Table[r].FieldName.toString()]&&(this.ShowBarcodeDimension?(s+="Barcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",s+="BarKey='"+o[this.grData.Table[r].FieldName.toString()+"_Key"].toString()+"' "):(s+="Barcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",s+="BarKey='0' "));break;case"Base_Barcode":""!=o[this.grData.Table[r].FieldName.toString()]&&(this.ShowBarcodeDimension?(s+="BaseBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",s+="BaseBarKey='"+o[this.grData.Table[r].FieldName.toString()+"_Key"].toString()+"' "):(s+="BaseBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",s+="BaseBarKey='0' "))}l+=s.toString(),l+="/>",t++}l+="</Data>";for(let o of this.ExcelTable)o[u].toString()==i&&(o.ProductwiseUOMConversion=l.toString(),o.ProductwiseUOMConversionCount=this.excelview.length)}}}CheckProductVendorMultipleBarcode(){let e=this.costCenterTableZero,s="",l="",i="",t=0,o=0,r=!1;for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(c=>c.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(t=m,l=this.grData.Table[m].FieldName.toString());break;case"ProductName":this.IsCode||(o=m,i=this.grData.Table[m].FieldName.toString());break;case"Vendor":"-23"==this.grData.Table[m][1].toString()&&(r=!0)}if(r){this.ExcelTable.includes("ProdVendorMulBarcode")||this.ExcelTable.push("ProdVendorMulBarcode"),this.lst.Clear(),this.excelview=this.ExcelTable;let m,c="",n=0;n=this.IsCode?t:o;for(let a=0;a<this.ExcelTable.length;a++)if(m=this.ExcelTable[a][n].toString(),0==this.lst.filter(g=>g.Name==m).length){this.lst.push(se._p.ComboBoxItems_1(m)),this.excelview.filter(this.IsCode?p=>p.colcode==m:p=>p.colname==m),c+="<VendorsXML>";let g=0;for(let p of this.excelview){c+="<Row  ",c+=" VendorID='0'  ",c+=" Action=\"NEW\"  MapAction='0'  ";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Vendor":s+="AccountID='"+p[this.grData.Table[T].FieldName.toString()+"_Key"]+"' ";break;case"ETA":s+="LeadTime='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Priority":s+="Priority='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Min. Order Quantity":s+="MinOrderQty='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Barcode":s+="Barcode='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Volume":s+="Volume='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Weight":s+="Weight='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Remarks":s+="Remarks='"+p[this.grData.Table[T].FieldName.toString()]+"' "}c+=s.toString(),c+="/>",g++}c+="</VendorsXML>";for(let p of this.ExcelTable)p[n].toString()==m&&(p.ProdVendorMulBarcode=c.toString())}}}ReturnDimensionProfileID(){return I.d.document.GetDataSet("SELECT distinct ProfileID ,ProfileName FROM COM_DimensionMappings WITH(NOLOCK) \nSELECT * FROM COM_DimensionMappings WITH(NOLOCK)")}ReturnSchemeProfileID(){return I.d.document.GetDataSet(" SELECT distinct(ProfileID),ProfileName FROM ADM_SchemesDiscounts WITH(NOLOCK) ").Tables[0]}ImportPriceChart(){let e,s=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let l=null,i=null,u="",h="",t="";if(s.filter(a=>"3"==a.ColumnCostCenterID),s.length>0)for(let a of this.grData.Table)if(a[1].toString()==s[0].CostCenterColID.toString()){t=a.FieldName.toString();break}for(let a=0;a<this.ExcelTable.length;a++){this.ExcelTable[a].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(s.filter(p=>p.CostCenterColID==g[1].toString()),s.length>0))if(""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID)>0)e=parseInt(s[0].ColumnCostCenterID),this.CheckCostCenterFieldName(a,e,g.FieldName.toString(),t,!1)||(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++);else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"ProfileName",!0))l=this.ExcelTable[a][g.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"PriceType",!0))""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"ALL"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"A"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"0"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"SALE"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"S"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"1"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"PURCHASE"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"P"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"2"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&("REORDER LEVEL"==this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()||"RL"==this.ExcelTable[a][g.FieldName.toString().Trim()]||"3"==this.ExcelTable[a][g.FieldName.toString().Trim()])&&(h+=' Type="3" '):h+=' Type="2" ':h+=' Type="1" ':h+=' Type="0" ';else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let p;p=!parseFloat(this.ExcelTable[a][g.FieldName.toString().Trim()]),p&&(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++),h+=s[0].SysColumnName.toString()+'="'+p+'" ',this.UpdateColumns+=s[0].SysColumnName.toString()+","}else if(s[0].ColumnDataType&&"datetime"==s[0].ColumnDataType.toString().toLowerCase()){let p=new Date;p=this.ExcelTable[a][g.FieldName.toString().Trim()],N.J0.isValidDate(p)?this.sbQuery+=s[0].SysColumnName.toString()+'="'+p.toLocaleDateString("dd MMM yyyy")+'" ':(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++)}if(0==a||i==l){if(0==this.ExcelTable[a].PID.toString().length&&(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE="Select Product at Row "+(a+1).toString(),a<this.ExcelTable.length-1&&a++),i=l,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==i).length){let g=-1;g=this.ReturnProfileIDBasedOnName(i,g),new ft.T,this.lstDuplicate.push(se._p.ComboBoxItems_1(i))}u+="<Row ",u+=this.sbQuery.toString(),u+=h.toString(),u+="/>",this.ExcelTable[a].xIMP_STATUSx="PASS"}else a--,this.SavePriceChart(u,i),i=l}u.length>0&&this.SavePriceChart(u,l),this.ListVisbility=this.FailedRecourdList.length>0;let m=this.ExcelTable.filter(a=>"PASS"==a.xIMP_STATUSx).length.toString(),c=this.ExcelTable.filter(a=>"FAIL"==a.xIMP_STATUSx).length.toString(),n=parseInt(m)+parseInt(c);m="Imported :"+m,c="Failed :"+c,this.DisplayMessage="Import completed ( Total :"+n.toString()+" "+m+" "+c+" )",this.FailedRecourdList.length>0&&(this.ListVisbility=!0),this.MessageVisibility=!0}ImportSchemesDiscountsBasedOnUniqueDimension(){let e,s;s=this.ReturnSchemeProfileID();let l=s,i=this.costCenterTableZero,u=null,h=null,t=null,o=null,r="",m="",c="",a="",p="";i.filter(y=>"3"==y.CostCenterColID);let T=0,d=this.grData.Table.filter(y=>"3"==y.FeatureFieldName);d.length>0&&d[0].FieldName.toString(),d=this.grData.Table.filter(y=>"-3"==y.FeatureFieldName),d.length>0&&(a=d[0].FieldName.toString()),d=this.grData.Table.filter(y=>"-2"==y.FeatureFieldName),d.length>0&&(p=d[0].FieldName.toString()),d=this.grData.Table.filter(y=>"-1"==y.FeatureFieldName),d.length>0&&d[0].FieldName.toString(),this.UniqueDimensionFill(),this.FreeUniqueDimensionFill();let S,F=new Date;for(let y=0;y<this.ExcelTable.length;y++){if(this.UpdateColumns="",p.length>0){if(o=this.ExcelTable[y][p].toString().Trim(),t!=o&&(c.length>0?(c.Insert(0,"<ProductsXML>"),c+="</ProductsXML>",r.replace("#@PRODXML@#",c.toString())):r.replace("#@PRODXML@#",""),c=""),this.ExcelTable[y][a].toString().Trim().length>0){if(""==this.ExcelTable[y][a+"_Key"].toString())return this.DisplayMessage=a+" "+this.ExcelTable[y][a].toString().Trim()+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);c+='<Row ProductID="'+this.ExcelTable[y][a+"_Key"].toString()+'" ';for(let C of this.grData.Table)if(null!=C[1]&&""!=C[1].toString()&&"0"!=C[1].toString()&&(i.filter(f=>f.CostCenterColID==C[1].toString()),i.length>0))if(S=i[0].SysColumnName.toString(),0==N.J0.stringCompare(i[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""!=this.ExcelTable[y][C.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[y][C.FieldName.toString().Trim()])&&(c+=' IsQtyPercent="2" '):c+=' IsQtyPercent="1" ':c+=' IsQtyPercent="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let f;if(f=this.ExcelTable[y][C.FieldName.toString().Trim()],!parseFloat(f))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);c+=i[0].SysColumnName.toString()+'="'+f+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}c+="/>"}if(t==o)continue}for(let C of this.grData.Table)if(null!=C[1]&&""!=C[1].toString()&&"0"!=C[1].toString()&&(i.filter(f=>f.CostCenterColID==C[1].toString()),i.length>0))if(S=i[0].SysColumnName.toString(),""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID)>0){if(e=parseInt(i[0].ColumnCostCenterID),"FreeProduct"!=S){let f;if(""==this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString())return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);3==e?this.sbQuery+='ProductID="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" ':2==e?this.sbQuery+='AccountID="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" ':f=e-5e4,this.sbQuery+="CC"+f+'="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" '}}else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[y][C.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""!=this.ExcelTable[y][C.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[y][C.FieldName.toString().Trim()])&&(m+=' IsQtyPercent="2" '):m+=' IsQtyPercent="1" ':m+=' IsQtyPercent="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let f;if(f=this.ExcelTable[y][C.FieldName.toString().Trim()],!parseFloat(f))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);m+=i[0].SysColumnName.toString()+'="'+f+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}else if(i[0].ColumnDataType&&"date"==i[0].ColumnDataType.toString().toLowerCase()){if(F=this.ExcelTable[y][C.FieldName.toString().Trim()],!N.J0.isValidDate(F))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);m+=i[0].SysColumnName.toString()+'="'+F.toLocaleDateString("dd MMM yyyy")+'" '}if(t=o,0==y||h==u)h=u,this.IsUpdate&&0==this.lstDuplicate.filter(C=>C.Name==h).length&&(l.filter(C=>C.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),this.lstDuplicate.push(se._p.ComboBoxItems_1(h))),r+="<Row> ",r+="<XML ",l.filter(C=>C.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),r+=this.sbQuery.toString(),r+='SchemeID="0" ',r+='StatusID="500018" ',r+=m.toString(),r+=">",p.length>0&&(r+="#@PRODXML@#"),r+="</XML>",r+="</Row>";else{y--,r.Insert(0,"<XML>"),r+="</XML>",l.filter(b=>b.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString()));let f=[];f.push(T),f.push(h),f.push(r.toString()),f.push(I.d.SessionManager.CompanyGUID),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(f),h=u,r="",c="",t=null}}if(r.length>0){l.filter(f=>f.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),c.length>0?(c.Insert(0,"<ProductsXML>"),c+="</ProductsXML>",r.replace("#@PRODXML@#",c.toString())):r.replace("#@PRODXML@#",""),r.Insert(0,"<XML>"),r+="</XML>";let C=[];C.push(T),C.push(h),C.push(r.toString()),C.push(I.d.SessionManager.CompanyGUID),C.push(I.d.SessionManager.UserName),C.push(I.d.SessionManager.UserID),C.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(C)}this.ListVisbility=this.FailedRecourdList.length>0}ImportSchemesDiscounts(){let e,s;s=this.ReturnSchemeProfileID();let l=s,i=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("FPID")||this.ExcelTable.push("FPID");let u=null,h=null,t=null,o=null,r=500018,m="",c="",n="",a="",g="",T="";i.filter(C=>3==C.ColumnCostCenterID);let d=0,S=this.grData.Table.filter(C=>"3"==C.FeatureFieldName);S.length>0&&(a=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-3"==C.FeatureFieldName),S.length>0&&(g=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-2"==C.FeatureFieldName),S.length>0&&(T=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-1"==C.FeatureFieldName),S.length>0&&S[0].FieldName.toString();let F,y=new Date;for(let C=0;C<this.ExcelTable.length;C++){if(c="",this.ExcelTable[C].Query="",this.sbQuery="",this.UpdateColumns="",T.length>0){if(o=this.ExcelTable[C][T].toString().Trim(),t!=o&&(n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",m.replace("#@PRODXML@#",n.toString())):m.replace("#@PRODXML@#",""),n=""),this.ExcelTable[C][g].toString().Trim().length>0){if(!this.CheckCostCenterFieldName(C,3,g,"FreeProduct",!1))return this.DisplayMessage=g+" "+this.ExcelTable[C][g].toString().Trim()+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);n+='<Row ProductID="'+this.ExcelTable[C].FPID.toString()+'" ';for(let f of this.grData.Table)if(null!=f[1]&&""!=f[1].toString()&&"0"!=f[1].toString()&&(i.filter(b=>b.CostCenterColID==f[1].toString()),i.length>0))if(F=i[0].SysColumnName.toString(),0==N.J0.stringCompare(i[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""!=this.ExcelTable[C][f.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[C][f.FieldName.toString().Trim()])&&(n+=' IsQtyPercent="2" '):n+=' IsQtyPercent="1" ':n+=' IsQtyPercent="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let b;if(b=this.ExcelTable[C][f.FieldName.toString().Trim()],!parseFloat(b))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);n+=i[0].SysColumnName.toString()+'="'+b+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}n+="/>"}if(t==o)continue}for(let f of this.grData.Table)if(null!=f[1]&&""!=f[1].toString()&&"0"!=f[1].toString()&&(i.filter(b=>b.CostCenterColID==f[1].toString()),i.length>0))if(F=i[0].SysColumnName.toString(),""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID)>0){if(e=parseInt(i[0].ColumnCostCenterID),"FreeProduct"!=F&&!this.CheckCostCenterFieldName(C,e,f.FieldName.toString(),a,!1))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0)}else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[C][f.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"StatusID",!0))r="Active"==this.ExcelTable[C][f.FieldName.toString()]?500018:500019;else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""!=this.ExcelTable[C][f.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[C][f.FieldName.toString().Trim()])&&(c+=' IsQtyPercent="2" '):c+=' IsQtyPercent="1" ':c+=' IsQtyPercent="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let b;if(b=this.ExcelTable[C][f.FieldName.toString().Trim()],!parseFloat(b))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);c+=i[0].SysColumnName.toString()+'="'+b+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}else if(i[0].ColumnDataType&&"date"==i[0].ColumnDataType.toString().toLowerCase()){if(y=this.ExcelTable[C][f.FieldName.toString().Trim()],!N.J0.isValidDate(y))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);c+=i[0].SysColumnName.toString()+'="'+y.toLocaleDateString("dd MMM yyyy")+'" '}if(t=o,0==C||h==u)h=u,this.IsUpdate&&0==this.lstDuplicate.filter(f=>f.Name==h).length&&(l.filter(f=>f.ProfileName==h),l.length>0&&(d=parseInt(l[0].ProfileID.toString())),this.lstDuplicate.push(se._p.ComboBoxItems_1(h))),m+="<Row> ",m+="<XML ",l.filter(f=>f.ProfileName==h),l.length>0&&(d=parseInt(l[0].ProfileID.toString())),m+=this.sbQuery.toString(),m+='SchemeID="0" ',m+='StatusID="'+r+'" ',m+=c.toString(),m+=">",T.length>0&&(m+="#@PRODXML@#"),m+="</XML>",m+="</Row>";else{C--,m.Insert(0,"<XML>"),m+="</XML>",l.filter(w=>w.ProfileName==h),l.length>0&&(d=parseInt(l[0].ProfileID.toString()));let b=[];b.push(d),b.push(h),b.push(m.toString()),b.push(I.d.SessionManager.CompanyGUID),b.push(I.d.SessionManager.UserName),b.push(I.d.SessionManager.UserID),b.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(b),h=u,m="",n="",t=null}}if(m.length>0){l.filter(b=>b.ProfileName==h),l.length>0&&(d=parseInt(l[0].ProfileID.toString())),n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",m.replace("#@PRODXML@#",n.toString())):m.replace("#@PRODXML@#",""),m.Insert(0,"<XML>"),m+="</XML>";let f=[];f.push(d),f.push(h),f.push(m.toString()),f.push(I.d.SessionManager.CompanyGUID),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(f)}this.ListVisbility=this.FailedRecourdList.length>0}ImportDimensionMapping(){let e,s=0,l=this.ReturnDimensionProfileID(),i=l.Tables[0],u=l.Tables[1],h=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let t=null,o=null,r="",m="",c="";h.filter(a=>"3"==a.ColumnCostCenterID);let n=0;if(h.length>0)for(let a of this.grData.Table)if(a[1].toString()==h[0].CostCenterColID.toString()){c=a.FieldName.toString();break}for(let a=0;a<this.ExcelTable.length;a++){m="",this.ExcelTable[a].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(h.filter(p=>p.CostCenterColID==g[1].toString()),h.length>0))if(""!=h[0].ColumnCostCenterID.toString()&&parseInt(h[0].ColumnCostCenterID)>0){if(e=parseInt(h[0].ColumnCostCenterID),!this.CheckCostCenterFieldName(a,e,g.FieldName.toString(),c,!0))return this.DisplayMessage=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),void(this.MessageVisibility=!0)}else 0==N.J0.stringCompare(h[0].SysColumnName.toString(),"ProfileName",!0)?t=this.ExcelTable[a][g.FieldName.toString().Trim()]:h[0].ColumnDataType&&"bit"==h[0].ColumnDataType.toString().toLowerCase()&&("YES"==this.ExcelTable[a][g.FieldName.toString()].toUpperCase()||"1"==this.ExcelTable[a][g.FieldName.toString()]?s=1:("NO"==this.ExcelTable[a][g.FieldName.toString()].toUpperCase()||"0"==this.ExcelTable[a][g.FieldName.toString()])&&(s=0),m+='<Row cols ="'+h[0].SysColumnName.toString().replace("BasedCC","")+'"  IsBase="'+s+'" />');if(0==a||o==t)o=t,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==o).length&&(i.filter(g=>g.ProfileName==o),i.length>0&&(n=parseInt(i[0].ProfileID.toString())),this.lstDuplicate.push(se._p.ComboBoxItems_1(o))),r+="<Row ",n>0?(u.RowFilter=this.sbQuery.toString().replace(" "," AND ").replace('"',"'")+" ProfileID='"+n+"'",r+=u.length>0?'DimMapID="'+u[0].DimensionMappingsID.toString()+'" ':'DimMapID="0" '):r+='DimMapID="0" ',r+=this.sbQuery.toString(),r+="/>";else{a--,r.Insert(0,"<XML>"),m.Insert(0,"<XML>"),r+="</XML>",m+="</XML>",i.filter(T=>T.ProfileName==o),i.length>0&&(n=parseInt(i[0].ProfileID.toString()));let p=[];p.push(n),p.push(o),p.push(r.toString()),p.push(m.toString()),p.push(""),p.push(!1),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveDimensionMap(p),o=t,r="",m=""}}if(r.length>0){i.filter(p=>p.ProfileName==o),i.length>0&&(n=parseInt(i[0].ProfileID.toString())),r.Insert(0,"<XML>"),m.Insert(0,"<XML>"),r+="</XML>",m+="</XML>";let g=[];g.push(n),g.push(o),g.push(r.toString()),g.push(m.toString()),g.push(""),g.push(!1),g.push(I.d.SessionManager.CompanyGUID),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveDimensionMap(g)}this.ListVisbility=this.FailedRecourdList.length>0}ImportTaxChart(){let e,i=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("DocID")||this.ExcelTable.push("DocID"),this.ExcelTable.includes("ColID")||this.ExcelTable.push("ColID");let u=null,h=null,t="",o="",r=new Date;for(let m=0;m<this.ExcelTable.length&&m!=this.ExcelTable.length;m++){o="";let a,c=0,n=0,g="",p="";this.ExcelTable[m].Query="",this.sbQuery="",this.UpdateColumns="",this.TaxCCUpdate="";for(let T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(i.filter(d=>d.CostCenterColID==T[1].toString()),i.length>0))if(""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID)>0)e=parseInt(i[0].ColumnCostCenterID),this.CheckCostCenterFieldName(m,e,T.FieldName.toString(),"",!1)||(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[m][T.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++);else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[m][T.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"DocID",!0))g=this.ExcelTable[m][T.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ColID",!0))p=this.ExcelTable[m][T.FieldName.toString().Trim()];else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let d;d=this.ExcelTable[m][T.FieldName.toString().Trim()],parseFloat(d)||(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[m][T.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++),o+=' Price="'+d+'"  '}else i[0].ColumnDataType&&"date"==i[0].ColumnDataType.toString().toLowerCase()&&(r=this.ExcelTable[m][T.FieldName.toString().Trim()],N.J0.isValidDate(r)?this.sbQuery+=i[0].SysColumnName.toString()+'="'+r.toLocaleDateString("dd MMM yyyy")+'" ':(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[m][T.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++));if(this.TaxCCUpdate.length>0&&(this.sbQuery+=' CCUpdate="'+this.TaxCCUpdate+'"'),g.length>0){if(a=I.d.document.GetDocumentIDByName(g),null!=a&&(a.Tables[0].length>0&&(c=parseInt(a.Tables[0][0].CostCenterID.toString())),0==c&&(this.DisplayMessage="Invalid Document"+g+"at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++),null!=a&&a.Tables.length>1&&a.Tables[1].length>0))if(p.length>0){let T=a.Tables[1];T.RowFilter="UserColumnName='"+p.toString()+"'",T.length>0?n=parseInt(T[0].CostCenterColID.toString()):(this.DisplayMessage="Invalid Column name "+p+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++)}else this.DisplayMessage="Column name does not exist",this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++}else this.DisplayMessage="Document name does not exist",this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++;if(0==m||h==u)h=u,t+="<Row ",t+=' DocID="'+c+'" ',t+=' ColID="'+n+'" ',t+=this.sbQuery.toString(),t+=o.toString(),t+="/>",this.ExcelTable[m].xIMP_STATUSx="PASS";else{this.DisplayMessage="";let T=0;if(this.IsUpdate&&(T=this.ReturnTaxProfileIDBasedOnName(h,T),T<=0)){this.DisplayMessage="Profile with "+h+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage});continue}if(""==this.DisplayMessage){let d,S;t.Insert(0,"<XML>"),t+="</XML>",S=this.oChart.SetTaxChartNew(T<=0&&!this.IsUpdate?0:T,h,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=S,d<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage}),m--}h=u,t=""}}if(t.length>0){let c,n,m=0;this.IsUpdate&&(m=this.ReturnTaxProfileIDBasedOnName(h,m),m<=0&&(this.DisplayMessage="Profile with "+h+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage}))),t.Insert(0,"<XML>"),t+="</XML>",n=this.oChart.SetTaxChartNew(this.ProfileID<=0&&!this.IsUpdate?0:m,h,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=n,c<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage})}this.ListVisbility=this.FailedRecourdList.length>0}UniqueDimensionFill(){let e=null,s=[];for(let i of this.grData.Table)if(null!=i[1]&&""!=i[1].toString()&&"0"!=i[1].toString()&&(this.CostCenterID=parseInt(i.FeatureFieldName),this.CostCenterID>0&&!s.includes(this.CostCenterID)&&(2==this.CostCenterID||3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(i[0].toString()+"_Key")||this.ExcelTable.push(i[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var l=this.grData.Table.filter(h=>h.FeatureFieldName==u);if(!(l.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!s.includes(u)){this.ExcelTable.includes(l[0][0].toString()+"_Key")||this.ExcelTable.push(l[0][0].toString()+"_Key");let t="";for(let r=0;r<this.ExcelTable.length;r++)""!=t&&(t+=","),t+="'"+k.Dw.GetValidXml(this.ExcelTable[r][l[0][0].toString()])+"'";let o=I.d.document.GetCCValues(t,u,this.IsCode?1:0);s.push(u,o)}this.ExcelTable.includes("UniqDim")||this.ExcelTable.push("UniqDim");let h="";for(let t=0;t<this.ExcelTable.length;t++)e=s[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][l[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=h&&(h+=" or "),3==this.CostCenterID?h+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?h+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(h+=" ("+(this.IsCode?"Code":"Name")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].UniqDim=e[0].ID.toString());if(""!=h){let o=I.d.document.GetCCValues(h,this.CostCenterID,"ccnid"+(u-5e4));s.push(this.CostCenterID,o)}}}else{let h="";for(let o=0;o<this.ExcelTable.length;o++)""!=h&&(h+=","),h+="'"+k.Dw.GetValidXml(this.ExcelTable[o][i[0].toString()])+"'";let t=I.d.document.GetCCValues(h,this.CostCenterID,this.IsCode?1:0);s.push(this.CostCenterID,t)}}for(let i=0;i<this.ExcelTable.length;i++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let h=parseInt(u.FeatureFieldName);if(h>0&&(2==h||3==h||11==h||h>5e4)&&s.Contains(h)&&null!=s[h]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[i][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[i][u[0].toString()].Trim().replace("'","''")+"'",s[h].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[i].UniqDim.toString()),e=s[h].Select(t),null!=e&&e.length>0&&(this.ExcelTable[i][u[0].toString()+"_Key"]=e[0].ID.toString())}}}FreeUniqueDimensionFill(){let e=null,s=[];for(let i of this.grData.Table)if(null!=i[1]&&""!=i[1].toString()&&"0"!=i[1].toString()&&(this.CostCenterID=-parseInt(i.FeatureFieldName),this.CostCenterID>0&&!s.Contains(this.CostCenterID)&&(3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(i[0].toString()+"_Key")||this.ExcelTable.push(i[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var l=this.grData.Table.filter(h=>h.FeatureFieldName=="-"+u);if(!(l.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!s.Contains(u)){this.ExcelTable.includes(l[0][0].toString()+"_Key")||this.ExcelTable.push(l[0][0].toString()+"_Key");let t="";for(let r=0;r<this.ExcelTable.length;r++)""!=t&&(t+=","),t+="'"+k.Dw.GetValidXml(this.ExcelTable[r][l[0][0].toString()])+"'";let o=I.d.document.GetCCValues(t,u,this.IsCode?1:0);s.push(u,o)}this.ExcelTable.includes("FreeUniqDim")||this.ExcelTable.push("FreeUniqDim");let h="";for(let t=0;t<this.ExcelTable.length;t++)e=s[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][l[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=h&&(h+=" or "),3==this.CostCenterID?h+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?h+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(h+=" ("+(this.IsCode?"Code":"Name")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][i[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].FreeUniqDim=e[0].ID.toString());if(""!=h){let o=I.d.document.GetCCValues(h,this.CostCenterID,"ccnid"+(u-5e4));s.push(this.CostCenterID,o)}}}else{let h="";for(let o=0;o<this.ExcelTable.length;o++)""!=h&&(h+=","),h+="'"+k.Dw.GetValidXml(this.ExcelTable[o][i[0].toString()])+"'";let t=I.d.document.GetCCValues(h,this.CostCenterID,this.IsCode?1:0);s.push(this.CostCenterID,t)}}for(let i=0;i<this.ExcelTable.length;i++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let h=-parseInt(u.FeatureFieldName);if(h>0&&(3==h||11==h||h>5e4)&&s.Contains(h)&&null!=s[h]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[i][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[i][u[0].toString()].Trim().replace("'","''")+"'",s[h].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[i].FreeUniqDim.toString()),e=s[h].Select(t),null!=e&&e.length>0&&(this.ExcelTable[i][u[0].toString()+"_Key"]=e[0].ID.toString())}}}ImportDimensionWisePriceChart(){let e=this.costCenterTableZero,s=[],l=null;for(let F=0;F<this.ExcelTable.length;F++)l=this.grData.Table.filter(y=>y.FieldName==this.ExcelTable[F]&&-5e4==y.FieldName),l.length>0&&s.push(this.ExcelTable[F].ColumnName,this.ExcelTable[F].DataType);if(l=this.grData.Table.filter(F=>5e4==F.FieldName),l.length>0)for(let F=0;F<l.length;F++)parseInt(l[F][1].toString())<-5e4&&(e.filter(y=>y.CostCenterColID==l[F][1].toString()),e.length>0&&!s.includes(e[0].SysColumnName.toString())&&(s.push(e[0].SysColumnName.toString()),s.push(e[0].SysColumnName.toString()+"_Value",typeof parseFloat)));let i=null,u=null,h=!0;for(let F=0;F<this.ExcelTable.length;F++){i={};for(let y of this.grData.Table)null==y[1]||""==y[1].toString()||"0"==y[1].toString()||parseInt(y[1].toString())>-5e4&&(i[y.FieldName.toString()]=this.ExcelTable[F][y.FieldName.toString()]);h=!0;for(let y=0;y<this.ExcelTable.length;y++)l=this.grData.Table.filter(C=>C.FieldName==this.ExcelTable[y]&&-5e4==C.FeatureFieldName),l.length>0&&(h=!1,this.grData.Table.filter(C=>C.CostCenterColID==l[0][1].toString()),i[e[0].SysColumnName.toString()]=this.ExcelTable[y].ColumnName,i[e[0].SysColumnName.toString()+"_Value"]=this.ExcelTable[F][l[0].FieldName.toString()],s.push(i.ItemArray));h&&s.push(i.ItemArray)}for(let F=0;F<this.ExcelTable.length;F++){l=this.grData.Table.filter(y=>y.FieldName==this.ExcelTable[F]&&y.FeatureFieldName<-5e4);for(let y=0;y<l.length;y++)this.grData.Table.Remove(l[y]);""!=e[0].SysColumnName.toString()&&0==this.grData.Table.filter(y=>y.FieldName==e[0].SysColumnName.toString()).length&&(u={},u.FieldName=e[0].SysColumnName.toString(),u.FeatureFieldName=-parseInt(e[0].CostCenterColID.toString()),this.grData.Table.push(u))}this.UniqueDimensionFill();let t="",o="",r="";if(this.grData.Table.filter(F=>"3"==F.FeatureFieldName))return this.DisplayMessage="Product Not Exists",void(this.MessageVisibility=!0);let m=null;if(this.ExcelTable.filter(F=>F.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0&&(m=this.ExcelTable.filter(F=>F.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0),null==m)return this.DisplayMessage="Enter valid data",void(this.MessageVisibility=!0);if(this.grData.Table.filter(F=>"-1"==F.FeatureFieldName).length>0&&(t=this.grData.Table.filter(F=>"-1"==F.FeatureFieldName)[0].FieldName.toString()),""==t)return this.DisplayMessage="Profile Name Not Exists",void(this.MessageVisibility=!0);m.Sort="["+t+"]",this.grData.Table.filter(F=>"-4"==F.FeatureFieldName).length>0&&(o=this.grData.Table.filter(F=>"-4"==F.FeatureFieldName)[0].FieldName.toString());let c="",n="",a=0,g=0,T="",d=new Date;for(let F=0;F<m.length;F++,this.ProgressValue++){c=n,n=m[F][t].toString(),c!=n&&F>0&&(this.SavePriceChart(T,c)<=0?(g++,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage})):a++,this.ImportedCount="Imported :"+a.toString(),this.FailedCount="Failed :"+g.toString(),T=""),""!=o&&(e.filter(y=>y.SysColumnName==m[F][o].toString()||y.UserColumnName==m[F][o].toString()),e.length>0&&(r=e[0].SysColumnName.toString())),T+="<Row ";for(let y of this.grData.Table)if(null!=y[1]&&""!=y[1].toString()&&"0"!=y[1].toString()&&(e.filter(C=>C.CostCenterColID==y[1].toString()),e.length>0))if(""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID)>0){if(T+=e[0].SysColumnName.toString()+'="'+m[F][y.FieldName.toString()+"_Key"].toString()+'" ',m.Table.Columns.Contains(y.FieldName.toString()+"_Value")&&!N.J0.IsEmpty(r)){let C=m[F][y.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(C))return this.DisplayMessage=y.FieldName.toString()+" "+m[F][y.FieldName.toString()+"_Value"].toString().Trim()+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=r+'="'+C+'" '}}else if(0==N.J0.stringCompare(e[0].SysColumnName.toString(),"PriceType",!0))""==m[F][y.FieldName.toString().Trim()]||"ALL"!=m[F][y.FieldName.toString().Trim()].toUpperCase()&&"A"!=m[F][y.FieldName.toString().Trim()]&&"0"!=m[F][y.FieldName.toString().Trim()]?""==m[F][y.FieldName.toString().Trim()]||"SALE"!=m[F][y.FieldName.toString().Trim()].toUpperCase()&&"S"!=m[F][y.FieldName.toString().Trim()]&&"1"!=m[F][y.FieldName.toString().Trim()]?""==m[F][y.FieldName.toString().Trim()]||"PURCHASE"!=m[F][y.FieldName.toString().Trim()].toUpperCase()&&"P"!=m[F][y.FieldName.toString().Trim()]&&"2"!=m[F][y.FieldName.toString().Trim()]?""!=m[F][y.FieldName.toString().Trim()]&&("REORDER LEVEL"==m[F][y.FieldName.toString().Trim()].toUpperCase()||"RL"==m[F][y.FieldName.toString().Trim()]||"3"==m[F][y.FieldName.toString().Trim()])&&(T+=' Type="3" '):T+=' Type="2" ':T+=' Type="1" ':T+=' Type="0" ';else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let C=m[F][y.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(C))return this.DisplayMessage=y.FieldName.toString()+" "+m[F][y.FieldName.toString().Trim()]+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=e[0].SysColumnName.toString()+'="'+C+'" '}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){if(d=m[F][y.FieldName.toString().Trim()],!N.J0.isValidDate(d))return this.DisplayMessage=y.FieldName.toString()+" "+m[F][y.FieldName.toString().Trim()]+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=e[0].SysColumnName.toString()+'="'+d.toLocaleDateString("dd MMM yyyy")+'" '}T+=" />"}this.SavePriceChart(T,c)<=0?(g++,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage})):a++,this.ImportedCount="Imported :"+a.toString(),this.FailedCount="Failed :"+g.toString(),this.DisplayMessage="Import completed ( Total :"+(g+a).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SavePriceChart(e,s){if(e.length>0){e.Insert(0,"<XML>"),e+="</XML>";try{let i=new ft.T,u=0;try{this.IsUpdate&&(u=this.ReturnProfileIDBasedOnName(s,u))}catch(h){Logger.ErrorLog("Error Save Price chart message ="+h.Message)}this.DisplayMessage=i.SetPriceChartNew(u,s,0,!1,e.toString(),"",0,!0),this.FailedRecourdList.push({Name:s,Message:this.DisplayMessage})}catch{}}return 0}ReturnProfileIDBasedOnName(e,s){let l=I.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCPrices WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&""!=l.Tables[0][0][0].toString()&&(s=parseInt(l.Tables[0][0][0])),s}ReturnTaxProfileIDBasedOnName(e,s){let l=I.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCTaxes WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&""!=l.Tables[0][0][0].toString()&&(s=parseInt(l.Tables[0][0][0])),s}CheckCostCenterFieldName(e,s,l,i,u){if(!this.ccdv.includes(s)){let t=I.d.document.GetCostCenterDetailsBYCostCenterID(s,"").Tables[0];this.ccdv.push(s,t)}if(this.IsCode?11==s?(""!=i&&this.IsCode&&(this.ccdv[s].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and ProductCode='"+this.ExcelTable[e][i].toString().Trim().replace("'","''")+"'"),0==this.ccdv[s].length&&(this.ccdv[s].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and (ProductCode is null or ProductCode='DynamicSet')")):this.ccdv[s].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"'":11==s?(""!=i&&(this.ccdv[s].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and ProductName='"+this.ExcelTable[e][i].toString().Trim().replace("'","''")+"'"),0==this.ccdv[s].length&&(this.ccdv[s].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and (ProductName is null or ProductName='DynamicSet')")):this.ccdv[s].RowFilter="Name='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"'",this.ccdv[s].length>0){if(3==s)"FreeProduct"==i?this.ExcelTable[e].FPID=this.ccdv[s][0].NodeID:(this.ExcelTable[e].PID=this.ccdv[s][0].NodeID,this.sbQuery+='ProductID="'+this.ccdv[s][0].NodeID+'" ');else if(2==s)this.sbQuery+='AccountID="'+this.ccdv[s][0].NodeID+'" ';else if(11==s)this.sbQuery+='UOMID="'+this.ccdv[s][0].NodeID+'" ';else if(12==s)this.sbQuery+='CurrencyID="'+this.ccdv[s][0].NodeID+'" ';else if(u)this.sbQuery+="CCNID"+s-5e4+'="'+this.ccdv[s][0].NodeID+'" ';else if(45==parseInt(this.Feature.SelectedValue)){this.TaxCCUpdate+=",CCNID"+(s-5e4)+"="+this.ccdv[s][0].NodeID;var h="CC"+(s-5e4);this.IsUpdate&&(this.sbQuery+=h+'="'+this.ccdv[s][0].NodeID+'" ')}else this.sbQuery+=h-5e4+'="'+this.ccdv[s][0].NodeID+'" ';return!0}return!1}ReturnAssets(){return I.d.document.GetDataSet("select AssetID,AssetCode,AssetName,GUID from ACC_Assets WITH(NOLOCK)")}ImportAssets(){let s,e=0,l="",i="",u="",h="",t=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let o="",r=null,m=null,c=this.objCG.GetScreenInfo(72),n=null;c.Tables.length>0&&null!=c.Tables[0]&&(n=c.Tables[0]);let T,y,a=new It(n),g=1,p="",d="",S="",F=0;this.IsUpdate&&(g=-1);for(let C=0;C<this.ExcelTable.length;C++,this.ProgressValue++){T="",p="",d="",o="",F=0;for(let x=0;x<a.lstColumn.length;x++)a.lstColumn[x].ActualValue="";for(let x=0;x<this.grData.Table.length;x++)null==this.grData.Table[x].FeatureFieldName||""==this.grData.Table[x].FeatureFieldName.toString()||(t.filter(G=>""!==G.SysColumnName&&G.CostcenterColID.toString()===this.grData.Table[x].FeatureFieldName.toString()),t.length>0&&(S=t[0].SysColumnName.toString(),"CodePrefix"==S&&""!=this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]?this.objAsset.CodePrefix=this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]:"CodeNumber"==S&&""!=this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]?this.objAsset.CodeNumber=parseInt(this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]):a[0].SysColumnName.ActualValue="LISTBOX"==a[0].SysColumnName.UserColumnType.toUpperCase()&&a[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[C][this.grData.Table[x].FieldName.toString()+"_Key"].toString():"DATE"==a[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]?new Date(this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[C][this.grData.Table[x].FieldName.toString()]));let f=I.d.document.GetDataSet("select DeprStartValue,EstimateLife,IsDeprSchedule,CONVERT(DATETIME,OriginalDeprStartDate) OriginalDeprStartDate,PreviousDepreciation,SalvageValue,Period,Convert(DateTime,DeprStartDate) DeprStartDate,DepreciationMethod,AveragingMethod from ACC_Assets with(nolock) where AssetCode='"+a[0].AssetCode.ActualValue+"'"),b=I.d.document.GetDataSet("SELECT AD.AssetID FROM ACC_Assets A WITH(NOLOCK) JOIN ACC_AssetDepSchedule AD WITH(NOLOCK) ON A.AssetID=AD.AssetID WHERE A.AssetCode='"+a[0].AssetCode.ActualValue+"' AND AD.VoucherNo IS NOT NULL");if(""!=a[0].WarrantyNo.ActualValue&&(a[0].WarrantyNo.ActualValue="Yes"==a[0].WarrantyNo.ActualValue?"1":"2"),""!=a[0].IsDeprSchedule.ActualValue?a[0].IsDeprSchedule.ActualValue="Yes"==a[0].IsDeprSchedule.ActualValue?"1":"0":this.IsUpdate&&""==a[0].IsDeprSchedule.ActualValue&&null!=f&&f.length>0&&(a[0].IsDeprSchedule.ActualValue=f.Rows[0].IsDeprSchedule.toString()),""!=a[0].DepreciationMethod.ActualValue?a[0].DepreciationMethod.ActualValue="Straight Line"==a[0].DepreciationMethod.ActualValue||"Straight Line Method"==a[0].DepreciationMethod.ActualValue?"1":"2":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DepreciationMethod.ActualValue&&(a[0].DepreciationMethod.ActualValue=f.Rows[0].DepreciationMethod.toString()),""!=a[0].Period.ActualValue?a[0].Period.ActualValue="Yearly"==a[0].Period.ActualValue?"2":"1":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].Period.ActualValue&&(a[0].Period.ActualValue=f.Rows[0].Period.toString()),""!=a[0].AveragingMethod.ActualValue?a[0].AveragingMethod.ActualValue="None"==a[0].AveragingMethod.ActualValue?"1":"2":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].AveragingMethod.ActualValue&&(a[0].AveragingMethod.ActualValue=f.Rows[0].AveragingMethod.toString()),""!=a[0].IncludeSalvageInDepr.ActualValue&&(a[0].IncludeSalvageInDepr.ActualValue="Yes"==a[0].IncludeSalvageInDepr.ActualValue?"1":"2"),""!=a[0].IsMainCovered.ActualValue&&(a[0].IsMainCovered.ActualValue="Yes"==a[0].IsMainCovered.ActualValue?"1":"2"),""!=a[0].IsInsCovered.ActualValue&&(a[0].IsInsCovered.ActualValue="Yes"==a[0].IsInsCovered.ActualValue?"1":"2"),""!=a[0].InsType.ActualValue&&("Quarterly"==a[0].InsType.ActualValue?a[0].InsType.ActualValue="1":"Half-Yearly"==a[0].InsType.ActualValue?a[0].InsType.ActualValue="2":("Anually"==a[0].InsType.ActualValue||"Yearly"==a[0].InsType.ActualValue)&&(a[0].InsType.ActualValue="3")),this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DeprStartDate.ActualValue?s=new Date(f.Rows[0].DeprStartDate).toLocaleDateString("dd MMM yyyy"):this.IsUpdate||""!=a[0].DeprStartDate.ActualValue?""!=a[0].DeprStartDate.ActualValue&&(s=new Date(a[0].DeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")):(a[0].DeprStartDate.ActualValue=" convert(float,convert(datetime,'"+new Date("dd MMM yyyy")+"'))",s=new Date("dd MMM yyyy")),this.IsUpdate||""!=a[0].DeprEndDate.ActualValue)this.IsUpdate||""!=a[0].EstimateLife.ActualValue?this.IsUpdate&&""==a[0].EstimateLife.ActualValue&&null!=f&&f.length>0&&(a[0].EstimateLife.ActualValue=f.Rows[0].EstimateLife.toString()):a[0].EstimateLife.ActualValue=bt.D.CalculateEstimateLife(new Date(s),""!=a[0].DeprEndDate.ActualValue?new Date(l):new Date(a[0].DeprEndDate.ActualValue));else if(""!=a[0].EstimateLife.ActualValue){let x=a[0].EstimateLife.ActualValue.split(".");y=x[0],parseInt(y)?(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(s).AddYears(y).toString()+"'))",l=new Date(s).AddYears(y).toString()):(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(s).toString()+"'))",l=new Date(s).toString()),x.length>1&&N.J0.DoubleTryParse(y)&&(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).AddMonths(y).toString()+"'))",l=new Date(l).AddMonths(y).toString()),x.length>2&&N.J0.DoubleTryParse(y)&&(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).AddDays(y).toString()+"'))",l=new Date(l).AddDays(y).toString()),a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).toLocaleDateString("dd MMM yyyy")+"'))"}!this.IsUpdate&&""==a[0].ParentAssetID.ActualValue&&(a[0].ParentAssetID.ActualValue="1",m=I.d.document.GetDataSet("select * from ACC_Assets A with(nolock) where A.AssetID="+a[0].ParentAssetID.ActualValue),m.length>0&&(""!=m.Rows[0].ClassID.toString()&&(a[0].ClassID.UserDefaultValue=m.Rows[0].ClassID.toString()),a[0].PostingGroupID.UserDefaultValue=null!=m.Rows[0].PostingGroupID?m.Rows[0].PostingGroupID.toString():"0",a[0].DeprBookID.UserDefaultValue=m.Rows[0].DeprBookID.toString())),""!=a[0].ClassID.ActualValue?(I.d.document.GetAssetNodeID(2,a[0].ClassID.ActualValue,this.IsCode),F>0&&(a[0].ClassID.ActualValue=F.toString())):this.IsUpdate||(a[0].ClassID.ActualValue=a[0].ClassID.UserDefaultValue),""!=a[0].ClassID.ActualValue?(this.objAsset.AssetClassID=parseInt(a[0].ClassID.ActualValue),r=lt.V.GetAssetClassDetails(this.objAsset.AssetClassID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].PostingGroupID.UserDefaultValue=null!=r.Tables[0][0].FAAccountsID&&null!=r.Tables[0][0].FAAccountsID?r.Tables[0][0].FAAccountsID.toString():"0",a[0].DeprBookID.UserDefaultValue=null!=r.Tables[0][0].DeprBookID?r.Tables[0][0].DeprBookID.toString():"0",a[0].Period.UserDefaultValue=r.Tables[0][0].DeprPosting.toString(),a[0].EstimateLife.UserDefaultValue=null!=r.Tables[0][0].TotalYears?r.Tables[0][0].TotalYears.toString():"0")):this.IsUpdate||(a[0].ClassID.ActualValue="1"),!this.IsUpdate&&""==a[0].PostingGroupID.ActualValue&&(a[0].PostingGroupID.ActualValue=a[0].PostingGroupID.UserDefaultValue),""!=a[0].PostingGroupID.ActualValue&&(this.objAsset.PostingGroupID=parseInt(a[0].PostingGroupID.ActualValue),r=lt.V.GetPostingGroupDetails(this.objAsset.PostingGroupID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].AcqnCostACCID.UserDefaultValue=null!=r.Tables[0][0].AcqnCostACCID?r.Tables[0][0].AcqnCostACCID.toString():"0",a[0].DeprExpenseACCID.UserDefaultValue=null!=r.Tables[0][0].DeprExpenseACCID?r.Tables[0][0].DeprExpenseACCID.toString():"0",a[0].AccumDeprACCID.UserDefaultValue=null!=r.Tables[0][0].AccumDeprACCID?r.Tables[0][0].AccumDeprACCID.toString():"0",a[0].AccumDeprDispACCID.UserDefaultValue=null!=r.Tables[0][0].AccumDeprDispACCID?r.Tables[0][0].AccumDeprDispACCID.toString():"0",a[0].AcqnCostDispACCID.UserDefaultValue=null!=r.Tables[0][0].AcqnCostDispACCID?r.Tables[0][0].AcqnCostDispACCID.toString():"0",a[0].GainsDispACCID.UserDefaultValue=null!=r.Tables[0][0].GainsDispACCID?r.Tables[0][0].GainsDispACCID.toString():"0",a[0].LossDispACCID.UserDefaultValue=null!=r.Tables[0][0].LossDispACCID?r.Tables[0][0].LossDispACCID.toString():"0",a[0].MaintExpenseACCID.UserDefaultValue=null!=r.Tables[0][0].MaintExpenseACCID?r.Tables[0][0].MaintExpenseACCID.toString():"0")),""!=a[0].DeprBookID.ActualValue?(I.d.document.GetAssetNodeID(4,a[0].DeprBookID.ActualValue,this.IsCode),F>0&&(a[0].DeprBookID.ActualValue=F.toString())):this.IsUpdate||(a[0].DeprBookID.ActualValue=a[0].DeprBookID.UserDefaultValue),""!=[0].DeprBookGroupID.ActualValue&&F>0&&F.toString(),""!=a[0].DeprBookID.ActualValue&&(this.objAsset.DeprBookID=parseInt(a[0].DeprBookID.ActualValue),r=lt.V.GetDeprBookDetails(this.objAsset.DeprBookID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].DepreciationMethod.UserDefaultValue=r.Tables[0][0].DeprBookMethod.toString(),a[0].AveragingMethod.UserDefaultValue=r.Tables[0][0].AveragingMethod.toString(),g=parseInt(r.Tables[0][0].SalvageValueType.toString()),r.Tables[0][0].SalvageValue.toString(),a[0].IncludeSalvageInDepr.UserDefaultValue=(0,B.yG0)(r.Tables[0][0].IncludeSalvageInDepr)?"1":"0"));for(let x=0;x<a.lstColumn.length;x++)""==a.lstColumn[x].ActualValue&&""!=a.lstColumn[x].UserDefaultValue&&!this.IsUpdate&&(a.lstColumn[x].ActualValue=a.lstColumn[x].UserDefaultValue),a.lstColumn[x].SysColumnName.toLowerCase().Contains("ccnid")?""==a.lstColumn[x].ActualValue?this.IsUpdate||(p+=a.lstColumn[x].SysColumnName+" ='1', "):p+=a.lstColumn[x].SysColumnName+" ='"+a.lstColumn[x].ActualValue+"', ":a.lstColumn[x].SysColumnName.toLowerCase().Contains("alpha")&&(Number(a.lstColumn[x].ColumnCostCenterID)>0?""!=a.lstColumn[x].ActualValue&&(d+=a.lstColumn[x].SysColumnName+" ='"+a.lstColumn[x].ActualValue+"', "):""!=a.lstColumn[x].ActualValue&&(d+=a.lstColumn[x].SysColumnName+" =N'"+a.lstColumn[x].ActualValue+"', "));if(this.IsUpdate&&null!=f&&f.length>0&&""==a[0].PreviousDepreciation.ActualValue&&(a[0].PreviousDepreciation.ActualValue=f.Rows[0].PreviousDepreciation.toString()),"0"==a[0].DeprStartValue.ActualValue?a[0].DeprStartValue.ActualValue=(parseFloat(a[0].PurchaseValue.ActualValue)-parseFloat(a[0].PreviousDepreciation.ActualValue)).toString():this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DeprStartValue.ActualValue&&(a[0].DeprStartValue.ActualValue=f.Rows[0].DeprStartValue.toString()),""!=a[0].SerialNo.ActualValue&&(o+=" SerialNo=N'"+a[0].SerialNo.ActualValue+"',"),""!=a[0].ClassID.ActualValue&&(o+=" ClassID=N'"+a[0].ClassID.ActualValue+"',"),""!=a[0].PostingGroupID.ActualValue&&(o+=" PostingGroupID=N'"+a[0].PostingGroupID.ActualValue+"',"),""!=[0].DeprBookGroupID.ActualValue&&(o+=" DeprBookGroupID=N'"+[0].DeprBookGroupID.ActualValue+"',"),""!=a[0].TotalQtyPurchase.ActualValue&&(o+=" TotalQtyPurchase=N'"+a[0].TotalQtyPurchase.ActualValue+"',"),""!=a[0].LocationID.ActualValue&&(o+=" LocationID=N'"+a[0].LocationID.ActualValue+"',"),""!=a[0].EmployeeID.ActualValue&&(o+=" EmployeeID=N'"+a[0].EmployeeID.ActualValue+"',"),""!=a[0].Description.ActualValue&&(o+=" Description=N'"+a[0].Description.ActualValue+"',"),""!=a[0].DeprBookID.ActualValue&&(o+=" DeprBookID=N'"+a[0].DeprBookID.ActualValue+"',"),""!=a[0].IsDeprSchedule.ActualValue&&(o+=" IsDeprSchedule=N'"+a[0].IsDeprSchedule.ActualValue+"',"),""!=a[0].DepreciationMethod.ActualValue&&(o+=" DepreciationMethod=N'"+a[0].DepreciationMethod.ActualValue+"',"),""!=a[0].Period.ActualValue&&(o+=" Period=N'"+a[0].Period.ActualValue+"',"),""!=a[0].AveragingMethod.ActualValue&&(o+=" AveragingMethod=N'"+a[0].AveragingMethod.ActualValue+"',"),g>=1&&(o+=" SalvageValueType=N'"+g+"',"),g>=0&&(o+=1==g?" SalvageValueName=N'Value*',":" SalvageValueName=N'Percentage',"),""!=[0].SalvageValue.ActualValue&&(o+=" SalvageValue=N'"+[0].SalvageValue.ActualValue+"',"),""!=a[0].EstimateLife.ActualValue&&(o+=" EstimateLife=N'"+a[0].EstimateLife.ActualValue+"',"),""!=a[0].IncludeSalvageInDepr.ActualValue&&(o+=" IncludeSalvageInDepr=N'"+a[0].IncludeSalvageInDepr.ActualValue+"',"),""!=a[0].DeprStartDate.ActualValue&&(o+=" DeprStartDate= convert(float,convert(datetime,'"+new Date(s).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].OriginalDeprStartDate.ActualValue&&(o+=" OriginalDeprStartDate= convert(float,convert(datetime,'"+new Date(a[0].OriginalDeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].DeprEndDate.ActualValue&&(a[0].DeprEndDate.ActualValue.Contains("convert")?o+=" DeprEndDate="+a[0].DeprEndDate.ActualValue+",":o+=" DeprEndDate= convert(float,convert(datetime,'"+new Date(a[0].DeprEndDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].PurchaseInvoiceNo.ActualValue&&(o+=" PurchaseInvoiceNo=N'"+a[0].PurchaseInvoiceNo.ActualValue+"',"),""!=a[0].PurchaseDate.ActualValue&&(o+=" PurchaseDate= convert(float,convert(datetime,'"+new Date(a[0].PurchaseDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].SupplierAccountID.ActualValue&&(o+=" SupplierAccountID=N'"+a[0].SupplierAccountID.ActualValue+"',"),""!=a[0].UOM.ActualValue&&(o+=" UOM=N'"+a[0].UOM.ActualValue+"',"),""!=a[0].PurchaseValue.ActualValue&&(o+=" PurchaseValue=N'"+a[0].PurchaseValue.ActualValue+"',"),""!=a[0].DeprStartValue.ActualValue&&(o+=" DeprStartValue=N'"+a[0].DeprStartValue.ActualValue+"',"),""!=a[0].PreviousDepreciation.ActualValue&&(o+=" PreviousDepreciation=N'"+a[0].PreviousDepreciation.ActualValue+"',"),""!=a[0].WarrantyNo.ActualValue&&(o+=" WarrantyNo=N'"+a[0].WarrantyNo.ActualValue+"',"),""!=a[0].WarrantyExpiryDate.ActualValue&&(o+=" WarrantyExpiryDate=N'"+a[0].WarrantyExpiryDate.ActualValue+"',"),""!=a[0].PONo.ActualValue&&(o+=" PONo=N'"+a[0].PONo.ActualValue+"',"),""!=a[0].PODate.ActualValue&&(o+=" PODate= convert(float,convert(datetime,'"+a[0].PODate.ActualValue+"')),"),""!=a[0].GRNNo.ActualValue&&(o+=" GRNNo=N'"+a[0].GRNNo.ActualValue+"',"),""!=a[0].GRNDate.ActualValue&&(o+=" GRNDate="+a[0].GRNDate.ActualValue+","),""!=a[0].CapitalizationNo.ActualValue&&(o+=" CapitalizationNo=N'"+a[0].CapitalizationNo.ActualValue+"',"),""!=a[0].CapitalizationDate.ActualValue&&(o+=" CapitalizationDate=N'"+a[0].CapitalizationDate.ActualValue+"',"),""!=a[0].IsMainCovered.ActualValue&&(o+=" IsMainCovered=N'"+a[0].IsMainCovered.ActualValue+"',"),""!=a[0].MaintStartDate.ActualValue&&(o+=" MaintStartDate="+a[0].MaintStartDate.ActualValue+","),""!=a[0].MaintExpiryDate.ActualValue&&(o+=" MaintExpiryDate="+a[0].MaintExpiryDate.ActualValue+","),""!=a[0].NextServiceDate.ActualValue&&(o+=" NextServiceDate="+a[0].NextServiceDate.ActualValue+","),""!=a[0].MainVendorAccID.ActualValue&&(o+=" MainVendorAccID=N'"+a[0].MainVendorAccID.ActualValue+"',"),""!=a[0].InsVendorAccID.ActualValue&&(o+=" InsVendorAccID=N'"+a[0].InsVendorAccID.ActualValue+"',"),""!=a[0].IsInsCovered.ActualValue&&(o+=" IsInsCovered=N'"+a[0].IsInsCovered.ActualValue+"',"),""!=a[0].InsEffectiveDate.ActualValue&&(o+=" InsEffectiveDate="+a[0].InsEffectiveDate.ActualValue+","),""!=a[0].InsExpiryDate.ActualValue&&(o+=" InsExpiryDate="+a[0].InsExpiryDate.ActualValue+","),""!=a[0].InsType.ActualValue&&(o+=" InsType=N'"+a[0].InsType.ActualValue+"',"),""!=a[0].InsPolicyNo.ActualValue&&(o+=" InsPolicyNo=N'"+a[0].InsPolicyNo.ActualValue+"',"),""!=a[0].InsPremium.ActualValue&&(o+=" InsPremium=N'"+a[0].InsPremium.ActualValue+"',"),""!=a[0].PolicyCoverage.ActualValue&&(o+=" PolicyCoverage=N'"+a[0].PolicyCoverage.ActualValue+"',"),""!=[0].AcqnCostACCID.ActualValue?o+=" AcqnCostACCID=N'"+[0].AcqnCostACCID.ActualValue+"',":this.IsUpdate||(o+=" AcqnCostACCID=N'0',"),""!=a[0].DeprExpenseACCID.ActualValue?o+=" DeprExpenseACCID=N'"+a[0].DeprExpenseACCID.ActualValue+"',":this.IsUpdate||(o+=" DeprExpenseACCID=N'0',"),""!=a[0].AccumDeprACCID.ActualValue?o+=" AccumDeprACCID=N'"+a[0].AccumDeprACCID.ActualValue+"',":this.IsUpdate||(o+=" AccumDeprACCID=N'0',"),""!=a[0].AccumDeprDispACCID.ActualValue?o+=" AccumDeprDispACCID=N'"+a[0].AccumDeprDispACCID.ActualValue+"',":this.IsUpdate||(o+=" AccumDeprDispACCID=N'0',"),""!=a[0].AcqnCostDispACCID.ActualValue?o+=" AcqnCostDispACCID=N'"+a[0].AcqnCostDispACCID.ActualValue+"',":this.IsUpdate||(o+=" AcqnCostDispACCID=N'0',"),""!=a[0].GainsDispACCID.ActualValue?o+=" GainsDispACCID=N'"+a[0].GainsDispACCID.ActualValue+"',":this.IsUpdate||(o+=" GainsDispACCID=N'0',"),""!=a[0].LossDispACCID.ActualValue?o+=" LossDispACCID=N'"+a[0].LossDispACCID.ActualValue+"',":this.IsUpdate||(o+=" LossDispACCID=N'0',"),""!=a[0].MaintExpenseACCID.ActualValue?o+=" MaintExpenseACCID=N'"+a[0].MaintExpenseACCID.ActualValue+"',":this.IsUpdate||(o+=" MaintExpenseACCID=N'0',"),""!=a[0].LocationID.ActualValue&&"0"!=a[0].LocationID.ActualValue&&(T+='<Row ID="0" CCID="1" NodeID="'+a[0].LocationID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),""!=a[0].EmployeeID.ActualValue&&"0"!=a[0].EmployeeID.ActualValue&&(T+='<Row ID="0" CCID="2" NodeID="'+a[0].EmployeeID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),this.IsUpdate){let x=this.ReturnAssets();if(null!=x&&x.Tables.length>0)if(this.IsCode){let G=x.Tables[0].filter(ee=>ee.AssetCode==a[0].AssetCode.ActualValue);G.length>0&&(this.objAsset.AMAssetID=parseInt(G[0].AssetID.toString()),this.objAsset.AMGUID=G[0].GUID.toString())}else{let G=x.Tables[0].filter(ee=>ee.AssetName==a[0].AssetName.ActualValue);G.length>0&&(this.objAsset.AMAssetID=parseInt(G[0].AssetID.toString()),this.objAsset.AMGUID=G[0].GUID.toString())}null==this.objAsset.AMGUID&&(this.objAsset.AMGUID=N.J0.NewGuid()),(""==a[0].PurchaseValue.ActualValue||""==a[0].ParentAssetID.ActualValue)&&(m=I.d.document.GetDataSet("select isnull(PurchaseValue,0) PurchaseValue,ParentAssetID,isnull(SerialNo,'') SerialNo from ACC_Assets A with(nolock) where A.AssetID="+this.objAsset.AMAssetID))}else this.objAsset.AMAssetID=0,this.objAsset.AMGUID=N.J0.NewGuid();this.objAsset.AMCode=a[0].AssetCode.ActualValue,this.objAsset.AMName=a[0].AssetName.ActualValue,this.objAsset.AMStatusID=1,this.objAsset.Sno=""!=a[0].SerialNo.ActualValue?a[0].SerialNo.ActualValue:""==a[0].SerialNo.ActualValue&&null!=m&&m.length>0?String(m.Rows[0].SerialNo):a[0].SerialNo.ActualValue,""!=a[0].PurchaseValue.ActualValue?this.objAsset.AMPurchaseValue=a[0].PurchaseValue.ActualValue:""==a[0].PurchaseValue.ActualValue&&m.length>0&&(this.objAsset.AMPurchaseValue=String(m.Rows[0].PurchaseValue)),""!=a[0].ParentAssetID.ActualValue?this.objAsset.AMParentAssetID=parseInt(a[0].ParentAssetID.ActualValue):""==a[0].ParentAssetID.ActualValue&&m.length>0&&(this.objAsset.AMParentAssetID=parseInt(m.Rows[0].ParentAssetID)),this.objAsset.AMGroup=!1;for(let x of this.grData.Table)null==x[1]||""==x[1].toString()||"0"==x[1].toString()||(t.filter(G=>G.CostCenterColID==G[1].toString()),t.length>0&&(this.objAsset.AMGroup=!1,0==N.J0.stringCompare(t[0].SysColumnName.toString(),"IsGroup",!0)&&(""==this.ExcelTable[C][x.FieldName.toString().Trim()]||"YES"!=this.ExcelTable[C][x.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][x.FieldName.toString().Trim()]?""!=this.ExcelTable[C][x.FieldName.toString().Trim()]&&("NO"==this.ExcelTable[C][x.FieldName.toString().Trim()].toUpperCase()||"0"==this.ExcelTable[C][x.FieldName.toString().Trim()])&&(this.objAsset.AMGroup=!1):this.objAsset.AMGroup=!0)));this.objAsset.DetailsXML=o.toString().replace("&","&amp;"),this.objAsset.ChangeValueXML="",this.objAsset.CustomFieldsQuery=d,this.objAsset.CustomCostCenterFieldsQuery=p,this.ErrorMessage="";let w=null;a[0].OriginalDeprStartDate.ActualValue.length>0?w=new Date(a[0].OriginalDeprStartDate.ActualValue):this.IsUpdate&&null!=f&&f.length>0&&0==a[0].OriginalDeprStartDate.ActualValue.length&&(w=new Date(f.Rows[0].OriginalDeprStartDate.toString()));let R=a[0].PreviousDepreciation.ActualValue;N.J0.DoubleTryParse(R);let P="";if(P=""==[0].SalvageValue.ActualValue?"0":2==g?(parseFloat([0].SalvageValue.ActualValue)*(parseFloat(a[0].DeprStartValue.ActualValue)+R)/100).toString():parseFloat([0].SalvageValue.ActualValue).toString(),this.IsUpdate&&null!=f&&f.length>0&&""==[0].SalvageValue.ActualValue&&f.Rows[0].SalvageValue.toString(),"1"==a[0].IsDeprSchedule.ActualValue?(this.objAsset.DepreciationXML=this.GetDepreciationXML(parseFloat(a[0].DeprStartValue.ActualValue),a[0].EstimateLife.ActualValue,a[0].IsDeprSchedule.ActualValue,w,R,P,a[0].Period.ActualValue,new Date(s),a[0].DepreciationMethod.ActualValue,a[0].AveragingMethod.ActualValue),this.ErrorMessage=this.objAsset.DepreciationXML):this.objAsset.DepreciationXML="",T.length>0&&(T="<XML>"+T+"</XML>"),this.objAsset.HistoryXML=T,this.objAsset.NotesXML="",i="",u="",this.objAsset.AttachmetsXML="",""!=a[0].AssetImage.ActualValue){let x=a[0].AssetImage.ActualValue;if(x.length>0){let G=x.split(";");try{x=G[0]}catch{i=""}}}if(""!=a[0].Attachments.ActualValue){let x=a[0].Attachments.ActualValue;if(x.length>0){let G=x.split(";");try{for(let ee of G);}catch{u=""}}}i.length>0&&(this.objAsset.AttachmetsXML=i),u.length>0&&(this.objAsset.AttachmetsXML+=u);let U=0;if(this.IsUpdate&&null!=b&&0==b.Tables[0].length&&!N.J0.IsEmpty(this.objAsset.DepreciationXML)&&(h=lt.V.DeleteAssetDeprSchedule(this.objAsset.AMAssetID)),U=0,0==this.ErrorMessage.length&&!h.Contains("exists")){let x=this.objAsset.SetAssetManagementDetails();this.ErrorMessage=x}U<=0&&(e++,this.FailedRecourdList.push({Name:"Code :: "+a[0].AssetCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(C+1-e).toString(),this.FailedCount="Failed :"+e.toString(),this.DisplayMessage="Import completed for Row :: "+(C+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAssetMaster(e){let s=0,l=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let i=null,u=null,h=I.d.document.GetScreenInfo(e),t=null;h.Tables.length>0&&null!=h.Tables[0]&&(t=h.Tables[0]);let o=new It(t),r="",m=0;for(let c=0;c<this.ExcelTable.length;c++,this.ProgressValue++){this.objAsset.AssetClassID=0,this.objAsset.DeprBookID=0,this.objAsset.PostingGroupID=0;for(let a=0;a<o.lstColumn.length;a++)o.lstColumn[a].ActualValue="";for(let a=0;a<this.grData.Table.length;a++)null==this.grData.Table[a].FeatureFieldName||""==this.grData.Table[a].FeatureFieldName.toString()||(l.filter(g=>""!==g.SysColumnName&&g.CostcenterColID.toString()===this.grData.Table[a].FeatureFieldName.toString()),l.length>0&&(r=l[0].SysColumnName.toString(),o[0].SysColumnName.ActualValue="LISTBOX"==o[0].SysColumnName.UserColumnType.toUpperCase()&&o[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[c][this.grData.Table[a].FieldName.toString()+"_Key"].toString():"DATE"==o[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[c][this.grData.Table[a].FieldName.toString()]?new Date(this.ExcelTable[c][this.grData.Table[a].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[c][this.grData.Table[a].FieldName.toString()],""!=o[0].SysColumnName.ActualValue&&("DeprPosting"==r?"monthly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"yearly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="2":"quarterly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="3":"halfyearly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="4"):"DeprBookID"==r||"FAAccountsID"==r?(m=0,"DeprBookID"==r?I.d.document.GetAssetNodeID(4,o[0].SysColumnName.ActualValue,this.IsCode):"FAAccountsID"==r&&I.d.document.GetAssetNodeID(3,o[0].SysColumnName.ActualValue,this.IsCode),m>0&&(o[0].SysColumnName.ActualValue=m.toString())):"StatusID"==r?(u=h.Tables[3].Select(h.Tables[3].Columns[1].ColumnName+"='"+o[0].SysColumnName.ActualValue+"' OR "+h.Tables[3].Columns[2].ColumnName+"='"+o[0].SysColumnName.ActualValue+"'"),u.length>0&&(o[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprBookMethod"==r?(u=h.Tables[4].Select(h.Tables[4].Columns[1].ColumnName+"='"+o[0].SysColumnName.ActualValue+"'"),u.length>0&&(o[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprMethodBasedOn"==r?"acquisitionvalue/total"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"percentageonacquisitionvalue"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="2"):"AveragingMethod"==r?"calendardays"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"fullmonth"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="2":"midmonth"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="3"):"SalvageValueType"==r?"value"==o[0].SysColumnName.ActualValue.toLowerCase()?o[0].SysColumnName.ActualValue="1":"percentage"==o[0].SysColumnName.ActualValue.toLowerCase()&&(o[0].SysColumnName.ActualValue="2"):"IncludeSalvageInDepr"==r&&(o[0].SysColumnName.ActualValue="yes"==o[0].SysColumnName.ActualValue.toLowerCase()||"1"==o[0].SysColumnName.ActualValue?"True":"False"))));if(this.IsUpdate){let a="";if(this.IsCode?74==e?a="select * from ACC_AssetClass with(nolock) where AssetClassCode='"+o[0].AssetClassCode.ActualValue+"'":75==e?a="select * from ACC_DeprBook with(nolock) where DeprBookCode='"+o[0].DeprBookCode.ActualValue+"'":77==e&&(a="select * from ACC_PostingGroup with(nolock) where PostGroupCode='"+o[0].PostGroupCode.ActualValue+"'"):74==e?a="select * from ACC_AssetClass with(nolock) where AssetClassName='"+o[0].AssetClassName.ActualValue+"'":75==e?a="select * from ACC_DeprBook with(nolock) where DeprBookName='"+o[0].DeprBookName.ActualValue+"'":77==e&&(a="select * from ACC_PostingGroup with(nolock) where PostGroupName='"+o[0].PostGroupName.ActualValue+"'"),i=I.d.document.GetDataSet(a),i.length>0){74==e?this.objAsset.AssetClassID=N.J0.Int(i.Rows[0][0].toString()):75==e?this.objAsset.DeprBookID=N.J0.Int(i.Rows[0][0].toString()):77==e&&(this.objAsset.PostingGroupID=N.J0.Int(i.Rows[0][0].toString())),this.objAsset.GUID=i.Rows[0].GUID.toString();for(let g=0;g<o.lstColumn.length;g++)""==o.lstColumn[g].ActualValue&&(o.lstColumn[g].ActualValue=i.Rows[0][o.lstColumn[g].SysColumnName].toString())}null==this.objAsset.GUID&&(this.objAsset.GUID=N.J0.NewGuid())}let n=0;if(74==e){this.objAsset.AssetClassCode=o[0].AssetClassCode.ActualValue.replace("&","&amp;"),this.objAsset.AssetClassName=o[0].AssetClassName.ActualValue.replace("&","&amp;"),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.PostingGroupID=N.J0.Int(o[0].FAAccountsID.ActualValue),this.objAsset.DeprBookID=N.J0.Int(o[0].DeprBookID.ActualValue),this.objAsset.DeprTypeID=N.J0.Int(o[0].DeprPosting.ActualValue),this.objAsset.TotalYears=N.J0.DoubleTryParse(o[0].TotalYears.ActualValue);let a=this.objAsset.SaveAssetClass();this.ErrorMessage=a}else if(75==e){this.objAsset.DeprBookCode=o[0].DeprBookCode.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookName=o[0].DeprBookName.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookMethod=N.J0.Int(o[0].DeprBookMethod.ActualValue),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.AveragingMethodID=N.J0.Int(o[0].AveragingMethod.ActualValue),this.objAsset.DeprBookMethodBasedOnValue=N.J0.DoubleTryParse(o[0].BasedOnValue.ActualValue),this.objAsset.DeprBookMethodBasedOn=N.J0.Int(o[0].DeprMethodBasedOn.ActualValue),""==o[0].SalvageValueType.ActualValue&&(o[0].SalvageValueType.ActualValue="1"),""==o[0].IncludeSalvageInDepr.ActualValue&&(o[0].IncludeSalvageInDepr.ActualValue="False");let a=this.objAsset.SaveDeprBook(parseInt(o[0].SalvageValueType.ActualValue),parseFloat([0].SalvageValue.ActualValue),(0,B.yG0)(o[0].IncludeSalvageInDepr.ActualValue));this.ErrorMessage=a}else 77==e&&(this.objAsset.PostGroupCode=o[0].PostGroupCode.ActualValue.replace("&","&amp;"),this.objAsset.PostGroupName=o[0].PostGroupName.ActualValue.replace("&","&amp;"),this.objAsset.AcqnCostACCID=N.J0.Int([0].AcqnCostACCID.ActualValue),this.objAsset.AccumDeprACCID=N.J0.Int(o[0].AccumDeprACCID.ActualValue),this.objAsset.AcqnCostDispACCID=N.J0.Int(o[0].AcqnCostDispACCID.ActualValue),this.objAsset.AccumDeprDispACCID=N.J0.Int(o[0].AccumDeprDispACCID.ActualValue),this.objAsset.GainsDispACCID=N.J0.Int(o[0].GainsDispACCID.ActualValue),this.objAsset.LossDispACCID=N.J0.Int(o[0].LossDispACCID.ActualValue),this.objAsset.MaintExpenseACCID=N.J0.Int(o[0].MaintExpenseACCID.ActualValue),this.objAsset.DeprExpenseACCID=N.J0.Int(o[0].DeprExpenseACCID.ActualValue),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.SaveFAPostingGroup());n<=0&&(s++,74==e?this.FailedRecourdList.push({Name:"Code :: "+o[0].AssetClassCode.ActualValue,Message:this.ErrorMessage}):75==e?this.FailedRecourdList.push({Name:"Code :: "+o[0].DeprBookCode.ActualValue,Message:this.ErrorMessage}):77==e&&this.FailedRecourdList.push({Name:"Code :: "+o[0].PostGroupCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(c+1-s).toString(),this.FailedCount="Failed :"+s.toString(),this.DisplayMessage="Import completed for Row :: "+(c+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ScanAssetCostCenterFields(e){let s=this.costCenterTableZero;for(let l=0;l<this.ExcelTable.length;l++)for(let i of this.grData.Table)if(null!=i[1]&&""!=i[1].toString()&&"0"!=i[1].toString()&&(s.filter(u=>u.CostCenterColID==i[1].toString()),s.length>0&&(null!=s[0].ColumnCostCenterID&&""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID.toString())>0&&""!=this.ExcelTable[l][i.FieldName.toString()]&&parseInt(i.FeatureFieldName)>0&&this.CheckCostCenterField(l,parseInt(s[0].ColumnCostCenterID.toString()),i.FieldName.toString(),!1,e),("UOM"==s[0].SysColumnName.toString()||"11"==s[0].ColumnCostCenterID.toString())&&(this.UomCol=this.ExcelTable[i.FieldName.toString()].ColumnName+"_Key",this.ExcelTable.Contains(this.UomCol)||(this.ExcelTable.push(this.UomCol),this.temp.push(parseInt(s[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[l][i.FieldName.toString().Trim()])))){let u=2;this.CostCenterFieldsAllTables.Tables[u].RowFilter="UnitName='"+this.ExcelTable[l][i.FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[u].length>0&&(this.ExcelTable[l][this.UomCol]=this.CostCenterFieldsAllTables.Tables[u][0].UOMID.toString())}return!0}GetDepreciationXML(e,s,l,i,u,h,t,o,r,m){this.ErrorMessage="";let n=0,a=0,g=0;try{let S=s.split(".");n=N.J0.Int(S[0]),S.length>1&&(a=N.J0.Int(S[1])),S.length>2&&(g=N.J0.Int(S[2]))}catch{}if("0"!=l&&n<=0&&a<=0&&g<=0)return e>0&&(this.ErrorMessage="Enter EstimatedLife in Depreciation Tab"),"";if(g>0&&"3"==m)return this.ErrorMessage="Mid-Month method can not be applied if estimated life provided with days.","";let p,T=o;p=T.AddYears(n),p=p.AddMonths(a),p=p.AddDays(g),p=p.AddDays(-1);let d=new bt.D(0);return d.CallFromAssetSave=!0,d.GetScheduleData(e,n,a,g,i,u,parseFloat(h),r,t,0,m,T,p,null,this.objAsset.DeprBookID.toString()),this.ErrorMessage=d.ErrorMessage,d.GetXML()}ImportUsers(){let e=[];e.push(1,"Cash"),e.push(2,"Bank"),e.push(3,"BankCC"),e.push(4,"Sales"),e.push(5,"Purchase"),e.push(6,"Creditors"),e.push(7,"Debtors"),e.push(8,"Trading Income"),e.push(9,"Trading Expense"),e.push(10,"Petty Cash"),e.push(11,"Income"),e.push(12,"Expense"),e.push(13,"Assets"),e.push(14,"Liabilities"),e.push(15,"Contra Asset"),e.push(16,"Equity");let s=[];s.push(1,"General"),s.push(2,"Serialised Items"),s.push(3,"Kit"),s.push(4,"Matrix"),s.push(5,"Batch"),s.push(6,"Service Item"),s.push(7,"Serialised & Kit"),s.push(8,"Dynamic"),s.push(9,"Assembled"),s.push(10,"Asset"),s.push(11,"Modifiers"),s.push(12,"Modifiers with Inventory");let l=[],i="";if(0==this.grData.Table.filter(x=>"22898"==x.FeatureFieldName).length)return this.DisplayMessage="UserName Not Exists",void(this.MessageVisibility=!0);let u=this.costCenterTableZero,h=null,t="",o=0,r="",m="",c="",n="",a="",g="",p="",T="",d="",S="1",F="True",y="",C=0,f=0,b=0,w=0,R=1,P=0;this.FillCostCenterFields(!1);for(let x=0;x<this.ExcelTable.length;x++,this.ProgressValue++){r="",m="",c="",a="",g="",p="",T="",d="",S="1",F="True",C=0,f=0,b=0,w=0,R=1,P=0,y="",t="",i="";for(let $=0;$<this.grData.Table.length;$++)if(null!=this.grData.Table[$].FeatureFieldName&&""!=this.grData.Table[$].FeatureFieldName.toString()&&(u.filter(j=>j.CostCenterColID===this.grData.Table[$].FeatureFieldName.toString()),u.length>0)){switch(n=u[0].SysColumnName.toString(),n){case"UserName":this.CheckCostCenterField(x,7,this.grData.Table[$].FieldName.toString(),!1,this.IsCode),r=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&""!=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()&&(C=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()),h=I.d.document.GetUsersDet(C.toString()));break;case"Password":m=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()];break;case"Email1Password":case"Email2Password":N.J0.IsEmptySpace(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])?c+=n+" =N'',":c+=n+" =N'@ENC@"+N.J0.EncryptString(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])+"',";break;case"DivisionID":this.CheckCostCenterField(x,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(w=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"LocationID":this.CheckCostCenterField(x,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(b=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"RoleID":this.CheckCostCenterField(x,6,this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(f=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"StatusID":R="in active"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()].toLowerCase()?2:1;break;case"AccountTypes":if(p=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],p.length>0){let W=p.split(";");p="";for(let le=0;le<W.length;le++)for(let de of e)W[le].toString()==de.Value&&(p+='<Row  CostCenterId="2" FeatureTypeID="'+de.Key+'"/>')}break;case"ProductTypes":if(T=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],T.length>0){let W=T.split(";");T="";for(let le=0;le<W.length;le++)for(var U of s)W[le].toString()==U.Value&&(T+='<Row  CostCenterId="3" FeatureTypeID="'+U.Key+'"/>')}break;case"LicenseCount":P=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()]);break;case"Online/Offline":F="OFFLINE"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString()].toUpperCase()?"False":"True";break;case"2StepVerificationMode":d=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()];break;case"Language":S="ENGLISH"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString()].toUpperCase()?"1":"2";break;case"UserImage":let j=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()];if(j.length>0){let W=j.split(";");try{j=W[0]}catch{g=""}}break;default:n.startsWith("Assigned_")||(null!=u[0].ColumnCostCenterID&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0?c+=n+" ='"+this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()+"',":c+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])+"',")}if(n.startsWith("Assigned_")){let j=null,W=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()],le=[];if(le.Clear(),!N.J0.IsEmpty(W)){j=W.split(",");let de=parseInt(u[0].ColumnCostCenterID.toString());this.grData.Table[$].FieldName.toString();for(let E=0;E<j.length;E++)le.push(de,I.d.document.GetCostCenterDetailsBYCostCenterID(de,"").Tables[0]),le[de].RowFilter=this.IsCode?"Code='"+j[E].toString().Trim().replace("'","''")+"'":"Name='"+j[E].toString().Trim().replace("'","''")+"'",le[de].length>0&&(y+='<Row  CostCenterId="'+de+'" NodeID="'+le[de][0].NodeID+'"/>'),le.Clear()}}}a=null!=h&&h.Tables[0].length>0?h.Tables[0][0].GUID.toString():N.J0.NewGuid(),(p.length>0||T.length>0)&&(t+="<XML>",p.length>0&&(t+=p),T.length>0&&(t+=T),t+="</XML>"),y.length>0&&(i+="<XML>",i+=y,i+="</XML>");let G=0;l.push(C),l.push(f),l.push(r),l.push(N.J0.EncryptString(m)),l.push(R),l.push(S),l.push(F),l.push(d),l.push(""),l.push("False"),l.push(c),l.push(I.d.SessionManager.CompanyIndex),l.push(i.toString()),l.push(t.toString()),l.push(""),l.push(P),l.push(""),l.push(g),l.push(""),l.push(""),l.push(b),l.push(w),l.push(N.J0.NewGuid()),l.push(a),l.push(I.d.SessionManager.UserName),l.push(I.d.SessionManager.UserID),l.push(I.d.SessionManager.RoleID),l.push(I.d.SessionManager.LanguageID);let ee=I.d.document.CreateUser(l);ee&&(G=ee.UID),l.Clear(),G<=0&&(o++,this.FailedRecourdList.push({Name:"Name : "+r,Message:this.ErrorMessage})),this.ImportedCount="Imported :"+(x+1-o).toString(),this.FailedCount="Failed :"+o.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCodeData(e,s){try{let u,h,l=this.grData.Table,i="",t=!1;for(let c of this.xDocCodeDef.DocumentElement)if(u=parseInt(c.attributes.CCCID.Value),-5==u)t=!0;else if(u>0){if(l.filter(n=>n.FeatureFieldName==c.attributes.CCCID.Value),l.length>0){let n=k.Dw.GetValidXml(e[l[0].FieldName.toString().Trim()]);if(n.length>0)if(h=c.attributes.Type.Value.toUpperCase(),"DATE"==h){let a=n;N.J0.isValidDate(a)&&(i+='<Row ColID="'+u+'" Value="'+a.toLocaleDateString("dd MMM yyyy")+'" />')}else e.includes(l[0].FieldName+"_Key")&&""!=e[l[0].FieldName+"_Key"].toString()?i+='<Row ColID="'+u+'" Value="'+e[l[0].FieldName+"_Key"].toString()+'" />':i+='<Row ColID="'+u+'" Value="'+n+'" />'}}else u<0&&(l.filter(n=>n.FeatureFieldName==c.attributes.CCCID.Value),l.length>0&&e.includes(l[0].FieldName+"_Key")&&""!=e[l[0].FieldName+"_Key"].toString()&&(i+='<Row ColID="'+u+'" Value="'+e[l[0].FieldName+"_Key"].toString()+'" />'));i.length>0&&(i.Insert(0,"<Data>"),i+="</Data>");let o=1;16!=parseInt(this.Feature.SelectedValue)||1==s?s=0:o=s,t&&0==s&&(this.costCenterTableZero.filter(c=>"ParentGroupName"==c.SysColumnName),this.costCenterTableZero.length>0&&(l.filter(c=>c.FeatureFieldName==this.costCenterTableZero[0].CostCenterColID.toString()),l.length>0&&(o=this.GetParentID(parseInt(this.Feature.SelectedValue),k.Dw.GetValidXml(e[l[0].FieldName.toString().Trim()])))));let r=!1,m=this.grData.Table.filter(c=>"IsGroup"==c.FieldName);return m.length>0&&("true"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"yes"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"y"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"1"==e[m[0].FieldName.toString().Trim()]||"on"==e[m[0].FieldName.toString().Trim()].toLowerCase())&&(r=!0),I.d.common.GetCodeData(parseInt(this.Feature.SelectedValue),o,i.toString(),!1,r)}catch(l){return Logger.ErrorLog("Import :: GetCodeData ",l),null}}GetParentID(e,s){try{let l,i;2==e?(l="AccountName",i="AccountID"):3==e?(l="ProductName",i="ProductID"):(l="Name",i="ID");let t=I.d.document.GetDataSet("declare @SQL nvarchar(500)\nselect @SQL=TableName from adm_features with(nolock) where featureid=\" + CostCenterID + @\"\nset @SQL='select \" + PK + \" ID from '+@SQL+' with(nolock) where \" + colName + \"=''\" + GroupName + @\"'''\nexec(@SQL) ");return N.J0.Int(t.Tables[0].ID.toString())}catch{return 1}}OnMessageCallBack(){this.res="Yes"}ConvertHoursToMinutes(e){let s=0,l=0,i=0;const u=e.split(":");return i=N.J0.Int(u[0]),u.length>1&&(l=N.J0.Int(u[1]),1==l.toString().length&&(l=parseInt(l.toString()+"0",10))),s=60*i+l,s}GetDailyAttendanceDetails(e,s,l,i,u,h,t,o,r){try{let m=new He.bT;this.ConstructFormulaFields(m);let c=[],n=null,a=null,g="",p="",T="";if(0==e){c.push(u.toLocaleDateString("dd/MMM/yyyy")),c.push(0),c.push(l),c.push(s),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.LanguageID);let d=I.d.common.GetDataSet_SP(c,"spPAY_ExtGetTimings");d.Tables.length>0&&(this.intValidDay=parseInt(d.Tables[0][0].VALIDDAY),this.FromDateTime=new Date(d.Tables[0][0].STARTTIME),this.ToDatetime=new Date(d.Tables[0][0].ENDTIME)),p+="dcAlpha5=N'"+d.Tables[0][0].VALIDDAY.toString()+"', ",p+="dcAlpha4=N'0', ",p+="dcAlpha10=N'1', ",p+="dcAlpha11=N'1', ",p+="dcAlpha12=N'0', ",p+="dcAlpha13=N'1', ",a=this.grData.Table,a.filter(S=>36591==S.FeatureFieldName),0==a.length&&(p+="dcAlpha2=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay.toString()+"', ",this.SetFieldValue(m,"dcAlpha2",this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay)),a.RowFilter="FeatureFieldName=36592",0==a.length&&(p+="dcAlpha3=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay.toString()+"', ",this.SetFieldValue(m,"dcAlpha3",this.ToDatetime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay)),T=p}else if(1==e){if(c.push(s),c.push(0),c.push(t),c.push(u.toLocaleDateString("dd/MMM/yyyy")),c.push(l>0?l:1),c.push(i>0?i:1),c.push(0),c.push(1),c.push(h),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.LanguageID),n=I.d.common.GetDataSet_SP(c,"spPAY_ExtCalcHours"),n.Tables.length>0){this.dblTotalHours=0;let y,C,f,b,d=null,S="",F="",w=1;if(y=C=b=f=0,d=this.costCenterTableZero,d.length>0){d.RowFilter="CostCenterColID=36561",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",f=parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())),d.RowFilter="CostCenterColID=36562",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",b=parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())),parseFloat(f)>0&&(C=this.ConvertHoursToMinutes(f.toString())*(b/60),y=C),d.RowFilter="CostCenterColID=36563",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].BREAKHRSOP.toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].BREAKHRSOP.toString().Trim())+", ");for(let R=5;R<=14;R++)b=f=C=0,F="OT"+w.toString(),S="dcNum"+R.toString(),d.RowFilter="sysColumnName='"+S+"'",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",f=parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())),F="OT"+w.toString()+"Rate",S="dcNum"+(R+1).toString(),d.RowFilter="sysColumnName='"+S+"'",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",b=parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())),parseFloat(f)>0&&(C=this.ConvertHoursToMinutes(f.toString())*(b/60),y+=C),R++,w++;d.RowFilter="CostCenterColID=36574",d.length>0&&(g+=d[0].SysColumnName.toString()+"="+parseFloat(y.toString().Trim())+", ",g+="dcCalc"+d[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(y.toString().Trim())+", ")}T=g}}else if(2==e){if("0"!=o.toString()&&"0"!=r.toString()&&(a=this.grData.Table,a.filter(d=>36560==d.FeatureFieldName),0==a.length&&(a=this.costCenterTableZero,a.RowFilter="CostCenterColID=36560",a.length>0))){let d="",S=new Date(r),F=new Date(o),y=N.J0.ParseDate(S).Subtract(N.J0.ParseDate(F));d=y.Hours+"."+y.Minutes,this.dblTotalHours=parseFloat(d),g+=a[0].SysColumnName.toString()+"="+parseFloat(d)+", ",g+="dcCalc"+a[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(d)+", "}T=g}return T.toString()}catch(m){return Logger.ErrorLog("Import :: GetDailyAttendanceDetails ",m.message),null}}UpdateExcelSheet(){if(this.UpdateStatusInExcel&&this.IsExcel&&this.ExcelTable&&0!==this.ExcelTable.length)try{const e=this.workbookK,s=e.SheetNames[0];let i=this.ExcelData,u=0,h=0,t=0;for(let r=0;r<150;r++){const m=i[0]?.[r];if("IMPORT_STATUS"===m){if(u=r,h>0)break}else if("IMPORT_MESSAGE"===m){if(h=r,u>0)break}else(!m||""===m)&&0===t&&(t=r-1)}0===u&&(t++,i[0][t]="IMPORT_STATUS",u=t),0===h&&(t++,i[0][t]="IMPORT_MESSAGE",h=t);for(let r=0;r<this.ExcelTable.length;r++){if(this.ExcelTable[r].IsNewRow&&"1"===this.ExcelTable[r].IsNewRow.toString())continue;const m=r+1;i[m]||(i[m]=[]),(!i[m][u]||"PASS"!==i[m][u])&&(i[m][u]=this.ExcelTable[r].xIMP_STATUSx||"",i[m][h]=this.ExcelTable[r].IMPORT_MESSAGE||"")}const o=et.Wp.aoa_to_sheet(i);e.Sheets[s]=o,et._h(e,this.ActualFileName)}catch(e){console.error("Error in UpdateExcelSheet:",e.message||e)}}s2ab(e){const s=new ArrayBuffer(e.length),l=new Uint8Array(s);for(let i=0;i<e.length;i++)l[i]=255&e.charCodeAt(i);return s}formatDDMMMYYYY(e){const l=e instanceof Date?e:new Date(e);return isNaN(l.getTime())?"":`${("0"+l.getDate()).slice(-2)}/${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()]}/${l.getFullYear()}`}formatMonthName(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][Math.max(1,Math.min(12,e))-1]}daysInMonth(e,s){return new Date(e,s,0).getDate()}FillBomDetails(){const e=this.Feature?.SelectedValue;[{CostCenterColID:"-1",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"RawMaterial",ResourceKey:I.d.GetResource("RawMaterial")},{CostCenterColID:"-12",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"OutPutProduct",ResourceKey:I.d.GetResource("OutPutProduct")},{CostCenterColID:"-2",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Qty",ResourceKey:I.d.GetResource("Quantity")},{CostCenterColID:"-3",ColumnCostCenterID:"11",ColumnDataType:"LISTBOX",SysColumnName:"UOMID",ResourceKey:I.d.GetResource("UOM")},{CostCenterColID:"-4",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"UnitPrice",ResourceKey:I.d.GetResource("UnitPrice  ")},{CostCenterColID:"-5",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Value",ResourceKey:I.d.GetResource("Value")},{CostCenterColID:"-6",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Wastage",ResourceKey:I.d.GetResource("Waistage")},{CostCenterColID:"-7",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"CreditAccount",ResourceKey:"Credit Account"},{CostCenterColID:"-15",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"DebitAccount",ResourceKey:"Debit Account"},{CostCenterColID:"-8",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExpenseCharges",ResourceKey:I.d.GetResource("ExpenseCharges")},{CostCenterColID:"-9",ColumnCostCenterID:"71",ColumnDataType:"LISTBOX",SysColumnName:"Machine",ResourceKey:I.d.GetResource("Machine")},{CostCenterColID:"-10",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"HRS",ResourceKey:I.d.GetResource("HRS")},{CostCenterColID:"-11",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"MachineCharges",ResourceKey:I.d.GetResource("MachineCharges")}].forEach(l=>{const i={CostCenterColID:l.CostCenterColID,CostcenterID:e,ColumnCostCenterID:l.ColumnCostCenterID,ColumnDataType:l.ColumnDataType,SysColumnName:l.SysColumnName,ResourceData:l.ResourceKey,IsColumninuse:"true",IsColumnUserDefined:"false"};this.CostCenterFieldsAllTables.push(i),this.costCenterTableZero.push(i)})}}class It{constructor(e){this.lstColumn=[];for(let s=0;s<e.length;s++){const l=e[s];this.lstColumn.push({CostCenterColID:Number(l.CostCenterColID),ResourceData:(l.ResourceData||"").toString().replace(/ /g,""),SysColumnName:(l.SysColumnName||"").toString(),UserColumnName:(l.UserColumnName||"").toString().replace(/ /g,""),ColumnDataType:(l.ColumnDataType||"").toString(),UserColumnType:(l.UserColumnType||"").toString(),UserDefaultValue:(l.UserDefaultValue||"").toString(),ActualValue:"",ColumnCostCenterID:Number(l.ColumnCostCenterID)})}}getByCostCenterColID(e){for(const s of this.lstColumn)if(s.CostCenterColID===e)return s;return null}getByCostCenterColIDAndName(e,s){for(const l of this.lstColumn)if(s&&""!==s||e>0)if(s&&""!==s&&e>0){if(l.SysColumnName===s&&l.CostCenterColID===e)return l}else if(s&&""!==s){if(l.SysColumnName===s)return l}else if(l.CostCenterColID===e)return l;return null}}class wt{ColumnsXML(e,s){let l="";return l+=8===e&&"Dimension Move"===s?"<XML>\n  <Col ID='DimensionID' Width='100' Combo='TEXT'><Caption>DimensionID**</Caption></Col>\n  <Col ID='DimensionName' Width='160' Combo='TEXT'><Caption>DimensionName**</Caption></Col>\n  <Col ID='Node' Width='160' Combo='TEXT'><Caption>Node*</Caption></Col>\n  <Col ID='Group' Width='160' Combo='TEXT'><Caption>Group*</Caption></Col>\n  <Row DimensionID='2' DimensionName='Account' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='3' DimensionName='Product' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='50002' DimensionName='Location' Node='NNNXXX' Group='GGGXXX' />\n  </XML>":400===e&&"Document Edit"===s?"<XML>\n  <Col ID='VoucherNo' Width='100' Combo='TEXT'><Caption>Doc No*</Caption></Col>\n  <Col ID='OldValue1' Width='160' Combo='TEXT'><Caption>Old Value1*</Caption></Col>\n  <Col ID='NewValue1' Width='160' Combo='TEXT'><Caption>New Value1*</Caption></Col>\n  <Col ID='OldValue2' Width='160' Combo='TEXT'><Caption>Old Value2*</Caption></Col>\n  <Col ID='NewValue2' Width='160' Combo='TEXT'><Caption>New Value2*</Caption></Col>\n  <Col ID='OldValueN' Width='160' Combo='TEXT'><Caption>Old ValueN*</Caption></Col>\n  <Col ID='NewValueN' Width='160' Combo='TEXT'><Caption>New ValueN*</Caption></Col>\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='' NewValue2='' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='' NewValueN='' />\n  </XML>":"<XML></XML>",l}BuildGrid(e,s){let l=new mt.vv;l.Columns=[],l.Table=[],l.SearchVisible=!1;let i=new ct.O7,u=new N.VB;u.LoadXml(this.ColumnsXML(e,s));for(let h of u.DocumentElement.children)if("Col"==h.Name)i=new ct.O7,i.Header=h.SelectSingleNode("Caption").InnerText,i.DisplayMember=h.attributes.ID.Value,i.ReadOnly=!0,i.Width=null!=h.attributes.Width?parseInt(h.attributes.Width.Value):160,l.Columns.push(i),l.TableColumns.push(h.attributes.ID.Value);else if("Row"==h.Name){l.NewRow();const o=h,r={};for(const m of l.TableColumns)r[m]=o.getAttribute(m);l.TableColumns.push(r)}return l.Visible=null!=l.Columns&&l.Columns.length>0,l}}},93621:(Ft,st,oe)=>{oe.d(st,{t:()=>I});var Le=oe(86739);class I{constructor(){this.CCID=0,this.Status=0,this.BudgetTypeID=0,this.BugetID=0,this.NumDimensions=0,this.QtyType=0,this.IsQtyBudget=0,this.isGroup=!1,this.ChkBudgetOnlyForDefnAccounts=!1,this.Budgetid=0,this.SelectedNodeID=0,this.SbXML=null,this.RelationsXML=null,this.BudgetName=null,this.BudgetType=null,this.CCList="",this.strNonAccountingDocs=null,this.NonAccDocsField=null,this.strInvAccountingDocs=null,this.InvAccDocsField=null,this.AccountTypes=null}GetBudgetScreenDetails(B,Tt,se=""){let k=[];return k.push(B),k.push(Tt),k.push(se),k.push(Le.d.SessionManager.UserID),k.push(Le.d.SessionManager.LanguageID),Le.d.common.GetBudgetScreenDetails(k)}SaveBudgetScreenDetails(){let B=[];return B.push(this.SbXML),B.push(this.NumDimensions),B.push(this.CCList),B.push(this.RelationsXML),B.push(this.StartYear),B.push(this.BudgetName),B.push(this.BudgetTypeID),B.push(this.BudgetType),B.push(this.Status),B.push(this.IsQtyBudget),B.push(this.Budgetid),B.push(this.SelectedNodeID),B.push(this.isGroup),B.push(this.QtyType),B.push(this.ChkBudgetOnlyForDefnAccounts),B.push(this.strNonAccountingDocs),B.push(this.NonAccDocsField),B.push(this.strInvAccountingDocs),B.push(this.InvAccDocsField),B.push(this.AccountTypes),B.push(Le.d.SessionManager.CompanyGUID),B.push(Le.d.SessionManager.UserName),B.push(Le.d.SessionManager.UserID),B.push(Le.d.SessionManager.LanguageID),Le.d.common.SaveBudgetScreenDetails(B)}SetImportBudget(){let B=[];return B.push(this.SbXML),B.push(this.NumDimensions),B.push(this.CCList),B.push(this.RelationsXML),B.push(this.StartYear),B.push(this.BudgetName),B.push(this.BudgetTypeID),B.push(this.BudgetType),B.push(this.Status),B.push(this.IsQtyBudget),B.push(this.Budgetid),B.push(this.SelectedNodeID),B.push(this.isGroup),B.push(this.QtyType),B.push(this.ChkBudgetOnlyForDefnAccounts),B.push(this.strNonAccountingDocs),B.push(this.NonAccDocsField),B.push(this.strInvAccountingDocs),B.push(this.InvAccDocsField),B.push(this.AccountTypes),B.push(this.IsAppend),B.push(Le.d.SessionManager.CompanyGUID),B.push(Le.d.SessionManager.UserName),B.push(Le.d.SessionManager.UserID),B.push(Le.d.SessionManager.LanguageID),Le.d.common.SaveBudgetScreenDetails(B)}}},39559:(Ft,st,oe)=>{oe.d(st,{h:()=>Le});class Le{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}}}]);