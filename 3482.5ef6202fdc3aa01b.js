"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3482],{3482:(Ft,st,le)=>{le.r(st),le.d(st,{DimDefinition:()=>It,ImportTemplates:()=>wt,ImportUtilityViewModel:()=>Ti,MimizField:()=>Ve,StringBuilderLike:()=>_e});var Ie=le(10467),I=le(86739),N=le(8787),j=le(32647),Tt=le(23823),ie=le(92701),k=le(31820),dt=le(49710),ct=le(18569),jt=le(48792),Ae=le(92840),ft=le(91679),lt=le(20141),He=le(95707),Kt=le(98669),Et=le(36466),ot=le(81669),et=le(62288),At=le(71336),Ue=le(62460),gt=(le(24028),le(33547)),xt=le(97965),Ct=le(39559),Jt=le(92020),Dt=le(67559),Vt=le(93621),Qt=le(26485),Rt=le(35901),Ht=le(73334),Wt=le(40008),$t=le(50742);class Yt{constructor(){this.RulesListVisible=!1,this.RulesList=[],this.NotesList=[],this.ConfirmList=[],this.NewInfo=[],this.ErrorList=[],this.ButtonClick=new ot.Yk,this.ColumnSource=[]}PreviewDataViewModel(e,i){if(this.Parent=i,this.Parent.IsScaned){if(this.TempExcelTableVisible=!1,this.Parent.NotesList.length>0){this.NotesListVisible=!0;let u,s=0;this.Parent.NotesList.forEach(h=>{u=new Ae.AddNoteViewModel,u.AddNoteViewModel_1(this),u.NoteID=s+1,u.Note.Text=h.Note.Text,u.Note.ToolTipDescription=h.Note.ToolTipDescription,u.Note.Label=h.Note.Label,u.IsModified=!0,this.NotesList.push(u)})}else this.NotesListVisible=!1;this.Parent.RulesList.length>0?(this.RulesList=this.Parent.RulesList,this.RulesListVisible=!0):this.RulesListVisible=!1,this.Parent.ErrorList.length>0?(this.ErrorList=this.Parent.ErrorList,this.ErrorListVisible=!0,this.NextEnable=!1):this.NextEnable=!0,this.Title="Confirmation",this.btnOkText="Confirm"}else this.NotesListVisible=!1,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.TempExcelTableVisible=!0,this.Title="Excel Data",this.btnOkText="Ok";let l;this.DS=[],this.ColumnSource=[],this.CostCenterFields=[],this.DS=i.grData,this.CostCenterFields=i.costCenterTableZero,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.AddColumns(e),this.TempExcelTable=this.ValidateExcelData(e),l="",this.TempExcelTable.forEach(s=>{l+=`[${s}] is null and `}),l.length>5&&(l=l.substring(0,l.length-5)),this.NoofRows="Total No. of Rows in file are "+l.length+"|"+this.TempExcelTable.length}AddColumns(e){this.TempExcelTable=[],e&&0!=e.length&&Object.keys(e[0]).forEach(l=>{let s=new $t.i;s.DisplayMember=l,s.HeaderText=l,s.width=l.includes("_Key")?"0":"100",this.ColumnSource.push(s),this.TempExcelTable.push(l)})}ValidateExcelData(e){let i=[];return i=this.CostCenterFields,e.forEach(l=>{this.DS._Table.forEach(s=>{if(null==s.FeatureFieldName||""==s.FeatureFieldName.toString()||"0"==s.FeatureFieldName.toString())return;let h,u=i.filter(t=>t.CostCenterColID=s.FeatureFieldName.toString());switch(h="",u.length>0&&(N.J0.IsEmpty(u[0].ColumnDataType)||(h=u[0].ColumnDataType.toString()),("INT"==h.toUpperCase()&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0||"INT"==h.toUpperCase()&&("AccountTypeID"==u[0].SysColumnName.toString()||"ProductTypeID"==u[0].SysColumnName.toString()))&&(h="TEXT")),h.toUpperCase()){case"INT":""!=l[s[0].toString()].toString()&&null!=l[s[0].toString()]&&""!=l[s[0].toString()].toString()&&N.J0.ValidateInt(l[s[0].toString()].toString())&&(l[s[0].toString()]="Error"),e.AcceptChanges();break;case"DATE":""!=l[s[0].toString()].toString()&&null!=l[s[0].toString()]&&""!=l[s[0].toString()].toString()&&N.J0.isValidDate(l[s[0].toString()].toString())&&(l[s[0].toString()]="Error"),e.AcceptChanges();break;case"FLOAT":""!=l[s[0].toString()].toString()&&null!=l[s[0].toString()]&&""!=l[s[0].toString()].toString()&&N.J0.ValidateDouble(l[s[0].toString()].toString())&&(l[s[0].toString()]="Error"),e.AcceptChanges();break;case"COMBOBOX":parseInt(this.Parent.Feature.SelectedValue.toString())>4e4&&parseInt(this.Parent.Feature.SelectedValue.toString())<5e4&&"VoucherNo"==i[0].SysColumnName.toString()&&""!=l[s[0].toString()].toString()&&null!=l[s[0].toString()]&&(N.J0.ValidateInt(l[s[0].toString()].toString())||(l[s[0].toString()]="NA")),e.AcceptChanges();break;case"LISTBOX":N.J0.IsNum(l[s[0].toString()+"_Key"])&&(l[s[0].toString()]="NA"),e.AcceptChanges()}})}),e}OnButtonClick(e){if(this.Parent.IsPreviewDataOk=!1,"Cancel"==e.toString())this.Parent.IsScaned&&(this.Parent.IsScaned=!1),I.d.page.HideDialog(this.PopUpGUID);else if("Confirm"==e.toString()){let i;i=new Ae.AddNoteViewModel,i.NoteID=0,i.Note.Text="Total no. of Rows: "+this.Parent.ExcelTable.length,this.ConfirmList.push(i),this.btnOkText="Next",this.NextEnable=!0,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!1,this.ConfirmListVisible=!0,i=new Ae.AddNoteViewModel,i.NoteID=0;for(let s of this.NotesList){i=new Ae.AddNoteViewModel,i.NoteID=0;let u=s.Note.ToolTipDescription.split(",");if(this.Parent.ExcelTable.Columns.Contains(s.Note.Label)){this.Parent.ExcelTable.Columns.Contains("IsDeleted")||this.Parent.ExcelTable.Columns.push("IsDeleted");let h=0;for(let t in u)if(""!=t.toString()){let o=this.Parent.ExcelTable.filter(r=>r.item.Note.Label==t.split("~")[0].toString().Replace("'","''"));if(o.length>0)for(let r in o)s.IsModified||(r.IsDeleted=!0),h++}i.Note.Text=s.IsModified?"New rows for "+s.Note.Label+", Count :"+h:"Removed rows for "+s.Note.Label+", Count :"+h,i.NoteID=h,i.Note.Label=s.Note.Label,this.ConfirmList.push(i),this.Parent.ExcelTable.AcceptChanges()}}i=new Ae.AddNoteViewModel,i.NoteID=0;let l=0;this.Parent.ExcelDataColumn.includes("IsDeleted")&&(l=this.Parent.ExcelTable.Select("IsDeleted='true'").length),i.Note.Text="Number of total rows deleted, count :"+l,this.ConfirmList.push(i)}else if("View"==e.toString()){if(null!=this._SelectedNote){let i;if(""!=this.SelectedNote.Note.ToolTipDescription){this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!0;let l=[],s=this.SelectedNote.Note.ToolTipDescription.split(",");for(let u=0;u<s.length;u++)""!=s[u].toString()&&(i=new Ae.AddNoteViewModel,i.NoteID=0,i.Note.Label=s[u].toString().substring(s[u].lastIndexOf("~")+1).toString(),i.Note.Text=s[u].toString().substring(0,s[u].lastIndexOf("~")),l.push(i))}}}else if("BackInfo"==e.toString())this.RulesList.length>0&&(this.RulesListVisible=!0),this.ErrorList.length>0&&(this.ErrorListVisible=!0),this.NotesList.length>0&&(this.NotesListVisible=!0),this.NewInfoVisible=!1;else try{this.Parent.IsScaned&&(this.Parent.IsPreviewDataOk=!0,this.Parent.NotesList=this.NotesList,I.d.page.HideDialog(this.PopUpGUID))}catch{}}}var Pt=le(21580),Zt=le(27630),bt=le(91229),D=le(54438),Lt=le(60177),Nt=le(89417),qt=le(99246),zt=le(73955);function ei(z,e){if(1&z&&(D.qex(0),D.EFF(1,"\n                            "),D.j41(2,"div",16),D.EFF(3,"\n                                "),D.j41(4,"span",17),D.EFF(5),D.k0s(),D.EFF(6,"\n                            "),D.k0s(),D.EFF(7,"\n                        "),D.bVm()),2&z){const i=e.$implicit;D.R7$(5),D.JRh(i.HeaderText)}}function ti(z,e){if(1&z&&(D.qex(0),D.EFF(1,"\n                                    "),D.j41(2,"div",22),D.EFF(3),D.k0s(),D.EFF(4,"\n                                "),D.bVm()),2&z){const i=e.$implicit,l=D.XpG().$implicit;D.R7$(3),D.SpI("\n                                        ",l[i.DisplayMember],"\n                                    ")}}function ii(z,e){if(1&z){const i=D.RV6();D.j41(0,"div",20),D.bIt("click",function(s){const u=D.eBV(i).$implicit,h=D.XpG(3);return D.Njj(h.OnListItemClick(s,u))}),D.EFF(1,"\n                            "),D.j41(2,"div",21),D.EFF(3,"\n                                "),D.DNE(4,ti,5,1,"ng-container",14),D.EFF(5,"\n                            "),D.k0s(),D.EFF(6,"\n                        "),D.k0s()}if(2&z){const i=D.XpG(3);D.R7$(4),D.Y8G("ngForOf",i.obj.ColumnSource)}}function si(z,e){if(1&z&&(D.j41(0,"div",18),D.EFF(1,"\n                        "),D.DNE(2,ii,7,1,"div",19),D.EFF(3,"\n                    "),D.k0s()),2&z){const i=D.XpG(2);D.R7$(2),D.Y8G("ngForOf",i.obj.TempExcelTable)}}function ai(z,e){if(1&z&&(D.j41(0,"div",10),D.EFF(1,"\n            "),D.j41(2,"div",11),D.EFF(3,"\n                "),D.j41(4,"div",12),D.EFF(5,"\n                    "),D.j41(6,"div",13),D.EFF(7,"\n                        "),D.DNE(8,ei,8,1,"ng-container",14),D.EFF(9,"\n                    "),D.k0s(),D.EFF(10,"\n                    "),D.DNE(11,si,4,1,"div",15),D.EFF(12,"\n                "),D.k0s(),D.EFF(13,"\n            "),D.k0s(),D.EFF(14,"\n        "),D.k0s()),2&z){const i=D.XpG();D.R7$(2),D.AVh("List__dropdown--open",i.suggestionsIsOpen),D.R7$(6),D.Y8G("ngForOf",i.obj.ColumnSource),D.R7$(3),D.Y8G("ngIf",null!=i.obj.TempExcelTable)}}function li(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i)}}function oi(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,li,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const i=D.XpG();D.R7$(24),D.Y8G("ngForOf",i.obj.ColumnSource)}}function ri(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i.Note.Text)}}function ni(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,ri,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const i=D.XpG();D.R7$(24),D.Y8G("ngForOf",i.obj.ErrorList)}}function ui(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i.Note.Text)}}function hi(z,e){if(1&z){const i=D.RV6();D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                       \n                        "),D.j41(15,"tr"),D.EFF(16,"\n                            "),D.j41(17,"div",29),D.EFF(18,"\n                                "),D.j41(19,"div",30),D.EFF(20,"\n                                    "),D.j41(21,"input",31),D.mxI("ngModelChange",function(s){D.eBV(i);const u=D.XpG();return D.DH7(u.obj.IsModified,s)||(u.obj.IsModified=s),D.Njj(s)}),D.k0s(),D.EFF(22,"\n                                    "),D.EFF(23,"\n                                "),D.k0s(),D.EFF(24,"\n                                "),D.EFF(25,"\n                            "),D.k0s(),D.EFF(26,"\n                        "),D.k0s(),D.EFF(27,"\n                            "),D.EFF(28,"\n                           \n                        \n                    "),D.k0s(),D.EFF(29,"\n                "),D.k0s(),D.EFF(30,"\n            "),D.k0s(),D.EFF(31,"\n            "),D.j41(32,"div",26),D.EFF(33,"\n                "),D.j41(34,"table",25),D.EFF(35,"\n                    "),D.j41(36,"tbody"),D.EFF(37,"\n                        "),D.DNE(38,ui,6,2,"tr",27),D.EFF(39,"\n                    "),D.k0s(),D.EFF(40,"\n                "),D.k0s(),D.EFF(41,"\n            "),D.k0s(),D.EFF(42,"\n        "),D.k0s()}if(2&z){const i=D.XpG();D.R7$(21),D.R50("ngModel",i.obj.IsModified),D.R7$(17),D.Y8G("ngForOf",i.obj.NotesListVisible)}}function mi(z,e){if(1&z){const i=D.RV6();D.j41(0,"button",33),D.nI1(1,"translate"),D.bIt("click",function(){D.eBV(i);const s=D.XpG(2);return D.Njj(s.ButtonClick("BackInfo"))}),D.nrm(2,"i",34),D.EFF(3,"\n    "),D.k0s()}2&z&&D.FS9("title",D.bMT(1,1,"Back"))}function di(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                            "),D.j41(6,"td"),D.EFF(7),D.k0s(),D.EFF(8,"\n\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i.Label),D.R7$(3),D.JRh(i.Note.Text)}}function ci(z,e){if(1&z){const i=D.RV6();D.j41(0,"div",23),D.EFF(1,"\n\n            "),D.DNE(2,mi,4,3,"button",32),D.EFF(3,"\n            "),D.j41(4,"div",24),D.EFF(5,"\n                "),D.j41(6,"table",25),D.EFF(7,"\n                    "),D.j41(8,"thead"),D.EFF(9,"\n                        "),D.j41(10,"tr"),D.EFF(11,"\n                            "),D.EFF(12,"\n                            "),D.j41(13,"th"),D.EFF(14,"NewInfo"),D.k0s(),D.EFF(15,"\n                        "),D.k0s(),D.EFF(16,"\n                        "),D.j41(17,"tr"),D.EFF(18,"\n                            "),D.j41(19,"div",29),D.EFF(20,"\n                                "),D.j41(21,"div",30),D.EFF(22,"\n                                    "),D.j41(23,"input",31),D.mxI("ngModelChange",function(s){D.eBV(i);const u=D.XpG();return D.DH7(u.obj.IsModified,s)||(u.obj.IsModified=s),D.Njj(s)}),D.k0s(),D.EFF(24,"\n                                    "),D.EFF(25,"\n                                "),D.k0s(),D.EFF(26,"\n                                "),D.EFF(27,"\n                            "),D.k0s(),D.EFF(28,"\n                        "),D.k0s(),D.EFF(29,"\n                            "),D.EFF(30,"\n                           \n                       \n                    "),D.k0s(),D.EFF(31,"\n                "),D.k0s(),D.EFF(32,"\n            "),D.k0s(),D.EFF(33,"\n            "),D.j41(34,"div",26),D.EFF(35,"\n                "),D.j41(36,"table",25),D.EFF(37,"\n                    "),D.j41(38,"tbody"),D.EFF(39,"\n                        "),D.DNE(40,di,9,3,"tr",27),D.EFF(41,"\n                    "),D.k0s(),D.EFF(42,"\n                "),D.k0s(),D.EFF(43,"\n            "),D.k0s(),D.EFF(44,"\n        "),D.k0s()}if(2&z){const i=D.XpG();D.R7$(2),D.Y8G("ngIf",i.obj.IsDynamicTree),D.R7$(21),D.R50("ngModel",i.obj.IsModified),D.R7$(17),D.Y8G("ngForOf",i.obj.NewInfo)}}function gi(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i.Note.Text)}}function Ci(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,gi,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const i=D.XpG();D.R7$(24),D.Y8G("ngForOf",i.obj.RulesList)}}function Di(z,e){if(1&z&&(D.j41(0,"tr",28),D.EFF(1,"\n                            "),D.EFF(2,"\n                            "),D.j41(3,"td"),D.EFF(4),D.k0s(),D.EFF(5,"\n                        "),D.k0s()),2&z){const i=e.$implicit;D.BMQ("index",e.index),D.R7$(4),D.JRh(i.Note.Text)}}function Si(z,e){if(1&z&&(D.j41(0,"div",23),D.EFF(1,"\n            "),D.j41(2,"div",24),D.EFF(3,"\n                "),D.j41(4,"table",25),D.EFF(5,"\n                    "),D.j41(6,"thead"),D.EFF(7,"\n                        "),D.j41(8,"tr"),D.EFF(9,"\n                            "),D.EFF(10,"\n                            "),D.j41(11,"th"),D.EFF(12,"Note"),D.k0s(),D.EFF(13,"\n                        "),D.k0s(),D.EFF(14,"\n                    "),D.k0s(),D.EFF(15,"\n                "),D.k0s(),D.EFF(16,"\n            "),D.k0s(),D.EFF(17,"\n            "),D.j41(18,"div",26),D.EFF(19,"\n                "),D.j41(20,"table",25),D.EFF(21,"\n                    "),D.j41(22,"tbody"),D.EFF(23,"\n                        "),D.DNE(24,Di,6,2,"tr",27),D.EFF(25,"\n                    "),D.k0s(),D.EFF(26,"\n                "),D.k0s(),D.EFF(27,"\n            "),D.k0s(),D.EFF(28,"\n        "),D.k0s()),2&z){const i=D.XpG();D.R7$(24),D.Y8G("ngForOf",i.obj.ConfirmList)}}let pi=(()=>{class z{ngOnInit(){console.log("ObjPReview",this.obj),console.log("params",this.params)}OnListItemClick(i,l){}static#e=this.\u0275fac=function(l){return new(l||z)};static#t=this.\u0275cmp=D.VBU({type:z,selectors:[["app-preview-data"]],decls:36,vars:10,consts:[[1,"master-screen",2,"padding-bottom","4px","max-width","600px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],["style","display: flex;flex-direction: column;",4,"ngIf"],["class","PACT_Table",4,"ngIf"],[1,"input_cntrl_label"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"display","flex","flex-direction","column"],["DropUp","",1,"List__dropdown","List__dropdown--suggestions","suggestions"],[1,"suggestions__group"],[1,"suggestions__group-Header",2,"display","flex"],[4,"ngFor","ngForOf"],["class","suggestions__group-content",4,"ngIf"],[1,"suggestions__group-column",2,"width","120px"],[2,"text-overflow","ellipsis"],[1,"suggestions__group-content"],["class","suggestions__item suggestions__list",3,"click",4,"ngFor","ngForOf"],[1,"suggestions__item","suggestions__list",3,"click"],[1,"suggestions__list-info",2,"display","flex"],[1,"suggestions__list-name",2,"width","120px"],[1,"PACT_Table"],[1,"tbl-header"],["cellpadding","0","cellspacing","0","border","0"],[1,"tbl-content"],["class","tbl-row",4,"ngFor","ngForOf"],[1,"tbl-row"],[1,"div-import-item"],[1,"form-group","col-xl-6","col-md-6","col-sm-6","col-xs-12","divChk"],["type","checkbox",1,"input_checkbox",3,"ngModelChange","ngModel"],["class","secondary-btn-wicon",3,"title","click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click","title"],[1,"fa-light","fa-search"]],template:function(l,s){1&l&&(D.j41(0,"div",0),D.EFF(1,"\n    "),D.j41(2,"div",1),D.EFF(3,"\n        "),D.DNE(4,ai,15,4,"div",2),D.EFF(5,"\n        "),D.DNE(6,oi,29,1,"div",3),D.EFF(7,"\n\n\n\n\n        "),D.DNE(8,ni,29,1,"div",3),D.EFF(9,"\n        "),D.DNE(10,hi,43,2,"div",3),D.EFF(11,"\n        "),D.DNE(12,ci,45,3,"div",3),D.EFF(13,"\n\n\n        "),D.DNE(14,Ci,29,1,"div",3),D.EFF(15,"\n\n        \n       \n\n        "),D.DNE(16,Si,29,1,"div",3),D.EFF(17,"\n       \n       \n       \n\n        "),D.j41(18,"label",4),D.EFF(19),D.k0s(),D.EFF(20,"\n    "),D.k0s(),D.EFF(21,"\n    "),D.j41(22,"div",5),D.EFF(23,"\n        "),D.j41(24,"div"),D.EFF(25,"\n            "),D.j41(26,"button",6),D.bIt("click",function(){return s.obj.ButtonClick.Call(s.obj.btnOkText)}),D.nrm(27,"i",7),D.EFF(28),D.k0s(),D.EFF(29,"\n            "),D.j41(30,"button",8),D.bIt("click",function(){return s.obj.ButtonClick.Call("Cancel")}),D.nrm(31,"i",9),D.EFF(32),D.k0s(),D.EFF(33,"\n        "),D.k0s(),D.EFF(34,"\n    "),D.k0s(),D.EFF(35,"\n"),D.k0s()),2&l&&(D.R7$(4),D.Y8G("ngIf",s.obj.TempExcelTableVisible),D.R7$(2),D.Y8G("ngIf",s.obj.TempExcelTableVisible),D.R7$(2),D.Y8G("ngIf",s.obj.ErrorListVisible),D.R7$(2),D.Y8G("ngIf",s.obj.NotesListVisible),D.R7$(2),D.Y8G("ngIf",s.obj.NewInfoVisible),D.R7$(2),D.Y8G("ngIf",s.obj.RulesListVisible),D.R7$(2),D.Y8G("ngIf",s.obj.ConfirmListVisible),D.R7$(3),D.JRh(s.obj.NoofRows),D.R7$(9),D.JRh(s.obj.btnOkText),D.R7$(4),D.JRh("Cancel"))},dependencies:[Lt.Sq,Lt.bT,Nt.Zm,Nt.BC,Nt.vS,qt.k,zt.D9]})}return z})();class Ve{constructor(e,i){this.fName=e,this.fResult=i}setFieldValue(e){this.fResult=e}}class _e{constructor(){this.parts=[]}append(e){return this.parts.push(String(e)),this}toString(){return this.parts.join("")}clear(){this.parts=[]}}class Ti extends Tt.g{get DtImport(){return this.grData.Table}set DtImport(e){this.grData.Table=e}get ImportCols(){return this.grData.Columns}set ImportCols(e){this.grData.Columns=e}get DataTable(){return this.DataTableObj.Table}constructor(e,i){super(),this.ds=null,this.obj=new jt.Document,this.oProduct=new xt.c,this.oFile=new N.n_,this.Name=new k.Dw(0),this.Profile=new ie.y$(0),this.Dimensions=new ie.y$(0),this.IsSaveDocValidate=!1,this.dtValue=new Date,this.strHistoryMsg="",this.LocRemarks="",this.DeptRemarks="",this.DesgRemarks="",this.EDate=new Date,this.totEarnings=0,this.totDeductions=0,this.ReportViewModel=null,this.columnexist=!1,this.colcode="",this.colname="",this.code="",this.name="",this.codecolnum=0,this.namecolnum=0,this.excelview=[],this.oChart=new ft.T,this.timespan=0,this.userCreate=new Zt.PropertyRoleUser,this.grData=new dt.vv,this._DocumentType=0,this.IsExcel=!0,this.IsScaned=!1,this.IsPreviewDataOk=!1,this.GroupExists=!1,this.EmpGrade=1,this.IDHistoryMessage="",this.ErrorMessage="",this.drSel=null,this.NotesList=[],this.ErrorList=[],this.RulesList=[],this.CostCenterFieldsAllTables={},this.CodeDef=[],this.dtPayrollE=[],this.dtPayrollD=[],this.costCenterTableZero=[],this.QtyFldName="",this.GrssFldName="",this.BinDimFieldName="",this.DonotUpdateInventory=!0,this.GradeRemarks="",this.DataTableObj=new dt.vv,this.lstContactFields=[],this.lstAddressFields=[],this.xDocCodeDef=new N.VB,this.Administration={},this.objAsset=new lt.V,this.temp=[],this.lookuptemp=[],this.CCQuery=[],this.CCQueryData=new ie.y$(0),this.lookupQuery=[],this.ccdv=[],this.lookupdv=[],this.COls=[],this.catSub=new He.bT,this.partCat=new He.bT,this.BankAccounts=new Kt.y$(0),this.BatchCode=new k.s3(27184),this.WithoutExcel=!1,this.FailedRecourdList=[],this.ImportingMessage="Importing Data Please Wait....",this.ScreenObject=null,this.ActualFileName="",this.ColumnSource=[],this.FeatureVisibility=!0,this.ImportVisbility=!0,this.BulkVisible=!1,this.ProgressValue=0,this.ProgressMax=0,this.ShowBarcodeDimension=!1,this.BarcodeDim=0,this.QtyText=new k.Dw(0),this.RateText=new k.Dw(0),this.ProfileName=new k.Dw(0),this.Feature=new ie.y$(0),this.UpdateBasedOn=new ie.y$(0),this.fldDict=new He.bT,this.QtyCombo=new ie.y$(0),this.RateCombo=new ie.y$(0),this.RefreshGrid=!1,this.IsDuplicateNameAllowed=!1,this.DoNotCreateCCVisibility=!1,this.UpdateBasedOnVisibility=!1,this.DoNotCreateCostCenter=!1,this.IsAvgRateChecked=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.IsQtyChecked=!1,this.IsRateChecked=!1,this.IsProductwiseBarcode=!1,this.IsAutoCodeGen=!1,this.ValidateBeforeImport=!0,this.UpdateStatusInExcel=!0,this.AppendData=!1,this.AppendVisible=!1,this.FillLocalReference=!1,this.FillLocRefVisibility=!1,this.IsCode=!1,this.BulkSave=!1,this.PartialSave=!1,this.IsPreview=!1,this.IsUpdate=!1,this.VerifyVisible=!1,this.ValidateVisible=!1,this.IsSnoBasedLinking=!1,this.GridEnable=!1,this.NameSameasCode=!1,this.lblTitle="",this.ButtonOpen=new Et.v,this.ButtonSave=new Et.v,this.EmpCode=new k.s3(0),this.DocItems=new ie.v4,this.TemplateGrid=new dt.vv,this.ProductTypeID=0,this.IgnoreBatch=0,this.Date=new Date,this.YearMonth=this.Date.getFullYear().toString()+this.Date.toLocaleDateString("default",{month:"short"}),this.ProfileID=0,this.Browsefile=new ot.Yk,this.ExportFile=new ot.Yk,this.ImportData=new ot.Yk,this.SaveFile=new ot.Yk,this.ControlGen=new gt.ControlGenerator,this.objCG=new gt.ControlGenerator,this.objEmpEss=new Jt.r,this.PosRegisterField="",this.PosShiftField="",this.PosRegisterDim=0,this.PosShiftDim=0,this.DocNumberField="",this.DocPrefixField="",this.VoucherNoField="",this.DocDateField="",this.FreeQtyField="",this.QtyField="",this.RateField="",this.GrossField="",this.UnitFieldName="",this.ProductFieldName="",this.CrAccFieldName="",this.DrAccFieldName="",this.ExhgRateFieldName="",this.CurrencyFieldName="",this.IsDrFieldCode=!1,this.IsCrFieldCode=!1,this.isAvgrate=!1,this.isCreditRowAdded=!1,this.isDebitRowAdded=!1,this._SelectedValue="",this._FeatureSelectedValue=null,this.eval=new At.PE,this.VoucherType=0,this.strSerial=[],this.dttemp=[],this.tempfield="",this.dvMain=[],this.GroupsImport=!1,this.GroupTotCount=0,this.GroupfailCount=0,this.budgetInput=[],this.budgetTable=[],this.DataCollection=new Vt.t,this.BudgetType=0,this.CCPropertySales=[],this.CCPropertyAccntn=[],this.CCPropertyLandlord=[],this.CCNodeDet=[],this.dsCCPropS=[],this.CCSalesNodeid="0",this.CCAccNodeid="0",this.CCLndNodeid="0",this.Previewinfo="",this.Uomsb="",this.UomCol="",this.batchnumberfield="",this.bcodefield="",this.mfgdatefield="",this.expdatefield="",this.productidfield="",this.sbQuery="",this.UpdateColumns="",this.lstDuplicate=[],this.dblTotalHours=0,this.isEdit=!1,this.IsLoad=!1,this.FileName="",this.ExcelDataColumn=[],this.ProfileName.Label="Profile Name",this.Feature.Label="Feature",this.ProfileID=e,Logger.InfoLog("ImportViewModel::Entering ImportViewModel"),this.BankAccounts.Visible=!1,this.TemplateGrid.Visible=!1,this.QtyCombo.Visible=!1,this.YearMonth="",this.loadFeatures(i),this.grData.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}loadFeatures(e){const i=I.d.document.GetFeaturesList();if(I.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==I.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.YearMonth=""),this.Feature.Items.Clear(),i&&i.Tables){for(let h=0;h<i.Tables[0].length;h++)251==N.J0.Int(i.Tables[0][h].FeatureID)||252==N.J0.Int(i.Tables[0][h].FeatureID)||253==N.J0.Int(i.Tables[0][h].FeatureID)||254==N.J0.Int(i.Tables[0][h].FeatureID)||255==N.J0.Int(i.Tables[0][h].FeatureID)?this.Feature.Items.push(ie._p.ComboBoxItems_4("Payroll "+i.Tables[0][h].Name.toString(),i.Tables[0][h].FeatureID.toString(),null,`${i.Tables[0][h].FeatureID.toString()}_${"Payroll "+i.Tables[0][h].Name.toString()}`)):this.Feature.Items.push(ie._p.ComboBoxItems_4(i.Tables[0][h].Name.toString(),i.Tables[0][h].FeatureID.toString(),null,`${i.Tables[0][h].FeatureID.toString()}_${i.Tables[0][h].Name.toString()}`));this.Feature.Items.push(ie._p.ComboBoxItems_4("Attachments","-100","","Attachments_-100"))}let l,s,u;e?(this.ButtonOpen.Visible=!1,this.ProfileName.Enable=!1,this.FeatureVisibility=!1,this.Feature.Enable=!1,this.GridEnable=!1):this.ButtonOpen.Visible=!(!I.d.SessionManager.IsActionAssigned(162,"Create")&&!I.d.SessionManager.IsActionAssigned(162,"Update")),this.ButtonSave.Visible=!!I.d.SessionManager.IsActionAssigned(162,"Update"),this.BankAccounts.CCID=2,this.BankAccounts.TypeID=2,this.BankAccounts.CustomWhere="AccountTypeID=2",this.UpdateBasedOn.Visible=!1,this.Browsefile.Subscribe(this,"OnBrowsefile"),this.ExportFile.Subscribe(this,"OnExportFile"),this.ImportData.Subscribe(this,"OnImportData"),this.SaveFile.Subscribe(this,"OnSave"),this.DisplayName=this.lblTitle,this.ButtonSave.ClickCommand.Subscribe(this,"OnSave"),s=[],this.grData.Clear(),this.grData.Columns=[],l=new ct.O7,l.DisplayMember="FieldName",l.Header=I.d.GetResource("Import_FieldName"),l.DataType="TextBlock",l.Width=150,l.ReadOnly=!0,l.DisableTab=!0,s.push(l),this.grData.TableColumns.push("FieldName"),l=new ct.O7,l.DisplayMember="ResourceData",l.ValueMember="CostCenterColID",l.ValueBinding="FeatureFieldName",l.Header=I.d.GetResource("Import_FeatureFieldName"),l.DataType="ComboBox",l.Width=200,l.DisableTab=!1,u=[],u.push(ie._p.ComboBoxItems_2("","")),l.ComboData=u,s.push(l),this.grData.TableColumns.push("FeatureFieldName"),this.ImportCols=s,this.grData.Height=300,this.grData.gridWidth="600",this.grData.addEmptyRow(),this.grData.refreshDataView(),0!=this.ProfileID&&(l.ReadOnly=!I.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Feature.Enable=I.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Import(this.ProfileID,e)),Logger.InfoLog("ImportViewModel::Exiting ImportViewModel")}OnKeyDown(e,i){console.log("eventD",e),!i.ctrlKey&&46==i.which&&"Delete"==i.key&&(console.log("Deleted calling "),this.grData.removeRowAt(e.row))}Import(e,i){if(e>0){const s=I.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0){let u=new N.VB;u.LoadXml(s.Tables[0][0].Structure.toString()),null!=u&&u.DocumentElement.children[0].attributes[0].value.toString()}e>0&&(this.isEdit=!i)}}get FeatureSelectedValue(){return this._FeatureSelectedValue}set FeatureSelectedValue(e){this._FeatureSelectedValue!=e&&(this._FeatureSelectedValue=e)}OnChange(e){const i=e.target.value,l=this.Feature.Items.find(s=>s.Aliasname==i);this.Feature._SelectedValue=l?.Value||"",this.Feature.SelectedItem=l||null,this.OnSelectionChanged(this)}OnSelectionChanged(e){if(this.ValidateVisible=!1,null!=this.Feature.SelectedValue&&""!=this.Feature.SelectedValue){if(this.QtyCombo.Visible=!1,this.UpdateBasedOn.Visible=!1,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(ie._p.ComboBoxItems_2("","")),this.VerifyVisible=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.CostCenterFieldsAllTables=I.d.document.GetFeaturesDetails(parseInt(this.Feature.SelectedValue),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),this.CostCenterFieldsAllTables?.Tables.length>0&&this.CostCenterFieldsAllTables.Columns[this.CostCenterFieldsAllTables.Columns.length-1].Contains("ErrorMessage"))return;let l=this.CostCenterFieldsAllTables.Tables[this.CostCenterFieldsAllTables.Tables.length-1];this.CodeDef=l&&l.length>0&&"PrefixContent"in l[0]?l:null,this.AppendVisible="101"==this.Feature.SelectedValue||"2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||N.J0.Int(this.Feature.SelectedValue)>5e4&&N.J0.Int(this.Feature.SelectedValue)<59999,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4||93==parseInt(this.Feature.SelectedValue)?(0==this.ProfileID&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&(this.DoNotCreateCostCenter=!0),this.FillLocRefVisibility=!0,this.DocItems.Items.Clear()):(this.FillLocRefVisibility=!1,this.FillLocalReference=!1,this.DoNotCreateCostCenter=!1),this.costCenterTableZero=this.CostCenterFieldsAllTables.Tables[0];let s={CostCenterColID:"-200",SysColumnName:"",ResourceData:""};const u=this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{},h=Object.keys(u);h.includes("CostcenterID")&&(s.CostcenterID=this.Feature.SelectedValue),h.includes("ColumnCostCenterID")&&(s.ColumnCostCenterID="0"),h.includes("IsColumninuse")&&(s.IsColumninuse="boolean"==typeof u.IsColumninuse||1),h.includes("IsColumninuse")&&(s.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),h.includes("ColumnDataType")&&(s.ColumnDataType="str"),this.costCenterTableZero.unshift(s),this.IsSnoBasedLinking=!1;const t=parseInt(this.Feature.SelectedValue);if(t>4e4&&t<5e4&&this.CostCenterFieldsAllTables.Tables.length>3&&this.CostCenterFieldsAllTables.Tables[3].length>0){let r=this.CostCenterFieldsAllTables.Tables[3].filter(d=>"SnoBasedLinking"===d.PrefName);if(r.length>0){const d=r[0].PrefValue;d.toString()!==String(!!d)&&(this.IsSnoBasedLinking=!0,this.costCenterTableZero.unshift({CostCenterColID:"-501",CostcenterID:this.Feature.SelectedValue,ColumnCostCenterID:"0",CostcenterName:null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:"Feature",SysColumnName:"RefSNo",ResourceData:"RefSNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}))}}if(99==t)this.costCenterTableZero.unshift({CostCenterColID:"0",SysColumnName:"",ResourceData:""});else if(null!=this.Feature.SelectedItem&&"Substitute Products"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"SubstituteGroup",ResourceData:"Substitute Group",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name||"Product With Services(Many-One)"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceCode",ResourceData:"Service Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Services to Dimension"==this.Feature.SelectedItem.Name){this.costCenterTableZero=[];let r=this.CostCenterFieldsAllTables.Tables[7];if(r.length>0){const d=r.filter(p=>"LinkedProductDimension"===p?.Name);let c=parseInt(d[0].CostcenterID);this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:c,CostcenterName:"Product",SysColumnName:"Dimension",ResourceData:"Dimension",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})}}else this.Feature.SelectedItem&&"Kit Products"==this.Feature.SelectedItem.Name?(this.costCenterTableZero=[],this.AddKitProductRows(this.costCenterTableZero)):this.Feature.SelectedItem&&"Product QC"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddQCProductRows(this.costCenterTableZero));if(73==t&&this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Product",SysColumnName:"CloseDate",ResourceData:"Close Date",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"DATE"}),114==t&&this.AddFollowupRows(this.costCenterTableZero),40054==t){let r,d=this.CostCenterFieldsAllTables;this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-300",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcCCNID51",ResourceData:"Employee Code*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push({CostCenterColID:"-301",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha5",ResourceData:"Days Attended*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.costCenterTableZero.push({CostCenterColID:"-302",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha9",ResourceData:"Absent(LOP) Days",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"});let p=this.dsEmpPayWithDate(1,I.d.SessionManager.PayrollMonth);p&&p.Tables&&p.Tables.length>0&&p.Tables[0].length>0&&p.Tables[0].filter(S=>[1,2,3,4].includes(+S.Type)).sort((S,F)=>{const y=+S.Type,C=+F.Type;return y==C?y-C:+S.SNo-+F.SNo}).forEach(S=>{const F={};F.CostCenterColID=S.CostCenterColID,F.CostcenterID=t,F.ColumnCostCenterID=S.Type,F.SysColumnName="dcNum"+S.SNo,F.ResourceData=S.ComponentName,F.IsColumninuse=!0,F.IsColumnUserDefined=!1,F.ColumnDataType="FLOAT","OverTime"==N.J0.String(S.FieldType)&&(F.CostCenterName=(F.CostCenterName||"")+"_OT"),this.costCenterTableZero.push(F)}),r=d.Tables[0].filter(T=>T.SysColumnName&&T.SysColumnName.startsWith("dcAlpha")),r&&r.length>0&&r.forEach(T=>{if(parseInt(T.SysColumnName.replace("dcAlpha",""),10)>50){const S={};S.CostCenterColID=T.CostCenterColID,S.CostcenterID=t,S.ColumnCostCenterID="6",S.SysColumnName=T.SysColumnName,S.ResourceData=T.ResourceData,S.IsColumninuse=T.IsColumninuse,S.IsColumnUserDefined=T.IsColumnUserDefined,S.ColumnDataType=T.ColumnDataType,this.costCenterTableZero.push(S)}})}else if(t>4e4&&t<5e4&&Object.keys(this.costCenterTableZero.includes("CostCenterColID"))){null!=this.ExcelTable&&this.FillQtyRateCombo(),this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocNumber",ResourceData:"Numeric Doc No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"INT"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocPrefix",ResourceData:"DocPrefix",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-3",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"BillWiseDocNo",ResourceData:"BillWise DocNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"BillWiseDocNo"}),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory?([{id:"-4",ColumnCC:"16",SysCol:"Batchno",Resource:"Batch No",DataType:"str"},{id:"-5",ColumnCC:"0",SysCol:"MfgDate",Resource:"Mfg Date",DataType:"DATE"},{id:"-6",ColumnCC:"0",SysCol:"ExpDate",Resource:"Exp Date",DataType:"DATE"},{id:"-26",ColumnCC:"0",SysCol:"BatchDocNo",Resource:"Batch DocNo",DataType:"str"},{id:"-25",ColumnCC:"0",SysCol:"AVGRATE",Resource:"AVGRATE",DataType:"FLOAT"},{id:"-28",ColumnCC:"0",SysCol:"AVGRATEVALUE",Resource:"AVGRATEVALUE",DataType:"FLOAT"},{id:"-29",ColumnCC:"0",SysCol:"BinCode",Resource:"Bin Code",DataType:"str"},{id:"-30",ColumnCC:"0",SysCol:"BinName",Resource:"Bin Name",DataType:"str"}].forEach(m=>{this.costCenterTableZero.push({CostCenterColID:m.id,CostcenterID:t,ColumnCostCenterID:m.ColumnCC,SysColumnName:m.SysCol,ResourceData:m.Resource,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:m.DataType})}),this.BulkVisible=!0):(this.BulkVisible=!1,this.BulkSave=!1);let n=[];n=this.CostCenterFieldsAllTables.Tables[3];let a=!1;if(n&&n.length>0){const T=n.filter(m=>"EnableSchemes"===m.PrefName);if(T.length>0){const m=T[0].PrefValue;a="true"===m||!0===m}}a&&this.costCenterTableZero.push({CostCenterColID:"-8",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"FreeQTY",ResourceData:"FreeQTY",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.CostCenterFieldsAllTables.Tables[2].length>0&&N.J0.Int(5==this.CostCenterFieldsAllTables.Tables[2][0].DocumentType)&&this.AddTransferFromToRows(this.CostCenterFieldsAllTables.Tables[0]),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory&&(this.costCenterTableZero.push({CostCenterColID:"-7",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNo",ResourceData:"Linking Ref No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNo"}),this.costCenterTableZero.push({CostCenterColID:"-77",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNoSNo",ResourceData:"Linking Ref No SNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNoSNo"}));let g=-9;const p=this.costCenterTableZero.filter(T=>{const m=String(T.SysColumnName||"").toLowerCase();return["debitaccount","creditaccount","AccountID"].includes(m)});for(let T of p){const m={CostCenterColID:g.toString(),CostcenterID:t,ColumnCostCenterID:"2",SysColumnName:T.SysColumnName+"Code",ResourceData:(T.ResourceData||"").replace("Name","")+"Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:T.ColumnDataType};this.costCenterTableZero.push(m),g--}this.VerifyVisible=!0}if(56==t){const r=this.costCenterTableZero;if(!r||0===r.length)return;const d=c=>{const n=r.findIndex(a=>String(a.SysColumnName||"").toLowerCase()===c.toLowerCase());-1!==n&&r.splice(n,1)};d("Status"),d("Attachment"),d("Location")}if(76==t&&"Bill Of Materials With Multiple Stage"!=this.Feature.SelectedItem.Name&&this.FillBomDetails(),93==t&&"Unit Rates"!=this.Feature.SelectedItem.Name&&this.FillUnitRates(),t>6e4&&(this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Name",ResourceData:"Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Default",ResourceData:"Default",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})),null!=this.Feature.SelectedItem&&"Unit Rates"!==this.Feature.SelectedItem.Name&&"Product QC"!==this.Feature.SelectedItem.Name&&"Services to Dimension"!==this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&this.AddContactsRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Services to Dimension"!=this.Feature.SelectedItem.Name&&"Kit Products"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Dimension Move"!=this.Feature.SelectedItem.Name&&"Document Edit"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&(this.AddCodeRows(this.costCenterTableZero),this.AddWEFRows(this.costCenterTableZero),this.AddGroupSeriesRows(this.costCenterTableZero)),2==t&&null!=this.Feature.SelectedItem&&"Account Report Template"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name||3==t&&null!=this.Feature.SelectedItem&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Products With Substitutes"!=this.Feature.SelectedItem.Name||83==t||72==t||73==t||86==t||89==t||115==t||251==t||251==t||252==t||253==t||254==t||255==t||110==t||92==t||93==t||t>5e4&&t<=50075&&null!=this.Feature.SelectedItem&&"Job Output"!=this.Feature.SelectedItem.Name){let r={CostCenterColID:"-100",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodePrefix",ResourceData:"Code Prefix",ColumnDataType:"TEXT"};const c=Object.keys(this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{});c.includes("IsColumninuse")&&(r.IsColumninuse="boolean"==typeof u.IsColumninuse||1),c.includes("IsColumninuse")&&(r.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(r);let n={CostCenterColID:"-101",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodeNumber",ResourceData:"Code Number",ColumnDataType:"INT"};c.includes("IsColumninuse")&&(r.IsColumninuse="boolean"==typeof u.IsColumninuse||1),c.includes("IsColumninuse")&&(r.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(n)}if(50051==t){this.UpdateBasedOn.Visible=!0,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(ie._p.ComboBoxItems_2("",""));let r=this.costCenterTableZero.filter(n=>"1"===n.IsUnique||1===n.IsUnique);if(r&&r.length>0)for(let n=0;n<r.length;n++){const a=N.J0.String(r[n].UserColumnName),g=N.J0.String(r[n].SysColumnName);this.UpdateBasedOn.Items.push(ie._p.ComboBoxItems_2(a,g))}[{CostCenterColID:"-17",SysColumnName:"Assigned_VacDaysPeriod",ResourceData:"Assigned_VacDaysPeriod",ColumnDataType:"TEXT"},{CostCenterColID:"-001",SysColumnName:"GradeFromDate",ResourceData:"GradeFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-002",SysColumnName:"LocFromDate",ResourceData:"LocFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-003",SysColumnName:"DeptFromDate",ResourceData:"DeptFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-004",SysColumnName:"DesgFromDate",ResourceData:"DesgFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-005",SysColumnName:"EffectFromDate",ResourceData:"EffectFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-006",SysColumnName:"ActAppraisalFrom",ResourceData:"ActAppraisalFrom",ColumnDataType:"DATE"},{CostCenterColID:"-007",SysColumnName:"NextAppraisalDate",ResourceData:"NextAppraisalDate",ColumnDataType:"DATE"},{CostCenterColID:"-008",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-009",SysColumnName:"LocRemarks",ResourceData:"LocRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-010",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-011",SysColumnName:"DesgRemarks",ResourceData:"DesgRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-013",SysColumnName:"AppraisalReason",ResourceData:"AppraisalReason",ColumnDataType:"TEXT"},{CostCenterColID:"-014",SysColumnName:"IdentityCountry",ResourceData:"IdentityCountry",ColumnDataType:"TEXT"},{CostCenterColID:"-015",SysColumnName:"IdentityIsDefault",ResourceData:"IdentityIsDefault",ColumnDataType:"TEXT"},{CostCenterColID:"-018",SysColumnName:"Percentage",ResourceData:"Percentage",ColumnDataType:"FLOAT"}].forEach(n=>{this.costCenterTableZero.push({CostCenterColID:n.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:n.SysColumnName,ResourceData:n.ResourceData,IsColumninuse:"true",IsColumnUserDefined:"true",ColumnDataType:n.ColumnDataType})});let c=this.dsEmpPay(1);if(null!=c&&c.Tables.length>0){let n=c.Tables[0]||[];if(n&&n.length>0){n.filter(a=>"EmployeeMaster"===a.FieldType);for(let a=0;a<n.length;a++){if(N.J0.String("1"==n[a].Type)){let p={CostCenterColID:N.J0.String(n[a].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Earnings_"+N.J0.String(n[a].ComponentName),ResourceData:"Earnings_"+N.J0.String(n[a].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(p)}else if(N.J0.String("2"==n[a].Type)){let p={CostCenterColID:N.J0.String(n[a].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Deductions_"+N.J0.String(n[a].ComponentName),ResourceData:"Deductions_"+N.J0.String(n[a].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(p)}n.filter(p=>["1","2","3"].includes(p.Type)).foreach(p=>{const T=p.Type.toString(),m=p.ComponentID,S=p.ComponentName;let F="",y="",C="",f="";"1"===T&&(F="DrAccEarnings_",y="CrAccEarnings_",C="-100",f="-101"),"2"===T&&(F="DrAccDeductions_",y="CrAccDeductions_",C="-200",f="-201"),"3"===T&&(F="DrAccLoans_",y="CrAccLoans_",C="-300",f="-301");const x={CostCenterColID:`${f}${m}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${S}`,ResourceData:`${y} ${S}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"};this.costCenterTableZero.push({CostCenterColID:`${C}${m}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${S}`,ResourceData:`${F} ${S}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push(x)})}}}}else 7==t?[{CostCenterColID:"-401",SysColumnName:"AccountTypes",ResourceData:"Account Types"},{CostCenterColID:"-402",SysColumnName:"ProductTypes",ResourceData:"Product Types"},{CostCenterColID:"-403",SysColumnName:"LicenseCount",ResourceData:"License Count"},{CostCenterColID:"-404",SysColumnName:"Online/Offline",ResourceData:"Online/Offline"},{CostCenterColID:"-405",SysColumnName:"2StepVerificationMode",ResourceData:"2-Step Verification Mode"},{CostCenterColID:"-406",SysColumnName:"Language",ResourceData:"Language"}].forEach(d=>{this.costCenterTableZero.push({CostCenterColID:d.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:d.SysColumnName,ResourceData:d.ResourceData,ColumnDataType:"TEXT"})}):101==t?(this.costCenterTableZero.push({CostCenterColID:"-001",ColumnCostCenterID:"0",ColumnDataType:"TEXT",SysColumnName:"CarryForward",ResourceData:"Carry Forward"}),this.costCenterTableZero.push({CostCenterColID:"-002",ColumnCostCenterID:"12",ColumnDataType:"INT",SysColumnName:"Currency",ResourceData:"Currency"}),this.costCenterTableZero.push({CostCenterColID:"-003",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExchangeRate",ResourceData:"Exchange Rate"})):-100==t&&(this.AddAttachemtnRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Products With Vendor Multiple Barcode"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddProductVendorWiseMultipleBarcodeRows(this.costCenterTableZero)));if(95==t&&this.AddContractRows(this.costCenterTableZero),83==t&&null!=this.Feature.SelectedItem&&"CRM Customer With Contacts"==this.Feature.SelectedItem.Name&&this.CostCenterFieldsAllTables.Tables.length>5){const r=this.CostCenterFieldsAllTables.Tables[0],d=this.CostCenterFieldsAllTables.Tables[5];if(Array.isArray(d)&&d.length>0){this.costCenterTableZero=[...r,...d];for(let c of d){const n=Number(c.CostCenterColID);isNaN(n)||this.lstContactFields.push(n)}}}const o=[...this.costCenterTableZero];o.sort((r,d)=>r.ResourceData.localeCompare(d.ResourceData)),this.ImportCols[1].ComboData=o,this.grData.RefreshColumns(),95===t&&this.ImportCols[1].ComboData.sort((r,d)=>r["ResourceData asc"].localeCompare(d["ResourceData asc"]));for(let r=0;r<this.grData.Table.length;r++)this.grData.Table[r][1]="0";this.RefreshGrid=!this.RefreshGrid,this.BankAccounts.Visible=70==t,this.DoNotCreateCCVisibility=!0,this.TemplateGrid=(new wt).BuildGrid(N.J0.Int(this.Feature.SelectedValue.toString()),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),t>4e4&&t<5e4&&Object.keys(this.CostCenterFieldsAllTables.length>0?this.CostCenterFieldsAllTables[2]:{}).includes("IsInventory")&&(this.ValidateVisible=!0)}}AddTransferFromToRows(e){const i=parseInt(this.Feature.SelectedValue);if(!e||0===e.length)return;let l=e.filter(s=>{const u=N.J0.Int(s.ColumnCostCenterID);return 2===u||3===u||u>=50001&&u<=50075});for(let s of l){const u=N.J0.Int(s.IsTransfer),h=N.J0.Int(s.ColumnCostCenterID);if(!isNaN(u)&&(h>5e3||u>0)){const t={CostCenterColID:-N.J0.Int(s.CostCenterColID),CostcenterID:i,ColumnCostCenterID:h,UserColumnName:"TO"+s.ResourceData,IsColumnUserDefined:"1",SysTableName:s.SysTableName,ColumnDataType:s.ColumnDataType,SysColumnName:s.SysColumnName,ResourceData:"TO"+s.ResourceData};s.ResourceData="From "+s.ResourceData,s.UserColumnName="From "+s.ResourceData,e.push(t)}}-1!==i&&this.costCenterTableZero.sort((s,u)=>s.ResourceData.localeCompare(u.ResourceData))}AddContactsRows(e){const i=parseInt(this.Feature.SelectedValue);if((2==i||3==i||83==i||86==i||89==i||15==i||i>5e4&&i<=50075)&&e.push({CostCenterColID:-16,ColumnCostCenterID:i,IsColumnUserDefined:1,SysTableName:"",ResourceData:"ParentGroupName",UserColumnName:"ParentGroupName",SysColumnName:"ParentGroupName"}),2==i&&"Account Report Template"!=this.Feature.SelectedItem.Name||83==i&&"CRM Customer With Address"==this.Feature.SelectedItem.Name||i>5e4&&i<=50075){let l=I.d.document.GetCostCenterScreenDetails(110);if(null==l)return;if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0)for(let s=0;s<l.Tables[0].length;s++){let u={};this.lstAddressFields.push(N.J0.StringIsNullOrEmpty(l.Tables[0][s].CostCenterColID.toString())?0:N.J0.Int(l.Tables[0][s].CostCenterColID)),u.CostCenterColID=l.Tables[0][s].CostCenterColID.toString(),u.IsColumnUserDefined=1,u.CostCenterID=i,u.SysTableName="COM_Address",u.ResourceData=N.J0.String(l.Tables[0][s].ResourceData),u.UserColumnName=N.J0.String(l.Tables[0][s].UserColumnName),u.SysColumnName=N.J0.String(l.Tables[0][s].SysColumnName),u.ColumnCostCenterID=N.J0.String(l.Tables[0][s].ColumnCostCenterID),e.push(u)}}-1!==i&&e.sort((l,s)=>l.ResourceData.localeCompare(s.ResourceData))}AddProductWiseUOMRows(e){if(3==parseInt(this.Feature.SelectedValue)){if({CostCenterColID:-19,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Name",UserColumnName:"Base_Name",SysColumnName:"Base_Name"}.push(e),{CostCenterColID:-20,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Conversion",UserColumnName:"Base_Conversion",SysColumnName:"Base_Conversion"}.push(e),{CostCenterColID:-21,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitName",UserColumnName:"Conversion_UnitName",SysColumnName:"Conversion_UnitName"}.push(e),{CostCenterColID:-22,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitValue",UserColumnName:"Conversion_UnitValue",SysColumnName:"Conversion_UnitValue"}.push(e),{CostCenterColID:-23,IsColumnUserDefined:0,SysTableName:"",ResourceData:"MultiBarcode",UserColumnName:"MultiBarcode",SysColumnName:"MultiBarcode"}.push(e),{CostCenterColID:-24,IsColumnUserDefined:0,SysTableName:"",ResourceData:"BaseMultiBarcode",UserColumnName:"BaseMultiBarcode",SysColumnName:"BaseMultiBarcode"}.push(e),this.CostCenterFieldsAllTables.length>8&&Object.keys(this.CostCenterFieldsAllTables.Tables[0]).includes("Name")){const d=this.CostCenterFieldsAllTables.Tables[8].find(c=>"BarcodeDimension"==c.Name);if(d&&d.Value&&N.J0.Int(d.Value)>0&&(this.BarcodeDim=N.J0.Int(d[0].Value),this.ShowBarcodeDimension=!0),this.ShowBarcodeDimension){let c={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(c.ColumnCostCenterID=this.BarcodeDim),c.ResourceData="Base_Barcode",c.UserColumnName="Base_Barcode",c.SysColumnName="Base_Barcode",e.push(c);let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(n.ColumnCostCenterID=this.BarcodeDim),n.ResourceData="UOM_Barcode",n.UserColumnName="UOM_Barcode",n.SysColumnName="UOM_Barcode",e.push(n)}else{e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Base_Barcode",UserColumnName:"Base_Barcode",SysColumnName:"Base_Barcode"}),e.push({CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ResourceData:"UOM_Barcode",UserColumnName:"UOM_Barcode",SysColumnName:"UOM_Barcode"})}}}}AddProductVendorWiseMultipleBarcodeRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-23,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:2,ResourceData:"Vendor",UserColumnName:"Vendor",SysColumnName:"Vendor"}),e.push({CostCenterColID:-24,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"ETA",UserColumnName:"ETA",SysColumnName:"ETA"}),e.push({CostCenterColID:-25,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Priority",UserColumnName:"Priority",SysColumnName:"Priority"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min. Order Quantity",UserColumnName:"Min. Order Quantity",SysColumnName:"Min. Order Quantity"}),e.push({CostCenterColID:-26,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Barcode",UserColumnName:"Barcode",SysColumnName:"Barcode"}),e.push({CostCenterColID:-27,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Volume",UserColumnName:"Volume",SysColumnName:"Volume"}),e.push({CostCenterColID:-28,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Weight",UserColumnName:"Weight",SysColumnName:"Weight"});let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"String",ResourceData:"Remarks"};n.UserColumnName=n.SysColumnName="Remarks",e.push(n)}}AddQCProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){if(e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),I.d.SessionManager.Preferences.ContainsKey("TestCaseDimension")&&""!=I.d.SessionManager.Preferences.TestCaseDimension&&N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension)>0){let g={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};g.ColumnCostCenterID=N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension),g.ResourceData="QC Name",g.UserColumnName="QC Name",g.SysColumnName="QC Name",e.push(g);let p={CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:""};p.ColumnCostCenterID=N.J0.Int(I.d.SessionManager.Preferences.TestCaseDimension),p.ResourceData=p.UserColumnName=p.SysColumnName="QC Code",e.push(p)}let u={CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:""};u.ResourceData=u.UserColumnName=u.SysColumnName="Document",e.push(u),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Type",UserColumnName:"Type",SysColumnName:"Type"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min",UserColumnName:"Min",SysColumnName:"Min"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Max",UserColumnName:"Max",SysColumnName:"Max"}),e.push({CostCenterColID:-36,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Probable val",UserColumnName:"Probable val",SysColumnName:"Probable val"}),e.push({CostCenterColID:-37,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Sample",UserColumnName:"Sample",SysColumnName:"Sample"}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ResourceData:"SampleType",UserColumnName:"SampleType",SysColumnName:"SampleType"}),e.push({CostCenterColID:-38,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Observation",UserColumnName:"Observation",SysColumnName:"Observation"}),e.push({CostCenterColID:-39,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Varience",UserColumnName:"Varience",SysColumnName:"Varience"})}}AddKitProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product",UserColumnName:"Kit_Product",SysColumnName:"Kit_Product"}),e.push({CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product_Code",UserColumnName:"Kit_Product_Code",SysColumnName:"Kit_Product_Code"}),e.push({CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Qty",UserColumnName:"Kit_Qty",SysColumnName:"Kit_Qty"}),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_UOM",UserColumnName:"Kit_UOM",SysColumnName:"Kit_UOM"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Rate",UserColumnName:"Kit_Rate",SysColumnName:"Kit_Rate"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_Link",UserColumnName:"Kit_Link",SysColumnName:"Kit_Link"})}}AddAttachemtnRows(e){this.QtyCombo.Visible=!0,this.QtyCombo.Items.push(ie._p.ComboBoxItems_2("Accounts","2")),this.QtyCombo.Items.push(ie._p.ComboBoxItems_2("Products","3"));for(let h=0;h<this.Feature.Items.length;h++)!N.J0.StringIsNullOrEmpty(this.Feature.Items[h].Value)&&(N.J0.Int(this.Feature.Items[h].Value)>5e4&&N.J0.Int(this.Feature.Items[h].Value)<50050||73==N.J0.Int(this.Feature.Items[h].Value)||86==N.J0.Int(this.Feature.Items[h].Value)||92==N.J0.Int(this.Feature.Items[h].Value)||93==N.J0.Int(this.Feature.Items[h].Value)||94==N.J0.Int(this.Feature.Items[h].Value)||95==N.J0.Int(this.Feature.Items[h].Value))&&this.QtyCombo.Items.push(ie._p.ComboBoxItems_2(this.Feature.Items[h].Name,this.Feature.Items[h].Value));(e=[]).push({CostCenterColID:-10,IsColumnUserDefined:1,SysTableName:"",ResourceData:"FileName",UserColumnName:"FileName",SysColumnName:"FileName"});e.push({CostCenterColID:-11,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Description",UserColumnName:"FileDescription",SysColumnName:"FileDescription"});e.push({CostCenterColID:-12,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Code",UserColumnName:"Code",SysColumnName:"Code"});if(e.push({CostCenterColID:-13,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Name",UserColumnName:"Name",SysColumnName:"Name"}),I.d.SessionManager.Preferences.ContainsKey("AttahmentGrid")&&""!=I.d.SessionManager.Preferences.AttahmentGrid){let t=(new DOMParser).parseFromString(I.d.SessionManager.Preferences.AttahmentGrid,"text/xml"),o=-30;const r=t.documentElement?.childNodes||[];for(let d=0;d<r.length;d++){const c=r[d];if(!c&&!c.attributes)continue;const n=c.getAttribute("FieldName");if(n&&""!==n.trim()){o--;let a={CostCenterColID:o,IsColumnUserDefined:1,SysTableName:"",ResourceData:c.getAttribute("Field")||"",UserColumnName:n,SysColumnName:n};if("Type"==n){const p=I.d.SessionManager.Preferences.AttahmentDimType;p&&""!=p&&isNaN(parseInt(p))&&(a.ColumnCostCenterID=parseInt(p))}const g=c.getAttribute("Unique");g&&""!==g.trim()&&(a.IsUnique=g),e.push(a)}}}}AddFollowupRows(e){this.QtyCombo.Visible=!0;for(let l=0;l<this.Feature.Items.length;l++)(73==N.J0.Int(this.Feature.Items[l].Value)||86==N.J0.Int(this.Feature.Items[l].Value)||89==N.J0.Int(this.Feature.Items[l].Value))&&this.QtyCombo.Items.push(ie._p.ComboBoxItems_2(this.Feature.Items[l].Name,this.Feature.Items[l].Value));e.push({CostCenterColID:"-1",ColumnCostCenterID:"0",SysColumnName:"Code",ResourceData:"Code*",UserColumnName:"Code",ColumnDataType:"TEXT"})}AddContractRows(e){if(95==N.J0.Int(this.Feature.SelectedValue)){e.foreach(h=>{h.SysTableName&&h.SysTableName.includes("Particulars")&&(h.ResourceData="Particular_"+h.ResourceData)}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_IsParticulars",UserColumnName:"Particular_IsParticulars",SysColumnName:"Particular_IsParticulars"}),e.push({CostCenterColID:-41,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_SNO",UserColumnName:"Particular_SNO",SysColumnName:"Particular_SNO"}),e.push({CostCenterColID:-42,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"IsOPening",UserColumnName:"IsOPening",SysColumnName:"IsOPening"})}}AddCodeRows(e){const i=N.J0.Int(this.Feature.SelectedValue),l=e.filter(u=>2==u.ColumnCostCenterID||3==u.ColumnCostCenterID||u.ColumnCostCenterID>=50001&&u.ColumnCostCenterID<=50075);let s=l.length;for(let u=0;u<s;u++)if(2==i||3==i||i>5e4){let h={};h.CostCenterColID=-N.J0.Int(l[u].CostCenterColID),h.ColumnCostCenterID=N.J0.Int(l[u].ColumnCostCenterID),h.UserColumnName=l[u].ResourceData+"Code",h.CostCenterID=i,h.IsColumnUserDefined=1,h.SysTableName=l[u].SysTableName,h.SysColumnName=l[u].SysColumnName,h.ResourceData=l[u].ResourceData+"Code",e.push(h)}-1!=i&&(e.sort((u,h)=>{const t=u.ResourceData?u.ResourceData.toString():"",o=h.ResourceData?h.ResourceData.toString():"";return t.localeCompare(o)}),this.grData.RefreshColumns(),this.grData.RefreshGrid=!0)}AddWEFRows(e){let i=N.J0.Int(this.Feature.SelectedValue);const l=e.filter(t=>2==t.ColumnCostCenterID||3==t.ColumnCostCenterID||t.ColumnCostCenterID>=50001&&t.ColumnCostCenterID<=50075);let s=l.length;const h=Object.keys(e.length>0?e:{});for(let t=0;t<s;t++)if(h.includes("UserProbableValues")&&null!=l[t].UserProbableValues&&("H"==l[t].UserProbableValues.toString().toUpperCase()||"HP2"==l[t].UserProbableValues.toString().toUpperCase()||"HP3"==l[t].UserProbableValues.toString().toUpperCase())&&(2==i||3==i||i>5e4)){let o={};o.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"000",o.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),o.UserColumnName=l[t].ResourceData+"_FromDate",o.CostCenterID=i,o.IsColumnUserDefined=1,o.SysTableName=l[t].SysTableName,o.SysColumnName=l[t].SysColumnName+"_FromDate",o.ResourceData=l[t].ResourceData+"_FromDate",e.push(o);let r={};r.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"001",r.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),r.UserColumnName=l[t].ResourceData+"_ToDate",r.CostCenterID=i,r.IsColumnUserDefined=1,r.SysTableName=l[t].SysTableName,r.SysColumnName=l[t].SysColumnName+"_ToDate",r.ResourceData=l[t].ResourceData+"_ToDate",e.push(r);let d={};d.CostCenterColID=N.J0.Int(l[t].CostCenterColID)+"002",d.ColumnCostCenterID=N.J0.Int(l[t].ColumnCostCenterID),d.UserColumnName=l[t].ResourceData+"_Remarks",d.CostCenterID=i,d.IsColumnUserDefined=1,d.SysTableName=l[t].SysTableName,d.SysColumnName=l[t].SysColumnName+"_Remarks",d.ResourceData=l[t].ResourceData+"_Remarks",e.push(d)}-1!=i&&e.sort((t,o)=>(t.ResourceData||"").localeCompare(o.ResourceData||""))}formatDate(e){return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"/")}AddGroupSeriesRows(e){let i=N.J0.Int(this.Feature.SelectedValue);if(2==i||3==i||i>5e4){let l={CostCenterColID:-43,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesStart",UserColumnName:"SeriesStart",SysColumnName:"SeriesStart"};e.push(l),e.push({CostCenterColID:-44,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesEnd",UserColumnName:"SeriesEnd",SysColumnName:"SeriesEnd"});let u={CostCenterColID:-45,IsColumnUserDefined:1,SysTableName:"COM_CCCCData"};l.ColumnDataType="INT",u.ResourceData="IsManual",u.UserColumnName="IsManual",u.SysColumnName="IsManual",e.push(u)}}OnBrowsefile(e){if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const i=new FileReader,l=e.target.files[0],s=this.ActualFileName;this.ActualFileName=l.name;const u=I.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=u&&u.Tables.length>0&&u.Tables[0].length>0&&(this.ProfileName.Text=u.Tables[0].profileName),this.IsLoad&&this.ProfileID>0&&u.Tables.length>0&&!Object.keys(u.tables[0]).includes("ErrorMessage")&&u.Tables[0].length>0)return this.ActualFileName=s,this.DisplayMessage=`File name mismatch, select file name (${this.ProfileName.Text})`,void(this.MessageVisibility=!0);i.onload=h=>{const r=et.LF(i.result,{type:"binary",cellDates:!0});this.workbookK=r;const d=this.ActualFileName.split(".")[0].trim().toLowerCase(),c=r.SheetNames.find(a=>a.trim().toLocaleLowerCase()==d);if(!c)return this.DisplayMessage=`${d} is not a valid name. Make Sure that it does not Includes Invalid Characters or punctuation and it is not too long`,void(this.MessageVisibility=!0);const n=r.Sheets[c];this.worksheetWS=n,this.ExcelData=et.Wp.sheet_to_json(n,{header:1}),this.ExcelTable=this.ExcelData,this.dsexcel=this.ExcelData;try{this.ActualFileName=e.target.value,this.DtImport.Clear();for(let a=0;a<this.ExcelData[0].length;a++){let g=this.grData.NewRow();this.grData.addRow(g),g.FieldName=this.ExcelData[0][a],this.grData.updateRow(g)}if(this.ExcelTable.length>0&&(this.ExcelDataColumn=this.ExcelTable[0],this.ExcelTable.splice(0,1)),!N.J0.IsEmpty(this.ImportCols[1].DefaultValueText)){let a=new N.VB;if(a.LoadXml(this.ImportCols[1].DefaultValueText),null!=a)for(let g=0;g<a.DocumentElement.children.length;g++){const p=a.DocumentElement.children[g];for(let T=0;T<this.DtImport.length;T++)(T+1).toString()==p.attributes[0].value&&(this.DtImport[T].FeatureFieldName=N.J0.String(p.attributes[2].value),this.grData.updateRow(this.DtImport[T]))}}0!=this.ProfileID&&(this.isEdit||this.IsLoad)&&(Logger.InfoLog("after ProfileID != 0 && (isEdit || IsLoad)  check..."),Logger.InfoLog("before ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),null!=u&&u.Tables.length>0&&!u.Columns[0].Contains("ErrorMessage")?(Logger.InfoLog("after ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),this.ProfileName.Text=u.Tables[0][0].ProfileName.toString(),this.IsLoad&&this.ProfileID>0&&this.ActualFileName!=u.Tables[0][0].FileName.toString()&&"1"!=I.d.SessionManager.RoleID?this.DisplayMessage="File name mismatch, select file name ("+u.Tables[0][0].FileName.toString()+") ":""!=u.Tables[0][0].Structure.toString()&&this.ReadStructure(u.Tables[0][0].Structure.toString(),!0),Logger.InfoLog("end... ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check...")):u.Columns[0].Contains("ErrorMessage")&&u.Tables[0].length>0&&Logger.InfoLog("ds.Columns[0].Contains(ErrorMessage) :: "+u.Tables[0][0].ErrorMessage.toString())),parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&this.costCenterTableZero.Contains("CostCenterColID")&&null!=this.ExcelTable&&0==this.QtyCombo.Items.length&&0==this.RateCombo.Items.length&&this.FillQtyRateCombo()}catch(a){return void(this.DisplayMessage=a.Message)}},i.readAsBinaryString(l)}OnExportFile(e,i){this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";let l={};i.InitPrintOrExport(l),l.Type=e,l.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"","PDF"==e?l.lst=[]:"Print"==e?(l.lst=[],l.Type="PDF"):("Excel"==e||"OpenXML"==e)&&(l.lst=[]),l.al="al",I.d.report.ExportReport(i.Data,i.ReportColumns,l,"AccDrillDown").subscribe(s=>{"Print"==e?I.d.SessionManager.printTab(s.FileName):(I.d.SessionManager.Download(s.FileName,"khasim"),N.J0.IsEmpty(s.Message)&&!N.J0.IsEmpty(s.FileName)&&(this.DisplayMessage="Exported Successfully"))},s=>{})}ScanDocument(e,i,l,s){let u=this.costCenterTableZero,c=[],n=["50001","50002","50008","50009"];for(let a=0;a<this.ExcelTable.length;a++)for(const g of this.grData.Table){if(null==g[1]||""==g[1].toString()||"0"==g[1].toString())continue;const p=u.find(T=>T.CostCenterColID?.toString()===g[a]?.toString());if(p&&p.ColumnDataType){const T=p.ColumnDataType.toUpperCase(),m=g[0],S=this.ExcelData[a][m]?.toString().trim()||"",F=p.ResourceData;switch(T){case"DATE":if("DocDate"==p.SysColumnName){if(this.VoucherNoField&&(!S||!this.ExcelTable[a][this.VoucherNoField].toString().Trim()&&isNaN(Date.parse(S))))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} date expected `,this.MessageVisibility=!0,!1}else if(S&&isNaN(Date.parse(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} date expected `,this.MessageVisibility=!0,!1;break;case"FLOAT":if(S&&isNaN(Date.parse(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1;const y=p.SysColumnName.toLowerCase();"quantity"==y?this.QtyField=m:"rate"==y?this.RateField=m:"avgrate"==y?(this.isAvgrate=!0,this.RateField=m):"FreeQTY"==y?this.FreeQtyField=m:"gross"==y?(this.GrossField=m,this.GrssFldName=m):"exchangerate"==y?this.ExhgRateFieldName=m:"avgratevalue"==y&&(this.GrossField=this.GrssFldName=m);break;case"INT":if("DocNumber"===p.SysColumnName.toLowerCase()&&(this.DocNumberField=m),S&&isNaN(N.J0.Int(S)))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1;break;case"COMBOTEXT":if(this.VoucherNoField=m,S){const f=S.split(this.Delimiter?this.Delimiter[0]:" ");if(!f[f.length-1]||isNaN(N.J0.Int(f[f.length-1])))return this.DisplayMessage=`Invalid ${F} at Row:" ${a+1} ${S} numeric expected `,this.MessageVisibility=!0,!1}break;case"STR":"DocPrefix"==p.SysColumnName.toLowerCase()&&(this.DocPrefixField=m);break;case"STRING":if("refno"==p.SysColumnName.toLowerCase()){const f=this.grData.Table.filter(b=>"-501"===b.FeatureFieldName);if(f.length>0&&!this.ccdv.includes[400]){let b="",x="";for(let w=0;w<this.ExcelTable.length;w++)b+=(b?",":"")+`'${this.ExcelTable[w][m]}'`,x+=(x?",":"")+`'${this.ExcelTable[w][f[0][0]]}'`;const R=this.ScreenObject.GetLinkDefDetails(N.J0.Int(this.Feature.SelectedValue),0,b,"",x,"");null!=R&&R.Tables.length>0&&(this.ccdv[400]=R.Tables[0]),null!=R&&R.Tables.length>4&&(this.ccdv[400]=R.Tables[5])}}break;case"PRODUCTSTRING":""==this.ProductFieldName&&(this.ProductFieldName=g.FieldName.toString()),this.CheckProductExtraField(a,3,this.ProductFieldName,u[0].SysColumnName.toString(),!1,this.IsCode);break;case"COSTCENTERSTRING":this.CheckCostCenterExtraField(a,N.J0.Int(u[0].CostCenterID.toString()),g.FieldName.toString(),u[0].CostCenterName.toString(),u[0].SysColumnName.toString(),!1,this.IsCode);break;case"LISTBOX":if(!(this.ProfileID>-20&&this.ProfileID<0&&n.Contains(u[0].ColumnCostCenterID.toString()))&&2!=N.J0.Int(u[0].ColumnCostCenterID.toString())&&3!=N.J0.Int(u[0].ColumnCostCenterID.toString())){if(s&&I.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&I.d.SessionManager.Preferences.POSItemCodeDimension==u[0].ColumnCostCenterID.toString())continue;i&&l>0&&l==N.J0.Int(u[0].ColumnCostCenterID.toString())?this.BinDimFieldName=m:this.CheckCostCenterField(a,N.J0.Int(u[0].ColumnCostCenterID.toString()),g.FieldName.toString(),!1,this.IsCode)}if("debitaccount"==p.SysColumnName.toLowerCase())this.DrAccFieldName=m;else if("debitaccountcode"==p.SysColumnName.toLowerCase())this.DrAccFieldName=m,this.IsDrFieldCode=!0;else if("creditaccount"==p.SysColumnName.toLowerCase())this.CrAccFieldName=m;else if("currencyid"==p.SysColumnName.toLowerCase())this.CurrencyFieldName=m;else if("creditaccountcode"==p.SysColumnName.toLowerCase())this.CrAccFieldName=m,this.IsCrFieldCode=!0;else if("productid"==p.SysColumnName.toLowerCase()&&1!=this.ProfileID)""==this.ProductFieldName&&(this.ProductFieldName=m),Object.keys(u[0]).includes("parentccdefaultcolid")&&"261"==u[0].parentccdefaultcolid.toString().toLowerCase()?(this.ProductFieldName=m,this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(a,3,this.ProductFieldName,!1,!0):this.CheckCostCenterField(a,3,this.ProductFieldName,!1,!0))):this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(a,3,this.ProductFieldName,!1,!1):this.CheckCostCenterField(a,3,this.ProductFieldName,!1,!1));else if("Unit"==p.SysColumnName.toLowerCase()){this.UnitFieldName=m;let f=`${m}_key`,b="";if(!Object.prototype.hasOwnProperty.call(this.ExcelTable[a],f)){for(let R of this.ExcelTable)R[f]="";const x=N.J0.Int(p.ColumnCostCenterID);this.temp[x]||(this.temp[x]=[])}if(""!=S){let R=this.CostCenterFieldsAllTables.Tables[4];const w=S,U=this.ExcelData[a][this.ProductFieldName]?.toString().trim().replaced(/'/g,"''")||"";let V=[];if(this.IsCode?(""!==this.ProductFieldName&&(V=R.filter(_=>_.unitName===w&&_.productCode===U)),"Product Code"==this.ProductFieldName?V=R.filter(_=>_.unitName===w&&_.productCode===U):"Product Name"==this.ProductFieldName&&(V=R.filter(_=>_.unitName===S&&_.productName===U)),(0==V.length||""==this.ProductFieldName)&&(V=R.filter(_=>_.unitName===w&&(!_.productName||"DynamicSet"==_.productName)))):(""!==this.ProductFieldName&&(V=R.filter(_=>_.unitName===w&&_.productCode===U)),"Product Code"==this.ProductFieldName?V=R.filter(_=>_.unitName===w&&_.productCode===U):"Product Name"==this.ProductFieldName&&(V=R.filter(_=>_.unitName===S&&_.productName===U)),(0==V.length||!this.ProductFieldName)&&(V=R.filter(_=>_.unitName===w&&(!_.productName||"DynamicSet"==_.productName)))),V.length>0)this.ExcelTable[a][f]=V[0].UOMID.toString();else{const _=N.J0.Int(p.ColumnCostCenterID),Z=w.toLowerCase();this.temp[_].includes(Z)||(this.temp[_].push(Z),b+=`<Row  PrimaryKey='0' UName='" ${w}'  ConversionRate='1' MapAction='NEW' />`)}}if(""!=b){b=`<XML>${b}</XML>`;const R=I.d.document.AddUOMWithDataset(["",0,b,1,I.d.SessionManager.CompanyGUID,I.d.SessionManager.UserName,I.d.SessionManager.RoleID,I.d.SessionManager.LanguageID]);if(null!=R&&R.Tables.length>0&&Object.keys(R.Tables[0]).includes("ErrorMessage"))return this.DisplayMessage=R.Tables[0].Rows[0].ErrorMessage.toString(),!1;for(let w=0;w<R.Tables[0].length;w++){const U=Object.keys(R.Tables[0][w]).includes("UnitName"),V=Object.keys(R.Tables[0][w]).includes("UOMID");for(let _ of this.ExcelTable)_[f]==U&&(_[f]=V)}}}break;case"TEXT":const C=N.J0.Int(p.ColumnCostCenterID);44==C?this.CheckLookupField(a,N.J0.Int(p.ColumnCCListViewTypeID),m):C>0&&this.CheckCostCenterField(a,N.J0.Int(p.ColumnCostCenterID),m,!1,this.IsCode)}}if(e&&!c.includes(this.ExcelTable[a])&&""!=this.ProductFieldName&&""!=this.QtyFldName){let T="";""!=this.VoucherNoField?T+=`[${this.VoucherNoField}]='  ${this.ExcelTable[a][this.VoucherNoField].replace(/'/g,"''")}' and `:""!=this.DocPrefixField&&""!=this.DocNumberField?(T+=`[${this.DocPrefixField}]='  ${this.ExcelTable[a][this.DocPrefixField].replace(/'/g,"''")}' and `,T+=`[${this.DocNumberField}]='  ${this.ExcelTable[a][this.DocNumberField].replace(/'/g,"''")}' and `):""!=this.DocNumberField&&(T+=`[${this.DocNumberField}]='  ${this.ExcelTable[a][this.DocNumberField].replace(/'/g,"''")}' and `),""!=this.UnitFieldName&&(T+=`[${this.UnitFieldName}]='  ${this.ExcelTable[a][this.UnitFieldName].replace(/'/g,"''")}' and `),T+=`[${this.ProductFieldName}]='  ${this.ExcelTable[a][this.ProductFieldName].replace(/'/g,"''")}' `;const m=this.ExcelTable.filter(F=>{try{return new Function("row",`return ${T.replace(/\[|\]/g,"row['").replace(/=/g,"']==")}`)(F)}catch{return!1}}),S=this.grData.Table.filter(F=>"-25"==F.FeatureFieldName);if(m.length>1&&0===S.length){let F=0,y=0,C="";for(let b=1;b<m.length;b++){const x=m[b];x[this.QtyFldName]&&(F+=parseFloat(x[this.QtyFldName])||0),x[this.GrssFldName]&&(y+=parseFloat(x[this.GrssFldName])||0),this.BinDimFieldName&&x[this.BinDimFieldName]&&(C+=","+x[this.BinDimFieldName]),c.push(x)}const f=m[0];f[this.QtyFldName]=""!=f[this.QtyFldName].toString()?parseFloat(f[this.QtyFldName].toString())+F:F,f[this.GrssFldName]=""!=f[this.GrssFldName].toString()?parseFloat(f[this.GrssFldName].toString())+y:y,""!=this.BinDimFieldName&&(f[this.BinDimFieldName]=f[this.BinDimFieldName].toString()+C,this.CheckCostCenterField(this.ExcelTable.indexOf(f),l,this.BinDimFieldName,!1,!1))}else""!=this.BinDimFieldName&&this.CheckCostCenterField(a,l,this.BinDimFieldName,!1,!1)}}for(const a of c)this.ExcelTable.splice(this.ExcelTable.indexOf(a),1);return!0}FillAccountValues(){this.isCreditRowAdded&&this.GetDocumentReferenceData("CreditAccount"),this.isDebitRowAdded&&this.GetDocumentReferenceData("DebitAccount")}MapDebitCreditAccountFields(){let e=this.CostCenterFieldsAllTables.Tables[0],i=" ",l=" ";for(const s of this.grData.Table){if(!s[1]||""==s[1].toString()||"0"==s[1].toString())continue;const u=s[1]?.toString();if(u){const h=e.filter(t=>t.CostCenterColID?.toString()===u);if(h.length>0&&null!=h[0].ColumnDataType&&"LISTBOX"===h[0].ColumnDataType.toString().toUpperCase()){const o=h[0].SysColumnName?.toString().toLowerCase();"debitaccount"==o?i=s[0].toString():"debitaccountcode"==o?(i=s[0].toString(),this.IsDrFieldCode=!0):"creditaccount"==o?l=s[0].toString():"creditaccountcode"==o&&(l=s[0].toString(),this.IsCrFieldCode=!0)}}if(""==i){const h=this.CostCenterFieldsAllTables.Tables[0].filter(t=>"DebitAccount"===t.SysColumnName);if(h.length>0){const t=h[0].UserDefaultValue?.toString()||"",o=h[0].LINKDATA?.toString()||"";if(t&&"0"!=t||o){this.ExcelTable.includes(h[0].SysColumnName.toString())||(this.ExcelTable.push(h[0].SysColumnName.toString()),this.ExcelTable.push(h[0].SysColumnName.toString()+"_Key"));const r=[];r[1]=h[0].CostCenterColID.toString(),r[0]=i=h[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(r)}}}if(""==l){const h=this.CostCenterFieldsAllTables.Tables[0].filter(r=>"CreditAccount"===r.SysColumnName),t=h[0].UserDefaultValue?.toString()||"",o=h[0].LINKDATA?.toString()||"";if(h.length()>0&&(t&&"0"!==t||o)){this.ExcelTable.includes(h[0].SysColumnName.toString())||(this.ExcelTable.push(h[0].SysColumnName.toString()),this.ExcelTable.push(h[0].SysColumnName.toString()+"_Key"));const r=[];r[1]=h[0].CostCenterColID.toString(),r[0]=i=h[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(r)}}}}GetDocumentReferenceData(e){const i=this.CostCenterFieldsAllTables.Tables[0].filter(l=>l.SysColumnName===e);if(i.length>0){const l=i[0].UserDefaultValue,s=i[0].LINKDATA,u=N.J0.Int(this.Feature.SelectedValue);if(l&&""!==l.toString()&&"0"!==l.toString()){const h=I.d.document.GetDataSet(`SELECT AccountName,AccountID FROM Acc_Accounts with(nolock) where Accountid='${l}'`);if(!(h&&h.Tables.length>0))return this.DisplayMessage=`${e} doesn't exists for Master`,void(this.MessageVisibility=!0);for(let t of this.ExcelTable)t[i[0].SysColumnName]=h.Tables[0].Rows[0].AccountName,t[i[0].SysColumnName+"_Key"]=h.Tables[0].Rows[0].AccountID}else if(s&&""!==s.toString()&&"0"!==s.toString()){const h=I.d.document.GetImportLinkRefData(s,u);if(h&&h.Tables.length>0&&h.Tables[0].Rows.length>0){let t=0;""!==h.Tables[0].COSTCENTERID&&(t=h.Tables[0].COSTCENTERID);const o=h.Tables[0].Feature;let r=!1;for(let d of this.grData.Table)if(""!==d[1].toString()){const c=this.CostCenterFieldsAllTables.Tables[0].filter(n=>n.ColumnCostCenterID.toString()===t.toString()&&n.CostCenterColID.toString()===d[1].toString());if(c.length>0&&c[0].ColumnCostCenterID.toString()===t.toString()){for(let n of this.ExcelTable)if(this.ExcelTable.includes(d[0].toString()+"_Key")&&""!==n[d[0].toString()+"_Key"].toString()){const a=h.Tables[1].filter(g=>g.NodeID.toString()===n[d[0].toString()+"_Key"].toString());if(!(a.length>0&&null!=a[0].ACCOUNTNAME))return this.DisplayMessage=`${e} mapping doesn't exists for Product ${n[d[0].toString()]}`,void(this.MessageVisibility=!0);n[i[0].SysColumnName]=a[0].ACCOUNTNAME,n[i[0].SysColumnName+"_Key"]=a[0].AccountID}r=!0;break}}if(!r)return this.DisplayMessage=`Select ${o}`,void(this.MessageVisibility=!0)}}}}CheckProductExtraField(e,i,l,s,u,h){if(i<5e4&&(!u||11===i)&&2!==i&&3!==i&&12!==i)return;let t;this.ExcelDataColumn.includes(l)&&(t=l+"_Key",this.ExcelDataColumn.push(t)),this.ExcelTable.includes(t)||this.ExcelTable.push(t),this.ExcelTable.includes("TempProductName")||this.ExcelTable.push("TempProductName"),this.ExcelTable.includes("TempProductCode")||this.ExcelTable.push("TempProductCode"),this.ccdv.includes(i)||(this.ccdv.push(i,I.d.document.GetCostCenterDetailsBYCostCenterID(i,s).Tables[0]),this.CCQuery.push(i,""),this.COls.push(i,t),this.temp.push(i,[]));try{const o=this.ExcelTable[e][0][l]?.toString().trim().replace(/'/g,"''")||"",r=+this.Feature.SelectedValue;this.ccdv[i].RowFilter=r>4e4&&r<5e4&&""!==s?`${s}='${o}'`:this.IsCode?`Code='${o}'`:`Name='${o}'`}catch(o){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+o.toString())}this.ccdv[i].length>0&&(this.ExcelTable[e][t]=this.ccdv[i][0].NodeID,this.ccdv[i][0].Name?this.ExcelTable[e].TempProductName=this.ccdv[i][0].Name:this.ExcelTable[e].TempProductCode=this.ccdv[i][0].Code)}CheckCostCenterExtraField(e,i,l,s,u,h,t){if(i<5e4&&(!h||11==i)&&2!=i&&3!=i&&12!=i)return;let o;this.ExcelDataColumn.includes(l)&&(o=l+"_Key",this.ExcelDataColumn.push(o)),this.ExcelDataColumn.includes(o)||this.ExcelDataColumn.push(o),this.ccdv.hasOwnProperty(i)||(this.ccdv.push({[i]:I.d.document.GetCostCenterDetailsBYCostCenterID(i,u).Tables[0]}),this.CCQuery.push({[i]:""}),this.COls.push({[i]:o}),this.temp.push({[i]:[]}));try{const r=this.ExcelTable[e][l]?.toString().trim().replace(/'/g,"''")||"",d=+this.Feature.SelectedValue;d>4e4&&d<5e4&&""!==u&&this.ccdv[0][i].filter(n=>n.SCOLName==r)}catch(r){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+r.toString())}this.ccdv[i].length>0&&(this.ExcelTable[e][o]=this.ccdv[i][0].NodeID)}CheckCostCenterField(e,i,l,s,u){let h,t;if(i<5e4&&(!s||11==i)&&93!=i&&92!=i&&94!=i&&95!=i&&83!=i&&2!=i&&3!=i&&5!=i&&6!=i&&7!=i&&12!=i&&72!=i&&77!=i&&76!=i)return;if(this.ExcelDataColumn.includes(l)&&(t=l+"_Key"),3==i&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){let r=this.ExcelDataColumn[l].ColumnName+"_PrdTypeID";this.ExcelDataColumn.Contains(r)||this.ExcelDataColumn.push(r)}38==this._DocumentType&&(0!=this.PosRegisterDim&&this.PosRegisterDim==i&&(this.PosRegisterField=l),0!=this.PosShiftDim&&this.PosShiftDim==i&&(this.PosShiftField=l)),this.ExcelDataColumn.Contains(t)||this.ExcelDataColumn.push(t),12==i&&(this.ExcelDataColumn.Contains("ExchangeRate")||this.ExcelDataColumn.push("ExchangeRate")),this.ccdv.find(r=>r.hasOwnProperty(i))||(this.ccdv.push({[i]:I.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0]}),this.CCQuery.push({[i]:""}),this.CCQueryData.Items.push(ie._p.ComboBoxItems_3(l,"",i.toString())),this.COls.push({[i]:t}),this.temp.push({[i]:[]}));try{let r=this.ExcelDataColumn.indexOf(l);const d=this.ExcelTable[0][r]?.toString().trim().replace(/'/g,"''");let c=[];if(c=this.ccdv.find(a=>a.hasOwnProperty(i))[i],c)if("95"==this.Feature.SelectedValue&&93==i&&d){const a=d.substring(0,d.indexOf(",")).trim();h=c.filter(u?g=>g.Code==a:g=>g.Name==a)}else h=c.filter(12==i?a=>a.Name==d:u?a=>a.Code==d:a=>a.Name==d)}catch(r){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+r.toString())}const o=h;if(h.length>0)this.ExcelTable[e][t]=o[0].NodeID,u&&this.ExcelDataColumn.includes(l+"_Name")&&(this.ExcelTable[e][l+"_Name"]=o[0].Name),!this.ExcelDataColumn.includes(l+"_Curr")&&o.includes("Curr")&&this.ExcelDataColumn.push(l+"_Curr"),!this.ExcelDataColumn.includes(l+"_Exch")&&o.includes("Exch")&&this.ExcelDataColumn.push(l+"_Exch"),this.ExcelDataColumn.includes(l+"_Curr")&&o.includes("Curr")&&(this.ExcelTable[e][l+"_Curr"]=o[0].Curr),this.ExcelDataColumn.includes(l+"_Exch")&&o.includes("Exch")&&(this.ExcelTable[e][l+"_Exch"]=o[0].Exch),this.ExcelDataColumn.includes(l+"_PrdTypeID")&&o.includes("PrdTypeID")&&(this.ExcelTable[e][l+"_PrdTypeID"]=o[0].PrdTypeID),12==i&&(this.ExcelTable[e].ExchangeRate=o[0].ExchangeRate);else{const r=this.ExcelTable[e][this.ExcelDataColumn.indexOf(l)]?.toString().trim();let d=this.temp.find(c=>c.hasOwnProperty(i));if(r&&r.length>0&&!Object.keys(this.temp[d]).includes(r)){this.temp.push({[i]:r});const c=this.grData.Table.filter(a=>a.FieldName===l&&"-16"===a.FeatureFieldName),n=` <Row AccountName="${k.Dw.GetValidXml(r.replace(/'/g,"''"))}"${c.length>0?' IsGroup="1"':""} ></Row> `;this.CCQuery.push({[i]:this.CCQuery[i]+n});for(let a of this.CCQueryData.Items)if(a.Parent===i.toString()){a.Value+=`${r}~${e+1},`;break}}}}CheckBulkCostCenterField(e,i,l,s,u){if(2===i||3===i){let h;if(this.ExcelDataColumn.includes(l)&&(h=l+"_Key",this.ExcelDataColumn.push(h)),this.ExcelTable.includes(h)||this.ExcelTable.push(h),!this.ccdv.includes(i)){const t=I.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0];this.ccdv.push(i,t),this.CCQuery.push(i,""),this.CCQueryData.Items.push(ie._p.ComboBoxItems_3(l,"",i.toString())),this.COls.push({ColCCId:h}),this.temp.push({ColCCId:[]})}try{const t=this.ExcelTable[e][l]?.toString().trim().replace(/'/g,"''")||"";this.ccdv[i].RowFilter=this.IsCode?`Code='${t}'`:`Name='${t}'`}catch(t){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+t.toString())}if(this.ccdv[i].length>0)this.ExcelTable[e][h]=this.ccdv[i][0].NodeID,u&&this.ExcelTable.includes(`${l}_Name`)&&(this.ExcelTable[e][`${l}_Name`]=this.ccdv[i][0].Name),!this.ExcelTable.includes(`${l}_Curr`)&&this.ccdv[i].Table.Columns.includes("Curr")&&this.ExcelTable.push(`${l}_Curr`),!this.ExcelTable.includes(`${l}_Exch`)&&this.ccdv[i].Table.Columns.includes("Exch")&&this.ExcelTable.push(`${l}_Exch`),this.ExcelTable.includes(`${l}_Curr`)&&this.ccdv[i].Table.Columns.includes("Curr")&&(this.ExcelTable[e][`${l}_Curr`]=this.ccdv[i][0].Curr),this.ExcelTable.includes(`${l}_Exch`)&&this.ccdv[i].Table.Columns.includes("Exch")&&(this.ExcelTable[e][`${l}_Exch`]=this.ccdv[i][0].Exch);else{const t=this.ExcelTable[e][l]?.toString().trim()||"";if(!this.temp[i].includes(t)&&t.length>0){this.temp[i].push(t),this.grData.Table.filter(r=>r.FieldName===l&&"-16"===r.FeatureFieldName).length>0?this.CCQuery.push(i,this.CCQuery[i]+` <Row AccountName="${k.Dw.GetValidXml(t.replace(/'/g,"''"))}" IsGroup="1" ></Row> `):this.CCQuery.push(i,this.CCQuery[i]+` <Row AccountName="${k.Dw.GetValidXml(t.replace(/'/g,"''"))}" ></Row> `);for(const r of this.CCQueryData.Items)if(r.Parent===i.toString()){r.Value+=`${t}~${e+1},`;break}}}}}CheckLookupField(e,i,l){let s,u;if(this.ExcelDataColumn.includes(l)&&(s=l+"_Key",this.ExcelDataColumn.push(s)),this.ExcelTable[e].includes(s)||this.ExcelTable[e].push(s),!this.lookupdv.includes(i)){const h=I.d.report.GetDataTable("IMP002",String(i));this.lookupdv.push({[i]:h}),this.lookupQuery.push({[i]:""}),this.COls.push({[i]:s}),this.lookuptemp.push({[i]:[]})}try{let h=this.ExcelDataColumn.indexOf(l);const t=this.ExcelTable[e][h]?.toString().trim().replace(/'/g,"''")||"";u=this.lookupdv[0][i].filter(o=>o.Name==t)}catch(h){Logger.ErrorLog("ImportUtilityViewModel:: CheckLookupField"+h.toString())}if(u.length>0)this.ExcelTable[e][s]=u[0].NodeID;else{const h=this.ExcelTable[e][l]?.toString().trim()||"";!this.lookuptemp[0][i].includes(h)&&h.length>0&&(this.lookuptemp[0][i].push(h),this.lookupQuery.push(i,this.lookupQuery[0][i]+` <Row lookup="${k.Dw.GetValidXml(h.replace(/'/g,"''"))}" ></Row> `))}}CheckAssignedCostCenters(e,i,l,s){if(i<5e4&&7!=i)return;let u=this.ExcelTable[l].ColumnName+"_Key";this.ExcelTable.includes(u)||this.ExcelTable.push(u),this.ccdv.includes(i)||(I.d.document.GetCostCenterDetailsBYCostCenterID(i,""),this.CCQuery.push(i,""),this.COls.push(i,u),this.temp.push(i,[]));let h=this.ExcelTable[e][l].toString().replace(/'/g,"''")||"";if(h.length>0){let t=h.split(",");h="",("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==i&&(h+="<XML>");for(let o=0;o<t.length;o++){if(this.ccdv[i].RowFilter=s?"Code='"+t[o].Trim()+"'":"Name='"+t[o].Trim()+"'",0==this.ccdv[i].length&&"3"==this.Feature.SelectedValue&&i>5e4&&i<59999&&!this.DoNotCreateCostCenter){let r=I.d.document.SetImportDataWithDataset('<XML><Row AccountName="'+t[o].Trim()+'" ></Row> </XML>',i.toString(),this.IsUpdate);null!=r&&r.Tables[0].length>0&&(h+='<Row CostCenterId="'+i+'" NodeID="'+r.Tables[0][0].NodeID.toString()+'" />')}this.ccdv[i].length>0&&(h+="92"!=this.Feature.SelectedValue&&"93"!=this.Feature.SelectedValue||7!=i?'<Row CostCenterId="'+i+'" NodeID="'+this.ccdv[i][0].NodeID.toString()+'" />':'<Row UserID="'+this.ccdv[i][0].NodeID.toString()+'" />')}("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==i&&(h+="</XML>"),h.length>0&&(this.ExcelTable[e][u]=h)}}FillCostCenterFields(e){let i=!1;for(const[l,s]of Object.entries(this.CCQuery))if(""!==s){let u=!1;if(this.NotesList?.length>0)for(const t of this.NotesList)if(this.ExcelTable[this.COls[l].replace("_Key","")]===t.Note.Label&&t.IsModified){u=!0;break}let h=null;if("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue){if(u){let t=[];t.push(`<XML>${s}</XML>`),t.push(l.toString()),t.push(I.d.SessionManager.CompanyIndex),h=I.d.document.SetImportDataWithDataset(`<XML>${s}</XML>`,l.toString(),this.IsUpdate)}}else{let t=[];t.push(`<XML>${s}</XML>`),t.push(l.toString()),t.push(I.d.SessionManager.CompanyIndex),h=I.d.document.SetImportDataWithDataset(`<XML>${s}</XML>`,l.toString(),this.IsUpdate)}if(h?.Tables?.length>0){let t=0;if("3"===this.Feature.SelectedValue)for(let o=0;o<h.Tables.length;o++){const r=h.Tables[o].Columns;if(r[0].ColumnName.toLowerCase().includes("nodeid")&&r[1].ColumnName.toLowerCase().includes("name")){t=o;break}}this.ccdv.push(l,h.Tables[t]),i=!0}}if(i)for(const[l,s]of Object.entries(this.CCQuery))if(""!==s)for(let u=0;u<this.ccdv[l].length;u++)if(e){const h=this.CostCenterFieldsAllTables.Tables[0].filter(o=>o.ColumnCostCenterID==l),t=this.grData;for(const o of h){const r=t.Table.filter(d=>d.FeatureFieldName==o.CostCenterColID);for(const d of r){const c=d[0],n=this.ExcelTable.filter(a=>a[c]===this.ccdv[l][u].Name);for(const a of n)a[`${c}_Key`]=this.ccdv[l][u].NodeID}}}else{const h=this.ExcelTable[this.COls[l].replace("_Key","")],t=this.ExcelTable.filter(o=>o[h]===this.ccdv[l][u].Name);for(const o of t)o[this.COls[l]]=this.ccdv[l][u].NodeID}}FillLookupFields(){let e=!1;for(const i of this.lookupQuery)for(const[l,s]of Object.entries(i))if(""!==s){const u=I.d.document.SetImportLookupData(`<XML>${s}</XML>`,l,I.d.SessionManager.CompanyIndex);this.lookupdv.push(l,u[u.Table.length-1]),e=!0}if(e)for(const i of this.lookupQuery)for(const[l,s]of Object.entries(i))if(""!==s)for(let u=0;u<this.lookupdv[l].length;u++){const h=this.COls[l].replace("_Key",""),t=this.lookupdv[l][u].Name,o=this.ExcelTable.filter(r=>r[h]===t);for(const r of o)r[this.COls[l]]=this.lookupdv[l][u].NodeID}}ConstructFormulaFields(e){let l;if(new At.PE,this.fldDict=new He.bT,l.setFieldDetails("RATE",1,1,"",0,!1,!1),e.set("RATE",l),l.setFieldDetails("NET",2,1,"",0,!1,!1),e.set("NET",l),l.setFieldDetails("AVGRATE",2,1,"",0,!1,!1),e.set("AVGRATE",l),l.setFieldDetails("QTY",3,1,"",0,!1,!1),e.set("QTY",l),l.setFieldDetails("GROSS",3,1,"",0,!1,!1),e.set("GROSS",l),l.setFieldDetails("LASTPURCHASERATE",2,1,"",0,!1,!1),e.set("LASTPURCHASERATE",l),l.setFieldDetails("LASTLANDINGRATE",2,1,"",0,!1,!1),e.set("LASTLANDINGRATE",l),l.setFieldDetails("CONVERSIONQTY",3,1,"",0,!1,!1),e.set("CONVERSIONQTY",l),l.setFieldDetails("UNITS",3,1,"",0,!1,!1),e.set("UNITS",l),l.setFieldDetails("BASEQTY",3,1,"",1,!1,!1),e.set("BASEQTY",l),l.setFieldDetails("FreeQTY",3,1,"",1,!1,!1),e.set("FreeQTY",l),l.setFieldDetails("EXCHANGERATE",3,1,"",0,!1,!1),e.set("EXCHANGERATE",l),this.CostCenterFieldsAllTables.Tables.length>0)for(const s of this.costCenterTableZero){const u=null!==s.IsColumnUserDefined&&""!==s.IsColumnUserDefined.toString()&&"true"===s.IsColumnUserDefined.toString(),h=s.SysColumnName?.toString()||"",t=s.ResourceData?.toString().replace(/\*$/,"")||"";u&&h.includes("dcNum")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l),l.setFieldDetails("Calc"+t,3,1,"",0,!1,!1),e.set("Calc"+t,l)),40067===parseInt(this.Feature.SelectedValue)?(u&&h.includes("dcCCNID")&&(l.setFieldDetails(h,3,1,"",0,!1,!1),e.set(h,l)),u&&h.includes("dcAlpha")&&(l.setFieldDetails(h,3,1,"",0,!1,!1),e.set(h,l))):(u&&h.includes("dcCCNID")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l)),u&&h.includes("dcAlpha")&&(l.setFieldDetails(t,3,1,"",0,!1,!1),e.set(t,l)))}}SetFieldValue(e,i,l){""!=l.Trim()?e[i].setFieldValue(l):e[i].setFieldValue(0)}GetWorkFlow(e){let l=e,s=this.CostCenterFieldsAllTables.Tables[9].filter(u=>1===u.Action||6===u.Action);for(let u=0;u<s.length;u++){if(""===s[u].Expression?.toString().trim())return parseInt(s[u].WorkFlowID);try{null==this.eval&&(this.fldDict=new He.bT);const h=this.eval.EvaluateExpression(s[u].Expression,l);if(null!==h&&"1"===h.toString())return parseInt(s[u].WorkFlowID)}catch(h){Logger.ErrorLog("ImportUtilitViewModel: GetWorkFlow error - "+h.message)}}return 0}BuildCCXML(e,i){let l="<XML>";for(const s of this.grData.Table){if(null===s[1]||""===s[1]||"0"===s[1])continue;const u=i.filter(h=>h.CostCenterColID==s[1]);if(u.length>0){const h=u[0];if(h.IsColumnUserDefined&&"LISTBOX"===h.ColumnDataType){const o=e[`${s[0]}_Key`];if(o&&parseInt(o)>0){const r=parseInt(h.ColumnCostCenterID);(2===r||3===r||r>5e4)&&(l+=`<Row CostCenterID="${r}" NODEID="${o}" />`)}}}}return l+="</XML>",l}CalculateAVGValue(e){e[this.GrossField]=parseFloat(e[this.QtyField])*parseFloat(e[this.RateField])}validateBatchInfo(e){Logger.InfoLog("ValidateBatchInfo: entering Quantity check"),e.forEach(i=>{if(""!==i.BatchID?.toString()){let l=0;l=parseFloat(i.BalQty)||0;const s=this.ExcelTable.filter(u=>u.BatchID===i.BatchID);if(s.length>0){let u=parseFloat(i.BalQty)||0,h=0;s.forEach(t=>{const o=t[this.QtyField];o&&!isNaN(parseFloat(o))&&(h=parseFloat(o),u-=h)}),i.BalQty=u}}}),Logger.InfoLog("ValidateBatchInfo: exiting Quantity check")}addBatchInformation(e){Logger.info("Entering AddBatchInformation");const l=Number(I.d.SessionManager.Preferences["Maintain Dimensionwise Batches"]||0),s=[...this.costCenterTableZero],u=[];let h=!1,t="",o="";for(const r of this.grData.Table){if(!r[1]||"0"===r[1])continue;const d=s.filter(c=>c.CostCenterColID===r[1].toString());if(d.length>0){const c=d[0];l>0&&c.ColumnCostCenterID.toString()===l.toString()?(t=r[0],h=!0):"50002"===c.ColumnCostCenterID.toString()&&I.d.SessionManager.Preferences.EnableLocationWise&&I.d.SessionManager.Preferences["LW Batches"]?o=r[0]:["int","numeric","float"].includes(c.UserColumnType.toLowerCase())&&"0"===c.IsCalculate&&""===c.Formula&&u.push(ie._p.ComboBoxItems_2(r[0],c.UserColumnType.toLowerCase()))}}for(let r=0;r<e.length;r++)try{const d=this.DocDv[r];if(!d[this.ProductFieldName+"_Key"]||"1"===d.IsNewRow)continue;const c=Number(d[this.ProductFieldName+"_Key"]);new Date(d[this.DocDateField]),this.ScreenObject.CostCenterID=Number(this.Feature.SelectedValue),this.ScreenObject.LocationID=0;let a=-1;h&&d[t]&&(a=Number(d[t+"_Key"]||-1)),o&&(this.ScreenObject.LocationID=Number(d[o+"_Key"]));const g=this.ScreenObject.GetProductwiseBatches(c,0,this.VoucherType,null,a,!0,"");let p=Number(d[this.QtyField])||0;const T=Number(d[this.GrossField])||0,m=Number(d[this.RateField])||0;for(const S of u)S.Aliasname=d[S.Name]||"0";if(p>0){let S=p,F=0,C=0;this.validateBatchInfo(g[0]);for(const f of g[0]){if(0===S)break;let b=Number(f.BalQty)||0;if(0===b)continue;const x=()=>{const R={...d};R.BSRNO=r,R.BATCHNUMBER_Sys=f.BATCHNUMBER||"",R.BatchID=f.BatchID||"",R[this.QtyField]=b,this.GrossField&&R[this.RateField]&&(R[this.GrossField]=b*Number(R[this.RateField])),C=b*m;for(const w of u)w.Aliasname&&Number(w.Aliasname)>0&&(R[w.Name]=C/T*Number(w.Aliasname));R.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(d)+1,0,R)};if(S>=b){if(0===F){d.BATCHNUMBER_Sys=f.BATCHNUMBER,d.BatchID=f.BatchID,d[this.QtyField]=b,d.BSRNO=r,this.ExcelTable.includes(this.GrossField)&&d[this.RateField]&&(d[this.GrossField]=b*Number(d[this.RateField])),C=b*m;for(const R of u)R.Aliasname&&Number(R.Aliasname)>0&&(d[R.Name]=C/T*Number(R.Aliasname))}else x();F++,S-=b}else 0===F?(d.BATCHNUMBER_Sys=f.BATCHNUMBER,d.BatchID=f.BatchID,d[this.QtyField]=S):(b=S,x()),F++,S=0}if(S>0&&g[0].length>0){const f={...d};f.BSRNO=r,f.BATCHNUMBER_Sys="",f.BatchID="",f[this.QtyField]=S,f[this.RateField]&&(f[this.GrossField]=S*Number(f[this.RateField])),C=S*m;for(const b of u)b.Aliasname&&Number(b.Aliasname)>0&&(f[b.Name]=C/T*Number(b.Aliasname));f.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(d)+1,0,f)}}}catch(d){Logger.error("AddBatchInformation : "+d.message)}return Logger.info("Exiting AddBatchInformation"),this.ExcelTable}getValidXml(e){return e?.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")||""}importDocumentEdit(){if(0===this.grData.Table.filter(s=>Number(s.FeatureFieldName)>0).length)return this.DisplayMessage="Select atleast one field for Update",void(this.MessageVisibility=!0);let i=0;const l=[...this.costCenterTableZero];for(let s=0;s<this.ExcelTable.length;s++){let u="",h="";for(let r=0;r<this.grData.Table.length;r++){const d=this.grData[r];if(!d.FeatureFieldName)continue;const c=l.find(n=>n.CostCenterColID===d.FeatureFieldName.toString());if(c){const n=this.ExcelTable[s][d.FieldName];Number(d.FeatureFieldName)<0?h+=`${c.SysColumnName}='${n}' AND `:u+=`${c.SysColumnName}='${n}',`}}u.endsWith(",")&&(u=u.slice(0,-1)),h.endsWith("AND ")&&(h=h.slice(0,-4));let t=`UPDATE INV_DocDetails SET ${u}`;h&&(t+=` WHERE ${h}`),t+=`; UPDATE ACC_DocDetails SET ${u}`,h&&(t+=` WHERE ${h}`),I.d.common.GetDataSetQuery(t)&&(i++,this.FailedRecourdList.push({Message:t,Name:""})),this.ImportedCount="Imported :"+(s+1-i),this.FailedCount=`Failed :${i}`}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage=`Import completed ( Total :${this.ExcelTable.length} ${this.ImportedCount} ${this.FailedCount} )`,this.MessageVisibility=!0}ImportDocument(){try{Logger.InfoLog("Entering ImportDocument ");let m,u=!0,h=!1,t=!1,o=!1,r=!1,d=!1,c=!1,n=!1,a=!1,g=0,p=0,T=0,S=0;if(this.CostCenterFieldsAllTables.Tables.length>2&&Object.keys(this.CostCenterFieldsAllTables.Tables[2]).includes("DocumentType")&&(S=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)),this._DocumentType=S,38==this._DocumentType){const y=I.d.document.GetDataSet("\n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                      where Name='Registers'\n  \n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                              where Name='PosShifts' and Value is not null and ISNUMERIC(Value)=1");y&&y.Tables?.length>0&&(y.Tables[0]?.Rows?.length>0&&y.Tables[0].Rows[0].Value&&""!==y.Tables[0].Rows[0].Value.toString()&&(this.PosRegisterDim=Number(y.Tables[0].Rows[0].Value)),y.Tables.length>1&&y.Tables[1].Rows?.length>0&&y.Tables[1].Rows[0].Value&&""!==y.Tables[1].Rows[0].Value.toString()&&(this.PosShiftDim=Number(y.Tables[1].Rows[0].Value))),[1,2,3,4,6,13,25,26,27,31,34,39].includes(S)?this.VoucherType=1:[11,38,5,7,9,24,33,10,8,12].includes(S)&&(this.VoucherType=-1);let C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DonotupdateAccounts"===$.PrefName);if(C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DonotupdateInventory"===$.PrefName),C.length>0&&C[0].PrefValue&&(this.DonotUpdateInventory="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DuplicateProduct_IncrementQuantity"===$.PrefName),C.length>0&&C[0].PrefValue&&(h="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DuplicateProductClubBins"===$.PrefName),C.length>0&&C[0].PrefValue&&(t="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"AutoBatches"===$.PrefName),C.length>0&&C[0].PrefValue&&(o="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DumpStockCodes"===$.PrefName),C.length>0&&C[0].PrefValue&&(d="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DimWiseCurrency"===$.PrefName),C.length>0&&C[0].PrefValue&&"true"===C[0].PrefValue.toLowerCase()){const $=this.CostCenterFieldsAllTables.Tables[3].find(Q=>"CurrencyDim"===Q.PrefName);$&&$.PrefValue&&(p=parseInt($.PrefValue,10))}C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DontSaveIf_QtyIsZero"===$.PrefName),C.length>0&&C[0].PrefValue&&(c="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DontSaveIf_RateZero"===$.PrefName),C.length>0&&C[0].PrefValue&&(a="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"DontSaveIf_ValueZero"===$.PrefName),C.length>0&&C[0].PrefValue&&(a="true"===C[0].PrefValue.toLowerCase()),C=this.CostCenterFieldsAllTables.Tables[3].Rows.filter($=>"BatchBasedon"===$.PrefName),C.length>0&&C[0].PrefValue&&(this.BatchBasedon=C[0].PrefValue),t&&(h=!0),this.CostCenterFieldsAllTables.Tables.length>5&&this.CostCenterFieldsAllTables.Tables[5].Columns.includes("name")&&(C=this.CostCenterFieldsAllTables.Tables[5].Rows.filter($=>"BinsDimension"===$.name),C.length>0&&C[0].value&&parseInt(C[0].value,10)>5e4&&(g=parseInt(C[0].value,10)));let f="",b="",x="",R="",w="",U="",V="",_="";if(this.ProfileID>-20&&this.ProfileID<0){this.ExcelTable.includes("Uniqu")||this.ExcelTable.push("Uniqu");let $=[];if($.push("<XML>"),this.ExcelTable.includes("IsNewRow")){this.ExcelTable.filter(J=>"1"!==J.IsNewRow);for(let J=0;J<this.ExcelTable.length;J++){const Y=this.ExcelTable[J];if(Y.ProductCode&&(!this.ExcelTable.includes("RevenUStatus")||"Passed"!=this.ExcelTable[J].RevenUStatus.toString())){Logger.debug(`ImportUtility-RowNo ${J}`);let xe=`<Row Seq="${J}" `;xe+=`PCode="${k.Dw.GetValidXml(Y.ProductCode)}" `,xe+=`Facility="${k.Dw.GetValidXml(Y.Facility)}" `,this.ExcelTable.includes("businessunit")?xe+=`BUnit="${k.Dw.GetValidXml(Y.businessunit)}" `:this.ExcelTable.includes("businessunit")&&(xe+=`BUnit="${k.Dw.GetValidXml(Y["business unit"])}" `),xe+=`Department="${k.Dw.GetValidXml(Y.Department)}" `,xe+=`WareHouse="${k.Dw.GetValidXml(Y.Store)}" `,xe+=`DocDate="${this.formatDate(Y.DocDate)}" `,Y.Uniqu=Y.DocNo+Y.ProductCode+Y.Department+Y.Store,xe+="/>",$.push(xe)}}$.push("</XML>");const oe=I.d.document.GetTMOImport($);this.ExcelTable.includes("Department_Key")||this.ExcelTable.push("Department_Key"),this.ExcelTable.includes("Store_Key")||this.ExcelTable.push("Store_Key"),this.ExcelTable.includes("Facility_Key")||this.ExcelTable.push("Facility_Key"),this.ExcelTable.includes("businessunit")&&!this.ExcelTable.includes("BusinessUnit_Key")?this.ExcelTable.push("BusinessUnit_Key"):this.ExcelTable.includes("business unit")&&!this.ExcelTable.includes("Business Unit_Key")&&this.ExcelTable.push("Business Unit_Key"),this.ExcelTable.includes("Rate")||this.ExcelTable.push("Rate"),this.ExcelTable.includes("Gross")||this.ExcelTable.push("Gross"),this.ExcelTable.includes("TMOCODE")&&this.ExcelTable.Remove("TMOCODE"),this.ExcelTable.push("TMOCODE");const O=this.costCenterTableZero.filter(J=>"ProductID"==J.SysColumnName);if(O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="TMOCODE",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"dcalpha1"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Uniqu",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"dcalpha1"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Rate",this.grData.Table.push(J)}if(this.costCenterTableZero.filter(J=>"Gross"==J.SysColumnName),O.length>0&&0==this.grData.Table.filter(J=>J.FeatureFieldName+O[0].CostCenterColID.toString()).length){let J={};J[1]=O[0].CostCenterColID.toString(),J[0]="Gross",this.grData.Table.push(J)}this.ExcelTable.includes("TMOCODE_Key")||this.ExcelTable.push("TMOCODE_Key"),this.ExcelTable.includes("Green Code")||this.ExcelTable.push("Green Code"),this.ExcelTable.includes("RevenUReason")||this.ExcelTable.push("RevenUReason"),this.ExcelTable.includes("RevenUStatus")||this.ExcelTable.push("RevenUStatus"),this.ExcelTable.includes("Cr")||this.ExcelTable.push("Cr"),this.ExcelTable.includes("DB")||this.ExcelTable.push("DB"),this.ExcelTable.includes("UOMID")||this.ExcelTable.push("UOMID"),w="CreditAccount",U="DebitAccount";const de=[];for(const J of this.grData.Table){if(null==J[1]||""==J[1].toString()||"0"==J[1].toString())continue;const Y=this.costCenterTableZero.filter(xe=>xe.CostCenterColID===xe[1]);Y.length>0&&("int"==Y[0].UserColumnType.toString().toLowerCase()||"numeric"==Y[0].UserColumnType.toString().toLowerCase()||"float"==Y[0].UserColumnType.toString().toLowerCase())&&null!=Y[0].IsCalculate&&""!=Y[0].IsCalculate.toString()&&"0"==Y[0].IsCalculate.toString()&&""==Y[0].Formula.toString()&&de.push(ie._p.ComboBoxItems_2(J[0].toString(),Y[0].UserColumnType.toString().toLowerCase())),Y.length>0&&"FLOAT"==Y[0].ColumnDataType.toString().ToUpper()&&("quantity"==Y[0].SysColumnName.toString().toLowerCase()?this.QtyField=J[0].toString():"rate"==Y[0].SysColumnName.toString().toLowerCase()?this.RateField=J[0].toString():"avgrate"==Y[0].SysColumnName.toString().toLowerCase()?(this.isAvgrate=!0,this.RateField=J[0].toString()):"FreeQTY"==Y[0].SysColumnName.toString()?R=J[0].toString():("gross"==Y[0].SysColumnName.toString().toLowerCase()||"avgratevalue"==Y[0].SysColumnName.toString().toLowerCase())&&(this.GrossField=J[0].toString()))}let ge=new He.bT,ye=new He.bT;for(m=0;m<this.ExcelTable.length;m++){if(this.ExcelTable.includes("IsNewRow")&&"1"==this.ExcelTable[m].IsNewRow.toString())continue;let J=null;if(J=oe.Tables[0].filter(1==this.VoucherType?Y=>Y.ProductID>0&&Y.Seq===m.toString():Y=>Y.BalQty>0&&Y.Seq===m.toString()),J.length>0){if(this.ExcelTable[m].Facility_Key=J[0].Loc,this.ExcelTable[m].Store_Key=J[0].Store,this.ExcelTable[m].Department_Key=J[0].Dep,this.ExcelTable.includes("businessunit")?this.ExcelTable[m].BusinessUnit_Key=J[0].Div:this.ExcelTable.includes("business unit")&&(this.ExcelTable[m]["Business Unit_Key"]=J[0].Div),this.ExcelTable[m].TMOCODE=J[0].ProductCode,this.ExcelTable[m].TMOCODE_Key=J[0].ProductID,this.ExcelTable[m]["Green Code"]=J[0].GreenCode,this.ExcelTable[m].UOMID=J[0].UOMID,this.ExcelTable[m].Cr=J[0].PurchaseAccountID,this.ExcelTable[m].DB=J[0].ClosingStockAccountID,"5"==J[0].ProductTypeid.toString()){this.ExcelTable.includes("BATCHNUMBER_Sys")||(this.ExcelTable.push("BATCHNUMBER_Sys"),this.ExcelTable.push("BatchID"),this.ExcelTable.push("IsNewRow"),this.ExcelTable.push("BSRNO"));let _t,Ce,Y=0,xe=0,Ke=0,Gt=0,Bt=0,mt=0;if(Y=parseFloat(this.ExcelTable[m][this.QtyField].toString().Trim()),Ke=parseFloat(this.ExcelTable[m][this.GrossField].toString().Trim()),Gt=parseFloat(this.ExcelTable[m][this.RateField].toString().Trim()),xe=Y,1==this.VoucherType){let Ne=I.d.SessionManager.document.GetDataSet('select top 50 a.InvDocDetailsid,uomconvertedqty BalQty,a.docdate,a.BatchID,c.Batchnumber from Inv_DocDetails a with(nolock) join INV_Batches c on a.BatchID=c.BatchID  and c.STATUSID = 77 join com_docccdata b on a.invdocdetailsid=b.invdocdetailsid \n                                          where isqtyignored = 0 and dcCCNID9 = " + drprrows[0]["Store"].toString() + @"  and a.productid = " + drprrows[0]["ProductID"].toString() + ((complete.ContainsKey(drprrows[0]["ProductID"].toString())) ? " and a.InvDocDetailsid not in (" + complete[drprrows[0]["ProductID"].toString()] + ") " : "") + " and vouchertype = -1 order by docdate desc'),Ee=parseFloat(this.ExcelTable[m].Qty.toString().Trim());xe=Ee,mt=0;for(const Se of Ne.Tables[0])if(""!=Se.BatchID.toString()){let Je=0;Je=parseFloat(Se.BalQty.toString());const Le=!1;if(Object.keys(ye).includes(Se.InvDocDetailsid.toString())&&(Je-=ye[Se.InvDocDetailsid.toString()]),Je>0){if(0==mt)Ce=this.ExcelTable[m];else{const ze=this.ExcelTable.filter(it=>it.BSRNO===m.toString()&&it.BatchID===Se.BatchID.toString());if(ze.length>0)Ce=ze[0];else{let it={};for(const Xt of this.ExcelTable)it[Xt.ColumnName]=this.ExcelTable[m][Xt.ColumnName];it.IsNewRow="1",this.ExcelTable.push(it)}}if(mt++,Ee>=Je?(Ce.Qty=Le&&""!=Ce.Qty.toString()?parseInt(Ce.Qty.toString())+Je:Je,Ee-=Je,Object.keys(ge).includes(J[0].ProductID.toString())?ge[J[0].ProductID.toString()]+=","+Se.InvDocDetailsid.toString():ge.push(J[0].ProductID.toString(),Se.InvDocDetailsid.toString()),Object.keys(ye).includes(Se.InvDocDetailsid.toString())&&ye.Remove(Se.InvDocDetailsid.toString())):(Ce.Qty=Le&&""!=Ce.Qty.toString()?N.J0.Int(Ce.Qty.toString())+Ee:Ee,ye.ContainsKey(Se.InvDocDetailsid.toString())?ye[Se.InvDocDetailsid.toString()]+=Ee:ye.push(Se.InvDocDetailsid.toString(),Ee),Ee=0),Ce.BATCHNUMBER_Sys=Se.Batchnumber.toString(),Ce.BatchID=Se.BatchID.toString(),Ce.BSRNO=m,0==Ee)break}}if(Ee>0)if(new Date((new Date).getFullYear()+3,12,31),Ne=I.d.SessionManager.document('declare @lft bigint\n  \n                                      select @lft=BatchID from[INV_Batches] WITH(NOLOCK)\n                                        where[ProductID] = " + drprrows[0]["ProductID"].toString() + @" and[BatchNumber] = \'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\'\n\n                                        if (@lft is null)\n                                        BEGIN\n                                          select @lft=rgt from[INV_Batches] WITH(NOLOCK)\n                                          where batchid = 1\n  \n                                          INSERT INTO[INV_Batches]([BatchNumber], [ExpiryDate], [StatusID], [ProductID], [Depth], [ParentID], [lft], [rgt]\n                                            , [IsGroup], [CompanyGUID], [GUID], [CreatedBy], [CreatedDate])\n                                        VALUES(\'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\', convert(float, convert(datetime, \'" + dtExp.toLocaleDateString("dd/MMM/yyyy") + @"\')), 77, " + drprrows[0]["ProductID"].toString() + @", 1, 1, @lft, @lft + 1, 0, \'admin\', newid(), \'admin\', convert(float, convert(datetime, \'" + new Date().toLocaleDateString("dd/MMM/yyyy") + @"\')))\n      \n                                          select @@identity\n\n                                        update[INV_Batches] \n                                          set rgt = @lft + 2\n                                          where batchid = 1\n                                        END\n                                        ELSE \n                                          select @lft'),null!=Ne&&Ne.Tables.length>0&&Ne.Tables[0].Rows.length>0&&!Ne.Tables[0].includes("ErrorMessage"))if(xe!=Ee){let Le={};for(const ze of this.ExcelTable)Le[ze.ColumnName]=this.ExcelTable[m][ze.ColumnName];Le.IsNewRow="1",Le.BSRNO=m,Le.BatchID=Ne.Tables[0].Rows[0][0].toString(),Le.BATCHNUMBER_Sys="SK"+("5"==J[0].Loc.toString()?"SH":"MCA")+"BATCH",Le.Qty=Ee,this.ExcelTable.push(Le)}else this.ExcelTable[m].BSRNO=m,this.ExcelTable[m].BatchID=Ne.Tables[0].Rows[0][0].toString(),this.ExcelTable[m].Qty=Ee,this.ExcelTable[m].BATCHNUMBER_Sys="SK"+("5"==J[0].Loc.toString()?"SH":"MCA")+"BATCH";else if(xe!=Ee){let Le={};for(const ze of this.ExcelTable)Le[ze.ColumnName]=this.ExcelTable[m][ze.ColumnName];Le.IsNewRow="1",Le.BSRNO=m,Le.BatchID=0,Le.Qty=Ee,this.ExcelTable.push(Le)}}else{var i=oe.Tables[0].Compute("sum(BalQty)","Seq="+m.toString());if(null!=i&&N.J0.Int(i)>=Y){for(let Fe of de)Fe.Aliasname=this.ExcelTable.includes(Fe.Name)&&""!=this.ExcelTable[m][Fe.Name].toString()?this.ExcelTable[m][Fe.Name].toString():"0";for(const Fe of J)if(""!=Fe.BatchID.toString()){let Ne;Ne=0,Ne=parseFloat(Fe.BalQty.toString());let yt=Ne.toString();I.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=I.d.SessionManager.Preferences.DecimalsinQty&&(yt=Ne.toString("N"+I.d.SessionManager.Preferences.DecimalsinQty)),Ne=N.J0.Int(yt);const Ee=this.ExcelTable.filter(Se=>Se.BatchID===Fe.BatchID.toString());if(Ee.length>0){Bt=0;for(let Se=0;Se<Ee.length;Se++)""!=Ee[Se][this.QtyField].toString()&&parseFloat(Ee[Se][this.QtyField].toString())&&(Ne-=Bt)}if(Ne>0){if(0==mt)Ce=this.ExcelTable[m];else{let Se={};for(const Je of this.ExcelTable)Se[Je.ColumnName]=this.ExcelTable[m][Je.ColumnName];Se.IsNewRow="1",this.ExcelTable.push(Se)}mt++,Ce.TMOCODE=Fe.ProductCode,Ce.TMOCODE_Key=Fe.ProductID,Ce["Green Code"]=Fe.GreenCode,Ce.UOMID=Fe.UOMID,Ce.Cr=Fe.PurchaseAccountID,Ce.DB=Fe.ClosingStockAccountID,Y>=Ne?(Ce[this.QtyField]=Ne,Y-=Ne):(Ce[this.QtyField]=Y,Y=0),Ce.BATCHNUMBER_Sys=Fe.Batchnumber.toString(),Ce.BatchID=Fe.BatchID.toString(),Ce.BSRNO=m,this.ExcelTable.includes(this.GrossField)&&""==this.ExcelTable.GrossField.Expression&&""!=Ce.RateField.toString()&&(Ce.GrossField=N.J0.Int(Ne)*N.J0.Int(Ce.RateField)),_t=Ne*Gt;for(const Se of de)null!=Se.Aliasname&&""!=Se.Aliasname.toString()&&N.J0.Int(Se.Aliasname)>0&&(Ce[Se.Name]=_t/Ke*N.J0.Int(Se.Aliasname));if(0==Y)break}}if(Y>0&&xe!=Y){Ce={};for(const Fe of this.ExcelTable)Ce[Fe.ColumnName]=this.ExcelTable[m][Fe.ColumnName];Ce.IsNewRow="1",Ce.BSRNO=m,Ce.QtyField=Y,this.ExcelTable.push(Ce)}}}}}else J=oe.Tables[0].filter(Y=>Y.ProductID&&Y.Seq==m.i.toString()),J.length>0&&(this.ExcelTable[m].Facility_Key=J[0].Loc,this.ExcelTable[m].Store_Key=J[0].Store,this.ExcelTable[m].Department_Key=J[0].Dep,this.ExcelTable.includes("businessunit")?this.ExcelTable[m].BusinessUnit_Key=J[0].Div:this.ExcelTable.includes("business unit")&&(this.ExcelTable[m]["Business Unit_Key"]=J[0].Div),this.ExcelTable[m].TMOCODE=J[0].ProductCode,this.ExcelTable[m].TMOCODE_Key=J[0].ProductID,this.ExcelTable[m]["Green Code"]=J[0].GreenCode,this.ExcelTable[m].UOMID=J[0].UOMID,this.ExcelTable[m].Cr=J[0].PurchaseAccountID,this.ExcelTable[m].DB=J[0].ClosingStockAccountID)}}if(!this.ScanDocument(h,t,g,d))return;if(this.IsInventory=(0,j.yG0)(this.CostCenterFieldsAllTables.Tables[2][0].IsInventory.toString()),""==f&&""==b&&!(this.ProfileID>-20&&this.ProfileID<0))return this.DisplayMessage="Document No. Not Exists",void(this.MessageVisibility=!0);if(""==this.DocDateField)return this.DisplayMessage="Doc Date Not Exists",void(this.MessageVisibility=!0);if(38==this._DocumentType){if(""==this.PosRegisterField)return this.DisplayMessage="Pos register does not Exists",void(this.MessageVisibility=!0);if(""==this.PosShiftField)return this.DisplayMessage="Pos shift does not Exists",void(this.MessageVisibility=!0)}if(16!=S&&17!=S&&28!=S&&29!=S&&3!=S&&8!=S&&13!=S&&31!=S&&32!=S){if(this.FillAccountValues(),""==w)return this.DisplayMessage="Credit account does not Exists",void(this.MessageVisibility=!0);if(""==U)return this.DisplayMessage="Debit account does not Exists",void(this.MessageVisibility=!0)}if(this.IsInventory)if(40062==parseInt(this.Feature.SelectedValue)||40067==parseInt(this.Feature.SelectedValue)||40068==parseInt(this.Feature.SelectedValue)||40051==parseInt(this.Feature.SelectedValue)||40069==parseInt(this.Feature.SelectedValue)||40089==parseInt(this.Feature.SelectedValue))this.QtyField="0",this.GrossField="0",this.RateField="0";else{if(""==this.QtyField)return this.DisplayMessage="Quantity does not Exists",void(this.MessageVisibility=!0);if(c&&(C=this.ExcelTable.filter(oe=>"0"===oe.QtyField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroQty")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0);if(""==this.RateField)return this.DisplayMessage="Rate does not Exists",void(this.MessageVisibility=!0);if(n&&(C=this.ExcelTable.filter(oe=>"0"===oe.RateField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroRate")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0);if(""==this.GrossField)return this.DisplayMessage="Value does not Exists",void(this.MessageVisibility=!0);if(a&&(C=this.ExcelTable.filter(oe=>"0"===oe.GrossField),C.length>0))return this.DisplayMessage=I.d.GetResource("Doc_ZeroValue")+" "+this.ExcelTable.indexOf(C[0])+1,void(this.MessageVisibility=!0)}this.FillLookupFields(),this.DoNotCreateCostCenter||this.FillCostCenterFields(!1);const te=this.costCenterTableZero;te.filter(oe=>"AccountId"===oe.SysColumnName||"AccountIdCode"===oe.SysColumnName);const A=te[0].CostCenterColID,q=te[1].CostCenterColID;if(te.length>1&&2==this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q).length)return this.DisplayMessage="Both Account Code & Name Exists",void(this.MessageVisibility=!0);if(te.filter(oe=>"DebitAccount"===oe.SysColumnName||"DebitAccountCode"===oe.SysColumnName),te.length>1&&2==this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q).length)return this.DisplayMessage="Both DebitAccount Code & Name Exists",void(this.MessageVisibility=!0);if(te.filter(oe=>"CreditAccount"===oe.SysColumnName||"CreditAccountCode"===oe.SysColumnName),te.length>1)return this.grData.Table.filter(O=>O.FeatureFieldName==A||O.FeatureFieldName==q),this.DisplayMessage="Both CreditAccount Code & Name Exists",void(this.MessageVisibility=!0)}let Z=0,W=0;Z=I.d.SessionManager.Preferences["Maintain Dimensionwise stock"].toString();let re=!1;re=I.d.SessionManager.Preferences["Location Stock"];let Re,B=!1,ae="",he="";const E=this.costCenterTableZero;if(re||Z>0)for(const $ of this.grData.Table)null!=$[1]&&""!=$[1].toString()&&"0"!=$[1].toString()&&(E.filter(te=>te.CostCenterColID===te[1].toString()),E.length>0&&Z>0&&E[0].ColumnCostCenterID.toString()==Z.toString()&&(ae=$[0].toString(),B=!0),E.length>0&&re&&"50002"==E[0].ColumnCostCenterID.toString()&&I.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,j.yG0)(I.d.SessionManager.Preferences.EnableLocationWise)&&(he=$[0].toString()));this.DocDv=this.ExcelTable,this.ProfileID>-20&&this.ProfileID<0&&(this.ExcelTable.includes("RevenUStatus")&&this.DocDv.filter($=>null==$.RevenUStatus||"Passed"==$.RevenUStatus),this.ExcelTable.includes("IsNewRow")?this.DocDv.sort(($,Q)=>new Date($[this.DocDateField]||"").getTime()-new Date(Q[this.DocDateField]||"").getTime()||Number($.BSRNO||0)-Number(Q.BSRNO||0)||Number($.IsNewRow||0)-Number(Q.IsNewRow||0)):this.DocDv.sort(($,Q)=>new Date($[this.DocDateField]||"").getTime()-new Date(Q[this.DocDateField]||"").getTime())),!(this.ProfileID>-20&&this.ProfileID<0)&&this.ExcelTable.includes("IMPORT_STATUS")&&this.DocDv.filter($=>null==$.IMPORT_STATUS||"PASS"==$.IMPORT_STATUS),o&&-1==this.VoucherType&&!(this.ProfileID>-20&&this.ProfileID<0)&&(this.ExcelTable.includes("BATCHNUMBER_Sys")||(this.ExcelTable.push("BATCHNUMBER_Sys"),this.ExcelTable.push("BatchID"),this.ExcelTable.push("IsNewRow"),this.ExcelTable.push("BSRNO"),this.ExcelTable=this.addBatchInformation(this.DocDv)));let G,ve,v,ne,ce,Te,je,Ye,me,pe,be,we,Pe,Be,P=0,K=0,De=0,We=0,M=0,Xe="",X="",se="",L="",ke=[];ke.push("AccountID"),ke.push("Amount"),ke.push("IsCredit"),ke.push("AccountName"),this.ProgressMax=N.J0.Int(this.DocDv.length);let Ze,Me,tt,Ge="",rt="",Qe="",St="",pt="",nt="",$e="",at="",vt="",fi="",Ot="",ut=!1,Ut=!1,kt=!1,qe=1,fe=1,ht=0,Oe=1;for(this.IsInventory||G.append("<DocumentXML>"),ve.append("<AttachmentsXML>"),m=0;m<this.DocDv.length;m++,qe++,this.ProgressValue++){if(Logger.DebugLog("ImportUtility-seqNo "+qe.toString()),ht=0,K=De,Xe=X,rt=Qe,""!=b){if(""==this.DocDv[m][b].toString().Trim())continue;let Q;Q=""!=this.Delimiter.toString()?this.DocDv[m][b].toString().Trim().Split(this.Delimiter[0]):this.DocDv[m][b].toString().Trim().Split(),X=Q[Q.length()-1],De=N.J0.Int(Q[Q.length()-1]),Q.length()>=2&&(Qe=Q[Q.length()-2])}else{if(""!=f){if(""==this.DocDv[m][f].toString().Trim())continue;De=N.J0.Int(this.DocDv[m][f].toString().Trim()),X=this.DocDv[m][f].toString().Trim()}else if(this.ProfileID>-20&&this.ProfileID<0){if(""==this.DocDv[m][x].toString().Trim())continue;if(""==this.DocDv[m].TMOCODE_Key.toString().Trim()){this.DocDv[m].RevenUStatus="Failed",this.DocDv[m].RevenUReason="Product not found",fe++,P++;continue}if(""==this.DocDv[m].Facility_Key.toString().Trim()){this.DocDv[m].RevenUStatus="Failed",this.DocDv[m].RevenUReason="Facility not found",fe++,P++;continue}if(""==this.DocDv[m].Store_Key.toString().Trim()){this.DocDv[m].RevenUStatus="Failed",this.DocDv[m].RevenUReason="Store not found",fe++,P++;continue}let Q;Q.append("<PXML>"),Q.append("<Row "),Q.append(` ProductID="${this.DocDv[m].TMOCODE_Key}" `),Q.append(' QTY="1" '),Q.append(' DETAILSID="0" '),Q.append(` avgwhere=" and dcccnid2=${this.DocDv[m].Facility_Key} and dcccnid9=${this.DocDv[m].Store_Key}"`),Q.append(" ></Row>"),Q.append("</PXML>");const te=this.ScreenObject.GetReconcileAvgRate(Q.toString(),(0,Ue._U)(this.DocDv[m][x].toString()));null!=te&&te.Tables.length>0&&te.Tables[0].includes("AvgRate")&&te.Tables[0].Rows.length>0&&(this.DocDv[m].Rate=te.Tables[0].Rows[0].AvgRate,""!=this.DocDv[m].Qty.toString()&&""!=te.Tables[0].Rows[0].AvgRate.toString()&&(this.DocDv[m].Gross=N.J0.Int(this.DocDv[m].Qty.toString())*N.J0.Int(te.Tables[0].Rows[0].AvgRate.toString())))}Qe=""!=this.DocPrefixField?this.DocDv[m].DocPrefixField.toString():""}if((K!=De||this.PartialSave||rt!=Qe||m>0&&this.ProfileID>-20&&this.ProfileID<0&&(!this.ExcelTable.includes("IsNewRow")||"1"!=this.DocDv[m].IsNewRow.toString()))&&null!=G.toString()&&"<DocumentXML>"!=G.toString()){this.IsInventory||G.Append("</DocumentXML>"),ve.Append("</AttachmentsXML>"),this.BulkSave&&(v.Insert(0,"<DocXML>"),ne.Insert(0,"<NumXML>"),ce.Insert(0,"<TextXML>"),Te.Insert(0,"<CCXML>"),G.Insert(0,"<AccXML>"),Pe.Insert(0,"<EXTRAXML>"),Be.Insert(0,"<DocExtraXML>"),v.Append("</DocXML>"),ne.Append("</NumXML>"),ce.Append("</TextXML>"),Te.Append("</CCXML>"),G.Append("</AccXML>"),Pe.Append("</EXTRAXML>"),Be.Append("</DocExtraXML>"),this.argParam=[G.toString(),v.toString(),ne.toString(),ce.toString(),Te.toString(),Pe.toString(),Be.toString()],Logger.DebugLog("BulkImportUtility-Rows "+G.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+ne.toString()),Logger.DebugLog("BulkImportUtility-Text "+ce.toString()),Logger.DebugLog("BulkImportUtility-CC "+Te.toString())),K!=De&&(this.PrevDocID=0);let Q=0;this.strSerial.length>0&&(Q=this.strSerial.length),this.strSerial.length>0&&this.strSerial.length!=Q&&(this.DocDv[m-fe].xIMP_STATUSx="FAIL",this.DocDv[m-fe].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(m-fe),P++,this.FailedRecourdList.push({Message:this.ErrorMessage,Name:Qe+"-"+X}));let te=this.SaveDocument(W,rt,Xe,St,pt,nt,this.IsInventory,G.toString(),ve.toString(),ke,at,We,M,this.fldDict,Oe,Me,this.argParam);if(W=te.docId,this.ErrorMessage=te.errorMessage,W<1){if(this.DocDv[m-fe].xIMP_STATUSx="FAIL",this.DocDv[m-fe].IMPORT_MESSAGE=this.ErrorMessage,this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[m-fe].RevenUStatus="Failed",this.DocDv[m-fe].RevenUReason=this.ErrorMessage),P++,!(this.ProfileID>-20&&this.ProfileID<0)){for(let q=0;q<this.grData.Table.length;q++)if(this.DocDv.filter(""!=f?oe=>oe.DocNumberField==oe.PreviousDocNumber:oe=>oe.VoucherNoField==oe.PreviousDocNumber),this.DocDv.includes(this.grData.Table[q][0].toString()+"_Key")&&this.DocDv.length>0)for(let oe=0;oe<this.DocDv.length;oe++)""==this.DocDv[oe][this.grData.Table[q][0].toString()+"_Key"].toString()&&this.FailedRecourdList.push({Message:"Invalid "+this.grData.Table[q][0].toString()+" at Row No:"+(oe+1),Name:Qe+"-"+Xe});let A;A=this.ExcelTable.includes("IMPORT_STATUS")?this.DocDv.filter(q=>null==this.DocDv.IMPORT_STATUS||"PASS"==this.DocDv.IMPORT_STATUS):[]}this.FailedRecourdList.push({Message:this.ErrorMessage,Name:rt+"-"+Xe}),this.strSerial=[]}else this.DocDv[m-fe].xIMP_STATUSx="PASS",this.DocDv[m-fe].IMPORT_MESSAGE="",this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[m-fe].RevenUStatus="pass",this.DocDv[m-fe].RevenUReason=this.ErrorMessage),T++,this.strSerial=[];this.ImportedCount=this.IsSaveDocValidate?"Valid :"+T.toString():"Imported :"+T.toString(),this.FailedCount="Failed :"+P.toString(),St="",pt="",nt="",(!(this.ProfileID>-20&&this.ProfileID<0)||this.DocDv[m][x].toString().Trim()!=this.PrevDocDate)&&(qe=1),at="",fe=1,G="",ve="",ke=[],M=0,We=0,this.BulkSave&&(v="",ne="",ce="",Te=""),this.IsInventory||G.Append("<DocumentXML>"),ve.Append("<AttachmentsXML>")}if(40079==N.J0.Int(this.Feature.SelectedValue)){for(const A of this.grData.Table)if(null!=A[1]&&""!=A[1].toString()&&"0"!=A[1].toString()&&(E.filter(q=>q.CostCenterColID==q[1].toString()),E.length>0)){let q=E[0].SysColumnName.toString();Logger.InfoLog("ImportCosCenters Columnname ="+q),"dcalpha1"==q.toLowerCase()?(0,Ue._U)(this.DocDv[m][A.FieldName.toString()]):"dcccnid51"==q.toLowerCase()&&(fi=this.DocDv[m][A.FieldName.toString()+"_Key"].toString(),Ot=this.DocDv[m][A.FieldName.toString()])}let te=I.d.document.GetDataSet('SELECT * FROM INV_DOCDETAILS I WITH(NOLOCK)\n                                          JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          WHERE CostCenterID = 40079 AND ISDATE(t.dcAlpha1) = 1 AND c.dcCCNID51 = " + EmpID + " AND CONVERT(DATETIME, t.dcAlpha1) = CONVERT(DATETIME, \'" + PayrollMonth + "\')');if(null!=te&&te.Rows.length>0){this.DisplayMessage="Attendance Dimension Wise already Posted For the Month",P++,this.FailedRecourdList.push({Name:Ot.toString(),Message:this.DisplayMessage});continue}}this.ProfileID>-20&&this.ProfileID<0&&(this.ExcelTable.includes("IsNewRow")&&"1"==this.DocDv[m].IsNewRow.toString()?fe++:this.DocDv[m].Uniqu.toString());let $=0;do{if(1==$&&(ht=0),this.BulkSave||(this.IsInventory&&G.Append("\x11"),G.Append("<Row>"),G.Append("<AccountsXML>"),v=" ",ne=" ",ce=" ",Te=" ",we=" ",Ye=" ",me=" ",je=" ",pe=" ",tt=0,Me=1,Oe=1),p>5e4&&(E.filter(A=>A.SysTableName==A.COM_DocCCData&&A.ColumnCostCenterID==A.CurrencyDim),E.length>0)){let A=this.grData.Table.filter(q=>q.FeatureFieldName==E[0].CostCenterColID.toString());A.length>0&&this.DocDv.includes(A[0].FieldName.toString()+"_Curr")&&null!=this.DocDv[m][A[0].FieldName.toString()+"_Curr"]&&""!=this.DocDv[m][A[0].FieldName.toString()+"_Curr"].toString()&&parseInt(this.DocDv[m][A[0].FieldName.toString()+"_Curr"].toString())}kt=!1,Ge="",Ze=!1,$e="",vt="",ut=!1,this.BulkSave?(v.Append('<Transactions  DocSeqNo="'+qe.toString()+'" '),ne.Append('<Numeric  DocSeqNo="'+qe.toString()+'" '),Te.Append('<CostCenters  DocSeqNo="'+qe.toString()+'" '),ce.Append('<Alpha  DocSeqNo="'+qe.toString()+'" ')):(v.Append('<Transactions DocSeqNo="'+qe.toString()+'" '),ne.Append('<Numeric Query="'),ce.Append('<Alpha Query="'),Te.Append('<CostCenters Query="')),v.Append(this.DoNotCreateCostCenter?'Create="0" ':'Create="1" '),v.Append('DocDetailsID="0" ');let Q,te=!1;this.IsInventory&&this.DocDv.includes(this.ProductFieldName+"_PrdTypeID")&&!N.J0.StringIsNullOrEmpty(this.DocDv[m][this.ProductFieldName+"_PrdTypeID"].toString())&&(this.ProductTypeID=N.J0.Int(this.DocDv[m][this.ProductFieldName+"_PrdTypeID"]));for(const A of this.grData.Table)if(null!=A[1]&&""!=A[1].toString()&&"0"!=A[1].toString()&&(E.filter(q=>q.CostCenterColID==q[1].toString()),E.length>0)){Q=E[0].SysColumnName.toString();let oe,q="";if(this.fldDict.ContainsKey(E[0].ResourceData.toString().TrimEnd("*"))&&this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),("voucherno"==Q.toLowerCase()||"docnumber"==Q.toLowerCase())&&this.IsUpdate){let O="";O=this.IsInventory?N.J0.StringIsNullOrEmpty(this.DocPrefixField)?'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo ':N.J0.StringIsNullOrEmpty(this.DocPrefixField)?'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND  DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo';const H=I.d.document.GetDataSet(O);null!=H&&H.Tables[0].Rows.length>0&&(W=N.J0.Int(H.Tables[0].Rows[0].DocID.toString()))}if(this.isAvgrate&&"AVGRATE"==Q.ToUpper()){this.BuildCCXML(this.DocDv[m].Row,E);let ue,H=N.J0.Int(this.DocDv[m][this.ProductFieldName+"_Key"]),ee=N.J0.Int(this.DocDv[m][this.QtyField]);ue=(0,Ue._U)(this.DocDv[m][x].toString()),this.ScreenObject.DocDate.Date=ue.Date,this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue),this.ScreenObject.AvgrateExists=!0,this.ScreenObject.LocationID=0,""!=he&&(this.ScreenObject.LocationID=N.J0.Int(this.DocDv[m][he+"_Key"].toString()));let de=0;B&&""!=ae&&(de=N.J0.Int(this.DocDv[m][ae+"_Key"].toString()));const ge=this.ScreenObject.GetProductTypeDetails(H.toString(),ue.Date,1,ee,"0",null,!1,"",!0,de,null);if(null!=ge&&ge.Tables.length>0&&ge.Tables[0].includes("AvgRate")&&""!=ge.Tables[0].Rows[0].AvgRate.toString()){let ye=0;ye=N.J0.Int(N.J0.Int(ge.Tables[0].Rows[0].AvgRate.toString()("N"+I.d.SessionManager.Preferences.DecimalsinAmount))),this.DocDv[m][A.FieldName.toString()]=ye,this.fldDict["RATE"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),this.DocDv[m][this.GrossField]=N.J0.Int(ee*N.J0.Int(this.DocDv[m][this.RateField]("N"+I.d.SessionManager.Preferences.DecimalsinAmount)))}}else"RATE"==Q.ToUpper()&&this.fldDict["RATE"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]);if("quantity"==Q.toLowerCase()&&this.fldDict["QTY"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),"FreeQTY"==Q&&this.fldDict["FreeQTY"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),"EXCHANGERATE"==Q.ToUpper()&&(this.fldDict["EXCHANGERATE"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),Me=N.J0.Int(this.DocDv[m][A.FieldName.toString()])),"gross"==Q.toLowerCase()&&this.fldDict["GROSS"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]),"docdate"==Q.toLowerCase())St=this.DocDv[m][A.FieldName.toString().Trim()];else if("duedate"==Q.toLowerCase())pt=this.DocDv[m][A.FieldName.toString().Trim()];else if("billno"==Q.toLowerCase())nt=this.DocDv[m][A.FieldName.toString()].replace("&","&amp;").Trim(),v.Append(Q+'="'+nt+'" ');else if("billwisedocno"==Q.toLowerCase())at=this.DocDv[m][A.FieldName.toString().Trim()];else if("accountid"==Q.toLowerCase())Ge=this.DocDv[m][A.FieldName.toString().Trim()];else if("accountidcode"==Q.toLowerCase())Ge=this.DocDv[m][A.FieldName.toString().Trim()],Ze=!0;else if("refno"==Q.toLowerCase()&&this.IsSnoBasedLinking&&Object.keys(this.ccdv).includes("400")&&Object.keys(this.ccdv).includes("43")){let O=null;var l=this.grData.Table.filter(H=>"-501"==H.FeatureFieldName);l.length>0&&(O=this.ccdv[400].ToTable().filter(H=>H.VoucherNo==this.ExcelTable[m][A[0].toString()].Trim()&&H.DocSeqNo==this.ExcelTable[m][l[0][0].toString()].Trim())),O.length()>0&&(v.Append(' LinkedInvDocDetailsID="').Append(O[0].InvDocDetailsID.toString()).Append('" '),v.Append(' RefNO="').Append(this.ExcelTable[m][A[0].toString()].Trim()).Append('" '),O=this.ccdv[43].ToTable().filter(H=>H.CostCenterIDLinked==O[0].CostCenterID.toString()),O.length()>0&&v.Append(' LinkedFieldName="').Append(O[0].SysColumnName.toString()).Append('" '))}else if("Batchno"==E[0].SysColumnName.toString()||"MfgDate"==E[0].SysColumnName.toString()||"ExpDate"==E[0].SysColumnName.toString()){if("MfgDate"==E[0].SysColumnName.toString()||"ExpDate"==E[0].SysColumnName.toString()){let O;O=(0,Ue._U)(this.DocDv[m][A.FieldName.toString().Trim()]),O&&pe.Append(" "+E[0].SysColumnName.toString()).Append('="').Append(O.toLocaleDateString("dd/MMM/yyyy")).Append('" ')}else if(1==this.VoucherType){pe.Append(' BatchID="0" '+E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString().Trim()]).Append('" ');try{if(this.ControlGen=new gt.ControlGenerator,this.ControlGen.LoadScreen_2(this,16),this.ControlGen.InitAutoCode(this.ControlGen.Data.Tables[9],!1),this.ControlGen.IsAutoCode&&(this.ControlGen.SetAutoCode(this.BatchCode,!1,1,this.ControlGen.Data.Tables[9]),!N.J0.StringIsNullOrEmpty(this.BatchCode.Text))){let O=0,H=0,ee="";if(O=N.J0.Int(this.BatchCode.Text),m>0&&O>0){if(O+=m,H=N.J0.Int(this.ControlGen.Data.Tables[9].Rows[0].CodeNumberLength.toString()),H-=O.toString().length,H>0)for(let ue=0;ue<H;ue++)ee+="0";this.BatchCode.Text=ee+O.toString(),pe.Append(" BatchCode").Append('="').Append(this.BatchCode.Text.Trim()).Append('" '),pe.Append(" BatchCurrID").Append('="').Append(O).Append('" ')}else pe.Append(" BatchCode").Append('="').Append(this.BatchCode.Text.Trim()).Append('" '),pe.Append(" BatchCurrID").Append('="').Append(O).Append('" ')}}catch{}}else if(!o){let O=0;const H=N.J0.Int(this.DocDv[m][this.ProductFieldName+"_Key"]);let ee,ue;ee=(0,Ue._U)(this.DocDv[m][x].toString()),this.ScreenObject.DocDate.Date=ee.Date,this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue),""!=he&&(this.ScreenObject.LocationID=N.J0.Int(this.DocDv[m][he+"_Key"].toString())),B&&""!=ae&&(ue=(0,Ue._U)(this.DocDv[m][ae+"_Key"].toString()));const de=this.ScreenObject.GetProductwiseBatches(H,O,this.VoucherType,null,ue,!0,"");if(null!=de&&de.Tables.length>0&&de.Tables[0].Rows.length>0&&!de.Tables[0].includes("ErrorMessage"))for(let ge of de.Tables[0].Rows)if(ge.BATCHNUMBER.toString()==this.DocDv[m][A.FieldName.toString().Trim()]){pe.Append(' BatchID="'+ge.BatchID.toString()+'" '+E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString().Trim()]).Append('" Quantity="'+this.DocDv[m][this.QtyField].toString().Trim()+'"');break}}}else if("SerialNo"==E[0].SysColumnName.toString()){r=!0;let O=null;-1==this.VoucherType&&null!=this.DocDv[m][this.ProductFieldName+"_Key"]&&""!=this.DocDv[m][this.ProductFieldName+"_Key"].toString()&&(O=I.d.document.GetSerialNumberScreenDetails(parseInt(this.DocDv.ProductFieldName_Key),0,0,0,0,!1,""));let H=this.DocDv[m][A.FieldName.toString().Trim()].Split(",");if(H.length>0){be.Append("<xml>");for(let ee=0;ee<H.length;ee++){if(be.Append("<Row "),be.Append(" SerialProductID").Append('="0" '),be.Append(" SerialNumber").Append('="').Append(k.Dw.GetValidXml(H[ee].toString()).Trim()).Append('" '),0==ee&&(this.strSerial=this.strSerial.concat(H)),1==this.VoucherType)be.Append(" StatusID").Append('="157" '),be.Append(" RefInvDocDetailsID").Append('="0" '),be.Append(" IsAvailable").Append('="1" '),be.Append(" SerialGUID").Append('="').Append(N.J0.NewGuid().toString()).Append('" ');else if(-1==this.VoucherType&&(be.Append(" StatusID").Append('="158" '),null!=O&&O.Tables.length>1&&O.Tables[1].Rows.length>0)){let ue=O.Tables[1].filter(de=>de["SerialNumber="]==H[ee].toString().Trim()+"'");null!=ue&&ue.length()>0&&(be.Append(' RefInvDocDetailsID="').Append(ue[0].InvDocDetailsID.toString()).Append('" '),be.Append(" IsAvailable").Append('="0" '),be.Append(" SerialGUID").Append('="').Append(ue[0].SerialGUID.toString()).Append('" '))}be.Append(" ></Row>")}be.Append("</xml>")}}else if("DebitAmount"==E[0].SysColumnName.toString()&&null!=this.DocDv[m][A.FieldName.toString()]&&""!=this.DocDv[m][A.FieldName.toString().Trim()]&&N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])>0)tt=N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()]),""!=V&&""!=this.DocDv[m][V+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[m][V+"_Key"].toString())),""!=_&&""!=this.DocDv[m][_].toString()&&(Me=N.J0.Int(this.DocDv[m][_].toString())),v.Append(this.ScreenObject.GetAccountTransaction(Ge,"PactReservedAccount",Ze,tt.toString(),Oe,Me));else if("CreditAmount"==E[0].SysColumnName.toString()&&null!=this.DocDv[m][A.FieldName.toString()]&&""!=this.DocDv[m][A.FieldName.toString().Trim()]&&N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])>0)tt=N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()]),""!=V&&""!=this.DocDv[m][V+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[m][V+"_Key"].toString())),""!=_&&""!=this.DocDv[m][_].toString()&&(Me=N.J0.Int(this.DocDv[m][_].toString())),v.Append(this.ScreenObject.GetAccountTransaction("PactReservedAccount",Ge,Ze,tt.toString(),Oe,Me));else if("Attachments"==E[0].SysColumnName.toString())try{L=this.DocDv[m][A.FieldName.toString().Trim()];let O=L.split(";");for(let H in O);}catch{se=""}else if(null!=E[0].IsColumnUserDefined&&""!=E[0].IsColumnUserDefined.toString()&&(0,j.yG0)(E[0].IsColumnUserDefined.toString())){if("LISTBOX"==E[0].ColumnDataType.toString())5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&d&&I.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&I.d.SessionManager.Preferences.POSItemCodeDimension==E[0].ColumnCostCenterID.toString()&&""!=this.DocDv[m][A.FieldName.toString()]?v.toString().Contains("StockCode=")||v.Append(' StockCode="').Append(this.DocDv[m][A.FieldName.toString().Trim()]).Append('" '):""!=this.DocDv[m][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"])>0&&(5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)&&1==$?E[0].UserColumnName.toString().Contains("TO")&&""!=this.DocDv[m][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"])>0&&(this.BulkSave?je.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):je.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")):E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("CCNID")?we.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", "):5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType)&&0==$&&!E[0].UserColumnName.toString().Contains("TO")&&""!=this.DocDv[m][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"])>0?this.BulkSave?Te.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):Te.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", "):5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&""!=this.DocDv[m][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"])>0&&(this.BulkSave?Te.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):Te.toString().Contains(E[0].SysColumnName.toString()+"=")||Te.Append(E[0].SysColumnName.toString()).Append("=").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")),"dcccnid2"==E[0].SysColumnName.toString().toLowerCase()?M=N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==E[0].SysColumnName.toString().toLowerCase()&&(We=N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim())),40067==N.J0.Int(this.Feature.SelectedValue)&&this.fldDict["GROSS"+E[0].FieldName.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString()]));else if("CostCenterString"==E[0].ColumnDataType.toString()){if(5!=N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&""!=this.DocDv[m][A.FieldName.toString()+"_Key"].toString()&&N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"])>0){let O="dcCCNID"+(N.J0.Int(E[0].CostcenterID.toString())-5e4);Te.toString().Contains(O)||(this.BulkSave?Te.Append(O).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):Te.Append(O).Append("=").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append(", ")),"dcccnid2"==O.toLowerCase()?M=N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==O.toLowerCase()&&(We=N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()))}}else if("TEXT"==E[0].ColumnDataType.toString()||"String"==E[0].ColumnDataType.toString()||"COMBOBOX"==E[0].ColumnDataType.toString()){let O=0;if(O=N.J0.Int(E[0].ColumnCostCenterID.toString()),44==O)E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("Alpha")?me.Append(Q).Append("='").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', "):this.BulkSave?ce.Append(Q).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):ce.Append(Q).Append("=N'").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ");else if(O>0)this.BulkSave?ce.Append(Q).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append('" '):ce.Append(Q).Append("=N'").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ");else if(E[0].UserColumnName.toString().Contains("Batch_")&&E[0].SysColumnName.toString().Contains("Alpha"))me.Append(Q).Append("='").Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append("', ");else if(E[0].UserColumnType.toString().toLowerCase().Contains("date")){let H;if(H=(0,Ue._U)(this.DocDv[m][A.FieldName.toString().Trim()]),this.EDate)if("date"==E[0].UserColumnType.toString().toLowerCase()){if(this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")).Append("', "),40067==N.J0.Int(this.Feature.SelectedValue)){let ee;this.fldDict["Date"+E[0].SysColumnName.toString().TrimEnd("*")].setFieldValue(this.EDate.toLocaleDateString("dd/MMM/yyyy")[m][A.FieldName.toString()]),ee=this.GetDailyAttendanceDetails(0,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),H.Date,0,0,"",""),ee&&ce.Append(ee)}}else if("datetime"==E[0].UserColumnType.toString().toLowerCase())if(40067==N.J0.Int(this.Feature.SelectedValue)){let ee,ue,de;if(H=(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult().toString()+" "+this.DocDv[m][A.FieldName.toString().Trim()]),this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+H.TimeOfDay.toString()).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+H.TimeOfDay.toString()).Append("', "),this.fldDict["Date"+E[0].SysColumnName.toString().TrimEnd("*")].setFieldValue(this.EDate.toLocaleDateString("dd/MMM/yyyy")[m][A.FieldName.toString()]),ee=this.GetDailyAttendanceDetails(2,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),H.Date,0,0,this.fldDict.dcAlpha2.getFieldResult().toString(),this.fldDict.dcAlpha3.getFieldResult().toString()),""!=ee.toString()){ne.Append(ee);let ge=this.GetDailyAttendanceDetails(1,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult()),ue,de,"","");null!=ge&&ne.Append(ge),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1"')}}else this.BulkSave?ce.Append(Q).Append('="').Append(this.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")).Append('" '):ce.Append(Q).Append("=N'").Append(this.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")).Append("', ")}else if("attachment"==E[0].UserColumnType.toString().toLowerCase())try{L=this.DocDv[m][A.FieldName.toString().Trim()]}catch{se=""}else if(40068==N.J0.Int(this.Feature.SelectedValue)&&(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString()]).Trim().toLowerCase().Contains("earning")||k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString()]).Trim().toLowerCase().Contains("deduction")))k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString()]).Trim().toLowerCase().Contains("earning")?this.BulkSave?ce.Append(Q).Append('="').Append(2).Append('" '):ce.Append(Q).Append("=N'").Append(2).Append("', "):k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString()]).Trim().toLowerCase().Contains("deduction")&&(this.BulkSave?ce.Append(Q).Append('="').Append(3).Append('" '):ce.Append(Q).Append("=N'").Append(3).Append("', ")),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ');else{let H=this.DocDv[m][A.FieldName.toString().Trim()];if(H.Contains("\n")){let ee=N.J0.Int(I.d.SessionManager.Preferences.CtrlTFontSize),ue=H.Split("\n");if(null!=ue&&ue.length>0){let de='"',ge="<FlowDocument FontFamily="+de+I.d.SessionManager.Preferences.CtrlTFontName+de+" FontSize="+de+ee+de+" xmlns="+de+"http://schemas.microsoft.com/winfx/2006/xaml/presentation"+de+">";for(let ye=0;ye<ue.length;ye++)ge+="<Paragraph>"+k.Dw.GetValidTextXml(ue[ye])+"</Paragraph>";ge+="</FlowDocument>",this.BulkSave?ce.Append(Q).Append('="').Append(k.Dw.GetValidXml(ge)).Append('" '):ce.Append(Q).Append("=N'").Append(k.Dw.GetValidXml(ge)).Append("', ")}}else this.BulkSave?ce.Append(Q).Append('="').Append(k.Dw.GetValidTextXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '):(ce.Append(Q).Append("=N'").Append(k.Dw.GetValidTextXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append("', "),this.IsInventory&&5==this.ProductTypeID&&!N.J0.StringIsNullOrEmpty(this.BatchBasedon)&&Q.toLowerCase()==this.BatchBasedon.toLowerCase()&&"1"==this.DocDv[m][A.FieldName.toString()]&&(this.IgnoreBatch=1))}}else if(null!=this.DocDv[m][A.FieldName.toString()]&&""!=this.DocDv[m][A.FieldName.toString().Trim()])if("ProductString"==E[0].ColumnDataType.toString())this.DocDv.includes("TempProductName")&&""!=this.DocDv[m].TempProductName.toString().Trim()?v.Append("ProductID").Append('="').Append(k.Dw.GetValidXml(this.DocDv[m].TempProductName.toString().Trim())).Append('" '):this.DocDv.includes("TempProductCode")&&v.Append(' IsProductCode="1" ProductID').Append('="').Append(k.Dw.GetValidXml(this.DocDv[m].TempProductCode.toString().Trim())).Append('" ');else if(null!=E[0].IsCalculate&&""!=E[0].IsCalculate.toString()&&"0"==E[0].IsCalculate.toString()&&""!=E[0].Formula.toString()){this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append(", ");let O="";try{let H=this.fldDict;q=I.d.eval.EvaluateExpression(E[0].Formula.toString(),H).toString(),this.BulkSave?(ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(q).Append('" '),ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(q).Append('" ')):(ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(q).Append(", "),ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(q).Append(", ")),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(q)}catch(H){return this.DisplayMessage="Error during calculating formula  "+E[0].Formula.toString()+" , Message :"+H.Message,void(this.MessageVisibility=!0)}for(const[H,ee]of Object.entries(this.fldDict))O=O+"\n "+H+"=:"+ee.toString()}else if("CostCenterString"!=E[0].ColumnDataType.toString())if(40067==N.J0.Int(this.Feature.SelectedValue)&&"36560"==String(A.FeatureFieldName)){let O="";if(""!=this.DocDv[m][A.FieldName.toString()])O=this.DocDv[m][A.FieldName.toString().Trim()],this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString().Trim()]),this.BulkSave?ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '):ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append(", ");else{let ee;ee=this.fldDict.dcAlpha3.getFieldResult()-this.fldDict.dcAlpha2.getFieldResult(),O=ee.Hours+"."+ee.Minutes,this.BulkSave?ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(O)).Append('" '):ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(O)).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(O.toString()),this.BulkSave?ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append('="').Append(N.J0.Int(O)).Append('" '):ne.Append("dcCalc"+E[0].SysColumnName.toString().replace("dc","")).Append("=").Append(N.J0.Int(O)).Append(", ")}let H=this.GetDailyAttendanceDetails(1,N.J0.Int(this.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(this.fldDict.dcCCNID4.getFieldResult()),(0,Ue._U)(this.fldDict.dcAlpha1.getFieldResult()),this.intValidDay,N.J0.Int(O),"","");""!=String(H)&&ne.Append(H),v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="1" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ')}else this.BulkSave?(ne.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString().Trim()]),ne.Append("dcCalcNum"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),I.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,j.yG0)(I.d.SessionManager.Preferences["Use Foreign Currency"])&&(ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])*Me).Append('" '),ne.Append("dcCurrID"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(Oe).Append('" '),ne.Append("dcExchRT"+E[0].SysColumnName.toString().replace("dcNum","")).Append('="').Append(Me).Append('" '))):(ne.Append(E[0].SysColumnName.toString()).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append(", "),this.fldDict["Calc"+E[0].ResourceData.toString().TrimEnd("*")].setFieldValue(this.DocDv[m][A.FieldName.toString().Trim()]),ne.Append("dcCalcNum"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append(", "),I.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,j.yG0)(I.d.SessionManager.Preferences["Use Foreign Currency"])&&(ne.Append("dcCalcNumFC"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])*Me).Append(", "),ne.Append("dcCurrID"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(Oe).Append(", "),ne.Append("dcExchRT"+E[0].SysColumnName.toString().replace("dcNum","")).Append("=").Append(Me).Append(", ")))}else if("DATE"==E[0].ColumnDataType.toString())Re=(0,Ue._U)(this.DocDv[m][A.FieldName.toString()]),Re&&(E[0].UserColumnName.toString().Contains("Batch_")&&!E[0].SysColumnName.toString().Contains("alpha")&&Ye.Append(Q).Append("='").Append(Re.toLocaleDateString("dd/MMM/yyyy")).Append("', "),""!=this.DocDv[m][A.FieldName.toString().Trim()]&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(Re.toLocaleDateString("dd/MMM/yyyy")).Append('" '));else if("quantity"!=Q.toLowerCase()&&"FreeQTY"!=Q||v.toString().Contains("Quantity="))if("AVGRATE"!=E[0].SysColumnName.toString()&&"AVGRATEVALUE"!=E[0].SysColumnName.toString()||"FLOAT"!=E[0].ColumnDataType.toString()||null==this.DocDv[m][A.FieldName.toString()]||""==this.DocDv[m][A.FieldName.toString().Trim()])if((E[0].SysColumnName.toString().EndsWith("Rate")||E[0].SysColumnName.toString().EndsWith("ExchRT"))&&E[0].UserColumnName.toString().Contains("Batch_")){let O=0;O=parseFloat(this.DocDv[m][A.FieldName.toString().Trim()]),O>0&&Ye.Append(E[0].SysColumnName.toString()).Append("='").Append(O).Append("', ")}else if("Amount"!=E[0].SysColumnName.toString()&&"FLOAT"==E[0].ColumnDataType.toString()&&null!=this.DocDv[m][A.FieldName.toString()]&&""!=this.DocDv[m][A.FieldName.toString().Trim()]&&"ExchangeRate"!=E[0].SysColumnName.toString())v.Append(E[0].SysColumnName.toString()).Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ');else if("ProductString"==E[0].ColumnDataType.toString())this.DocDv.includes("TempProductName")&&""!=this.DocDv[m].TempProductName.toString().Trim()?v.Append("ProductID").Append('="').Append(k.Dw.GetValidXml(this.DocDv[m].TempProductName.toString().Trim())).Append('" '):this.DocDv.includes("TempProductCode")&&v.Append(' IsProductCode="1" ProductID').Append('="').Append(k.Dw.GetValidXml(this.DocDv[m].TempProductCode.toString().Trim())).Append('" '),v.Append(' IsProductBarcode="1" ');else if("ProductID"==E[0].SysColumnName.toString())if(te=!0,this.BulkSave)v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString()).Append('" ');else if(this.ProfileID>-20&&this.ProfileID<0&&this.ExcelTable.includes("TMOCODE_Key"))v.Append(' IsProductBarcode="0" '),v.Append(' IsProductCode="2" '),v.Append(' ProductID="').Append(this.DocDv[m].TMOCODE_Key.toString().Trim()).Append('" ');else if(this.IsProductwiseBarcode){let O=!1;E.includes("parentccdefaultcolid")&&"261"==E[0].parentccdefaultcolid.toString().toLowerCase()&&(v.Append(' IsProductCode="1" '),O=!0),this.ReadBarcode(O,this.DocDv[m],this.DocDv[m][A.FieldName.toString().Trim()],A.FieldName.toString()),v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),v.Append(' IsProductBarcode="1" ')}else v.Append(' IsProductBarcode="0" '),E.includes("parentccdefaultcolid")&&"261"==E[0].parentccdefaultcolid.toString().toLowerCase()?(v.Append(' IsProductCode="1" '),v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ')):v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ');else if("CurrencyID"==E[0].SysColumnName.toString())Oe=N.J0.Int(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim());else if("ExchangeRate"==E[0].SysColumnName.toString())Me=N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()]);else if(E[0].SysColumnName.toString().EndsWith("CurrID")&&E[0].UserColumnName.toString().Contains("Batch_")){let O=this.CostCenterFieldsAllTables.Tables[6];O.RowFilter="IsBaseCurrency='True'",O.length>0&&Ye.Append(E[0].SysColumnName.toString()).Append("='").Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()).Append("', ")}else if("ExchangeRate"==E[0].SysColumnName.toString())kt&&(Me=N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()]));else if("DebitAccount"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(m,2,E[0].SysColumnName.toString(),!1,!0),v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString()).Append('" '),Ge=this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):(Ge=this.DocDv[m][A.FieldName.toString().Trim()],this.IsInventory&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '));else if("DebitAccountCode"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(m,2,E[0].SysColumnName.toString(),!1,!0),v.Append(' DebitAccount="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString()).Append('" '),Ge=this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):(Ge=this.DocDv[m][A.FieldName.toString().Trim()],Ze=!0,this.IsInventory&&(v.Append(' DebitAccount="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),Ze&&v.Append(' DrAccCode="1" ')));else if("CreditAccount"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(m,2,E[0].SysColumnName.toString(),!1,!0),v.Append(E[0].SysColumnName.toString()).Append('="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString()).Append('" '),$e=this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):($e=this.DocDv[m][A.FieldName.toString().Trim()],this.IsInventory&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '));else if("CreditAccountCode"==E[0].SysColumnName.toString())this.BulkSave?(this.CheckBulkCostCenterField(m,2,E[0].SysColumnName.toString(),!1,!0),v.Append(' CreditAccount="').Append(this.DocDv[m][A.FieldName.toString()+"_Key"].toString()).Append('" '),$e=this.DocDv[m][A.FieldName.toString()+"_Key"].toString().Trim()):($e=this.DocDv[m][A.FieldName.toString().Trim()],ut=!0,this.IsInventory&&(v.Append(' CreditAccount="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),ut&&v.Append(' CrAccCode="1" ')));else if("Unit"==E[0].SysColumnName.toString()){if(vt=this.DocDv[m][A.FieldName.toString().Trim()],Ut=!0,this.IsInventory)if(this.ExcelTable.includes(A.FieldName+"_Key")){let O;if(v.Append(' Unit="').Append(this.DocDv[m][A.FieldName+"_Key"].toString().Trim()).Append('" '),O=this.ExcelTable.includes(this.ProductFieldName+"_Key")&&N.J0.StringIsNullOrEmpty(this.DocDv[m][this.ProductFieldName+"_Key"].toString())?I.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(this.DocDv[m][A.FieldName+"_Key"])+" WHERE P.ProductID = 1"):I.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(this.DocDv[m][A.FieldName+"_Key"])+" WHERE P.ProductID = "+N.J0.Int(this.DocDv[m][this.ProductFieldName+"_Key"])),null!=O&&O.Tables.length>0&&O.Tables[0].Rows.length>0)if(O.Tables[0].includes("Conversion")&&""!=O.Tables[0].Rows[0].Conversion.toString()){let H=1;H=parseFloat(O.Tables[0].Rows[0].Conversion.toString()),v.Append(' UOMConversion="').Append(H.toString()).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[m][this.QtyField].toString().Trim())*H).Append('" ')}else v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[m][this.QtyField].toString().Trim())).Append('" ');else v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[m][this.QtyField].toString().Trim())).Append('" ')}else Ut&&(v.Append(' Unit="1" '),v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[m][this.QtyField].toString().Trim())).Append('" '))}else if("Amount"!=E[0].SysColumnName.toString()||this.IsInventory)""!=E[0].SysColumnName.toString()&&v.Append(E[0].SysColumnName.toString()).Append('="').Append(k.Dw.GetValidXml(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ');else{let O="",H="";""!=Ge?O=Ge:""!=U&&(O=this.DocDv[m][U].toString().Trim(),Ze=this.IsDrFieldCode),""!=$e?H=$e:""!=w&&(H=this.DocDv[m][w].toString().Trim(),ut=this.IsCrFieldCode),tt=N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()]),""!=V&&""!=this.DocDv[m][V+"_Key"].toString()&&(Oe=N.J0.Int(this.DocDv[m][V+"_Key"].toString())),""!=_&&""!=this.DocDv[m][_].toString()&&(Me=N.J0.Int(this.DocDv[m][_].toString())),v.Append(this.getAccountTransaction(O,H,Ze,ut,tt.toString(),Oe,Me))}else"AVGRATE"==E[0].SysColumnName.toString()?(v.Append("Rate").Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),v.Append("AverageRate").Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ')):v.Append("Gross").Append('="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ');else{let O;O=O=parseFloat(this.DocDv[m][R].toString()),""!=R&&this.DocDv.includes(R)&&""!=this.DocDv[m][R].toString()&&O&&N.J0.Int(this.DocDv[m][R].toString())>0?(v.Append(' Quantity="').Append(N.J0.Int(this.DocDv[m][R].toString().Trim())).Append('" '),v.Append(' IsQtyFreeOffer="1" ')):"quantity"==Q.toLowerCase()&&(v.Append(' Quantity="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" '),""==this.UnitFieldName.Trim()&&(v.Append(' UOMConversion="').Append(1).Append('" '),v.Append(' UOMConvertedQty="').Append(N.J0.Int(this.DocDv[m][A.FieldName.toString().Trim()])).Append('" ')))}if(null!=E[0].PostingType&&""!=E[0].PostingType.toString()&&this.IsInventory){if(""==q&&(q=this.DocDv[m][A.FieldName.toString().Trim()]),oe=parseFloat(q),!u&&(3==N.J0.Int(E[0].PostingType.toString())||4==N.J0.Int(E[0].PostingType.toString()))&&""!=q&&oe&&0!=N.J0.Int(q)){let O;O.Append("<Accounts "),this.BulkSave&&O.Append('DocSeqNo="'+(m+1).toString()+'" ');let H="",ee="";var s;""!=E[0].DrRefColID.toString()&&N.J0.Int(E[0].DrRefColID.toString())>0?(s=this.grData.Table.filter(ue=>ue.FeatureFieldName==E[0].DrRefID.toString())).length>0?H=this.ExcelTable.includes(s[0].FieldName.toString()+"_Key")&&""!=this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString()?this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),0,this.DocDv[m][s[0].FieldName.toString()]).toString():(s=this.costCenterTableZero.filter(ue=>ue.CostcenterColID===E[0].DrRefID.toString())).length>0&&("2"==s[0].Columncostcenterid.toString()?(this.costCenterTableZero.filter(ue=>ue.SysColumnName===s[0].SysColumnName.toString()+"Code"),s=this.costCenterTableZero.filter(ue=>ue.SysColumnName===s[0].SysColumnName.toString()+"Code")):s=this.costCenterTableZero.filter(ue=>ue.SysColumnName===s[0].SysColumnName.toString()+"' AND CostcenterColID<>"+s[0].CostcenterColID.toString()),s.length>0&&(s=this.grData.Table.filter(ue=>ue.FeatureFieldName==s[0].CostcenterColID.toString())).length>0&&(H=this.ExcelTable.includes(s[0].FieldName.toString()+"_Key")&&""!=this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString()?this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),N.J0.Int(this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString())).toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].DrRefID.toString()),N.J0.Int(E[0].DrRefColID.toString()),0,this.DocDv[m][s[0].FieldName.toString()],!0).toString())):null!=E[0].DebitAccount&&""!=E[0].DebitAccount.toString()&&N.J0.Int(E[0].DebitAccount.toString())>0?H=E[0].DebitAccount.toString():""!=Ge?H=Ge:""!=U&&(this.BulkSave?(this.CheckBulkCostCenterField(m,2,U,!1,!0),H=this.DocDv[m][U+"_Key"].toString().Trim()):H=this.DocDv[m][U].toString().Trim()),""!=E[0].CrRefColID.toString()&&N.J0.Int(E[0].CrRefColID.toString())>0?(s=this.grData.Table.filter(de=>de.FeatureFieldName==s[0].CrRefID.toString())).length>0?ee=this.ExcelTable.includes(s[0].FieldName.toString()+"_Key")&&""!=this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString()?this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),0,this.DocDv[m][s[0].FieldName.toString()]).toString():(s=this.costCenterTableZero.filter(de=>de.CostcenterColID===s[0].CrRefID.toString())).length>0&&(s="2"==s[0].Columncostcenterid.toString()?this.costCenterTableZero.filter(de=>de.SysColumnName===s[0].SysColumnName.toString()+"Code"):this.costCenterTableZero.filter(de=>de.SysColumnName===s[0].SysColumnName.toString()+"' AND CostcenterColID<>"+s[0].CostcenterColID.toString())).length>0&&(s=this.grData.Table.filter(de=>de.FeatureFieldName==s[0].CostcenterColID.toString())).length>0&&(ee=this.ExcelTable.includes(s[0].FieldName.toString()+"_Key")&&""!=this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString()?this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),N.J0.Int(this.DocDv[m][s[0].FieldName.toString()+"_Key"].toString())).toString():this.ScreenObject.GetAccountByRef(N.J0.Int(E[0].CrRefID.toString()),N.J0.Int(E[0].CrRefColID.toString()),0,this.DocDv[m][s[0].FieldName.toString()],!0).toString()):null!=E[0].CreditAccount&&""!=E[0].CreditAccount.toString()&&N.J0.Int(E[0].CreditAccount.toString())>0?ee=E[0].CreditAccount.toString():""!=$e?ee=$e:""!=w&&(this.BulkSave?(this.CheckBulkCostCenterField(m,2,w,!1,!0),ee=this.DocDv[m][w+"_Key"].toString().Trim()):ee=this.DocDv[m][w].toString().Trim()),O.Append(this.getAccountTransaction(H.toString(),ee.toString(),!1,!1,q,Oe,Me)),O.Append(" ></Accounts>"),G.Append(O.toString()),this.FillBillWiseDt(ke,ee.toString(),q,!0),this.FillBillWiseDt(ke,H.toString(),q,!1)}(2==N.J0.Int(E[0].PostingType.toString())||4==N.J0.Int(E[0].PostingType.toString()))&&""!=q&&oe&&0!=N.J0.Int(q)&&(ht+=N.J0.Int(q))}38==this._DocumentType&&("5"==E[0].SectionID.toString()||"6"==E[0].SectionID.toString()||"7"==E[0].SectionID.toString()||"8"==E[0].SectionID.toString()||"9"==E[0].SectionID.toString()||"10"==E[0].SectionID.toString()||"11"==E[0].SectionID.toString()||"12"==E[0].SectionID.toString()||"13"==E[0].SectionID.toString())&&""!=this.DocDv[m][A.FieldName.toString()]&&(this.PosPayModesXML.Append('<XML Amount="').Append(this.DocDv[m][A.FieldName.toString()]).Append('" '),this.PosPayModesXML.Append(' AvailAmount="').Append("").Append('" '),this.PosPayModesXML.Append(' DBColumnName="').Append(Q).Append('" '),this.PosPayModesXML.Append(' Type="').Append(E[0].SectionID.toString()).Append('" '),this.PosPayModesXML.Append(' DocDate="').Append((0,Ue._U)(this.DocDv[m][x].toString())).Append('" '),this.PosPayModesXML.Append(' RegisterID="').Append(this.DocDv[m][this.PosRegisterField+"_Key"].toString()).Append('" '),this.PosPayModesXML.Append(' ShiftID="').Append(this.DocDv[m][this.PosShiftField+"_Key"].toString()).Append('" '),this.PosPayModesXML.Append(" />"))}this.IsInventory&&(v.Append(this.DonotUpdateInventory?'IsQtyIgnored="1" ':'IsQtyIgnored="0" '),v.Append('StockValue="').Append((ht*Me).toString()).Append('" '),v.Append('StockValueFC="').Append(ht.toString()).Append('" '),v.Append('CurrencyID="').Append(Oe.toString()).Append('" '),v.Append('ExchangeRate="').Append(Me.toString()).Append('" '),te||(E.filter(A=>"Productid"==A.SysColumnName),this.ProductID=N.J0.Int(E[0].UserDefaultValue.toString()),E.length>0&&""!=E[0].UserDefaultValue.toString()&&this.ProductID&&this.ProductID>0&&v.Append(' ProductID="').Append(this.ProductID.toString()).Append('" IsProductCode="2" '))),(3==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||8==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||13==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString()))&&(3==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||13==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())||8==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString()))&&(v.toString().Contains("DebitAccount=")||v.Append('DebitAccount="PactReservedAccount" '),v.toString().Contains("CreditAccount=")||v.Append(' CreditAccount="PactReservedAccount" ')),40062==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="-62" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="-62"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40051==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40069==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),40089==N.J0.Int(this.Feature.SelectedValue)&&(v.Append('LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" '),!this.ExcelTable.includes("QuantityValue")&&this.ExcelTable.includes("RateValue")?v.Append(' Quantity="0" UOMConversion="1"  Gross="0" '):this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")?v.Append(' Rate="0"  Gross="0" '):!this.ExcelTable.includes("QuantityValue")&&!this.ExcelTable.includes("RateValue")&&v.Append(' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||v.Append(' LineNarration="" '),v.toString().Contains("CommonNarration=")||v.Append(' CommonNarration="" '),v.Append(' RefNO="" ')),5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&1==$?(this.BulkSave?Te.Append(je).Append(" ></CostCenters>"):Te.Append(je).Append('" ></CostCenters>'),v.Append(' VoucherType="1" ')):(Te.Append(this.BulkSave?" ></CostCenters>":'" ></CostCenters>'),5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&v.Append(' VoucherType="-1" ')),!this.IsInventory&&!N.J0.StringIsNullOrEmpty(at)&&v.Append(' BillWiseDocNo="').Append(at).Append('" '),v.Append(" ></Transactions>"),this.BulkSave?(ne.Append(" ></Numeric>"),ce.Append(" ></Alpha>")):(ne.Append('" ></Numeric>'),ce.Append('" ></Alpha>'),G.Append("</AccountsXML>")),(o&&-1==this.VoucherType&&!r||1==this.VoucherType&&this.ProfileID>-20&&this.ProfileID<0)&&""!=this.DocDv[m].BATCHNUMBER_Sys.toString()&&""!=this.DocDv[m][this.QtyField].toString()&&N.J0.Int(this.DocDv[m][this.QtyField].toString())>0&&pe.Append('  ProductID="'+this.ProductID+'" Batchno="'+this.DocDv[m].BATCHNUMBER_Sys.toString()+'" BatchID="'+this.DocDv[m].BatchID.toString()+'" Quantity="'+this.DocDv[m][this.QtyField].toString()+'" '),pe.length>0&&(pe.Insert(0,"<xml><Row  "),pe.Append(1==this.VoucherType?'  StaticFieldsQuery="'+Ye+'"   TextFields="'+me+'"   CCFields="'+we+'" ></Row></xml> ':" ></Row></xml> ")),this.BulkSave||(G.Append(v.toString()+ne.toString()+ce.toString()+Te.toString()+"<EXTRAXML>"+pe+be+"</EXTRAXML>"),G.Append("</Row>")),$++}while(5==N.J0.Int(this.CostCenterFieldsAllTables.Tables[2].Rows[0].DocumentType.toString())&&1==$);pe=" ",be=" "}if(this.IsInventory||G.Append("</DocumentXML>"),ve.Append("</AttachmentsXML>"),this.IsInventory&&this.FillLocRefVisibility&&this.FillLocalReference&&this.DocItems.Items.length>0&&5==this.ProductTypeID&&!N.J0.StringIsNullOrEmpty(this.BatchBasedon)){let $="",Q="",te=null;for(let A=0;A<this.DocItems.Items.length;A++)if(this.DocItems.Items[A].IsChecked){let q=this.costCenterTableZero.filter(O=>O.CostcenterColID===this.DocItems.Items[A].Value),oe=this.grData.Table.filter(O=>O.CostcenterColID===this.DocItems.Items[A].Value);if(oe.length>0&&(Q=this.IsCode?2==N.J0.Int(q[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(q[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(q[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(q[0].ColumnCostCenterID)?"ProductName":"Name",$="SELECT "+q[0].ParentCostCenterColSysName+" ID FROM "+q[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+Q+"='"+this.DocDv[m-1][oe[0].FieldName.toString()]+"'",te=I.d.document.GetDataSet($),null!=te&&te.length>0)){$="";let O=[];O.push(this.DocItems.Items[A].Value),O.push(this.Feature.SelectedValue),O.push(te[0].ID.toString()),O.push(new Date("dd/MMM/yyyy")),O.push(0),O.push("<XML></XML>"),O.push(0),O.push(I.d.SessionManager.LanguageID);let H=I.d.document.GetReferenceData(JSON.stringify(O));if(null!=H&&H.Tables[0].Rows.length>0)for(let ee=0;ee<H.Tables[0].Columns.length;ee++)H.Tables[0].Columns[ee].ColumnName.toString().toLowerCase()==this.BatchBasedon.toLowerCase()&&"1"==H.Tables[0].Rows[0][H.Tables[0].Columns[ee].ColumnName.toString()]&&(this.IgnoreBatch=1)}}}if(""!=G.toString()){if(this.BulkSave){v.Insert(0,"<DocXML>"),ne.Insert(0,"<NumXML>"),ce.Insert(0,"<TextXML>"),Te.Insert(0,"<CCXML>"),G.Insert(0,"<AccXML>"),Pe.Insert(0,"<EXTRAXML>"),Be.Insert(0,"<DocExtraXML>"),v.Append("</DocXML>"),ne.Append("</NumXML>"),ce.Append("</TextXML>"),Te.Append("</CCXML>"),G.Append("</AccXML>"),Pe.Append("</EXTRAXML>"),Be.Append("</DocExtraXML>");let te=[];te.push(G.toString()),te.push(v.toString()),te.push(ne.toString()),te.push(ce.toString()),te.push(Te.toString()),te.push(Pe.toString()),te.push(Be.toString()),Logger.DebugLog("BulkImportUtility-Rows "+G.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+ne.toString()),Logger.DebugLog("BulkImportUtility-Text "+ce.toString()),Logger.DebugLog("BulkImportUtility-CC "+Te.toString())}K!=De&&(this.PrevDocID=0);let $=0;this.strSerial.length>0&&($=this.strSerial.length),this.strSerial.length>0&&this.strSerial.length!=$&&(this.DocDv[m-fe].xIMP_STATUSx="FAIL",this.DocDv[m-fe].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(m-fe),P++,this.FailedRecourdList.push({Name:Qe+"-"+X,Message:this.ErrorMessage}),this.strSerial=[]);let Q=this.SaveDocument(W,rt,Xe,St,pt,nt,this.IsInventory,G.toString(),ve.toString(),ke,at,We,M,this.fldDict,Oe,Me,this.argParam);if(W=Q.docId,this.ErrorMessage=Q.errorMessage,W<1){if(this.DocDv[m-fe].xIMP_STATUSx="FAIL",this.DocDv[m-fe].IMPORT_MESSAGE=this.ErrorMessage,this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[m-fe].RevenUStatus="Failed",this.DocDv[m-fe].RevenUReason=this.ErrorMessage),P++,!(this.ProfileID>-20&&this.ProfileID<0)){for(let A=0;A<this.grData.Table.length;A++)if(this.DocDv.filter(""!=f?q=>q.DocNumberField==X:q=>q.VoucherNoField==X),this.DocDv.includes(this.grData.Table[A][0].toString()+"_Key")&&this.DocDv.length>0)for(let q=0;q<this.DocDv.length;q++)""==this.DocDv[q][this.grData.Table[A][0].toString()+"_Key"].toString()&&this.FailedRecourdList.push({Name:Qe+"-"+X,Message:"Invalid "+this.grData.Table[A][0].toString()+" at Row No:"+(q+1)});let te;te=this.ExcelTable.includes("IMPORT_STATUS")?this.DocDv.filter(A=>null==A.IMPORT_STATUS||"PASS"==A.IMPORT_STATUS):""}this.FailedRecourdList.push({Name:Qe+"-"+X,Message:this.ErrorMessage}),this.strSerial=[]}else this.DocDv[m-fe].xIMP_STATUSx="PASS",this.DocDv[m-fe].IMPORT_MESSAGE="",this.ExcelTable.includes("RevenUStatus")&&(this.DocDv[m-fe].RevenUStatus="pass",this.DocDv[m-fe].RevenUReason=this.ErrorMessage),T++,this.strSerial=[];if(this.IgnoreBatch=0,null!=this.ErrorMessage&&this.ErrorMessage.Contains("Saved")&&this.FillLocRefVisibility&&this.FillLocalReference&&this.DocItems.Items.length>0){let te="",A="",q="",O=null;this.ScreenObject.CostCenterID=N.J0.Int(this.Feature.SelectedValue);const H=this.ScreenObject.GetProductTypeDetails(this.DocDv[m-1][this.ProductFieldName+"_Key"].toString(),(0,Ue._U)(this.DocDv[m-1][x].toString()),1,N.J0.Int(this.DocDv[m-1][this.QtyField]),"0",null,!1,"",!0,0,null);null!=H&&H.Tables.length>4&&H.Tables[4].Rows.length>0&&H.Tables[4].Columns[0].ColumnName.Contains("SysColumnName")&&(te='"UPDATE TXT SET " + dsPrd.Tables[4].Rows[0]["SysColumnName"].toString() + "=" + dsPrd.Tables[4].Rows[0]["Value"].toString() + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNUMData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(te));for(let ee=0;ee<this.DocItems.Items.length;ee++)if(this.DocItems.Items[ee].IsChecked){let ue=this.costCenterTableZero.filter(ge=>ge.CostcenterColID===this.DocItems.Items[ee].Value),de=this.grData.Table.filter(ge=>ge.FeatureFieldName===this.DocItems.Items[ee].Value);if(de.length>0&&(q=this.IsCode?2==N.J0.Int(ue[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(ue[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(ue[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(ue[0].ColumnCostCenterID)?"ProductName":"Name",te="SELECT "+ue[0].ParentCostCenterColSysName+" ID FROM "+ue[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+q+"='"+this.DocDv[m-1][de[0].FieldName.toString()]+"'",O=I.d.document.GetDataSet(te),null!=O&&O.length>0)){te="";let ge=[];ge.push(this.DocItems.Items[ee].Value),ge.push(this.Feature.SelectedValue),ge.push(O[0].ID.toString()),ge.push(new Date("dd/MMM/yyyy")),ge.push(0),ge.push("<XML></XML>"),ge.push(0),ge.push(I.d.SessionManager.LanguageID);const ye=I.d.document.GetReferenceData(JSON.stringify(ge));if(null!=ye&&ye.Tables[0].Rows.length>0)for(let J=0;J<ye.Tables[0].length;J++)A=ye.Tables[0].Columns[J].ColumnName.toString(),A.Contains("dcAlpha")&&!A.endsWith("Name")?(te='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=\'" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(te)):A.Contains("dcAlpha")&&A.endsWith("Name")?(te='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString().replace("Name", "") + "=\'" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                         JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                         WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(te)):A.Contains("dcNum")||A.Contains("dcCalcNum")?(te='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNumData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(te)):A.Contains("dcCCNID")&&!A.Contains("Group")&&!A.Contains("Name")&&!A.Contains("Code")&&!A.Contains("lft")&&!A.Contains("rgt")&&(te='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0].Rows[0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocCCData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',I.d.document.GetDataSet(te))}}}}if(this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount=this.IsSaveDocValidate?"Valid :"+T.toString():"Imported :"+T.toString(),this.FailedCount="Failed :"+P.toString(),this.RefreshGrid=!this.RefreshGrid,this.grData.RefreshGrid=!0,this.MessageVisibility=!0,this.DisplayMessage=this.IsSaveDocValidate?"Validation completed ( Total :"+(T+P).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )":"Import completed ( Total :"+(T+P).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.ProfileID>-20&&this.ProfileID<0)if(this.UpdateStatusInExcel)try{const $=this.workbookK,Q=$.SheetNames[0];let A=et.Wp.sheet_to_json($.Sheets[Q],{header:1}),q=A[0];const oe=Y=>(q.includes(Y)||(q.push(Y),A[0]=q),q.indexOf(Y));let O=oe("TMOCODE"),H=oe("Green Code"),ee=oe("RevenUStatus"),ue=oe("RevenUReason");for(let Y=1;Y<A.length;Y++){if("1"===this.ExcelTable[Y-1]?.IsNewRow)continue;let Ke=A[Y];(!Ke[ee]||"Passed"!==Ke[ee])&&("pass"===this.ExcelTable[Y-1]?.RevenUStatus?(Ke[ee]="Passed",this.ExcelTable[Y-1].RevenUStatus="Passed"):Ke[ee]=this.ExcelTable[Y-1]?.RevenUStatus||"",Ke[O]=this.ExcelTable[Y-1]?.TMOCODE||"",Ke[H]=this.ExcelTable[Y-1]?.["Green Code"]||"",Ke[ue]=this.ExcelTable[Y-1]?.RevenUReason||""),A[Y]=Ke}const de=et.Wp.aoa_to_sheet(A);$.Sheets[Q]=de;const ge=et.M9($,{bookType:"xlsx",type:"array"}),ye=new Blob([ge],{type:"application/octet-stream"}),J=document.createElement("a");J.href=URL.createObjectURL(ye),J.download="Updated_File.xlsx",J.click()}catch($){console.error("Error updating Excel:",$)}else this.UpdateExcelSheet()}}catch(u){Logger.ErrorLog("importuitlity","ImportDocument ",u.Message,u)}Logger.InfoLog("Exiting ImportDocument ")}setQuery(){let e,i,l;const s=parseInt(this.Feature.SelectedValue,10);let u="";const h="INV_DocDetails";u="acc_docdetails"===h.toLowerCase()?"D.AccDocDetailsID":"D.InvDocDetailsID";let r,d,c,n,t=[],o=[],a=0;const g={};g[h]="D",t.push(u),o.push(`${h} D with(nolock)`);for(const T of this.grData.Table){if(i=this.costCenterTableZero.filter(m=>m.CostCenterColID===parseInt(T[1],10)),e=i[0],c="T"+a,d=e.SysTableName||h,r=e.SysColumnName,l=null!=e.ColumnCostCenterID?parseInt(e.ColumnCostCenterID,10):0,s>4e4)if("COM_DocTextData"===d)if(g.COM_DocTextData||(g.COM_DocTextData="TXT",o.push(`INNER JOIN COM_DocTextData TXT with(nolock) ON TXT.${u}=D.${u}`)),"DATE"===e.ColumnDataType)r=`convert(datetime,${r})`,t.push(`'' AS C${a}`),t.push(`${r} AS C${a}_Key`);else if("LISTBOX"===e.UserColumnType){let m;if("44"===e.ColumnCostCenterID.toString())m=`,case when ${r} is not null and isnumeric(${r})=1 then (SELECT Name FROM COM_Lookup with(nolock) WHERE NodeID=${r}) else '' end`;else{let S,F,y,C=I.d.report.GetTableColumns(parseInt(e.ColumnCostCenterID));C.TableName=S,C.PrimaryKey=F,C.ColumnName=y,m=`,case when ${r} is not null and isnumeric(${r})=1 then (SELECT ${y} FROM ${S} with(nolock) WHERE ${F}=${r}) else '' end`}t.push(`${m} AS C${a}`),t.push(`case when isnumeric(${r})=1 then ${r} else convert(bigint,-1) end AS C${a}_Key`)}else"LOOKUP"===e.UserColumnType?(t.push(`${r} AS C${a}`),t.push(`${r} AS C${a}_Key`)):t.push(`${r} AS C${a}`);else"COM_DocNumData"===d?(g.COM_DocNumData||(g.COM_DocNumData="NUM",o.push(`INNER JOIN COM_DocNumData NUM with(nolock) ON NUM.${u}=D.${u}`)),t.push(`${r} AS C${a}`)):"COM_DocCCData"===d?(g.COM_DocCCData||(g.COM_DocCCData="DCC",n="acc_docdetails"===h.toLowerCase()?"AccDocDetailsID":"InvDocDetailsID",o.push(`INNER JOIN COM_DocCCData DCC with(nolock) ON DCC.${n}=D.${n}`)),g[r]||(g[r]=c,o.push(`INNER JOIN ${e.ParentCostCenterSysName} ${c} with(nolock) ON ${c}.NodeID=DCC.${r}`)),t.push(`${g[r]}.${this.IsCode?"Code":"Name"} AS C${a}`)):l>0&&!["AccountTypeID","StatusID"].includes(r)?(g[r]||(g[r]=c,o.push(`INNER JOIN ${e.ParentCostCenterSysName} ${g[r]} with(nolock) ON ${g[r]}.${e.ParentCostCenterColSysName}=D.${r}`)),t.push(`${g[r]}.${this.getColumnName(e)} AS C${a}`)):(r=`D.${r}`,"DATE"===e.ColumnDataType?(r=`convert(datetime,${r})`,t.push(`${r} AS C${a}`)):t.push(`${r} AS C${a}`));a++}let p="SELECT "+t.join(", ")+" FROM "+o.join(" ");return p+=" WHERE ",p+=s>4e4&&s<5e4?`D.CostCenterID=${s} AND D.DocID in (${this.SavedIDs})`:`D.NodeID in (${this.SavedIDs})`,p}getColumnName(e){let i;i="parentid"===e.SysColumnName.toString().toLowerCase()?parseInt(this.Feature.SelectedValue,10):parseInt(e.ColumnCostCenterID,10);let l=0;const s=parseInt(e.ParentCCDefaultColID,10);return isNaN(s)||(l=s),2===i?238===l?"AccountCode":"AccountName":3===i?261===l?"ProductCode":"ProductName":16===i?"BatchNumber":"Name"}ReadBarcode(e,i,l,s){let u=[],h="";h=l,u.push("<XML>"),u.push('<Row CostcenterID="3"'),u.push(e?' syscolname="ProductCode"':' syscolname="ProductName"'),u.push(` value="${l}" />`),""!==u.join("")&&u.push("</XML>");let t=I.d.document.GetCCValues_xml(u.join("")),o=!1;if(t&&t.length>0&&t[0].length>0&&t[0][0].hasOwnProperty("CostCenterID"))for(let r=0;r<t[0].length;r++)i[s]=e?t[0][r].Code?.toString()||"":t[0][r].Name?.toString()||"",o=!0;return o}getAccountTransaction(e,i,l,s,u,h,t){let o=[],r=parseFloat(u);return r<0?(o.push(`DebitAccount="${k.Dw.GetValidXml(i)}" `),o.push(`CreditAccount="${k.Dw.GetValidXml(e)}" `),o.push(`Amount="${(r*t*-1).toString()}" `),o.push(`AmtFc="${(-1*r).toString()}" `),o.push('IsNegative="1" '),l&&o.push(' CrAccCode="1" '),s&&o.push(' DrAccCode="1" ')):r>0&&(o.push(`DebitAccount="${k.Dw.GetValidXml(e)}" `),o.push(`CreditAccount="${k.Dw.GetValidXml(i)}" `),o.push(`Amount="${(r*t).toString()}" `),o.push(`AmtFc="${r.toString()}" `),s&&o.push(' CrAccCode="1" '),l&&o.push(' DrAccCode="1" ')),o.push(`CurrencyID="${h.toString()}" `),o.push(`ExchangeRate="${t.toString()}" `),o.join("")}FillBillWiseDt(e,i,l,s){let u,h;u=parseFloat(l),u<0&&(s=!s,u*=-1);const t=i.replace(/'/g,"''").replace(/&/g,"&amp;"),o=e.filter(r=>r.AccountID===t);if(o.length>0)if(h=o[0],!!h.IsCredit!==s){const r=parseFloat(h.Amount.toString());if(r>u)h.Amount=parseFloat(h.Amount.toString())-u;else if(r<u)h.Amount=u-r,h.IsCredit=s;else if(r===u){const d=e.indexOf(h);d>-1&&e.splice(d,1)}}else h.Amount=parseFloat(h.Amount.toString())+u;else h={AccountID:i,Amount:u,IsCredit:s},e.push(h)}SaveDocument(e,i,l,s,u,h,t,o,r,d,c,n,a,g,p,T,m){const S=[];S.push(this.Feature.SelectedValue),S.push(e),S.push(i),S.push(l),S.push(this.formatDDMMMYYYY(s)),S.push(""!==u?this.formatDDMMMYYYY(u):null),S.push(h);const F=!0===window.BulkSave;if(F&&t?(S.push(m[0]),S.push(m[1]),S.push(m[2]),S.push(m[3]),S.push(m[4]),S.push(m[5]),S.push(m[6])):S.push(o),t){let b="";if(d.length>0){if(b+="<BillWise> ",c.Contains(";")){let x=c.split(";");for(let R=0;R<x.length;R++)if(""!=x[R].toString())for(let w of d){b+="<Row ",b+='DocSeqNo="1" ',b+='AccountID="'+w.AccountID.toString()+'" ',b+=' IsNewReference="0" ',b+=' Narration="" ';let U=0;if(x[R].toString().Contains("~")){let V=x[R].split("~");V.length>1&&""!=V[1].toString()&&(U=parseFloat(V[1].toString()))}if(0==U&&(U=parseFloat(w.Amount.toString())),(0,j.yG0)(w.IsCredit.toString())?(b+='AdjAmount="-'+U*T+'" ',b+='AmountFC="-'+U+'" '):(b+='AdjAmount="'+U*T+'" ',b+='AmountFC="'+U+'" '),b+='AdjCurrID="'+p.toString()+'" ',b+='AdjExchRT="'+T.toString()+'" ',x[R].toString().Contains("~")){let V=x[R].split("~");V.length>1&&""!=V[1].toString()&&(b+='RefDocNo="'+V[0]+'" ')}else b+='RefDocNo="'+x[R]+'" ';b+='IsDocPDC="0" ',b+=" ></Row>"}}else for(let x=0;x<d.length;x++)b+="<Row ",b+='DocSeqNo="1" ',b+='AccountID="'+d[x].AccountID.toString()+'" ',b+=' IsNewReference="1" ',b+=' Narration="" ',(0,j.yG0)(d[x].IsCredit.toString())?(b+='AdjAmount="-'+(parseFloat(d[x].Amount.toString())*T).toString()+'" ',b+='AmountFC="-'+d[x].Amount.toString()+'" '):(b+='AdjAmount="'+(parseFloat(d[x].Amount.toString())*T).toString()+'" ',b+='AmountFC="'+d[x].Amount.toString()+'" '),b+='AdjCurrID="'+p+'" ',b+='AdjExchRT="'+T+'" ',b+='RefDocNo="'+c+'" ',b+='IsDocPDC="0" ',b+=" ></Row>";b+=" </BillWise>"}b.replace("&","&amp;"),S.push(b.toString())}S.push(""),S.push(r);const y=window.ProfileID??0,C=window.UniquNo??"";if(y>-20&&y<0){const b=new Date(s);if(this.formatDDMMMYYYY(b)===this.formatDDMMMYYYY(new Date)&&(4===a||5===a))return{docId:-999,errorMessage:"Transactions cannot be processed for Current Date"};S.push(this.PrevDocID>0&&s===this.PrevDocDate?`<XML ImpDocID="${this.PrevDocID.toString()}"  UniquNo="${4===a||5===a?C:""}" />`:`<XML ImpDocID="0" UniquNo="${4===a||5===a?C:""}" />`)}else{let b="",x="";const R=new Date(s),w=R.getMonth()+1;b=w>=I.d.SessionManager.AccountingFromMonth?`1/${this.formatMonthName(I.d.SessionManager.AccountingFromMonth)}/${R.getFullYear()}`:`1/${this.formatMonthName(I.d.SessionManager.AccountingFromMonth)}/${R.getFullYear()-1}`,x=w<I.d.SessionManager.AccountingFromMonth?`${this.daysInMonth(R.getFullYear(),I.d.SessionManager.AccountingToMonth)}/${this.formatMonthName(I.d.SessionManager.AccountingToMonth)}/${R.getFullYear()}`:`${this.daysInMonth(R.getFullYear()+1,I.d.SessionManager.AccountingToMonth)}/${this.formatMonthName(I.d.SessionManager.AccountingToMonth)}/${R.getFullYear()+1}`;const U=!0===window.PartialSave,V=window.ProductTypeID??0,_=window.BatchBasedon??"",Z=window.IgnoreBatch??0;F&&t?S.push(`<XML  FinancialSartDate="${b}" FinancialEndDate="${x}" ${this.getQuery()} ><ScheduleActivityXml></ScheduleActivityXml></XML>`):U&&this.PrevDocID>0&&s===this.PrevDocDate?S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${x}" ImpDocID="${this.PrevDocID.toString()}"  UniquNo="${4===a||5===a?C:""}" />`):t&&5===V&&""!==_&&1===Z?S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${x}" IgnoreBatches="${Z}" />`):38===this._DocumentType?(S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${x}" ><ScheduleActivityXml></ScheduleActivityXml> <PosPayModes>${this.PosPayModesXML.toString()}</PosPayModes></XML>`),this.PosPayModesXML.clear()):S.push(`<XML FinancialSartDate="${b}" FinancialEndDate="${x}" />`)}F&&S.push("<ProjectPlanXml />"),S.push("true"),S.push(a),S.push(n),S.push(this.GetWorkFlow(g)),S.push(I.d.SessionManager.RoleID),t&&S.push(""),S.push(0),S.push(0),S.push(I.d.SessionManager.CompanyGUID),S.push(I.d.SessionManager.UserName),S.push(I.d.SessionManager.UserID),S.push(I.d.SessionManager.LanguageID),S.push(I.d.SessionManager.IsOffline);let f="";if(this.IsSaveDocValidate){const x=I.d.document.SetTempInvDocument_Validate(S).ds;return x&&x.tables&&x.tables.length>0&&x.tables[0]&&x.tables[0].length>0&&x.tables[0].sErrors&&x.tables[0].sErrors.length>0?(f=x.tables[0].sErrors,e=-1234567890):(f="",e=1234567890),{docId:e,errorMessage:f}}{let x;return this.IsInventory?this.BulkSave&&(x=I.d.document.SetTempBulkInvDoc(S)):x=I.d.document.SetTempAccDocument(S),f=x.msg||"",(e=x.docId||0)>0&&(this.PrevDocID=e||0,this.PrevDocDate=s||"",this.SavedIDs.length>0&&(this.SavedIDs+=","),this.SavedIDs+=e.toString()),{docId:e,errorMessage:f}}}getQuery(){let e="";const i=new _e,l=new _e,s=new _e,u=new _e,h=new _e,t=new _e,o=new _e,r=new _e,d=new _e,c=this.costCenterTableZero.filter(n=>String(n.Costcenterid)===String(this.Feature.SelectedValue));for(let n=0;n<c.length;n++){const a=String(c[n].SysColumnName).toLowerCase();a.startsWith("dcnum")?(i.append(c[n].SysColumnName).append(","),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(i.append("dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append(","),i.append("dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append(","),i.append("dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append(",")),i.append("dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append(","),u.append("X.value('@").append(c[n].SysColumnName).append("','Float'),"),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(u.append("X.value('@dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),")),u.append("X.value('@dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("','Float'),"),this.ScreenObject.DocID>0&&(o.append(c[n].SysColumnName).append("="),o.append("X.value('@").append(c[n].SysColumnName).append("','Float'),"),I.d.SessionManager.Preferences["Use Foreign Currency"]&&I.d.SessionManager.Preferences["Use Foreign Currency"]&&(o.append("dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcCurrID").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),o.append("dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcExchRT").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),"),o.append("dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("="),o.append("X.value('@dcCalcNumFC").append(String(c[n].SysColumnName).replace("dcNum","")).append("','Float'),")),o.append("dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("="),o.append("X.value('@dcCalc").append(String(c[n].SysColumnName).replace("dc","")).append("','Float'),"))):a.startsWith("dcalpha")?(s.append(c[n].SysColumnName).append(","),t.append("X.value('@").append(c[n].SysColumnName).append("','Nvarchar(max)'),"),this.ScreenObject.DocID>0&&(d.append(c[n].SysColumnName).append("="),d.append("X.value('@").append(c[n].SysColumnName).append("','Nvarchar(max)'),"))):a.startsWith("dcccnid")&&(l.append(c[n].SysColumnName).append(","),h.append("isnull(X.value('@").append(c[n].SysColumnName).append("','BIGINT'),1),"),this.ScreenObject.DocID>0&&(r.append(c[n].SysColumnName).append("="),r.append("isnull(X.value('@").append(c[n].SysColumnName).append("','BIGINT'),1),")))}return e+=' NumCols="'+i.toString()+'" ',e+=' TextCols="'+s.toString()+'" ',e+=' CCCols="'+l.toString()+'" ',e+=' NumSelCols="'+u.toString()+'" ',e+=' TextSelCols="'+t.toString()+'" ',e+=' CCSelCols="'+h.toString()+'" ',this.ScreenObject.DocID>0&&(e+=' NumUpdateCols="'+o.toString()+'" ',e+=' TextUpdateCols="'+d.toString()+'" ',e+=' CCUpdateCols="'+r.toString()+'" '),e.toString()}ClearVaraiables(){this.ccdv=[],this.CCQuery=[],this.CCQueryData.Items=[],this.IsScaned=!1,this.IsPreviewDataOk=!1,this.COls=[],this.temp=[],this.GroupExists=!1,this.lookupdv=[],this.lookupQuery=[],this.lookuptemp=[],this.NotesList=[],this.ErrorList=[],this.RulesList=[]}OnImportData(e){this.IsSaveDocValidate=!1,this.ImportingMessage="Importing Data Please Wait....",this.ImportDataClick()}ImportDataClick(){if(N.J0.Int(this.Feature.SelectedValue),null==this.ActualFileName||""===this.ActualFileName)return Logger.InfoLog("Entered into  SelectFiletoImport..."),this.DisplayMessage=I.d.GetResource("SelectFiletoImport"),this.MessageVisibility=!0,this.ImportVisbility=!0,void Logger.InfoLog("Exited into  SelectFiletoImport...");{const l=I.d.common.GetDataSet("DOC0844",this.Feature.SelectedValue);if(!this.IsUpdate&&l.Tables[1]&&l.Tables[1].length>0&&this.Feature.SelectedItem.Name.ToString().toUpperCase()==l.Tables[1][0].Name.ToString().toUpperCase()&&(N.J0.Int(this.Feature.SelectedValue)<4e4||N.J0.Int(this.Feature.SelectedValue)>=5e4)&&!this.IsUpdate&&l.Tables[1].length>0&&this.Feature.SelectedItem.Name.toUpperCase()===l.Tables[1][0].Name.toUpperCase()&&(Number(this.Feature.SelectedValue)<4e4||Number(this.Feature.SelectedValue)>=5e4)&&l&&l.Tables[0].length>0){if(!this.ExcelTable.includes("CodeNumber"))return this.DisplayMessage="CodeNumber Mandatory While Using Auto Code",void(this.MessageVisibility=!0);if(!this.ExcelTable.includes("CodePrefix"))return this.DisplayMessage="CodePrefix Mandatory While Using Auto Code",void(this.MessageVisibility=!0)}if(this.ValidateBeforeImport){if(this.grData.Table.length>0&&("40"!==this.Feature.SelectedValue||"Dimension Wise Price Chart"!==this.Feature.SelectedItem.Name)){let s=Object.values(this.grData.Table.reduce((h,t)=>{const o=t.FeatureFieldName;return h[o]||(h[o]={Name:o,ColCount:0}),h[o].ColCount++,h},{}));s.sort((h,t)=>h.Name.localeCompare(t.Name));const u=s;for(const[h,t]of Object.entries(u))if(h.ColCount>1&&h.Name){const o=this.grData.Table.filter(r=>r.FeatureFieldName===h.Name);if(o.length>1)return this.DisplayMessage="Duplicate fields selected at Rows "+(this.grData.Table.indexOf(o[0])+1)+" & "+(this.grData.Table.indexOf(o[1])+1),void(this.MessageVisibility=!0)}}if(!this.ValidateExcelData())return}Logger.InfoLog("After ValidateBeforeImport check..."),this.FailedRecourdList=[],this.ProgressVisbility=!0,this.ProgressValue=0,this.ImportVisbility=!1,this.MessageVisibility=!1,this.ImportedCount="",this.FailedCount="",Logger.InfoLog("Before ClearVaraiables()..."),this.ClearVaraiables(),Logger.InfoLog("After ClearVaraiables()..."),Logger.InfoLog("Before  ExcelTable check..."),null!=this.ExcelTable&&(Logger.InfoLog("ExcelTable is not null... Rows :: "+this.ExcelTable.length),("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue||Number(this.Feature.SelectedValue)>5e4&&Number(this.Feature.SelectedValue)<=50075)&&("Account Dimension wise Cr/Dr Limits"!==this.Feature.SelectedItem.Name&&"Account Report Template"!==this.Feature.SelectedItem.Name&&"Account Contacts"!==this.Feature.SelectedItem.Name&&"Account Address"!==this.Feature.SelectedItem.Name||"2"!==this.Feature.SelectedValue)&&("KIT PRODUCTS"!==this.Feature.SelectedItem.Name.toUpperCase()&&"Product QC"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!==this.Feature.SelectedItem.Name&&"Products With Vendor Multiple Barcode"!==this.Feature.SelectedItem.Name&&"PRODUCTS WISE BINS"!==this.Feature.SelectedItem.Name.toUpperCase()||"3"!==this.Feature.SelectedValue)&&"JOB OUTPUT"!==this.Feature.SelectedItem.Name.toUpperCase()&&"PRODUCTS WITH SUBSTITUTES"!==this.Feature.SelectedItem.Name.toUpperCase()?(Logger.InfoLog("Before groupmethod()..."),this.groupmethod(),Logger.InfoLog("After groupmethod()...")):(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<5e4&&(this.MapDebitCreditAccountFields(),this.CheckAvgRateexists()),this.ProgressMax=this.ExcelTable.length))}}ValidateExcelData(){if(this.IsUpdate)return!0;try{const e=Number(this.Feature.SelectedValue);if(2===e||3===e||e>5e4||e>4e4&&e<5e4){if(this.ExcelTable&&this.ExcelTable.length>0){const i=[...this.ExcelTable];if(e>4e4&&e<5e4){if(this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const l=this.costCenterTableZero.filter(s=>s.CostCenterID===e&&1===s.IsMandatory);if(l.length>0)for(const s of l){let u=this.grData.Table.filter(h=>h.FeatureFieldName===String(s.CostCenterColID));if(!u||0===u.length){let h=!1;const t=String(s.SysColumnName).toUpperCase();if("PRODUCTID"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&r.SysColumnName===t&&r.CostCenterColID!==s.CostCenterColID);for(const r of o)if(this.grData.Table.some(d=>d.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}else if("DEBITACCOUNT"===t||"DEBITACCOUNTCODE"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&("DebitAccount"===r.SysColumnName||"DebitAccountCode"===r.SysColumnName)&&r.CostCenterColID!==s.CostCenterColID);for(const r of o)if(this.grData.Table.some(d=>d.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}else if("CREDITACCOUNT"===t||"CREDITACCOUNTCODE"===t){const o=this.costCenterTableZero.filter(r=>r.CostCenterID===e&&("CreditAccount"===r.SysColumnName||"CreditAccountCode"===r.SysColumnName)&&r.CostCenterColID!==s.CostCenterColID);for(const r of o)if(this.grData.Table.some(d=>d.FeatureFieldName===String(r.CostCenterColID))){h=!0;break}}if(!h)return this.DisplayMessage=`${s.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}}}else if((2===e||3===e||e>5e4)&&this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const l=this.costCenterTableZero.filter(s=>s.CostCenterID===e&&1===s.IsMandatory);if(l.length>0)for(const s of l){let u=String(s.SysColumnName||"").trim().toUpperCase();if(""===u||2===e&&["ACCOUNTID","PARENTID","ACCOUNTTYPEID","STATUSID","ISGROUP","ACCOUNTGROUP"].includes(u)||3===e&&["PRODUCTID","PARENTID","PRODUCTTYPEID","VALUATIONID","STATUSID","ISLOTWISE","PRODUCTGROUP"].includes(u)||e>5e4&&"ISGROUP"===u)continue;const h=this.grData.Table.filter(t=>t.FeatureFieldName===String(s.CostCenterColID));if(!h||0===h.length)return this.DisplayMessage=`${s.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}if(this.grData.Table.length>0)for(let l=0;l<i.length;l++)for(let s=0;s<this.grData.Table.length;s++){if(!this.grData.Table[s].FeatureFieldName)continue;const u=this.costCenterTableZero.filter(h=>String(h.CostCenterColID)===this.grData.Table[s].FeatureFieldName);if(u.length>0){const h=this.grData.Table[s].FieldName,t=String(u[0].UserColumnType||"").trim().toUpperCase();if(this.costCenterTableZero[0].hasOwnProperty("IsMandatory")&&u[0].IsMandatory&&"0"!==u[0].IsMandatory){const d=String(i[l][h]||"").trim();if(["NUMERIC","BIGINT","FLOAT","INT"].includes(t)&&(""===d||isNaN(Number(d))||0===Number(d)))return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory/invalid, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1;if(""===d)return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1}if(["DATE","DATETIME","FIXEDDATE","FIXEDDATETIME"].includes(t)){const r=String(i[l][h]||"").trim();if(""!==r){const d=new Date(r);if(isNaN(d.getTime())||1===d.getFullYear())return this.DisplayMessage=`${u[0].ResourceData} - field data is invalid, check at Row No. ${l+1}`,this.MessageVisibility=!0,!1}}}}return!0}return this.DisplayMessage="Excel data not found.",this.MessageVisibility=!0,!1}return!0}catch(e){return this.DisplayMessage=e.message,this.MessageVisibility=!0,Logger.ErrorLog(`Exception :: ValidateExcelData() - Message :: ${e.message}\nStack Trace :: ${e.stack}`),!1}}ImportEmployeeData(){let e=0,i=0,l=0,u=0,t="",o="",r="",d=!0,c=[],n=null,g=null,p=null;this.GradeFromDate=new Date(this.dtValue.getFullYear(),0,1),this.LocFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DeptFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DesgFromDate=new Date(this.dtValue.getFullYear(),0,1);let T=this.costCenterTableZero,m=this.costCenterTableZero;this.objCG.Data=I.d.common.GetScreenInfo(50051),console.log(" this.objCG.Data",this.objCG.Data),this.objCG.IsEmpImport=!0,this.objCG.InitAutoCode(this.objCG.Data.Tables[7],!1);let S=null,F=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().Length>0&&(F=new N.VB,F.LoadXml(this.CodeDef[0].PrefixContent.toString()));for(let C=0;C<this.ExcelTable.length;C++){this.objEmp=new Ct.h,null!=F&&(S=this.GetCodeData(this.ExcelTable[C],0));for(let f=0;f<this.grData.Table.length;f++){if(g=this.ExcelDataColumn.indexOf(this.DtImport[f].FieldName),null==this.grData.Table[f].FeatureFieldName||""==this.grData.Table[f].FeatureFieldName.toString())continue;const x=T.filter(R=>R.CostCenterColID==this.grData.Table[f].FeatureFieldName.toString());if(x.length>0){let R=x[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+R),R){case"Code":this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g),0==this.IsUpdate?""==this.objEmp.EmpCode&&(this.objEmp.EmpCode=this.ExcelTable[C][g]):this.objEmp.EmpCode=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()];break;case"Name":0==this.objEmp.SelectedNodeID&&(this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g)),""==this.objEmp.EmpCode.toString()&&0==this.IsUpdate&&null==this.objEmp.EmpCode&&(this.objEmp.EmpCode=""),this.objEmp.EmpName=this.ExcelTable[C][g];break;case"ParentGroupName":this.objEmp.SelectedNodeID=N.J0.StringIsNullOrEmpty(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()+"_Key"].toString())?1:N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()+"_Key"].toString());break;case"CodePrefix":null==S&&(this.objEmp.CodePrefix=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"CodeNumber":null==S&&(this.objEmp.CodeNumber=N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"AliasName":this.objEmp.EmpAliasName=this.ExcelTable[C][g];break;case"StatusID":const w=this.objCG.Data.Tables[3].filter(U=>U.Status==this.ExcelTable[C][g]);w.length>0?this.objEmp.StatusID=N.J0.Int(w[0].StatusID):(n=I.d.document.GetEmpImportDetails(0,this.ExcelTable[C][g],0),this.objEmp.StatusID=N.J0.Int(n.Tables[0].StatusID));break;case"RptManager":if("null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]){let U;1==this.IsCode&&(U=I.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Code='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=U&&U.Rows.length>0?N.J0.Int(U.Rows[0].NodeId.toString()):0),0==this.IsCode&&(U=I.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=U&&U.Rows.length>0?N.J0.Int(U.Rows[0].NodeId.toString()):0)}else this.objEmp.RptManager=0;break;case"EmpType":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.EmpTypeID=N.J0.Int(this.objCG.Data.Tables[8][0].NodeID):(n=I.d.document.GetEmpImportDetails(1,this.ExcelTable[C][this.grData.Table[f].FieldName.toString()],104),this.objEmp.EmpTypeID=N.J0.Int(n.Tables[0].Rows[0].NodeID))):this.objEmp.EmpTypeID=0;break;case"Gender":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.Gender=this.objCG.Data.Tables[8][0].NodeID.toString():(n=I.d.document.GetEmpImportDetails(1,this.ExcelTable[C][this.grData.Table[f].FieldName.toString()],104),this.objEmp.Gender=n.Tables[0].Rows[0].NodeID.toString())):this.objEmp.Gender="0";break;case"DOJ":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.DOJ=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()])),this.Doj=this.objEmp.DOJ;break;case"DOB":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.DOB=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"ProbationDays":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.objEmp.ProbationDays=N.J0.Int(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]));break;case"DOConfirmation":this.objEmp.DOConfirmation="null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]?new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]):this.objEmp.DOJ.AddDays(this.objEmp.ProbationDays);break;case"Assigned_VacDaysPeriod":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.strVacDayPeriod=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"CurrencyID":this.CostCenterFieldsAllTables.Tables[2].filter(U=>U.Name==this.ExcelTable[C][this.grData.Table[f].FieldName.toString().Trim()]),this.intCurrencyID=this.CostCenterFieldsAllTables.Tables[2].length>0?N.J0.Int(this.CostCenterFieldsAllTables.Tables[2][0].CurrencyID):1;break;case"GradeFromDate":"null"!=this.CostCenterFieldsAllTables[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.GradeFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Grade");break;case"LocFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.LocFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Loc");break;case"DeptFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DeptFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Dept");break;case"DesgFromDate":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DesgFromDate=new Date(this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]),t="Desg");break;case"GradeRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.GradeRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"LocRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.LocRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DeptRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DeptRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DesgRemarks":"null"!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]&&(this.DesgRemarks=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]);break;case"DimensionImage":try{this.grData.Table[f].FieldName.toString()}catch{o=""}break;case"Attachments":if("50051"==this.Feature.SelectedValue)try{let U=this.ExcelTable[C][this.grData.Table[f].FieldName.toString()];U.Length>0&&U.Split(";")}catch{r=""}break;default:if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let U=I.d.document.GetDataSet("Select NodeID,Code,Name FROM COM_CC50051 WITH(NOLOCK) WHERE "+this.UpdateBasedOn.SelectedValue+" = '"+this.ExcelTable[C][this.grData.Table[f].FieldName.toString()]+"' ");null!=U&&U.Rows.length>0&&(this.objEmp.EmpCode=U.Rows[0].Code.toString(),this.objEmp.EmpName=U.Rows[0].Name.toString())}}}}if(1==this.IsUpdate&&null!=this.objEmp.EmpCode.toString()&&""!=this.objEmp.EmpName.toString()){if(u=0,1==this.IsUpdate&&0==this.IsCode&&(c=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+this.objEmp.EmpName+"'")),1==this.IsUpdate&&1==this.IsCode&&(c=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+this.objEmp.EmpCode+"'")),c.length>0&&(u=N.J0.Int(c[0].NodeID),this.objEmp.GUID=c[0].GUID.toString(),this.objEmp.EmpCode=c[0].Code.toString(),this.objEmp.CodePrefix=c[0].CodePrefix.toString(),this.objEmp.CodeNumber=N.J0.Int(c[0].CodeNumber),this.objEmp.SelectedNodeID=N.J0.Int(c[0].ParentID),this.dsEdit=this.objEmpEss.GetEmpMasterDetails(),0)){if(m.filter(f=>"COM_CC50051"==f.sysTableName),m.length>0)for(let f=0;f<m.length;f++){let b=m[f].SysColumnName.toString(),x=m[f].CostCenterColID.toString();switch(Logger.InfoLog("ImportCosCenters-Update Columnname ="+b),this.drupd=this.grData.Table.filter(R=>R.FeatureFieldName==x),b){case"AliasName":0==this.drupd.length&&(this.objEmp.EmpAliasName=p.Tables[0].Rows[0].AliasName.toString());break;case"StatusID":0==this.drupd.length&&(this.objEmp.StatusID=N.J0.Int(p.Tables[0].Rows[0].StatusID.toString()));break;case"EmpType":0==this.drupd.length&&(this.objEmp.EmpTypeID=N.J0.Int(p.Tables[0].Rows[0].EmpType.toString()));break;case"Gender":0==this.drupd.length&&(this.objEmp.Gender=p.Tables[0].Rows[0].Gender.toString());break;case"RptManager":N.J0.Int(x.toString())>0&&0==this.drupd.length&&(this.objEmp.RptManager=N.J0.Int(p.Tables[0].Rows[0].RptManager.toString()));break;case"DOJ":0==this.drupd.length?(this.dtValue=new Date(p.Tables[0][0].cDOJ.toString()),this.objEmp.DOJ=new Date(this.dtValue),this.Doj=this.objEmp.DOJ):""==t.toString()?(this.strHistoryMsg="",c=I.d.document.GetDataSet("select Top 1 Convert(DateTime,FromDate) FromDate From COM_HistoryDetails with(nolock) Where CostCenterID=50051 and HistoryCCID=50053 And NodeID='"+u.toString()+"' Order By Convert(DateTime,FromDate)"),c.length>0&&this.Doj.toLocaleDateString("MMM/yyyy")!=new Date(c[0].FromDate).toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with history dimensions")):("Grade"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.GradeFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with grade dimension"),"Loc"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.LocFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with location dimension"),"Dept"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DeptFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with department dimension"),"Desg"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DesgFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with designation dimension"));break;case"DOB":0==this.drupd.length&&(this.dtValue=new Date(p.Tables[0][0].cDOB.toString()),this.objEmp.DOB=new Date(this.dtValue));break;case"ProbationDays":0==this.drupd.length&&(this.objEmp.ProbationDays=N.J0.Int(p.Tables[0][0].ProbationDays.toString()));break;case"DOConfirmation":0==this.drupd.length&&(this.dtValue=new Date(p.Tables[0][0].cDOConfirmation.toString()),this.objEmp.DOConfirmation=new Date(this.dtValue));break;case"CurrencyID":0==this.drupd.length&&(this.intCurrencyID=""!=p.Tables[0][0].CurrencyID.toString()?N.J0.Int(p.Tables[0][0].CurrencyID.toString()):1)}}p.Tables[7].Rows.length>0&&(this.EmpGrade=N.J0.Int(p.Tables[7][0].CCNID53.toString()))}0==u?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"No Employee Exist"}),d=!1):(d=!0,""!=this.strHistoryMsg.toString()?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.strHistoryMsg.toString()}),d=!1):(this.strHistoryMsg="",this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,C,g),""!=this.strHistoryMsg.toString()&&(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"Dependency with code/fromdate in history dimensions"}),d=!1)))}if(1==d&&(this.objEmp.NodeID=u,this.objEmp.NotesXML="",this.objEmp.ContactsXML="",this.objEmp.AddressXML="",o.length>0&&(o="<AttachmentsXML>"+o+"</AttachmentsXML>"),r.length>0&&(r="<AttachmentsXML>"+r+"</AttachmentsXML>"),this.objEmp.AttachmetsXML=r+o,this.objEmp.CustomFieldsQuery=this.GetCustomFieldsQuery(this.objCG.Data,null,C,g),""!=this.IDHistoryMessage.toString()&&(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.IDHistoryMessage.toString()}),d=!1),1==d)){this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,C,g);let f="";if("TRUE"==I.d.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&I.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")){if(null!=this.objEmp.CustomCostCenterFieldsQuery&&this.objEmp.CustomCostCenterFieldsQuery.length>0){let x=this.objEmp.CustomCostCenterFieldsQuery.split(",");if(x.length>0)for(let R=0;R<x.length;R++)null!=x[R]&&x[R].Contains("CCNID2=")&&(f+='<Row  CostCenterId="50002" NodeID="'+x[R].replace("'","").substring(8)+'" />')}""==f?this.objEmp.CCMapXML="":this.objEmp.CCMapXML+="<XML>"+f+"</XML>"}else this.objEmp.CCMapXML="";this.objEmp.HistoryXML=this.HistoryCCXML,this.objEmp.DocumentsXML="",this.objEmp.IDHistoryXML=this.HistoryCCXML,this.objEmp.PaymentModeXML=this.PaymentModeXML,this.objEmp.AccLinkXML=this.SetComponentAccountMapping(null,u,C),this.objEmp.PrimaryContactQuery="",this.objEmp.PayQuery=this.GetEmployeePayQuery(null,C,u),this.objEmp.dsPayStructure=""!=this.objEmp.PayQuery.toString()?"True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1):null,0==this.objEmp.StatusID&&(this.objEmp.StatusID=""!=I.d.SessionManager.Preferences.DefaultEmpStatus?N.J0.Int(I.d.SessionManager.Preferences.DefaultEmpStatus):250),this.objEmp.IsImport=!0,this.objEmp.RotationalLeave="";let b=0;this.objEmpEss.SaveEmpMaster("","SaveEmpMaster").subscribe(x=>{this.DisplayMessage=x.Message,b=x.RetValue,l=b,l<0?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.DisplayMessage})):e++},x=>{console.log("Employee Master Save : "+JSON.stringify(x))})}this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString()}let y=i+e;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+y.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCustomFieldsQuery(e,i,l,s){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomFieldsQuery");let t,d,h=null,o="",r="",c="",n="",a="",g="",p="",T="",m="",S="",F="",y=["Code","Name","StatusID","AliasName","EmpType","RptManager","DOJ","DOB","Gender","ProbationDays","DOConfirmation"],C=e.Tables[0].filter(b=>!y.includes(b.SysColumnName));if(C.length>0){for(let b=0;b<=C.length-1;b++)for(let x=0;x<this.grData.Table.length;x++)if(null!=this.grData.Table[x].FeatureFieldName&&""!=this.grData.Table[x].FeatureFieldName.toString()&&C[b].CostCenterColID.toString()==this.grData.Table[x].FeatureFieldName.toString()){if(("PassportNo"==C[b].SysColumnName.toString()||"VisaNo"==C[b].SysColumnName.toString()||"IqamaNo"==C[b].SysColumnName.toString()||"ContractNo"==C[b].SysColumnName.toString()||"IDNo"==C[b].SysColumnName.toString()||"LicenseNo"==C[b].SysColumnName.toString()||"MedicalNo"==C[b].SysColumnName.toString())&&(p="",T="",m="",S="",F="",t=this.ExcelTable[l][s],null!=t&&""!=t)){c+='<Row Number="'+t+'"';let R=e.Tables[0];R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"IssDate'";let w=this.grData.Table.filter(_=>_.FeatureFieldName==R[0].CostCenterColID.toString()),U=new Date;if(R.length>0&&null!=w&&w.length>0){let _=new Date;(""==this.ExcelTable[l][w[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][w[0].FieldName.toString().Trim()]))&&(p=_.toLocaleDateString("dd/MMM/yyyy"))}if(R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"ExpDate'",R.length>0){let _=w;null!=_&&_.length>0&&(""==this.ExcelTable[l][_[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][_[0].FieldName.toString().Trim()]))&&(T=U.toLocaleDateString("dd/MMM/yyyy"))}if(null!=p&&""!=p&&p.length>0){if(null!=T&&""!=T&&T.length>0&&new Date(p)>new Date(T)&&(this.IDHistoryMessage+=C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+" ExpDate Should be greater than IssDate "),c+=' IssDate="'+new Date(p).toLocaleDateString("dd MMM yyyy")+'"',null!=T&&""!=T&&T.length>0&&(c+=' ExpDate="'+new Date(T).toLocaleDateString("dd MMM yyyy")+'"'),"ContractNo"==C[b].SysColumnName.toString()){if(R.RowFilter="SysColumnName='"+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+"ExtendDate'",R.length>0){let _=w;null!=_&&_.length>0&&(""==this.ExcelTable[l][_[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][_[0].FieldName.toString().Trim()]))&&(m=U.toLocaleDateString("dd/MMM/yyyy"))}null!=m&&""!=m&&m.length>0&&(c+=' ExtendDate="'+new Date(m).toLocaleDateString("dd MMM yyyy")+'"')}if("VisaNo"==C[b].SysColumnName.toString()&&I.d.SessionManager.Preferences.ContainsKey("CountryDimension")&&""!=I.d.SessionManager.Preferences.CountryDimension&&parseInt(I.d.SessionManager.Preferences.CountryDimension)>0){let _=this.grData.Table.filter(Z=>"-14"==Z.FeatureFieldName);if(null!=_&&_.length>0&&(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][_[0].FieldName.toString()],parseInt(I.d.SessionManager.Preferences.CountryDimension)),h.Tables.length>0))for(let Z=0;Z<h.Tables.length;Z++)h.Tables[Z].includes("NodeID")&&(S=String(h.Tables[Z][0].NodeID));null!=S&&""!=S&&S.length>0&&(c+=' Country="'+S.toString()+'"'),_=this.grData.Table.filter(Z=>"-15"==Z.FeatureFieldName),null!=_&&_.length>0&&""!=this.ExcelTable[l][_[0].FieldName.toString().Trim()]&&(F=this.ExcelTable[l][_[0].FieldName.toString()]),null!=F&&""!=F&&F.length>0&&(c+=' IsDefault="'+F.toString()+'"')}}let V="";if("PassportNo"==C[b].SysColumnName.toString()?V="-51001":"VisaNo"==C[b].SysColumnName.toString()?V="-51002":"IqamaNo"==C[b].SysColumnName.toString()?V="-51003":"ContractNo"==C[b].SysColumnName.toString()?V="-51004":"IDNo"==C[b].SysColumnName.toString()?V="-51005":"LicenseNo"==C[b].SysColumnName.toString()?V="-51006":"MedicalNo"==C[b].SysColumnName.toString()&&(V="-51007"),c+=' DType="'+V+'"',c+=' sDType="'+C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+'"',null!=i){let _=i;_.filter(Z=>Z.DType==V),_.Sort="Field2 DESC",null!=p&&""!=p&&p.length>0&&_.length>0&&""!=_[0].Field5.toString()&&new Date(p)<new Date(parseFloat(_[0].Field5)).AddDays(2)&&(this.IDHistoryMessage+=C[b].SysColumnName.toString().substring(0,C[b].SysColumnName.toString().length-2)+" IssDate Should be greater than "+new Date(parseFloat(_[0].Field5)).AddDays(2).toLocaleDateString("dd MMM yyyy")+" "),c+=_.length>0?' SNo="'+_.length+'1"':' SNo="1"'}else c+=' SNo="1"';c+="/>"}if("PaymentMode"==C[b].SysColumnName.toString()&&(t=this.ExcelTable[l][s],null!=t&&""!=t)){n+='<Row PaymentMode="'+t+'"',t="";let R=e.Tables[0];if(R.RowFilter="SysColumnName='iBank'",R.length>0){let w=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());if(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][w[0].FieldName.toString()],parseInt(R[0].ColumnCostCenterID)),h.Tables.length>0)for(let U=0;U<h.Tables.length;U++)h.Tables[U].includes("NodeID")&&(t=String(h.Tables[U][0].NodeID))}if(n+=null!=t&&""!=t?' iBank="'+t+'"':' iBank="0"',R.RowFilter="SysColumnName='BankAccNo'",t="",R.length>0){let w=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());null!=w&&w.length>0&&(t=this.ExcelTable[l][w[0].FieldName.toString()])}if(n+=' BankAccNo="'+t+'"',R.RowFilter="SysColumnName='IBANNo'",t="",R.length>0){let w=this.grData.Table.filter(U=>U.FeatureFieldName==R[0].CostCenterColID.toString());null!=w&&w.length>0&&(t=this.ExcelTable[l][w[0].FieldName.toString()])}if(n+=' IBANNo="'+t+'"',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',null!=i){let w=i;w.filter(U=>"-51011"==U.DType),w.Sort="Field2 DESC",n+=w.length>0?' SNo="'+w.length+'1"':' SNo="1"'}else n+=' SNo="1"';n+="/>"}if("text"==C[b].UserColumnType.toString().toLowerCase())"30406"==C[b].CostCenterColID.toString()||"30407"==C[b].CostCenterColID.toString()?"Bank Transfer"==o.toString()?(t=this.ExcelTable[l][s],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):("Cash"==o.toString()||"Cheque"==o.toString()||"Demand Draft"==o.toString())&&(t="",r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):"PAY_EmpPay"!=C[b].SysTableName.toString()&&"PAY_EmpAccountsLinking"!=C[b].SysTableName.toString()&&(t=this.ExcelTable[l][s],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combobox"==C[b].UserColumnType.toString().toLowerCase())"30366"==C[b].CostCenterColID.toString()||"36894"==C[b].CostCenterColID.toString()||"30367"==C[b].CostCenterColID.toString()?(t="","null"!=this.ExcelTable[l][s].toString()&&""!=this.ExcelTable[l][s]&&(e.Tables[8].RowFilter="Name='"+this.ExcelTable[l][s]+"'",e.Tables[8].length>0?t=String(e.Tables[8][0].NodeID):("30366"==C[b].CostCenterColID.toString()?h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][s],108):"36894"==C[b].CostCenterColID.toString()?h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][s],114):"30367"==C[b].CostCenterColID.toString()&&(h=I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][s],122)),t=String(h.Tables[0][0].NodeID))),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):"RoleID"==C[b].SysColumnName.toString()?(t="",d=I.d.document.GetDataSet("select RoleID from ADM_PRoles where Name='"+this.ExcelTable[l][s]+"'"),null!=d&&d.length>0&&(t=d.Rows[0].RoleID.toString()),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"):(t=this.ExcelTable[l][s],"PaymentMode"==C[b].SysColumnName.toString()&&(o=t),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combotextvalue"==C[b].UserColumnType.toString().toLowerCase()&&"30366"!=C[b].CostCenterColID.toString()&&"36894"!=C[b].CostCenterColID.toString())""!=this.strVacDayPeriod.toString()&&(t=this.ExcelTable[l][s],r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',",t=this.strVacDayPeriod,r+="VacDaysPeriod=N'"+t.replace("'","''")+"',");else if("date"==C[b].UserColumnType.toString().toLowerCase())t=this.ExcelTable[l][s],""!=t&&(t=new Date(t).toLocaleDateString("dd/MMM/yyyy"),C[b].SysColumnName.toString().toLowerCase().Contains("ccalpha")?r+=C[b].SysColumnName+"=N'"+t+"',":r+=C[b].SysColumnName+"=CONVERT(FLOAT,CONVERT(DATETIME,'"+t+"')),");else if("COM_CC50051"==C[b].SysTableName.toString()&&"listbox"==C[b].UserColumnType.toString().toLowerCase()){if(t="","30117"==C[b].CostCenterColID.toString())t=this.intCurrencyID.toString(),r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',";else if("30402"==C[b].CostCenterColID.toString()&&"Bank Transfer"==o.toString()){if(h=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][s],parseInt(C[b].ColumnCostCenterID)),h.Tables.length>0)for(let R=0;R<h.Tables.length;R++)h.Tables[R].includes("NodeID")&&(t=String(h.Tables[R][0].NodeID));r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"}else if("30003"!=C[b].CostCenterColID.toString()&&"30402"!=C[b].CostCenterColID.toString()&&"30117"!=C[b].CostCenterColID.toString()){if(h=null!=C[b].ColumnCostCenterID&&null!=C[b].ColumnCostCenterID&&"44"==C[b].ColumnCostCenterID.toString()?I.d.document.GetEmpImportDetails(1,this.ExcelTable[l][s],parseInt(C[b].ColumnCostCenterID)):I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][s],parseInt(C[b].ColumnCostCenterID)),h.Tables.length>0)for(let R=0;R<h.Tables.length;R++)h.Tables[R].includes("NodeID")&&(t=String(h.Tables[R][0].NodeID));r+=C[b].SysColumnName+"=N'"+t.replace("'","''")+"',"}}else if("checkedlistbox"==C[b].UserColumnType.toString().toLowerCase()){if("checkinoutdevice"==C[b].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[l][s],""!=t&&(r+=C[b].SysColumnName+"=N'"+t+"',")),"attsetdimnodes"==C[b].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[l][s],""!=t)){let R=t.split(",");if(I.d.SessionManager.Preferences.ContainsKey("AttendanceDimension")&&""!=I.d.SessionManager.Preferences.AttendanceDimension.toString()&&"4"!=I.d.SessionManager.Preferences.AttendanceDimension.toString()){let w="SELECT NodeID,Code,Name FROM "+this.ScreenObject.GetTableName(parseInt(I.d.SessionManager.Preferences.AttendanceDimension))+" WITH(NOLOCK) WHERE IsGroup=0",U=I.d.document.GetDataSet(w);if(null!=U&&U.length>0){let V,_="";for(var f of R)""!=f.toString()&&(V=U.filter(Z=>Z.Name==Z.toString()),null!=V&&V.length>0&&(null!=_&&_.length>0&&(_+=","),_+=V[0].NodeID));r+=C[b].SysColumnName+"=N'"+_+"',"}}}}else("radiobutton"==C[b].UserColumnType.toString().toLowerCase()||"checkbox"==C[b].UserColumnType.toString().toLowerCase())&&(t=this.ExcelTable[l][s],""!=t&&(r+=C[b].SysColumnName+"=N'"+t+"',"))}null!=c&&c.length>0&&(a="<XML>"+c+"</XML>"),null!=n&&n.length>0?g="<XML>"+n+"</XML>":this.IsUpdate||(n+='<Row PaymentMode="Cash"',n+=' iBank="0"',n+=' BankAccNo=""',n+=' IBANNo=""',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',n+=' SNo="1"',n+="/>",g="<XML>"+n+"</XML>")}return r.toString()}GetCustomCostCenterFieldsQuery(e,i,l,s){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomCostCenterFieldsQuery");let h,t="",o="",r="",d=null,c=e.Tables[0].filter(n=>null!==n.SectionID||0);if(c.length>0){for(let n=0;n<=c.length-1;n++)for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&c[n].CostCenterColID.toString()==this.grData.Table[a].FeatureFieldName.toString())if("COM_CCCCDATA"==c[n].SysTableName.toString()&&"listbox"==c[n].UserColumnType.toString().toLowerCase()&&""==c[n].UserProbableValues.toString()){if(h="","null"!=this.ExcelTable[l][s].toLowerCase().toString()&&""!=this.ExcelTable[l][s].toString()&&"CurrencyID"!=c[n].SysColumnName.toString()&&"iBank"!=c[n].SysColumnName.toString()){if(d=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][s].toString(),parseInt(c[n].ColumnCostCenterID)),d.Tables.length>0)for(let g=0;g<d.Tables.length;g++)d.Tables[g].includes("NodeID")&&(h=String(d.Tables[g][0].NodeID));r+=c[n].SysColumnName+"=N'"+h.replace("'","''")+"',"}}else if("listbox"==c[n].UserColumnType.toString().toLowerCase()&&("H"==c[n].UserProbableValues.toString().toUpperCase()||"HP2"==c[n].UserProbableValues.toString().toUpperCase()||"HP3"==c[n].UserProbableValues.toString().toUpperCase())){if(h="","null"!=this.ExcelTable[l][s].toLowerCase().toString()&&""!=this.ExcelTable[l][s].toString()&&(d=I.d.document.GetEmpImportDetails(3,this.ExcelTable[l][s].toString(),parseInt(c[n].ColumnCostCenterID)),d.Tables.length>0))for(let g=0;g<d.Tables.length;g++)d.Tables[g].includes("NodeID")&&(h=String(d.Tables[g][0].NodeID));if(r+=c[n].SysColumnName+"=N'"+h.replace("'","''")+"',",""!=h.toString())if(null!=i){let g=i;g.RowFilter="CCID='"+parseInt(c[n].ColumnCostCenterID)+"'";let p=new Date,T=new Date;if(g.length>1){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",50053==parseInt(c[n].ColumnCostCenterID))p=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.GradeFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")||this.GradeFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(c[n].ColumnCostCenterID))p=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.LocFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")||this.LocFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.DesgFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DesgFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.DeptFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DeptFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let m=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"000");if(null!=m&&m.length>0){let F=new Date;(""==this.ExcelTable[l][m[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][m[0].FieldName.toString().Trim()]))&&(p=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",F<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date"),g[g.length-1].HistoryNodeID.toString()==h.toString()&&F<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date")}if("HP3"==c[n].UserProbableValues.toString().toUpperCase()){let F=this.grData.Table.filter(y=>y.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=F&&F.length>0&&((""==this.ExcelTable[l][F[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][F[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}let S=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"002");if(null!=S&&S.length>0){let F="";F=this.ExcelTable[l][S[0].FieldName.toString().Trim()],t=t+" Remarks='"+F+"'"}}t+=" Modified='1' />",new Date(g[g.length-1].FromDate).toLocaleDateString("MMM/yyyy")==p.toLocaleDateString("MMM/yyyy")&&"HP3"!=c[n].UserProbableValues.toString().toUpperCase()?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==c[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(p.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>")}else if(1==g.length){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",50053==parseInt(c[n].ColumnCostCenterID))p=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.GradeFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(c[n].ColumnCostCenterID))p=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.LocFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DesgFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(c[n].ColumnCostCenterID))p=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DeptFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let m=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"000");if(null!=m&&m.length>0&&((""==this.ExcelTable[l][m[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][m[0].FieldName.toString().Trim()]))&&(p=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+p.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.EDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date")),"HP3"==c[n].UserProbableValues.toString().toUpperCase()){let F=this.grData.Table.filter(y=>y.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=F&&F.length>0&&((""==this.ExcelTable[l][F[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][F[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}let S=this.grData.Table.filter(F=>F.FeatureFieldName==c[n].CostCenterColID.toString()+"002");if(null!=S&&S.length>0){let F="";F=this.ExcelTable[l][S[0].FieldName.toString().Trim()],t=t+" Remarks='"+F+"'"}}t+=" Modified='1' />",this.Doj.toLocaleDateString("MMM/yyyy")!=p.toLocaleDateString("MMM/yyyy")?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==c[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(p.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>")}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==c[n].UserProbableValues.toString().toUpperCase()){let m=this.grData.Table.filter(S=>S.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=m&&m.length>0&&((""==this.ExcelTable[l][m[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][m[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(c[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(h)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==c[n].UserProbableValues.toString().toUpperCase()){let g=new Date,p=this.grData.Table.filter(T=>T.FeatureFieldName==c[n].CostCenterColID.toString()+"001");null!=p&&p.length>0&&((""==this.ExcelTable[l][p[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[l][p[0].FieldName.toString().Trim()]))&&(g=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+g.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(c[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}""!=t.toString()&&(o="<History>"+t+"</History>")}return r.toString()}GetEmployeeGroupID(e){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeeGroupID");let i=0,s=(new gt.ControlGenerator,this.costCenterTableZero),u=null;if(s.filter(t=>"3003"==t.CostCenterColID).length>0&&(u=this.ExcelTable.includes(s[0].UserColumnName.toString())?I.d.document.GetEmpImportDetails(2,this.ExcelTable[e][s[0].UserColumnName.toString()],0):I.d.document.GetEmpImportDetails(2,"Employee",0),u.Tables.length>0))for(let t=0;t<u.Tables.length;t++)u.Tables[t].includes("NodeID")&&(i=parseInt(u.Tables[t][0].NodeID));return i}GetEmployeePayQuery(e,i,l){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeePayrollQuery");let s="",u=0,h=this.costCenterTableZero;if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("EarComponentID"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("DedComponentID"),this.dtPayrollD.push("NodeID"),this.dsPayStructure="True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let t=[],o=this.dsPayStructure.Tables[0];o.RowFilter="Type=1 AND Applicable='Yes' AND FieldType<>'OverTime'";for(let r=0;r<o.length;r++)t={},t.SlNo=(r+1).toString(),t.Earnings=o[r].ComponentName.toString(),t.EarSNo=o[r].SNo.toString(),t.EarFormula=o[r].Formula.toString(),t.EarRoff=o[r].ROff.toString(),t.EarValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),t.EarAddToNet=o[r].AddToNet.toString(),t.EarFType=o[r].FieldType.toString(),"EmployeeMaster"!=t.EarFType.toString()&&(t.Earnings_GRAY="1",t.EarValue_GRAY="1"),t.EarComponentID=o[r].ComponentID.toString(),t.NodeID=o[r].CostCenterColID.toString(),this.dtPayrollE.push(t);o.RowFilter="Type=2 AND Applicable='Yes' AND FieldType<>'NetSalary' AND FieldType<>'OverTime'";for(let r=0;r<o.length;r++)t={},t.SlNo=(r+1).toString(),t.Deductions=o[r].ComponentName.toString(),t.DedSNo=o[r].SNo.toString(),t.DedFormula=o[r].Formula.toString(),t.DedROff=o[r].ROff.toString(),t.DedValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),t.DedAddToNet=o[r].AddToNet.toString(),t.DedFType=o[r].FieldType.toString(),"EmployeeMaster"!=t.DedFType.toString()&&(t.Deductions_GRAY="1",t.DedValue_GRAY="1"),t.DedComponentID=o[r].ComponentID.toString(),t.NodeID=o[r].CostCenterColID.toString(),this.dtPayrollD.push(t)}if(h.filter(t=>"PAY_EmpPay"==t.sysTableName),h.length>0)for(let t=0;t<h.length;t++)for(let o=0;o<this.grData.Table.length;o++)null==this.grData.Table.FeatureFieldName||""==this.grData.Table.FeatureFieldName.toString()||"float"==h[t].ColumnDataType.toString().toLowerCase()&&h[t].CostCenterColID.toString()==this.grData.Table.FeatureFieldName.toString()&&("BasicMonthly"==h[t].sysColumnName.toString()?(u=parseFloat(this.ExcelTable[i][this.grData.Table.FieldName.toString()]),s+=h[t].SysColumnName.toString()+"="+u+",",null!=e&&(e[0].BasicMonthly=u)):"-1"!=h[t].UserDefaultValue.toString()&&(s+=h[t].SysColumnName.toString()+"="+this.ExcelTable[i][this.grData.Table.FieldName.toString()]+","));if(null!=e){let t=e;if(t.Sort="EffectFrom DESC,SeqNo DESC",t.length>0){for(let o=0;o<this.dtPayrollE.length;o++)null!=this.dtPayrollE[o].EarSNo&&null!=this.dtPayrollE[o].EarSNo&&""!=this.dtPayrollE[o].EarSNo.toString()&&(this.dtPayrollE[o].EarValue=parseFloat(t[0]["Earning"+this.dtPayrollE[o].EarSNo]).ToString(I.d.SessionManager.sPayrollDecimals));for(let o=0;o<this.dtPayrollD.length;o++)null!=this.dtPayrollD[o].DedSNo&&null!=this.dtPayrollD[o].DedSNo&&""!=this.dtPayrollD[o].DedSNo.toString()&&(this.dtPayrollD[o].DedValue=parseFloat(t[0]["Deduction"+this.dtPayrollD[o].DedSNo]).ToString(I.d.SessionManager.sPayrollDecimals))}}if(this.ExecuteFormulas(u,i,l),null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let t=0;t<this.dtPayrollE.length;t++)null!=this.dtPayrollE[t].EarSNo&&null!=this.dtPayrollE[t].EarSNo&&""!=this.dtPayrollE[t].EarSNo.toString()&&""!=this.dtPayrollE[t].EarValue.toString().Trim()&&(s+="Earning"+this.dtPayrollE[t].EarSNo+"="+this.dtPayrollE[t].EarValue.toString().replace(",","")+",");if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let t=0;t<this.dtPayrollD.length;t++)null!=this.dtPayrollD[t].DedSNo&&null!=this.dtPayrollD[t].DedSNo&&""!=this.dtPayrollD[t].DedSNo.toString()&&""!=this.dtPayrollD[t].DedValue.toString().Trim()&&(s+="Deduction"+this.dtPayrollD[t].DedSNo+"="+this.dtPayrollD[t].DedValue.toString().replace(",","")+",");return""!=s.toString()&&(s+="NetSalary="+(this.totEarnings-this.totDeductions).toString()+","),s}ExecuteFormulas(e,i,l){const s=I.d.report.GetDataTable("IMP002",String(l));let t,u=30,h=(0).ToString(I.d.SessionManager.sPayrollDecimals);this.totEarnings=0,this.totDeductions=0,u="Actual Days"==I.d.SessionManager.Preferences.EmpMasterPayDays?I.d.SessionManager.PayrollMonthEnd.Subtract(I.d.SessionManager.PayrollMonthStart).Days+1:parseInt(I.d.SessionManager.Preferences.EmpMasterPayDays),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.fldDict=new He.bT,t=new Ve("Basic",""),this.fldDict.Basic=t,this.fldDict.Basic.setFieldValue(e),t=new Ve("TotalDays",""),this.fldDict.TotalDays=t,this.fldDict.TotalDays.setFieldValue(u),t=new Ve("DaysAttended",""),this.fldDict.DaysAttended=t,this.fldDict.DaysAttended.setFieldValue(u),t=new Ve("PayrollMonthNo",""),this.fldDict.PayrollMonthNo=t,this.fldDict.PayrollMonthNo.setFieldValue(I.d.SessionManager.PayrollMonth.getMonth()+1),t=new Ve("PayrollYearNo",""),this.fldDict.PayrollYearNo=t,this.fldDict.PayrollYearNo.setFieldValue(I.d.SessionManager.PayrollMonth.getFullYear()),t=new Ve("DOJMonth",""),this.fldDict.DOJMonth=t,s.length>0&&s[0].CDOJ&&""!==s[0].CDOJ.toString()?this.fldDict.DOJMonth.setFieldValue(new Date(s[0].CDOJ).getMonth()+1):this.fldDict.DOJMonth.setFieldValue(new Date(this.Doj).getMonth()+1),t=new Ve("DOJYear",""),this.fldDict.DOJYear=t,s.length>0&&s[0].CDOJ&&""!==s[0].CDOJ.toString()?this.fldDict.DOJYear.setFieldValue(new Date(s[0].CDOJ).getFullYear()):this.fldDict.DOJYear.setFieldValue(new Date(this.Doj).getFullYear()),t=new Ve("DORMonth",""),this.fldDict.DORMonth=t,s.length>0&&s[0].CDORelieve&&""!==s[0].CDORelieve.toString()?this.fldDict.DORMonth.setFieldValue(new Date(s[0].CDORelieve).getMonth()+1):this.fldDict.DORMonth.setFieldValue(1),t=new Ve("DORYear",""),this.fldDict.DORYear=t,s.length>0&&s[0].CDORelieve&&""!==s[0].CDORelieve.toString()?this.fldDict.DORYear.setFieldValue(new Date(s[0].CDORelieve).getFullYear()):this.fldDict.DORYear.setFieldValue(2200);let o=this.grData.Table;const r=this.dsEmpPay(1);let d;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(t=new Ve(this.dtPayrollE[n].Earnings,""),this.fldDict[this.dtPayrollE[n].Earnings]=t,d=this.dsPayStructure[0].filter(a=>a.CostCenterColID===this.dtPayrollE[n].NodeID.toString()),d.length>0&&(d=r[0].filter(a=>a.ComponentID===d[0].ComponentID.toString()),d.length>0)){const a=o.find(g=>g.FeatureFieldName===d[0].CostCenterColID.toString());if(a){const g=this.ExcelTable[i][a.FieldName];this.dtPayrollE[n].EarValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),t=new Ve("Calc"+this.dtPayrollE[n].Earnings,""),this.fldDict["Calc"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),t=new Ve("Arr_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Arr_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Arr_"+this.dtPayrollE[n].Earnings].setFieldValue(0),t=new Ve("Adj_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Adj_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Adj_"+this.dtPayrollE[n].Earnings].setFieldValue(0)}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(t=new Ve(this.dtPayrollD[n].Deductions,""),this.fldDict[this.dtPayrollD[n].Deductions]=t,d=this.dsPayStructure[0].filter(a=>a.CostCenterColID===this.dtPayrollD[n].NodeID.toString()),d.length>0&&(d=r[0].filter(a=>a.ComponentID===d[0].ComponentID.toString()),d.length>0)){const a=o.find(g=>g.FeatureFieldName===d[0].CostCenterColID.toString());if(a){const g=this.ExcelTable[i][a.FieldName];this.dtPayrollD[n].DedValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollD[n].Deductions].setFieldValue(this.dtPayrollD[n].DedValue),t=new Ve("Calc"+this.dtPayrollD[n].Deductions,""),this.fldDict["Calc"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Calc"+this.dtPayrollD[n].Deductions].setFieldValue(this.dtPayrollD[n].DedValue),t=new Ve("Arr_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Arr_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Arr_"+this.dtPayrollD[n].Deductions].setFieldValue(0),t=new Ve("Adj_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Adj_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Adj_"+this.dtPayrollD[n].Deductions].setFieldValue(0)}const c=this.fldDict;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(this.dtPayrollE[n].EarFormula)try{h=parseFloat(I.d.eval.EvaluateExpression(this.dtPayrollE[n].EarFormula.toString(),c)).ToString(I.d.SessionManager.sPayrollDecimals),this.dtPayrollE[n].EarValue=this.RoundOffValue(parseFloat(h),parseFloat(this.dtPayrollE[n].EarROff)),this.fldDict[this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue),this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldValue(this.dtPayrollE[n].EarValue)}catch{}this.dtPayrollE[n].EarAddToNet&&("Net"===this.dtPayrollE[n].EarAddToNet||"NetAndTax"===this.dtPayrollE[n].EarAddToNet)&&(this.totEarnings+=parseFloat(this.dtPayrollE[n].EarValue))}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(this.dtPayrollD[n].DedFormula)try{if(h=parseFloat(I.d.eval.EvaluateExpression(this.dtPayrollE[n].DedFormula.toString(),c)).ToString(I.d.SessionManager.sPayrollDecimals),"ESI"==this.dtPayrollD[n].Deductions.toString().ToUpper())h=Math.max(parseFloat(h)).ToString(I.d.SessionManager.sPayrollDecimals);else if("PT"==this.dtPayrollD[n].Deductions.toString().ToUpper()){let a=h.replace(",","");h=(0).ToString(I.d.SessionManager.sPayrollDecimals);let g=this.dsPayStructure.Tables[0].length>0?this.dsPayStructure.Tables[0]:this.dsPayStructure.Tables[1];if(g.length>0){let T,m,S;if(new Date(g[0].PayrollMonth),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let C=0;C=N.J0.GetEmployeeGrade(l.toString(),T,m,S)}let y=I.d.document.GetDataSet(`\nDECLARE @SQL NVARCHAR(MAX),@Val nvarchar(50),@Val2 nvarchar(50),@PayrollMonth NVARCHAR(100),@PayrollStart NVARCHAR(100),@PayrollEnd NVARCHAR(100)\nSET @PayrollMonth='" + dtPM.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollStart='" + dtPMS.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollEnd='" + dtPME.toLocaleDateString("dd/MMM/yyyy") + @"'\n\nSELECT @Val= Value FROM ADM_GlobalPreferences WITH(NOLOCK) WHERE Name='PayrollPTDimension'\nIF(@Val IS NOT NULL AND @Val<>'' and CONVERT(INT,@Val)>50000)\nBEGIN\nSelect @Val2='CCNID'+CONVERT(NVARCHAR,(CONVERT(INT,@Val)-50000))\nSET @SQL='\tSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) \nWHERE NodeID IN(" + EmpNodeID + @")AND CostCenterID=50051 AND HistoryCCID='+@Val+'   \nAND (CONVERT(DATETIME,FromDate)<=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR CONVERT(DATETIME,FromDate) BETWEEN CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollStart)+''') AND CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollEnd)+''')) \nAND (CONVERT(DATETIME,ToDate)>=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR ToDate IS NULL) \n\nSELECT NodeID as EmpSeqNo,'+@Val2+' as PTDimension FROM COM_CCCCDATA WITH(NOLOCK) WHERE CostCenterID=50051 AND NodeID=" + ${l}\n\nEXEC(@SQL)\n\nEND\nELSE\nBEGIN\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\n\nEND\n\nSELECT CONVERT(DATETIME,PayrollDate) as PayrollMonth,*\nFROM PAY_PayrollPT WITH(NOLOCK) \nWHERE CONVERT(DATETIME,PayrollDate)=@PayrollMonth `);if(null!=y&&y.Tables.length>0){let C="1";y.Tables[0].length>0?C=y.Tables[0].Rows[0].PTDimension.toString():y.Tables[1].length>0&&(C=y.Tables[1].Rows[0].PTDimension.toString());let f=y.Tables[2];if(y.Tables[0].length>0||y.Tables[1].length>0){let b=y.Tables[2];if(b.RowFilter="NodeID="+C+" AND Formula<>''",null!=b&&b.length>0&&null!=b[0].Formula&&null!=b[0].Formula&&""!=b[0].Formula.toString().Trim()){let x=this.fldDict;h=parseFloat(I.d.eval.EvaluateExpression(b[0].Formula.toString(),x)).toString()}else f.RowFilter="NodeID="+C+" AND FromSlab<="+a+" AND ToSlab>="+a,f.length>0&&(h=f[0].Amount.toString())}}}}this.dtPayrollD[n].DedValue=this.RoundOffValue(parseFloat(h),parseFloat(this.dtPayrollD[n].DedROff)),this.fldDict[this.dtPayrollD[n].Deductions.toString()].setFieldValue(this.dtPayrollD[n].DedValue.toString()),this.fldDict["Calc"+this.dtPayrollD[n].Deductions.toString()].setFieldValue(this.dtPayrollD[n].DedValue.toString())}catch{}this.dtPayrollD[n].DedAddToNet&&("Net"===this.dtPayrollD[n].DedAddToNet||"NetAndTax"===this.dtPayrollD[n].DedAddToNet)&&(this.totDeductions+=parseFloat(this.dtPayrollD[n].DedValue))}this.dblNetSalary=this.totEarnings-this.totDeductions}SetComponentAccountMapping(e,i,l){Logger.InfoLog("ImportEmployeeData:: Inside SetComponentAccountMapping");let s=[],u=[...this.costCenterTableZero],h=[],t=[],o=null,r=[];const d=n=>{r.push({EmpSeqNo:n.EmpSeqNo||"",ComponentID:n.ComponentID||"",ComponentName:n.ComponentName||"",UserDefaultValue:n.UserDefaultValue||"",Type:n.Type||"",SNo:n.SNo||"",DebitAccountID:n.DebitAccountID||"",CreditAccountID:n.CreditAccountID||"",Flag:n.Flag||""})};if(this.dsPayStructure=this.dsEmpPay(this.EmpGrade),this.dsPayStructure&&this.dsPayStructure[0]&&this.dsPayStructure[0].length>0){let n=this.dsPayStructure[0].filter(a=>["1","2","3"].includes(a.Type?.toString()));d({EmpSeqNo:i.toString(),ComponentID:"-301",ComponentName:"SalaryAccID",UserDefaultValue:"-2",Type:"-301",SNo:"-301",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"}),d({EmpSeqNo:i.toString(),ComponentID:"-302",ComponentName:"PayableAccID",UserDefaultValue:"-2",Type:"-302",SNo:"-302",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"});for(let a=0;a<n.length;a++)d({EmpSeqNo:i.toString(),ComponentID:n[a].ComponentID.toString(),ComponentName:n[a].ComponentName+"_Acc",UserDefaultValue:"-2",Type:n[a].Type.toString(),SNo:n[a].SNo.toString(),DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"})}if(e&&e.length>0)for(let n=0;n<r.length;n++)if(r[n].ComponentID){let a=e.filter(g=>g.ComponentID?.toString()===r[n].ComponentID.toString());a.length>0&&(r[n].DebitAccountID=a[0].DebitAccountID.toString(),r[n].CreditAccountID=a[0].CreditAccountID.toString(),r[n].Flag="0")}h=[...r];let c=u.filter(n=>"PAY_EmpAccountsLinking"===n.sysTableName||["SalaryAccID","PayableAccID"].includes(n.SysColumnName)).sort((n,a)=>n.SysColumnName.localeCompare(a.SysColumnName,void 0,{sensitivity:"base"}));if(c.length>0){for(let n=0;n<c.length;n++)for(let a=0;a<this.grData.Table.length;a++)if(this.grData.Table.FeatureFieldName&&("text"===c[n].ColumnDataType.toLowerCase()&&c[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()||c[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()&&["SalaryAccID","PayableAccID"].includes(c[n].SysColumnName.toString()))){let g=c[n].SysColumnName.toString();if(h.filter(T=>T.ComponentName===g).length>0){if(("-2"===c[n].UserDefaultValue.toString()||["SalaryAccID","PayableAccID"].includes(g))&&(t=r.filter(T=>T.ComponentName===g),t.length>0)){let T=this.ExcelTable[l][this.grData[a].FieldName.toString()];if(T&&""!==T.toString()){if(o=I.d.document.GetEmpImportDetails(3,T.toString(),2),o&&o.length>0)for(let m=0;m<o.length;m++)void 0!==o[m][0]?.NodeID&&(t[0].DebitAccountID=o[m][0].NodeID.toString());t[0].Flag="0"}}if("-3"===c[n].UserDefaultValue.toString()&&(t=r.filter(T=>T.ComponentName===g),t.length>0)){let T=this.ExcelTable[l][this.grData[a].FieldName.toString()];if(T&&""!==T.toString()){if(o=I.d.document.GetEmpImportDetails(3,T.toString(),2),o&&o.length>0)for(let m=0;m<o.length;m++)void 0!==o[m][0]?.NodeID&&(t[0].CreditAccountID=o[m][0].NodeID.toString());t[0].Flag="0"}}}}if(h=r.filter(n=>"0"===n.Flag?.toString()),h.length>0){s.push("<Rows>");for(let n=0;n<h.length;n++)s.push(`<Row EmpSeqNo="${i.toString()}" ComponentID="${h[n].ComponentID.toString()}" Type="${h[n].Type.toString()}" SNo="${h[n].SNo.toString()}" DebitAccountID="${h[n].DebitAccountID.toString()}" CreditAccountID="${h[n].CreditAccountID.toString()}" />`);s.push("</Rows>")}}return s.join("")}RoundOffValue(e,i){if(i>0&&e>0){let l=0,s=!1;l=e%i,l>0&&(i/l<=2&&(s=!0),e-=l,s&&(e+=i))}return e.ToString(I.d.SessionManager.sPayrollDecimals).replace(",","")}dsEmpPay(e){return this.dsEmpPayWithDate(e,null)}dsEmpPayWithDate(e,i){let l=`\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,8,len(SysColumnName)-7)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Earning%' \n          and a.Type=1 and a.GradeID=${e}\n        `;l+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=`\n          union\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,10,len(SysColumnName)-9)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Deduction%' \n          and a.Type=2 and a.GradeID=${e}\n        `,l+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=`\n          union\n          SELECT a.NodeID CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE a.GradeID=${e} and a.Type in(3,4)\n        `,l+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,l+=" Order By a.Type,a.SNo ";let s=null;return I.d.report.DataSetAsyn("RPT022",l.toString()).then(u=>{s=u.Tables[0]}).catch(u=>{alert(u)}),s}ImportEmployeeDocuments(){let e,i=0,l=0,s=0,u=0,h=0,d="",c="",n=[],a=[],g=this.costCenterTableZero,p=this.grData.Table;if(p.filter(m=>"-251"==m.FeatureFieldName),!(p.length>0))return this.DisplayMessage="Please select employee field",void(this.MessageVisibility=!0);if(p[0].FieldName.toString(),this.grData.Table.length>0){let m=this.costCenterTableZero.filter(F=>F.syscolumnname==F.Field1),S=this.grData.Table;if(S.filter(F=>F.FeatureFieldName==m[0].costcentercolid.toString()),S.length<=0)return this.DisplayMessage="Please select "+m[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0);if(m=this.costCenterTableZero.filter(F=>F.syscolumnname==F.Field2),S.filter(F=>F.FeatureFieldName==m[0].costcentercolid.toString()),S.length<=0)return this.DisplayMessage="Please select "+m[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0)}for(let m=0;m<this.ExcelTable.length;m++){e=new Ct.h;for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(g.filter(y=>y.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),g.length>0)){let y=g[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+y),y){case"Pay_Employee":e.EmpCode=this.ExcelTable[m][this.grData.Table[F].FieldName.toString()],e.EmpName=this.ExcelTable[m][this.grData.Table[F].FieldName.toString()],n=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),n.length>0?(h=parseInt(n[0].NodeID),e.EmpCode=n[0].Code.toString(),e.EmpName=n[0].Name.toString()):(a=I.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'"),a.length>0&&(h=parseInt(a[0].NodeID),e.EmpCode=a[0].Code.toString(),e.EmpName=a[0].Name.toString()));break;case"Field1":if(d=this.ExcelTable[m][this.grData.Table[F].FieldName.toString()],""==d||null==d)return this.DisplayMessage="Import completed ( Total :"+(l+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",c=c+"please check Name at Row No "+(m+1).toString()+"in Excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:c}),void(this.ListVisbility=!0);break;case"Field2":if(d=this.ExcelTable[m][this.grData.Table[F].FieldName.toString()],""==d||null==d)return this.DisplayMessage="Import completed ( Total :"+(l+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",c=c+"please check DateOfBirth at Row No "+(m+1).toString()+" in excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:c}),void(this.ListVisbility=!0)}}e.NodeID=h,e.DocumentsXML=this.GetEmpDocumentXML(h,this.IsUpdate,this.costCenterTableZero,m),u=e.SaveEmpDocuments(),s=u,s<0?(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):i++}this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+l.toString();let T=l+i;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+T.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpDocumentXML(e,i,l,s){Logger.InfoLog("ImportEmployeeDocument::Entering GetEmpDocumentXML");let u="",h="",t="",o="",r="",d=l,c=[];if(d.RowFilter="sysTableName='PAY_EmpDetail' ",d.length>0){if(i){let n=d.Table.filter(g=>g.syscolumnname==g.Field1&&g.syscolumnname==this.Feature.SelectedValue.toString()),a=I.d.document.GetDataSet("select * from pay_Empdetail where DType="+this.Feature.SelectedValue.toString()+" and EmployeeId="+e+" and Field1= '"+this.ExcelTable[s][n[0].FieldName.toString().toLowerCase()].toString()+"'");a.length>0&&null!=a?(r+='<Row Action="MODIFY"',r+=' NodeID="'+a.Rows[0].NodeId.toString()+'"'):(r+='<Row Action="NEW"',r+=' NodeID="0"')}else r+='<Row Action="NEW"',r+=' NodeID="0"';r+=' DType="'+this.Feature.SelectedValue.toString()+'"';for(let n=0;n<this.grData.Table.length;n++)for(let a=0;a<d.length;a++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&d[a].CostCenterColID.toString()==this.grData.Table[n].FeatureFieldName.toString())if("combobox"==d[a].UserColumnType.toString().toLowerCase()&&d[a].sysColumnName.toString().toLowerCase().Contains("field")){if(u="","null"!=this.ExcelTable[s][this.grData.Table[n].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[s][this.grData.Table[n].FieldName.toString()])if("44"==d[a].ColumnCostCenterID.toString()){c=I.d.document.GetEmpImportDetails(1,this.ExcelTable[s][this.grData.Table[n].FieldName.toString()],parseInt(d[a].ColumnCCListViewTypeID.toString()));for(let g=0;g<c.length;g++)c[g].includes("NodeID")&&(u=String(c[g][0].NodeID))}else u=this.ExcelTable[s][this.grData.Table[n].FieldName.toString()];h+=d[a].sysColumnName.toString()+"=N'"+u.replace("'","''")+"',"}else if("listbox"==d[a].UserColumnType.toString().toLowerCase()&&d[a].sysColumnName.toString().toLowerCase().Contains("ccnid")){if(u="",c=I.d.document.GetEmpImportDetails(3,this.ExcelTable[s][this.grData.Table[n].FieldName.toString()],parseInt(d[a].ColumnCostCenterID)),c.length>0)for(let g=0;g<c.length;g++)c[g].includes("NodeID")&&(u=String(c[g][0].NodeID));o+=d[a].SysColumnName+"=N'"+u.replace("'","''")+"',"}else"text"==d[a].UserColumnType.toString().toLowerCase()&&d[a].sysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=d[a].sysColumnName.toString()+"=N'"+this.ExcelTable[s][this.grData.Table[n].FieldName.toString()]+"',":"date"==d[a].UserColumnType.toString().toLowerCase()&&(d[a].sysColumnName.toString().toLowerCase().Contains("field")||d[a].sysColumnName.toString().toLowerCase().Contains("ccalpha"))?(u=this.ExcelTable[s][this.grData.Table[n].FieldName.toString()],""!=u&&(u=new Date(u).toLocaleDateString("dd/MMM/yyyy"),d[a].SysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=d[a].sysColumnName.toString()+"=N'"+this.ExcelTable[s][this.grData.Table[n].FieldName.toString()]+"',":h+=d[a].sysColumnName.toString()+"=N'"+this.ExcelTable[s][this.grData.Table[n].FieldName.toString()]+"',")):"EmployeeID"==d[a].sysColumnName.toString()&&""!=d[a].sysColumnName.toString()?h+=d[a].sysColumnName.toString()+"="+e+",":h+=d[a].sysColumnName.toString()+"=N'"+this.ExcelTable[s][this.grData.Table[n].FieldName.toString()]+"',";r+=' StaticFields ="'+h.toString().Trim(",")+'" ',r+=' ExtraTextFields ="'+t.toString().Trim(",")+'" ',r+=' CCFields ="'+o.toString().Trim(",")+'" ',r+="/>"}return r.length>0&&(r.Insert(0,"<Data>"),r+="</Data>"),Logger.InfoLog("ImportEmployeeDocument::Exiting GetEmpDocumentXML which RETURN XML="+r),r.toString()}ImportEmployeeAppraisal(){let e=new Ct.h,i=0,l=0,s=0,u=!0,h=!1,o="",r=[],d=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++){e=new Ct.h,u=!0,o="";let g=0;for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(d.filter(m=>m.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),d.length>0)){let m=d[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+m),m){case"Code":e.EmpCode=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()];break;case"Name":e.EmpName=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()];break;case"EffectFromDate":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtEffectFrom=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"ActAppraisalFrom":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtActAppraisalFrom=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"NextAppraisalDate":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dtNextAppraisalDate=new Date(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]));break;case"BasicMonthly":h=!0,this.dblBasicMonthly=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AnnualCTC":this.dblAnnualCTC=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AppraisalRemarks":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.AppraisalRemarks=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"AppraisalReason":"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.AppraisalReason=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]);break;case"Percentage":h=!0,"null"!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(this.dblPercentage=parseFloat(this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]))}}let p=I.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'");if(p.length>0&&1==this.IsCode?(s=parseInt(p.Rows[0].NodeID),e.EmpCode=p.Rows[0].Code.toString(),e.EmpName=p.Rows[0].Name.toString(),e.DOJ=new Date(p.Rows[0].DateOfJoining.toString()),this.Doj=e.DOJ):(r=I.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),r.length>0&&(s=parseInt(r[0].NodeID),e.EmpCode=r[0].Code.toString(),e.EmpName=r[0].Name.toString(),e.DOJ=new Date(r[0].DateOfJoining.toString()),this.Doj=e.DOJ)),null!=this.Doj&&(this.dtEffectFrom<this.Doj||this.dtActAppraisalFrom<this.Doj)&&(o="EffectFrom and ApplyFrom should be Grater than or Equal to the Date of Joining."),""==o.toString()){let m=I.d.document.GetDataSet('Select * From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + lngNodeID + @" AND SeqNo<>" + 0 + @"\n                            AND Month(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Month + " AND YEAR(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Year');null!=m&&m.length>0&&(this.IsUpdate?g=parseFloat(m.Rows[0].SeqNo.toString()):o="Appraisals already defined for this Month, Can't allow More than once.")}if(""==o.toString()&&"False"==I.d.SessionManager.Preferences.AllowAppraisalIfProcessed&&I.d.document.GetDataSet('SELECT TOP 1 CONVERT(DATETIME,a.DueDate) as PayrollMonth  \n                                                FROM INV_DocDetails a WITH(NOLOCK) \n                                                JOIN COM_DocCCData b WITH(NOLOCK) ON b.InvDocDetailsID=a.InvDocDetailsID\n                                                JOIN COM_DocTextData d WITH(NOLOCK) ON d.InvDocDetailsID=a.InvDocDetailsID\n                                                WHERE a.CostCenterID=40054 and a.StatusID=369 AND b.dcCCNID51=" + lngNodeID + @" \n                                                AND ( CONVERT(DATETIME,d.dcAlpha17) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' OR CONVERT(DATETIME,d.dcAlpha18) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' )').length>0&&(o="Appraisal can not be processed. Because already processed payrolls exists."),""!=o.toString()&&(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:o.toString()}),u=!1),u){e.NodeID=s;let T=[];T.push(s),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.RoleID),T.push(I.d.SessionManager.LanguageID),this.dsEmpEdit=this.objEmpEss.GetEmpMasterDetails(),null!=this.dsEmpEdit&&this.dsEmpEdit.Tables.length>0?("True"==I.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()&&this.dsEmpEdit.Tables[7].length>0&&(this.EmpGrade=parseInt(this.dsEmpEdit.Tables[7][0].CCNID53.toString())),e.DocumentsXML=this.GetEmpAppraisal(s,!1,this.costCenterTableZero,n,this.dsEmpEdit.Tables[14],h)):e.DocumentsXML=this.GetEmpAppraisal(s,!1,this.costCenterTableZero,n,null,h),null==I.d.document.GetDataSet(e.DocumentsXML)?(l++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):i++}}this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+l.toString();let c=l+i;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+c.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpAppraisal(e,i,l,s,u,h){Logger.InfoLog("ImportEmployeeAppraisal::Entering GetEmpAppraisal");let t="",o="",r="",d=0;this.dtPayrollE=[],this.dtPayrollD=[];let c=this.costCenterTableZero;if(c.filter(n=>n.sysTableName==n.PAY_EmpPay||n.sysColumnName==n.Percentage),c.length>0){if(h){if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("NodeID"),this.dtPayrollD=[],this.dtPayrollE=[],this.dsPayStructure=this.dsEmpPay(this.EmpGrade),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let n={},a=this.dsPayStructure.Tables[0];a.filter(g=>1==g.Type&&"Yes"==g.Applicable&&"OverTime"==g.FieldType);for(let g=0;g<a.length;g++)n={},n.SlNo=(g+1).toString(),n.Earnings=a[g].ComponentName.toString(),n.EarSNo=a[g].SNo.toString(),n.EarFormula=a[g].Formula.toString(),n.EarRoff=a[g].ROff.toString(),n.EarValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),n.EarAddToNet=a[g].AddToNet.toString(),n.EarFType=a[g].FieldType.toString(),"EmployeeMaster"!=n.EarFType.toString()&&(n.Earnings_GRAY="1",n.EarValue_GRAY="1"),n.NodeID=a[g].CostCenterColID.toString(),this.dtPayrollE.push(n);a.filter(g=>2==g.Type&&"Yes"==g.Applicable&&"NetSalary"==g.FieldType&&"OverTime"==g.FieldType);for(let g=0;g<a.length;g++)n={},n.SlNo=(g+1).toString(),n.Deductions=a[g].ComponentName.toString(),n.DedSNo=a[g].SNo.toString(),n.DedFormula=a[g].Formula.toString(),n.DedROff=a[g].ROff.toString(),n.DedValue=(0).ToString(I.d.SessionManager.sPayrollDecimals),n.DedAddToNet=a[g].AddToNet.toString(),n.DedFType=a[g].FieldType.toString(),"EmployeeMaster"!=n.DedFType.toString()&&(n.Deductions_GRAY="1",n.DedValue_GRAY="1"),n.NodeID=a[g].CostCenterColID.toString(),this.dtPayrollD.push(n)}if(null!=u){let n=u;if(n.Sort="EffectFrom DESC,SeqNo DESC",n.length>0){for(let a=0;a<this.dtPayrollE.length;a++)null!=this.dtPayrollE[a].EarSNo&&null!=this.dtPayrollE[a].EarSNo&&""!=this.dtPayrollE[a].EarSNo.toString()&&(this.dtPayrollE[a].EarValue=parseFloat(n[0]["Earning"+this.dtPayrollE[a].EarSNo]).ToString(I.d.SessionManager.sPayrollDecimals));for(let a=0;a<this.dtPayrollD.length;a++)null!=this.dtPayrollD[a].DedSNo&&null!=this.dtPayrollD[a].DedSNo&&""!=this.dtPayrollD[a].DedSNo.toString()&&(this.dtPayrollD[a].DedValue=parseFloat(n[0]["Deduction"+this.dtPayrollD[a].DedSNo]).ToString(I.d.SessionManager.sPayrollDecimals))}}}for(let n=0;n<c.length;n++)for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&"float"==c[n].ColumnDataType.toString().toLowerCase()&&c[n].CostCenterColID.toString()==this.grData.Table[a].FeatureFieldName.toString())if("BasicMonthly"==c[n].sysColumnName.toString())d=parseFloat(this.ExcelTable[s][this.grData.Table[a].FieldName.toString()]),r+=c[n].SysColumnName.toString()+"="+d+",",this.dblNetSalary=0,this.ExecuteFormulas(d,s,e);else if("Percentage"==c[n].sysColumnName.toString()){let g=0,p=0;if(this.dblPercentage>0){let m=I.d.document.GetDataSet('Select EmployeeID,SeqNo,Convert(DateTime,EffectFrom) EffectFrom,BasicMonthly From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + EmpNode + @" AND SeqNo<>" + 0 + @"\n                            AND Convert(DateTime,EffectFrom)<=CONVERT(DATETIME,\'" + dtEffectFrom.toLocaleDateString("dd MMM yyyy") + "\') ORDER BY EffectFrom DESC');null!=m&&m.length>0&&(p=parseFloat(m.Rows[0].BasicMonthly.toString())),g=p*this.dblPercentage/100,p+=g,this.dblBasicMonthly=p,this.dblNetSalary=0,this.ExecuteFormulas(this.dblBasicMonthly,s,e)}}else"-1"!=c[n].UserDefaultValue.toString()&&(r+=c[n].SysColumnName.toString()+"="+this.ExcelTable[s][this.grData.Table[a].FieldName.toString()]+",")}if(this.IsUpdate){if(this.EditSeqNo>0){if(t+="UPDATE PAY_EmpPay SET EffectFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),ApplyFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),NetSalary=",t+=this.dblNetSalary,t+=",BasicMonthly=",t+=this.dblBasicMonthly,t+=",AnnualCTC=",t+=this.dblAnnualCTC,t+=",Remarks='",t+=this.AppraisalRemarks.Append("'"),t+=",Reason='",t+=this.AppraisalReason.Append("'"),t+=",ModifiedBy='",t+=I.d.SessionManager.UserName,t+="'",t+=",ModifiedDate=CONVERT(FLOAT,GETDATE())",t+=this.dblPercentage>0?",Percentage="+this.dblPercentage:",Percentage=0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString()+"="+this.dtPayrollE[n].EarValue.toString);if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString()+"="+this.dtPayrollD[n].DedValue.toString);t+=" WHERE SeqNo="+this.EditSeqNo}}else{if(t+="INSERT INTO PAY_EmpPay(EmployeeID,EffectFrom,ApplyFrom,NetSalary,BasicMonthly,AnnualCTC,Remarks,Reason,CreatedBy,CreatedDate,ModifiedDate,Percentage",o+="VALUES("+e+",CONVERT(INT,CONVERT(DATETIME,'"+this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy")+"')),CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy")+"')),",o+=this.dblNetSalary,o+=","+this.dblBasicMonthly,o+=","+this.dblAnnualCTC,o+=",'"+this.AppraisalRemarks+"'",o+=",'"+this.AppraisalReason+"'",o+=",'"+I.d.SessionManager.UserName+"'",o+=",CONVERT(FLOAT,GETDATE())",o+=",CONVERT(FLOAT,GETDATE())",o+=this.dblPercentage>0?","+this.dblPercentage:",0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString(),o+=","+this.dtPayrollE[n].EarValue.toString());if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString(),o+=","+this.dtPayrollD[n].DedValue.toString());t+=")"+o.toString()+")",new Date(this.dtNextAppraisalDate.toLocaleDateString("MMM yyyy"))>new Date(this.dtActAppraisalFrom.toLocaleDateString("MMM yyyy"))?t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtNextAppraisalDate.toLocaleString("dd/MMM/yyyy")+"')) WHERE NodeID="+e:t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.AddMonths(1).Date.toString()+"')) WHERE NodeID="+e}return Logger.InfoLog("ImportEmployeeAppraisal::Exiting GetEmpAppraisalXML which RETURN XML="+t),t.toString()}FillQtyRateCombo(){this.QtyRateVisible=!0,this.QtyCombo.Items.Clear(),this.RateCombo.Items.Clear(),this.QtyCombo.Items.push(ie._p.ComboBoxItems_2("","")),this.RateCombo.Items.push(ie._p.ComboBoxItems_2("",""));for(const e of this.ExcelTable)(e.DataType==typeof parseFloat||e.DataType==typeof parseInt)&&(this.QtyCombo.Items.push(ie._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)),this.RateCombo.Items.push(ie._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)));this.RateCombo.Items.push(ie._p.ComboBoxItems_2("AVGRATE","AVGRATE"))}CheckAvgRateexists(){let e=this.costCenterTableZero;if(this.IsQtyChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let i of this.grData.Table)if("GrossValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(this.ExcelTable.includes("QuantityValue")){this.ExcelTable.Remove("QuantityValue");for(let i of this.grData.Table)if("QuantityValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(null!=this.QtyText.Text&&""!=this.QtyText.Text){let i=0;if(i=N.J0.Int(this.QtyText.Text),!this.ExcelTable.some(l=>"QuantityValue"===l.columnName)&&i>0){let l={ColumnName:"QuantityValue",DataType:"number",DefaultValue:N.J0.Int(i)};if(this.ExcelTable.push(l),e=this.costCenterTableZero,e.filter(s=>"Quantity"==s.SysColumnName),!(e.length>0))return this.DisplayMessage="Quantity field doesnot exists",void(this.MessageVisibility=!0);{let s={FieldName:"QuantityValue"};s.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(s)}}}else if(null!=this.QtyCombo.SelectedValue&&""!=this.QtyCombo.SelectedValue&&!this.ExcelTable.includes("QuantityValue")){let i=0;if(i=N.J0.Int(this.QtyText.Text),this.ExcelTable.push({ColumnName:"QuantityValue",DataType:"number",Expression:this.QtyCombo.SelectedValue}),e.filter(s=>"Quantity"==s.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let s={FieldName:"QuantityValue"};s.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(s)}}}if(this.IsRateChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let i of this.grData.Table)if("GrossValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(this.ExcelTable.includes("RateValue")){this.ExcelTable.Remove("RateValue");for(let i in this.grData.Table)if("RateValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(null!=this.RateText.Text&&""!=this.RateText.Text){let i=0;if(i=parseFloat(this.RateText.Text),!this.ExcelTable.includes("RateValue")&&i>0){if(this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",ReadOnly:!1}),e=this.costCenterTableZero,e.filter(s=>"Quantity"==s.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let s={FieldName:"RateValue"};s.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(s)}}}else if("AVGRATE"==this.RateCombo.SelectedValue){let i;this.ExcelTable.includes("AVGRATE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),i={},i.FieldName="AVGRATE",i.FeatureFieldName="-27",this.grData.Table.push(i)),this.ExcelTable.includes("AVGRATEVALUE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),i={},i.FieldName="AVGRATEVALUE",i.FeatureFieldName="-28",this.grData.Table.push(i))}else if(null!=this.RateCombo.SelectedValue&&""!=this.RateCombo.SelectedValue&&!this.ExcelTable.includes("RateValue")){let i=0;if(i=parseFloat(this.QtyText.Text),this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",Expression:this.RateCombo.SelectedValue,ReadOnly:!1}),e.filter(s=>"Quantity"==s.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let s={FieldName:"RateValue"};s.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(s)}}}if(this.IsQtyChecked||this.IsRateChecked&&"AVGRATE"!=this.RateCombo.SelectedValue){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let s of this.grData.Table)if("GrossValue"==s.FieldName.toString()){this.grData.Table.Remove(s);break}}let i,l;if(e.filter(s=>"Quantity"==s.SysColumnName),e.length>0){let s=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());s.length>0&&(i=s[0].FieldName.toString())}if(e.filter(s=>"Quantity"==s.SysColumnName),e.length>0){let s=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());s.length>0&&(l=s[0].FieldName.toString())}if(""!=l&&""!=i&&(this.ExcelTable.push({ColumnName:"GrossValue",DataType:"number",Expression:l*i,ReadOnly:!1}),e=this.costCenterTableZero,e.filter(u=>"Gross"==u.SysColumnName),e.length>0)){let u={FieldName:"GrossValue"};u.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(u)}}}Importbackgroundprocess(){this.ExcelDataColumn.includes("IMPORT_STATUS")||this.ExcelDataColumn.push("IMPORT_STATUS"),this.ExcelDataColumn.includes("xIMP_STATUSx")||this.ExcelDataColumn.push("xIMP_STATUSx"),this.ExcelDataColumn.includes("IMPORT_MESSAGE")||this.ExcelDataColumn.push("IMPORT_MESSAGE"),this.ProgressVisbility=!0,this.ImportVisbility=!1,this.ProgressMax=this.ExcelTable.length,this.worker1_DoWork()}groupmethod(){var e=this;return(0,Ie.A)(function*(){for(let l of e.grData.Table){let s=e.costCenterTableZero;if(""!=l.FeatureFieldName.toString()){const u=s.filter(h=>h.CostCenterColID==l.FeatureFieldName.toString());if(u.length>0){let h=u[0].SysColumnName.toString();if("group"==h.toLowerCase()||"isgroup"==h.toLowerCase()||"parentid"==h.toLowerCase()){e.GroupExists=!0,e.tempfield=l.FieldName.toString();break}}}}let i;if(e.ProgressVisbility=!1,e.ImportVisbility=!0,e.DisplayMessage="Scanning of data is in process, please wait...",e.MessageVisibility=!0,e.GroupExists){e.IsExcel?(e.ExcelTable=[],e.dvMain=e.dsexcel):e.dvMain=e.ExcelTable;try{i=e.dvMain.filter(l=>"1"==l[e.tempfield]||"YES"==l[e.tempfield]),e.ExcelTable.length>0?e.GroupsImport=!0:i="",e.ExcelTable=e.dvMain,yield e.onPreviewDataClick(),e.DisplayMessage="",e.MessageVisibility=!1,e.GroupExists=!1,e.IsPreviewDataOk&&e.Importbackgroundprocess()}catch(l){return e.DisplayMessage=l.Message,Logger.ErrorLog(" Message: - "+l.stack),void(e.MessageVisibility=!0)}}else yield e.onPreviewDataClick(),e.IsPreviewDataOk&&(e.DisplayMessage="",e.MessageVisibility=!1,e.Importbackgroundprocess())})()}worker1_DoWork(){this.ExcelDataColumn.includes("IMPORT_STATUS")||this.ExcelDataColumn.push("IMPORT_STATUS"),this.ExcelDataColumn.includes("xIMP_STATUSx")||this.ExcelDataColumn.push("xIMP_STATUSx"),this.ExcelDataColumn.includes("IMPORT_MESSAGE")||this.ExcelDataColumn.push("IMPORT_MESSAGE"),"50051"==this.Feature.SelectedValue.toString()?"PAYROLL EMPLOYEE_APPRAISAL"==this.Feature.SelectedItem.Name.toString().toUpperCase()?this.ImportEmployeeAppraisal():this.ImportEmployeeData():this.ImportCosCenters()}worker1_RunWorkerCompleted(e,i){if(this.ProgressVisbility=!1,this.ImportVisbility=!0,this.GroupExists){this.ClearVaraiables();try{this.ExcelTable=[],this.dvMain.filter(l=>"0"==l.tempfield||"NO"==l.tempfield),this.ExcelTable=this.dvMain,this.GroupsImport=!1,this.onPreviewDataClick(),this.DisplayMessage="",this.MessageVisibility=!1,this.GroupExists=!1,this.IsPreviewDataOk&&this.Importbackgroundprocess()}catch(l){return this.DisplayMessage=l.Message,Logger.ErrorLog(" Message: - "+l.stack),void(this.MessageVisibility=!0)}}}worker_RunWorkerCompleted(e,i){if(Logger.InfoLog("Entered into  worker_RunWorkerCompleted()..."),this.ProgressVisbility=!1,this.ImportVisbility=!0,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){if(this.isCreditRowAdded)for(let l of this.grData.Table)"CreditAccount"==l[0].toString()&&this.grData.Table.Remove(l);if(this.isDebitRowAdded)for(let l of this.grData.Table)if("DebitAccount"==l[0].toString()){this.grData.Table.Remove(l);break}this.isCreditRowAdded=!1,this.isDebitRowAdded=!1}Logger.InfoLog("Exit from worker_RunWorkerCompleted()...")}ImportMonthlyPayroll(){}ImportAccountDimwiseCrDrLimits(){let e=this.costCenterTableZero,i=0,l="",s="",u="",h=[],t=[];t=this.ExcelTable;let o="";this.ScanServiceDimensionFields(!1);let r="",d="",c=this.grData.Table;if(c.filter(n=>"238"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"239"==n.FeatureFieldName),c.length>0&&(d=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==d)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strCodeColumn==o)):""!=this.ExcelTable[n][d].toString()&&(o=this.ExcelTable[n][d].toString(),t.filter(a=>a.strNameColumn==o)),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){for(let T=0;T<t.length;T++){u+="<Row ",u+=' Sno="'+T+'1" ';for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"CCNID2":u+=" LocationID ='"+t[T][this.grData.Table[m].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CCNID1":u+=" DivisionID ='"+t[T][this.grData.Table[m].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Dimension":u+=" DimensionID ='"+t[T][this.grData.Table[m].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Currency":u+=" CurrencyID ='"+t[T][this.grData.Table[m].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CreditDays":u+=" CreditDays ='"+t[T][this.grData.Table[m].FieldName.toString().Trim()]+"'  ";break;case"CreditLimit":u+=" Credit ='"+t[T][this.grData.Table[m].FieldName.toString().Trim()]+"'  ";break;case"DebitDays":u+=" DebitDays ='"+t[T][this.grData.Table[m].FieldName.toString().Trim()]+"'  ";break;case"DebitLimit":u+=" Debit ='"+t[T][this.grData.Table[m].FieldName.toString().Trim()]+"'  ";break;case"AccountCode":0==T&&(l=t[T][this.grData.Table[m].FieldName.toString().Trim()],this.IsCode&&h.push(ie._p.ComboBoxItems_1(l)));break;case"AccountName":0==T&&(s=t[T][this.grData.Table[m].FieldName.toString().Trim()],this.IsCode||h.push(ie._p.ComboBoxItems_1(s)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let a,g,p=[];p.push(u.toString()),p.push(s),p.push(l),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),g=I.d.document.SetImportDataToAccLocDivLimits(p),a=g,g<=0&&(i++,this.FailedRecourdList.push({Name:" Account  Name : "+o,Message:a})),u="",this.ImportedCount="Imported :"+(n+t.length-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountReportTemplate(){let e=this.costCenterTableZero,i=null;this.CostCenterFieldsAllTables.length>1&&(i=this.CostCenterFieldsAllTables[1]);let l=0,s="",u="",h="",t=[],o=[];o=this.ExcelTable;let r="",d="",c="",n=this.grData.Table;if(n.filter(a=>"238"==a.FeatureFieldName),n.length>0&&(d=n[0].FieldName.toString()),n.filter(a=>"239"==a.FeatureFieldName),n.length>0&&(c=n[0].FieldName.toString()),this.grData.Table=n,this.IsCode&&""==d)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==c)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[a][d].toString()&&(r=this.ExcelTable[a][d].toString(),o.filter(g=>g.strCodeColumn==k.Dw.GetValidXml(r))):""!=this.ExcelTable[a][c].toString()&&(r=this.ExcelTable[a][c].toString(),o.filter(g=>g.strNameColumn==k.Dw.GetValidXml(r))),0==t.filter(g=>g.Name.toUpperCase()==r.toUpperCase()).length){for(let m=0;m<o.length;m++){h+="<Row ",h+=' Sno="'+m+'1" ';let S=0;for(let F=0;F<this.grData.Table.length;F++){let y=null;if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(o.filter(C=>C.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"TemplateNodeID":if(y=i.Select(null==i||this.IsCode?f=>f.Code==o[m][this.grData.Table[F].FieldName.toString()]&&1==f.Depth:f=>f.Name==o[m][this.grData.Table[F].FieldName.toString()]&&1==f.Depth),!(y.length>0))return this.DisplayMessage="Only Level 1 groups are allowed at Row "+(m+1),void(this.MessageVisibility=!0);h+=' TemplateNodeID ="'+y[0].NodeID.toString()+'"',S=parseInt(y[0].NodeID.toString());break;case"DrNodeID":if(y=i.Select(" NodeID='"+S+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(m+1),void(this.MessageVisibility=!0);{let f=0,b=0;if(f=parseInt(y[0].lft.toString()),b=parseInt(y[0].rgt.toString()),y=i.Select(this.IsCode?"Code ='"+o[m][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'":"Name ='"+o[m][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(m+1),void(this.MessageVisibility=!0);h+=' DrNodeID ="'+y[0].NodeID.toString()+'"'}break;case"CrNodeID":if(y=i.Select(" NodeID='"+S+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(m+1),void(this.MessageVisibility=!0);{let f=0,b=0;if(f=parseInt(y[0].lft.toString()),b=parseInt(y[0].rgt.toString()),y=i.Select(this.IsCode?"Code ='"+o[m][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'":"Name ='"+o[m][this.grData.Table[F].FieldName.toString()]+"' and lft>='"+f+"'  and rgt<='"+b+"'"),!(y.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(m+1),void(this.MessageVisibility=!0);h+=' CrNodeID ="'+y[0].NodeID.toString()+'"'}break;case"RTDate":{let f;if(f=""!=o[m][this.grData.Table[F].FieldName.toString().Trim()]&&N.J0.isValidDate(o[m][this.grData.Table[F].FieldName.toString().Trim()]),f)h+=' RTDate="'+new Date(f.Year,f.Month,1).toLocaleDateString("dd/MMM/yyyy")+'"';else if(""!=o[m][this.grData.Table[F].FieldName.toString().Trim()])return this.DisplayMessage="Invalid Date at Row "+(m+1),void(this.MessageVisibility=!0)}break;case"RTGroup":h+=' RTGroup="'+o[m][this.grData.Table[F].FieldName.toString()]+'"';break;case"AccountCode":0==m&&(s=o[m][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode&&t.push(ie._p.ComboBoxItems_1(s)));break;case"AccountName":0==m&&(u=o[m][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode||t.push(ie._p.ComboBoxItems_1(u)))}}h+="></Row>"}h.Insert(0,"<XML>"),h+="</XML>";let g,T,p=[];p.push(h.toString()),p.push(u),p.push(s),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),T=I.d.document.SetImportDataToAccReportTemplate(p),T<=0&&(l++,this.FailedRecourdList.push({Name:" Account  Name : "+r,Message:g})),h="",this.ImportedCount="Imported :"+(a+o.length-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWiseBins(){let e=this.costCenterTableZero,i=0,l="",s="",u="",h=[],t=[];t=this.ExcelTable;let o="",r="",d="",c=this.grData.Table;if(c.filter(n=>"261"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"262"==n.FeatureFieldName),c.length>0&&(d=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==d)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strPCodeColumn==o.replace("'","''"))):""!=this.ExcelTable[n][d].toString()&&(o=this.ExcelTable[n][d].toString(),t.filter(a=>a.strPNameColumn==o.replace("'","''"))),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){for(let T=0;T<t.length;T++){u+="<Row ",u+=' Sno="'+T+'1" ';for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"BinDimension":u+=" Bin ='"+k.Dw.GetValidTextXml(t[T][this.grData.Table[m].FieldName.toString().Trim()])+"'  ";break;case"Capacity":u+=" Capacity ='"+t[T][this.grData.Table[m].FieldName.toString().Trim()]+"'  ";break;case"IsDefault":"true"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()||"yes"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()||"y"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()||"1"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()||"on"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="1" ':u+=e[0].SysColumnName.toString()+' ="0" ';break;case"StatusID":"in active"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()||"2"==t[T][this.grData.Table[m].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="2" ':u+=e[0].SysColumnName.toString()+' ="1" ';break;case"DimesionWiseBin":u+=" DimesionWiseBin ='"+k.Dw.GetValidTextXml(t[T][this.grData.Table[m].FieldName.toString().Trim()])+"'  ";break;case"ProductCode":0==T&&(l=t[T][this.grData.Table[m].FieldName.toString().Trim()],this.IsCode&&h.push(ie._p.ComboBoxItems_1(l.replace("'","''"))));break;case"ProductName":0==T&&(s=t[T][this.grData.Table[m].FieldName.toString().Trim()],this.IsCode||h.push(ie._p.ComboBoxItems_1(s.replace("'","''"))))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let a,p,g=[];g.push(u.toString()),g.push(s),g.push(l),g.push(this.IsCode),g.push(I.d.SessionManager.CompanyIndex),p=I.d.document.SetImportDataToProductBins(g),p<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:a})),u="",this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWithSubstitues(){let e=this.costCenterTableZero,i=0,l=0,s=0,u="",h="",t="",o="",r="",d=[],c=[];c=this.ExcelTable;let a="",g=this.grData.Table;g.filter(p=>"11386"==p.FeatureFieldName),g.length>0&&(o=g[0].FieldName.toString());for(let p=0;p<this.ExcelTable.length;p++,this.ProgressValue++)if(a=this.ExcelTable[s][o].toString(),c.filter(T=>T.strGroupColumn==a),0==d.filter(T=>T.Name.toUpperCase()==a.toUpperCase()).length){for(let y=0;y<c.length;y++){r+="<Row ";for(let C=0;C<this.grData.Table.length;C++)if(null!=this.grData.Table[C].FeatureFieldName&&""!=this.grData.Table[C].FeatureFieldName.toString()&&(e.filter(f=>f.CostCenterColID==this.grData.Table[C].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"SNO":r+=" SNO ='"+c[y][this.grData.Table[C].FieldName.toString().Trim()]+"'  ";break;case"ProductCode":0==y&&(u=c[y][this.grData.Table[C].FieldName.toString().Trim()],this.IsCode&&d.push(ie._p.ComboBoxItems_1(u)));break;case"ProductName":0==y&&(h=c[y][this.grData.Table[C].FieldName.toString().Trim()],this.IsCode||d.push(ie._p.ComboBoxItems_1(h)));break;case"SubstituteGroupName":t=c[y][this.grData.Table[C].FieldName.toString()];break;case"SubstituteProduct":r+=" SubProduct ='"+c[y][this.grData.Table[C].FieldName.toString().Trim()]+"'  "}r+=' ExRowNo="'+s+'" ></Row>',s+=1}r.Insert(0,"<SubstituteXML>"),r+="</SubstituteXML>",p=s;let m=[];m.push(h),m.push(u),m.push(t),m.push(r.toString()),m.push(this.IsCode),m.push(I.d.SessionManager.CompanyIndex);let F=I.d.document.SetImportDataToProductSubstitutes(m);if(null!=F&&F.Tables[0].length>0)for(let y=0;y<F.Tables[0].length;y++)"Success"==F.Tables[0][y].Status.toString()?(l++,this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].xIMP_STATUSx="PASS",this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].IMPORT_MESSAGE=F.Tables[0][y].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:F.Tables[0][y].SMessage.toString()})):"Fail"==F.Tables[0][y].Status.toString()&&(i++,this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].xIMP_STATUSx="FAIL",this.ExcelTable[parseInt(F.Tables[0][y].ExRowNo)].IMPORT_MESSAGE=F.Tables[0][y].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:F.Tables[0][y].SMessage.toString()}));r="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportKitProducts(){let e=this.costCenterTableZero,i=0,l="",s="",u="",h=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let o="",r="",d="",c=this.grData.Table;if(c.filter(n=>"261"==n.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(n=>"262"==n.FeatureFieldName),c.length>0&&(d=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==d)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][r].toString()&&(o=this.ExcelTable[n][r].toString(),t.filter(a=>a.strPCodeColumn==o)):""!=this.ExcelTable[n][d].toString()&&(o=this.ExcelTable[n][d].toString(),t.filter(a=>a.strGroupColumn==o)),0==h.filter(a=>a.Name.toUpperCase()==o.toUpperCase()).length){let a=!1;for(let m=0;m<t.length;m++){a=!1,u+="<Row ",u+=' RowNo="'+m+'1" ';for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Kit_Product":if(""==t[m][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()||a)return this.DisplayMessage="Error Invalid Kit Product @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[m][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+"'  ",a=!0;break;case"Kit_Product_Code":if(""==t[m][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()||a)return this.DisplayMessage="Error Invalid Kit Product Code @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[m][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+"'  ",a=!0;break;case"Kit_Qty":if(""==t[m][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit Qty @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Qty ='"+t[m][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Kit_UOM":if(""==t[m][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);{let y=this.grData.Table.filter(f=>"-34"==f.FeatureFieldName),C=null;if(y.length>0?C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[m][this.grData.Table[S].FieldName.toString().Trim()]+"' and ProductCode='"+this.ExcelTable[n][this.ExcelDataColumn.indexOf(y[0].FieldName.toString().Trim())]+"'"):(y=this.grData.Table.filter(f=>"-30"==f.FeatureFieldName),y.length>0&&(C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[m][this.grData.Table[S].FieldName.toString().Trim()]+"' and ProductName='"+this.ExcelTable[n][this.ExcelDataColumn.indexOf(y[0].FieldName.toString().Trim())]+"'"))),(null==C||0==C.length)&&(C=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[m][this.grData.Table[S].FieldName.toString().Trim()]+"'  and (ProductName is null or ProductName='DynamicSet')")),!(C.length>0))return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Unit ='"+C[0].UOMID.toString()+"'"}break;case"Kit_Rate":if(""==t[m][this.grData.Table[S].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid rate @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Rate ='"+t[m][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Kit_Link":""==t[m][this.grData.Table[S].FieldName.toString().Trim()]||"OPTIONAL"!=t[m][this.grData.Table[S].FieldName.toString().Trim()].toUpperCase()&&"O"!=t[m][this.grData.Table[S].FieldName.toString().Trim()]&&"1"!=t[m][this.grData.Table[S].FieldName.toString().Trim()]?""!=t[m][this.grData.Table[S].FieldName.toString().Trim()]&&("MANDATORY"==t[m][this.grData.Table[S].FieldName.toString().Trim()]||"M"==t[m][this.grData.Table[S].FieldName.toString().Trim()]||"2"==t[m][this.grData.Table[S].FieldName.toString().Trim()])&&(u+=" LINK ='2'"):u+=" LINK ='1'";break;case"ProductCode":0==m&&(l=t[m][this.grData.Table[S].FieldName.toString().Trim()],this.IsCode&&h.push(ie._p.ComboBoxItems_1(l)));break;case"ProductName":0==m&&(s=t[m][this.grData.Table[S].FieldName.toString().Trim()],this.IsCode||h.push(ie._p.ComboBoxItems_1(s)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let g,T,p=[];p.push(s),p.push(l),p.push(this.IsCode),p.push(I.d.SessionManager.CompanyIndex),T=I.d.document.SetImportKitProducts(p),T<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:g})),u="",this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAttachments(){let e=this.costCenterTableZero,i=0,l=0,s="",u="";if(!this.ScanCostCenterFields(!1))return;let h="",t="",o=[],r=[];r=this.ExcelTable;let d="",c="",n="",a=this.grData.Table;if(a.filter(g=>"12"==g.FeatureFieldName),a.length>0&&(c=a[0].FieldName.toString()),a.filter(g=>"13"==g.FeatureFieldName),a.length>0&&(n=a[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(this.IsCode&&""==c)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==n)return this.DisplayMessage="Please select name field",void(this.MessageVisibility=!0);for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[g][c].toString()&&(d=this.ExcelTable[g][c].toString(),r.filter(p=>p.strPCodeColumn==d)):""!=this.ExcelTable[g][n].toString()&&(d=this.ExcelTable[g][n].toString(),r.filter(p=>p.strPNameColumn==d)),!o.Contains(d.toUpperCase())){for(let S=0;S<r.length;S++){h+='<Row Action="NEW" ';for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(e.filter(y=>y.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),e.length>0)){let y=e[0].SysColumnName.toString();switch(y){case"Type":""!=r[S][this.grData.Table[F].FieldName.toString()+"_Key"].toString().Trim()&&(h+=' Type ="'+r[S][this.grData.Table[F].FieldName.toString()+"_Key"].toString().Trim()+'"  ');break;case"IssueDate":case"Validtill":{let C;C=N.J0.isValidDate(r[S][this.grData.Table[F].FieldName.toString().Trim()]),C&&(h+=y+'="'+C.toLocaleDateString("dd/MMM/yyyy")+'" ');break}case"FileDescription":case"Remarks":case"DocNo":case"RefNo":h+=y+'="'+r[S][this.grData.Table[F].FieldName.toString().Trim()]+'"  ';break;case"stat":case"status":"active"==r[S][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"1"==r[S][this.grData.Table[F].FieldName.toString().Trim()]?h+='stat="1"  ':h+='stat="0"  ';break;case"FileName":break;case"Code":0==S&&(s=r[S][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode&&o.push(s.toUpperCase()));break;case"Name":0==S&&(u=r[S][this.grData.Table[F].FieldName.toString().Trim()],this.IsCode||o.push(u.toUpperCase()))}}h+="></Row>"}if(0==t.toString().length){t+="<Detxml ";for(let S=0;S<this.grData.Table.length;S++)null==this.grData.Table[S].FeatureFieldName||""==this.grData.Table[S].FeatureFieldName.toString()||(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0&&"1"==e[0].IsUnique.toString()&&(t+=" "+e[0].SysColumnName.toString()+'="1" '+e[0].SysColumnName.toString()+'Text="'+e[0].ResourceData.toString()+'" '));t+="></Detxml>",h+=t.toString()}else h+=t.toString();h.Insert(0,"<AttachmentsXML>"),h+="</AttachmentsXML>";let p,m,T=[];T.push(h.toString()),T.push(this.QtyCombo.SelectedValue),T.push(u),T.push(s),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyIndex),m=I.d.document.ImportAttachments(T),m>0?l++:m<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+d,Message:p})),h="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportQCProducts(){let e=this.costCenterTableZero,i=0,l="",s="",u="",h=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let o="",r="",d="",c=this.grData.Table;if(c.filter(a=>"261"==a.FeatureFieldName),c.length>0&&(r=c[0].FieldName.toString()),c.filter(a=>"262"==a.FeatureFieldName),c.length>0&&(d=c[0].FieldName.toString()),this.IsCode&&""==r)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==d)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[a][r].toString()&&(o=this.ExcelTable[a][r].toString(),t.filter(g=>g.strPCodeColumn==o)):""!=this.ExcelTable[a][d].toString()&&(o=this.ExcelTable[a][d].toString(),t.filter(g=>g.strPNameColumn==o)),!h.includes(o.toUpperCase())){let g;for(let S=0;S<t.length;S++){u+="<Row ",u+=' RowNo="'+S+'1" ';let F=!1;for(let y=0;y<this.grData.Table.length;y++)if(null!=this.grData.Table[y].FeatureFieldName&&""!=this.grData.Table[y].FeatureFieldName.toString()&&(e.filter(C=>C.CostCenterColID==this.grData.Table[y].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"QC Name":case"QC Code":if(""==t[S][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim())return this.DisplayMessage="Error Invalid Kit QC @ row "+(a+1),void(this.MessageVisibility=!0);F||(u+=" TestCaseID ='"+t[S][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim()+"'  ",F=!0);break;case"Document":if(""!=t[S][this.grData.Table[y].FieldName.toString().Trim()]){var n=this.Feature.Items.firstOrDefault(f=>f.Name.toLowerCase()==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase());if(null==n)return this.DisplayMessage="Error Document @ row "+(a+1),void(this.MessageVisibility=!0);u+=" Document ='"+n+"'  "}break;case"Type":"numeric"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" Type ='0' ":u+=" Type ='1' ";break;case"Min":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Min ='"+g+"'  ");break;case"Max":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Max ='"+g+"'  ");break;case"Probable val":u+=" Probableval ='"+t[S][this.grData.Table[y].FieldName.toString().Trim()]+"'  ";break;case"Sample":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Sample ='"+g+"'  ");break;case"SampleType":"value"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='0'  ":"number"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='1'  ":"percentage value"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='2'  ":"percentage number"==t[S][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()&&(u+=" SampleType ='3'  ");break;case"Observation":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Observation ='"+g+"'  ");break;case"Varience":parseFloat(t[S][this.grData.Table[y].FieldName.toString().Trim()])&&(u+=" Varience ='"+g+"'  ");break;case"ProductCode":0==S&&(l=t[S][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode&&h.push(l.toUpperCase()));break;case"ProductName":0==S&&(s=t[S][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode||h.push(s.toUpperCase()))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let p,m,T=[];T.push(u.toString()),T.push(s),T.push(l),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyIndex),m=I.d.document.ImportQCProducts(T),m<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+o,Message:p})),u="",this.ImportedCount="Imported :"+(a+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ReturnMultipleAddress(e,i,l){let s=null,u=null,h=null,t="";for(let o=0;o<e.length;o++){let r;if(s="",u="",h="",r=this.grData.Table.filter(l?d=>"26707"==d.FeatureFieldName:d=>"24321"==d.FeatureFieldName),!l&&r.length>0&&""!=e[o][r[0][0].toString()]&&"Primary"==e[o][r[0][0].toString()]?t+='<Rows Action="NEW"':t+='<Row Action="NEW"',r.length>0)try{t+=l?' AddressTypeID="'+e[o][r[0][0].toString()]!=""&&"Address"==e[o][r[0][0].toString()]?"1":""!=e[o][r[0][0].toString()]&&"Billing"==e[o][r[0][0].toString()]?"2":""!=e[o][r[0][0].toString()]&&"Shipping"==e[o][r[0][0].toString()]?"3":'0"':' AddressTypeID="'+e[o][r[0][0].toString()]!=""&&"Primary"==e[o][r[0][0].toString()]?"1":""!=e[o][r[0][0].toString()]&&"Secondary"==e[o][r[0][0].toString()]?"2":'0"'}catch(d){Logger.ErrorLog("ReturnMultipleAddress, Error Message :"+d.Message)}else t+=' AddressTypeID="2"';for(let d=0;d<this.grData.Table.length;d++)null==this.grData.Table[d].FeatureFieldName||""==this.grData.Table[d].FeatureFieldName.toString()||(i.filter(c=>c.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),26707!=parseInt(this.grData.Table[d].FeatureFieldName)&&24321!=parseInt(this.grData.Table[d].FeatureFieldName)&&i.length>0&&(null!=this.lstAddressFields&&this.lstAddressFields.filter(c=>c==parseInt(this.grData.Table[d].FeatureFieldName)).length>0||null!=this.lstContactFields&&this.lstContactFields.filter(c=>c==parseInt(this.grData.Table[d].FeatureFieldName)).length>0)&&(i[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=i[0].SysColumnName.toString().replace("Contact_","")+"=N'"+k.Dw.GetValidXml(e[o][this.grData.Table[d].FieldName.toString().Trim()])+"',":this.lstAddressFields.length>0&&i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")||this.lstContactFields.length>0&&i[0].SysColumnName.toString().toUpperCase().startsWith("CONTACT_CCNID")?h+=i[0].SysColumnName.toString().replace("Contact_","")+"='"+e[o][this.grData.Table[d].FieldName.toString()+"_Key"].toString()+"',":s+=i[0].SysColumnName.toString().replace("Contact_","")+"=N'"+k.Dw.GetValidXml(e[o][this.grData.Table[d].FieldName.toString()])+"',"));t+=' StaticFields ="'+s.toString().Trim(",")+'" ',t+=' ExtraTextFields ="'+u.toString().Trim(",")+'" ',t+=' CCFields ="'+h.toString().Trim(",")+'" ',t+="/>"}return t.length>0&&(t.Insert(0,"<Data>"),t+="</Data>"),t.toString()}ValidateBudgetRow(e,i,l){this.DisplayMessage="";let s=null;if(i<=0)for(var u of(s=new Dt.zd(0,""),s.amount=l,this.ccdv))null!=(h=this.Feature.Items.filter(o=>o.Value==u.Key.toString()))&&e.includes(h.Name+"_Key")&&(e[h.Name+"_Key"].toString().length>0?s.addDimValue(e[h.Name+"_Key"].toString()):s.addDimValue("1"));else for(var u of(s=new Dt.zd,s.rowID=i,s.amount=l,this.ccdv)){var h;null!=(h=this.Feature.Items.filter(d=>d.Value==u.Key.toString()))&&e.includes(h.Name+"_Key")&&(e[h.Name+"_Key"].toString().length>0?s.addDimValue(e[h.Name+"_Key"].toString()):s.addDimValue(""))}if(this.budgetInput=[],this.budgetInput.push(this.inpRow),this.budgetInput=[],this.myBudget=new Dt.__(this.budgetTable,this.ccdv.length),this.DataCollection.Budgetid>0&&(i=this.myBudget.getDimensionRowId(i,this.inpRow)),i<=0){let o=[],r=this.myBudget.checkAddBudgetConflicts(this.inpRow,o,"");if(0!=r)return this.DisplayMessage="",this.inpRow.linkedDimRows="",this.inpRow.tempLinkedDimRows=0,this.DisplayMessage;{let d;if(this.budgetTable.length>0&&(d=this.budgetTable[this.budgetTable.length-1].RowID+1),r=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,o,d),0==r){this.myBudget.getTransactionLogSummary(o,this.strTransLog);let n=new Dt.zd(this.inpRow);n.rowID=d,this.budgetTable.push(n)}}}else{if(this.myBudget.checkEditBudgetConflicts(this.inpRow,"")>0)return this.DisplayMessage="",this.DisplayMessage;s=null,0==this.getDimensionRow(this.inpRow.rowID,s)&&this.assignDimRowValues(this.inpRow,s)}return this.DisplayMessage}getDimensionRow(e,i){for(let s=0;s<this.budgetTable.length;s++)if(this.budgetTable[s].rowID==e)return 0;return 1}assignDimRowValues(e,i){i.rowID=e.rowID,i.amount=e.amount,i.budgetUsed=e.budgetUsed,i.linkedDimRows=e.linkedDimRows,i.nAnys=e.nAnys,i.nAnysComputed=e.nAnysComputed,i.tempLinkedDimRows=e.tempLinkedDimRows,i.row.Clear();for(let l=0;l<e.row.length;l++)i.row.push(e.row[l])}ImportBudget(){let e=this.costCenterTableZero;this.DataCollection=new Vt.t;for(let p=0;p<this.ExcelTable.length;p++)for(let T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(e.filter(m=>m.CostCenterColID==m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)this.CheckCostCenterField(p,parseInt(e[0].ColumnCostCenterID.toString()),T.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){if("TOWER NAME"!=T.FieldName.toString().Trim().toUpperCase()&&"UNIT TYPE"!=T.FieldName.toString().Trim().toUpperCase()&&null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!N.J0.Int(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[p][T.FieldName.toString().Trim()]))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0);let i=0;this.FillCostCenterFields(!1),this.DataCollection.CCList="",this.DataCollection.RelationsXML="";let u,l="",s=this.grData.Table.filter(p=>"23207"==p.FeatureFieldName);if(!(s.length>0))return void(this.DisplayMessage="Profile Name Not Selected");l=s[0].FieldName.toString(),u=this.toTableDistinct(this.ExcelTable,l);let h="",t=0,o="",r=[];r=this.ExcelTable;let d="",c=I.d.document.GetDataSet(" SELECT distinct(BudgetDefID),BudgetName FROM COM_BudgetDef WITH(NOLOCK) \n            SELECT DISTINCT BudgetDefID,CostCenterID,CCCodeTypeID FROM COM_BudgetDefDims WITH(NOLOCK) "),n=c.Tables[0],a=0;for(let p=0;p<u.length;p++){if(d=u[p][l].toString().Trim(),0==d.length||(r.filter(f=>f.strBudgetNameField==d),0==r.length))continue;this.DataCollection.BudgetName=d,n.filter(f=>f.BudgetName==d),this.DataCollection.Budgetid=n.length>0?parseInt(n[0].BudgetDefID):0;let T=[],m=1,S=1,F=0,y="";for(let f=0;f<r.length;f++){m=1,S=1,y="",F=0,o+='<Row Budget="0" ',o+=' Sno="'+f+'1" ';let b="",x=[];for(let w=0;w<this.grData.Table.length;w++)if(null!=this.grData.Table[w].FeatureFieldName&&""!=this.grData.Table[w].FeatureFieldName.toString()&&(e.filter(U=>U.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()),e.length>0))switch(h="",e[0].SysColumnName.toString()){case"AnnualAmount":h=r[f][this.grData.Table[w].FieldName.toString().Trim()],""!=h&&(t=parseFloat(h));break;case"Rate":h=r[f][this.grData.Table[w].FieldName.toString().Trim()],""!=h&&(F=parseFloat(h));break;case"BudgetCode":case"BudgetName":0==f&&(h=r[f][this.grData.Table[w].FieldName.toString().Trim()],x.push(ie._p.ComboBoxItems_1(h)));break;case"FinYearStartDate":0==f&&(h=r[f][this.grData.Table[w].FieldName.toString().Trim()],this.DataCollection.StartYear=new Date(h));break;case"BudgetType":if(0==f){switch(h=r[f][this.grData.Table[w].FieldName.toString().Trim()],h.toUpperCase().split(" ")[0]){case"ANNAUL":this.BudgetType=0;break;case"HALFYEARLY":this.BudgetType=1;break;case"MONTHLY":this.BudgetType=3;break;case"QUATERLY":this.BudgetType=2}this.DataCollection.BudgetTypeID=this.BudgetType,this.DataCollection.BudgetType=h}break;case"CarryForward":y=r[f][this.grData.Table[w].FieldName.toString().Trim()],"monthly"==y.toLowerCase()?y="M":"half yearly"==y.toLowerCase()?y="H":"quarterly"==y.toLowerCase()?y="Q":"yearly"==y.toLowerCase()&&(y="Y");break;case"Currency":m=parseInt(r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString().Trim()),S=parseFloat(r[f].ExchangeRate.toString().Trim());break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&("2"==e[0].ColumnCostCenterID.toString()?(b+="AccountID ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"' ",o+="AccountID ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"'  "):"3"==e[0].ColumnCostCenterID.toString()?(b+="ProductID ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"' ",o+="ProductID ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"'  "):(b+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"' ",o+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+r[f][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"'  "))}if(T.Contains(b))return void(this.DisplayMessage="Duplicate Dimensions At Row No : "+(this.ExcelTable.indexOf(r[f].Row)+1));if(T.push(b),0==this.DataCollection.BudgetTypeID)o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+m+'" ',o+=' ExchangeRate="'+S+'" ';else if(1==this.DataCollection.BudgetTypeID){t=0;for(let w=0;w<this.grData.Table.length;w++)null==this.grData.Table[w].FeatureFieldName||""==this.grData.Table[w].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("YEARH")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[w].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[w].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[w].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+m+'" ',o+=' ExchangeRate="'+S+'" '}else if(2==this.DataCollection.BudgetTypeID){t=0;for(let w=0;w<this.grData.Table.length;w++)null==this.grData.Table[w].FeatureFieldName||""==this.grData.Table[w].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("QTR")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[w].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[w].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[w].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Month1Amount="'+t/12+'" ',o+=' Month2Amount="'+t/12+'" ',o+=' Month3Amount="'+t/12+'" ',o+=' Month4Amount="'+t/12+'" ',o+=' Month5Amount="'+t/12+'" ',o+=' Month6Amount="'+t/12+'" ',o+=' Month7Amount="'+t/12+'" ',o+=' Month8Amount="'+t/12+'" ',o+=' Month9Amount="'+t/12+'" ',o+=' Month10Amount="'+t/12+'" ',o+=' Month11Amount="'+t/12+'" ',o+=' Month12Amount="'+t/12+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+m+'" ',o+=' ExchangeRate="'+S+'" '}else if(3==this.DataCollection.BudgetTypeID){t=0;for(let w=0;w<this.grData.Table.length;w++)null==this.grData.Table[w].FeatureFieldName||""==this.grData.Table[w].FeatureFieldName.toString()||(e.filter(U=>U.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("MONTH")&&(o+=e[0].SysColumnName.toString()+' ="'+r[f][this.grData.Table[w].FieldName.toString().Trim()]+'" ',""!=r[f][this.grData.Table[w].FieldName.toString()]&&(t+=parseFloat(r[f][this.grData.Table[w].FieldName.toString()]))));o+=' Rate="'+F+'" ',o+=' AnnualAmount="'+t+'" ',o+=' YearH1Amount="'+t/2+'" ',o+=' YearH2Amount="'+t/2+'" ',o+=' Qtr1Amount="'+t/4+'" ',o+=' Qtr2Amount="'+t/4+'" ',o+=' Qtr3Amount="'+t/4+'" ',o+=' Qtr4Amount="'+t/4+'" ',o+=' CF="'+y+'" ',o+=' Currency="'+m+'" ',o+=' ExchangeRate="'+S+'" '}if(o+="></Row>",!this.IsUpdate&&this.DataCollection.Budgetid>0)return this.DisplayMessage="Duplicate Budget Name ="+this.DataCollection.BudgetName,void(this.MessageVisibility=!0);if(this.DisplayMessage=this.ValidateBudgetRow(r[f].Row,0,t),null==this.DisplayMessage&&(this.DisplayMessage=""),this.DisplayMessage.length>0)return void(this.MessageVisibility=!0)}if(this.DataCollection.Status=1,o.Insert(0,"<XML>"),o+="</XML>",this.DataCollection.SbXML=o.toString(),null!=this.ccdv)for(var g of this.ccdv){this.DataCollection.NumDimensions++;let f=c.Tables[1].Select("CostCenterID="+g.Key+" and BudgetDefID="+this.DataCollection.Budgetid);this.DataCollection.CCList+='<Row CC="'+g.Key+'" CCCodeTypeID="'+(null!=f&&f.length>0&&!N.J0.IsEmpty(f[0].CCCodeTypeID.toString())?f[0].CCCodeTypeID.toString():"0")+'"/>'}this.DataCollection.CCList.length>0&&(this.DataCollection.CCList="<XML>"+this.DataCollection.CCList+"</XML>"),this.DataCollection.RelationsXML=o.toString(),this.DataCollection.SelectedNodeID=1;let C=0;this.DataCollection.IsAppend=this.AppendData,this.DisplayMessage=this.DataCollection.SetImportBudget(),C<=0&&(i++,this.FailedRecourdList.push({Name:" Budget  Name : "+d,Message:this.DisplayMessage})),o="",a+=r.length,this.ImportedCount="Imported :"+(p+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+"(Rows), "+u.length+"(Profiles) "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}static ReturnAnnaulAmount(e,i){}ImportAccountContacts(){let e=this.costCenterTableZero;for(let r=0;r<this.ExcelTable.length;r++)for(let d of this.grData.Table)if(null!=d[1]&&""!=d[1].toString()&&"0"!=d[1].toString()&&(e.filter(c=>c.CostCenterColID==c[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(r,parseInt(e[0].ColumnCCListViewTypeID.toString()),d.FieldName.toString()):this.CheckCostCenterField(r,parseInt(e[0].ColumnCostCenterID.toString()),d.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){if(null!=this.ExcelTable[r][d.FieldName.toString()]&&""!=this.ExcelTable[r][d.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[r][d.FieldName.toString().Trim()]))return this.DisplayMessage=d.FieldName.toString()+" "+this.ExcelTable[r][d.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let c;if(c=null!=this.ExcelTable[r][d.FieldName.toString()]&&""!=this.ExcelTable[r][d.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[r][d.FieldName.toString().Trim()]),c)return this.DisplayMessage=d.FieldName.toString()+" "+this.ExcelTable[r][d.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[r][d.FieldName.toString().Trim()]))return this.DisplayMessage=d.FieldName.toString()+" "+this.ExcelTable[r][d.FieldName.toString().Trim()]+" at Row "+(r+1).toString(),void(this.MessageVisibility=!0);let i=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let l="",s="",u="",h="",t=0,o=2;for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){l="",s="",u="",t=0,o=2,h="";for(let c=0;c<this.grData.Table.length;c++)if(null!=this.grData.Table[c].FeatureFieldName&&""!=this.grData.Table[c].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[c].FeatureFieldName.toString()),e.length>0)){let n=e[0].SysColumnName.toString();switch(n){case"ContactTypeID":case"AddressTypeID":o="primary"==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()].toLowerCase()?1:2;break;case"FeaturePK":null!=this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"]&&""!=this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()&&(t=parseInt(this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString().Trim()));break;case"Status":"in active"==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()].toLowerCase()?s+=n+" =404, ":s+=n+" =403, ";break;case"FirstName":h=k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()]),s+=n+" =N'"+h+"', ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":s+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?l+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":s+=n+" ='"+this.ExcelTable[r][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()]?s+=n+" ='0', ":s+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[c].FieldName.toString().Trim()])+"', "}}let d;if(t>0){let c=[];c.push(parseInt(this.Feature.SelectedValue)),c.push(t),c.push(o),c.push(s),c.push(u),c.push(l),c.push(I.d.SessionManager.UserName),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.RoleID),c.push(I.d.SessionManager.LanguageID),d=I.d.document.SetImportContracts(c),d<=0&&(i++,this.FailedRecourdList.push({Name:"Name : "+h,Message:d}))}else i++,this.FailedRecourdList.push({Name:"Name : "+h,Message:"Account not found"});this.ImportedCount="Imported :"+(r+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountAddress(){let e=this.costCenterTableZero,i="",l="";for(let n=0;n<this.ExcelTable.length;n++)for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(e.filter(g=>g.CostCenterColID==g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),a.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),a.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){let g;if(g=null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]),g)return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}let s=0,u=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let h="",t="",o="",r="",d=0,c=1;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++){h="",t="",o="",d=0,c=1,r="";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),e.length>0)){let m=e[0].SysColumnName.toString();switch(m){case"AddressTypeID":c="address"==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()?1:"billing"==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()?2:3;break;case"AccountCode":null!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(i=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]);break;case"AccountName":null!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[T].FieldName.toString()]&&(l=this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]);break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?o+=m+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":t+=m+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?h+=m+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":t+=m+" ='"+this.ExcelTable[n][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?o+=m+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()]?t+=m+" ='0', ":t+=m+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[T].FieldName.toString().Trim()])+"', "}}let a,g=[];g.push(parseInt(i)),g.push(l),g.push(c),g.push(t),g.push(o),g.push(h),g.push(this.IsCode),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.RoleID),g.push(I.d.SessionManager.LanguageID),a=I.d.document.SetImportAddress(g),a<=0?(s++,this.FailedRecourdList.push({Name:"Name : "+r,Message:a}),this.ExcelTable[n].xIMP_STATUSx="FAIL",this.ExcelTable[n].IMPORT_MESSAGE=a):(u++,this.FailedRecourdList.push({Name:"Name : "+r,Message:a}),this.ExcelTable[n].xIMP_STATUSx="PASS",this.ExcelTable[n].IMPORT_MESSAGE=a),this.ImportedCount="Imported :"+u.toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportDimensionMove(){let e;if(e=this.grData.Table.filter(n=>"-1"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Grop Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-2"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Node Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-3"==n.FeatureFieldName||"-4"==n.FeatureFieldName),!(e.length>0))return this.DisplayMessage="Dimension Field Not Found",void(this.MessageVisibility=!0);let l,s,u,h,t,o,r,i=0,d=new Qt.d,c=this.costCenterTableZero;for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&"-4"!=this.grData.Table[n].FeatureFieldName.toString()&&(this.ExcelTable.includes(this.grData.Table[n].FieldName.toString()+"_Key")||this.ExcelTable.push(this.grData.Table[n].FieldName.toString()+"_Key"),"-3"==this.grData.Table[n].FeatureFieldName.toString()&&this.grData.Table.filter(a=>"-4"==a.FeatureFieldName).length>0))for(let a=0;a<this.ExcelTable.length;a++)this.ExcelTable[a][this.grData.Table[n].FieldName.toString()+"_Key"]=this.ExcelTable[a][this.grData.Table.filter(g=>"-4"==g.FeatureFieldName)[0].FieldName.toString()];for(let n=0;n<this.ExcelTable.length;n++){l=s=u=h=0,r=o=t="";for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&(c.filter(g=>g.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),c.length>0))switch(t=c[0].SysColumnName.toString(),t){case"DimensionID":l=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()]);break;case"DimensionName":""==this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString()&&this.CheckCostCenterField(n,5,this.grData.Table[a].FieldName.toString(),!1,this.IsCode),l=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString());break;case"Node":this.CheckCostCenterField(n,parseInt(l),this.grData.Table[a].FieldName.toString(),!1,this.IsCode),r=this.ExcelTable[n][this.grData.Table[a].FieldName.toString().Trim()],s=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString());break;case"Group":this.CheckCostCenterField(n,parseInt(l),this.grData.Table[a].FieldName.toString(),!1,this.IsCode),o=this.ExcelTable[n][this.grData.Table[a].FieldName.toString()],u=parseInt(this.ExcelTable[n][this.grData.Table[a].FieldName.toString()+"_Key"].toString())}t=d.MoveCostCenter(l,s.toString(),u,0),i++,this.FailedRecourdList.push({Name:"Node : "+r+" ; Group : "+o,Message:t}),this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLeadsWithProduct(){let e=this.costCenterTableZero,i=0,l="",s="",u="",h="",t="",o="",r="",d=[];if(!this.ExcelTable.includes("Company")&&!this.ExcelTable.includes("LeadCode"))return this.DisplayMessage="Company/LeadCode should present in excel",void(this.MessageVisibility=!0);for(let p=0;p<this.ExcelTable.length;p++)for(const T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(e.filter(m=>m.CostCenterColID===m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(p,parseInt(e[0].ColumnCCListViewTypeID.toString()),T.FieldName.toString()):this.CheckCostCenterField(p,parseInt(e[0].ColumnCostCenterID.toString()),T.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let m;if("25623"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=T.FeatureFieldName.toString().Trim().toUpperCase()&&(m=null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]),m))return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=null!=this.ExcelTable[p][T.FieldName.toString()]&&""!=this.ExcelTable[p][T.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[p][T.FieldName.toString().Trim()]),m)return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=!N.J0.isValidDate(this.ExcelTable[p][T.FieldName.toString().Trim()]),m)return this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[p][T.FieldName.toString().Trim()]+" at Row "+(p+1).toString(),void(this.MessageVisibility=!0)}this.FillCostCenterFields(!1),this.FillLookupFields();let n,c="";this.CCNodeDet=[];let a="",g=[];g=this.ExcelTable,t="",d=[];for(let p=0;p<this.ExcelTable.length;p++,this.ProgressValue++)if(this.IsCode?this.ExcelTable.includes("LeadCode")&&""!=this.ExcelTable[p].LeadCode.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[p].LeadCode.toString().Trim()),g.filter(T=>T.LeadCode==t)):this.ExcelTable.includes("Company")&&""!=this.ExcelTable[p].Company.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[p].Company.toString().Trim()),g.filter(T=>T.Company==t)),0==d.filter(T=>T.Name.toUpperCase()==t.toUpperCase()).length){let T="",m="",S="",F="";F+="<XML>",o+="<Row ";for(let b=0;b<this.grData.Table.length;b++)if(null!=this.grData.Table[b].FeatureFieldName&&""!=this.grData.Table[b].FeatureFieldName.toString()&&(e.filter(x=>x.CostCenterColID==this.grData.Table[b].FeatureFieldName.toString()&&"CRM_ProductMapping"!==x.CostCenterColID),c="",e.length>0))switch(c=e[0].SysColumnName.toString(),c){case"Code":l=this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()];break;case"Company":s=this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":o+=c+'="'+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":n=N.J0.isValidDate(this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]),n&&(o+=c+'="'+n.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":o+=c+'="'+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="0" ':"existing"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="1" ':"account"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?o+='  Mode ="2" ':"customer"==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()&&(o+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":m+=c+"='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;case"Email1":m+="Email='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":S+=c+"='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?c.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?T+=c+" ='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":h+=c+" ='"+this.ExcelTable[p][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()]?h+=c+" ='0', ":h+=c+" =N'"+k.Dw.GetValidXml(this.ExcelTable[p][this.grData.Table[b].FieldName.toString().Trim()])+"', "}o+=" ></Row>",F+="</XML>",r+="<XML><Row ",""!=h&&(r+=' ExtraFields ="'+h.Trim(",")+'" '),""!=S&&(r+=' TabDetails ="'+S.Trim(",")+'" '),""!=T&&(r+=' CostCenterFields ="'+T+'" '),""!=m&&(r+='ContactFields ="'+m.Trim(",")+'" '),r+=" ></Row></XML>",o.replace("&","&amp;");for(let b=0;b<g.length;b++){u="",a+="<Row ",a+=' Sno="'+b+'1" ';for(let x=0;x<this.grData.Table.length;x++)if(null!=this.grData.Table[x].FeatureFieldName&&""!=this.grData.Table[x].FeatureFieldName.toString()&&(e.filter(R=>R.CostCenterColID==this.grData.Table[x].FeatureFieldName.toString()&&"CRM_ProductMapping"!==R.CostCenterColID),e.length>0))switch(c=e[0].SysColumnName.toString(),c){case"ProductID":a+=" Product ='"+g[b][this.grData.Table[x].FieldName.toString()]+"'  ";break;case"CRMProduct":a+=" CRMProduct ='"+g[b][this.grData.Table[x].FieldName.toString()]+"'  ";break;case"Description":a+=" Description ='"+g[b][this.grData.Table[x].FieldName.toString()]+"'  ";break;case"Quantity":a+=" Quantity ='"+g[b][this.grData.Table[x].FieldName.toString()]+"'  ";break;case"Code":0==b&&(l=g[b][this.grData.Table[x].FieldName.toString().Trim()],this.IsCode&&d.push(ie._p.ComboBoxItems_1(l)));break;case"Company":0==b&&(s=g[b][this.grData.Table[x].FieldName.toString().Trim()],this.IsCode||d.push(ie._p.ComboBoxItems_1(s)));break;default:this.ExcelTable.includes(this.grData.Table[x].FieldName.toString()+"_Key")?u+=e[0].SysColumnName.toString()+" =N'"+g[b][this.grData.Table[x].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==g[b][this.grData.Table[x].FieldName.toString().Trim()]?u+=e[0].SysColumnName.toString()+" ='0', ":u+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(g[b][this.grData.Table[x].FieldName.toString().Trim()])+"', "}""!=u&&(a+=' ExtraFields ="'+u.Trim(",")+'" '),a+="></Row>",u="",b>0&&p++}a.Insert(0,"<XML>"),a+="</XML>";let y,f,C=[];C.push(a.toString()),C.push(s),C.push(this.IsCode),C.push(o.toString()),C.push(r.toString()),C.push(this.IsDuplicateNameAllowed),C.push(this.IsAutoCodeGen),C.push(this.IsUpdate),C.push(I.d.SessionManager.CompanyIndex),C.push(I.d.SessionManager.UserName),C.push(I.d.SessionManager.UserID),C.push(I.d.SessionManager.RoleID),C.push(I.d.SessionManager.LanguageID),f=I.d.document.SetImportDataToLeadProducts(C),f<=0&&(i++,this.FailedRecourdList.push({Name:" Company Name : "+t,Message:y})),a="",o="",r="",u="",h="",S="",T="",m="",this.ImportedCount="Imported :"+(p+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLeads(){let e=this.costCenterTableZero;for(let o=0;o<this.ExcelTable.length;o++)for(let r of this.grData.Table)if(null!=r[1]&&""!=r[1].toString()&&"0"!=r[1].toString()&&(e.filter(d=>d.CostCenterColID===d[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(o,parseInt(e[0].ColumnCCListViewTypeID.toString()),r.FieldName.toString()):this.CheckCostCenterField(o,parseInt(e[0].ColumnCostCenterID.toString()),r.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let d;if("25623"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&(d=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),d))return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),d)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=!N.J0.isValidDate(this.ExcelTable[o][r.FieldName.toString().Trim()]),d)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}let i=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,l="",s="",u="",h="";this.CCNodeDet=[];for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){let r="",d="",c="",n="",a="";a+="<XML>",h+="<Row ";for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(F=>F.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),l="",e.length>0))switch(l=e[0].SysColumnName.toString(),l){case"Code":s=this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()];break;case"Company":u=this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":h+=l+'="'+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":t=N.J0.isValidDate(this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]),t&&(h+=l+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":h+=l+'="'+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="0" ':"existing"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="1" ':"account"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?h+='  Mode ="2" ':"customer"==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()&&(h+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":c+=l+"='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Email1":c+="Email='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":n+=l+"='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?l.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?r+=l+" ='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":d+=l+" ='"+this.ExcelTable[o][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()]?d+=l+" ='0', ":d+=l+" =N'"+k.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[S].FieldName.toString().Trim()])+"', "}h+=" ></Row>",a+="</XML>";let g="";g+="<XML><Row ",""!=d&&(g+=' ExtraFields ="'+d.Trim(",")+'" '),""!=n&&(g+=' TabDetails ="'+n.Trim(",")+'" '),""!=r&&(g+=' CostCenterFields ="'+r+'" '),""!=c&&(g+='ContactFields ="'+c.Trim(",")+'" '),g+=" ></Row></XML>",h.replace("&","&amp;");let p,T=[];T.push(h.toString()),T.push(g.toString()),T.push(parseInt(this.Feature.SelectedValue)),T.push(s),T.push(u),T.push(this.IsUpdate),T.push(this.IsCode),T.push(this.IsUpdate),T.push(I.d.SessionManager.CompanyIndex),T.push(I.d.SessionManager.UserName),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.RoleID),T.push(I.d.SessionManager.LanguageID),p=I.d.document.SetImportDataToCRM(T),p<=0&&(i++,this.FailedRecourdList.push({Name:"Code : "+s+" ; Name : "+u,Message:p})),h="",this.ImportedCount="Imported :"+(o+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCases(){let e=this.costCenterTableZero;for(let o=0;o<this.ExcelTable.length;o++)for(let r of this.grData.Table)if(null!=r[1]&&""!=r[1].toString()&&"0"!=r[1].toString()&&(e.filter(d=>d.CostCenterColID===d[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(o,parseInt(e[0].ColumnCCListViewTypeID.toString()),r.FieldName.toString()):this.CheckCostCenterField(o,parseInt(e[0].ColumnCostCenterID.toString()),r.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let d;if("24238"!=r.FeatureFieldName.toString().Trim().toUpperCase()&&(d=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),d))return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=null!=this.ExcelTable[o][r.FieldName.toString()]&&""!=this.ExcelTable[o][r.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][r.FieldName.toString().Trim()]),d)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let d;if(d=!N.J0.isValidDate(this.ExcelTable[o][r.FieldName.toString().Trim()]),d)return this.DisplayMessage=r.FieldName.toString()+" "+this.ExcelTable[o][r.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}let i=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,l="",s="",u="",h="";this.CCNodeDet=[];for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){let r="",d="";h+="<Row ";for(let p=0;p<this.grData.Table.length;p++)if(null!=this.grData.Table[p].FeatureFieldName&&""!=this.grData.Table[p].FeatureFieldName.toString()&&"-200"!=this.grData.Table[p].FeatureFieldName.toString()&&(e.filter(T=>T.CostCenterColID===this.grData.Table[p].FeatureFieldName.toString()),l="",e.length>0))switch(l=e[0].SysColumnName.toString(),l){case"CaseNumber":s=this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()];break;case"CustomerID":u=this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()];break;case"CreatedBy":case"Subject":case"AssignedTo":case"ParentID":case"IsGroup":h+=l+'="'+this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]+'" ';break;case"CreatedDate":case"CreateDate":case"CloseDate":case"AssignedDate":t=N.J0.isValidDate(this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]),t&&(h+=l+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"CasePriorityLookupID":case"CaseOriginLookupID":case"CaseTypeLookupID":case"ServiceLvlLookupID":case"StatusID":case"BillingMethod":h+=l+'="'+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"account"==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()].toLowerCase()?h+=l+'="1" ':"customer"==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()].toLowerCase()&&(h+=l+'="2" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?l.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?r+=l+" ='"+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString()+"', ":d+=l+" ='"+this.ExcelTable[o][this.grData.Table[p].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()]?d+=l+" ='0', ":d+=l+" =N'"+k.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[p].FieldName.toString().Trim()])+"', "}h+=" ></Row>";let c="";c+="<XML><Row ",""!=d&&(c+=' ExtraFields ="'+d.Trim(",")+'" '),""!=r&&(c+=' CostCenterFields ="'+r+'" '),c+=" ></Row></XML>",h.replace("&","&amp;");let n,a=[];a.push(h.toString()),a.push(c.toString()),a.push(parseInt(this.Feature.SelectedValue)),a.push(s),a.push(u),a.push(this.IsUpdate),a.push(this.IsCode),a.push(this.IsUpdate),a.push(I.d.SessionManager.CompanyIndex),a.push(I.d.SessionManager.UserName),a.push(I.d.SessionManager.UserID),a.push(I.d.SessionManager.RoleID),a.push(I.d.SessionManager.LanguageID),n=I.d.document.SetImportDataToCRM(a),n<=0&&(i++,this.FailedRecourdList.push({Name:"Code : "+s+" ; Name : "+u,Message:n})),h="",this.ImportedCount="Imported :"+(o+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportFollowUps(){let e=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++)for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(e.filter(g=>g.CostCenterColID===g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),a.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),a.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let g;if(g=null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]),g)return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[n][a.FieldName.toString()]&&""!=this.ExcelTable[n][a.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][a.FieldName.toString().Trim()]))return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[n][a.FieldName.toString().Trim()]))return this.DisplayMessage=a.FieldName.toString()+" "+this.ExcelTable[n][a.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0);let i=0,l=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,s="",u="",h="",o=[],r="",d="",c=this.grData.Table;if(e.filter(n=>"-1"===n.FeatureFieldName),c.length>0&&(d=c[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(""==d)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);c=this.ExcelTable;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(""!=this.ExcelTable[n][d].toString()&&(r=this.ExcelTable[n][d].toString(),c.filter(a=>a.strPCodeColumn===r)),!o.Contains(r.toUpperCase())){for(let T=0;T<c.length;T++){h+="<Row ";for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID===this.grData.Table[m].FeatureFieldName.toString()),e.length>0))switch(s=e[0].SysColumnName.toString(),s){case"Code":u=c[T][this.grData.Table[m].FieldName.toString().Trim()],o.push(u.toUpperCase());break;case"Feedback":h+=s+' ="'+k.Dw.GetValidXml(c[T][this.grData.Table[m].FieldName.toString().Trim()]).replace("\n","~")+'" ';break;case"Date":t=N.J0.isValidDate(c[T][this.grData.Table[m].FieldName.toString().Trim()]),t&&(h+=s+'="'+t.toString("dd/MMM/yyyy hh:mm:ss tt")+'" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?h+=s+' ="'+c[T][this.grData.Table[m].FieldName.toString()+"_Key"].toString()+'" ':h+=s+' ="'+k.Dw.GetValidXml(c[T][this.grData.Table[m].FieldName.toString().Trim()])+'" '}h+="></Row>"}let a,g=[];g.push(h.toString()),g.push(""),g.push(parseInt(this.Feature.SelectedValue)),g.push(u),g.push(this.QtyCombo.SelectedValue),g.push(this.IsUpdate),g.push(this.IsCode),g.push(this.IsUpdate),g.push(I.d.SessionManager.CompanyIndex),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.RoleID),g.push(I.d.SessionManager.LanguageID),a=I.d.document.SetImportDataToCRM(g),a<=0?(i++,this.FailedRecourdList.push({Name:" Code : "+r,Message:a})):l++,h="",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCRMCustomers(e){let i=this.costCenterTableZero;if(!this.ExcelTable.includes("CustomerName")&&!this.ExcelTable.includes("CustomerCode"))return this.DisplayMessage="CustomerName/CustomerCode should present in excel",void(this.MessageVisibility=!0);if(!this.ScanCostCenterFields(!1))return;let l=0,s="",u=[],h=[];h=this.ExcelTable;let t="",o=null,r=[],d=[],c=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(c=new N.VB,c.LoadXml(this.CodeDef[0].PrefixContent.toString())),s+="<XML>";for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(null!=c&&(o=this.GetCodeData(this.ExcelTable[n],0)),this.IsCode?this.ExcelTable.includes("CustomerCode")&&""!=this.ExcelTable[n].CustomerCode.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[n].CustomerCode.toString().Trim()),h.filter(a=>a.CustomerCode===t)):this.ExcelTable.includes("CustomerName")&&""!=this.ExcelTable[n].CustomerName.toString()&&(t=k.Dw.GetValidXml(this.ExcelTable[n].CustomerName.toString().Trim()),h.filter(a=>a.CustomerName===t)),0==u.filter(a=>a.Name.toUpperCase()==t.toUpperCase()).length){r.length=0;let ae,a=!1,g=!1,p=!1,T=!1,m=!1,S=!1,F=!1,y=!1,C=!1,f="",b="",x="",R="",w="",U="",V="",_="",Z="",W=0,re=0,B="";d.length=0,s+="<Row ";for(let P=0;P<this.grData.Table.length;P++)if(null!=this.grData.Table[P].FeatureFieldName&&""!=this.grData.Table[P].FeatureFieldName.toString()&&(i.filter(K=>K.CostCenterColID==this.grData.Table[P].FeatureFieldName.toString()&&K.SysTableName!=K.Com_Contacts&&K.usercolumnname!=K.Contact_),i.length>0)){let K=i[0].SysColumnName.toString();switch(K){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][1].length>0&&(s+='StatusID ="'+this.CostCenterFieldsAllTables[1][1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(s+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":s+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(s+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":S=!0,this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][3].length>0?s+='ValuationID ="'+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+'" ':S=!1;break;case"UOMID":m=!0,U+="UOMID ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":s+='PurchaseAccount ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ',g=!0;break;case"SalesAccountID":case"SalesAccount":a=!0,s+='SalesAccount ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":y=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?U+=i[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?U+=i[0].SysColumnName.toString()+" ='2', ":U+=i[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":F=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?U+=i[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?U+=i[0].SysColumnName.toString()+" ='2', ":U+=i[0].SysColumnName.toString()+" ='0', ";break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":s+=i[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].Contains("-")){let De=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].split("-");W=De.length>0&&N.J0.Int(De[0]),W?W=parseInt(De[0]):(W=0,re=De.length>1&&N.J0.Int(De[1])),re=re?parseInt(De[1]):0}else W=N.J0.Int(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])?parseInt(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==o&&(s+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" '),this.IsCode&&u.push(ie._p.ComboBoxItems_1(k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])));break;case"CodePrefix":case"CodeNumber":null==o&&(s+=K+'="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":s+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ',b=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()],this.IsCode||u.push(ie._p.ComboBoxItems_1(b));break;case"ParentGroup":case"ParentGroupName":s+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+'" ';break;case"AccountId":case"CustomerId":"65"==this.Feature.SelectedValue.toString()&&("CustomerId"==i[0].SysColumnName.toString()?R+=" CCID='83'  CustomerName ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]+"'  ":"AccountId"==i[0].SysColumnName.toString()&&(R+=" CCID='2'   CustomerName ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]+"'  "));break;case"Group":case"isGroup":case"IsGroup":case"IsBillwise":C=!0,"true"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()?s+=i[0].SysColumnName.toString()+' ="1" ':s+=i[0].SysColumnName.toString()+' ="0" ';break;case"ParentID":"3"==this.Feature.SelectedValue&&("true"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toLowerCase()?s+='IsGroup="1" ':s+='IsGroup ="0" ');break;case"COGSAccountID":this.ExcelTable.includes(this.grData.Table[P].FieldName.toString()+"_Key")&&(U+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"', "),p=!0;break;case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[P].FieldName.toString()+"_Key")&&(U+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"', "),T=!0;break;case"Assigned_Locations":case"Assigned_Insurance":r+=this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString();break;case"Base_Name":d.push({BaseName:this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]});break;case"Base_Conversion":d.push({Conversion:this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]});break;case"Conversion_UnitName":d.push({UnitName:this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]});break;case"Conversion_UnitValue":d.push({ConversionUnit:this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]});break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[P].FieldName.toString()+"_Key")&&(_+="Product ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?""!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]||"M"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]||"2"==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])&&(_+=i[0].SysColumnName.toString()+" ='2'  "):_+=i[0].SysColumnName.toString()+" ='1'  ";break;case"ProductImage":if("3"==this.Feature.SelectedValue)try{this.grData.Table[P].FieldName.toString()}catch{w=""}break;case"SubstituteGroup":x+="GroupName ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()]+"'  ";break;default:null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0?null!=i[0].IsColumnUserDefined&&""!=i[0].IsColumnUserDefined.toString()&&(0,j.yG0)(i[0].IsColumnUserDefined.toString())?""!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()?f+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"', ":f+=i[0].SysColumnName.toString()+" ='1', ":U+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[P].FieldName.toString()+"_Key"].toString()+"', ":null!=i[0].IsColumnUserDefined&&""!=i[0].IsColumnUserDefined.toString()&&(0,j.yG0)(i[0].IsColumnUserDefined.toString())?null!=i[0].SysColumnName&&i[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(B+=i[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+"', "):i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()]?U+=i[0].SysColumnName.toString()+" ='0', ":U+=i[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[P].FieldName.toString().Trim()])+"', "}}if(null!=o&&(s+='AccountCode="'+o.Code.toString()+'" ',s+='CodePrefix="'+o.Prefix.toString()+o.Suffix.toString()+'" ',s+='CodeNumber="'+o.Number.toString()+'"'),g||(3==parseInt(this.Feature.SelectedValue)?i.filter(P=>"SysColumnName"===P.SysColumnName):i.filter(P=>"PurchaseAccount"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" =N'"+i[0].UserDefaultValue.toString()+"', ")),a||(3==parseInt(this.Feature.SelectedValue)?i.filter(P=>"SalesAccountID"===P.SysColumnName):i.filter(P=>"SalesAccount"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" =N'"+i[0].UserDefaultValue.toString()+"', ")),!S&&this.CostCenterFieldsAllTables[1].length>6&&(this.CostCenterFieldsAllTables[1][6].RowFilter="Name='DefaultProductValuation'",this.CostCenterFieldsAllTables[1][6].length>0?(this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.CostCenterFieldsAllTables[1][6][0].Value.toString()+"'",3==parseInt(this.Feature.SelectedValue)&&i.filter(P=>"ValuationID"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" ='"+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+"', ")):(i.filter(P=>"ValuationID"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', "))),p||(i.filter(P=>"COGSAccountID"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ")),T||(i.filter(P=>"ClosingStockAccountID"===P.SysColumnName),i.length>0&&(U+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ")),m||(i.filter(P=>"UOMID"===P.SysColumnName),i.length>0?U+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ":""!=this.Feature.SelectedValue&&null!=this.Feature.SelectedValue&&2!=parseInt(this.Feature.SelectedValue)&&65!=parseInt(this.Feature.SelectedValue)&&51!=parseInt(this.Feature.SelectedValue)&&(U+=" UOMID ='1', ")),!C){let P=!1;P=(0,j.yG0)(I.d.SessionManager.Preferences.On.toString()),s+=P?'IsBillwise ="1" ':' IsBillwise="0" '}if(!y&&"2"==this.Feature.SelectedValue&&(U+=" DrOptionID='0', "),!F&&"2"==this.Feature.SelectedValue&&(U+=" CrOptionID='0', "),""!=U&&(s+='ExtraFields ="'+U.substring(0,U.length-2)+'" '),null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name?Z="One-One":null!=this.Feature.SelectedItem&&"Product With Services(Many-One)"==this.Feature.SelectedItem.Name&&(Z="Many-One"),""!=Z&&(s+='LinkOption="'+Z+'"  '),""!=_&&(s+='LinkFields ="'+_.substring(0,_.length-2)+'" '),""!=x&&(s+='Substitutes ="'+x.substring(0,x.length-2)+'" '),""!=R&&(s+='CustomerName ="'+R.substring(0,R.length-2)+'" '),""!=w&&(s+='ProductImage ="'+w+'" '),""!=B&&(s+='ExtraUserDefinedFields ="'+B.substring(0,B.length-2)+'" '),""!=f&&(s+='CostCenterFields ="'+f.substring(0,f.length-2)+'" '),""!=V&&(s+='PrimaryContactQuery ="'+V.substring(0,V.length-2)+'" '),d.toString().length>0&&(d.toString().includes("Conversion=")||d.push({Conversion:"1",ProductWiseUOM:d.toString()})),""==b)continue;r.length>0&&r.Insert(0,"<XML>"),s+=" ></Row>",s+="</XML>";let he=[],E=this.ReturnMultipleAddress(h,i,e);he.push(s.toString()),he.push(r.toString()),he.push(E),he.push(parseInt(this.Feature.SelectedValue)),he.push(I.d.SessionManager.CompanyIndex),he.push(I.d.SessionManager.UserName),he.push(I.d.SessionManager.UserID),he.push(I.d.SessionManager.RoleID),he.push(I.d.SessionManager.LanguageID),ae=I.d.document.SetImportCRMCustomerData(he),ae>0&&(l++,this.FailedRecourdList.push({Name:b,Message:ae})),s="",s+="<XML>",this.ImportedCount="Imported :"+(n+1-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}toTableDistinct(e,i){const l=new Set,s=[];for(const u of e){const h=u[i];l.has(h)||(l.add(h),s.push({[i]:h}))}return s}ImportUOM(){let e=this.GetBomFieldName("FeatureFieldName=-1");if(""==e)return this.DisplayMessage="Base Name Not Exists",void(this.MessageVisibility=!0);const i=this.GetBomFieldName("FeatureFieldName=-2");if(""==i)return this.DisplayMessage="Unit Name Not Exists",void(this.MessageVisibility=!0);const l=this.GetBomFieldName("FeatureFieldName=-3");if(""==i)return this.DisplayMessage="Conversion Not Exists",void(this.MessageVisibility=!0);let s=0,u=0,h=0;const t=this.CostCenterFieldsAllTables.Tables[1];let o=[];o=this.toTableDistinct(this.ExcelTable,e),o.includes(e)||o.push(e),o.includes("BaseID")||o.push("BaseID"),o.includes("UOMID")||o.push("UOMID"),o.includes("Conversion")||o.push("Conversion"),o.includes("UOMXML")||o.push("UOMXML");for(let g=0;g<o.length;g++)t.filter(p=>p.BaseName===o[e].toString().Trim().replace("'","''")),t.length>0?(o.BaseID=t[0].BaseID,o.UOMID=t[0].UOMID,o.Conversion=t[0].Conversion):o.BaseID=-100;this.ExcelTable.includes("UOMID")||this.ExcelTable.push("UOMID");for(let g=0;g<this.ExcelTable.length;g++)t.filter(p=>p.BaseName===this.ExcelTable[g][e].toString().Trim().replace("'","''")&&p.UnitName==this.ExcelTable[g][i].toString().Trim().replace("'","''")),t.length>0&&(this.ExcelTable[g].UOMID=t[0].UOMID);let d,c,r=this.ExcelTable;for(let g=0;g<o.length;g++)if(r.filter(p=>p.BaseName===o[e].toString()),r.length>0){c=1,d="",d+="<XML>",""!=o.BaseID.toString()&&"-100"!=o.BaseID.toString()&&(d+="<Row RowNo='1'",d+=" PrimaryKey='"+o.UOMID+"'",d+=" MapAction='UPDATE'",d+=" UName='"+o[e]+"'",d+=" ConversionRate='"+o.Conversion+"' />",c=2);for(let p=0;p<r.length;p++)d+="<Row RowNo='"+(p+c)+"'",""!=r[p].UOMID.toString()?(d+=" PrimaryKey='"+r[p].UOMID.toString()+"'",d+=" MapAction='UPDATE'"):(d+=" PrimaryKey='0'",d+=" MapAction='NEW'"),d+=" UName='"+r[p][i].toString()+"'",d+=" ConversionRate='"+r[p][l].toString()+"' />";d+="</XML>",o.UOMXML=d.toString(),d.Clear()}let n=null;for(let g=0;g<o.length;g++,this.ProgressValue++)n=[],n.push(o[e].toString()),n.push(o.BaseID.toString()),n.push(o.UOMXML.toString()),n.push(!1),n.push(I.d.SessionManager.CompanyGUID),n.push(I.d.SessionManager.UserName),n.push(I.d.SessionManager.RoleID),n.push(I.d.SessionManager.LanguageID),I.d.inventory.AddUOM(n,"AddUOM").subscribe(p=>{this.DisplayMessage=p.Message,h=p.RetValue,this.MessageVisibility=!0},p=>{alert(JSON.stringify(p))}),h<0?(u++,this.FailedRecourdList.push({Name:o[e].toString(),Message:this.ErrorMessage})):s++,this.ImportedCount="Imported :"+s.toString(),this.FailedCount="Failed :"+u.toString();let a=u+s;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+a.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportMultipleStageBoms(){if(!this.ScanCostCenterFields(!0))return;let e=this.GetBomFieldName("FeatureFieldName=555026");if(""==e)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);let i=0,l=0,s=1,u=1,h=1,t=0,o=51,r=0,d="",c="",n="",a="",g="",p=0,T=0,m=0,S="",F="",y="",C="",f=0;var b=new b,x=new b;const R=this.CostCenterFieldsAllTables.Tables[0];let w=this.ExcelTable;const U=this.grData.Table;let he,V=null,_="",Z="",W="",re="",B=this.ExcelTable,ae=this.ExcelTable;for(let P=B.length-1;P>0;P--)U.length>0&&(ae.includes(B[P].ColumnName+"_Key")&&ae.Remove(B[P].ColumnName+"_Key"),ae.Remove(B[P].ColumnName)),U.filter(K=>K.FeatureFieldName<"0"&&K.FeatureFieldName==B[P].ColumnName),U.length>0&&(ae.includes(B[P].ColumnName+"_Key")&&B.Remove(B[P].ColumnName+"_Key"),B.Remove(B[P].ColumnName));for(let P=0;P<B.length;P++)he.push(B[P].ColumnName);B=this.toTableDistinct(w,he);for(let P=0;P<ae.length;P++)he.push(ae[P].ColumnName);ae=this.toTableDistinct(w,he);const Re=ae;ae.includes("StagesXML")||B.push("StagesXML"),ae.includes("BOMProductXML")||B.push("BOMProductXML"),ae.includes("BOMExpenseXML")||B.push("BOMExpenseXML"),ae.includes("BOMResourceXML")||B.push("BOMResourceXML");for(let P=0;P<B.length;P++){if(Re.filter(K=>K.BomName<B[P][e].toString().replace("'","''")),_+="<Stages>",Re.length>0)for(let K=0;K<Re.length;K++)d=this.GetFieldValue("FeatureFieldName=-11",Re[K]),_+='<Stage ID="-'+d+'" ',_+='StageNodeID="'+this.GetFieldValue("FeatureFieldName=-10",Re[K])+'" ',_+='Parent="1" ',_+='lft="'+d+'" ',_+='Depth="1" />';if(_+="</Stages>",B[P].StagesXML=_.toString(),_="",w.filter(K=>K.BomName<B[P][e].toString().replace("'","''")),w.length>0){Z+="<BOMProductXML>",W+="<BOMExpenseXML>",re+="<BOMResourceXML>";for(let K=0;K<w.length;K++)C=this.GetFieldValue("FeatureFieldName=-9",w[K]).toUpperCase(),"IP"==C||"OP"==C?(Z+="<Row ",Z+=" BOMProductID='0'",Z+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",w[K])+"'",Z+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",w[K])+"'",p=parseFloat(this.GetFieldValue("FeatureFieldName=-2",w[K])),Z+=" Quantity='"+p+"'",Z+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",w[K])+"'",T=parseFloat(this.GetFieldValue("FeatureFieldName=-4",w[K])),Z+=" UnitPrice='"+T+"'","IP"==C?(Z+=" ProductUse='1'",Z+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",w[K])+"'",d=this.GetFieldValue("FeatureFieldName=-7",w[K]).toUpperCase(),Z+="NO"==d||""==d||"0"==d?" IncInStageCost='0'":" IncInStageCost='1'",d=this.GetFieldValue("FeatureFieldName=-8",w[K]).toUpperCase(),Z+="NO"==d||""==d||"0"==d?" IncInFinalCost='0'":" IncInFinalCost='1'"):"OP"==C&&(Z+=" ProductUse='2'"),m=parseFloat(this.GetFieldValue("FeatureFieldName=-5",w[K])),m>0||(m=p*T),Z+=" Value='"+m+"'/>"):"EXPENSES"==C?(W+="<Row ",W+=" ExpenseID='0'",W+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",w[K])+"'",W+=" Name='"+this.GetFieldValue("FeatureFieldName=-12",w[K])+"'",W+=" ResourceID='1'",W+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-13",w[K])+"'",W+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-14",w[K])+"'",d=this.GetFieldValue("FeatureFieldName=-7",w[K]).toUpperCase(),W+="NO"==d||""==d||"0"==d?" IncInStageCost='0'":" IncInStageCost='1'",d=this.GetFieldValue("FeatureFieldName=-8",w[K]).toUpperCase(),W+="NO"==d||""==d||"0"==d?" IncInFinalCost='0'":" IncInFinalCost='1'",W+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",w[K])+"'/>"):"MACHINES"==C&&(re+="<Row ",re+=" BOMResourceID='0'",re+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",w[K])+"'",re+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-15",w[K])+"'",re+=" Hours='"+this.GetFieldValue("FeatureFieldName=-16",w[K])+"'",re+=" Options='"+this.GetFieldValue("FeatureFieldName=-17",w[K])+"'",re+=" MachineDim1='"+this.GetFieldValue("FeatureFieldName=-18",w[K])+"'",re+=" MachineDim2='"+this.GetFieldValue("FeatureFieldName=-19",w[K])+"'",d=this.GetFieldValue("FeatureFieldName=-7",w[K]).toUpperCase(),re+="NO"==d||""==d||"0"==d?" IncInStageCost='0'":" IncInStageCost='1'",d=this.GetFieldValue("FeatureFieldName=-8",w[K]).toUpperCase(),re+="NO"==d||""==d||"0"==d?" IncInFinalCost='0'":" IncInFinalCost='1'",re+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",w[K])+"'/>");Z+="</BOMProductXML>",B[P].BOMProductXML=Z.toString(),Z="",W+="</BOMExpenseXML>",B[P].BOMExpenseXML=W.toString(),W="",re+="</BOMResourceXML>",B[P].BOMResourceXML=re.toString(),re=""}}for(let P=0;P<B.length;P++,this.ProgressValue++){s=1,u=1,h=1,t=0,o=51,r=0,c="",n="",a="",g="",S="",F="",y="",b=new b;for(let K=0;K<this.grData.Table.length;K++)if(null!=this.grData.Table[K].FeatureFieldName&&""!=this.grData.Table[K].FeatureFieldName.toString()&&!this.grData.Table[K].FeatureFieldName.toString().startsWith("-")&&(w.filter(De=>De.CostCenterColID===this.grData.Table[K].FeatureFieldName.toString()),R.length>0))switch(R[0].SysColumnName.toString()){case"BOMCode":c=B[P][this.grData.Table[K].FieldName.toString()];break;case"BOMName":n=B[P][this.grData.Table[K].FieldName.toString()];break;case"Date":b=N.J0.isValidDate(B[P][this.grData.Table[K].FieldName.toString().Trim()]);break;case"ProductID":r=parseInt(B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Packing":y=B[P][this.grData.Table[K].FieldName.toString()];break;case"UOMID":t=parseInt(B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"FPQty":g=B[P][this.grData.Table[K].FieldName.toString()];break;case"LocationID":u=parseInt(B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"DivisionID":h=parseInt(B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Group":s=parseInt(B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString());break;case"Description":a=B[P][this.grData.Table[K].FieldName.toString()];break;case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+B[P][this.grData.Table[K].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(o=parseInt(this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()));break;default:null!=R[0].ColumnCostCenterID&&""!=R[0].ColumnCostCenterID.toString()&&parseInt(R[0].ColumnCostCenterID.toString())>0?44==parseInt(R[0].ColumnCostCenterID.toString())?R[0].SysColumnName.toString().Contains("Alpha")&&(S+=R[0].SysColumnName.toString()+" ='"+B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', "):R[0].SysColumnName.toString().Contains("Alpha")?S+=R[0].SysColumnName.toString()+" ='"+B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', ":null!=R[0].IsColumnUserDefined&&""!=R[0].IsColumnUserDefined.toString()&&(0,j.yG0)(R[0].IsColumnUserDefined.toString())&&(ae.includes(this.grData.Table[K].FieldName.toString()+"_Key")&&""!=B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString()&&"0"!=B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString()?F+=R[0].SysColumnName.toString()+" ='"+B[P][this.grData.Table[K].FieldName.toString()+"_Key"].toString()+"', ":F+=R[0].SysColumnName.toString()+" ='1', "):null!=R[0].SysColumnName&&R[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(R.Table.Columns.Contains("UserColumnType")&&R[0].UserColumnType.toString().toLowerCase().Contains("date")||R[0].ColumnDataType&&R[0].ColumnDataType.toString().toLowerCase().Contains("date")?(x=new b,(x=""==B[P][this.grData.Table[K].FieldName.toString().Trim()]||N.J0.isValidDate(B[P][this.grData.Table[K].FieldName.toString().Trim()]))&&(S+=R[0].SysColumnName.toString()+" ='"+x.Date.toLocaleDateString("dd/MMM/yyyy")+"', ")):S+=R[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(B[P][this.grData.Table[K].FieldName.toString().Trim()].replace("'","''"))+"', ")}V=new Rt.b,V.BOMID=0,V.Code=c,V.Name=n,V.Date=b,V.ProductID=r,V.Packing=y,V.UOMID=t,V.FPQty=parseFloat(g),V.FPQty<=0&&(V.FPQty=1),V.LocationID=u,V.DivisionID=h,V.group=!1,V.selectednodeid=s,V.Desc=a,V.StatusID=o,V.StageXML=B[P].StagesXML.toString(),V.BOMProductXML=B[P].BOMProductXML.toString(),V.BOMExpenseXML=B[P].BOMExpenseXML.toString(),V.BOMResourceXML=B[P].BOMResourceXML.toString(),V.CustomFieldsQuery=S,V.CustomCCQuery=F,V.WID=0,f=this.DisplayMessage=V.AddMultiStageBOM(),f<0?(l++,this.FailedRecourdList.push({Name:n,Message:this.ErrorMessage})):i++,this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+(l+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportBoms(){if(!this.ScanCostCenterFields(!0))return;let e=0,i=0,s=this.ExcelTable,u="",h="",t=this.GetBomFieldName("FeatureFieldName=555026"),o="",r="",d="";if(""==t)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);s.sort((a,g)=>a.BomName.localeCompare(g.BomName)),o+="<BOMProductXML>",r+="<BOMExpenseXML>",d+="<BOMResourceXML>";for(let a=0;a<s.length;a++,this.ProgressValue++)u=h,h=s[a][t].toString(),u!=h&&a>0&&(o+="</BOMProductXML>",r+="</BOMExpenseXML>",d+="</BOMResourceXML>",this.SaveBom(s[a-1],o.toString(),r.toString(),d.toString())<0?(i++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString(),o="",r="",d="",o+="<BOMProductXML>",r+="<BOMExpenseXML>",d+="<BOMResourceXML>"),""!=this.GetFieldValue("FeatureFieldName=-1",s[a])?(o+="<Row ",o+=" BOMProductID='0'",o+=" ProductUse='1'",o+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",s[a])+"'",o+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",s[a])+"'",o+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",s[a])+"'",o+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",s[a])+"'",o+=" Action='New'",o+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",s[a])+"'",o+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",s[a])+"'/>"):""!=this.GetFieldValue("FeatureFieldName=-12",s[a])&&(o+="<Row ",o+=" BOMProductID='0'",o+=" ProductUse='2'",o+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-12",s[a])+"'",o+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",s[a])+"'",o+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",s[a])+"'",o+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",s[a])+"'",o+=" Action='New'",o+=" Value='"+this.GetFieldValue("FeatureFieldName=-6",s[a])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-7",s[a])&&(r+="<Row ",r+=" ExpenseID='0'",r+=" ResourceID='1'",r+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-7",s[a])+"'",""!=this.GetFieldValue("FeatureFieldName=-15",s[a])&&(r+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-15",s[a])+"'"),r+=" Action='New'",r+=" Value='"+this.GetFieldValue("FeatureFieldName=-8",s[a])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-9",s[a])&&(d+="<Row ",d+=" BOMResourceID='0'",d+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-9",s[a])+"'",d+=" Hours='"+this.GetFieldValue("FeatureFieldName=-10",s[a])+"'",d+=" Action='New'",d+=" Value='"+this.GetFieldValue("FeatureFieldName=-11",s[a])+"'/>");o+="</BOMProductXML>",r+="</BOMExpenseXML>",d+="</BOMResourceXML>",this.SaveBom(s[s.length-1],o.toString(),r.toString(),d.toString())<0?(i++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed ( Total :"+(i+e).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SaveBom(e,i,l,s){let u,h=new Rt.b;return h.BOMID=0,h.Code=this.GetFieldValue("FeatureFieldName=555025",e),h.Name=this.GetFieldValue("FeatureFieldName=555026",e),""!=this.GetFieldValue("FeatureFieldName=23902",e)&&(h.Date=new Date(this.GetFieldValue("FeatureFieldName=23902",e))),h.ProductID=parseInt(this.GetFieldValue("FeatureFieldName=23899",e)),""!=this.GetFieldValue("FeatureFieldName=23900",e)&&(h.LocationID=parseInt(this.GetFieldValue("FeatureFieldName=23900",e))),""!=this.GetFieldValue("FeatureFieldName=23901",e)&&(h.DivisionID=parseInt(this.GetFieldValue("FeatureFieldName=23901",e))),h.group=!1,h.selectednodeid=0,h.Desc=this.GetFieldValue("FeatureFieldName=23903",e),h.StatusID=51,h.BOMProductXML=i,h.BOMExpenseXML=l,h.BOMResourceXML=s,h.CustomFieldsQuery="",h.CustomCCQuery="",u=h.AddBOM(""),u}GetBomFieldName(e){let i="";const l=this.grData.Table,s=this.CostCenterFieldsAllTables.Tables[0],[u,h]=e.split("=");return l.filter(t=>t[u.trim()]?.toString()===h.trim()),l.length>0&&(s.filter(t=>t.CostCenterColID===l[0][1].toString()),i=s.length>0&&""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID.toString())>0?l[0][0].toString()+"_Key":l[0][0].toString()),i}GetFieldValue(e,i){let l=this.GetBomFieldName(e);return i.includes(l)?i[l].toString().Trim():""}ReadStructure(e,i){const l=new DOMParser,s=l.parseFromString(e,"application/xml");if(s){const u=s.childNodes[0];this.Feature.SelectedValue=u.attributes[0].value,this.Feature.SetSelectedItem_2(u.attributes[1].value,u.attributes[0].value),this._FeatureSelectedValue=this.Feature.SelectedItem.Aliasname,i&&this.OnSelectionChanged(null),this.IsDuplicateNameAllowed=u.attributes.length>2&&"1"===u.attributes[2].value&&"IsDuplicate"===u.attributes[2].name,this.IsAutoCodeGen=u.attributes.length>3&&"1"===u.attributes[3].value&&"IsCodeAutoGen"===u.attributes[3].name,this.IsUpdate=u.attributes.length>4&&"1"===u.attributes[4].value&&"IsUpdate"===u.attributes[4].name,this.IsCode=u.attributes.length>5&&"1"===u.attributes[5].value&&"IsCodeBase"===u.attributes[5].name,this.IsProductwiseBarcode=u.attributes.length>6&&"1"===u.attributes[6].value&&"IsProductwiseBarcode"===u.attributes[6].name,this.BulkSave=u.attributes.length>7&&"1"===u.attributes[7].value&&"IsBulkSave"===u.attributes[7].name,null!==u.getAttribute("ValidateBeforeImport")&&(this.ValidateBeforeImport="1"===u.getAttribute("ValidateBeforeImport")),null!==u.getAttribute("UpdateStatusInExcel")&&(this.UpdateStatusInExcel="1"===u.getAttribute("UpdateStatusInExcel")),null!==u.getAttribute("AppendData")&&(this.AppendData="1"===u.getAttribute("AppendData")),null!==u.getAttribute("FillLocalReference")&&(this.FillLocalReference="1"===u.getAttribute("FillLocalReference")),Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4&&this.QtyRateVisible&&(null!==u.getAttribute("IsQtyChecked")&&(this.IsQtyChecked="true"===u.getAttribute("IsQtyChecked")),null!==u.getAttribute("QtyText")&&(this.QtyText.Text=u.getAttribute("QtyText")),null!==u.getAttribute("QtyCombo")&&(this.QtyCombo.SelectedValue=u.getAttribute("QtyCombo")),null!==u.getAttribute("IsRateChecked")&&(this.IsRateChecked="true"===u.getAttribute("IsRateChecked")),null!==u.getAttribute("RateText")&&(this.RateText.Text=u.getAttribute("RateText")),null!==u.getAttribute("RateCombo")&&(this.RateCombo.SelectedValue=u.getAttribute("RateCombo"))),null!==u.getAttribute("DoNotCreateCostCenter")&&(this.DoNotCreateCostCenter="1"===u.getAttribute("DoNotCreateCostCenter")),(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4||93===Number(this.Feature.SelectedValue))&&this.LoadDocItems();for(let h=1;h<u.childNodes.length;h++){const t=u.childNodes[h];if(t.nodeName)for(let o=0;o<this.grData.Table.length;o++)""!==t.nodeName&&"Localref"!==t.nodeName&&(o+1).toString()===t.attributes[0].value&&(this.grData.Table[o].FeatureFieldName=t.attributes[2].value.toString())}this.grData.RefreshColumns();for(let h=0;h<u.childNodes.length;h++){const t=u.childNodes[h];if("Localref"===t.nodeName){const r=l.parseFromString(t.outerHTML,"application/xml").childNodes[0];for(let d=0;d<r.childNodes.length;d++){const c=r.childNodes[d];for(let n=0;n<this.DocItems.Items.length;n++)this.DocItems.Items[n].Value===c.attributes[2].value&&(this.DocItems.Items[n].IsChecked=!0)}}}this.grData.RefreshColumns()}}LoadDocItems(){let e=I.d.report.GetDataTable("IMP004",String(this.Feature.SelectedValue),I.d.SessionManager.LanguageID);if(null!=e&&e[0].length>0&&0==this.DocItems.Items.length)for(let i=0;i<e[0].length;i++)this.DocItems.Items.push(ie.oN.CheckedListBoxItem_2(e[0][i].ResourceData.toString(),e[0][i].CostCenterColID.toString()))}OnSave(e){var i=this;return(0,Ie.A)(function*(){if(e.toString().Contains("Save")){let s="";if(i.grData.Table.length>0)if(N.J0.IsEmpty(i.Feature.SelectedValue)||"70"!=i.Feature.SelectedValue.toString()){s+='<XML Parent="'+i.Feature.SelectedValue+'" ParentName="'+N.J0.EncodeXML(i.Feature.SelectedItem.Name)+'"',s+=' IsDuplicate="'+(0,j.yG0)(i.IsDuplicateNameAllowed)+'" ',s+=' IsCodeAutoGen="'+(0,j.yG0)(i.IsAutoCodeGen)+'" ',s+=' IsUpdate="'+(0,j.yG0)(i.IsUpdate)+'" ',s+=' IsCodeBase="'+(0,j.yG0)(i.IsCode)+'"  ',s+=' IsProductwiseBarcode="'+(0,j.yG0)(i.IsProductwiseBarcode)+'" ',s+=' IsBulkSave="'+(0,j.yG0)(i.BulkSave)+'"   ',s+=' ValidateBeforeImport="'+(0,j.yG0)(i.ValidateBeforeImport)+'" ',s+=' UpdateStatusInExcel="'+(0,j.yG0)(i.UpdateStatusInExcel)+'" ',s+=' AppendData="'+(0,j.yG0)(i.AppendData)+'" ',s+=' FillLocalReference="'+(0,j.yG0)(i.FillLocalReference)+'" ',parseInt(i.Feature.SelectedValue)>4e4&&parseInt(i.Feature.SelectedValue)<=5e4&&i.QtyRateVisible&&(s+=' IsQtyChecked="'+i.IsQtyChecked+'" ',s+=' QtyText="'+i.QtyText.Text+'" ',s+=' QtyCombo="'+i.QtyCombo.SelectedValue+'" ',s+=' IsRateChecked="'+i.IsRateChecked+'" ',s+=' RateText="'+i.RateText.Text+'" ',s+=' RateCombo="'+i.RateCombo.SelectedValue+'" '),s+=' DoNotCreateCostCenter="'+(0,j.yG0)(i.DoNotCreateCostCenter)+'" ',s+=" > ";for(let u=0;u<i.grData.Table.length;u++)""!=i.grData.Table[u].FeatureFieldName&&null!=i.grData.Table[u].FeatureFieldName&&null!=i.grData.Table[u].FeatureFieldName&&(s+="<Row   ",s+=' RowNo="'+(u+1)+'"',s+=' FieldName="'+i.grData.Table[u].FieldName.toString()+'"',s+=' FeatureFieldName="'+N.J0.EncodeXML(i.grData.Table[u].FeatureFieldName.toString())+'"',s+="/>");if(i.DocItems.Items.length>0&&parseInt(i.Feature.SelectedValue)>4e4&&parseInt(i.Feature.SelectedValue)<=5e4||93==parseInt(i.Feature.SelectedValue)){let u=0;s+="<Localref>";for(let h=0;h<i.DocItems.Items.length;h++)i.DocItems.Items[h].IsChecked&&(u++,s+='<Row RowNo="'+u+'" ResData="'+i.DocItems.Items[h].Name+'" ColID="'+i.DocItems.Items[h].Value+'" />');s+="</Localref>"}if(s+="</XML>","SaveProfile"==e.toString()){if(null==i.ProfileName.Text||""==i.ProfileName.Text)return i.DisplayMessage="Enter Profile name",void(i.MessageVisibility=!0);{let u,h;h=I.d.document.SaveImportDetails(i.ProfileID,i.ProfileName.Text,i.ActualFileName,s.toString(),!1),i.DisplayMessage=h?.Message,u=h?.RetValue,i.MessageVisibility=!0,u>0&&(i.ProfileID=u)}}else if("SaveRim"==e.toString()){const u=s.toString?s.toString():s,h=new Blob([u],{type:"text/plain;charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(h),t.download="export.rim";try{console.log("ImportUtilityViewModel::Entering SaveFile"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href),i.DisplayMessage="Saved file successfully",i.MessageVisibility=!0,console.log("ImportUtilityViewModel::Exiting SaveFile")}catch(o){i.DisplayMessage="Error in Exporting",i.MessageVisibility=!0,console.error("ImportUtilityViewModel::Error SaveFile",o)}}}else{if(!(i.BankAccounts.SelectedValue>0))return i.DisplayMessage=I.d.GetResource("SelectBankAccount"),void(i.MessageVisibility=!0);s+='<XML Parent="'+i.Feature.SelectedValue+'" ParentName="'+i.Feature.SelectedItem.Name+'"',s+=' IsDuplicate="'+(0,j.yG0)(i.IsDuplicateNameAllowed)+'" ',s+=' IsCodeAutoGen="'+(0,j.yG0)(i.IsAutoCodeGen)+'" ',s+=' IsUpdate="'+(0,j.yG0)(i.IsUpdate)+'" ',s+=' IsCodeBase="'+(0,j.yG0)(i.IsCode)+'"   ',s+=' IsProductwiseBarcode="'+(0,j.yG0)(i.IsProductwiseBarcode)+'" ',s+=' IsBulkSave="'+(0,j.yG0)(i.BulkSave)+'" ',s+=' ValidateBeforeImport="'+(0,j.yG0)(i.ValidateBeforeImport)+'" ',s+=' UpdateStatusInExcel="'+(0,j.yG0)(i.UpdateStatusInExcel)+'" ',s+=' AppendData="'+(0,j.yG0)(i.AppendData)+'" ',s+=' FillLocalReference="'+(0,j.yG0)(i.FillLocalReference)+'" ',s+=" > ",s+="<Row   ";for(let h=0;h<i.grData.Table.length;h++)if(""!=i.grData.Table[h].FeatureFieldName.toString()&&null!=i.grData.Table[h].FeatureFieldName){const t=i.ImportCols[1].ComboData.Table.Rows;for(const o of t)i.grData.Table[h].FeatureFieldName.toString()==o.CostCenterColID.toString()&&(s+=o.SysColumnName.toString()+'="'+i.grData.Table[h].FieldName.toString()+'" ')}s+="/>",s+="</XML>",i.DisplayMessage=I.d.document.SaveBRSDetails(s.toString(),i.BankAccounts.SelectedValue),i.MessageVisibility=!0}}else if("Open"==e.toString()){console.log("ImportUtilityViewModel::Entering OpenFile");const s=document.createElement("input");s.type="file",s.accept=".rim",s.onchange=function(){var u=(0,Ie.A)(function*(h){const t=h.target;if(!t.files||0===t.files.length)return;const o=t.files[0];try{const r=yield o.text();i.ReadStructure(r,!1),i.grData.RefreshColumns(),i.grData.RefreshGrid=!0,console.log("FromOpen",i.grData.Table)}catch(r){console.error("ImportUtilityViewModel::Error OpenFile",r)}finally{document.body.removeChild(s)}});return function(h){return u.apply(this,arguments)}}(),document.body.appendChild(s),s.click(),console.log("",i.grData.Table)}else if("Define"==e.toString()){if(i.LoadDocItems(),i.DocItems.Items.length>0)var l=new Ht.o;l.PactListBoxViewModel_1(i.DocItems.Items,I.d.GetResource("DDesigner_LRef")),I.d.page.ShowDialog(l,Wt.f,{ShowCenter:!0,Title:I.d.GetResource("DDesigner_LRef")})}else if("Preview"==e.toString())try{if(parseInt(i.Feature.SelectedValue.toString())>4e4&&parseInt(i.Feature.SelectedValue.toString())<5e4?i.ScanDocument(!1,!1,0,!1):i.IsScaned||i.ScanCostCenterFields(!1),i.IsScaned&&i.CCQuery.length>0)for(let u of i.CCQueryData.Items)if(""!=u.Value&&i.grData.Table.filter(t=>t.FieldName==t.Name).length>0){let t=new Ae.AddNoteViewModel;t.NoteID=0,u.Value.split(",");let r=i.grData.Table.filter(d=>d.FieldName==d.Name&&"-16"==d.FeatureFieldName);if(r.length>0)t.Note.Text="New Group("+u.Name+") will be created ";else if(r=i.grData.Table.filter(d=>d.FieldName==d.Name),r.length>0){const d=i.CostCenterFieldsAllTables.Tables[0];d.filter(c=>c.CostCenterColID===r[0].FeatureFieldName.toString()),d.length>0&&(t.Note.Text="New Dimension, "+d[0].UserColumnName.toString()+" ("+u.Name+") will be created ")}else t.Note.Text="New Dimension,  "+u.Name+" will be created ";t.Note.ToolTipDescription=u.Value,t.Note.Label=u.Name,i.NotesList.push(t)}if(i.ExcelTable.length>0){if(0==i.NotesList.length&&0==i.ErrorList.length&&0==i.RulesList.length&&("2"==i.Feature.SelectedValue||"3"==i.Feature.SelectedValue||parseInt(i.Feature.SelectedValue)>5e4&&parseInt(i.Feature.SelectedValue)<=50075))i.IsPreviewDataOk=!0;else{let u=i.ExcelTable,h=new Yt;h.PreviewDataViewModel(u,i),yield I.d.page.openDialog(h,pi,{ShowCenter:!0,Title:""}),console.log("afterClosePopup")}i.IsScaned||(null!=i.dsexcel&&(i.dsexcel=[]),i.ExcelTable=i.dsexcel[0])}}catch(s){Logger.ErrorLog("ImportUtilityViewModel::Error OpenFile",s.message)}else if("ExportFailedRecords"==e.toString()){const s=d=>null==d?"":String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),u=[];u.push("<html><body style='color:blac;background-color:white;'>"),u.push("<style>"),u.push(".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt}"),u.push(".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}"),u.push("</style>"),u.push("<table border=1 width='450' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >"),u.push("<tr>"),u.push("<tr><td class='hdr'><b>Sno<b></td>"),u.push("<td class='hdr' width='150'><b>Failed Records<b></td>"),u.push("<td class='hdr' width='250'><b>Message<b></td></tr>"),u.push("</tr>");for(let d=0;d<i.FailedRecourdList.length;d++){const c=i.FailedRecourdList[d]||{Name:"",Message:""};u.push(`<tr${d%2==1?"class='alt'":""}>`),u.push(`<td align='left' >${d+1} </td>`),u.push(`<td align='left' > ${s(c.Name)}</td>`),u.push(`<td align='left' >${s(c.Message)}</td>`),u.push("</tr>")}u.push("</table>"),u.push("</body></html>");const h=u.join(""),t=new Blob([h],{type:"applicaton/vnd.ms-excel"}),o=document.createElement("a"),r=URL.createObjectURL(t);o.setAttribute("href",r),o.setAttribute("download","ExportedRecords.xls"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}else if("Verify"==e.toString()){if(0==i.SavedIDs.length)return void(i.DisplayMessage="No records saved");let s,u,h=0,t="";t+="<PactRevenURpts>\n                < ID />\n                <Name>Import </Name>\n                < PactRevenURptDef >\n                <Name>Import </Name>\n                < ArabicName > Report </ArabicName>\n                < TotalColumns > 3 </TotalColumns>\n                < TotalGroups > 0 </TotalGroups>\n                < GridLines > 3 </GridLines>\n                < VAlign > Bottom </VAlign>\n                < Columns >\n                <HeaderHeight>30 </HeaderHeight>\n                < RowHeight > 22 </RowHeight>\n                < SubRowHeight > 22 </SubRowHeight>";for(let d of i.grData.Table)s=i.CostCenterFieldsAllTables.Tables[0].filter(c=>c.CostCenterColID==d[1].toString()),u=s[0],t+='<ColumnDef><Identity><ID>C" + colCnt + @"</ID>\n                    < Sequence > " + colCnt + @" </Sequence>\n                    < Caption > " + row[0].toString() + @" </Caption>\n                    < Category > 103 </Category>\n                    < Field > 26445 </Field>\n                    < SelectedField > 25543 </SelectedField>\n                ',"DATE"==u.ColumnDataType.toString()?t+="<Type>STRING</Type>":"FLOAT"==u.ColumnDataType.toString()?t+="<Type>FLOAT</Type>":t+="<Type>STRING</Type>",t+="</Identity>\n                    < Width > 120 </Width>\n                    < HeaderAppearance >\n                    <Alignment>Center </Alignment>\n                    < Font > Calibri </Font>\n                    < FontSize > 12 </FontSize>\n                    < FontBold > True </FontBold>\n                    </HeaderAppearance>\n                    < DataAppearance > ","FLOAT"==u.ColumnDataType.toString()&&(t+="<Alignment>Right</Alignment>"),t+="<Alignment>Left</Alignment>",t+="<Font>Calibri</Font>\n                    < FontSize > 13 </FontSize>\n                    </DataAppearance>","DATE"==u.ColumnDataType.toString()?t+="<Format><DateType>dd/MMM/yyyy</DateType></Format>":"FLOAT"==u.ColumnDataType.toString()?t+="<Format>\n                        < Decimals > -1 </Decimals>\n                        < Commas > -1 </Commas>\n                        </Format>":t+="<Format></Format>",t+="</ColumnDef>",h++;t+="</Columns>\n                < Groups > </Groups>\n                < ReportTotal >\n                <Identity>\n                <ID></ID>\n                < Prefix > REPORT TOTAL </Prefix>\n                    < ShowCaption > 1 </ShowCaption>\n                    < Level > 0 </Level>\n                    </Identity>\n                    < Appearance >\n                    <ShowUnder></ShowUnder>\n                    < Width > -1 </Width>\n                    < Height > 22 </Height>\n                    < Border > 0 </Border>\n                    < Visibility > 0 </Visibility>\n                    < Font > Calibri </Font>\n                    < Alignment > Left </Alignment>\n                    < FontSize > 14 </FontSize>\n                    < FontBold > True </FontBold>\n                    </Appearance>\n                    < Format >\n                    <Decimals>2 </Decimals>\n                    < Commas > 1 </Commas>\n                    </Format>\n                    < Columns >\n                    </Columns>\n                    </ReportTotal>\n\n                    </PactRevenURptDef>\n                    < Filters >\n                    <PreDataFetch>\n                    <TreeFilter></TreeFilter>\n                    < FieldFilter > </FieldFilter>\n                    </PreDataFetch>\n                    < PostDataFetch > </PostDataFetch>\n                    </Filters>\n                    </PactRevenURpts>";let o=[];o.push("ReportName"),o.push("ReportTypeID"),o.push("ReportID"),o.push("ReportTypeName"),o.push("IsUserDefined"),o.push("ReportDefnXML"),o.push("StaticReportType"),o.push("DefaultPreferences"),o.push("CustomPreferences"),o.push("TreeXML"),o.push("ReportBody"),o.push("ReportHeader"),o.push("PageHeader"),o.push("PageFooter"),o.push("ReportFooter"),o.push("RowColumnReportsMap"),o.push("KPIXML"),o.push("QUERY"),o.push("MatrixXML"),o.push("FormulaFields");let r={ReportID:0,ReportName:"Import",ReportTypeID:0,ReportTypeName:"Grid",IsUserDefined:1};r.ReportDefnXML=t.toString(),r.StaticReportType=0,r.DefaultPreferences="",r.CustomPreferences="<XML><HideCostCenterTree>1</HideCostCenterTree><HidePrefetch>1</HidePrefetch></XML>",r.TreeXML="",r.ReportBody="",r.ReportHeader="",r.PageHeader="",r.PageFooter="",r.ReportFooter="",r.FormulaFields="",r.QUERY=i.setQuery(),r.MatrixXML="",o.push(r)}else"Validate"==e.toString()&&(i.IsSaveDocValidate=!0,i.ImportingMessage="Validating Data Please Wait....",i.ImportDataClick())})()}ScanCostCenterFields(e){if(this.IsScaned)return!0;this.NotesList=[],this.Previewinfo="";let c,T,i=null,l=null,s=null,h=!1,t=!1,o=!1,r=!1,p="";Logger.InfoLog("ImportCosCenters --\x3eEntering ScanCostCenterFields reading excel data for filling id of Account/Product/Dimensions"),3==parseInt(this.Feature.SelectedValue)?(T=this.CostCenterFieldsAllTables.Tables[8].filter(S=>"NameSameasCode"==S.Name),T.length>0&&(this.NameSameasCode=(0,j.yG0)(T[0].Value))):parseInt(this.Feature.SelectedValue)>5e4&&(T=this.CostCenterFieldsAllTables.Tables[6].filter(S=>"NameSameasCode"==S.Name),T.length>0&&(this.NameSameasCode=(0,j.yG0)(T[0].Value)));for(let S=0;S<this.ExcelTable.length;S++)for(let F of this.grData.Table){let y=this.ExcelDataColumn.indexOf(F.FieldName);const C=F.FeatureFieldName;if(null!=C&&""!=C.toString()&&"0"!=C.toString()&&(i=this.CostCenterFieldsAllTables.Tables[0].filter(f=>f.CostCenterColID==C.toString()),i.length>0)){if(i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_FromDate")&&i[0].CostCenterColID.toString().endsWith("000")||i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_ToDate")&&i[0].CostCenterColID.toString().endsWith("001")||i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_Remarks")&&i[0].CostCenterColID.toString().endsWith("002"))continue;if("AccountName"==i[0].SysColumnName.toString()&&"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==i[0].SysColumnName.toString()||"BOMName"==i[0].SysColumnName.toString()||"Name"==i[0].SysColumnName.toString()||"FirstName"==i[0].SysColumnName.toString()||"Company"==i[0].SysColumnName.toString()||"CaseNumber"==i[0].SysColumnName.toString()||"ProductName"==i[0].SysColumnName.toString()||"BaseName"==i[0].SysColumnName.toString()||"BatchNumber"==i[0].SysColumnName.toString()||"ProfileName"==i[0].SysColumnName.toString())h=!0;else if("IsBillwise"==i[0].SysColumnName.toString()||"IsGroup"==i[0].SysColumnName.toString()){if("IsBillwise"==i[0].SysColumnName.toString()&&(o=!0),"yes"!=this.ExcelTable[S][y].toLowerCase()&&"no"!=this.ExcelTable[S][y].toLowerCase()&&!(0,j.yG0)(this.ExcelTable[S][y])){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage=o?"Incorrect Billwise information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", expected Yes/No]":"Incorrect Group information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", expected Yes/No] at Excel ColumnName "+this.ExcelTable[F.FieldName.toString()],this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(f);let b=new Ae.AddNoteViewModel;b.NoteID=0;let x=String(S+1),R=this.ExcelTable[S][y];b.Note.Text=o?`Incorrect Billwise information at Row  ${x}, ${R}, expected Yes/No`:`Incorrect Group information at Row " ${x}, ${R},expected Yes/No] at Excel ColumnName  ${R}`,this.ErrorList.push(b)}}}else if("UOMID"==i[0].SysColumnName.toString()||"unit"==i[0].SysColumnName.toString().toLowerCase()||"PurchaseUOM"==i[0].SysColumnName.toString()){let f=this.ExcelDataColumn[y]+"_Key";if(this.ExcelDataColumn.includes(f)||(this.ExcelDataColumn.push(f),this.temp.includes(parseInt(i[0].ColumnCostCenterID.toString()))||this.temp.push(parseInt(i[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[S][y]){let b;c=4,s=l=null,e?(c=2,""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0?(s=this.CostCenterFieldsAllTables.Tables[0].filter(x=>"ProductID"==x.SysColumnName&&x.CostCenterColID>0),s.length>0&&(l=this.grData.Table.filter(x=>x.FeatureFieldName==s[0].CostCenterColID.toString()))):(l=this.grData.Table.filter(x=>"-1"==x.FeatureFieldName),0==l.length&&(l=this.grData.Table.filter(x=>"-12"==x.FeatureFieldName))),l.length>0&&(b=this.CostCenterFieldsAllTables.Tables[c].filter(this.IsCode?x=>x.UnitName==this.ExcelTable[S][y]&&x.ProductCode==this.ExcelTable[S][this.ExcelDataColumn.indexOf(l[0].FieldName.toString().Trim())]:x=>x.UnitName==this.ExcelTable[S][y]&&x.ProductName==this.ExcelTable[S][this.ExcelDataColumn.indexOf(l[0].FieldName.toString().Trim())])),0==b.length&&(b=this.CostCenterFieldsAllTables.Tables[c].filter(x=>x.UnitName==this.ExcelTable[S][y]&&null!==x.ProductName&&"DynamicSet"==x.ProductName))):(""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0&&(s=this.CostCenterFieldsAllTables.Tables[0].filter(this.IsCode?x=>"ProductCode"==x.SysColumnName&&x.CostCenterColID>0:x=>"ProductName"==x.SysColumnName&&x.CostCenterColID>0),s.length>0&&(l=this.grData.Table.filter(x=>x.FeatureFieldName==s[0].CostCenterColID.toString()))),l.length>0?(b=this.CostCenterFieldsAllTables.Tables[c].filter(this.IsCode?x=>x.UnitName==this.ExcelTable[S][y]&&x.ProductCode==this.ExcelTable[S][this.ExcelDataColumn.indexOf(l[0].FieldName.toString().Trim())]:x=>x.UnitName==this.ExcelTable[S][y]&&x.ProductName==this.ExcelTable[S][this.ExcelDataColumn.indexOf(l[0].FieldName.toString().Trim())]),0==b.length&&(b=this.CostCenterFieldsAllTables.Tables[c].filter(x=>x.UnitName==this.ExcelTable[S][y].replace("'","''")))):b=this.CostCenterFieldsAllTables.Tables[c].filter(x=>x.UnitName==this.ExcelTable[S][y].replace("'","''"))),b.length>0?this.ExcelTable[S][f]=b[0].UOMID.toString():(this.temp.includes(parseInt(i[0].ColumnCostCenterID.toString()))||this.temp.push({[parseInt(i[0].ColumnCostCenterID.toString())]:[]}),this.temp[parseInt(i[0].ColumnCostCenterID.toString())].Contains(this.ExcelTable[S][y].toLowerCase())||(this.temp[parseInt(i[0].ColumnCostCenterID.toString())].push(this.ExcelTable[S][y].toLowerCase()),this.Uomsb+="<Row  PrimaryKey='0' UName='"+k.Dw.GetValidXml(this.ExcelTable[S][y])+"'  ConversionRate='1' MapAction='NEW' />"))}}else if("SubstituteGroup"==i[0].SysColumnName.toString()||"SubstituteProduct"==i[0].SysColumnName.toString())this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,!1);else if(i[0].SysColumnName.toString().startsWith("Assigned_")&&parseInt(i[0].ColumnCostCenterID)>0)"7"==this.Feature.SelectedValue?this.CheckAssignedCostCenters(S,parseInt(i[0].ColumnCostCenterID),F.FieldName.toString(),this.IsCode):""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0?this.CheckAssignedCostCenters(S,parseInt(i[0].ColumnCostCenterID),F.FieldName.toString(),!0):this.CheckAssignedCostCenters(S,parseInt(i[0].ColumnCostCenterID),F.FieldName.toString(),!1);else if(null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0)""!=this.ExcelTable[S][y]&&("Cross Dimension"==this.Feature.SelectedItem.Name&&this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode),44==parseInt(i[0].ColumnCostCenterID)?this.CheckLookupField(S,parseInt(i[0].ColumnCCListViewTypeID.toString()),F.FieldName.toString()):"76"==this.Feature.SelectedValue&&"Bill Of Materials With Multiple Stage"==this.Feature.SelectedItem.Name?this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode):"Job Output"==this.Feature.SelectedItem.Name&&"Code"==i[0].SysColumnName.toString()?this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,!0):"Job Output"==this.Feature.SelectedItem.Name&&-158!=parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,this.IsCode):-1==parseInt(F.FeatureFieldName)||-12==parseInt(F.FeatureFieldName)||-7==parseInt(F.FeatureFieldName)||-9==parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),!0,!1):parseInt(F.FeatureFieldName)>0||-16==parseInt(F.FeatureFieldName)||-30==parseInt(F.FeatureFieldName)||-23==parseInt(F.FeatureFieldName)||-29==parseInt(F.FeatureFieldName)||-30==parseInt(F.FeatureFieldName)?this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,this.IsCode):this.CheckCostCenterField(S,parseInt(i[0].ColumnCostCenterID.toString()),F.FieldName.toString(),e,!0));else if("StatusID"!=i[0].SysColumnName.toString()&&("RoleID"!=i[0].SysColumnName.toString()||50051!=parseInt(i[0].CostCenterID)))if("AccountTypeID"==i[0].SysColumnName.toString()){if(t=!0,s=null,s=this.CostCenterFieldsAllTables.Tables[2].filter(f=>(f.ResourceData?f.ResourceData.toString().toLowerCase():"")==(this.ExcelTable[S][y]?this.ExcelTable[S][y].toString().toLowerCase():"")),0==s.length){p="";for(let f of this.CostCenterFieldsAllTables.Tables[2])p+=f.ResourceData.toString()+",";if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect Account Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : "+p.substring(0,p.length-1)+"]",this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Account Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : "+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}}else if("Contact_ContactTypeID"==i[0].SysColumnName.toString()){if(p="",p=this.ExcelTable[S][y],"Primary"!=p&&"Secondary"!=p){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect contact Type  information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values 'Primary, Secondary]",this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect contact Type  information at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values 'Primary, Secondary]",this.ErrorList.push(f)}}}else if("ProductTypeID"==i[0].SysColumnName.toString()){t=!0,s=null,s=this.CostCenterFieldsAllTables.Tables[2].filter(f=>(f.ResourceData?f.ResourceData.toString().toLowerCase():"")==(this.ExcelTable[S][y]?this.ExcelTable[S][y].toString().toLowerCase():"")),p="";for(let f of this.CostCenterFieldsAllTables.Tables[2])p+=f.ResourceData.toString()+",";if(0==s.length){let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Product Type at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+", Expected values : -"+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}else if("ValuationID"==i[0].SysColumnName.toString()){r=!0,p="";for(let f of this.CostCenterFieldsAllTables.Tables[3])p+=f.ResourceData.toString()+",";if("FIFO"!=this.ExcelTable[S][y]&&"LIFO"!=this.ExcelTable[S][y]&&"Weighted Average"!=this.ExcelTable[S][y]&&""!=this.ExcelTable[S][y]){let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect Valuation Method at Row "+(S+1).toString()+", ["+this.ExcelTable[S][y]+" , Expected values :- "+p.substring(0,p.length-1)+"]",this.ErrorList.push(f)}}else if(i[0].ColumnDataType&&"int"==i[0].ColumnDataType.toString().toLowerCase()||i[0].ColumnDataType&&"bigint"==i[0].ColumnDataType.toString().toLowerCase()){if(!parseInt(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" information at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" information at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.ErrorList.push(f)}}}else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){if(""!=this.ExcelTable[S][y]&&!parseFloat(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+"]",this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected numeric values]",this.ErrorList.push(f)}}}else if(i[0].ColumnDataType&&"datetime"==i[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[S][y])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected Date in format 'dd/MMM/yyy']",this.MessageVisibility=!0,!1;{let f=new Ae.AddNoteViewModel;f.NoteID=0,f.Note.Text+="Incorrect "+F.FieldName.toString()+" at Row "+(S+1).toString()+",["+this.ExcelTable[S][y]+", Expected Date in format 'dd/MMM/yyy']",this.ErrorList.push(f)}}}}let m=h;if("50051"==this.Feature.SelectedValue){let S="",F="",y="",C=null;const f=this.grData.Table;if(C=f.filter(b=>"30000"==b.FeatureFieldName),C.length>0&&(S=C[0].FieldName.toString()),C=f.filter(b=>"30001"==b.FeatureFieldName),C.length>0&&(F=C[0].FieldName.toString()),this.IsCode&&""==S)return this.DisplayMessage="Please select employee code field",this.MessageVisibility=!0,!1;if(!this.IsCode&&""==F&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select employee name field",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""==F&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select Based on Unique Field to Update",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let b=this.CostCenterFieldsAllTables.Tables[0].Select("SysColumnName='"+this.UpdateBasedOn.SelectedValue+"'");if(null!=b&&b.length>0&&(y=b[0].SysColumnName.toString(),C=f.filter(x=>x.FeatureFieldName==b[0].CostCenterColID.toString()),0==C.length))return this.DisplayMessage="Please select Employee - "+b[0].UserColumnName.toString()+" field in the Mappings",this.MessageVisibility=!0,!1}this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue&&(m=!0)}if(!m&&!h&&this.ExcelTable.length>0&&!this.NameSameasCode&&"10"!=this.Feature.SelectedValue)return this.DisplayMessage="Name does not exists",this.MessageVisibility=!0,!1;if(("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue)&&!t&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new Ae.AddNoteViewModel;S.NoteID=0,S.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(S)}if(!o&&"2"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new Ae.AddNoteViewModel;S.NoteID=0,S.Note.Text="Bill wise is not set for Debtors / Creditors type of account, by default it will set to Yes",this.RulesList.push(S)}if(!r&&"3"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let S=new Ae.AddNoteViewModel;S.NoteID=0,S.Note.Text="Valuation method is not set product, by default it will set to defined at product preferences",this.RulesList.push(S)}return!0}extradataImport(e,i,l){this.FillLookupFields(),this.DoNotCreateCostCenter||this.FillCostCenterFields(!1);let s=[];if(""!=i.toString()){Logger.InfoLog("ScanCostCenterFields: Importing UOM Dat values="+i.toString()),i+="</XML>",s.push(""),s.push(0),s.push("<XML>"+i.toString()),s.push(1),s.push(I.d.SessionManager.CompanyGUID),s.push(I.d.SessionManager.UserName),s.push(I.d.SessionManager.RoleID),s.push(I.d.SessionManager.LanguageID);let u=I.d.document.AddUOMWithDataset(s);if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("ErrorMessage"))return this.DisplayMessage=u.Tables[0][0].ErrorMessage.toString(),!1;for(let h=0;h<u.Tables[0].length;h++){const t=u.Tables[0][h].UnitName.toString().replace("*","**"),o=this.ExcelTable[l.replace("_Key","")],r=this.ExcelTable.filter(d=>d[o]?.toString()===t);if(r.length>0)for(let d of r)d[l]=u.Tables[0][h].UOMID.toString()}}return!0}ScanServiceDimensionFields(e){const i=this.CostCenterFieldsAllTables.Tables[0];let l=null;new _e;for(let u=0;u<this.ExcelTable.length;u++)for(let h of this.grData.Table)if(null!=h.FeatureFieldName&&""!=h.FeatureFieldName.toString()&&"0"!=h.FeatureFieldName.toString()&&(l=i.filter(t=>t.CostCenterColID==h.FeatureFieldName.toString()),l.length>0&&null!=l[0].ColumnCostCenterID&&""!=l[0].ColumnCostCenterID.toString()&&parseInt(l[0].ColumnCostCenterID.toString())>0))if(""!=this.ExcelTable[u][h.FieldName.toString()]&&"3"==this.Feature.SelectedValue)this.CheckCostCenterField(u,parseInt(i[0].ColumnCostCenterID.toString()),h.FieldName.toString(),e,!1);else if(""!=this.ExcelTable[u][h.FieldName.toString()]&&"Account Dimension wise Cr/Dr Limits"==this.Feature.SelectedItem.Name){if(this.IsCode){let t=this.ExcelTable[h.FieldName.toString()].ColumnName+"_Name";this.ExcelTable.includes(t)||this.ExcelTable.push(t)}this.CheckCostCenterField(u,parseInt(i[0].ColumnCostCenterID.toString()),h.FieldName.toString(),e,this.IsCode)}return this.FillCostCenterFields(e),!0}ImportServicestoDimension(){const e=this.CostCenterFieldsAllTables.Tables[0];if(!this.ScanServiceDimensionFields(!1))return;let i=0,l="",s=[];l+="<XML>";for(let u=0;u<this.ExcelTable.length;u++,this.ProgressValue++){s.length=0;let r,h="",t="",o="";l+="<Row ";for(let c=0;c<this.grData.Table.length;c++)if(null!=this.grData.Table[c].FeatureFieldName&&""!=this.grData.Table[c].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[c].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Dimension":o="CostCenterID='"+this.CostCenterid.toString()+"'  NodeID='"+this.ExcelTable[u][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"', ";break;case"ServiceName":"3"==this.Feature.SelectedValue.toString()&&(l+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()])+'" ',h=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]),this.ExcelTable.includes(this.grData.Table[c].FieldName.toString()+"_Key")&&(t+="Product ='"+this.ExcelTable[u][this.grData.Table[c].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]?""!=this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"M"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()]||"2"==this.ExcelTable[u][this.grData.Table[c].FieldName.toString().Trim()])&&(t+=e[0].SysColumnName.toString()+" ='2'  "):t+=e[0].SysColumnName.toString()+" ='1'  "}if(""!=o&&(l+='LinkOption="'+o.substring(0,o.length-2)+'"  '),""!=t&&(l+='LinkFields ="'+t.substring(0,t.length-2)+'" '),""==h)continue;l+=" ></Row>",l+="</XML>";let d=[];d.push(l.toString()),d.push(this.Feature.SelectedValue),d.push(I.d.SessionManager.CompanyIndex),r=I.d.document.SetImportServicetoDimension(d),r>0&&(i++,this.FailedRecourdList.push({Name:h,Message:r})),l="",l+="<XML>",this.ImportedCount="Imported :"+(u+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}onPreviewcallback(){this.IsPreviewDataOk&&this.ImportCosCenters()}onPreviewDataClick(){var e=this;return(0,Ie.A)(function*(){e.IsScaned=!1,e.ScanCostCenterFields(!1)&&(e.IsScaned=!0,yield e.OnSave("Preview"))})()}ImportCosCenters(){var e=this;return(0,Ie.A)(function*(){Logger.InfoLog("Entering ImportCosCenters ");const i=e.costCenterTableZero;if(("2"==e.Feature.SelectedValue||"3"==e.Feature.SelectedValue||parseInt(e.Feature.SelectedValue)>=5e4&&parseInt(e.Feature.SelectedValue)<=50075)&&!e.IsScaned)yield e.onPreviewDataClick();else if(!e.ScanCostCenterFields(!1))return;if(!e.extradataImport(!1,e.Uomsb,e.UomCol))return;e.GroupsImport&&0==e.GroupTotCount&&(e.GroupfailCount=0,e.GroupTotCount=0),Logger.InfoLog("After validating data");let o,d,l=0,s=0,u="",h=null,t="",r="",c=null;if(null!=e.CodeDef&&e.IsAutoCodeGen){Logger.InfoLog("check for code information from defination");let M=e.CodeDef.filter(Xe=>0==Xe.IsName||null==Xe.IsName);M.length>0&&M[0].PrefixContent.toString().length>0&&(c=new N.VB,c.LoadXml(M[0].PrefixContent.toString()))}t+="<XML>",r+="<History>";let n=!1,a=!1,g=!1,p=!1,T=!1,m=!1,S=!1,F=!1,y=!1,C=!1,f=0,b=0,x=0,R=0,w=0,U="",V="",_="",Z="",W="",re="",B="",ae="",he="",Re="",E="",P="",K=null;for(let M=0;M<e.ExcelTable.length;M++,e.ProgressValue++){if("PASS"==e.ExcelTable[M].IMPORT_STATUS){s++;continue}if(Logger.InfoLog("Excel table row no:"+M+1),o="",n=!1,a=!1,g=!1,p=!1,T=!1,m=!1,S=!1,F=!1,y=!1,C=!1,f=0,b=0,x=0,R=0,U="",V="",_="",Z="",W="",re="",B="",ae="",he="",Re="",E="",P="",d="",null!=c&&(Logger.InfoLog("ImportCosCenters Getting code information for the row"),h=e.GetCodeData(e.ExcelTable[M],0)),e.ExcelTable.includes("IsDeleted")&&""!=e.ExcelTable[M].IsDeleted.toString()&&(0,j.yG0)(e.ExcelTable[M].IsDeleted.toString())){if(P="",P="2"==e.Feature.SelectedValue?"AccountName":"3"==e.Feature.SelectedValue?"ProductName":"Name",i.filter(se=>se.SysColumnName==P).length>0){let se=e.grData.Table.filter(L=>L.FeatureFieldName==i[0].CostCenterColID.toString());se.length>0&&(V=e.ExcelTable[M][se[0].FieldName.toString().Trim()].toString())}l++,e.FailedRecourdList.push({Name:V,Message:"New data exist for masters"});continue}t+="<Row ";for(let X=0;X<e.grData.Table.length;X++){let L=e.ExcelDataColumn.indexOf(e.DtImport[X].FieldName);if(null==e.grData.Table[X].FeatureFieldName||""==e.grData.Table[X].FeatureFieldName.toString()||"-200"==e.grData.Table[X].FeatureFieldName.toString())continue;let G=i.filter(ve=>ve.CostCenterColID==e.grData.Table[X].FeatureFieldName.toString());if(G.length>0){let ve=G[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+ve),ve){case"StatusID":const v=e.CostCenterFieldsAllTables.Tables[1].filter(me=>me.ResourceData==e.ExcelTable[M][L]);v.length>0&&(t+='StatusID ="'+v[0].StatusID.toString()+'" ');break;case"AccountTypeID":const ne=e.CostCenterFieldsAllTables.Tables[2].filter(me=>me.ResourceData==e.ExcelTable[M][L]);if(ne.length>0){t+='TypeID ="'+ne[0].AccountTypeID.toString()+'" ';try{f=parseInt(ne[0].AccountTypeID.toString())}catch{f=0}}break;case"CustomerTypeID":t+='TypeID ="1" ';break;case"ProductTypeID":const ce=e.CostCenterFieldsAllTables.Tables[2].filter(me=>me.ResourceData==e.ExcelTable[M][L]);ce.length>0&&(t+='TypeID ="'+ce[0].ProductTypeID.toString()+'" ');break;case"ValuationID":const Te=e.CostCenterFieldsAllTables.Tables[3].filter(me=>me.ResourceData==e.ExcelTable[M][L]);m=!0,Te.length>0?t+='ValuationID ="'+Te[0].ValuationID.toString()+'" ':m=!1;break;case"UOMID":T=!0,B+="UOMID ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseUOM":B+="PurchaseUOM ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":t+='PurchaseAccount ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ',a=!0;break;case"SalesAccountID":case"SalesAccount":n=!0,t+='SalesAccount ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ';break;case"DrOptionID":F=!0,"FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"FDOM"==e.ExcelTable[M][L].toUpperCase()||"1"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"LDOM"==e.ExcelTable[M][L].toUpperCase()||"2"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==e.ExcelTable[M][L].toUpperCase()||"BC"==e.ExcelTable[M][L].toUpperCase()||"3"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DUFDM"==e.ExcelTable[M][L].toUpperCase()||"4"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DUFDM"==e.ExcelTable[M][L].toUpperCase()||"5"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DOFDM"==e.ExcelTable[M][L].toUpperCase()||"6"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DOFDM"==e.ExcelTable[M][L].toUpperCase()||"7"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==e.ExcelTable[M][L].toUpperCase()||"LDNM"==e.ExcelTable[M][L].toUpperCase()||"8"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='8', ":B+=G[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":S=!0,"FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"FDOM"==e.ExcelTable[M][L].toUpperCase()||"1"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"LDOM"==e.ExcelTable[M][L].toUpperCase()||"2"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==e.ExcelTable[M][L].toUpperCase()||"BC"==e.ExcelTable[M][L].toUpperCase()||"3"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DUFDM"==e.ExcelTable[M][L].toUpperCase()||"4"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DUFDM"==e.ExcelTable[M][L].toUpperCase()||"5"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DOFDM"==e.ExcelTable[M][L].toUpperCase()||"6"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==e.ExcelTable[M][L].toUpperCase()||"DOFDM"==e.ExcelTable[M][L].toUpperCase()||"7"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==e.ExcelTable[M][L].toUpperCase()||"LDNM"==e.ExcelTable[M][L].toUpperCase()||"8"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='8', ":B+=G[0].SysColumnName.toString()+" ='0', ";break;case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":t+=G[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ';break;case"Year":if(e.ExcelTable[M][L].Contains("-")){let me=[];me=e.ExcelTable[M][L].split("-"),x=me.length>0&&parseInt(me[0]),x=x?parseInt(me[0]):0,R=me.length>1&&parseInt(me[1]),R=R?parseInt(me[1]):0}else x=parseInt(e.ExcelTable[M][L])?parseInt(e.ExcelTable[M][L]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==h&&(t+='AccountCode ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" '),(3==parseInt(e.Feature.SelectedValue)||parseInt(e.Feature.SelectedValue)>5e4)&&e.NameSameasCode&&(t+='AccountName ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ');break;case"CodePrefix":case"CodeNumber":null==h&&(t+=ve+'="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":"51"!=e.Feature.SelectedValue.toString()?(e.NameSameasCode||(t+='AccountName ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" '),V=e.ExcelTable[M][L]):"CustomerName"==G[0].SysColumnName.toString()?(t+='AccountName ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ',V=e.ExcelTable[M][L]):null!=G[0].ColumnCostCenterID&&""!=G[0].ColumnCostCenterID.toString()&&parseInt(G[0].ColumnCostCenterID.toString())>0&&(B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ");break;case"BarcodeID":t+='BarcodeID="'+e.ExcelTable[M][L]+'" ';break;case"ProductGroup":case"ParentGroupName":t+='GroupName ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ',N.J0.IsEmpty(e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString())?(t+='SelectedNode ="1" ',b=1):(t+='SelectedNode ="'+k.Dw.GetValidXml(e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString().Trim())+'" ',b=parseInt(e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()));break;case"AccountId":case"CustomerId":"65"==e.Feature.SelectedValue.toString()&&("CustomerId"==G[0].SysColumnName.toString()?Z+=" CCID='83'  CustomerName ='"+k.Dw.GetValidXml(e.ExcelTable[M][L])+"'  ":"AccountId"==G[0].SysColumnName.toString()&&(Z+=" CCID='2'   CustomerName ='"+k.Dw.GetValidXml(e.ExcelTable[M][L])+"'  "));break;case"IsGroup":case"IsBillwise":if("IsGroup"==ve){if(Logger.InfoLog("Group value"+e.ExcelTable[M][L].toLowerCase()),("true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L]||"on"==e.ExcelTable[M][L].toLowerCase())&&e.CCQuery.length>0&&e.ccdv.length>0)for(var De of e.CCQuery)if(console.log("itemsCCQuery",De),""!=De.value&&De.Key.toString()==e.Feature.SelectedValue&&!C)for(let me=0;me<e.ccdv[De.Key].length;me++){const pe=e.ccdv[De].Name.toString().replace("*","**"),be=e.ExcelTable[e.COls[De.Key].replace("_Key","")];if(e.ExcelTable.filter(Pe=>Pe[be]?.toString()===pe).length>0&&e.ccdv[De.Key][me].Name.toString()==V){C=!0;break}}}else y=!0;"true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L]||"on"==e.ExcelTable[M][L].toLowerCase()?t+=G[0].SysColumnName.toString()+' ="1" ':t+=G[0].SysColumnName.toString()+' ="0" ';break;case"PlanningMethod":"mrp"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L].toLowerCase()?B+=G[0].SysColumnName.toString()+" ='1' , ":B+=G[0].SysColumnName.toString()+" ='0' , ";break;case"ProcurementMethod":"produced"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L].toLowerCase()?B+=G[0].SysColumnName.toString()+" ='1' , ":B+=G[0].SysColumnName.toString()+" ='0' , ";break;case"BinWise":"true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L].toLowerCase()||"on"==e.ExcelTable[M][L].toLowerCase()?t+=G[0].SysColumnName.toString()+' ="1" ':t+=G[0].SysColumnName.toString()+' ="0" ';break;case"IsPacking":case"BOM":e.ExcelTable.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&!N.J0.IsEmpty(e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString())&&(B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ");break;case"IsBillOfEntry":"fifo"==e.ExcelTable[M][L].toLowerCase()||"2"==e.ExcelTable[M][L]?B+=G[0].SysColumnName.toString()+" ='2' , ":"true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L]||"on"==e.ExcelTable[M][L].toLowerCase()?B+=G[0].SysColumnName.toString()+" ='1' , ":B+=G[0].SysColumnName.toString()+" ='0' , ";break;case"IsLotwise":case"IsWeightable":"true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L]||"on"==e.ExcelTable[M][L].toLowerCase()?B+=G[0].SysColumnName.toString()+" ='1' , ":B+=G[0].SysColumnName.toString()+" ='0' , ";break;case"ParentID":if("3"==e.Feature.SelectedValue)if(Logger.InfoLog("Parent value"+e.ExcelTable[M][L].toLowerCase()),"true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L].toLowerCase()||"on"==e.ExcelTable[M][L].toLowerCase()){if(t+='IsGroup="1" ',("true"==e.ExcelTable[M][L].toLowerCase()||"yes"==e.ExcelTable[M][L].toLowerCase()||"y"==e.ExcelTable[M][L].toLowerCase()||"1"==e.ExcelTable[M][L].toLowerCase()||"on"==e.ExcelTable[M][L].toLowerCase())&&e.CCQuery.length>0&&e.ccdv.length>0)for(var De of e.CCQuery)if(""!=De.value&&De.Key.toString()==e.Feature.SelectedValue&&!C)for(let pe=0;pe<e.ccdv[De.Key].length;pe++){const be=e.ccdv[De].Name.toString().replace("*","**"),we=e.ExcelTable[e.COls[De.Key].replace("_Key","")];if(e.ExcelTable.filter(Be=>Be[we]?.toString()===be).length>0&&e.ccdv[De.Key][pe].Name.toString()==V){C=!0;break}}}else t+='IsGroup ="0" ';else t+='GroupName ="'+k.Dw.GetValidXml(e.ExcelTable[M][L])+'" ';break;case"COGSAccountID":e.ExcelTable.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&(B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', "),g=!0;break;case"ClosingStockAccountID":e.ExcelTable.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&(B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', "),p=!0;break;case"Base_Name":d+="BaseName='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"' ";break;case"Base_Conversion":d+="Conversion='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"' ";break;case"Conversion_UnitName":d+="UnitName='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":d+="ConversionUnit='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"' ";break;case"MultiBarcode":d+="MultiBarcode='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"' ";break;case"ServiceCode":case"ServiceName":e.ExcelTable.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&(he+="Product ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==e.ExcelTable[M][L]||"OPTIONAL"!=e.ExcelTable[M][L].toUpperCase()&&"O"!=e.ExcelTable[M][L]&&"1"!=e.ExcelTable[M][L]?""!=e.ExcelTable[M][L]&&("MANDATORY"==e.ExcelTable[M][L]||"M"==e.ExcelTable[M][L]||"2"==e.ExcelTable[M][L])&&(he+=G[0].SysColumnName.toString()+" ='2'  "):he+=G[0].SysColumnName.toString()+" ='1'  ";break;case"AccountImage":case"ProductImage":case"DimensionImage":let je;if(je=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()],je.length>0){let me=je.split(";");try{je=me[0]}catch{W=""}try{for(let pe=1;pe<me.length;pe++)je=me[pe]}catch{re=""}}break;case"Attachments":let Ye=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()];if(Ye.length>0){let me=Ye.split(";");try{for(let pe of me);}catch{re=""}}break;case"SubstituteGroup":_+="GroupName ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"'  ";break;default:if(null!=G[0].ColumnCostCenterID&&""!=G[0].ColumnCostCenterID.toString()&&parseInt(G[0].ColumnCostCenterID.toString())>0&&"COM_ADDRESS"!=G[0].SysTableName.toString().toUpperCase())if(44==parseInt(G[0].ColumnCostCenterID.toString()))""!=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]&&(G[0].SysColumnName.toString().Contains("Alpha")?E+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ":B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ");else if(G[0].SysColumnName.toString().Contains("Alpha"))E+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=G[0].IsColumnUserDefined&&""!=G[0].IsColumnUserDefined.toString()&&(0,j.yG0)(G[0].IsColumnUserDefined.toString())&&!G[0].SysColumnName.toString().startsWith("Assigned_")&&"COM_ADDRESS"!=G[0].SysTableName.toString().toUpperCase()){if(e.ExcelDataColumn.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&""!=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()&&(u=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"' "),G[0].SysColumnName.toString().endsWith("_FromDate")||G[0].SysColumnName.toString().endsWith("_ToDate")||!G[0].SysColumnName.toString().startsWith("CCNID")||G[0].SysColumnName.toString().endsWith("_Remarks")?parseInt(G[0].CostCenterID.toString())>=5e4&&parseInt(G[0].CostCenterID.toString())<=50050&&3==parseInt(G[0].ColumnCostCenterID.toString())&&(U+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', "):e.ExcelDataColumn.includes(e.grData.Table[X].FieldName.toString()+"_Key")&&""!=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()?U+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ":U+=G[0].SysColumnName.toString()+" ='1', ",G[0].SysColumnName.toString().endsWith("_FromDate")){u="";let me="",pe=new Date,be=null,we=e.grData.Table.filter(Pe=>Pe.FeatureFieldName==e.grData.Table[X].FeatureFieldName.toString().substring(0,e.grData.Table[X].FeatureFieldName.toString().length-3));if(null!=we&&we.length>0){e.ExcelTable.includes(we[0].FieldName.toString()+"_Key")&&""!=e.ExcelTable[M][we[0].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[M][we[0].FieldName.toString()+"_Key"].toString()&&(u=e.ExcelTable[M][we[0].FieldName.toString()+"_Key"].toString()+"' ");let Pe=e.grData.Table.filter(ke=>ke.FeatureFieldName==we[0].FeatureFieldName.toString()+"001'");null!=Pe&&Pe.length>0&&null!=e.ExcelTable[M][Pe[0].FieldName.toString()]&&null!=e.ExcelTable[M][Pe[0].FieldName.toString()]&&""!=e.ExcelTable[M][Pe[0].FieldName.toString()]&&(be=new Date(e.ExcelTable[M][Pe[0].FieldName.toString()]));let Be=e.grData.Table.filter(ke=>ke.FeatureFieldName==we[0].FeatureFieldName.toString()+"002'");null!=Be&&Be.length>0&&(me=e.ExcelTable[M][Be[0].FieldName.toString()])}r+="<XML><Row",(""==e.ExcelTable[M][L]||N.J0.isValidDate(e.ExcelTable[M][L]))&&(r+=" ID='0' CCID='"+G[0].ColumnCostCenterID.toString()+"' NodeID='"+u),r+="FromDate='"+pe.toLocaleDateString("dd MMM yyyy").toString(),be.HasValue&&(r+="' ToDate='"+be.Value.toLocaleDateString("dd MMM yyyy").toString()),r+="' Modified='1' ",r+="Remarks='"+me+"' ",u="",r+="/></XML>"}}else null!=G[0].IsColumnUserDefined&&""!=G[0].IsColumnUserDefined.toString()&&(0,j.yG0)(G[0].IsColumnUserDefined.toString())&&G[0].SysColumnName.toString().startsWith("Assigned_")?o+=e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString():B+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=G[0].IsColumnUserDefined&&""!=G[0].IsColumnUserDefined.toString()&&(0,j.yG0)(G[0].IsColumnUserDefined.toString()))if(null==G[0].SysColumnName||!G[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&"COM_ADDRESS"!=G[0].SysTableName.toString().toUpperCase())null==G[0].SysColumnName||"COM_CCCCData"!=G[0].SysTableName.toString()||!G[0].SysColumnName.toString().toLowerCase().Contains("series")&&"IsManual"!=G[0].SysColumnName.toString()?ae+=G[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(e.ExcelTable[M][L])+"', ":U+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()]+"', ";else if(Object.keys(G[0]).includes("UserColumnType")&&G[0].UserColumnType.toString().toLowerCase().Contains("date")||G[0].ColumnDataType.toString().toLowerCase().Contains("date")){let me=e.Date;(""==e.ExcelTable[M][L]||N.J0.isValidDate(e.ExcelTable[M][L]))&&(E+=G[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(me).ToString("dd/MMM/yyyy")+"', ")}else"COM_ADDRESS"==G[0].SysTableName.toString().toUpperCase()&&parseInt(G[0].ColumnCostCenterID.toString())>0?ae+=G[0].SysColumnName.toString()+" ='"+e.ExcelTable[M][e.grData.Table[X].FieldName.toString()+"_Key"].toString()+"', ":"COM_ADDRESS"==G[0].SysTableName.toString().toUpperCase()?ae+=G[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(e.ExcelTable[M][L])+"', ":E+=G[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(e.ExcelTable[M][L])+"', ";else if("float"==G[0].ColumnDataType.toString().toLowerCase()&&""==e.ExcelTable[M][L])B+=G[0].SysColumnName.toString()+" ='0', ";else if(Object.keys(G).includes("UserColumnType")&&G[0].UserColumnType.toString().toLowerCase().Contains("date")||G[0].ColumnDataType.toString().toLowerCase().Contains("date")){let me=e.Date;(""==e.ExcelTable[M][L]||N.J0.isValidDate(e.ExcelTable[M][L]))&&(B+=G[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(me).ToString("dd/MMM/yyyy")+"', ")}else B+=G[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(e.ExcelTable[M][e.grData.Table[X].FieldName.toString().trim().replace("'","''")])+"', "}}}if(null!=h){if(h.Table.Contains("ErrorMessage"))return e.DisplayMessage=h.ErrorMessage.toString(),Logger.InfoLog("Code generation error "+h.ServerMessage.toString()),void(e.MessageVisibility=!0);t+='AccountCode="'+h.Code.toString()+'" ',t+='CodePrefix="'+h.Prefix.toString()+h.Suffix.toString()+'" ',t+='CodeNumber="'+h.Number.toString()+'" '}if("3"!=e.Feature.SelectedValue||e.IsUpdate||t.toString().Contains('IsGroup="1" ')){if(!e.IsUpdate&&!a){let X=i.filter(se=>"PurchaseAccount"==se.SysColumnName);if(X.length>0){let se=X[0].UserDefaultValue;B+=X[0].SysColumnName.toString()+" =N'"+(null!=se?se.toString():"")+"', "}if(!n){let se=i.filter(L=>"SalesAccount"==L.SysColumnName);if(se.length>0){let L=se[0].UserDefaultValue;B+=se[0].SysColumnName.toString()+" =N'"+(null!=L?L.toString():"")+"', "}}if(!g){let se=i.filter(L=>"COGSAccountID"==L.SysColumnName);if(se.length>0){let L=se[0].UserDefaultValue;B+=se[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}}if(!p){let se=i.filter(L=>"ClosingStockAccountID"==L.SysColumnName);if(se.length>0){let L=se[0].UserDefaultValue;B+=se[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}}if(!T){let se=i.filter(L=>"UOMID"==L.SysColumnName);if(se.length>0){let L=se[0].UserDefaultValue;B+=se[0].SysColumnName.toString()+" ='"+(null!=L?L.toString():"")+"', "}else""!=e.Feature.SelectedValue&&null!=e.Feature.SelectedValue&&2!=parseInt(e.Feature.SelectedValue)&&65!=parseInt(e.Feature.SelectedValue)&&51!=parseInt(e.Feature.SelectedValue)&&(B+=" UOMID ='1', ")}}}else if(e.CostCenterFieldsAllTables.Tables[8].RowFilter="Name='Copygroupdatatonode'",b>0&&e.CostCenterFieldsAllTables.Tables[8].length>0&&(0,j.yG0)(e.CostCenterFieldsAllTables.Tables[8][0].Value.toString())){if(w!=b){w=b;let X=new xt.c;X.ProductID=b,K=X.GetCopyProductDetails(b)}if(null!=K&&K.Tables.length>7&&K.Tables[0].length>0&&e.CostCenterFieldsAllTables.Tables[8].length>0){Object.keys(K.Tables[0][0]).includes("CreatedDate"),Object.keys(K.Tables[0][0]).Remove("CreatedDate"),Object.keys(K.Tables[0][0]).includes("ModifiedDate")&&Object.keys(K.Tables[0][0]).Remove("ModifiedDate");for(let X=0;X<e.CostCenterFieldsAllTables.Tables[10].length;X++)e.grData.Table.find(L=>L.FeatureFieldName==e.CostCenterFieldsAllTables.Tables[10][X].CostCenterColID.toString()).length>0&&(K.Tables[0].includes(e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString())?"CurrencyID"==e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()&&""==K.Tables[0][0][e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()]?B+=e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()+" =N'1', ":B+=e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()+" =N'"+K.Tables[0][0][e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()]+"', ":K.Tables[1].includes(e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString())?E+=e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()+"='"+K.Tables[1][0][e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()]+"', ":K.Tables[7].includes(e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString())&&(U+=e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()+"=N'"+K.Tables[7][0][e.CostCenterFieldsAllTables.Tables[10][X].SysColumnName.toString()]+"', "))}}else{if(!a){let X=i.filter(se=>"PurchaseAccountID"==se.SysColumnName);X.length>0&&(B+=X[0].SysColumnName.toString()+" =N'"+X[0].UserDefaultValue.toString()+"', ")}if(!n){let X=i.filter(se=>"SalesAccountID"==se.SysColumnName);X.length>0&&(B+=X[0].SysColumnName.toString()+" =N'"+X[0].UserDefaultValue.toString()+"', ")}if(!m&&e.CostCenterFieldsAllTables.Tables.length>6)if(e.CostCenterFieldsAllTables.Tables[6].filter(se=>"DefaultProductValuation"==se.Name).length>0)e.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+e.CostCenterFieldsAllTables.Tables[6][0].Value.toString()+"'",3==parseInt(e.Feature.SelectedValue)&&i.filter(L=>"ValuationID"==L.SysColumnName).length>0&&(B+=i[0].SysColumnName.toString()+" ='"+e.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+"', ");else{let se=i.filter(L=>"ValuationID"==L.SysColumnName);se.length>0&&(B+=se[0].SysColumnName.toString()+" ='"+se[0].UserDefaultValue.toString()+"', ")}if(!g){let X=i.filter(se=>"COGSAccountID"==se.SysColumnName);X.length>0&&(B+=X[0].SysColumnName.toString()+" ='"+X[0].UserDefaultValue.toString()+"', ")}if(!p){let X=i.filter(se=>"ClosingStockAccountID"==se.SysColumnName);X.length>0&&(B+=X[0].SysColumnName.toString()+" ='"+X[0].UserDefaultValue.toString()+"', ")}if(!T){let X=i.filter(se=>"UOMID"==se.SysColumnName);X.length>0?B+=X[0].SysColumnName.toString()+" ='"+X[0].UserDefaultValue.toString()+"', ":null!=parseInt(e.Feature.SelectedValue)&&2!=parseInt(e.Feature.SelectedValue)&&65!=parseInt(e.Feature.SelectedValue)&&51!=parseInt(e.Feature.SelectedValue)&&(B+=" UOMID ='1', ")}}if(!y&&!e.IsUpdate){let X=!1;X=(0,j.yG0)(I.d.SessionManager.Preferences.On.toString()),"2"==e.Feature.SelectedValue&&0==f&&(f=7),t+=!X||6!=f&&7!=f?' IsBillwise="0" ':'IsBillwise ="1" '}let Xe;if(C&&null!=e.Feature.SelectedValue&&("2"==e.Feature.SelectedValue||"3"==e.Feature.SelectedValue||parseInt(e.Feature.SelectedValue)>5e4)&&(t+=' Move ="1" '),!F&&"2"==e.Feature.SelectedValue&&(B+=" DrOptionID='0', "),!S&&"2"==e.Feature.SelectedValue&&(B+=" CrOptionID='0', "),""!=B&&(t+='ExtraFields ="'+B.substring(0,B.length-2)+'" '),null!=e.Feature.SelectedItem&&"Product With Services(One-One)"==e.Feature.SelectedItem.Name?Re="One-One":null!=e.Feature.SelectedItem&&"Product With Services(Many-One)"==e.Feature.SelectedItem.Name&&(Re="Many-One"),""!=Re&&(t+='LinkOption="'+Re+'"  '),""!=he&&(t+='LinkFields ="'+he.substring(0,he.length-2)+'" '),""!=_&&(t+='Substitutes ="'+_.substring(0,_.length-2)+'" '),""!=Z&&(t+='CustomerName ="'+Z.substring(0,Z.length-2)+'" '),""!=W&&(t+='ProductImage ="'+W+'" '),""!=E&&(t+='ExtraUserDefinedFields ="'+E.substring(0,E.length-2)+'" '),""!=U&&(t+='CostCenterFields ="'+U.substring(0,U.length-2)+'" '),""!=ae&&(t+='PrimaryContactQuery ="'+ae.substring(0,ae.length-2)+'" '),d.toString().length>0&&(d.toString().Contains("Conversion=")||(d+="Conversion='1' "),t+='ProductWiseUOM="'+d.toString()+'" '),""!=V||!(3==parseInt(e.Feature.SelectedValue)||parseInt(e.Feature.SelectedValue)>5e4)||e.NameSameasCode){if(o.length>0&&(o.Insert(0,'<XML IsImport="1" >'),o+="</XML>"),re.length>0&&(re="<XML>"+re+"</XML>"),t+=" ></Row>",t+="</XML>",r+="</History>",C){let X=I.d.document.SetImportData(t.toString(),o.toString(),r.toString(),e.Feature.SelectedValue,e.IsDuplicateNameAllowed,e.IsAutoCodeGen,e.IsUpdate,e.IsCode,re);X.RetValue>0?(e.ExcelTable[M].xIMP_STATUSx="FAIL",e.ExcelTable[M].IMPORT_MESSAGE=Xe,l++,e.FailedRecourdList.push({Name:V,Message:X.Message})):(e.ExcelTable[M].xIMP_STATUSx="PASS",e.ExcelTable[M].IMPORT_MESSAGE="")}else{let X=I.d.document.SetImportData(t.toString(),o.toString(),r.toString(),e.Feature.SelectedValue,e.IsDuplicateNameAllowed,e.IsAutoCodeGen,e.IsUpdate,e.IsCode,re);X?.RetValue>0?(e.ExcelTable[M].xIMP_STATUSx="FAIL",e.ExcelTable[M].IMPORT_MESSAGE=Xe,l++,e.FailedRecourdList.push({Name:V,Message:X.Message})):(e.ExcelTable[M].xIMP_STATUSx="PASS",e.ExcelTable[M].IMPORT_MESSAGE="")}t="",t+="<XML>",r="",r+="<History>",e.ImportedCount="Imported :"+(M+1-l).toString(),e.FailedCount="Failed :"+l.toString()}}let We=e.ExcelTable.length-s;e.GroupsImport&&(e.GroupfailCount=l,e.GroupTotCount=We),e.GroupTotCount>0&&e.GroupsImport?(e.ImportedCount="Imported :"+(e.GroupTotCount-e.GroupfailCount).toString(),e.FailedCount="Failed :"+e.GroupfailCount.toString()):(e.ImportedCount="Imported :"+(e.GroupTotCount+We-(e.GroupfailCount+l)).toString(),e.FailedCount="Failed :"+(e.GroupfailCount+l).toString()),e.ListVisbility=e.FailedRecourdList.length>0,e.UpdateExcelSheet(),e.DisplayMessage=e.GroupsImport?"Import completed ( Total :"+e.GroupTotCount.toString()+" "+e.ImportedCount+" "+e.FailedCount+" )":"Import completed ( Total :"+(e.GroupTotCount+We).toString()+" "+e.ImportedCount+" "+e.FailedCount+" )",e.MessageVisibility=!0})()}ImportJobOutput(){let e=this.costCenterTableZero,i=0;if(!this.ScanCostCenterFields(!1))return;let l=0,u="";this.CheckProductUOMdata();let o="",n=0,a=0;n=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++){if(u+="<XML>",o=this.ExcelTable[g][n].toString(),this.lst.filter(m=>m.Name==o).length>0)continue;a+=1,u+="<Row ",u+=' RowNo="'+a+'" ';for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString())if(e.filter(S=>S.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),"Code"==e[0].SysColumnName.toString())u+='NodeID="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()+"_key"].toString()+'" ',u+='Code="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()]+'" ';else if("Name"==e[0].SysColumnName.toString())u+='Name="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()]+'" ';else if(""!=e[0].ColumnCostCenterID.toString()&&113==parseInt(e[0].ColumnCostCenterID.toString())){let S=this.CostCenterFieldsAllTables[5];S.filter(F=>F.ResourceData==this.ExcelTable[g][this.grData.Table[m].FieldName.toString()]),u+=e[0].SysColumnName.toString()+'="'+S[0].ItemArray[1].toString()+'" '}else""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()+"_key"].toString()+'" ':"-154"==e[0].CostCenterColID.toString()?u+='Qty="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()]+'" ':"-155"==e[0].CostCenterColID.toString()?"BOM"==this.ExcelTable[g][this.grData.Table[m].FieldName.toString()].toUpperCase()?u+='IsBom="0" ':"QTY"==this.ExcelTable[g][this.grData.Table[m].FieldName.toString()].toUpperCase()&&(u+='IsBom="1" '):"-157"==e[0].CostCenterColID.toString()&&(u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[m].FieldName.toString()]+'" ');u+=">",u+="</Row>",u+="</XML>";let p,T=[];T.push(u.toString()),T.push(this.Feature.SelectedValue),T.push(I.d.SessionManager.CompanyIndex),p=I.d.document.SetImportJobOutputData(T),this.DisplayMessage=p,u="",p<0&&(l++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),i++}this.ImportedCount="Imported :"+(i-l).toString(),this.FailedCount="Failed :"+l.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLookUps(){let e=this.costCenterTableZero,i=0,l=0;for(let s of this.ExcelTable){let u;this.name="";let h="",t="",o=!1;u=parseInt(this.CostCenterFieldsAllTables[1][0].NodeID);for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(a=>a.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0)){let a=e[0].SysColumnName.toString();"Code"==a&&(h=s[this.grData.Table[n].FieldName.toString()]),"Name"==a&&(this.name=s[this.grData.Table[n].FieldName.toString()]),"AliasName"==a&&(t=s[this.grData.Table[n].FieldName.toString()]),"Default"==a&&("1"==s[this.grData.Table[n].FieldName.toString()]||"yes"==s[this.grData.Table[n].FieldName.toString()].toLowerCase())&&(o=!0)}let d,c=[];c.push(parseInt(u)),c.push(h),c.push(this.name),c.push(t),c.push(1),c.push(o?1:0),c.push(""),c.push(I.d.SessionManager.CompanyGUID),c.push(I.d.SessionManager.UserName),c.push(I.d.SessionManager.RoleID),c.push(I.d.SessionManager.LanguageID),d=I.d.document.SetLookupImport(c),this.DisplayMessage=d,d<0&&(i++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),l++}this.ImportedCount="Imported :"+(l-i).toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCrossDimension(){let o,e=this.costCenterTableZero,l="",s="",u=0,h=0,t="";if(!this.ScanCostCenterFields(!1))return;t+="<XML>",o+="<XML>";for(let c=0;c<this.ExcelTable.length;c++,this.ProgressValue++){t+="<Row ",o+="<Row ",t+='Sno ="'+(c+1)+'" ',o+='Sno ="'+(c+1)+'" ';for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(a=>a.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))if(l=e[0].SysColumnName.toString(),h=parseInt(e[0].ColumnCostCenterID),l.Contains("Dim_"))u=h;else switch(l){case"Document":t+='Document="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()]+'" ';break;case"CreditAccount":t+='CreditAccount="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"DebitAccount":t+='DebitAccount="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"In/From":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(c,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimIn="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"For/To":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(c,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimFor="'+this.ExcelTable[c][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;default:s.Contains(h.toString())||(s+=h+",")}t+=" />",o+=" />"}t+="</XML>",o+="</XML>";let d=[];d.push(u),d.push(s),d.push(t.toString()),d.push(o.toString()),d.push(this.IsUpdate),d.push(this.IsCode),d.push(I.d.SessionManager.UserName),d.push(I.d.SessionManager.UserID),d.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SetImportCrossDimension(d),t="",o="",this.MessageVisibility=!0}ScanBatchfields(){let e=this.costCenterTableZero;for(let i of this.grData.Table)e.filter(l=>l.CostCenterColID==i[1].toString()),e.length>0&&("BatchNumber"==e[0].SysColumnName.toString()?this.batchnumberfield=e[0].SysColumnName.toString():"MfgDate"==e[0].SysColumnName.toString()?this.mfgdatefield=e[0].SysColumnName.toString():"ExpiryDate"==e[0].SysColumnName.toString()?this.expdatefield=e[0].SysColumnName.toString():"ProductID"==e[0].SysColumnName.toString()?this.productidfield=e[0].SysColumnName.toString():"BatchCode"==e[0].SysColumnName.toString()&&(this.bcodefield=e[0].SysColumnName.toString()))}ImportBatches(){let e=this.costCenterTableZero,i=this.CostCenterFieldsAllTables[this.CostCenterFieldsAllTables.length-2];if(this.ScanBatchfields(),!this.ScanCostCenterFields(!1))return;let h,l=0,s=null,u="";if(this.xDocCodeDef=null,null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(this.xDocCodeDef=new N.VB,this.xDocCodeDef.LoadXml(this.CodeDef[0].PrefixContent.toString())),""==this.batchnumberfield)return this.DisplayMessage="Batch number field is mandatory",void(this.MessageVisibility=!0);if(""==this.bcodefield&&!this.IsAutoCodeGen)return this.DisplayMessage="Batch code field  is mandatory",void(this.MessageVisibility=!0);for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){let o=!1,r="",d="",c="",n="";h.length=0;let a="",g="",p="",T="",m="",S=new Pt.Batch;u+="<Row ";for(let C=0;C<this.grData.Table.length;C++)if(null!=this.grData.Table[C].FeatureFieldName&&""!=this.grData.Table[C].FeatureFieldName.toString()&&(e.filter(f=>f.CostCenterColID==this.grData.Table[C].FeatureFieldName.toString()),e.length>0)){let f=e[0].SysColumnName.toString();switch(f){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1].length>0&&(u+='StatusID ="'+this.CostCenterFieldsAllTables[1][0].StatusID.toString()+'" ');break;case"MfgDate":let b;if(b=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),b)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);S.MfgDate=b,p=b.Date.toLocaleDateString("dd/MMM/yyyy");break;case"ExpiryDate":let x;if(x=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),x)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);S.ExpiryDate=x,g=x.Date.toLocaleDateString("dd/MMM/yyyy");break;case"RetestDate":let R;if(R=""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),R)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);a=R.Date.toLocaleDateString("dd/MMM/yyyy");break;case"MRPRate":let w=0;w=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.MRPRate=w;break;case"RetailRate":let U=0;U=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.RetailRate=U;break;case"StockistRate":let V=0;V=parseFloat(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]),S.StockistRate=V;break;case"ProductID":S.ProductID=parseInt(this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString().Trim());break;case"BatchCode":null==s&&(S.BatchCode=this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]);break;case"CodePrefix":case"CodeNumber":null==s&&(u+=f+'="'+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+'" ',"CodePrefix"==f?S.CodePrefix=k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]):"CodeNumber"==f&&(S.CodeNumber=parseInt(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])));break;case"BatchNumber":u+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+'" ',d=this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()],m=d;break;case"IsGroup":"true"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()].toLowerCase()?(u+=e[0].SysColumnName.toString()+' ="1" ',S.IsGroup=o=!0):(u+=e[0].SysColumnName.toString()+' ="0" ',S.IsGroup=o=!1);break;case"ParentID":""!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]&&(i.RowFilter=this.IsCode?"BatchNumber='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]+"'":"BatchCode='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()]+"'",S.BatchGroup=i.length>0?parseInt(i[0].BatchID.toString()):1);break;case"VendorAccountID":this.ExcelTable.includes(this.grData.Table[C].FieldName.toString()+"_Key")&&(c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ");break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&!e[0].SysColumnName.toString().startsWith("Assigned_")?""!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()?r+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":r+=e[0].SysColumnName.toString()+" ='1', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().startsWith("Assigned_")?h+=this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString():c+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[C].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?T+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', ":n+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()]?c+=e[0].SysColumnName.toString()+" ='0', ":c+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[C].FieldName.toString().Trim()])+"', "}}if(null!=this.xDocCodeDef&&(s=this.GetCodeData(this.ExcelTable[t],S.BatchGroup)),null!=s&&(S.BatchCode=s.Code.toString(),S.CodePrefix=s.Prefix.toString()+s.Suffix.toString(),S.CodeNumber=parseInt(s.Number.toString())),""!=c&&(u+='ExtraFields ="'+c.substring(0,c.length-2)+'" '),""!=T&&(u+='ExtraUserDefinedFields ="'+T.substring(0,T.length-2)+'" '),""!=r&&(u+='CostCenterFields ="'+r.substring(0,r.length-2)+'" '),""!=n&&(u+='PrimaryContactQuery ="'+n.substring(0,n.length-2)+'" '),""==m)continue;h.length>0&&(h.Insert(0,"<XML>"),h+="</XML>");let y,F=[];if(F.push(m),F.push(""!=p?S.MfgDate:""==p&&o?null:"1/JAN/1900"),F.push(""!=g?S.ExpiryDate:""==g&&o?null:"1/JAN/1900"),F.push(S.MRPRate),F.push(S.RetailRate),F.push(S.StockistRate),S.ProductID>0)F.push(S.ProductID);else{if(!o&&0==S.ProductID)return this.DisplayMessage="Product field is required",void(this.MessageVisibility=!0);F.push(0)}F.push(""!=a?a.toString():null),F.push(S.BatchGroup>1?S.BatchGroup:1),S.StaticFieldsQuery=c,S.CustomFieldsQuery=T,S.CustomCostCenterFieldsQuery=r,Pt.Batch.QuickAddBatch(y,F,!1),y<=0&&(l++,this.FailedRecourdList.push({Name:m,Message:y})),this.ImportedCount="Imported :"+(t+1-l).toString(),this.FailedCount="Failed :"+l.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckDetails(e,i){for(let l of this.lst)if(l.Name==e&&l.Value==i)return!1;return!0}ImportProductwiseMultipleUOM(){let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let i=0,l=0,s="",u="",h="";this.CheckProductUOMdata(),s+="<XML>";let t="",o=0;o=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){if(t=this.ExcelTable[r][o].toString(),this.lst.filter(b=>b.Name==t).length>0)continue;this.lst.push(ie._p.ComboBoxItems_1(t));let y,d="",c="",n="",a="",g="",p="",T="",m=0,S=0,F="";s+="<Row ";for(let b=0;b<this.grData.Table.length;b++)if(null!=this.grData.Table[b].FeatureFieldName&&""!=this.grData.Table[b].FeatureFieldName.toString()&&(e.filter(x=>x.CostCenterColID==this.grData.Table[b].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(s+='StatusID ="'+this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(s+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":s+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(s+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":this.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[3].length>0&&(s+='ValuationID ="'+this.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+'" ');break;case"UOMID":a+="UOMID ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":s+='PurchaseAccount ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"SalesAccountID":case"SalesAccount":s+='SalesAccount ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":case"CrOptionID":"FIRST DAY OF MONTH"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='2', ":a+=e[0].SysColumnName.toString()+" ='0', ";break;case"CodePrefix":s+='CodePrefix ="'+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+'" ';break;case"CodeNumber":s+='CodeNumber ="'+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+'" ';break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":s+=e[0].SysColumnName.toString()+' ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].Contains("-")){let R=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].split("-");m=R.length>0&&parseInt(R[0]),m=m?parseInt(R[0]):0,S=R.length>1&&parseInt(R[1])?parseInt(R[1]):0}else m=parseInt(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])?parseInt(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]):0;break;case"AccountCode":case"ProductCode":case"CustomerCode":case"Code":s+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"AccountName":case"CustomerName":case"Name":case"ProductName":"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==e[0].SysColumnName.toString()?(s+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ',c=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]):null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&(a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ");break;case"ParentGroupName":s+='GroupName ="'+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+'" ';break;case"ParentID":case"IsBillwise":"true"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toLowerCase()?s+=e[0].SysColumnName.toString()+' ="1" ':s+=e[0].SysColumnName.toString()+' ="0" ';break;case"COGSAccountID":case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[b].FieldName.toString()+"_Key")&&(a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ");break;case"Assigned_Locations":case"Assigned_Dimension":u+=this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString();break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[b].FieldName.toString()+"_Key")&&(p+="Product ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?""!=this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"M"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]||"2"==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])&&(p+=e[0].SysColumnName.toString()+" ='2'  "):p+=e[0].SysColumnName.toString()+" ='1'  ";break;case"SubstituteGroup":n+="GroupName ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()]+"'  ";break;default:if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString())?d+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ":a+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[r][this.grData.Table[b].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,j.yG0)(e[0].IsColumnUserDefined.toString()))null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?F+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', ":g+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', ";else{if("-19"==e[0].CostCenterColID.toString()||"-20"==e[0].CostCenterColID.toString()||"-21"==e[0].CostCenterColID.toString()||"-22"==e[0].CostCenterColID.toString())continue;e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()]?a+=e[0].SysColumnName.toString()+" ='0', ":a+=e[0].SysColumnName.toString()+" =N'"+k.Dw.GetValidXml(this.ExcelTable[r][this.grData.Table[b].FieldName.toString().Trim()])+"', "}}if(""!=T&&(s+='LinkOption="'+T+'"  '),""!=p&&(s+='LinkFields ="'+p.substring(0,p.length-2)+'" '),""!=n&&(s+='Substitutes ="'+n.substring(0,n.length-2)+'" '),""!=this.ExcelTable[r].ProductwiseUOMConversion.toString()&&(h+=this.ExcelTable[r].ProductwiseUOMConversion.toString()),""==c)continue;s+=" ></Row>",s+="</XML>";let f=[];f.push(s.toString()),f.push(u.toString()),f.push(h.toString()),f.push(this.IsDuplicateNameAllowed),f.push(this.IsAutoCodeGen),f.push(!1),f.push(this.Feature.SelectedValue),f.push(this.IsUpdate),f.push(this.IsCode),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductWithMultipleUOM(f)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[r].ProductwiseUOMConversionCount.toString()?i+=parseInt(this.ExcelTable[r].ProductwiseUOMConversionCount.toString()):i++,this.FailedRecourdList.push({Name:c,Message:y})):l+=parseInt(this.ExcelTable[r].ProductwiseUOMConversionCount.toString()),s="",s+="<XML>",this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseMultipleUOMBarcode(){if(!this.ScanCostCenterFields(!1))return;let i=0,l=0,s="";this.CheckProductUOMdata();let u="",h=0;h=this.IsCode?this.codecolnum:this.namecolnum,this.lst.Clear();for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){if(u=this.ExcelTable[t][h].toString(),this.lst.filter(d=>d.Name==u).length>0)continue;this.lst.push(ie._p.ComboBoxItems_1(u)),""!=this.ExcelTable[t].ProductwiseUOMConversion.toString()&&(s+=this.ExcelTable[t].ProductwiseUOMConversion.toString());let o,r=[];r.push(u),r.push(s.toString()),r.push(this.IsUpdate),r.push(this.IsCode),r.push(I.d.SessionManager.CompanyGUID),r.push(I.d.SessionManager.UserName),r.push(I.d.SessionManager.UserID),r.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductWithMultipleUOMBarcode(r)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[t].ProductwiseUOMConversionCount.toString()?i+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()):i++,this.FailedRecourdList.push({Name:u,Message:o})):l+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()),this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}FillUnitRates(){this.costCenterTableZero=[];let e={CostCenterColID:"-1"};e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitCode",e.ResourceData="Unit Code",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-2",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitName",e.ResourceData="Unit Name",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-3",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Amount",e.ResourceData="Amount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-4",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Discount",e.ResourceData="Discount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-5",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="AnnualRent",e.ResourceData="AnnualRent",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-6",e.CostcenterID=this.Feature.SelectedValue,e.ColumnDataType="DATE",e.SysColumnName="WEF",e.ResourceData="WEF",this.costCenterTableZero.push(e)}FillUnitRateXML(){let e=this.costCenterTableZero,i="",l="",s="",t=0,o=0;for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":this.IsCode&&(t=r,l=this.grData.Table[r].FieldName.toString());break;case"UnitName":this.IsCode||(o=r,s=this.grData.Table[r].FieldName.toString())}if(t>0||o>0){this.ExcelTable.includes("UnitRatexml")||this.ExcelTable.push("UnitRatexml"),this.lst.Clear(),this.excelview=this.ExcelTable;let r,d="",c=0;c=this.IsCode?t:o;for(let n=0;n<this.ExcelTable.length;n++)if(r=this.ExcelTable[n][c].toString(),0==this.lst.filter(a=>a.Name==r).length){this.lst.push(ie._p.ComboBoxItems_1(r)),this.excelview.filter(this.IsCode?T=>T.colcode==r:T=>T.colname==r),d+="<XML>";let g,p,a=0;for(let T of this.excelview){d+="<Row  ",d+=" UnitRateID='0'  ",d+=" Action=\"NEW\"  MapAction='0'  ";for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":p=N.J0.Int(T[this.grData.Table[m].FieldName.toString()]),p&&(i+="Amount='"+p+"' ");break;case"Discount":p=N.J0.Int(T[this.grData.Table[m].FieldName.toString()]),p&&(i+="Discount='"+p+"' ");break;case"AnnualRent":p=N.J0.Int(T[this.grData.Table[m].FieldName.toString()]),p&&(i+="AnnualRent='"+p+"' ");break;case"WEF":g=N.J0.isValidDate(T[this.grData.Table[m].FieldName.toString()]),g&&(i+="WEF='"+g.toString("dd/MMMyyyyy")+"' ")}d+=i.toString(),d+="/>",a++}d+="</XML>";for(let T of this.ExcelTable)T[c].toString()==r&&(T.UnitRatexml=d.toString())}}}ImportUnitRates(){this.DisplayMessage="",this.MessageVisibility=!1;let o,e=this.costCenterTableZero,i=0,l="",s="",u="",h="";for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":l=this.grData.Table[r].FieldName.toString();break;case"UnitName":s=this.grData.Table[r].FieldName.toString()}if(this.lst.Clear(),this.excelview=this.ExcelTable,""!=l||""!=s)for(let r=0;r<this.ExcelTable.length;r++,this.ProgressValue++){if(o=""!=l?this.ExcelTable[r][l].toString():this.ExcelTable[r][s].toString(),0==this.lst.filter(d=>d.Name==o).length){this.lst.push(ie._p.ComboBoxItems_1(o)),this.excelview.filter(""!=l?a=>a.colcode==o:a=>a.colname==o),""!=l&&(u=this.ExcelTable[r][l].toString()),""!=s&&(h=this.ExcelTable[r][s].toString());let c,n,d=0;if(this.excelview.length>0){let a="";a+="<XML>";for(let p of this.excelview){a+="<Row  ",a+=" UnitRateID='0'  ",a+=" Action=\"NEW\"  MapAction='0'  ";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":n=N.J0.Int(p[this.grData.Table[T].FieldName.toString()]),c=N.J0.isValidDate(p[this.grData.Table[T].FieldName.toString()]),n&&(a+="Amount='"+n+"' ");break;case"Discount":n&&(a+="Discount='"+n+"' ");break;case"AnnualRent":n&&(a+="AnnualRent='"+n+"' ");break;case"WEF":c&&(a+="WithEffFrom='"+c.toLocaleDateString("dd/MMM/yyyy")+"' ")}a+="/>",d++}a+="</XML>";let g=[];g.push(u),g.push(h),g.push(a.toString()),g.push(I.d.SessionManager.CompanyGUID),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.LanguageID),I.d.document.SetImportUnitRates(g)<0&&(i++,this.FailedRecourdList.push({Name:o,Message:void 0}))}}this.ImportedCount="Imported :"+(this.lst.length+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseVendorMultipleBarcode(){this.DisplayMessage="",this.MessageVisibility=!1;let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let i=0,l="",s="",t="",o="";this.CheckProductVendorMultipleBarcode();let r,d=0,c=0;for(let a=0;a<this.grData.Table.length;a++)if(null!=this.grData.Table[a].FeatureFieldName&&""!=this.grData.Table[a].FeatureFieldName.toString()&&(e.filter(g=>g.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(d=a,l=this.grData.Table[a].FieldName.toString());break;case"ProductName":this.IsCode||(c=a,s=this.grData.Table[a].FieldName.toString())}this.lst.Clear();let n=0;n=this.IsCode?d:c,t+="<XML>";for(let a=0;a<this.ExcelTable.length;a++,this.ProgressValue++){let g="";if(r=this.ExcelTable[a][n].toString(),0==this.lst.filter(p=>p.Name==r).length){t+="<Row ",this.lst.push(ie._p.ComboBoxItems_1(r));for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID==this.grData.Table[a].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":t+='AccountCode ="'+k.Dw.GetValidXml(this.ExcelTable[a][this.grData.Table[m].FieldName.toString().Trim()])+'" ';break;case"ProductName":t+='AccountName ="'+k.Dw.GetValidXml(this.ExcelTable[a][this.grData.Table[m].FieldName.toString().Trim()])+'" ',g=this.ExcelTable[a][this.grData.Table[m].FieldName.toString().Trim()]}let p;if(""==g)continue;t+=" ></Row>",t+="</XML>",""!=this.ExcelTable[a].ProdVendorMulBarcode.toString()&&(o+=this.ExcelTable[a].ProdVendorMulBarcode.toString());let T=[];T.push(t.toString()),T.push(o.toString()),T.push(this.Feature.SelectedValue),T.push(this.IsDuplicateNameAllowed),T.push(this.IsUpdate),T.push(this.IsCode),T.push(I.d.SessionManager.CompanyGUID),T.push(I.d.SessionManager.UserName),T.push(I.d.SessionManager.UserID),T.push(I.d.SessionManager.LanguageID),I.d.document.SetImportProductVendorMultipleBarcode(T)<0&&(i++,this.FailedRecourdList.push({Name:g,Message:p}))}t="",t+="<XML>",this.ImportedCount="Imported :"+(a+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckProductUOMdata(){let e=this.costCenterTableZero,i="";for(let l=0;l<this.grData.Table.length&&"-19"!=this.grData.Table[l][1].toString();l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&(e.filter(s=>s.CostCenterColID==this.grData.Table[l].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(this.codecolnum=l,this.colcode=this.grData.Table[l].FieldName.toString());break;case"ProductName":this.IsCode||(this.namecolnum=l,this.colname=this.grData.Table[l].FieldName.toString())}if(this.columnexist){this.ExcelTable.includes("ProductwiseUOMConversion")||(this.ExcelTable.push("ProductwiseUOMConversion"),this.ExcelTable.push("ProductwiseUOMConversionCount")),this.lst.Clear(),this.excelview=this.ExcelTable;let s,l="",u=0;u=this.IsCode?this.codecolnum:this.namecolnum;for(let h=0;h<this.ExcelTable.length;h++)if(s=this.ExcelTable[h][u].toString(),0==this.lst.filter(t=>t.Name==s).length){this.lst.push(ie._p.ComboBoxItems_1(s)),this.excelview.filter(this.IsCode?o=>o.colcode==s:o=>o.colname==s),l+="<Data>";let t=0;for(let o of this.excelview){l+="<Row RowNo='"+(t+1)+"'    ",l+=" UnitiD='0'  ",l+=" Action=\"NEW\"  MapAction='0'  ",l+=" BaseID='-100'  ";for(let r=0;r<this.grData.Table.length;r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[h].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Base_Name":i+="BaseName='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Base_Conversion":i+="Conversion='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Conversion_UnitName":i+="UnitName='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":i+="ConversionUnit='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"MultiBarcode":i+="MultiBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"BaseMultiBarcode":i+="BaseMultiBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ";break;case"UOM_Barcode":""!=o[this.grData.Table[r].FieldName.toString()]&&(this.ShowBarcodeDimension?(i+="Barcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",i+="BarKey='"+o[this.grData.Table[r].FieldName.toString()+"_Key"].toString()+"' "):(i+="Barcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",i+="BarKey='0' "));break;case"Base_Barcode":""!=o[this.grData.Table[r].FieldName.toString()]&&(this.ShowBarcodeDimension?(i+="BaseBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",i+="BaseBarKey='"+o[this.grData.Table[r].FieldName.toString()+"_Key"].toString()+"' "):(i+="BaseBarcode='"+o[this.grData.Table[r].FieldName.toString()]+"' ",i+="BaseBarKey='0' "))}l+=i.toString(),l+="/>",t++}l+="</Data>";for(let o of this.ExcelTable)o[u].toString()==s&&(o.ProductwiseUOMConversion=l.toString(),o.ProductwiseUOMConversionCount=this.excelview.length)}}}CheckProductVendorMultipleBarcode(){let e=this.costCenterTableZero,i="",l="",s="",t=0,o=0,r=!1;for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(c=>c.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(t=d,l=this.grData.Table[d].FieldName.toString());break;case"ProductName":this.IsCode||(o=d,s=this.grData.Table[d].FieldName.toString());break;case"Vendor":"-23"==this.grData.Table[d][1].toString()&&(r=!0)}if(r){this.ExcelTable.includes("ProdVendorMulBarcode")||this.ExcelTable.push("ProdVendorMulBarcode"),this.lst.Clear(),this.excelview=this.ExcelTable;let d,c="",n=0;n=this.IsCode?t:o;for(let a=0;a<this.ExcelTable.length;a++)if(d=this.ExcelTable[a][n].toString(),0==this.lst.filter(g=>g.Name==d).length){this.lst.push(ie._p.ComboBoxItems_1(d)),this.excelview.filter(this.IsCode?p=>p.colcode==d:p=>p.colname==d),c+="<VendorsXML>";let g=0;for(let p of this.excelview){c+="<Row  ",c+=" VendorID='0'  ",c+=" Action=\"NEW\"  MapAction='0'  ";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[T].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Vendor":i+="AccountID='"+p[this.grData.Table[T].FieldName.toString()+"_Key"]+"' ";break;case"ETA":i+="LeadTime='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Priority":i+="Priority='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Min. Order Quantity":i+="MinOrderQty='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Barcode":i+="Barcode='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Volume":i+="Volume='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Weight":i+="Weight='"+p[this.grData.Table[T].FieldName.toString()]+"' ";break;case"Remarks":i+="Remarks='"+p[this.grData.Table[T].FieldName.toString()]+"' "}c+=i.toString(),c+="/>",g++}c+="</VendorsXML>";for(let p of this.ExcelTable)p[n].toString()==d&&(p.ProdVendorMulBarcode=c.toString())}}}ReturnDimensionProfileID(){return I.d.document.GetDataSet("SELECT distinct ProfileID ,ProfileName FROM COM_DimensionMappings WITH(NOLOCK) \nSELECT * FROM COM_DimensionMappings WITH(NOLOCK)")}ReturnSchemeProfileID(){return I.d.document.GetDataSet(" SELECT distinct(ProfileID),ProfileName FROM ADM_SchemesDiscounts WITH(NOLOCK) ").Tables[0]}ImportPriceChart(){let e,i=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let l=null,s=null,u="",h="",t="";if(i.filter(a=>"3"==a.ColumnCostCenterID),i.length>0)for(let a of this.grData.Table)if(a[1].toString()==i[0].CostCenterColID.toString()){t=a.FieldName.toString();break}for(let a=0;a<this.ExcelTable.length;a++){this.ExcelTable[a].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(i.filter(p=>p.CostCenterColID==g[1].toString()),i.length>0))if(""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID)>0)e=parseInt(i[0].ColumnCostCenterID),this.CheckCostCenterFieldName(a,e,g.FieldName.toString(),t,!1)||(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++);else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ProfileName",!0))l=this.ExcelTable[a][g.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"PriceType",!0))""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"ALL"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"A"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"0"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"SALE"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"S"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"1"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""==this.ExcelTable[a][g.FieldName.toString().Trim()]||"PURCHASE"!=this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()&&"P"!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&"2"!=this.ExcelTable[a][g.FieldName.toString().Trim()]?""!=this.ExcelTable[a][g.FieldName.toString().Trim()]&&("REORDER LEVEL"==this.ExcelTable[a][g.FieldName.toString().Trim()].toUpperCase()||"RL"==this.ExcelTable[a][g.FieldName.toString().Trim()]||"3"==this.ExcelTable[a][g.FieldName.toString().Trim()])&&(h+=' Type="3" '):h+=' Type="2" ':h+=' Type="1" ':h+=' Type="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let p;p=!parseFloat(this.ExcelTable[a][g.FieldName.toString().Trim()]),p&&(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++),h+=i[0].SysColumnName.toString()+'="'+p+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}else if(i[0].ColumnDataType&&"datetime"==i[0].ColumnDataType.toString().toLowerCase()){let p=new Date;p=this.ExcelTable[a][g.FieldName.toString().Trim()],N.J0.isValidDate(p)?this.sbQuery+=i[0].SysColumnName.toString()+'="'+p.toLocaleDateString("dd MMM yyyy")+'" ':(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),this.FailedRecourdList.push({Name:l,Message:this.ExcelTable[a].IMPORT_MESSAGE.toString()}),a<this.ExcelTable.length-1&&a++)}if(0==a||s==l){if(0==this.ExcelTable[a].PID.toString().length&&(this.ExcelTable[a].xIMP_STATUSx="FAIL",this.ExcelTable[a].IMPORT_MESSAGE="Select Product at Row "+(a+1).toString(),a<this.ExcelTable.length-1&&a++),s=l,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==s).length){let g=-1;g=this.ReturnProfileIDBasedOnName(s,g),new ft.T,this.lstDuplicate.push(ie._p.ComboBoxItems_1(s))}u+="<Row ",u+=this.sbQuery.toString(),u+=h.toString(),u+="/>",this.ExcelTable[a].xIMP_STATUSx="PASS"}else a--,this.SavePriceChart(u,s),s=l}u.length>0&&this.SavePriceChart(u,l),this.ListVisbility=this.FailedRecourdList.length>0;let d=this.ExcelTable.filter(a=>"PASS"==a.xIMP_STATUSx).length.toString(),c=this.ExcelTable.filter(a=>"FAIL"==a.xIMP_STATUSx).length.toString(),n=parseInt(d)+parseInt(c);d="Imported :"+d,c="Failed :"+c,this.DisplayMessage="Import completed ( Total :"+n.toString()+" "+d+" "+c+" )",this.FailedRecourdList.length>0&&(this.ListVisbility=!0),this.MessageVisibility=!0}ImportSchemesDiscountsBasedOnUniqueDimension(){let e,i;i=this.ReturnSchemeProfileID();let l=i,s=this.costCenterTableZero,u=null,h=null,t=null,o=null,r="",d="",c="",a="",p="";s.filter(y=>"3"==y.CostCenterColID);let T=0,m=this.grData.Table.filter(y=>"3"==y.FeatureFieldName);m.length>0&&m[0].FieldName.toString(),m=this.grData.Table.filter(y=>"-3"==y.FeatureFieldName),m.length>0&&(a=m[0].FieldName.toString()),m=this.grData.Table.filter(y=>"-2"==y.FeatureFieldName),m.length>0&&(p=m[0].FieldName.toString()),m=this.grData.Table.filter(y=>"-1"==y.FeatureFieldName),m.length>0&&m[0].FieldName.toString(),this.UniqueDimensionFill(),this.FreeUniqueDimensionFill();let S,F=new Date;for(let y=0;y<this.ExcelTable.length;y++){if(this.UpdateColumns="",p.length>0){if(o=this.ExcelTable[y][p].toString().Trim(),t!=o&&(c.length>0?(c.Insert(0,"<ProductsXML>"),c+="</ProductsXML>",r.replace("#@PRODXML@#",c.toString())):r.replace("#@PRODXML@#",""),c=""),this.ExcelTable[y][a].toString().Trim().length>0){if(""==this.ExcelTable[y][a+"_Key"].toString())return this.DisplayMessage=a+" "+this.ExcelTable[y][a].toString().Trim()+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);c+='<Row ProductID="'+this.ExcelTable[y][a+"_Key"].toString()+'" ';for(let C of this.grData.Table)if(null!=C[1]&&""!=C[1].toString()&&"0"!=C[1].toString()&&(s.filter(f=>f.CostCenterColID==C[1].toString()),s.length>0))if(S=s[0].SysColumnName.toString(),0==N.J0.stringCompare(s[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""!=this.ExcelTable[y][C.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[y][C.FieldName.toString().Trim()])&&(c+=' IsQtyPercent="2" '):c+=' IsQtyPercent="1" ':c+=' IsQtyPercent="0" ';else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let f;if(f=this.ExcelTable[y][C.FieldName.toString().Trim()],!parseFloat(f))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);c+=s[0].SysColumnName.toString()+'="'+f+'" ',this.UpdateColumns+=s[0].SysColumnName.toString()+","}c+="/>"}if(t==o)continue}for(let C of this.grData.Table)if(null!=C[1]&&""!=C[1].toString()&&"0"!=C[1].toString()&&(s.filter(f=>f.CostCenterColID==C[1].toString()),s.length>0))if(S=s[0].SysColumnName.toString(),""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID)>0){if(e=parseInt(s[0].ColumnCostCenterID),"FreeProduct"!=S){let f;if(""==this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString())return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);3==e?this.sbQuery+='ProductID="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" ':2==e?this.sbQuery+='AccountID="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" ':f=e-5e4,this.sbQuery+="CC"+f+'="'+this.ExcelTable[y][C.FieldName.toString()+"_Key"].toString()+'" '}}else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[y][C.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""==this.ExcelTable[y][C.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[y][C.FieldName.toString().Trim()]?""!=this.ExcelTable[y][C.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[y][C.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[y][C.FieldName.toString().Trim()])&&(d+=' IsQtyPercent="2" '):d+=' IsQtyPercent="1" ':d+=' IsQtyPercent="0" ';else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let f;if(f=this.ExcelTable[y][C.FieldName.toString().Trim()],!parseFloat(f))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);d+=s[0].SysColumnName.toString()+'="'+f+'" ',this.UpdateColumns+=s[0].SysColumnName.toString()+","}else if(s[0].ColumnDataType&&"date"==s[0].ColumnDataType.toString().toLowerCase()){if(F=this.ExcelTable[y][C.FieldName.toString().Trim()],!N.J0.isValidDate(F))return this.DisplayMessage=C.FieldName.toString()+" "+this.ExcelTable[y][C.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);d+=s[0].SysColumnName.toString()+'="'+F.toLocaleDateString("dd MMM yyyy")+'" '}if(t=o,0==y||h==u)h=u,this.IsUpdate&&0==this.lstDuplicate.filter(C=>C.Name==h).length&&(l.filter(C=>C.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),this.lstDuplicate.push(ie._p.ComboBoxItems_1(h))),r+="<Row> ",r+="<XML ",l.filter(C=>C.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),r+=this.sbQuery.toString(),r+='SchemeID="0" ',r+='StatusID="500018" ',r+=d.toString(),r+=">",p.length>0&&(r+="#@PRODXML@#"),r+="</XML>",r+="</Row>";else{y--,r.Insert(0,"<XML>"),r+="</XML>",l.filter(b=>b.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString()));let f=[];f.push(T),f.push(h),f.push(r.toString()),f.push(I.d.SessionManager.CompanyGUID),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(f),h=u,r="",c="",t=null}}if(r.length>0){l.filter(f=>f.ProfileName==h),l.length>0&&(T=parseInt(l[0].ProfileID.toString())),c.length>0?(c.Insert(0,"<ProductsXML>"),c+="</ProductsXML>",r.replace("#@PRODXML@#",c.toString())):r.replace("#@PRODXML@#",""),r.Insert(0,"<XML>"),r+="</XML>";let C=[];C.push(T),C.push(h),C.push(r.toString()),C.push(I.d.SessionManager.CompanyGUID),C.push(I.d.SessionManager.UserName),C.push(I.d.SessionManager.UserID),C.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(C)}this.ListVisbility=this.FailedRecourdList.length>0}ImportSchemesDiscounts(){let e,i;i=this.ReturnSchemeProfileID();let l=i,s=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("FPID")||this.ExcelTable.push("FPID");let u=null,h=null,t=null,o=null,r=500018,d="",c="",n="",a="",g="",T="";s.filter(C=>3==C.ColumnCostCenterID);let m=0,S=this.grData.Table.filter(C=>"3"==C.FeatureFieldName);S.length>0&&(a=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-3"==C.FeatureFieldName),S.length>0&&(g=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-2"==C.FeatureFieldName),S.length>0&&(T=S[0].FieldName.toString()),S=this.grData.Table.filter(C=>"-1"==C.FeatureFieldName),S.length>0&&S[0].FieldName.toString();let F,y=new Date;for(let C=0;C<this.ExcelTable.length;C++){if(c="",this.ExcelTable[C].Query="",this.sbQuery="",this.UpdateColumns="",T.length>0){if(o=this.ExcelTable[C][T].toString().Trim(),t!=o&&(n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",d.replace("#@PRODXML@#",n.toString())):d.replace("#@PRODXML@#",""),n=""),this.ExcelTable[C][g].toString().Trim().length>0){if(!this.CheckCostCenterFieldName(C,3,g,"FreeProduct",!1))return this.DisplayMessage=g+" "+this.ExcelTable[C][g].toString().Trim()+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);n+='<Row ProductID="'+this.ExcelTable[C].FPID.toString()+'" ';for(let f of this.grData.Table)if(null!=f[1]&&""!=f[1].toString()&&"0"!=f[1].toString()&&(s.filter(b=>b.CostCenterColID==f[1].toString()),s.length>0))if(F=s[0].SysColumnName.toString(),0==N.J0.stringCompare(s[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""!=this.ExcelTable[C][f.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[C][f.FieldName.toString().Trim()])&&(n+=' IsQtyPercent="2" '):n+=' IsQtyPercent="1" ':n+=' IsQtyPercent="0" ';else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let b;if(b=this.ExcelTable[C][f.FieldName.toString().Trim()],!parseFloat(b))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);n+=s[0].SysColumnName.toString()+'="'+b+'" ',this.UpdateColumns+=s[0].SysColumnName.toString()+","}n+="/>"}if(t==o)continue}for(let f of this.grData.Table)if(null!=f[1]&&""!=f[1].toString()&&"0"!=f[1].toString()&&(s.filter(b=>b.CostCenterColID==f[1].toString()),s.length>0))if(F=s[0].SysColumnName.toString(),""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID)>0){if(e=parseInt(s[0].ColumnCostCenterID),"FreeProduct"!=F&&!this.CheckCostCenterFieldName(C,e,f.FieldName.toString(),a,!1))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0)}else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[C][f.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"StatusID",!0))r="Active"==this.ExcelTable[C][f.FieldName.toString()]?500018:500019;else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""==this.ExcelTable[C][f.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][f.FieldName.toString().Trim()]?""!=this.ExcelTable[C][f.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[C][f.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[C][f.FieldName.toString().Trim()])&&(c+=' IsQtyPercent="2" '):c+=' IsQtyPercent="1" ':c+=' IsQtyPercent="0" ';else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let b;if(b=this.ExcelTable[C][f.FieldName.toString().Trim()],!parseFloat(b))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);c+=s[0].SysColumnName.toString()+'="'+b+'" ',this.UpdateColumns+=s[0].SysColumnName.toString()+","}else if(s[0].ColumnDataType&&"date"==s[0].ColumnDataType.toString().toLowerCase()){if(y=this.ExcelTable[C][f.FieldName.toString().Trim()],!N.J0.isValidDate(y))return this.DisplayMessage=f.FieldName.toString()+" "+this.ExcelTable[C][f.FieldName.toString().Trim()]+" at Row "+(C+1).toString(),void(this.MessageVisibility=!0);c+=s[0].SysColumnName.toString()+'="'+y.toLocaleDateString("dd MMM yyyy")+'" '}if(t=o,0==C||h==u)h=u,this.IsUpdate&&0==this.lstDuplicate.filter(f=>f.Name==h).length&&(l.filter(f=>f.ProfileName==h),l.length>0&&(m=parseInt(l[0].ProfileID.toString())),this.lstDuplicate.push(ie._p.ComboBoxItems_1(h))),d+="<Row> ",d+="<XML ",l.filter(f=>f.ProfileName==h),l.length>0&&(m=parseInt(l[0].ProfileID.toString())),d+=this.sbQuery.toString(),d+='SchemeID="0" ',d+='StatusID="'+r+'" ',d+=c.toString(),d+=">",T.length>0&&(d+="#@PRODXML@#"),d+="</XML>",d+="</Row>";else{C--,d.Insert(0,"<XML>"),d+="</XML>",l.filter(x=>x.ProfileName==h),l.length>0&&(m=parseInt(l[0].ProfileID.toString()));let b=[];b.push(m),b.push(h),b.push(d.toString()),b.push(I.d.SessionManager.CompanyGUID),b.push(I.d.SessionManager.UserName),b.push(I.d.SessionManager.UserID),b.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(b),h=u,d="",n="",t=null}}if(d.length>0){l.filter(b=>b.ProfileName==h),l.length>0&&(m=parseInt(l[0].ProfileID.toString())),n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",d.replace("#@PRODXML@#",n.toString())):d.replace("#@PRODXML@#",""),d.Insert(0,"<XML>"),d+="</XML>";let f=[];f.push(m),f.push(h),f.push(d.toString()),f.push(I.d.SessionManager.CompanyGUID),f.push(I.d.SessionManager.UserName),f.push(I.d.SessionManager.UserID),f.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveSchemes(f)}this.ListVisbility=this.FailedRecourdList.length>0}ImportDimensionMapping(){let e,i=0,l=this.ReturnDimensionProfileID(),s=l.Tables[0],u=l.Tables[1],h=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let t=null,o=null,r="",d="",c="";h.filter(a=>"3"==a.ColumnCostCenterID);let n=0;if(h.length>0)for(let a of this.grData.Table)if(a[1].toString()==h[0].CostCenterColID.toString()){c=a.FieldName.toString();break}for(let a=0;a<this.ExcelTable.length;a++){d="",this.ExcelTable[a].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(h.filter(p=>p.CostCenterColID==g[1].toString()),h.length>0))if(""!=h[0].ColumnCostCenterID.toString()&&parseInt(h[0].ColumnCostCenterID)>0){if(e=parseInt(h[0].ColumnCostCenterID),!this.CheckCostCenterFieldName(a,e,g.FieldName.toString(),c,!0))return this.DisplayMessage=g.FieldName.toString()+" "+this.ExcelTable[a][g.FieldName.toString().Trim()]+" at Row "+(a+1).toString(),void(this.MessageVisibility=!0)}else 0==N.J0.stringCompare(h[0].SysColumnName.toString(),"ProfileName",!0)?t=this.ExcelTable[a][g.FieldName.toString().Trim()]:h[0].ColumnDataType&&"bit"==h[0].ColumnDataType.toString().toLowerCase()&&("YES"==this.ExcelTable[a][g.FieldName.toString()].toUpperCase()||"1"==this.ExcelTable[a][g.FieldName.toString()]?i=1:("NO"==this.ExcelTable[a][g.FieldName.toString()].toUpperCase()||"0"==this.ExcelTable[a][g.FieldName.toString()])&&(i=0),d+='<Row cols ="'+h[0].SysColumnName.toString().replace("BasedCC","")+'"  IsBase="'+i+'" />');if(0==a||o==t)o=t,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==o).length&&(s.filter(g=>g.ProfileName==o),s.length>0&&(n=parseInt(s[0].ProfileID.toString())),this.lstDuplicate.push(ie._p.ComboBoxItems_1(o))),r+="<Row ",n>0?(u.RowFilter=this.sbQuery.toString().replace(" "," AND ").replace('"',"'")+" ProfileID='"+n+"'",r+=u.length>0?'DimMapID="'+u[0].DimensionMappingsID.toString()+'" ':'DimMapID="0" '):r+='DimMapID="0" ',r+=this.sbQuery.toString(),r+="/>";else{a--,r.Insert(0,"<XML>"),d.Insert(0,"<XML>"),r+="</XML>",d+="</XML>",s.filter(T=>T.ProfileName==o),s.length>0&&(n=parseInt(s[0].ProfileID.toString()));let p=[];p.push(n),p.push(o),p.push(r.toString()),p.push(d.toString()),p.push(""),p.push(!1),p.push(I.d.SessionManager.CompanyGUID),p.push(I.d.SessionManager.UserName),p.push(I.d.SessionManager.UserID),p.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveDimensionMap(p),o=t,r="",d=""}}if(r.length>0){s.filter(p=>p.ProfileName==o),s.length>0&&(n=parseInt(s[0].ProfileID.toString())),r.Insert(0,"<XML>"),d.Insert(0,"<XML>"),r+="</XML>",d+="</XML>";let g=[];g.push(n),g.push(o),g.push(r.toString()),g.push(d.toString()),g.push(""),g.push(!1),g.push(I.d.SessionManager.CompanyGUID),g.push(I.d.SessionManager.UserName),g.push(I.d.SessionManager.UserID),g.push(I.d.SessionManager.LanguageID),this.DisplayMessage=I.d.document.SaveDimensionMap(g)}this.ListVisbility=this.FailedRecourdList.length>0}ImportTaxChart(){let e,s=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("DocID")||this.ExcelTable.push("DocID"),this.ExcelTable.includes("ColID")||this.ExcelTable.push("ColID");let u=null,h=null,t="",o="",r=new Date;for(let d=0;d<this.ExcelTable.length&&d!=this.ExcelTable.length;d++){o="";let a,c=0,n=0,g="",p="";this.ExcelTable[d].Query="",this.sbQuery="",this.UpdateColumns="",this.TaxCCUpdate="";for(let T of this.grData.Table)if(null!=T[1]&&""!=T[1].toString()&&"0"!=T[1].toString()&&(s.filter(m=>m.CostCenterColID==T[1].toString()),s.length>0))if(""!=s[0].ColumnCostCenterID.toString()&&parseInt(s[0].ColumnCostCenterID)>0)e=parseInt(s[0].ColumnCostCenterID),this.CheckCostCenterFieldName(d,e,T.FieldName.toString(),"",!1)||(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[d][T.FieldName.toString().Trim()]+" at Row "+(d+1).toString(),this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++);else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[d][T.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"DocID",!0))g=this.ExcelTable[d][T.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(s[0].SysColumnName.toString(),"ColID",!0))p=this.ExcelTable[d][T.FieldName.toString().Trim()];else if(s[0].ColumnDataType&&"float"==s[0].ColumnDataType.toString().toLowerCase()){let m;m=this.ExcelTable[d][T.FieldName.toString().Trim()],parseFloat(m)||(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[d][T.FieldName.toString().Trim()]+" at Row "+(d+1).toString(),this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++),o+=' Price="'+m+'"  '}else s[0].ColumnDataType&&"date"==s[0].ColumnDataType.toString().toLowerCase()&&(r=this.ExcelTable[d][T.FieldName.toString().Trim()],N.J0.isValidDate(r)?this.sbQuery+=s[0].SysColumnName.toString()+'="'+r.toLocaleDateString("dd MMM yyyy")+'" ':(this.DisplayMessage=T.FieldName.toString()+" "+this.ExcelTable[d][T.FieldName.toString().Trim()]+" at Row "+(d+1).toString(),this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++));if(this.TaxCCUpdate.length>0&&(this.sbQuery+=' CCUpdate="'+this.TaxCCUpdate+'"'),g.length>0){if(a=I.d.document.GetDocumentIDByName(g),null!=a&&(a.Tables[0].length>0&&(c=parseInt(a.Tables[0][0].CostCenterID.toString())),0==c&&(this.DisplayMessage="Invalid Document"+g+"at Row "+(d+1).toString(),this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++),null!=a&&a.Tables.length>1&&a.Tables[1].length>0))if(p.length>0){let T=a.Tables[1];T.RowFilter="UserColumnName='"+p.toString()+"'",T.length>0?n=parseInt(T[0].CostCenterColID.toString()):(this.DisplayMessage="Invalid Column name "+p+" at Row "+(d+1).toString(),this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++)}else this.DisplayMessage="Column name does not exist",this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++}else this.DisplayMessage="Document name does not exist",this.MessageVisibility=!0,this.ExcelTable[d].xIMP_STATUSx="FAIL",this.ExcelTable[d].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",d++;if(0==d||h==u)h=u,t+="<Row ",t+=' DocID="'+c+'" ',t+=' ColID="'+n+'" ',t+=this.sbQuery.toString(),t+=o.toString(),t+="/>",this.ExcelTable[d].xIMP_STATUSx="PASS";else{this.DisplayMessage="";let T=0;if(this.IsUpdate&&(T=this.ReturnTaxProfileIDBasedOnName(h,T),T<=0)){this.DisplayMessage="Profile with "+h+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage});continue}if(""==this.DisplayMessage){let m,S;t.Insert(0,"<XML>"),t+="</XML>",S=this.oChart.SetTaxChartNew(T<=0&&!this.IsUpdate?0:T,h,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=S,m<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage}),d--}h=u,t=""}}if(t.length>0){let c,n,d=0;this.IsUpdate&&(d=this.ReturnTaxProfileIDBasedOnName(h,d),d<=0&&(this.DisplayMessage="Profile with "+h+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage}))),t.Insert(0,"<XML>"),t+="</XML>",n=this.oChart.SetTaxChartNew(this.ProfileID<=0&&!this.IsUpdate?0:d,h,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=n,c<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage})}this.ListVisbility=this.FailedRecourdList.length>0}UniqueDimensionFill(){let e=null,i=[];for(let s of this.grData.Table)if(null!=s[1]&&""!=s[1].toString()&&"0"!=s[1].toString()&&(this.CostCenterID=parseInt(s.FeatureFieldName),this.CostCenterID>0&&!i.includes(this.CostCenterID)&&(2==this.CostCenterID||3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(s[0].toString()+"_Key")||this.ExcelTable.push(s[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var l=this.grData.Table.filter(h=>h.FeatureFieldName==u);if(!(l.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!i.includes(u)){this.ExcelTable.includes(l[0][0].toString()+"_Key")||this.ExcelTable.push(l[0][0].toString()+"_Key");let t="";for(let r=0;r<this.ExcelTable.length;r++)""!=t&&(t+=","),t+="'"+k.Dw.GetValidXml(this.ExcelTable[r][l[0][0].toString()])+"'";let o=I.d.document.GetCCValues(t,u,this.IsCode?1:0);i.push(u,o)}this.ExcelTable.includes("UniqDim")||this.ExcelTable.push("UniqDim");let h="";for(let t=0;t<this.ExcelTable.length;t++)e=i[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][l[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=h&&(h+=" or "),3==this.CostCenterID?h+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?h+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(h+=" ("+(this.IsCode?"Code":"Name")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].UniqDim=e[0].ID.toString());if(""!=h){let o=I.d.document.GetCCValues(h,this.CostCenterID,"ccnid"+(u-5e4));i.push(this.CostCenterID,o)}}}else{let h="";for(let o=0;o<this.ExcelTable.length;o++)""!=h&&(h+=","),h+="'"+k.Dw.GetValidXml(this.ExcelTable[o][s[0].toString()])+"'";let t=I.d.document.GetCCValues(h,this.CostCenterID,this.IsCode?1:0);i.push(this.CostCenterID,t)}}for(let s=0;s<this.ExcelTable.length;s++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let h=parseInt(u.FeatureFieldName);if(h>0&&(2==h||3==h||11==h||h>5e4)&&i.Contains(h)&&null!=i[h]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[s][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[s][u[0].toString()].Trim().replace("'","''")+"'",i[h].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[s].UniqDim.toString()),e=i[h].Select(t),null!=e&&e.length>0&&(this.ExcelTable[s][u[0].toString()+"_Key"]=e[0].ID.toString())}}}FreeUniqueDimensionFill(){let e=null,i=[];for(let s of this.grData.Table)if(null!=s[1]&&""!=s[1].toString()&&"0"!=s[1].toString()&&(this.CostCenterID=-parseInt(s.FeatureFieldName),this.CostCenterID>0&&!i.Contains(this.CostCenterID)&&(3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(s[0].toString()+"_Key")||this.ExcelTable.push(s[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var l=this.grData.Table.filter(h=>h.FeatureFieldName=="-"+u);if(!(l.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!i.Contains(u)){this.ExcelTable.includes(l[0][0].toString()+"_Key")||this.ExcelTable.push(l[0][0].toString()+"_Key");let t="";for(let r=0;r<this.ExcelTable.length;r++)""!=t&&(t+=","),t+="'"+k.Dw.GetValidXml(this.ExcelTable[r][l[0][0].toString()])+"'";let o=I.d.document.GetCCValues(t,u,this.IsCode?1:0);i.push(u,o)}this.ExcelTable.includes("FreeUniqDim")||this.ExcelTable.push("FreeUniqDim");let h="";for(let t=0;t<this.ExcelTable.length;t++)e=i[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][l[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=h&&(h+=" or "),3==this.CostCenterID?h+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?h+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(h+=" ("+(this.IsCode?"Code":"Name")+"='"+k.Dw.GetValidXml(this.ExcelTable[t][s[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].FreeUniqDim=e[0].ID.toString());if(""!=h){let o=I.d.document.GetCCValues(h,this.CostCenterID,"ccnid"+(u-5e4));i.push(this.CostCenterID,o)}}}else{let h="";for(let o=0;o<this.ExcelTable.length;o++)""!=h&&(h+=","),h+="'"+k.Dw.GetValidXml(this.ExcelTable[o][s[0].toString()])+"'";let t=I.d.document.GetCCValues(h,this.CostCenterID,this.IsCode?1:0);i.push(this.CostCenterID,t)}}for(let s=0;s<this.ExcelTable.length;s++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let h=-parseInt(u.FeatureFieldName);if(h>0&&(3==h||11==h||h>5e4)&&i.Contains(h)&&null!=i[h]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[s][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[s][u[0].toString()].Trim().replace("'","''")+"'",i[h].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[s].FreeUniqDim.toString()),e=i[h].Select(t),null!=e&&e.length>0&&(this.ExcelTable[s][u[0].toString()+"_Key"]=e[0].ID.toString())}}}ImportDimensionWisePriceChart(){let e=this.costCenterTableZero,i=[],l=null;for(let F=0;F<this.ExcelTable.length;F++)l=this.grData.Table.filter(y=>y.FieldName==this.ExcelTable[F]&&-5e4==y.FieldName),l.length>0&&i.push(this.ExcelTable[F].ColumnName,this.ExcelTable[F].DataType);if(l=this.grData.Table.filter(F=>5e4==F.FieldName),l.length>0)for(let F=0;F<l.length;F++)parseInt(l[F][1].toString())<-5e4&&(e.filter(y=>y.CostCenterColID==l[F][1].toString()),e.length>0&&!i.includes(e[0].SysColumnName.toString())&&(i.push(e[0].SysColumnName.toString()),i.push(e[0].SysColumnName.toString()+"_Value",typeof parseFloat)));let s=null,u=null,h=!0;for(let F=0;F<this.ExcelTable.length;F++){s={};for(let y of this.grData.Table)null==y[1]||""==y[1].toString()||"0"==y[1].toString()||parseInt(y[1].toString())>-5e4&&(s[y.FieldName.toString()]=this.ExcelTable[F][y.FieldName.toString()]);h=!0;for(let y=0;y<this.ExcelTable.length;y++)l=this.grData.Table.filter(C=>C.FieldName==this.ExcelTable[y]&&-5e4==C.FeatureFieldName),l.length>0&&(h=!1,this.grData.Table.filter(C=>C.CostCenterColID==l[0][1].toString()),s[e[0].SysColumnName.toString()]=this.ExcelTable[y].ColumnName,s[e[0].SysColumnName.toString()+"_Value"]=this.ExcelTable[F][l[0].FieldName.toString()],i.push(s.ItemArray));h&&i.push(s.ItemArray)}for(let F=0;F<this.ExcelTable.length;F++){l=this.grData.Table.filter(y=>y.FieldName==this.ExcelTable[F]&&y.FeatureFieldName<-5e4);for(let y=0;y<l.length;y++)this.grData.Table.Remove(l[y]);""!=e[0].SysColumnName.toString()&&0==this.grData.Table.filter(y=>y.FieldName==e[0].SysColumnName.toString()).length&&(u={},u.FieldName=e[0].SysColumnName.toString(),u.FeatureFieldName=-parseInt(e[0].CostCenterColID.toString()),this.grData.Table.push(u))}this.UniqueDimensionFill();let t="",o="",r="";if(this.grData.Table.filter(F=>"3"==F.FeatureFieldName))return this.DisplayMessage="Product Not Exists",void(this.MessageVisibility=!0);let d=null;if(this.ExcelTable.filter(F=>F.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0&&(d=this.ExcelTable.filter(F=>F.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0),null==d)return this.DisplayMessage="Enter valid data",void(this.MessageVisibility=!0);if(this.grData.Table.filter(F=>"-1"==F.FeatureFieldName).length>0&&(t=this.grData.Table.filter(F=>"-1"==F.FeatureFieldName)[0].FieldName.toString()),""==t)return this.DisplayMessage="Profile Name Not Exists",void(this.MessageVisibility=!0);d.Sort="["+t+"]",this.grData.Table.filter(F=>"-4"==F.FeatureFieldName).length>0&&(o=this.grData.Table.filter(F=>"-4"==F.FeatureFieldName)[0].FieldName.toString());let c="",n="",a=0,g=0,T="",m=new Date;for(let F=0;F<d.length;F++,this.ProgressValue++){c=n,n=d[F][t].toString(),c!=n&&F>0&&(this.SavePriceChart(T,c)<=0?(g++,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage})):a++,this.ImportedCount="Imported :"+a.toString(),this.FailedCount="Failed :"+g.toString(),T=""),""!=o&&(e.filter(y=>y.SysColumnName==d[F][o].toString()||y.UserColumnName==d[F][o].toString()),e.length>0&&(r=e[0].SysColumnName.toString())),T+="<Row ";for(let y of this.grData.Table)if(null!=y[1]&&""!=y[1].toString()&&"0"!=y[1].toString()&&(e.filter(C=>C.CostCenterColID==y[1].toString()),e.length>0))if(""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID)>0){if(T+=e[0].SysColumnName.toString()+'="'+d[F][y.FieldName.toString()+"_Key"].toString()+'" ',d.Table.Columns.Contains(y.FieldName.toString()+"_Value")&&!N.J0.IsEmpty(r)){let C=d[F][y.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(C))return this.DisplayMessage=y.FieldName.toString()+" "+d[F][y.FieldName.toString()+"_Value"].toString().Trim()+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=r+'="'+C+'" '}}else if(0==N.J0.stringCompare(e[0].SysColumnName.toString(),"PriceType",!0))""==d[F][y.FieldName.toString().Trim()]||"ALL"!=d[F][y.FieldName.toString().Trim()].toUpperCase()&&"A"!=d[F][y.FieldName.toString().Trim()]&&"0"!=d[F][y.FieldName.toString().Trim()]?""==d[F][y.FieldName.toString().Trim()]||"SALE"!=d[F][y.FieldName.toString().Trim()].toUpperCase()&&"S"!=d[F][y.FieldName.toString().Trim()]&&"1"!=d[F][y.FieldName.toString().Trim()]?""==d[F][y.FieldName.toString().Trim()]||"PURCHASE"!=d[F][y.FieldName.toString().Trim()].toUpperCase()&&"P"!=d[F][y.FieldName.toString().Trim()]&&"2"!=d[F][y.FieldName.toString().Trim()]?""!=d[F][y.FieldName.toString().Trim()]&&("REORDER LEVEL"==d[F][y.FieldName.toString().Trim()].toUpperCase()||"RL"==d[F][y.FieldName.toString().Trim()]||"3"==d[F][y.FieldName.toString().Trim()])&&(T+=' Type="3" '):T+=' Type="2" ':T+=' Type="1" ':T+=' Type="0" ';else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let C=d[F][y.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(C))return this.DisplayMessage=y.FieldName.toString()+" "+d[F][y.FieldName.toString().Trim()]+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=e[0].SysColumnName.toString()+'="'+C+'" '}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){if(m=d[F][y.FieldName.toString().Trim()],!N.J0.isValidDate(m))return this.DisplayMessage=y.FieldName.toString()+" "+d[F][y.FieldName.toString().Trim()]+" at Row "+(F+1).toString(),void(this.MessageVisibility=!0);T+=e[0].SysColumnName.toString()+'="'+m.toLocaleDateString("dd MMM yyyy")+'" '}T+=" />"}this.SavePriceChart(T,c)<=0?(g++,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage})):a++,this.ImportedCount="Imported :"+a.toString(),this.FailedCount="Failed :"+g.toString(),this.DisplayMessage="Import completed ( Total :"+(g+a).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SavePriceChart(e,i){if(e.length>0){e.Insert(0,"<XML>"),e+="</XML>";try{let s=new ft.T,u=0;try{this.IsUpdate&&(u=this.ReturnProfileIDBasedOnName(i,u))}catch(h){Logger.ErrorLog("Error Save Price chart message ="+h.Message)}this.DisplayMessage=s.SetPriceChartNew(u,i,0,!1,e.toString(),"",0,!0),this.FailedRecourdList.push({Name:i,Message:this.DisplayMessage})}catch{}}return 0}ReturnProfileIDBasedOnName(e,i){let l=I.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCPrices WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&""!=l.Tables[0][0][0].toString()&&(i=parseInt(l.Tables[0][0][0])),i}ReturnTaxProfileIDBasedOnName(e,i){let l=I.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCTaxes WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&""!=l.Tables[0][0][0].toString()&&(i=parseInt(l.Tables[0][0][0])),i}CheckCostCenterFieldName(e,i,l,s,u){if(!this.ccdv.includes(i)){let t=I.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0];this.ccdv.push(i,t)}if(this.IsCode?11==i?(""!=s&&this.IsCode&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and ProductCode='"+this.ExcelTable[e][s].toString().Trim().replace("'","''")+"'"),0==this.ccdv[i].length&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and (ProductCode is null or ProductCode='DynamicSet')")):this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"'":11==i?(""!=s&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and ProductName='"+this.ExcelTable[e][s].toString().Trim().replace("'","''")+"'"),0==this.ccdv[i].length&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"' and (ProductName is null or ProductName='DynamicSet')")):this.ccdv[i].RowFilter="Name='"+this.ExcelTable[e][l].toString().Trim().replace("'","''")+"'",this.ccdv[i].length>0){if(3==i)"FreeProduct"==s?this.ExcelTable[e].FPID=this.ccdv[i][0].NodeID:(this.ExcelTable[e].PID=this.ccdv[i][0].NodeID,this.sbQuery+='ProductID="'+this.ccdv[i][0].NodeID+'" ');else if(2==i)this.sbQuery+='AccountID="'+this.ccdv[i][0].NodeID+'" ';else if(11==i)this.sbQuery+='UOMID="'+this.ccdv[i][0].NodeID+'" ';else if(12==i)this.sbQuery+='CurrencyID="'+this.ccdv[i][0].NodeID+'" ';else if(u)this.sbQuery+="CCNID"+i-5e4+'="'+this.ccdv[i][0].NodeID+'" ';else if(45==parseInt(this.Feature.SelectedValue)){this.TaxCCUpdate+=",CCNID"+(i-5e4)+"="+this.ccdv[i][0].NodeID;var h="CC"+(i-5e4);this.IsUpdate&&(this.sbQuery+=h+'="'+this.ccdv[i][0].NodeID+'" ')}else this.sbQuery+=h-5e4+'="'+this.ccdv[i][0].NodeID+'" ';return!0}return!1}ReturnAssets(){return I.d.document.GetDataSet("select AssetID,AssetCode,AssetName,GUID from ACC_Assets WITH(NOLOCK)")}ImportAssets(){let i,e=0,l="",s="",u="",h="",t=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let o="",r=null,d=null,c=this.objCG.GetScreenInfo(72),n=null;c.Tables.length>0&&null!=c.Tables[0]&&(n=c.Tables[0]);let T,y,a=new It(n),g=1,p="",m="",S="",F=0;this.IsUpdate&&(g=-1);for(let C=0;C<this.ExcelTable.length;C++,this.ProgressValue++){T="",p="",m="",o="",F=0;for(let V=0;V<a.lstColumn.length;V++)a.lstColumn[V].ActualValue="";for(let V=0;V<this.grData.Table.length;V++)null==this.grData.Table[V].FeatureFieldName||""==this.grData.Table[V].FeatureFieldName.toString()||(t.filter(_=>""!==_.SysColumnName&&_.CostcenterColID.toString()===this.grData.Table[V].FeatureFieldName.toString()),t.length>0&&(S=t[0].SysColumnName.toString(),"CodePrefix"==S&&""!=this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]?this.objAsset.CodePrefix=this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]:"CodeNumber"==S&&""!=this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]?this.objAsset.CodeNumber=parseInt(this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]):a[0].SysColumnName.ActualValue="LISTBOX"==a[0].SysColumnName.UserColumnType.toUpperCase()&&a[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[C][this.grData.Table[V].FieldName.toString()+"_Key"].toString():"DATE"==a[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]?new Date(this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[C][this.grData.Table[V].FieldName.toString()]));let f=I.d.document.GetDataSet("select DeprStartValue,EstimateLife,IsDeprSchedule,CONVERT(DATETIME,OriginalDeprStartDate) OriginalDeprStartDate,PreviousDepreciation,SalvageValue,Period,Convert(DateTime,DeprStartDate) DeprStartDate,DepreciationMethod,AveragingMethod from ACC_Assets with(nolock) where AssetCode='"+a[0].AssetCode.ActualValue+"'"),b=I.d.document.GetDataSet("SELECT AD.AssetID FROM ACC_Assets A WITH(NOLOCK) JOIN ACC_AssetDepSchedule AD WITH(NOLOCK) ON A.AssetID=AD.AssetID WHERE A.AssetCode='"+a[0].AssetCode.ActualValue+"' AND AD.VoucherNo IS NOT NULL");if(""!=a[0].WarrantyNo.ActualValue&&(a[0].WarrantyNo.ActualValue="Yes"==a[0].WarrantyNo.ActualValue?"1":"2"),""!=a[0].IsDeprSchedule.ActualValue?a[0].IsDeprSchedule.ActualValue="Yes"==a[0].IsDeprSchedule.ActualValue?"1":"0":this.IsUpdate&&""==a[0].IsDeprSchedule.ActualValue&&null!=f&&f.length>0&&(a[0].IsDeprSchedule.ActualValue=f.Rows[0].IsDeprSchedule.toString()),""!=a[0].DepreciationMethod.ActualValue?a[0].DepreciationMethod.ActualValue="Straight Line"==a[0].DepreciationMethod.ActualValue||"Straight Line Method"==a[0].DepreciationMethod.ActualValue?"1":"2":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DepreciationMethod.ActualValue&&(a[0].DepreciationMethod.ActualValue=f.Rows[0].DepreciationMethod.toString()),""!=a[0].Period.ActualValue?a[0].Period.ActualValue="Yearly"==a[0].Period.ActualValue?"2":"1":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].Period.ActualValue&&(a[0].Period.ActualValue=f.Rows[0].Period.toString()),""!=a[0].AveragingMethod.ActualValue?a[0].AveragingMethod.ActualValue="None"==a[0].AveragingMethod.ActualValue?"1":"2":this.IsUpdate&&null!=f&&f.length>0&&""==a[0].AveragingMethod.ActualValue&&(a[0].AveragingMethod.ActualValue=f.Rows[0].AveragingMethod.toString()),""!=a[0].IncludeSalvageInDepr.ActualValue&&(a[0].IncludeSalvageInDepr.ActualValue="Yes"==a[0].IncludeSalvageInDepr.ActualValue?"1":"2"),""!=a[0].IsMainCovered.ActualValue&&(a[0].IsMainCovered.ActualValue="Yes"==a[0].IsMainCovered.ActualValue?"1":"2"),""!=a[0].IsInsCovered.ActualValue&&(a[0].IsInsCovered.ActualValue="Yes"==a[0].IsInsCovered.ActualValue?"1":"2"),""!=a[0].InsType.ActualValue&&("Quarterly"==a[0].InsType.ActualValue?a[0].InsType.ActualValue="1":"Half-Yearly"==a[0].InsType.ActualValue?a[0].InsType.ActualValue="2":("Anually"==a[0].InsType.ActualValue||"Yearly"==a[0].InsType.ActualValue)&&(a[0].InsType.ActualValue="3")),this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DeprStartDate.ActualValue?i=new Date(f.Rows[0].DeprStartDate).toLocaleDateString("dd MMM yyyy"):this.IsUpdate||""!=a[0].DeprStartDate.ActualValue?""!=a[0].DeprStartDate.ActualValue&&(i=new Date(a[0].DeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")):(a[0].DeprStartDate.ActualValue=" convert(float,convert(datetime,'"+new Date("dd MMM yyyy")+"'))",i=new Date("dd MMM yyyy")),this.IsUpdate||""!=a[0].DeprEndDate.ActualValue)this.IsUpdate||""!=a[0].EstimateLife.ActualValue?this.IsUpdate&&""==a[0].EstimateLife.ActualValue&&null!=f&&f.length>0&&(a[0].EstimateLife.ActualValue=f.Rows[0].EstimateLife.toString()):a[0].EstimateLife.ActualValue=bt.D.CalculateEstimateLife(new Date(i),""!=a[0].DeprEndDate.ActualValue?new Date(l):new Date(a[0].DeprEndDate.ActualValue));else if(""!=a[0].EstimateLife.ActualValue){let V=a[0].EstimateLife.ActualValue.split(".");y=V[0],parseInt(y)?(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(i).AddYears(y).toString()+"'))",l=new Date(i).AddYears(y).toString()):(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(i).toString()+"'))",l=new Date(i).toString()),V.length>1&&N.J0.DoubleTryParse(y)&&(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).AddMonths(y).toString()+"'))",l=new Date(l).AddMonths(y).toString()),V.length>2&&N.J0.DoubleTryParse(y)&&(a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).AddDays(y).toString()+"'))",l=new Date(l).AddDays(y).toString()),a[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(l).toLocaleDateString("dd MMM yyyy")+"'))"}!this.IsUpdate&&""==a[0].ParentAssetID.ActualValue&&(a[0].ParentAssetID.ActualValue="1",d=I.d.document.GetDataSet("select * from ACC_Assets A with(nolock) where A.AssetID="+a[0].ParentAssetID.ActualValue),d.length>0&&(""!=d.Rows[0].ClassID.toString()&&(a[0].ClassID.UserDefaultValue=d.Rows[0].ClassID.toString()),a[0].PostingGroupID.UserDefaultValue=null!=d.Rows[0].PostingGroupID?d.Rows[0].PostingGroupID.toString():"0",a[0].DeprBookID.UserDefaultValue=d.Rows[0].DeprBookID.toString())),""!=a[0].ClassID.ActualValue?(I.d.document.GetAssetNodeID(2,a[0].ClassID.ActualValue,this.IsCode),F>0&&(a[0].ClassID.ActualValue=F.toString())):this.IsUpdate||(a[0].ClassID.ActualValue=a[0].ClassID.UserDefaultValue),""!=a[0].ClassID.ActualValue?(this.objAsset.AssetClassID=parseInt(a[0].ClassID.ActualValue),r=lt.V.GetAssetClassDetails(this.objAsset.AssetClassID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].PostingGroupID.UserDefaultValue=null!=r.Tables[0][0].FAAccountsID&&null!=r.Tables[0][0].FAAccountsID?r.Tables[0][0].FAAccountsID.toString():"0",a[0].DeprBookID.UserDefaultValue=null!=r.Tables[0][0].DeprBookID?r.Tables[0][0].DeprBookID.toString():"0",a[0].Period.UserDefaultValue=r.Tables[0][0].DeprPosting.toString(),a[0].EstimateLife.UserDefaultValue=null!=r.Tables[0][0].TotalYears?r.Tables[0][0].TotalYears.toString():"0")):this.IsUpdate||(a[0].ClassID.ActualValue="1"),!this.IsUpdate&&""==a[0].PostingGroupID.ActualValue&&(a[0].PostingGroupID.ActualValue=a[0].PostingGroupID.UserDefaultValue),""!=a[0].PostingGroupID.ActualValue&&(this.objAsset.PostingGroupID=parseInt(a[0].PostingGroupID.ActualValue),r=lt.V.GetPostingGroupDetails(this.objAsset.PostingGroupID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].AcqnCostACCID.UserDefaultValue=null!=r.Tables[0][0].AcqnCostACCID?r.Tables[0][0].AcqnCostACCID.toString():"0",a[0].DeprExpenseACCID.UserDefaultValue=null!=r.Tables[0][0].DeprExpenseACCID?r.Tables[0][0].DeprExpenseACCID.toString():"0",a[0].AccumDeprACCID.UserDefaultValue=null!=r.Tables[0][0].AccumDeprACCID?r.Tables[0][0].AccumDeprACCID.toString():"0",a[0].AccumDeprDispACCID.UserDefaultValue=null!=r.Tables[0][0].AccumDeprDispACCID?r.Tables[0][0].AccumDeprDispACCID.toString():"0",a[0].AcqnCostDispACCID.UserDefaultValue=null!=r.Tables[0][0].AcqnCostDispACCID?r.Tables[0][0].AcqnCostDispACCID.toString():"0",a[0].GainsDispACCID.UserDefaultValue=null!=r.Tables[0][0].GainsDispACCID?r.Tables[0][0].GainsDispACCID.toString():"0",a[0].LossDispACCID.UserDefaultValue=null!=r.Tables[0][0].LossDispACCID?r.Tables[0][0].LossDispACCID.toString():"0",a[0].MaintExpenseACCID.UserDefaultValue=null!=r.Tables[0][0].MaintExpenseACCID?r.Tables[0][0].MaintExpenseACCID.toString():"0")),""!=a[0].DeprBookID.ActualValue?(I.d.document.GetAssetNodeID(4,a[0].DeprBookID.ActualValue,this.IsCode),F>0&&(a[0].DeprBookID.ActualValue=F.toString())):this.IsUpdate||(a[0].DeprBookID.ActualValue=a[0].DeprBookID.UserDefaultValue),""!=[0].DeprBookGroupID.ActualValue&&F>0&&F.toString(),""!=a[0].DeprBookID.ActualValue&&(this.objAsset.DeprBookID=parseInt(a[0].DeprBookID.ActualValue),r=lt.V.GetDeprBookDetails(this.objAsset.DeprBookID),null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&(a[0].DepreciationMethod.UserDefaultValue=r.Tables[0][0].DeprBookMethod.toString(),a[0].AveragingMethod.UserDefaultValue=r.Tables[0][0].AveragingMethod.toString(),g=parseInt(r.Tables[0][0].SalvageValueType.toString()),r.Tables[0][0].SalvageValue.toString(),a[0].IncludeSalvageInDepr.UserDefaultValue=(0,j.yG0)(r.Tables[0][0].IncludeSalvageInDepr)?"1":"0"));for(let V=0;V<a.lstColumn.length;V++)""==a.lstColumn[V].ActualValue&&""!=a.lstColumn[V].UserDefaultValue&&!this.IsUpdate&&(a.lstColumn[V].ActualValue=a.lstColumn[V].UserDefaultValue),a.lstColumn[V].SysColumnName.toLowerCase().Contains("ccnid")?""==a.lstColumn[V].ActualValue?this.IsUpdate||(p+=a.lstColumn[V].SysColumnName+" ='1', "):p+=a.lstColumn[V].SysColumnName+" ='"+a.lstColumn[V].ActualValue+"', ":a.lstColumn[V].SysColumnName.toLowerCase().Contains("alpha")&&(Number(a.lstColumn[V].ColumnCostCenterID)>0?""!=a.lstColumn[V].ActualValue&&(m+=a.lstColumn[V].SysColumnName+" ='"+a.lstColumn[V].ActualValue+"', "):""!=a.lstColumn[V].ActualValue&&(m+=a.lstColumn[V].SysColumnName+" =N'"+a.lstColumn[V].ActualValue+"', "));if(this.IsUpdate&&null!=f&&f.length>0&&""==a[0].PreviousDepreciation.ActualValue&&(a[0].PreviousDepreciation.ActualValue=f.Rows[0].PreviousDepreciation.toString()),"0"==a[0].DeprStartValue.ActualValue?a[0].DeprStartValue.ActualValue=(parseFloat(a[0].PurchaseValue.ActualValue)-parseFloat(a[0].PreviousDepreciation.ActualValue)).toString():this.IsUpdate&&null!=f&&f.length>0&&""==a[0].DeprStartValue.ActualValue&&(a[0].DeprStartValue.ActualValue=f.Rows[0].DeprStartValue.toString()),""!=a[0].SerialNo.ActualValue&&(o+=" SerialNo=N'"+a[0].SerialNo.ActualValue+"',"),""!=a[0].ClassID.ActualValue&&(o+=" ClassID=N'"+a[0].ClassID.ActualValue+"',"),""!=a[0].PostingGroupID.ActualValue&&(o+=" PostingGroupID=N'"+a[0].PostingGroupID.ActualValue+"',"),""!=[0].DeprBookGroupID.ActualValue&&(o+=" DeprBookGroupID=N'"+[0].DeprBookGroupID.ActualValue+"',"),""!=a[0].TotalQtyPurchase.ActualValue&&(o+=" TotalQtyPurchase=N'"+a[0].TotalQtyPurchase.ActualValue+"',"),""!=a[0].LocationID.ActualValue&&(o+=" LocationID=N'"+a[0].LocationID.ActualValue+"',"),""!=a[0].EmployeeID.ActualValue&&(o+=" EmployeeID=N'"+a[0].EmployeeID.ActualValue+"',"),""!=a[0].Description.ActualValue&&(o+=" Description=N'"+a[0].Description.ActualValue+"',"),""!=a[0].DeprBookID.ActualValue&&(o+=" DeprBookID=N'"+a[0].DeprBookID.ActualValue+"',"),""!=a[0].IsDeprSchedule.ActualValue&&(o+=" IsDeprSchedule=N'"+a[0].IsDeprSchedule.ActualValue+"',"),""!=a[0].DepreciationMethod.ActualValue&&(o+=" DepreciationMethod=N'"+a[0].DepreciationMethod.ActualValue+"',"),""!=a[0].Period.ActualValue&&(o+=" Period=N'"+a[0].Period.ActualValue+"',"),""!=a[0].AveragingMethod.ActualValue&&(o+=" AveragingMethod=N'"+a[0].AveragingMethod.ActualValue+"',"),g>=1&&(o+=" SalvageValueType=N'"+g+"',"),g>=0&&(o+=1==g?" SalvageValueName=N'Value*',":" SalvageValueName=N'Percentage',"),""!=[0].SalvageValue.ActualValue&&(o+=" SalvageValue=N'"+[0].SalvageValue.ActualValue+"',"),""!=a[0].EstimateLife.ActualValue&&(o+=" EstimateLife=N'"+a[0].EstimateLife.ActualValue+"',"),""!=a[0].IncludeSalvageInDepr.ActualValue&&(o+=" IncludeSalvageInDepr=N'"+a[0].IncludeSalvageInDepr.ActualValue+"',"),""!=a[0].DeprStartDate.ActualValue&&(o+=" DeprStartDate= convert(float,convert(datetime,'"+new Date(i).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].OriginalDeprStartDate.ActualValue&&(o+=" OriginalDeprStartDate= convert(float,convert(datetime,'"+new Date(a[0].OriginalDeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].DeprEndDate.ActualValue&&(a[0].DeprEndDate.ActualValue.Contains("convert")?o+=" DeprEndDate="+a[0].DeprEndDate.ActualValue+",":o+=" DeprEndDate= convert(float,convert(datetime,'"+new Date(a[0].DeprEndDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].PurchaseInvoiceNo.ActualValue&&(o+=" PurchaseInvoiceNo=N'"+a[0].PurchaseInvoiceNo.ActualValue+"',"),""!=a[0].PurchaseDate.ActualValue&&(o+=" PurchaseDate= convert(float,convert(datetime,'"+new Date(a[0].PurchaseDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=a[0].SupplierAccountID.ActualValue&&(o+=" SupplierAccountID=N'"+a[0].SupplierAccountID.ActualValue+"',"),""!=a[0].UOM.ActualValue&&(o+=" UOM=N'"+a[0].UOM.ActualValue+"',"),""!=a[0].PurchaseValue.ActualValue&&(o+=" PurchaseValue=N'"+a[0].PurchaseValue.ActualValue+"',"),""!=a[0].DeprStartValue.ActualValue&&(o+=" DeprStartValue=N'"+a[0].DeprStartValue.ActualValue+"',"),""!=a[0].PreviousDepreciation.ActualValue&&(o+=" PreviousDepreciation=N'"+a[0].PreviousDepreciation.ActualValue+"',"),""!=a[0].WarrantyNo.ActualValue&&(o+=" WarrantyNo=N'"+a[0].WarrantyNo.ActualValue+"',"),""!=a[0].WarrantyExpiryDate.ActualValue&&(o+=" WarrantyExpiryDate=N'"+a[0].WarrantyExpiryDate.ActualValue+"',"),""!=a[0].PONo.ActualValue&&(o+=" PONo=N'"+a[0].PONo.ActualValue+"',"),""!=a[0].PODate.ActualValue&&(o+=" PODate= convert(float,convert(datetime,'"+a[0].PODate.ActualValue+"')),"),""!=a[0].GRNNo.ActualValue&&(o+=" GRNNo=N'"+a[0].GRNNo.ActualValue+"',"),""!=a[0].GRNDate.ActualValue&&(o+=" GRNDate="+a[0].GRNDate.ActualValue+","),""!=a[0].CapitalizationNo.ActualValue&&(o+=" CapitalizationNo=N'"+a[0].CapitalizationNo.ActualValue+"',"),""!=a[0].CapitalizationDate.ActualValue&&(o+=" CapitalizationDate=N'"+a[0].CapitalizationDate.ActualValue+"',"),""!=a[0].IsMainCovered.ActualValue&&(o+=" IsMainCovered=N'"+a[0].IsMainCovered.ActualValue+"',"),""!=a[0].MaintStartDate.ActualValue&&(o+=" MaintStartDate="+a[0].MaintStartDate.ActualValue+","),""!=a[0].MaintExpiryDate.ActualValue&&(o+=" MaintExpiryDate="+a[0].MaintExpiryDate.ActualValue+","),""!=a[0].NextServiceDate.ActualValue&&(o+=" NextServiceDate="+a[0].NextServiceDate.ActualValue+","),""!=a[0].MainVendorAccID.ActualValue&&(o+=" MainVendorAccID=N'"+a[0].MainVendorAccID.ActualValue+"',"),""!=a[0].InsVendorAccID.ActualValue&&(o+=" InsVendorAccID=N'"+a[0].InsVendorAccID.ActualValue+"',"),""!=a[0].IsInsCovered.ActualValue&&(o+=" IsInsCovered=N'"+a[0].IsInsCovered.ActualValue+"',"),""!=a[0].InsEffectiveDate.ActualValue&&(o+=" InsEffectiveDate="+a[0].InsEffectiveDate.ActualValue+","),""!=a[0].InsExpiryDate.ActualValue&&(o+=" InsExpiryDate="+a[0].InsExpiryDate.ActualValue+","),""!=a[0].InsType.ActualValue&&(o+=" InsType=N'"+a[0].InsType.ActualValue+"',"),""!=a[0].InsPolicyNo.ActualValue&&(o+=" InsPolicyNo=N'"+a[0].InsPolicyNo.ActualValue+"',"),""!=a[0].InsPremium.ActualValue&&(o+=" InsPremium=N'"+a[0].InsPremium.ActualValue+"',"),""!=a[0].PolicyCoverage.ActualValue&&(o+=" PolicyCoverage=N'"+a[0].PolicyCoverage.ActualValue+"',"),""!=[0].AcqnCostACCID.ActualValue?o+=" AcqnCostACCID=N'"+[0].AcqnCostACCID.ActualValue+"',":this.IsUpdate||(o+=" AcqnCostACCID=N'0',"),""!=a[0].DeprExpenseACCID.ActualValue?o+=" DeprExpenseACCID=N'"+a[0].DeprExpenseACCID.ActualValue+"',":this.IsUpdate||(o+=" DeprExpenseACCID=N'0',"),""!=a[0].AccumDeprACCID.ActualValue?o+=" AccumDeprACCID=N'"+a[0].AccumDeprACCID.ActualValue+"',":this.IsUpdate||(o+=" AccumDeprACCID=N'0',"),""!=a[0].AccumDeprDispACCID.ActualValue?o+=" AccumDeprDispACCID=N'"+a[0].AccumDeprDispACCID.ActualValue+"',":this.IsUpdate||(o+=" AccumDeprDispACCID=N'0',"),""!=a[0].AcqnCostDispACCID.ActualValue?o+=" AcqnCostDispACCID=N'"+a[0].AcqnCostDispACCID.ActualValue+"',":this.IsUpdate||(o+=" AcqnCostDispACCID=N'0',"),""!=a[0].GainsDispACCID.ActualValue?o+=" GainsDispACCID=N'"+a[0].GainsDispACCID.ActualValue+"',":this.IsUpdate||(o+=" GainsDispACCID=N'0',"),""!=a[0].LossDispACCID.ActualValue?o+=" LossDispACCID=N'"+a[0].LossDispACCID.ActualValue+"',":this.IsUpdate||(o+=" LossDispACCID=N'0',"),""!=a[0].MaintExpenseACCID.ActualValue?o+=" MaintExpenseACCID=N'"+a[0].MaintExpenseACCID.ActualValue+"',":this.IsUpdate||(o+=" MaintExpenseACCID=N'0',"),""!=a[0].LocationID.ActualValue&&"0"!=a[0].LocationID.ActualValue&&(T+='<Row ID="0" CCID="1" NodeID="'+a[0].LocationID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),""!=a[0].EmployeeID.ActualValue&&"0"!=a[0].EmployeeID.ActualValue&&(T+='<Row ID="0" CCID="2" NodeID="'+a[0].EmployeeID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),this.IsUpdate){let V=this.ReturnAssets();if(null!=V&&V.Tables.length>0)if(this.IsCode){let _=V.Tables[0].filter(Z=>Z.AssetCode==a[0].AssetCode.ActualValue);_.length>0&&(this.objAsset.AMAssetID=parseInt(_[0].AssetID.toString()),this.objAsset.AMGUID=_[0].GUID.toString())}else{let _=V.Tables[0].filter(Z=>Z.AssetName==a[0].AssetName.ActualValue);_.length>0&&(this.objAsset.AMAssetID=parseInt(_[0].AssetID.toString()),this.objAsset.AMGUID=_[0].GUID.toString())}null==this.objAsset.AMGUID&&(this.objAsset.AMGUID=N.J0.NewGuid()),(""==a[0].PurchaseValue.ActualValue||""==a[0].ParentAssetID.ActualValue)&&(d=I.d.document.GetDataSet("select isnull(PurchaseValue,0) PurchaseValue,ParentAssetID,isnull(SerialNo,'') SerialNo from ACC_Assets A with(nolock) where A.AssetID="+this.objAsset.AMAssetID))}else this.objAsset.AMAssetID=0,this.objAsset.AMGUID=N.J0.NewGuid();this.objAsset.AMCode=a[0].AssetCode.ActualValue,this.objAsset.AMName=a[0].AssetName.ActualValue,this.objAsset.AMStatusID=1,this.objAsset.Sno=""!=a[0].SerialNo.ActualValue?a[0].SerialNo.ActualValue:""==a[0].SerialNo.ActualValue&&null!=d&&d.length>0?String(d.Rows[0].SerialNo):a[0].SerialNo.ActualValue,""!=a[0].PurchaseValue.ActualValue?this.objAsset.AMPurchaseValue=a[0].PurchaseValue.ActualValue:""==a[0].PurchaseValue.ActualValue&&d.length>0&&(this.objAsset.AMPurchaseValue=String(d.Rows[0].PurchaseValue)),""!=a[0].ParentAssetID.ActualValue?this.objAsset.AMParentAssetID=parseInt(a[0].ParentAssetID.ActualValue):""==a[0].ParentAssetID.ActualValue&&d.length>0&&(this.objAsset.AMParentAssetID=parseInt(d.Rows[0].ParentAssetID)),this.objAsset.AMGroup=!1;for(let V of this.grData.Table)null==V[1]||""==V[1].toString()||"0"==V[1].toString()||(t.filter(_=>_.CostCenterColID==_[1].toString()),t.length>0&&(this.objAsset.AMGroup=!1,0==N.J0.stringCompare(t[0].SysColumnName.toString(),"IsGroup",!0)&&(""==this.ExcelTable[C][V.FieldName.toString().Trim()]||"YES"!=this.ExcelTable[C][V.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[C][V.FieldName.toString().Trim()]?""!=this.ExcelTable[C][V.FieldName.toString().Trim()]&&("NO"==this.ExcelTable[C][V.FieldName.toString().Trim()].toUpperCase()||"0"==this.ExcelTable[C][V.FieldName.toString().Trim()])&&(this.objAsset.AMGroup=!1):this.objAsset.AMGroup=!0)));this.objAsset.DetailsXML=o.toString().replace("&","&amp;"),this.objAsset.ChangeValueXML="",this.objAsset.CustomFieldsQuery=m,this.objAsset.CustomCostCenterFieldsQuery=p,this.ErrorMessage="";let x=null;a[0].OriginalDeprStartDate.ActualValue.length>0?x=new Date(a[0].OriginalDeprStartDate.ActualValue):this.IsUpdate&&null!=f&&f.length>0&&0==a[0].OriginalDeprStartDate.ActualValue.length&&(x=new Date(f.Rows[0].OriginalDeprStartDate.toString()));let R=a[0].PreviousDepreciation.ActualValue;N.J0.DoubleTryParse(R);let w="";if(w=""==[0].SalvageValue.ActualValue?"0":2==g?(parseFloat([0].SalvageValue.ActualValue)*(parseFloat(a[0].DeprStartValue.ActualValue)+R)/100).toString():parseFloat([0].SalvageValue.ActualValue).toString(),this.IsUpdate&&null!=f&&f.length>0&&""==[0].SalvageValue.ActualValue&&f.Rows[0].SalvageValue.toString(),"1"==a[0].IsDeprSchedule.ActualValue?(this.objAsset.DepreciationXML=this.GetDepreciationXML(parseFloat(a[0].DeprStartValue.ActualValue),a[0].EstimateLife.ActualValue,a[0].IsDeprSchedule.ActualValue,x,R,w,a[0].Period.ActualValue,new Date(i),a[0].DepreciationMethod.ActualValue,a[0].AveragingMethod.ActualValue),this.ErrorMessage=this.objAsset.DepreciationXML):this.objAsset.DepreciationXML="",T.length>0&&(T="<XML>"+T+"</XML>"),this.objAsset.HistoryXML=T,this.objAsset.NotesXML="",s="",u="",this.objAsset.AttachmetsXML="",""!=a[0].AssetImage.ActualValue){let V=a[0].AssetImage.ActualValue;if(V.length>0){let _=V.split(";");try{V=_[0]}catch{s=""}}}if(""!=a[0].Attachments.ActualValue){let V=a[0].Attachments.ActualValue;if(V.length>0){let _=V.split(";");try{for(let Z of _);}catch{u=""}}}s.length>0&&(this.objAsset.AttachmetsXML=s),u.length>0&&(this.objAsset.AttachmetsXML+=u);let U=0;if(this.IsUpdate&&null!=b&&0==b.Tables[0].length&&!N.J0.IsEmpty(this.objAsset.DepreciationXML)&&(h=lt.V.DeleteAssetDeprSchedule(this.objAsset.AMAssetID)),U=0,0==this.ErrorMessage.length&&!h.Contains("exists")){let V=this.objAsset.SetAssetManagementDetails();this.ErrorMessage=V}U<=0&&(e++,this.FailedRecourdList.push({Name:"Code :: "+a[0].AssetCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(C+1-e).toString(),this.FailedCount="Failed :"+e.toString(),this.DisplayMessage="Import completed for Row :: "+(C+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAssetMaster(e){let i=0,l=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let s=null,u=null,h=I.d.document.GetScreenInfo(e),t=null;h.Tables.length>0&&null!=h.Tables[0]&&(t=h.Tables[0]);let o=new It(t),r="",d=0;for(let c=0;c<this.ExcelTable.length;c++,this.ProgressValue++){this.objAsset.AssetClassID=0,this.objAsset.DeprBookID=0,this.objAsset.PostingGroupID=0;for(let a=0;a<o.lstColumn.length;a++)o.lstColumn[a].ActualValue="";for(let a=0;a<this.grData.Table.length;a++)null==this.grData.Table[a].FeatureFieldName||""==this.grData.Table[a].FeatureFieldName.toString()||(l.filter(g=>""!==g.SysColumnName&&g.CostcenterColID.toString()===this.grData.Table[a].FeatureFieldName.toString()),l.length>0&&(r=l[0].SysColumnName.toString(),o[0].SysColumnName.ActualValue="LISTBOX"==o[0].SysColumnName.UserColumnType.toUpperCase()&&o[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[c][this.grData.Table[a].FieldName.toString()+"_Key"].toString():"DATE"==o[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[c][this.grData.Table[a].FieldName.toString()]?new Date(this.ExcelTable[c][this.grData.Table[a].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[c][this.grData.Table[a].FieldName.toString()],""!=o[0].SysColumnName.ActualValue&&("DeprPosting"==r?"monthly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"yearly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="2":"quarterly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="3":"halfyearly"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="4"):"DeprBookID"==r||"FAAccountsID"==r?(d=0,"DeprBookID"==r?I.d.document.GetAssetNodeID(4,o[0].SysColumnName.ActualValue,this.IsCode):"FAAccountsID"==r&&I.d.document.GetAssetNodeID(3,o[0].SysColumnName.ActualValue,this.IsCode),d>0&&(o[0].SysColumnName.ActualValue=d.toString())):"StatusID"==r?(u=h.Tables[3].Select(h.Tables[3].Columns[1].ColumnName+"='"+o[0].SysColumnName.ActualValue+"' OR "+h.Tables[3].Columns[2].ColumnName+"='"+o[0].SysColumnName.ActualValue+"'"),u.length>0&&(o[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprBookMethod"==r?(u=h.Tables[4].Select(h.Tables[4].Columns[1].ColumnName+"='"+o[0].SysColumnName.ActualValue+"'"),u.length>0&&(o[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprMethodBasedOn"==r?"acquisitionvalue/total"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"percentageonacquisitionvalue"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="2"):"AveragingMethod"==r?"calendardays"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="1":"fullmonth"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?o[0].SysColumnName.ActualValue="2":"midmonth"==o[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(o[0].SysColumnName.ActualValue="3"):"SalvageValueType"==r?"value"==o[0].SysColumnName.ActualValue.toLowerCase()?o[0].SysColumnName.ActualValue="1":"percentage"==o[0].SysColumnName.ActualValue.toLowerCase()&&(o[0].SysColumnName.ActualValue="2"):"IncludeSalvageInDepr"==r&&(o[0].SysColumnName.ActualValue="yes"==o[0].SysColumnName.ActualValue.toLowerCase()||"1"==o[0].SysColumnName.ActualValue?"True":"False"))));if(this.IsUpdate){let a="";if(this.IsCode?74==e?a="select * from ACC_AssetClass with(nolock) where AssetClassCode='"+o[0].AssetClassCode.ActualValue+"'":75==e?a="select * from ACC_DeprBook with(nolock) where DeprBookCode='"+o[0].DeprBookCode.ActualValue+"'":77==e&&(a="select * from ACC_PostingGroup with(nolock) where PostGroupCode='"+o[0].PostGroupCode.ActualValue+"'"):74==e?a="select * from ACC_AssetClass with(nolock) where AssetClassName='"+o[0].AssetClassName.ActualValue+"'":75==e?a="select * from ACC_DeprBook with(nolock) where DeprBookName='"+o[0].DeprBookName.ActualValue+"'":77==e&&(a="select * from ACC_PostingGroup with(nolock) where PostGroupName='"+o[0].PostGroupName.ActualValue+"'"),s=I.d.document.GetDataSet(a),s.length>0){74==e?this.objAsset.AssetClassID=N.J0.Int(s.Rows[0][0].toString()):75==e?this.objAsset.DeprBookID=N.J0.Int(s.Rows[0][0].toString()):77==e&&(this.objAsset.PostingGroupID=N.J0.Int(s.Rows[0][0].toString())),this.objAsset.GUID=s.Rows[0].GUID.toString();for(let g=0;g<o.lstColumn.length;g++)""==o.lstColumn[g].ActualValue&&(o.lstColumn[g].ActualValue=s.Rows[0][o.lstColumn[g].SysColumnName].toString())}null==this.objAsset.GUID&&(this.objAsset.GUID=N.J0.NewGuid())}let n=0;if(74==e){this.objAsset.AssetClassCode=o[0].AssetClassCode.ActualValue.replace("&","&amp;"),this.objAsset.AssetClassName=o[0].AssetClassName.ActualValue.replace("&","&amp;"),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.PostingGroupID=N.J0.Int(o[0].FAAccountsID.ActualValue),this.objAsset.DeprBookID=N.J0.Int(o[0].DeprBookID.ActualValue),this.objAsset.DeprTypeID=N.J0.Int(o[0].DeprPosting.ActualValue),this.objAsset.TotalYears=N.J0.DoubleTryParse(o[0].TotalYears.ActualValue);let a=this.objAsset.SaveAssetClass();this.ErrorMessage=a}else if(75==e){this.objAsset.DeprBookCode=o[0].DeprBookCode.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookName=o[0].DeprBookName.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookMethod=N.J0.Int(o[0].DeprBookMethod.ActualValue),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.AveragingMethodID=N.J0.Int(o[0].AveragingMethod.ActualValue),this.objAsset.DeprBookMethodBasedOnValue=N.J0.DoubleTryParse(o[0].BasedOnValue.ActualValue),this.objAsset.DeprBookMethodBasedOn=N.J0.Int(o[0].DeprMethodBasedOn.ActualValue),""==o[0].SalvageValueType.ActualValue&&(o[0].SalvageValueType.ActualValue="1"),""==o[0].IncludeSalvageInDepr.ActualValue&&(o[0].IncludeSalvageInDepr.ActualValue="False");let a=this.objAsset.SaveDeprBook(parseInt(o[0].SalvageValueType.ActualValue),parseFloat([0].SalvageValue.ActualValue),(0,j.yG0)(o[0].IncludeSalvageInDepr.ActualValue));this.ErrorMessage=a}else 77==e&&(this.objAsset.PostGroupCode=o[0].PostGroupCode.ActualValue.replace("&","&amp;"),this.objAsset.PostGroupName=o[0].PostGroupName.ActualValue.replace("&","&amp;"),this.objAsset.AcqnCostACCID=N.J0.Int([0].AcqnCostACCID.ActualValue),this.objAsset.AccumDeprACCID=N.J0.Int(o[0].AccumDeprACCID.ActualValue),this.objAsset.AcqnCostDispACCID=N.J0.Int(o[0].AcqnCostDispACCID.ActualValue),this.objAsset.AccumDeprDispACCID=N.J0.Int(o[0].AccumDeprDispACCID.ActualValue),this.objAsset.GainsDispACCID=N.J0.Int(o[0].GainsDispACCID.ActualValue),this.objAsset.LossDispACCID=N.J0.Int(o[0].LossDispACCID.ActualValue),this.objAsset.MaintExpenseACCID=N.J0.Int(o[0].MaintExpenseACCID.ActualValue),this.objAsset.DeprExpenseACCID=N.J0.Int(o[0].DeprExpenseACCID.ActualValue),this.objAsset.StatusID=N.J0.Int(o[0].StatusID.ActualValue),this.objAsset.SaveFAPostingGroup());n<=0&&(i++,74==e?this.FailedRecourdList.push({Name:"Code :: "+o[0].AssetClassCode.ActualValue,Message:this.ErrorMessage}):75==e?this.FailedRecourdList.push({Name:"Code :: "+o[0].DeprBookCode.ActualValue,Message:this.ErrorMessage}):77==e&&this.FailedRecourdList.push({Name:"Code :: "+o[0].PostGroupCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(c+1-i).toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed for Row :: "+(c+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ScanAssetCostCenterFields(e){let i=this.costCenterTableZero;for(let l=0;l<this.ExcelTable.length;l++)for(let s of this.grData.Table)if(null!=s[1]&&""!=s[1].toString()&&"0"!=s[1].toString()&&(i.filter(u=>u.CostCenterColID==s[1].toString()),i.length>0&&(null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0&&""!=this.ExcelTable[l][s.FieldName.toString()]&&parseInt(s.FeatureFieldName)>0&&this.CheckCostCenterField(l,parseInt(i[0].ColumnCostCenterID.toString()),s.FieldName.toString(),!1,e),("UOM"==i[0].SysColumnName.toString()||"11"==i[0].ColumnCostCenterID.toString())&&(this.UomCol=this.ExcelTable[s.FieldName.toString()].ColumnName+"_Key",this.ExcelTable.Contains(this.UomCol)||(this.ExcelTable.push(this.UomCol),this.temp.push(parseInt(i[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[l][s.FieldName.toString().Trim()])))){let u=2;this.CostCenterFieldsAllTables.Tables[u].filter(t=>t.UnitName==this.ExcelTable[l][s.FieldName.toString().Trim()]).length>0&&(this.ExcelTable[l][this.UomCol]=this.CostCenterFieldsAllTables.Tables[u][0].UOMID.toString())}return!0}GetDepreciationXML(e,i,l,s,u,h,t,o,r,d){this.ErrorMessage="";let n=0,a=0,g=0;try{let S=i.split(".");n=N.J0.Int(S[0]),S.length>1&&(a=N.J0.Int(S[1])),S.length>2&&(g=N.J0.Int(S[2]))}catch{}if("0"!=l&&n<=0&&a<=0&&g<=0)return e>0&&(this.ErrorMessage="Enter EstimatedLife in Depreciation Tab"),"";if(g>0&&"3"==d)return this.ErrorMessage="Mid-Month method can not be applied if estimated life provided with days.","";let p,T=o;p=T.AddYears(n),p=p.AddMonths(a),p=p.AddDays(g),p=p.AddDays(-1);let m=new bt.D(0);return m.CallFromAssetSave=!0,m.GetScheduleData(e,n,a,g,s,u,parseFloat(h),r,t,0,d,T,p,null,this.objAsset.DeprBookID.toString()),this.ErrorMessage=m.ErrorMessage,m.GetXML()}ImportUsers(){let e=[];e.push(1,"Cash"),e.push(2,"Bank"),e.push(3,"BankCC"),e.push(4,"Sales"),e.push(5,"Purchase"),e.push(6,"Creditors"),e.push(7,"Debtors"),e.push(8,"Trading Income"),e.push(9,"Trading Expense"),e.push(10,"Petty Cash"),e.push(11,"Income"),e.push(12,"Expense"),e.push(13,"Assets"),e.push(14,"Liabilities"),e.push(15,"Contra Asset"),e.push(16,"Equity");let i=[];i.push(1,"General"),i.push(2,"Serialised Items"),i.push(3,"Kit"),i.push(4,"Matrix"),i.push(5,"Batch"),i.push(6,"Service Item"),i.push(7,"Serialised & Kit"),i.push(8,"Dynamic"),i.push(9,"Assembled"),i.push(10,"Asset"),i.push(11,"Modifiers"),i.push(12,"Modifiers with Inventory");let l=[],s="";if(0==this.grData.Table.filter(V=>"22898"==V.FeatureFieldName).length)return this.DisplayMessage="UserName Not Exists",void(this.MessageVisibility=!0);let u=this.costCenterTableZero,h=null,t="",o=0,r="",d="",c="",n="",a="",g="",p="",T="",m="",S="1",F="True",y="",C=0,f=0,b=0,x=0,R=1,w=0;this.FillCostCenterFields(!1);for(let V=0;V<this.ExcelTable.length;V++,this.ProgressValue++){r="",d="",c="",a="",g="",p="",T="",m="",S="1",F="True",C=0,f=0,b=0,x=0,R=1,w=0,y="",t="",s="";for(let W=0;W<this.grData.Table.length;W++)if(null!=this.grData.Table[W].FeatureFieldName&&""!=this.grData.Table[W].FeatureFieldName.toString()&&(u.filter(re=>re.CostCenterColID===this.grData.Table[W].FeatureFieldName.toString()),u.length>0)){switch(n=u[0].SysColumnName.toString(),n){case"UserName":this.CheckCostCenterField(V,7,this.grData.Table[W].FieldName.toString(),!1,this.IsCode),r=this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()],this.ExcelTable.Contains(this.grData.Table[W].FieldName.toString()+"_Key")&&""!=this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()&&(C=parseInt(this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()),h=I.d.document.GetUsersDet(C.toString()));break;case"Password":d=this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()];break;case"Email1Password":case"Email2Password":N.J0.IsEmptySpace(this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()])?c+=n+" =N'',":c+=n+" =N'@ENC@"+N.J0.EncryptString(this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()])+"',";break;case"DivisionID":this.CheckCostCenterField(V,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[W].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[W].FieldName.toString()+"_Key")&&(x=parseInt(this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()));break;case"LocationID":this.CheckCostCenterField(V,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[W].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[W].FieldName.toString()+"_Key")&&(b=parseInt(this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()));break;case"RoleID":this.CheckCostCenterField(V,6,this.grData.Table[W].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[W].FieldName.toString()+"_Key")&&(f=parseInt(this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()));break;case"StatusID":R="in active"==this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()].toLowerCase()?2:1;break;case"AccountTypes":if(p=this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()],p.length>0){let B=p.split(";");p="";for(let ae=0;ae<B.length;ae++)for(let he of e)B[ae].toString()==he.Value&&(p+='<Row  CostCenterId="2" FeatureTypeID="'+he.Key+'"/>')}break;case"ProductTypes":if(T=this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()],T.length>0){let B=T.split(";");T="";for(let ae=0;ae<B.length;ae++)for(var U of i)B[ae].toString()==U.Value&&(T+='<Row  CostCenterId="3" FeatureTypeID="'+U.Key+'"/>')}break;case"LicenseCount":w=parseInt(this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()]);break;case"Online/Offline":F="OFFLINE"==this.ExcelTable[V][this.grData.Table[W].FieldName.toString()].toUpperCase()?"False":"True";break;case"2StepVerificationMode":m=this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()];break;case"Language":S="ENGLISH"==this.ExcelTable[V][this.grData.Table[W].FieldName.toString()].toUpperCase()?"1":"2";break;case"UserImage":let re=this.ExcelTable[V][this.grData.Table[W].FieldName.toString()];if(re.length>0){let B=re.split(";");try{re=B[0]}catch{g=""}}break;default:n.startsWith("Assigned_")||(null!=u[0].ColumnCostCenterID&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0?c+=n+" ='"+this.ExcelTable[V][this.grData.Table[W].FieldName.toString()+"_Key"].toString()+"',":c+=n+" =N'"+k.Dw.GetValidXml(this.ExcelTable[V][this.grData.Table[W].FieldName.toString().Trim()])+"',")}if(n.startsWith("Assigned_")){let re=null,B=this.ExcelTable[V][this.grData.Table[W].FieldName.toString()],ae=[];if(ae.Clear(),!N.J0.IsEmpty(B)){re=B.split(",");let he=parseInt(u[0].ColumnCostCenterID.toString());this.grData.Table[W].FieldName.toString();for(let E=0;E<re.length;E++)ae.push(he,I.d.document.GetCostCenterDetailsBYCostCenterID(he,"").Tables[0]),ae[he].RowFilter=this.IsCode?"Code='"+re[E].toString().Trim().replace("'","''")+"'":"Name='"+re[E].toString().Trim().replace("'","''")+"'",ae[he].length>0&&(y+='<Row  CostCenterId="'+he+'" NodeID="'+ae[he][0].NodeID+'"/>'),ae.Clear()}}}a=null!=h&&h.Tables[0].length>0?h.Tables[0][0].GUID.toString():N.J0.NewGuid(),(p.length>0||T.length>0)&&(t+="<XML>",p.length>0&&(t+=p),T.length>0&&(t+=T),t+="</XML>"),y.length>0&&(s+="<XML>",s+=y,s+="</XML>");let _=0;l.push(C),l.push(f),l.push(r),l.push(N.J0.EncryptString(d)),l.push(R),l.push(S),l.push(F),l.push(m),l.push(""),l.push("False"),l.push(c),l.push(I.d.SessionManager.CompanyIndex),l.push(s.toString()),l.push(t.toString()),l.push(""),l.push(w),l.push(""),l.push(g),l.push(""),l.push(""),l.push(b),l.push(x),l.push(N.J0.NewGuid()),l.push(a),l.push(I.d.SessionManager.UserName),l.push(I.d.SessionManager.UserID),l.push(I.d.SessionManager.RoleID),l.push(I.d.SessionManager.LanguageID);let Z=I.d.document.CreateUser(l);Z&&(_=Z.UID),l.Clear(),_<=0&&(o++,this.FailedRecourdList.push({Name:"Name : "+r,Message:this.ErrorMessage})),this.ImportedCount="Imported :"+(V+1-o).toString(),this.FailedCount="Failed :"+o.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCodeData(e,i){try{let u,h,l=this.grData.Table,s="",t=!1;for(let c of this.xDocCodeDef.DocumentElement)if(u=parseInt(c.attributes.CCCID.Value),-5==u)t=!0;else if(u>0){if(l.filter(n=>n.FeatureFieldName==c.attributes.CCCID.Value),l.length>0){let n=k.Dw.GetValidXml(e[l[0].FieldName.toString().Trim()]);if(n.length>0)if(h=c.attributes.Type.Value.toUpperCase(),"DATE"==h){let a=n;N.J0.isValidDate(a)&&(s+='<Row ColID="'+u+'" Value="'+a.toLocaleDateString("dd MMM yyyy")+'" />')}else e.includes(l[0].FieldName+"_Key")&&""!=e[l[0].FieldName+"_Key"].toString()?s+='<Row ColID="'+u+'" Value="'+e[l[0].FieldName+"_Key"].toString()+'" />':s+='<Row ColID="'+u+'" Value="'+n+'" />'}}else u<0&&(l.filter(n=>n.FeatureFieldName==c.attributes.CCCID.Value),l.length>0&&e.includes(l[0].FieldName+"_Key")&&""!=e[l[0].FieldName+"_Key"].toString()&&(s+='<Row ColID="'+u+'" Value="'+e[l[0].FieldName+"_Key"].toString()+'" />'));s.length>0&&(s.Insert(0,"<Data>"),s+="</Data>");let o=1;16!=parseInt(this.Feature.SelectedValue)||1==i?i=0:o=i,t&&0==i&&(this.costCenterTableZero.filter(c=>"ParentGroupName"==c.SysColumnName),this.costCenterTableZero.length>0&&(l.filter(c=>c.FeatureFieldName==this.costCenterTableZero[0].CostCenterColID.toString()),l.length>0&&(o=this.GetParentID(parseInt(this.Feature.SelectedValue),k.Dw.GetValidXml(e[l[0].FieldName.toString().Trim()])))));let r=!1,d=this.grData.Table.filter(c=>"IsGroup"==c.FieldName);return d.length>0&&("true"==e[d[0].FieldName.toString().Trim()].toLowerCase()||"yes"==e[d[0].FieldName.toString().Trim()].toLowerCase()||"y"==e[d[0].FieldName.toString().Trim()].toLowerCase()||"1"==e[d[0].FieldName.toString().Trim()]||"on"==e[d[0].FieldName.toString().Trim()].toLowerCase())&&(r=!0),I.d.common.GetCodeData(parseInt(this.Feature.SelectedValue),o,s.toString(),!1,r)}catch(l){return Logger.ErrorLog("Import :: GetCodeData ",l),null}}GetParentID(e,i){try{let l,s;2==e?(l="AccountName",s="AccountID"):3==e?(l="ProductName",s="ProductID"):(l="Name",s="ID");let t=I.d.document.GetDataSet("declare @SQL nvarchar(500)\nselect @SQL=TableName from adm_features with(nolock) where featureid=\" + CostCenterID + @\"\nset @SQL='select \" + PK + \" ID from '+@SQL+' with(nolock) where \" + colName + \"=''\" + GroupName + @\"'''\nexec(@SQL) ");return N.J0.Int(t.Tables[0].ID.toString())}catch{return 1}}OnMessageCallBack(){this.res="Yes"}ConvertHoursToMinutes(e){let i=0,l=0,s=0;const u=e.split(":");return s=N.J0.Int(u[0]),u.length>1&&(l=N.J0.Int(u[1]),1==l.toString().length&&(l=parseInt(l.toString()+"0",10))),i=60*s+l,i}GetDailyAttendanceDetails(e,i,l,s,u,h,t,o,r){try{let d=new He.bT;this.ConstructFormulaFields(d);let c=[],n=null,a=null,g="",p="",T="";if(0==e){c.push(u.toLocaleDateString("dd/MMM/yyyy")),c.push(0),c.push(l),c.push(i),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.LanguageID);let m=I.d.common.GetDataSet_SP(c,"spPAY_ExtGetTimings");m.Tables.length>0&&(this.intValidDay=parseInt(m.Tables[0][0].VALIDDAY),this.FromDateTime=new Date(m.Tables[0][0].STARTTIME),this.ToDatetime=new Date(m.Tables[0][0].ENDTIME)),p+="dcAlpha5=N'"+m.Tables[0][0].VALIDDAY.toString()+"', ",p+="dcAlpha4=N'0', ",p+="dcAlpha10=N'1', ",p+="dcAlpha11=N'1', ",p+="dcAlpha12=N'0', ",p+="dcAlpha13=N'1', ",a=this.grData.Table,a.filter(S=>36591==S.FeatureFieldName),0==a.length&&(p+="dcAlpha2=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay.toString()+"', ",this.SetFieldValue(d,"dcAlpha2",this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay)),a.RowFilter="FeatureFieldName=36592",0==a.length&&(p+="dcAlpha3=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay.toString()+"', ",this.SetFieldValue(d,"dcAlpha3",this.ToDatetime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay)),T=p}else if(1==e){if(c.push(i),c.push(0),c.push(t),c.push(u.toLocaleDateString("dd/MMM/yyyy")),c.push(l>0?l:1),c.push(s>0?s:1),c.push(0),c.push(1),c.push(h),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.LanguageID),n=I.d.common.GetDataSet_SP(c,"spPAY_ExtCalcHours"),n.Tables.length>0){this.dblTotalHours=0;let y,C,f,b,m=null,S="",F="",x=1;if(y=C=b=f=0,m=this.costCenterTableZero,m.length>0){m.RowFilter="CostCenterColID=36561",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",f=parseFloat(n.Tables[0][0].NRMLHRSOP.toString().Trim())),m.RowFilter="CostCenterColID=36562",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",b=parseFloat(n.Tables[0][0].NORMALRATEOP.toString().Trim())),parseFloat(f)>0&&(C=this.ConvertHoursToMinutes(f.toString())*(b/60),y=C),m.RowFilter="CostCenterColID=36563",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0].BREAKHRSOP.toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0].BREAKHRSOP.toString().Trim())+", ");for(let R=5;R<=14;R++)b=f=C=0,F="OT"+x.toString(),S="dcNum"+R.toString(),m.RowFilter="sysColumnName='"+S+"'",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",f=parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())),F="OT"+x.toString()+"Rate",S="dcNum"+(R+1).toString(),m.RowFilter="sysColumnName='"+S+"'",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())+", ",b=parseFloat(n.Tables[0][0][F+"OP"].toString().Trim())),parseFloat(f)>0&&(C=this.ConvertHoursToMinutes(f.toString())*(b/60),y+=C),R++,x++;m.RowFilter="CostCenterColID=36574",m.length>0&&(g+=m[0].SysColumnName.toString()+"="+parseFloat(y.toString().Trim())+", ",g+="dcCalc"+m[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(y.toString().Trim())+", ")}T=g}}else if(2==e){if("0"!=o.toString()&&"0"!=r.toString()&&(a=this.grData.Table,a.filter(m=>36560==m.FeatureFieldName),0==a.length&&(a=this.costCenterTableZero,a.RowFilter="CostCenterColID=36560",a.length>0))){let m="",S=new Date(r),F=new Date(o),y=N.J0.ParseDate(S).Subtract(N.J0.ParseDate(F));m=y.Hours+"."+y.Minutes,this.dblTotalHours=parseFloat(m),g+=a[0].SysColumnName.toString()+"="+parseFloat(m)+", ",g+="dcCalc"+a[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(m)+", "}T=g}return T.toString()}catch(d){return Logger.ErrorLog("Import :: GetDailyAttendanceDetails ",d.message),null}}UpdateExcelSheet(){if(this.UpdateStatusInExcel&&this.IsExcel&&this.ExcelTable&&0!==this.ExcelTable.length)try{const e=this.workbookK,i=e.SheetNames[0];let s=this.ExcelData,u=0,h=0,t=0;for(let r=0;r<150;r++){const d=s[0]?.[r];if("IMPORT_STATUS"===d){if(u=r,h>0)break}else if("IMPORT_MESSAGE"===d){if(h=r,u>0)break}else(!d||""===d)&&0===t&&(t=r-1)}0===u&&(t++,s[0][t]="IMPORT_STATUS",u=t),0===h&&(t++,s[0][t]="IMPORT_MESSAGE",h=t);for(let r=0;r<this.ExcelTable.length;r++){if(this.ExcelTable[r].IsNewRow&&"1"===this.ExcelTable[r].IsNewRow.toString())continue;const d=r+1;s[d]||(s[d]=[]),(!s[d][u]||"PASS"!==s[d][u])&&(s[d][u]=this.ExcelTable[r].xIMP_STATUSx||"",s[d][h]=this.ExcelTable[r].IMPORT_MESSAGE||"")}const o=et.Wp.aoa_to_sheet(s);e.Sheets[i]=o,et._h(e,this.ActualFileName)}catch(e){console.error("Error in UpdateExcelSheet:",e.message||e)}}s2ab(e){const i=new ArrayBuffer(e.length),l=new Uint8Array(i);for(let s=0;s<e.length;s++)l[s]=255&e.charCodeAt(s);return i}formatDDMMMYYYY(e){const l=e instanceof Date?e:new Date(e);return isNaN(l.getTime())?"":`${("0"+l.getDate()).slice(-2)}/${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()]}/${l.getFullYear()}`}formatMonthName(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][Math.max(1,Math.min(12,e))-1]}daysInMonth(e,i){return new Date(e,i,0).getDate()}FillBomDetails(){const e=this.Feature?.SelectedValue;[{CostCenterColID:"-1",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"RawMaterial",ResourceKey:I.d.GetResource("RawMaterial")},{CostCenterColID:"-12",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"OutPutProduct",ResourceKey:I.d.GetResource("OutPutProduct")},{CostCenterColID:"-2",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Qty",ResourceKey:I.d.GetResource("Quantity")},{CostCenterColID:"-3",ColumnCostCenterID:"11",ColumnDataType:"LISTBOX",SysColumnName:"UOMID",ResourceKey:I.d.GetResource("UOM")},{CostCenterColID:"-4",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"UnitPrice",ResourceKey:I.d.GetResource("UnitPrice  ")},{CostCenterColID:"-5",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Value",ResourceKey:I.d.GetResource("Value")},{CostCenterColID:"-6",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Wastage",ResourceKey:I.d.GetResource("Waistage")},{CostCenterColID:"-7",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"CreditAccount",ResourceKey:"Credit Account"},{CostCenterColID:"-15",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"DebitAccount",ResourceKey:"Debit Account"},{CostCenterColID:"-8",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExpenseCharges",ResourceKey:I.d.GetResource("ExpenseCharges")},{CostCenterColID:"-9",ColumnCostCenterID:"71",ColumnDataType:"LISTBOX",SysColumnName:"Machine",ResourceKey:I.d.GetResource("Machine")},{CostCenterColID:"-10",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"HRS",ResourceKey:I.d.GetResource("HRS")},{CostCenterColID:"-11",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"MachineCharges",ResourceKey:I.d.GetResource("MachineCharges")}].forEach(l=>{const s={CostCenterColID:l.CostCenterColID,CostcenterID:e,ColumnCostCenterID:l.ColumnCostCenterID,ColumnDataType:l.ColumnDataType,SysColumnName:l.SysColumnName,ResourceData:l.ResourceKey,IsColumninuse:"true",IsColumnUserDefined:"false"};this.CostCenterFieldsAllTables.push(s),this.costCenterTableZero.push(s)})}}class It{constructor(e){this.lstColumn=[];for(let i=0;i<e.length;i++){const l=e[i];this.lstColumn.push({CostCenterColID:Number(l.CostCenterColID),ResourceData:(l.ResourceData||"").toString().replace(/ /g,""),SysColumnName:(l.SysColumnName||"").toString(),UserColumnName:(l.UserColumnName||"").toString().replace(/ /g,""),ColumnDataType:(l.ColumnDataType||"").toString(),UserColumnType:(l.UserColumnType||"").toString(),UserDefaultValue:(l.UserDefaultValue||"").toString(),ActualValue:"",ColumnCostCenterID:Number(l.ColumnCostCenterID)})}}getByCostCenterColID(e){for(const i of this.lstColumn)if(i.CostCenterColID===e)return i;return null}getByCostCenterColIDAndName(e,i){for(const l of this.lstColumn)if(i&&""!==i||e>0)if(i&&""!==i&&e>0){if(l.SysColumnName===i&&l.CostCenterColID===e)return l}else if(i&&""!==i){if(l.SysColumnName===i)return l}else if(l.CostCenterColID===e)return l;return null}}class wt{ColumnsXML(e,i){let l="";return l+=8===e&&"Dimension Move"===i?"<XML>\n  <Col ID='DimensionID' Width='100' Combo='TEXT'><Caption>DimensionID**</Caption></Col>\n  <Col ID='DimensionName' Width='160' Combo='TEXT'><Caption>DimensionName**</Caption></Col>\n  <Col ID='Node' Width='160' Combo='TEXT'><Caption>Node*</Caption></Col>\n  <Col ID='Group' Width='160' Combo='TEXT'><Caption>Group*</Caption></Col>\n  <Row DimensionID='2' DimensionName='Account' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='3' DimensionName='Product' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='50002' DimensionName='Location' Node='NNNXXX' Group='GGGXXX' />\n  </XML>":400===e&&"Document Edit"===i?"<XML>\n  <Col ID='VoucherNo' Width='100' Combo='TEXT'><Caption>Doc No*</Caption></Col>\n  <Col ID='OldValue1' Width='160' Combo='TEXT'><Caption>Old Value1*</Caption></Col>\n  <Col ID='NewValue1' Width='160' Combo='TEXT'><Caption>New Value1*</Caption></Col>\n  <Col ID='OldValue2' Width='160' Combo='TEXT'><Caption>Old Value2*</Caption></Col>\n  <Col ID='NewValue2' Width='160' Combo='TEXT'><Caption>New Value2*</Caption></Col>\n  <Col ID='OldValueN' Width='160' Combo='TEXT'><Caption>Old ValueN*</Caption></Col>\n  <Col ID='NewValueN' Width='160' Combo='TEXT'><Caption>New ValueN*</Caption></Col>\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='' NewValue2='' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='' NewValueN='' />\n  </XML>":"<XML></XML>",l}BuildGrid(e,i){let l=new dt.vv;l.Columns=[],l.Table=[],l.SearchVisible=!1;let s=new ct.O7,u=new N.VB;u.LoadXml(this.ColumnsXML(e,i));for(let h of u.DocumentElement.children)if("Col"==h.Name)s=new ct.O7,s.Header=h.SelectSingleNode("Caption").InnerText,s.DisplayMember=h.attributes.ID.Value,s.ReadOnly=!0,s.Width=null!=h.attributes.Width?parseInt(h.attributes.Width.Value):160,l.Columns.push(s),l.TableColumns.push(h.attributes.ID.Value);else if("Row"==h.Name){l.NewRow();const o=h,r={};for(const d of l.TableColumns)r[d]=o.getAttribute(d);l.TableColumns.push(r)}return l.Visible=null!=l.Columns&&l.Columns.length>0,l}}},93621:(Ft,st,le)=>{le.d(st,{t:()=>I});var Ie=le(86739);class I{constructor(){this.CCID=0,this.Status=0,this.BudgetTypeID=0,this.BugetID=0,this.NumDimensions=0,this.QtyType=0,this.IsQtyBudget=0,this.isGroup=!1,this.ChkBudgetOnlyForDefnAccounts=!1,this.Budgetid=0,this.SelectedNodeID=0,this.SbXML=null,this.RelationsXML=null,this.BudgetName=null,this.BudgetType=null,this.CCList="",this.strNonAccountingDocs=null,this.NonAccDocsField=null,this.strInvAccountingDocs=null,this.InvAccDocsField=null,this.AccountTypes=null}GetBudgetScreenDetails(j,Tt,ie=""){let k=[];return k.push(j),k.push(Tt),k.push(ie),k.push(Ie.d.SessionManager.UserID),k.push(Ie.d.SessionManager.LanguageID),Ie.d.common.GetBudgetScreenDetails(k)}SaveBudgetScreenDetails(){let j=[];return j.push(this.SbXML),j.push(this.NumDimensions),j.push(this.CCList),j.push(this.RelationsXML),j.push(this.StartYear),j.push(this.BudgetName),j.push(this.BudgetTypeID),j.push(this.BudgetType),j.push(this.Status),j.push(this.IsQtyBudget),j.push(this.Budgetid),j.push(this.SelectedNodeID),j.push(this.isGroup),j.push(this.QtyType),j.push(this.ChkBudgetOnlyForDefnAccounts),j.push(this.strNonAccountingDocs),j.push(this.NonAccDocsField),j.push(this.strInvAccountingDocs),j.push(this.InvAccDocsField),j.push(this.AccountTypes),j.push(Ie.d.SessionManager.CompanyGUID),j.push(Ie.d.SessionManager.UserName),j.push(Ie.d.SessionManager.UserID),j.push(Ie.d.SessionManager.LanguageID),Ie.d.common.SaveBudgetScreenDetails(j)}SetImportBudget(){let j=[];return j.push(this.SbXML),j.push(this.NumDimensions),j.push(this.CCList),j.push(this.RelationsXML),j.push(this.StartYear),j.push(this.BudgetName),j.push(this.BudgetTypeID),j.push(this.BudgetType),j.push(this.Status),j.push(this.IsQtyBudget),j.push(this.Budgetid),j.push(this.SelectedNodeID),j.push(this.isGroup),j.push(this.QtyType),j.push(this.ChkBudgetOnlyForDefnAccounts),j.push(this.strNonAccountingDocs),j.push(this.NonAccDocsField),j.push(this.strInvAccountingDocs),j.push(this.InvAccDocsField),j.push(this.AccountTypes),j.push(this.IsAppend),j.push(Ie.d.SessionManager.CompanyGUID),j.push(Ie.d.SessionManager.UserName),j.push(Ie.d.SessionManager.UserID),j.push(Ie.d.SessionManager.LanguageID),Ie.d.common.SaveBudgetScreenDetails(j)}}},39559:(Ft,st,le)=>{le.d(st,{h:()=>Ie});class Ie{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}}}]);