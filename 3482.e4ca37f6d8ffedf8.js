"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3482],{3482:(Mt,it,le)=>{le.r(it),le.d(it,{DimDefinition:()=>Ft,ImportTemplates:()=>vt,ImportUtilityViewModel:()=>Si,StringBuilderLike:()=>Ge});var Fe=le(10467),b=le(86739),N=le(8787),K=le(32647),pt=le(23823),te=le(92701),U=le(31820),dt=le(49710),ht=le(18569),_t=le(48792),Ve=le(92840),bt=le(91679),rt=le(20141),at=le(95707),Xt=le(98669),At=le(36466),nt=le(81669),ze=le(62288),ge=le(71336),ve=le(62460),gt=(le(24028),le(33547)),Vt=le(97965),Ct=le(39559),jt=le(92020),Dt=le(67559),Pt=le(93621),Kt=le(26485),Rt=le(35901),Jt=le(73334),Qt=le(40008),Ht=le(50742);class Wt{constructor(){this.RulesListVisible=!1,this.RulesList=[],this.NotesList=[],this.ConfirmList=[],this.NewInfo=[],this.ErrorList=[],this.ButtonClick=new nt.Yk,this.ColumnSource=[]}PreviewDataViewModel(e,i){if(this.Parent=i,this.Parent.IsScaned){if(this.TempExcelTableVisible=!1,this.Parent.NotesList.length>0){this.NotesListVisible=!0;let u,a=0;this.Parent.NotesList.forEach(c=>{u=new Ve.AddNoteViewModel,u.AddNoteViewModel_1(this),u.NoteID=a+1,u.Note.Text=c.Note.Text,u.Note.ToolTipDescription=c.Note.ToolTipDescription,u.Note.Label=c.Note.Label,u.IsModified=!0,this.NotesList.push(u)})}else this.NotesListVisible=!1;this.Parent.RulesList.length>0?(this.RulesList=this.Parent.RulesList,this.RulesListVisible=!0):this.RulesListVisible=!1,this.Parent.ErrorList.length>0?(this.ErrorList=this.Parent.ErrorList,this.ErrorListVisible=!0,this.NextEnable=!1):this.NextEnable=!0,this.Title="Confirmation",this.btnOkText="Confirm"}else this.NotesListVisible=!1,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.TempExcelTableVisible=!0,this.Title="Excel Data",this.btnOkText="Ok";let r;this.DS=[],this.ColumnSource=[],this.CostCenterFields=[],this.DS=i.grData,this.CostCenterFields=i.costCenterTableZero,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.AddColumns(e),this.TempExcelTable=this.ValidateExcelData(e),r="",this.TempExcelTable.forEach(a=>{r+=`[${a}] is null and `}),r.length>5&&(r=r.substring(0,r.length-5)),this.NoofRows="Total No. of Rows in file are "+this.TempExcelTable.length}AddColumns(e){this.TempExcelTable=[],e&&0!=e.length&&Object.keys(e[0]).forEach(r=>{let a=new Ht.i;a.DisplayMember=r,a.HeaderText=r,a.width=r.includes("_Key")?"0":"100",this.ColumnSource.push(a),this.TempExcelTable.push(r)})}ValidateExcelData(e){let i=[];return i=this.CostCenterFields,e.forEach(r=>{this.DS._Table.forEach(a=>{if(null==a.FeatureFieldName||""==a.FeatureFieldName.toString()||"0"==a.FeatureFieldName.toString())return;let c,u=i.filter(t=>t.CostCenterColID=a.FeatureFieldName.toString());switch(c="",u.length>0&&(N.J0.IsEmpty(u[0].ColumnDataType)||(c=u[0].ColumnDataType.toString()),("INT"==c.toUpperCase()&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0||"INT"==c.toUpperCase()&&("AccountTypeID"==u[0].SysColumnName.toString()||"ProductTypeID"==u[0].SysColumnName.toString()))&&(c="TEXT")),c.toUpperCase()){case"INT":""!=r[a[0].toString()].toString()&&null!=r[a[0].toString()]&&""!=r[a[0].toString()].toString()&&N.J0.ValidateInt(r[a[0].toString()].toString())&&(r[a[0].toString()]="Error"),e.AcceptChanges();break;case"DATE":""!=r[a[0].toString()].toString()&&null!=r[a[0].toString()]&&""!=r[a[0].toString()].toString()&&N.J0.isValidDate(r[a[0].toString()].toString())&&(r[a[0].toString()]="Error"),e.AcceptChanges();break;case"FLOAT":""!=r[a[0].toString()].toString()&&null!=r[a[0].toString()]&&""!=r[a[0].toString()].toString()&&N.J0.ValidateDouble(r[a[0].toString()].toString())&&(r[a[0].toString()]="Error"),e.AcceptChanges();break;case"COMBOBOX":parseInt(this.Parent.Feature.SelectedValue.toString())>4e4&&parseInt(this.Parent.Feature.SelectedValue.toString())<5e4&&"VoucherNo"==i[0].SysColumnName.toString()&&""!=r[a[0].toString()].toString()&&null!=r[a[0].toString()]&&(N.J0.ValidateInt(r[a[0].toString()].toString())||(r[a[0].toString()]="NA")),e.AcceptChanges();break;case"LISTBOX":N.J0.IsNum(r[a[0].toString()+"_Key"])&&(r[a[0].toString()]="NA"),e.AcceptChanges()}})}),e}OnButtonClick(e){if(this.Parent.IsPreviewDataOk=!1,"Cancel"==e.toString())this.Parent.IsScaned&&(this.Parent.IsScaned=!1),b.d.page.HideDialog(this.PopUpGUID);else if("Confirm"==e.toString()){let i;i=new Ve.AddNoteViewModel,i.NoteID=0,i.Note.Text="Total no. of Rows: "+this.Parent.ExcelTable.length,this.ConfirmList.push(i),this.btnOkText="Next",this.NextEnable=!0,this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!1,this.ConfirmListVisible=!0,i=new Ve.AddNoteViewModel,i.NoteID=0;for(let a of this.NotesList){i=new Ve.AddNoteViewModel,i.NoteID=0;let u=a.Note.ToolTipDescription.split(",");if(this.Parent.ExcelTable.Columns.Contains(a.Note.Label)){this.Parent.ExcelTable.Columns.Contains("IsDeleted")||this.Parent.ExcelTable.Columns.push("IsDeleted");let c=0;for(let t in u)if(""!=t.toString()){let s=this.Parent.ExcelTable.filter(o=>o.item.Note.Label==t.split("~")[0].toString().Replace("'","''"));if(s.length>0)for(let o in s)a.IsModified||(o.IsDeleted=!0),c++}i.Note.Text=a.IsModified?"New rows for "+a.Note.Label+", Count :"+c:"Removed rows for "+a.Note.Label+", Count :"+c,i.NoteID=c,i.Note.Label=a.Note.Label,this.ConfirmList.push(i),this.Parent.ExcelTable.AcceptChanges()}}i=new Ve.AddNoteViewModel,i.NoteID=0;let r=0;this.Parent.ExcelDataColumn.includes("IsDeleted")&&(r=this.Parent.ExcelTable.Select("IsDeleted='true'").length),i.Note.Text="Number of total rows deleted, count :"+r,this.ConfirmList.push(i)}else if("View"==e.toString()){if(null!=this._SelectedNote){let i;if(""!=this.SelectedNote.Note.ToolTipDescription){this.RulesListVisible=!1,this.ErrorListVisible=!1,this.NotesListVisible=!1,this.NewInfoVisible=!0;let r=[],a=this.SelectedNote.Note.ToolTipDescription.split(",");for(let u=0;u<a.length;u++)""!=a[u].toString()&&(i=new Ve.AddNoteViewModel,i.NoteID=0,i.Note.Label=a[u].toString().substring(a[u].lastIndexOf("~")+1).toString(),i.Note.Text=a[u].toString().substring(0,a[u].lastIndexOf("~")),r.push(i))}}}else if("BackInfo"==e.toString())this.RulesList.length>0&&(this.RulesListVisible=!0),this.ErrorList.length>0&&(this.ErrorListVisible=!0),this.NotesList.length>0&&(this.NotesListVisible=!0),this.NewInfoVisible=!1;else try{this.Parent.IsScaned&&(this.Parent.IsPreviewDataOk=!0,this.Parent.NotesList=this.NotesList,b.d.page.HideDialog(this.PopUpGUID))}catch{}}}var Lt=le(21580),$t=le(27630),Nt=le(91229),C=le(54438),wt=le(60177),It=le(89417),Yt=le(99246),Zt=le(73955);function qt(ee,e){if(1&ee&&(C.qex(0),C.EFF(1,"\n                            "),C.j41(2,"div",16),C.EFF(3,"\n                                "),C.j41(4,"span",17),C.EFF(5),C.k0s(),C.EFF(6,"\n                            "),C.k0s(),C.EFF(7,"\n                        "),C.bVm()),2&ee){const i=e.$implicit;C.R7$(5),C.JRh(i.HeaderText)}}function zt(ee,e){if(1&ee&&(C.qex(0),C.EFF(1,"\n                                    "),C.j41(2,"div",22),C.EFF(3),C.k0s(),C.EFF(4,"\n                                "),C.bVm()),2&ee){const i=e.$implicit,r=C.XpG().$implicit;C.R7$(3),C.SpI("\n                                        ",r[i.DisplayMember],"\n                                    ")}}function ei(ee,e){if(1&ee){const i=C.RV6();C.j41(0,"div",20),C.bIt("click",function(a){const u=C.eBV(i).$implicit,c=C.XpG(3);return C.Njj(c.OnListItemClick(a,u))}),C.EFF(1,"\n                            "),C.j41(2,"div",21),C.EFF(3,"\n                                "),C.DNE(4,zt,5,1,"ng-container",14),C.EFF(5,"\n                            "),C.k0s(),C.EFF(6,"\n                        "),C.k0s()}if(2&ee){const i=C.XpG(3);C.R7$(4),C.Y8G("ngForOf",i.obj.ColumnSource)}}function ti(ee,e){if(1&ee&&(C.j41(0,"div",18),C.EFF(1,"\n                        "),C.DNE(2,ei,7,1,"div",19),C.EFF(3,"\n                    "),C.k0s()),2&ee){const i=C.XpG(2);C.R7$(2),C.Y8G("ngForOf",i.obj.TempExcelTable)}}function ii(ee,e){if(1&ee&&(C.j41(0,"div",10),C.EFF(1,"\n            "),C.j41(2,"div",11),C.EFF(3,"\n                "),C.j41(4,"div",12),C.EFF(5,"\n                    "),C.j41(6,"div",13),C.EFF(7,"\n                        "),C.DNE(8,qt,8,1,"ng-container",14),C.EFF(9,"\n                    "),C.k0s(),C.EFF(10,"\n                    "),C.DNE(11,ti,4,1,"div",15),C.EFF(12,"\n                "),C.k0s(),C.EFF(13,"\n            "),C.k0s(),C.EFF(14,"\n        "),C.k0s()),2&ee){const i=C.XpG();C.R7$(2),C.AVh("List__dropdown--open",i.suggestionsIsOpen),C.R7$(6),C.Y8G("ngForOf",i.obj.ColumnSource),C.R7$(3),C.Y8G("ngIf",null!=i.obj.TempExcelTable)}}function ai(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i)}}function li(ee,e){if(1&ee&&(C.j41(0,"div",23),C.EFF(1,"\n            "),C.j41(2,"div",24),C.EFF(3,"\n                "),C.j41(4,"table",25),C.EFF(5,"\n                    "),C.j41(6,"thead"),C.EFF(7,"\n                        "),C.j41(8,"tr"),C.EFF(9,"\n                            "),C.EFF(10,"\n                            "),C.j41(11,"th"),C.EFF(12,"Note"),C.k0s(),C.EFF(13,"\n                        "),C.k0s(),C.EFF(14,"\n                    "),C.k0s(),C.EFF(15,"\n                "),C.k0s(),C.EFF(16,"\n            "),C.k0s(),C.EFF(17,"\n            "),C.j41(18,"div",26),C.EFF(19,"\n                "),C.j41(20,"table",25),C.EFF(21,"\n                    "),C.j41(22,"tbody"),C.EFF(23,"\n                        "),C.DNE(24,ai,6,2,"tr",27),C.EFF(25,"\n                    "),C.k0s(),C.EFF(26,"\n                "),C.k0s(),C.EFF(27,"\n            "),C.k0s(),C.EFF(28,"\n        "),C.k0s()),2&ee){const i=C.XpG();C.R7$(24),C.Y8G("ngForOf",i.obj.ColumnSource)}}function si(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i.Note.Text)}}function oi(ee,e){if(1&ee&&(C.j41(0,"div",23),C.EFF(1,"\n            "),C.j41(2,"div",24),C.EFF(3,"\n                "),C.j41(4,"table",25),C.EFF(5,"\n                    "),C.j41(6,"thead"),C.EFF(7,"\n                        "),C.j41(8,"tr"),C.EFF(9,"\n                            "),C.EFF(10,"\n                            "),C.j41(11,"th"),C.EFF(12,"Note"),C.k0s(),C.EFF(13,"\n                        "),C.k0s(),C.EFF(14,"\n                    "),C.k0s(),C.EFF(15,"\n                "),C.k0s(),C.EFF(16,"\n            "),C.k0s(),C.EFF(17,"\n            "),C.j41(18,"div",26),C.EFF(19,"\n                "),C.j41(20,"table",25),C.EFF(21,"\n                    "),C.j41(22,"tbody"),C.EFF(23,"\n                        "),C.DNE(24,si,6,2,"tr",27),C.EFF(25,"\n                    "),C.k0s(),C.EFF(26,"\n                "),C.k0s(),C.EFF(27,"\n            "),C.k0s(),C.EFF(28,"\n        "),C.k0s()),2&ee){const i=C.XpG();C.R7$(24),C.Y8G("ngForOf",i.obj.ErrorList)}}function ri(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i.Note.Text)}}function ni(ee,e){if(1&ee){const i=C.RV6();C.j41(0,"div",23),C.EFF(1,"\n            "),C.j41(2,"div",24),C.EFF(3,"\n                "),C.j41(4,"table",25),C.EFF(5,"\n                    "),C.j41(6,"thead"),C.EFF(7,"\n                        "),C.j41(8,"tr"),C.EFF(9,"\n                            "),C.EFF(10,"\n                            "),C.j41(11,"th"),C.EFF(12,"Note"),C.k0s(),C.EFF(13,"\n                        "),C.k0s(),C.EFF(14,"\n                       \n                        "),C.j41(15,"tr"),C.EFF(16,"\n                            "),C.j41(17,"div",29),C.EFF(18,"\n                                "),C.j41(19,"div",30),C.EFF(20,"\n                                    "),C.j41(21,"input",31),C.mxI("ngModelChange",function(a){C.eBV(i);const u=C.XpG();return C.DH7(u.obj.IsModified,a)||(u.obj.IsModified=a),C.Njj(a)}),C.k0s(),C.EFF(22,"\n                                    "),C.EFF(23,"\n                                "),C.k0s(),C.EFF(24,"\n                                "),C.EFF(25,"\n                            "),C.k0s(),C.EFF(26,"\n                        "),C.k0s(),C.EFF(27,"\n                            "),C.EFF(28,"\n                           \n                        \n                    "),C.k0s(),C.EFF(29,"\n                "),C.k0s(),C.EFF(30,"\n            "),C.k0s(),C.EFF(31,"\n            "),C.j41(32,"div",26),C.EFF(33,"\n                "),C.j41(34,"table",25),C.EFF(35,"\n                    "),C.j41(36,"tbody"),C.EFF(37,"\n                        "),C.DNE(38,ri,6,2,"tr",27),C.EFF(39,"\n                    "),C.k0s(),C.EFF(40,"\n                "),C.k0s(),C.EFF(41,"\n            "),C.k0s(),C.EFF(42,"\n        "),C.k0s()}if(2&ee){const i=C.XpG();C.R7$(21),C.R50("ngModel",i.obj.IsModified),C.R7$(17),C.Y8G("ngForOf",i.obj.NotesListVisible)}}function ui(ee,e){if(1&ee){const i=C.RV6();C.j41(0,"button",33),C.nI1(1,"translate"),C.bIt("click",function(){C.eBV(i);const a=C.XpG(2);return C.Njj(a.ButtonClick("BackInfo"))}),C.nrm(2,"i",34),C.EFF(3,"\n    "),C.k0s()}2&ee&&C.FS9("title",C.bMT(1,1,"Back"))}function mi(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                            "),C.j41(6,"td"),C.EFF(7),C.k0s(),C.EFF(8,"\n\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i.Label),C.R7$(3),C.JRh(i.Note.Text)}}function ci(ee,e){if(1&ee){const i=C.RV6();C.j41(0,"div",23),C.EFF(1,"\n\n            "),C.DNE(2,ui,4,3,"button",32),C.EFF(3,"\n            "),C.j41(4,"div",24),C.EFF(5,"\n                "),C.j41(6,"table",25),C.EFF(7,"\n                    "),C.j41(8,"thead"),C.EFF(9,"\n                        "),C.j41(10,"tr"),C.EFF(11,"\n                            "),C.EFF(12,"\n                            "),C.j41(13,"th"),C.EFF(14,"NewInfo"),C.k0s(),C.EFF(15,"\n                        "),C.k0s(),C.EFF(16,"\n                        "),C.j41(17,"tr"),C.EFF(18,"\n                            "),C.j41(19,"div",29),C.EFF(20,"\n                                "),C.j41(21,"div",30),C.EFF(22,"\n                                    "),C.j41(23,"input",31),C.mxI("ngModelChange",function(a){C.eBV(i);const u=C.XpG();return C.DH7(u.obj.IsModified,a)||(u.obj.IsModified=a),C.Njj(a)}),C.k0s(),C.EFF(24,"\n                                    "),C.EFF(25,"\n                                "),C.k0s(),C.EFF(26,"\n                                "),C.EFF(27,"\n                            "),C.k0s(),C.EFF(28,"\n                        "),C.k0s(),C.EFF(29,"\n                            "),C.EFF(30,"\n                           \n                       \n                    "),C.k0s(),C.EFF(31,"\n                "),C.k0s(),C.EFF(32,"\n            "),C.k0s(),C.EFF(33,"\n            "),C.j41(34,"div",26),C.EFF(35,"\n                "),C.j41(36,"table",25),C.EFF(37,"\n                    "),C.j41(38,"tbody"),C.EFF(39,"\n                        "),C.DNE(40,mi,9,3,"tr",27),C.EFF(41,"\n                    "),C.k0s(),C.EFF(42,"\n                "),C.k0s(),C.EFF(43,"\n            "),C.k0s(),C.EFF(44,"\n        "),C.k0s()}if(2&ee){const i=C.XpG();C.R7$(2),C.Y8G("ngIf",i.obj.IsDynamicTree),C.R7$(21),C.R50("ngModel",i.obj.IsModified),C.R7$(17),C.Y8G("ngForOf",i.obj.NewInfo)}}function di(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i.Note.Text)}}function hi(ee,e){if(1&ee&&(C.j41(0,"div",23),C.EFF(1,"\n            "),C.j41(2,"div",24),C.EFF(3,"\n                "),C.j41(4,"table",25),C.EFF(5,"\n                    "),C.j41(6,"thead"),C.EFF(7,"\n                        "),C.j41(8,"tr"),C.EFF(9,"\n                            "),C.EFF(10,"\n                            "),C.j41(11,"th"),C.EFF(12,"Note"),C.k0s(),C.EFF(13,"\n                        "),C.k0s(),C.EFF(14,"\n                    "),C.k0s(),C.EFF(15,"\n                "),C.k0s(),C.EFF(16,"\n            "),C.k0s(),C.EFF(17,"\n            "),C.j41(18,"div",26),C.EFF(19,"\n                "),C.j41(20,"table",25),C.EFF(21,"\n                    "),C.j41(22,"tbody"),C.EFF(23,"\n                        "),C.DNE(24,di,6,2,"tr",27),C.EFF(25,"\n                    "),C.k0s(),C.EFF(26,"\n                "),C.k0s(),C.EFF(27,"\n            "),C.k0s(),C.EFF(28,"\n        "),C.k0s()),2&ee){const i=C.XpG();C.R7$(24),C.Y8G("ngForOf",i.obj.RulesList)}}function gi(ee,e){if(1&ee&&(C.j41(0,"tr",28),C.EFF(1,"\n                            "),C.EFF(2,"\n                            "),C.j41(3,"td"),C.EFF(4),C.k0s(),C.EFF(5,"\n                        "),C.k0s()),2&ee){const i=e.$implicit;C.BMQ("index",e.index),C.R7$(4),C.JRh(i.Note.Text)}}function Ci(ee,e){if(1&ee&&(C.j41(0,"div",23),C.EFF(1,"\n            "),C.j41(2,"div",24),C.EFF(3,"\n                "),C.j41(4,"table",25),C.EFF(5,"\n                    "),C.j41(6,"thead"),C.EFF(7,"\n                        "),C.j41(8,"tr"),C.EFF(9,"\n                            "),C.EFF(10,"\n                            "),C.j41(11,"th"),C.EFF(12,"Note"),C.k0s(),C.EFF(13,"\n                        "),C.k0s(),C.EFF(14,"\n                    "),C.k0s(),C.EFF(15,"\n                "),C.k0s(),C.EFF(16,"\n            "),C.k0s(),C.EFF(17,"\n            "),C.j41(18,"div",26),C.EFF(19,"\n                "),C.j41(20,"table",25),C.EFF(21,"\n                    "),C.j41(22,"tbody"),C.EFF(23,"\n                        "),C.DNE(24,gi,6,2,"tr",27),C.EFF(25,"\n                    "),C.k0s(),C.EFF(26,"\n                "),C.k0s(),C.EFF(27,"\n            "),C.k0s(),C.EFF(28,"\n        "),C.k0s()),2&ee){const i=C.XpG();C.R7$(24),C.Y8G("ngForOf",i.obj.ConfirmList)}}let Di=(()=>{class ee{ngOnInit(){console.log("ObjPReview",this.obj),console.log("params",this.params)}OnListItemClick(i,r){}static#e=this.\u0275fac=function(r){return new(r||ee)};static#t=this.\u0275cmp=C.VBU({type:ee,selectors:[["app-preview-data"]],decls:36,vars:10,consts:[[1,"master-screen",2,"padding-bottom","4px","max-width","600px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],["style","display: flex;flex-direction: column;",4,"ngIf"],["class","PACT_Table",4,"ngIf"],[1,"input_cntrl_label"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"display","flex","flex-direction","column"],["DropUp","",1,"List__dropdown","List__dropdown--suggestions","suggestions"],[1,"suggestions__group"],[1,"suggestions__group-Header",2,"display","flex"],[4,"ngFor","ngForOf"],["class","suggestions__group-content",4,"ngIf"],[1,"suggestions__group-column",2,"width","120px"],[2,"text-overflow","ellipsis"],[1,"suggestions__group-content"],["class","suggestions__item suggestions__list",3,"click",4,"ngFor","ngForOf"],[1,"suggestions__item","suggestions__list",3,"click"],[1,"suggestions__list-info",2,"display","flex"],[1,"suggestions__list-name",2,"width","120px"],[1,"PACT_Table"],[1,"tbl-header"],["cellpadding","0","cellspacing","0","border","0"],[1,"tbl-content"],["class","tbl-row",4,"ngFor","ngForOf"],[1,"tbl-row"],[1,"div-import-item"],[1,"form-group","col-xl-6","col-md-6","col-sm-6","col-xs-12","divChk"],["type","checkbox",1,"input_checkbox",3,"ngModelChange","ngModel"],["class","secondary-btn-wicon",3,"title","click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click","title"],[1,"fa-light","fa-search"]],template:function(r,a){1&r&&(C.j41(0,"div",0),C.EFF(1,"\n    "),C.j41(2,"div",1),C.EFF(3,"\n        "),C.DNE(4,ii,15,4,"div",2),C.EFF(5,"\n        "),C.DNE(6,li,29,1,"div",3),C.EFF(7,"\n\n\n\n\n        "),C.DNE(8,oi,29,1,"div",3),C.EFF(9,"\n        "),C.DNE(10,ni,43,2,"div",3),C.EFF(11,"\n        "),C.DNE(12,ci,45,3,"div",3),C.EFF(13,"\n\n\n        "),C.DNE(14,hi,29,1,"div",3),C.EFF(15,"\n\n        \n       \n\n        "),C.DNE(16,Ci,29,1,"div",3),C.EFF(17,"\n       \n       \n       \n\n        "),C.j41(18,"label",4),C.EFF(19),C.k0s(),C.EFF(20,"\n    "),C.k0s(),C.EFF(21,"\n    "),C.j41(22,"div",5),C.EFF(23,"\n        "),C.j41(24,"div"),C.EFF(25,"\n            "),C.j41(26,"button",6),C.bIt("click",function(){return a.obj.ButtonClick.Call(a.obj.btnOkText)}),C.nrm(27,"i",7),C.EFF(28),C.k0s(),C.EFF(29,"\n            "),C.j41(30,"button",8),C.bIt("click",function(){return a.obj.ButtonClick.Call("Cancel")}),C.nrm(31,"i",9),C.EFF(32),C.k0s(),C.EFF(33,"\n        "),C.k0s(),C.EFF(34,"\n    "),C.k0s(),C.EFF(35,"\n"),C.k0s()),2&r&&(C.R7$(4),C.Y8G("ngIf",a.obj.TempExcelTableVisible),C.R7$(2),C.Y8G("ngIf",a.obj.TempExcelTableVisible),C.R7$(2),C.Y8G("ngIf",a.obj.ErrorListVisible),C.R7$(2),C.Y8G("ngIf",a.obj.NotesListVisible),C.R7$(2),C.Y8G("ngIf",a.obj.NewInfoVisible),C.R7$(2),C.Y8G("ngIf",a.obj.RulesListVisible),C.R7$(2),C.Y8G("ngIf",a.obj.ConfirmListVisible),C.R7$(3),C.JRh(a.obj.NoofRows),C.R7$(9),C.JRh(a.obj.btnOkText),C.R7$(4),C.JRh("Cancel"))},dependencies:[wt.Sq,wt.bT,It.Zm,It.BC,It.vS,Yt.k,Zt.D9]})}return ee})();var yt=le(54843);class Ge{constructor(){this.parts=[]}append(e){return this.parts.push(String(e)),this}toString(){return this.parts.join("")}clear(){this.parts=[]}}class Si extends pt.g{get DtImport(){return this.grData.Table}set DtImport(e){this.grData.Table=e}get ImportCols(){return this.grData.Columns}set ImportCols(e){this.grData.Columns=e}get DataTable(){return this.DataTableObj.Table}constructor(e,i){super(),this.ds=null,this.obj=new _t.Document,this.oProduct=new Vt.c,this.oFile=new N.n_,this.Name=new U.Dw(0),this.Profile=new te.y$(0),this.Dimensions=new te.y$(0),this.IsSaveDocValidate=!1,this.dtValue=new Date,this.strHistoryMsg="",this.LocRemarks="",this.DeptRemarks="",this.DesgRemarks="",this.EDate=new Date,this.totEarnings=0,this.totDeductions=0,this.ReportViewModel=null,this.columnexist=!1,this.colcode="",this.colname="",this.code="",this.name="",this.codecolnum=0,this.namecolnum=0,this.excelview=[],this.oChart=new bt.T,this.timespan=0,this.userCreate=new $t.PropertyRoleUser,this.grData=new dt.vv,this._DocumentType=0,this.IsExcel=!0,this.SavedIDs="",this.IsScaned=!1,this.IsPreviewDataOk=!1,this.GroupExists=!1,this.EmpGrade=1,this.IDHistoryMessage="",this.ErrorMessage="",this.drSel=null,this.NotesList=[],this.ErrorList=[],this.RulesList=[],this.CostCenterFieldsAllTables={},this.CodeDef=[],this.dtPayrollE=[],this.dtPayrollD=[],this.costCenterTableZero=[],this.QtyFldName="",this.GrssFldName="",this.BinDimFieldName="",this.DonotUpdateInventory=!0,this.GradeRemarks="",this.DataTableObj=new dt.vv,this.lstContactFields=[],this.lstAddressFields=[],this.xDocCodeDef=new N.VB,this.Administration={},this.objAsset=new rt.V,this.temp=[],this.lookuptemp=[],this.CCQuery=[],this.CCQueryData=new te.y$(0),this.lookupQuery=[],this.ccdv=[],this.lookupdv=[],this.COls=[],this.catSub=new at.bT,this.partCat=new at.bT,this.BankAccounts=new Xt.y$(0),this.BatchCode=new U.s3(27184),this.WithoutExcel=!1,this.FailedRecourdList=[],this.ImportingMessage="Importing Data Please Wait....",this.ScreenObject=null,this.ActualFileName="",this.ColumnSource=[],this.FeatureVisibility=!0,this.ImportVisbility=!0,this.BulkVisible=!1,this.ProgressValue=0,this.ProgressMax=0,this.ShowBarcodeDimension=!1,this.BarcodeDim=0,this.QtyText=new U.Dw(0),this.RateText=new U.Dw(0),this.ProfileName=new U.Dw(0),this.Feature=new te.y$(0),this.UpdateBasedOn=new te.y$(0),this.QtyCombo=new te.y$(0),this.RateCombo=new te.y$(0),this.RefreshGrid=!1,this.IsDuplicateNameAllowed=!1,this.DoNotCreateCCVisibility=!1,this.UpdateBasedOnVisibility=!1,this.DoNotCreateCostCenter=!1,this.IsAvgRateChecked=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.IsQtyChecked=!1,this.IsRateChecked=!1,this.IsProductwiseBarcode=!1,this.IsAutoCodeGen=!1,this.ValidateBeforeImport=!0,this.UpdateStatusInExcel=!0,this.AppendData=!1,this.AppendVisible=!1,this.FillLocalReference=!1,this.FillLocRefVisibility=!1,this.IsCode=!1,this.BulkSave=!1,this.PartialSave=!1,this.IsPreview=!1,this.IsUpdate=!1,this.VerifyVisible=!1,this.ValidateVisible=!1,this.IsSnoBasedLinking=!1,this.GridEnable=!1,this.NameSameasCode=!1,this.lblTitle="",this.ButtonOpen=new At.v,this.ButtonSave=new At.v,this.EmpCode=new U.s3(0),this.DocItems=new te.v4,this.TemplateGrid=new dt.vv,this.ProductTypeID=0,this.IgnoreBatch=0,this.Date=new Date,this.YearMonth=this.Date.getFullYear().toString()+this.Date.toLocaleDateString("default",{month:"short"}),this.ProfileID=0,this.Browsefile=new nt.Yk,this.ExportFile=new nt.Yk,this.ImportData=new nt.Yk,this.SaveFile=new nt.Yk,this.ControlGen=new gt.ControlGenerator,this.objCG=new gt.ControlGenerator,this.objEmpEss=new jt.r,this.PosRegisterField="",this.PosShiftField="",this.PosRegisterDim=0,this.PosShiftDim=0,this.DocNumberField="",this.DocPrefixField="",this.VoucherNoField="",this.DocDateField="",this.FreeQtyField="",this.QtyField="",this.RateField="",this.GrossField="",this.UnitFieldName="",this.ProductFieldName="",this.CrAccFieldName="",this.DrAccFieldName="",this.ExhgRateFieldName="",this.CurrencyFieldName="",this.IsDrFieldCode=!1,this.IsCrFieldCode=!1,this.isAvgrate=!1,this.isCreditRowAdded=!1,this.isDebitRowAdded=!1,this._SelectedValue="",this._FeatureSelectedValue=null,this.eval=new ge.PE,this.VoucherType=0,this.strSerial=[],this.dttemp=[],this.tempfield="",this.dvMain=[],this.GroupsImport=!1,this.GroupTotCount=0,this.GroupfailCount=0,this.budgetInput=[],this.budgetTable=[],this.DataCollection=new Pt.t,this.BudgetType=0,this.CCPropertySales=[],this.CCPropertyAccntn=[],this.CCPropertyLandlord=[],this.CCNodeDet=[],this.dsCCPropS=[],this.CCSalesNodeid="0",this.CCAccNodeid="0",this.CCLndNodeid="0",this.Previewinfo="",this.Uomsb="",this.UomCol="",this.batchnumberfield="",this.bcodefield="",this.mfgdatefield="",this.expdatefield="",this.productidfield="",this.sbQuery="",this.UpdateColumns="",this.lstDuplicate=[],this.dblTotalHours=0,this.isEdit=!1,this.IsLoad=!1,this.FileName="",this.ExcelDataColumn=[],this.ProfileName.Label="Profile Name",this.Feature.Label="Feature",this.ProfileID=e,Logger.InfoLog("ImportViewModel::Entering ImportViewModel"),this.BankAccounts.Visible=!1,this.TemplateGrid.Visible=!1,this.QtyCombo.Visible=!1,this.YearMonth="",this.loadFeatures(i),this.grData.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}loadFeatures(e){const i=b.d.document.GetFeaturesList();if(b.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==b.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.YearMonth=""),this.Feature.Items.Clear(),i&&i.Tables){for(let c=0;c<i.Tables[0].length;c++)251==N.J0.Int(i.Tables[0][c].FeatureID)||252==N.J0.Int(i.Tables[0][c].FeatureID)||253==N.J0.Int(i.Tables[0][c].FeatureID)||254==N.J0.Int(i.Tables[0][c].FeatureID)||255==N.J0.Int(i.Tables[0][c].FeatureID)?this.Feature.Items.push(te._p.ComboBoxItems_4("Payroll "+i.Tables[0][c].Name.toString(),i.Tables[0][c].FeatureID.toString(),null,`${i.Tables[0][c].FeatureID.toString()}_${"Payroll "+i.Tables[0][c].Name.toString()}`)):this.Feature.Items.push(te._p.ComboBoxItems_4(i.Tables[0][c].Name.toString(),i.Tables[0][c].FeatureID.toString(),null,`${i.Tables[0][c].FeatureID.toString()}_${i.Tables[0][c].Name.toString()}`));this.Feature.Items.push(te._p.ComboBoxItems_4("Attachments","-100","","Attachments_-100"))}let r,a,u;e?(this.ButtonOpen.Visible=!1,this.ProfileName.Enable=!1,this.FeatureVisibility=!1,this.Feature.Enable=!1,this.GridEnable=!1):this.ButtonOpen.Visible=!(!b.d.SessionManager.IsActionAssigned(162,"Create")&&!b.d.SessionManager.IsActionAssigned(162,"Update")),this.ButtonSave.Visible=!!b.d.SessionManager.IsActionAssigned(162,"Update"),this.BankAccounts.CCID=2,this.BankAccounts.TypeID=2,this.BankAccounts.CustomWhere="AccountTypeID=2",this.UpdateBasedOn.Visible=!1,this.Browsefile.Subscribe(this,"OnBrowsefile"),this.ExportFile.Subscribe(this,"OnExportFile"),this.ImportData.Subscribe(this,"OnImportData"),this.SaveFile.Subscribe(this,"OnSave"),this.DisplayName=this.lblTitle,this.ButtonSave.ClickCommand.Subscribe(this,"OnSave"),a=[],this.grData.Clear(),this.grData.Columns=[],r=new ht.O7,r.DisplayMember="FieldName",r.Header=b.d.GetResource("Import_FieldName"),r.DataType="TextBlock",r.Width=250,r.ReadOnly=!0,r.DisableTab=!0,a.push(r),this.grData.TableColumns.push("FieldName"),r=new ht.O7,r.DisplayMember="ResourceData",r.ValueMember="CostCenterColID",r.ValueBinding="FeatureFieldName",r.Header=b.d.GetResource("Import_FeatureFieldName"),r.DataType="ComboBox",r.Width=300,r.DisableTab=!1,u=[],u.push(te._p.ComboBoxItems_2("","")),r.ComboData=u,a.push(r),this.grData.TableColumns.push("FeatureFieldName"),this.ImportCols=a,this.grData.Height=300,this.grData.gridWidth="600",this.grData.addEmptyRow(),this.grData.refreshDataView(),0!=this.ProfileID&&(r.ReadOnly=!b.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Feature.Enable=b.d.SessionManager.IsActionAssigned(162,"Edit Profile"),this.Import(this.ProfileID,e)),Logger.InfoLog("ImportViewModel::Exiting ImportViewModel")}OnKeyDown(e,i){console.log("eventD",e),!i.ctrlKey&&46==i.which&&"Delete"==i.key&&(console.log("Deleted calling "),this.grData.removeRowAt(e.row))}Import(e,i){if(e>0){const a=b.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0){let u=new N.VB;u.LoadXml(a.Tables[0][0].Structure.toString()),null!=u&&u.DocumentElement.children[0].attributes[0].value.toString()}e>0&&(this.isEdit=!i)}}get FeatureSelectedValue(){return this._FeatureSelectedValue}set FeatureSelectedValue(e){this._FeatureSelectedValue!=e&&(this._FeatureSelectedValue=e)}OnChange(e){const i=e.target.value,r=this.Feature.Items.find(a=>a.Aliasname==i);this.Feature._SelectedValue=r?.Value||"",this.Feature.SelectedItem=r||null,this.OnSelectionChanged(this)}OnSelectionChanged(e){if(this.ValidateVisible=!1,null!=this.Feature.SelectedValue&&""!=this.Feature.SelectedValue){if(this.QtyCombo.Visible=!1,this.UpdateBasedOn.Visible=!1,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(te._p.ComboBoxItems_2("","")),this.VerifyVisible=!1,this.AvgVisible=!1,this.QtyRateVisible=!1,this.CostCenterFieldsAllTables=b.d.document.GetFeaturesDetails(parseInt(this.Feature.SelectedValue),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),this.CostCenterFieldsAllTables?.Tables.length>0&&this.CostCenterFieldsAllTables.Columns[this.CostCenterFieldsAllTables.Columns.length-1].Contains("ErrorMessage"))return;let r=this.CostCenterFieldsAllTables.Tables[this.CostCenterFieldsAllTables.Tables.length-1];this.CodeDef=r&&r.length>0&&"PrefixContent"in r[0]?r:null,this.AppendVisible="101"==this.Feature.SelectedValue||"2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||N.J0.Int(this.Feature.SelectedValue)>5e4&&N.J0.Int(this.Feature.SelectedValue)<59999,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4||93==parseInt(this.Feature.SelectedValue)?(0==this.ProfileID&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&(this.DoNotCreateCostCenter=!0),this.FillLocRefVisibility=!0,this.DocItems.Items.Clear()):(this.FillLocRefVisibility=!1,this.FillLocalReference=!1,this.DoNotCreateCostCenter=!1),this.costCenterTableZero=this.CostCenterFieldsAllTables.Tables[0];let a={CostCenterColID:"-200",SysColumnName:"",ResourceData:""};const u=this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{},c=Object.keys(u);c.includes("CostcenterID")&&(a.CostcenterID=this.Feature.SelectedValue),c.includes("ColumnCostCenterID")&&(a.ColumnCostCenterID="0"),c.includes("IsColumninuse")&&(a.IsColumninuse="boolean"==typeof u.IsColumninuse||1),c.includes("IsColumninuse")&&(a.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),c.includes("ColumnDataType")&&(a.ColumnDataType="str"),this.costCenterTableZero.unshift(a),this.IsSnoBasedLinking=!1;const t=parseInt(this.Feature.SelectedValue);if(t>4e4&&t<5e4&&this.CostCenterFieldsAllTables.Tables.length>3&&this.CostCenterFieldsAllTables.Tables[3].length>0){let o=this.CostCenterFieldsAllTables.Tables[3].filter(m=>"SnoBasedLinking"===m.PrefName);if(o.length>0){const m=o[0].PrefValue;m.toString()!==String(!!m)&&(this.IsSnoBasedLinking=!0,this.costCenterTableZero.unshift({CostCenterColID:"-501",CostcenterID:this.Feature.SelectedValue,ColumnCostCenterID:"0",CostcenterName:null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:"Feature",SysColumnName:"RefSNo",ResourceData:"RefSNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}))}}if(99==t)this.costCenterTableZero.unshift({CostCenterColID:"0",SysColumnName:"",ResourceData:""});else if(null!=this.Feature.SelectedItem&&"Substitute Products"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"SubstituteGroup",ResourceData:"Substitute Group",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name||"Product With Services(Many-One)"==this.Feature.SelectedItem.Name)this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceCode",ResourceData:"Service Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"});else if(null!=this.Feature.SelectedItem&&"Services to Dimension"==this.Feature.SelectedItem.Name){this.costCenterTableZero=[];let o=this.CostCenterFieldsAllTables.Tables[7];if(o.length>0){const m=o.filter(T=>"LinkedProductDimension"===T?.Name);let h=parseInt(m[0].CostcenterID);this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:h,CostcenterName:"Product",SysColumnName:"Dimension",ResourceData:"Dimension",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"1",CostcenterID:t,ColumnCostCenterID:"3",CostcenterName:"Product",SysColumnName:"ServiceName",ResourceData:"Service Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"0",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LINK",ResourceData:"LINK",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})}}else this.Feature.SelectedItem&&"Kit Products"==this.Feature.SelectedItem.Name?(this.costCenterTableZero=[],this.AddKitProductRows(this.costCenterTableZero)):this.Feature.SelectedItem&&"Product QC"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddQCProductRows(this.costCenterTableZero));if(73==t&&this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Product",SysColumnName:"CloseDate",ResourceData:"Close Date",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"DATE"}),114==t&&this.AddFollowupRows(this.costCenterTableZero),40054==t){let o,m=this.CostCenterFieldsAllTables;this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-300",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcCCNID51",ResourceData:"Employee Code*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push({CostCenterColID:"-301",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha5",ResourceData:"Days Attended*",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.costCenterTableZero.push({CostCenterColID:"-302",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"dcAlpha9",ResourceData:"Absent(LOP) Days",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"});let T=this.dsEmpPayWithDate(1,b.d.SessionManager.PayrollMonth);T&&T.Tables&&T.Tables.length>0&&T.Tables[0].length>0&&T.Tables[0].filter(d=>[1,2,3,4].includes(+d.Type)).sort((d,y)=>{const f=+d.Type,D=+y.Type;return f==D?f-D:+d.SNo-+y.SNo}).forEach(d=>{const y={};y.CostCenterColID=d.CostCenterColID,y.CostcenterID=t,y.ColumnCostCenterID=d.Type,y.SysColumnName="dcNum"+d.SNo,y.ResourceData=d.ComponentName,y.IsColumninuse=!0,y.IsColumnUserDefined=!1,y.ColumnDataType="FLOAT","OverTime"==N.J0.String(d.FieldType)&&(y.CostCenterName=(y.CostCenterName||"")+"_OT"),this.costCenterTableZero.push(y)}),o=m.Tables[0].filter(S=>S.SysColumnName&&S.SysColumnName.startsWith("dcAlpha")),o&&o.length>0&&o.forEach(S=>{if(parseInt(S.SysColumnName.replace("dcAlpha",""),10)>50){const d={};d.CostCenterColID=S.CostCenterColID,d.CostcenterID=t,d.ColumnCostCenterID="6",d.SysColumnName=S.SysColumnName,d.ResourceData=S.ResourceData,d.IsColumninuse=S.IsColumninuse,d.IsColumnUserDefined=S.IsColumnUserDefined,d.ColumnDataType=S.ColumnDataType,this.costCenterTableZero.push(d)}})}else if(t>4e4&&t<5e4&&Object.keys(this.costCenterTableZero.includes("CostCenterColID"))){null!=this.ExcelTable&&this.FillQtyRateCombo(),this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocNumber",ResourceData:"Numeric Doc No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"INT"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"DocPrefix",ResourceData:"DocPrefix",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-3",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"BillWiseDocNo",ResourceData:"BillWise DocNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"BillWiseDocNo"}),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory?([{id:"-4",ColumnCC:"16",SysCol:"Batchno",Resource:"Batch No",DataType:"str"},{id:"-5",ColumnCC:"0",SysCol:"MfgDate",Resource:"Mfg Date",DataType:"DATE"},{id:"-6",ColumnCC:"0",SysCol:"ExpDate",Resource:"Exp Date",DataType:"DATE"},{id:"-26",ColumnCC:"0",SysCol:"BatchDocNo",Resource:"Batch DocNo",DataType:"str"},{id:"-25",ColumnCC:"0",SysCol:"AVGRATE",Resource:"AVGRATE",DataType:"FLOAT"},{id:"-28",ColumnCC:"0",SysCol:"AVGRATEVALUE",Resource:"AVGRATEVALUE",DataType:"FLOAT"},{id:"-29",ColumnCC:"0",SysCol:"BinCode",Resource:"Bin Code",DataType:"str"},{id:"-30",ColumnCC:"0",SysCol:"BinName",Resource:"Bin Name",DataType:"str"}].forEach(I=>{this.costCenterTableZero.push({CostCenterColID:I.id,CostcenterID:t,ColumnCostCenterID:I.ColumnCC,SysColumnName:I.SysCol,ResourceData:I.Resource,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:I.DataType})}),this.BulkVisible=!0):(this.BulkVisible=!1,this.BulkSave=!1);let n=[];n=this.CostCenterFieldsAllTables.Tables[3];let l=!1;if(n&&n.length>0){const S=n.filter(I=>"EnableSchemes"===I.PrefName);if(S.length>0){const I=S[0].PrefValue;l="true"===I||!0===I}}l&&this.costCenterTableZero.push({CostCenterColID:"-8",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"FreeQTY",ResourceData:"FreeQTY",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"}),this.CostCenterFieldsAllTables.Tables[2].length>0&&N.J0.Int(5==this.CostCenterFieldsAllTables.Tables[2][0].DocumentType)&&this.AddTransferFromToRows(this.CostCenterFieldsAllTables.Tables[0]),Object.keys(this.CostCenterFieldsAllTables.Tables[2].includes("IsInventory"))&&this.CostCenterFieldsAllTables.Tables[2].length>0&&"true"==this.CostCenterFieldsAllTables.Tables[2][0].IsInventory&&(this.costCenterTableZero.push({CostCenterColID:"-7",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNo",ResourceData:"Linking Ref No",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNo"}),this.costCenterTableZero.push({CostCenterColID:"-77",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"LinkingRefNoSNo",ResourceData:"Linking Ref No SNo",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"LinkingRefNoSNo"}));let g=-9;const T=this.costCenterTableZero.filter(S=>{const I=String(S.SysColumnName||"").toLowerCase();return["debitaccount","creditaccount","AccountID"].includes(I)});for(let S of T){const I={CostCenterColID:g.toString(),CostcenterID:t,ColumnCostCenterID:"2",SysColumnName:S.SysColumnName+"Code",ResourceData:(S.ResourceData||"").replace("Name","")+"Code",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:S.ColumnDataType};this.costCenterTableZero.push(I),g--}this.VerifyVisible=!0}if(56==t){const o=this.costCenterTableZero;if(!o||0===o.length)return;const m=h=>{const n=o.findIndex(l=>String(l.SysColumnName||"").toLowerCase()===h.toLowerCase());-1!==n&&o.splice(n,1)};m("Status"),m("Attachment"),m("Location")}if(76==t&&"Bill Of Materials With Multiple Stage"!=this.Feature.SelectedItem.Name&&this.FillBomDetails(),93==t&&"Unit Rates"!=this.Feature.SelectedItem.Name&&this.FillUnitRates(),t>6e4&&(this.costCenterTableZero=[],this.costCenterTableZero.push({CostCenterColID:"-1",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Name",ResourceData:"Name",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"}),this.costCenterTableZero.push({CostCenterColID:"-2",CostcenterID:t,ColumnCostCenterID:"44",CostcenterName:"Lookups",SysColumnName:"Default",ResourceData:"Default",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"str"})),null!=this.Feature.SelectedItem&&"Unit Rates"!==this.Feature.SelectedItem.Name&&"Product QC"!==this.Feature.SelectedItem.Name&&"Services to Dimension"!==this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&this.AddContactsRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Services to Dimension"!=this.Feature.SelectedItem.Name&&"Kit Products"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Dimension Move"!=this.Feature.SelectedItem.Name&&"Document Edit"!=this.Feature.SelectedItem.Name&&"Job Output"!=this.Feature.SelectedItem.Name&&"PRODUCTS WITH SUBSTITUTES"!=this.Feature.SelectedItem.Name.toUpperCase()&&(this.AddCodeRows(this.costCenterTableZero),this.AddWEFRows(this.costCenterTableZero),this.AddGroupSeriesRows(this.costCenterTableZero)),2==t&&null!=this.Feature.SelectedItem&&"Account Report Template"!=this.Feature.SelectedItem.Name&&"Account Dimension wise Cr/Dr Limits"!=this.Feature.SelectedItem.Name&&"Account Contacts"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name&&"Account Address"!=this.Feature.SelectedItem.Name||3==t&&null!=this.Feature.SelectedItem&&"Product QC"!=this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!=this.Feature.SelectedItem.Name&&"Products With Substitutes"!=this.Feature.SelectedItem.Name||83==t||72==t||73==t||86==t||89==t||115==t||251==t||251==t||252==t||253==t||254==t||255==t||110==t||92==t||93==t||t>5e4&&t<=50075&&null!=this.Feature.SelectedItem&&"Job Output"!=this.Feature.SelectedItem.Name){let o={CostCenterColID:"-100",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodePrefix",ResourceData:"Code Prefix",ColumnDataType:"TEXT"};const h=Object.keys(this.costCenterTableZero.length>0?this.costCenterTableZero[0]:{});h.includes("IsColumninuse")&&(o.IsColumninuse="boolean"==typeof u.IsColumninuse||1),h.includes("IsColumninuse")&&(o.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(o);let n={CostCenterColID:"-101",CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:"CodeNumber",ResourceData:"Code Number",ColumnDataType:"INT"};h.includes("IsColumninuse")&&(o.IsColumninuse="boolean"==typeof u.IsColumninuse||1),h.includes("IsColumninuse")&&(o.IsColumnUserDefined="boolean"!=typeof u.IsColumnUserDefined&&0),this.costCenterTableZero.push(n)}if(50051==t){this.UpdateBasedOn.Visible=!0,this.UpdateBasedOn.Items.Clear(),this.UpdateBasedOn.Items.push(te._p.ComboBoxItems_2("",""));let o=this.costCenterTableZero.filter(n=>"1"===n.IsUnique||1===n.IsUnique);if(o&&o.length>0)for(let n=0;n<o.length;n++){const l=N.J0.String(o[n].UserColumnName),g=N.J0.String(o[n].SysColumnName);this.UpdateBasedOn.Items.push(te._p.ComboBoxItems_2(l,g))}[{CostCenterColID:"-17",SysColumnName:"Assigned_VacDaysPeriod",ResourceData:"Assigned_VacDaysPeriod",ColumnDataType:"TEXT"},{CostCenterColID:"-001",SysColumnName:"GradeFromDate",ResourceData:"GradeFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-002",SysColumnName:"LocFromDate",ResourceData:"LocFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-003",SysColumnName:"DeptFromDate",ResourceData:"DeptFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-004",SysColumnName:"DesgFromDate",ResourceData:"DesgFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-005",SysColumnName:"EffectFromDate",ResourceData:"EffectFromDate",ColumnDataType:"DATE"},{CostCenterColID:"-006",SysColumnName:"ActAppraisalFrom",ResourceData:"ActAppraisalFrom",ColumnDataType:"DATE"},{CostCenterColID:"-007",SysColumnName:"NextAppraisalDate",ResourceData:"NextAppraisalDate",ColumnDataType:"DATE"},{CostCenterColID:"-008",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-009",SysColumnName:"LocRemarks",ResourceData:"LocRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-010",SysColumnName:"DeptRemarks",ResourceData:"DeptRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-011",SysColumnName:"DesgRemarks",ResourceData:"DesgRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-012",SysColumnName:"AppraisalRemarks",ResourceData:"AppraisalRemarks",ColumnDataType:"TEXT"},{CostCenterColID:"-013",SysColumnName:"AppraisalReason",ResourceData:"AppraisalReason",ColumnDataType:"TEXT"},{CostCenterColID:"-014",SysColumnName:"IdentityCountry",ResourceData:"IdentityCountry",ColumnDataType:"TEXT"},{CostCenterColID:"-015",SysColumnName:"IdentityIsDefault",ResourceData:"IdentityIsDefault",ColumnDataType:"TEXT"},{CostCenterColID:"-018",SysColumnName:"Percentage",ResourceData:"Percentage",ColumnDataType:"FLOAT"}].forEach(n=>{this.costCenterTableZero.push({CostCenterColID:n.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:n.SysColumnName,ResourceData:n.ResourceData,IsColumninuse:"true",IsColumnUserDefined:"true",ColumnDataType:n.ColumnDataType})});let h=this.dsEmpPay(1);if(null!=h&&h.Tables.length>0){let n=h.Tables[0]||[];if(n&&n.length>0){n.filter(l=>"EmployeeMaster"===l.FieldType);for(let l=0;l<n.length;l++){if(N.J0.String("1"==n[l].Type)){let T={CostCenterColID:N.J0.String(n[l].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Earnings_"+N.J0.String(n[l].ComponentName),ResourceData:"Earnings_"+N.J0.String(n[l].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(T)}else if(N.J0.String("2"==n[l].Type)){let T={CostCenterColID:N.J0.String(n[l].CostCenterColID),CostcenterID:t,ColumnCostCenterID:"0",CostcenterName:"Lookups",sysTableName:"PAY_EmpPay",SysColumnName:"Deductions_"+N.J0.String(n[l].ComponentName),ResourceData:"Deductions_"+N.J0.String(n[l].ComponentName),UserDefaultValue:"-1",IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"FLOAT"};this.costCenterTableZero.push(T)}n.filter(T=>["1","2","3"].includes(T.Type)).foreach(T=>{const S=T.Type.toString(),I=T.ComponentID,d=T.ComponentName;let y="",f="",D="",p="";"1"===S&&(y="DrAccEarnings_",f="CrAccEarnings_",D="-100",p="-101"),"2"===S&&(y="DrAccDeductions_",f="CrAccDeductions_",D="-200",p="-201"),"3"===S&&(y="DrAccLoans_",f="CrAccLoans_",D="-300",p="-301");const E={CostCenterColID:`${p}${I}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${d}`,ResourceData:`${f} ${d}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"};this.costCenterTableZero.push({CostCenterColID:`${D}${I}`,CostcenterID:t,ColumnCostCenterID:"0",sysTableName:"PAY_EmpAccountsLinking",SysColumnName:`${d}`,ResourceData:`${y} ${d}`,IsColumninuse:"true",IsColumnUserDefined:"false",ColumnDataType:"TEXT"}),this.costCenterTableZero.push(E)})}}}}else 7==t?[{CostCenterColID:"-401",SysColumnName:"AccountTypes",ResourceData:"Account Types"},{CostCenterColID:"-402",SysColumnName:"ProductTypes",ResourceData:"Product Types"},{CostCenterColID:"-403",SysColumnName:"LicenseCount",ResourceData:"License Count"},{CostCenterColID:"-404",SysColumnName:"Online/Offline",ResourceData:"Online/Offline"},{CostCenterColID:"-405",SysColumnName:"2StepVerificationMode",ResourceData:"2-Step Verification Mode"},{CostCenterColID:"-406",SysColumnName:"Language",ResourceData:"Language"}].forEach(m=>{this.costCenterTableZero.push({CostCenterColID:m.CostCenterColID,CostcenterID:t,ColumnCostCenterID:"0",SysColumnName:m.SysColumnName,ResourceData:m.ResourceData,ColumnDataType:"TEXT"})}):101==t?(this.costCenterTableZero.push({CostCenterColID:"-001",ColumnCostCenterID:"0",ColumnDataType:"TEXT",SysColumnName:"CarryForward",ResourceData:"Carry Forward"}),this.costCenterTableZero.push({CostCenterColID:"-002",ColumnCostCenterID:"12",ColumnDataType:"INT",SysColumnName:"Currency",ResourceData:"Currency"}),this.costCenterTableZero.push({CostCenterColID:"-003",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExchangeRate",ResourceData:"Exchange Rate"})):-100==t&&(this.AddAttachemtnRows(this.costCenterTableZero),null!=this.Feature.SelectedItem&&"Products With Vendor Multiple Barcode"==this.Feature.SelectedItem.Name&&(this.costCenterTableZero=[],this.AddProductVendorWiseMultipleBarcodeRows(this.costCenterTableZero)));if(95==t&&this.AddContractRows(this.costCenterTableZero),83==t&&null!=this.Feature.SelectedItem&&"CRM Customer With Contacts"==this.Feature.SelectedItem.Name&&this.CostCenterFieldsAllTables.Tables.length>5){const o=this.CostCenterFieldsAllTables.Tables[0],m=this.CostCenterFieldsAllTables.Tables[5];if(Array.isArray(m)&&m.length>0){this.costCenterTableZero=[...o,...m];for(let h of m){const n=Number(h.CostCenterColID);isNaN(n)||this.lstContactFields.push(n)}}}const s=[...this.costCenterTableZero];s.sort((o,m)=>o.ResourceData.localeCompare(m.ResourceData)),this.ImportCols[1].ComboData=s,this.grData.RefreshColumns(),95===t&&this.ImportCols[1].ComboData.sort((o,m)=>o["ResourceData asc"].localeCompare(m["ResourceData asc"]));for(let o=0;o<this.grData.Table.length;o++)this.grData.Table[o][1]="0";this.RefreshGrid=!this.RefreshGrid,this.BankAccounts.Visible=70==t,this.DoNotCreateCCVisibility=!0,this.TemplateGrid=(new vt).BuildGrid(N.J0.Int(this.Feature.SelectedValue.toString()),null!=this.Feature.SelectedItem?this.Feature.SelectedItem.Name:""),t>4e4&&t<5e4&&Object.keys(this.CostCenterFieldsAllTables.length>0?this.CostCenterFieldsAllTables[2]:{}).includes("IsInventory")&&(this.ValidateVisible=!0)}}AddTransferFromToRows(e){const i=parseInt(this.Feature.SelectedValue);if(!e||0===e.length)return;let r=e.filter(a=>{const u=N.J0.Int(a.ColumnCostCenterID);return 2===u||3===u||u>=50001&&u<=50075});for(let a of r){const u=N.J0.Int(a.IsTransfer),c=N.J0.Int(a.ColumnCostCenterID);if(!isNaN(u)&&(c>5e3||u>0)){const t={CostCenterColID:-N.J0.Int(a.CostCenterColID),CostcenterID:i,ColumnCostCenterID:c,UserColumnName:"TO"+a.ResourceData,IsColumnUserDefined:"1",SysTableName:a.SysTableName,ColumnDataType:a.ColumnDataType,SysColumnName:a.SysColumnName,ResourceData:"TO"+a.ResourceData};a.ResourceData="From "+a.ResourceData,a.UserColumnName="From "+a.ResourceData,e.push(t)}}-1!==i&&this.costCenterTableZero.sort((a,u)=>a.ResourceData.localeCompare(u.ResourceData))}AddContactsRows(e){const i=parseInt(this.Feature.SelectedValue);if((2==i||3==i||83==i||86==i||89==i||15==i||i>5e4&&i<=50075)&&e.push({CostCenterColID:-16,ColumnCostCenterID:i,IsColumnUserDefined:1,SysTableName:"",ResourceData:"ParentGroupName",UserColumnName:"ParentGroupName",SysColumnName:"ParentGroupName"}),2==i&&"Account Report Template"!=this.Feature.SelectedItem.Name||83==i&&"CRM Customer With Address"==this.Feature.SelectedItem.Name||i>5e4&&i<=50075){let r=b.d.document.GetCostCenterScreenDetails(110);if(null==r)return;if(null!=r&&r.Tables.length>0&&r.Tables[0].length>0)for(let a=0;a<r.Tables[0].length;a++){let u={};this.lstAddressFields.push(N.J0.StringIsNullOrEmpty(r.Tables[0][a].CostCenterColID.toString())?0:N.J0.Int(r.Tables[0][a].CostCenterColID)),u.CostCenterColID=r.Tables[0][a].CostCenterColID.toString(),u.IsColumnUserDefined=1,u.CostCenterID=i,u.SysTableName="COM_Address",u.ResourceData=N.J0.String(r.Tables[0][a].ResourceData),u.UserColumnName=N.J0.String(r.Tables[0][a].UserColumnName),u.SysColumnName=N.J0.String(r.Tables[0][a].SysColumnName),u.ColumnCostCenterID=N.J0.String(r.Tables[0][a].ColumnCostCenterID),e.push(u)}}-1!==i&&e.sort((r,a)=>r.ResourceData.localeCompare(a.ResourceData))}AddProductWiseUOMRows(e){if(3==parseInt(this.Feature.SelectedValue)){if({CostCenterColID:-19,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Name",UserColumnName:"Base_Name",SysColumnName:"Base_Name"}.push(e),{CostCenterColID:-20,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Base_Conversion",UserColumnName:"Base_Conversion",SysColumnName:"Base_Conversion"}.push(e),{CostCenterColID:-21,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitName",UserColumnName:"Conversion_UnitName",SysColumnName:"Conversion_UnitName"}.push(e),{CostCenterColID:-22,IsColumnUserDefined:0,SysTableName:"",ResourceData:"Conversion_UnitValue",UserColumnName:"Conversion_UnitValue",SysColumnName:"Conversion_UnitValue"}.push(e),{CostCenterColID:-23,IsColumnUserDefined:0,SysTableName:"",ResourceData:"MultiBarcode",UserColumnName:"MultiBarcode",SysColumnName:"MultiBarcode"}.push(e),{CostCenterColID:-24,IsColumnUserDefined:0,SysTableName:"",ResourceData:"BaseMultiBarcode",UserColumnName:"BaseMultiBarcode",SysColumnName:"BaseMultiBarcode"}.push(e),this.CostCenterFieldsAllTables.length>8&&Object.keys(this.CostCenterFieldsAllTables.Tables[0]).includes("Name")){const m=this.CostCenterFieldsAllTables.Tables[8].find(h=>"BarcodeDimension"==h.Name);if(m&&m.Value&&N.J0.Int(m.Value)>0&&(this.BarcodeDim=N.J0.Int(m[0].Value),this.ShowBarcodeDimension=!0),this.ShowBarcodeDimension){let h={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(h.ColumnCostCenterID=this.BarcodeDim),h.ResourceData="Base_Barcode",h.UserColumnName="Base_Barcode",h.SysColumnName="Base_Barcode",e.push(h);let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:""};this.BarcodeDim>5e4&&(n.ColumnCostCenterID=this.BarcodeDim),n.ResourceData="UOM_Barcode",n.UserColumnName="UOM_Barcode",n.SysColumnName="UOM_Barcode",e.push(n)}else{e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Base_Barcode",UserColumnName:"Base_Barcode",SysColumnName:"Base_Barcode"}),e.push({CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ResourceData:"UOM_Barcode",UserColumnName:"UOM_Barcode",SysColumnName:"UOM_Barcode"})}}}}AddProductVendorWiseMultipleBarcodeRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-23,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:2,ResourceData:"Vendor",UserColumnName:"Vendor",SysColumnName:"Vendor"}),e.push({CostCenterColID:-24,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"ETA",UserColumnName:"ETA",SysColumnName:"ETA"}),e.push({CostCenterColID:-25,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Priority",UserColumnName:"Priority",SysColumnName:"Priority"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min. Order Quantity",UserColumnName:"Min. Order Quantity",SysColumnName:"Min. Order Quantity"}),e.push({CostCenterColID:-26,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Barcode",UserColumnName:"Barcode",SysColumnName:"Barcode"}),e.push({CostCenterColID:-27,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Volume",UserColumnName:"Volume",SysColumnName:"Volume"}),e.push({CostCenterColID:-28,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Weight",UserColumnName:"Weight",SysColumnName:"Weight"});let n={CostCenterColID:-29,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"String",ResourceData:"Remarks"};n.UserColumnName=n.SysColumnName="Remarks",e.push(n)}}AddQCProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){if(e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),b.d.SessionManager.Preferences.ContainsKey("TestCaseDimension")&&""!=b.d.SessionManager.Preferences.TestCaseDimension&&N.J0.Int(b.d.SessionManager.Preferences.TestCaseDimension)>0){let g={CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:""};g.ColumnCostCenterID=N.J0.Int(b.d.SessionManager.Preferences.TestCaseDimension),g.ResourceData="QC Name",g.UserColumnName="QC Name",g.SysColumnName="QC Name",e.push(g);let T={CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:""};T.ColumnCostCenterID=N.J0.Int(b.d.SessionManager.Preferences.TestCaseDimension),T.ResourceData=T.UserColumnName=T.SysColumnName="QC Code",e.push(T)}let u={CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:""};u.ResourceData=u.UserColumnName=u.SysColumnName="Document",e.push(u),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Type",UserColumnName:"Type",SysColumnName:"Type"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Min",UserColumnName:"Min",SysColumnName:"Min"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Max",UserColumnName:"Max",SysColumnName:"Max"}),e.push({CostCenterColID:-36,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Probable val",UserColumnName:"Probable val",SysColumnName:"Probable val"}),e.push({CostCenterColID:-37,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Sample",UserColumnName:"Sample",SysColumnName:"Sample"}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ResourceData:"SampleType",UserColumnName:"SampleType",SysColumnName:"SampleType"}),e.push({CostCenterColID:-38,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Observation",UserColumnName:"Observation",SysColumnName:"Observation"}),e.push({CostCenterColID:-39,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Varience",UserColumnName:"Varience",SysColumnName:"Varience"})}}AddKitProductRows(e){if(3==N.J0.Int(this.Feature.SelectedValue)){e.push({CostCenterColID:261,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Code",UserColumnName:"Product Code",SysColumnName:"ProductCode"}),e.push({CostCenterColID:262,IsColumnUserDefined:0,SysTableName:"Inv_Product",ResourceData:"Product Name",UserColumnName:"Product Name",SysColumnName:"ProductName"}),e.push({CostCenterColID:-30,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product",UserColumnName:"Kit_Product",SysColumnName:"Kit_Product"}),e.push({CostCenterColID:-34,IsColumnUserDefined:1,SysTableName:"",ColumnCostCenterID:3,ResourceData:"Kit_Product_Code",UserColumnName:"Kit_Product_Code",SysColumnName:"Kit_Product_Code"}),e.push({CostCenterColID:-31,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Qty",UserColumnName:"Kit_Qty",SysColumnName:"Kit_Qty"}),e.push({CostCenterColID:-35,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_UOM",UserColumnName:"Kit_UOM",SysColumnName:"Kit_UOM"}),e.push({CostCenterColID:-32,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"FLOAT",ResourceData:"Kit_Rate",UserColumnName:"Kit_Rate",SysColumnName:"Kit_Rate"}),e.push({CostCenterColID:-33,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Kit_Link",UserColumnName:"Kit_Link",SysColumnName:"Kit_Link"})}}AddAttachemtnRows(e){this.QtyCombo.Visible=!0,this.QtyCombo.Items.push(te._p.ComboBoxItems_2("Accounts","2")),this.QtyCombo.Items.push(te._p.ComboBoxItems_2("Products","3"));for(let c=0;c<this.Feature.Items.length;c++)!N.J0.StringIsNullOrEmpty(this.Feature.Items[c].Value)&&(N.J0.Int(this.Feature.Items[c].Value)>5e4&&N.J0.Int(this.Feature.Items[c].Value)<50050||73==N.J0.Int(this.Feature.Items[c].Value)||86==N.J0.Int(this.Feature.Items[c].Value)||92==N.J0.Int(this.Feature.Items[c].Value)||93==N.J0.Int(this.Feature.Items[c].Value)||94==N.J0.Int(this.Feature.Items[c].Value)||95==N.J0.Int(this.Feature.Items[c].Value))&&this.QtyCombo.Items.push(te._p.ComboBoxItems_2(this.Feature.Items[c].Name,this.Feature.Items[c].Value));(e=[]).push({CostCenterColID:-10,IsColumnUserDefined:1,SysTableName:"",ResourceData:"FileName",UserColumnName:"FileName",SysColumnName:"FileName"});e.push({CostCenterColID:-11,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Description",UserColumnName:"FileDescription",SysColumnName:"FileDescription"});e.push({CostCenterColID:-12,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Code",UserColumnName:"Code",SysColumnName:"Code"});if(e.push({CostCenterColID:-13,IsColumnUserDefined:1,SysTableName:"",ResourceData:"Name",UserColumnName:"Name",SysColumnName:"Name"}),b.d.SessionManager.Preferences.ContainsKey("AttahmentGrid")&&""!=b.d.SessionManager.Preferences.AttahmentGrid){let t=(new DOMParser).parseFromString(b.d.SessionManager.Preferences.AttahmentGrid,"text/xml"),s=-30;const o=t.documentElement?.childNodes||[];for(let m=0;m<o.length;m++){const h=o[m];if(!h&&!h.attributes)continue;const n=h.getAttribute("FieldName");if(n&&""!==n.trim()){s--;let l={CostCenterColID:s,IsColumnUserDefined:1,SysTableName:"",ResourceData:h.getAttribute("Field")||"",UserColumnName:n,SysColumnName:n};if("Type"==n){const T=b.d.SessionManager.Preferences.AttahmentDimType;T&&""!=T&&isNaN(parseInt(T))&&(l.ColumnCostCenterID=parseInt(T))}const g=h.getAttribute("Unique");g&&""!==g.trim()&&(l.IsUnique=g),e.push(l)}}}}AddFollowupRows(e){this.QtyCombo.Visible=!0;for(let r=0;r<this.Feature.Items.length;r++)(73==N.J0.Int(this.Feature.Items[r].Value)||86==N.J0.Int(this.Feature.Items[r].Value)||89==N.J0.Int(this.Feature.Items[r].Value))&&this.QtyCombo.Items.push(te._p.ComboBoxItems_2(this.Feature.Items[r].Name,this.Feature.Items[r].Value));e.push({CostCenterColID:"-1",ColumnCostCenterID:"0",SysColumnName:"Code",ResourceData:"Code*",UserColumnName:"Code",ColumnDataType:"TEXT"})}AddContractRows(e){if(95==N.J0.Int(this.Feature.SelectedValue)){e.foreach(c=>{c.SysTableName&&c.SysTableName.includes("Particulars")&&(c.ResourceData="Particular_"+c.ResourceData)}),e.push({CostCenterColID:-40,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_IsParticulars",UserColumnName:"Particular_IsParticulars",SysColumnName:"Particular_IsParticulars"}),e.push({CostCenterColID:-41,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"Particular_SNO",UserColumnName:"Particular_SNO",SysColumnName:"Particular_SNO"}),e.push({CostCenterColID:-42,IsColumnUserDefined:1,SysTableName:"",ColumnDataType:"INT",ResourceData:"IsOPening",UserColumnName:"IsOPening",SysColumnName:"IsOPening"})}}AddCodeRows(e){const i=N.J0.Int(this.Feature.SelectedValue),r=e.filter(u=>2==u.ColumnCostCenterID||3==u.ColumnCostCenterID||u.ColumnCostCenterID>=50001&&u.ColumnCostCenterID<=50075);let a=r.length;for(let u=0;u<a;u++)if(2==i||3==i||i>5e4){let c={};c.CostCenterColID=-N.J0.Int(r[u].CostCenterColID),c.ColumnCostCenterID=N.J0.Int(r[u].ColumnCostCenterID),c.UserColumnName=r[u].ResourceData+"Code",c.CostCenterID=i,c.IsColumnUserDefined=1,c.SysTableName=r[u].SysTableName,c.SysColumnName=r[u].SysColumnName,c.ResourceData=r[u].ResourceData+"Code",e.push(c)}-1!=i&&(e.sort((u,c)=>{const t=u.ResourceData?u.ResourceData.toString():"",s=c.ResourceData?c.ResourceData.toString():"";return t.localeCompare(s)}),this.grData.RefreshColumns(),this.grData.RefreshGrid=!0)}AddWEFRows(e){let i=N.J0.Int(this.Feature.SelectedValue);const r=e.filter(t=>2==t.ColumnCostCenterID||3==t.ColumnCostCenterID||t.ColumnCostCenterID>=50001&&t.ColumnCostCenterID<=50075);let a=r.length;const c=Object.keys(e.length>0?e:{});for(let t=0;t<a;t++)if(c.includes("UserProbableValues")&&null!=r[t].UserProbableValues&&("H"==r[t].UserProbableValues.toString().toUpperCase()||"HP2"==r[t].UserProbableValues.toString().toUpperCase()||"HP3"==r[t].UserProbableValues.toString().toUpperCase())&&(2==i||3==i||i>5e4)){let s={};s.CostCenterColID=N.J0.Int(r[t].CostCenterColID)+"000",s.ColumnCostCenterID=N.J0.Int(r[t].ColumnCostCenterID),s.UserColumnName=r[t].ResourceData+"_FromDate",s.CostCenterID=i,s.IsColumnUserDefined=1,s.SysTableName=r[t].SysTableName,s.SysColumnName=r[t].SysColumnName+"_FromDate",s.ResourceData=r[t].ResourceData+"_FromDate",e.push(s);let o={};o.CostCenterColID=N.J0.Int(r[t].CostCenterColID)+"001",o.ColumnCostCenterID=N.J0.Int(r[t].ColumnCostCenterID),o.UserColumnName=r[t].ResourceData+"_ToDate",o.CostCenterID=i,o.IsColumnUserDefined=1,o.SysTableName=r[t].SysTableName,o.SysColumnName=r[t].SysColumnName+"_ToDate",o.ResourceData=r[t].ResourceData+"_ToDate",e.push(o);let m={};m.CostCenterColID=N.J0.Int(r[t].CostCenterColID)+"002",m.ColumnCostCenterID=N.J0.Int(r[t].ColumnCostCenterID),m.UserColumnName=r[t].ResourceData+"_Remarks",m.CostCenterID=i,m.IsColumnUserDefined=1,m.SysTableName=r[t].SysTableName,m.SysColumnName=r[t].SysColumnName+"_Remarks",m.ResourceData=r[t].ResourceData+"_Remarks",e.push(m)}-1!=i&&e.sort((t,s)=>(t.ResourceData||"").localeCompare(s.ResourceData||""))}formatDate(e){return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"/")}AddGroupSeriesRows(e){let i=N.J0.Int(this.Feature.SelectedValue);if(2==i||3==i||i>5e4){let r={CostCenterColID:-43,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesStart",UserColumnName:"SeriesStart",SysColumnName:"SeriesStart"};e.push(r),e.push({CostCenterColID:-44,IsColumnUserDefined:1,SysTableName:"COM_CCCCData",ColumnDataType:"INT",ResourceData:"SeriesEnd",UserColumnName:"SeriesEnd",SysColumnName:"SeriesEnd"});let u={CostCenterColID:-45,IsColumnUserDefined:1,SysTableName:"COM_CCCCData"};r.ColumnDataType="INT",u.ResourceData="IsManual",u.UserColumnName="IsManual",u.SysColumnName="IsManual",e.push(u)}}OnBrowsefile(e){const i=e.target;if(1!==e.target.files.length)throw new Error("Cannot use multiple files");const r=new FileReader,a=e.target.files[0],u=this.ActualFileName;this.ActualFileName=a.name;const c=b.d.admin.GetImportDetails(this.ProfileID,!0);if(null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&(this.ProfileName.Text=c.Tables[0].profileName),this.IsLoad&&this.ProfileID>0&&c.Tables.length>0&&!Object.keys(c.tables[0]).includes("ErrorMessage")&&c.Tables[0].length>0)return this.ActualFileName=u,this.DisplayMessage=`File name mismatch, select file name (${this.ProfileName.Text})`,this.MessageVisibility=!0,i.value="",void(this.ActualFileName="");r.onload=t=>{const m=ze.LF(r.result,{type:"binary",cellDates:!0});this.workbookK=m;const h=this.ActualFileName.split(".")[0].trim().toLowerCase(),n=m.SheetNames.find(g=>g.trim().toLocaleLowerCase()==h);if(!n)return this.DisplayMessage=`${h}$ is not a valid name. Make Sure that it does not Includes Invalid Characters or punctuation and it is not too long`,this.MessageVisibility=!0,i.value="",void(this.ActualFileName="");const l=m.Sheets[n];this.worksheetWS=l,this.ExcelData=ze.Wp.sheet_to_json(l,{header:1}),this.ExcelTable=this.ExcelData,this.dsexcel=this.ExcelData;try{this.DtImport.Clear();for(let g=0;g<this.ExcelData[0].length;g++){let T=this.grData.NewRow();this.grData.addRow(T),T.FieldName=this.ExcelData[0][g],this.grData.updateRow(T)}if(this.ExcelTable.length>0&&(this.ExcelDataColumn=this.ExcelTable[0],this.ExcelTable.splice(0,1)),!N.J0.IsEmpty(this.ImportCols[1].DefaultValueText)){let g=new N.VB;if(g.LoadXml(this.ImportCols[1].DefaultValueText),null!=g)for(let T=0;T<g.DocumentElement.children.length;T++){const S=g.DocumentElement.children[T];for(let I=0;I<this.DtImport.length;I++)(I+1).toString()==S.attributes[0].value&&(this.DtImport[I].FeatureFieldName=N.J0.String(S.attributes[2].value),this.grData.updateRow(this.DtImport[I]))}}0!=this.ProfileID&&(this.isEdit||this.IsLoad)&&(Logger.InfoLog("after ProfileID != 0 && (isEdit || IsLoad)  check..."),Logger.InfoLog("before ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),null!=c&&c.Tables.length>0&&!c.Columns[0].Contains("ErrorMessage")?(Logger.InfoLog("after ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check..."),this.ProfileName.Text=c.Tables[0][0].ProfileName.toString(),this.IsLoad&&this.ProfileID>0&&this.ActualFileName!=c.Tables[0][0].FileName.toString()&&"1"!=b.d.SessionManager.RoleID?this.DisplayMessage="File name mismatch, select file name ("+c.Tables[0][0].FileName.toString()+") ":""!=c.Tables[0][0].Structure.toString()&&this.ReadStructure(c.Tables[0][0].Structure.toString(),!0),Logger.InfoLog("end... ds != null && ds.Tables.length > 0 && !ds.Columns[0].Contains(ErrorMessage)  check...")):c.Columns[0].Contains("ErrorMessage")&&c.Tables[0].length>0&&Logger.InfoLog("ds.Columns[0].Contains(ErrorMessage) :: "+c.Tables[0][0].ErrorMessage.toString())),parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4&&this.costCenterTableZero.Contains("CostCenterColID")&&null!=this.ExcelTable&&0==this.QtyCombo.Items.length&&0==this.RateCombo.Items.length&&this.FillQtyRateCombo()}catch(g){return void(this.DisplayMessage=g.Message)}},r.readAsBinaryString(a)}OnExportFile(e,i){this.DisplayMessage="Print"==e?"Printing data please wait...":"Exporting data please wait...";let r={};i.InitPrintOrExport(r),r.Type=e,r.PrintDataOnSeperatePageBy=this.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?this.Preferences.PrintDataOnSeperatePageBy:"","PDF"==e?r.lst=[]:"Print"==e?(r.lst=[],r.Type="PDF"):("Excel"==e||"OpenXML"==e)&&(r.lst=[]),r.al="al",b.d.report.ExportReport(i.Data,i.ReportColumns,r,"AccDrillDown").subscribe(a=>{"Print"==e?b.d.SessionManager.printTab(a.FileName):(b.d.SessionManager.Download(a.FileName,"khasim"),N.J0.IsEmpty(a.Message)&&!N.J0.IsEmpty(a.FileName)&&(this.DisplayMessage="Exported Successfully"))},a=>{})}ScanDocument(e,i,r,a){let u=this.costCenterTableZero,h=[],n=["50001","50002","50008","50009"];for(let l=0;l<this.ExcelTable.length;l++)for(const g of this.grData.Table){let T=this.ExcelDataColumn.indexOf(g.FieldName);const S=g.FeatureFieldName;if(null==S||""==S.toString()||"0"==S.toString())continue;let d=u.filter(y=>y.CostCenterColID==S.toString())[0];if(d&&d.ColumnDataType){const y=d.ColumnDataType.toUpperCase(),f=g.FieldName,D=this.ExcelData[l][T]?.toString().trim()||"",p=d.ResourceData;switch(y){case"DATE":if("DocDate"==d.SysColumnName){if(this.DocDateField=f,this.VoucherNoField&&(!D||!this.ExcelTable[l][this.VoucherNoField].toString().Trim()&&isNaN(Date.parse(D))))return this.DisplayMessage=`Invalid ${p} at Row:" ${l+1} ${D} date expected `,this.MessageVisibility=!0,!1}else if(D&&isNaN(Date.parse(D)))return this.DisplayMessage=`Invalid ${p} at Row:" ${l+1} ${D} date expected `,this.MessageVisibility=!0,!1;break;case"FLOAT":if(D&&isNaN(parseFloat(D)))return this.DisplayMessage=`Invalid ${p} at Row:" ${l+1} ${D} numeric expected `,this.MessageVisibility=!0,!1;const F=d.SysColumnName.toLowerCase();"quantity"==F?this.QtyField=f:"rate"==F?this.RateField=f:"avgrate"==F?(this.isAvgrate=!0,this.RateField=f):"FreeQTY"==F?this.FreeQtyField=f:"gross"==F?(this.GrossField=f,this.GrssFldName=f):"exchangerate"==F?this.ExhgRateFieldName=f:"avgratevalue"==F&&(this.GrossField=this.GrssFldName=f);break;case"INT":if("DocNumber"===d.SysColumnName.toString()&&(this.DocNumberField=f),D&&isNaN(N.J0.Int(D)))return this.DisplayMessage=`Invalid ${p} at Row:" ${l+1} ${D} numeric expected `,this.MessageVisibility=!0,!1;break;case"COMBOTEXT":if(this.VoucherNoField=f,D){const V=D.split(this.Delimiter?this.Delimiter[0]:" ");if(!V[V.length-1]||isNaN(N.J0.Int(V[V.length-1])))return this.DisplayMessage=`Invalid ${p} at Row:" ${l+1} ${D} numeric expected `,this.MessageVisibility=!0,!1}break;case"STR":"DocPrefix"==d.SysColumnName.toString()&&(this.DocPrefixField=f);break;case"STRING":if("refno"==d.SysColumnName.toString()){const V=this.grData.Table.filter(L=>"-501"===L.FeatureFieldName);if(V.length>0&&!this.ccdv.includes[400]){let L="",O="";for(let B=0;B<this.ExcelTable.length;B++)L+=(L?",":"")+`'${this.ExcelTable[B][f]}'`,O+=(O?",":"")+`'${this.ExcelTable[B][V[0][0]]}'`;const x=this.ScreenObject.GetLinkDefDetails(N.J0.Int(this.Feature.SelectedValue),0,L,"",O,"");null!=x&&x.Tables.length>0&&(this.ccdv[400]=x.Tables[0]),null!=x&&x.Tables.length>4&&(this.ccdv[400]=x.Tables[5])}}break;case"PRODUCTSTRING":""==this.ProductFieldName&&(this.ProductFieldName=g.FieldName.toString()),this.CheckProductExtraField(l,3,this.ProductFieldName,d.SysColumnName.toString(),!1,this.IsCode);break;case"COSTCENTERSTRING":this.CheckCostCenterExtraField(l,N.J0.Int(d.CostCenterID.toString()),g.FieldName.toString(),d.CostCenterName.toString(),d.SysColumnName.toString(),!1,this.IsCode);break;case"LISTBOX":if(!(this.ProfileID>-20&&this.ProfileID<0&&n.Contains(d.ColumnCostCenterID.toString()))&&2!=N.J0.Int(d.ColumnCostCenterID.toString())&&3!=N.J0.Int(d.ColumnCostCenterID.toString())){if(a&&b.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&b.d.SessionManager.Preferences.POSItemCodeDimension==d.ColumnCostCenterID.toString())continue;i&&r>0&&r==N.J0.Int(d.ColumnCostCenterID.toString())?this.BinDimFieldName=f:this.CheckCostCenterField(l,N.J0.Int(d.ColumnCostCenterID.toString()),g.FieldName.toString(),!1,this.IsCode)}if("debitaccount"==d.SysColumnName.toLowerCase())this.DrAccFieldName=f;else if("debitaccountcode"==d.SysColumnName.toLowerCase())this.DrAccFieldName=f,this.IsDrFieldCode=!0;else if("creditaccount"==d.SysColumnName.toLowerCase())this.CrAccFieldName=f;else if("currencyid"==d.SysColumnName.toLowerCase())this.CurrencyFieldName=f;else if("creditaccountcode"==d.SysColumnName.toLowerCase())this.CrAccFieldName=f,this.IsCrFieldCode=!0;else if("productid"==d.SysColumnName.toLowerCase()&&1!=this.ProfileID)""==this.ProductFieldName&&(this.ProductFieldName=f),Object.keys(d).includes("ParentCCDefaultColID")&&"261"==d.ParentCCDefaultColID.toString().toLowerCase()?(this.ProductFieldName=f,this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(l,3,this.ProductFieldName,!1,!0):this.CheckCostCenterField(l,3,this.ProductFieldName,!1,!0))):this.ProfileID>-20&&this.ProfileID<0||(this.BulkSave?this.CheckBulkCostCenterField(l,3,this.ProductFieldName,!1,!1):this.CheckCostCenterField(l,3,this.ProductFieldName,!1,!1));else if("Unit"==d.SysColumnName.toString()){this.UnitFieldName=f;let V=`${f}_key`,L="";if(!this.ExcelDataColumn.includes(V)){this.ExcelDataColumn.push(V);const O=N.J0.Int(d.ColumnCostCenterID);this.temp.find(x=>x.hasOwnProperty(O))||this.temp.push({[O]:[]})}if(""!=D){let x=this.CostCenterFieldsAllTables.Tables[4];const B=D,q=this.ExcelTable[l][this.ExcelDataColumn.indexOf(this.ProductFieldName)]||"";let $=[];if(this.IsCode?(""!==this.ProductFieldName&&($=x.filter(Z=>Z.UnitName===B&&Z.ProductCode===q)),"Product Code"==this.ProductFieldName?$=x.filter(Z=>Z.UnitName===B&&Z.ProductCode===q):"Product Name"==this.ProductFieldName&&($=x.filter(Z=>Z.UnitName===D&&Z.ProductName===q)),(0==$.length||""==this.ProductFieldName)&&($=x.filter(Z=>Z.UnitName===B&&(!Z.ProductName||"DynamicSet"==Z.ProductName)))):(""!==this.ProductFieldName&&($=x.filter(Z=>Z.UnitName===B&&Z.ProductName===q)),"Product Code"==this.ProductFieldName?$=x.filter(Z=>Z.UnitName===B&&Z.ProductCode===q):"Product Name"==this.ProductFieldName&&($=x.filter(Z=>Z.UnitName===D&&Z.ProductName===q)),(0==$.length||!this.ProductFieldName)&&($=x.filter(Z=>Z.UnitName===B&&(!Z.ProductName||"DynamicSet"==Z.ProductName)))),$.length>0)this.ExcelTable[l][V]=$[0].UOMID.toString();else{const Z=N.J0.Int(d.ColumnCostCenterID),k=B.toLowerCase();this.temp.map(ne=>Object.keys(ne).includes(Z))||(this.temp.push({[Z]:k}),L+=`<Row  PrimaryKey='0' UName='" ${B}'  ConversionRate='1' MapAction='NEW' />`)}}if(""!=L){L=`<XML>${L}</XML>`;const x=b.d.document.AddUOMWithDataset(["",0,L,1,b.d.SessionManager.CompanyGUID,b.d.SessionManager.UserName,b.d.SessionManager.RoleID,b.d.SessionManager.LanguageID]);if(null!=x&&x.Tables.length>0&&Object.keys(x.Tables[0]).includes("ErrorMessage"))return this.DisplayMessage=x.Tables[0][0].ErrorMessage.toString(),!1;for(let B=0;B<x.Tables[0].length;B++){const q=Object.keys(x.Tables[0][B]).includes("UnitName"),$=Object.keys(x.Tables[0][B]).includes("UOMID");for(let Z of this.ExcelTable)Z[V]==q&&(Z[V]=$)}}}break;case"TEXT":const E=N.J0.Int(d.ColumnCostCenterID);44==E?this.CheckLookupField(l,N.J0.Int(d.ColumnCCListViewTypeID),f):E>0&&this.CheckCostCenterField(l,N.J0.Int(d.ColumnCostCenterID),f,!1,this.IsCode)}}if(e&&!h.includes(this.ExcelTable[l])&&""!=this.ProductFieldName&&""!=this.QtyFldName){let y="";""!=this.VoucherNoField?y+=`[${this.VoucherNoField}]='  ${this.ExcelTable[l][this.VoucherNoField].replace(/'/g,"''")}' and `:""!=this.DocPrefixField&&""!=this.DocNumberField?(y+=`[${this.DocPrefixField}]='  ${this.ExcelTable[l][this.DocPrefixField].replace(/'/g,"''")}' and `,y+=`[${this.DocNumberField}]='  ${this.ExcelTable[l][this.DocNumberField].replace(/'/g,"''")}' and `):""!=this.DocNumberField&&(y+=`[${this.DocNumberField}]='  ${this.ExcelTable[l][this.DocNumberField].replace(/'/g,"''")}' and `),""!=this.UnitFieldName&&(y+=`[${this.UnitFieldName}]='  ${this.ExcelTable[l][this.UnitFieldName].replace(/'/g,"''")}' and `),y+=`[${this.ProductFieldName}]='  ${this.ExcelTable[l][this.ProductFieldName].replace(/'/g,"''")}' `;const f=this.ExcelTable.filter(p=>{try{return new Function("row",`return ${y.replace(/\[|\]/g,"row['").replace(/=/g,"']==")}`)(p)}catch{return!1}}),D=this.grData.Table.filter(p=>"-25"==p.FeatureFieldName);if(f.length>1&&0===D.length){let p=0,F=0,E="";for(let L=1;L<f.length;L++){const O=f[L];O[this.QtyFldName]&&(p+=parseFloat(O[this.QtyFldName])||0),O[this.GrssFldName]&&(F+=parseFloat(O[this.GrssFldName])||0),this.BinDimFieldName&&O[this.BinDimFieldName]&&(E+=","+O[this.BinDimFieldName]),h.push(O)}const V=f[0];V[this.QtyFldName]=""!=V[this.QtyFldName].toString()?parseFloat(V[this.QtyFldName].toString())+p:p,V[this.GrssFldName]=""!=V[this.GrssFldName].toString()?parseFloat(V[this.GrssFldName].toString())+F:F,""!=this.BinDimFieldName&&(V[this.BinDimFieldName]=V[this.BinDimFieldName].toString()+E,this.CheckCostCenterField(this.ExcelTable.indexOf(V),r,this.BinDimFieldName,!1,!1))}else""!=this.BinDimFieldName&&this.CheckCostCenterField(l,r,this.BinDimFieldName,!1,!1)}}for(const l of h)this.ExcelTable.splice(this.ExcelTable.indexOf(l),1);return!0}FillAccountValues(){this.isCreditRowAdded&&this.GetDocumentReferenceData("CreditAccount"),this.isDebitRowAdded&&this.GetDocumentReferenceData("DebitAccount")}MapDebitCreditAccountFields(){let e=this.CostCenterFieldsAllTables.Tables[0],i=" ",r=" ";for(const a of this.grData.Table){const u=a.FeatureFieldName;if(null==u||""==u.toString()||"0"==u.toString())continue;const c=u?.toString();if(c){const t=e.filter(s=>s.CostCenterColID?.toString()===c);if(t.length>0&&null!=t[0].ColumnDataType&&"LISTBOX"===t[0].ColumnDataType.toString().toUpperCase()){const o=t[0].SysColumnName?.toString().toLowerCase();"debitaccount"==o?i=a[0].toString():"debitaccountcode"==o?(i=a[0].toString(),this.IsDrFieldCode=!0):"creditaccount"==o?r=a[0].toString():"creditaccountcode"==o&&(r=a[0].toString(),this.IsCrFieldCode=!0)}}if(""==i){const t=this.CostCenterFieldsAllTables.Tables[0].filter(s=>"DebitAccount"===s.SysColumnName);if(t.length>0){const s=t[0].UserDefaultValue?.toString()||"",o=t[0].LINKDATA?.toString()||"";if(s&&"0"!=s||o){this.ExcelTable.includes(t[0].SysColumnName.toString())||(this.ExcelTable.push(t[0].SysColumnName.toString()),this.ExcelTable.push(t[0].SysColumnName.toString()+"_Key"));const m=[];m[1]=t[0].CostCenterColID.toString(),m[0]=i=t[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(m)}}}if(""==r){const t=this.CostCenterFieldsAllTables.Tables[0].filter(m=>"CreditAccount"===m.SysColumnName),s=t[0].UserDefaultValue?.toString()||"",o=t[0].LINKDATA?.toString()||"";if(t.length()>0&&(s&&"0"!==s||o)){this.ExcelTable.includes(t[0].SysColumnName.toString())||(this.ExcelTable.push(t[0].SysColumnName.toString()),this.ExcelTable.push(t[0].SysColumnName.toString()+"_Key"));const m=[];m[1]=t[0].CostCenterColID.toString(),m[0]=i=t[0].SysColumnName.toString(),this.isDebitRowAdded=!0,this.grData.Table.push(m)}}}}GetDocumentReferenceData(e){const i=this.CostCenterFieldsAllTables.Tables[0].filter(r=>r.SysColumnName===e);if(i.length>0){const r=i[0].UserDefaultValue,a=i[0].LINKDATA,u=N.J0.Int(this.Feature.SelectedValue);if(r&&""!==r.toString()&&"0"!==r.toString()){const c=b.d.document.GetDataSet(`SELECT AccountName,AccountID FROM Acc_Accounts with(nolock) where Accountid='${r}'`);if(!(c&&c.Tables.length>0))return this.DisplayMessage=`${e} doesn't exists for Master`,void(this.MessageVisibility=!0);for(let t of this.ExcelTable)t[i[0].SysColumnName]=c.Tables[0][0].AccountName,t[i[0].SysColumnName+"_Key"]=c.Tables[0][0].AccountID}else if(a&&""!==a.toString()&&"0"!==a.toString()){const c=b.d.document.GetImportLinkRefData(a,u);if(c&&c.Tables.length>0&&c.Tables[0].Rows.length>0){let t=0;""!==c.Tables[0].COSTCENTERID&&(t=c.Tables[0].COSTCENTERID);const s=c.Tables[0].Feature;let o=!1;for(let m of this.grData.Table)if(""!==m[1].toString()){const h=this.CostCenterFieldsAllTables.Tables[0].filter(n=>n.ColumnCostCenterID.toString()===t.toString()&&n.CostCenterColID.toString()===m[1].toString());if(h.length>0&&h[0].ColumnCostCenterID.toString()===t.toString()){for(let n of this.ExcelTable)if(this.ExcelTable.includes(m[0].toString()+"_Key")&&""!==n[m[0].toString()+"_Key"].toString()){const l=c.Tables[1].filter(g=>g.NodeID.toString()===n[m[0].toString()+"_Key"].toString());if(!(l.length>0&&null!=l[0].ACCOUNTNAME))return this.DisplayMessage=`${e} mapping doesn't exists for Product ${n[m[0].toString()]}`,void(this.MessageVisibility=!0);n[i[0].SysColumnName]=l[0].ACCOUNTNAME,n[i[0].SysColumnName+"_Key"]=l[0].AccountID}o=!0;break}}if(!o)return this.DisplayMessage=`Select ${s}`,void(this.MessageVisibility=!0)}}}}CheckProductExtraField(e,i,r,a,u,c){if(i<5e4&&(!u||11===i)&&2!==i&&3!==i&&12!==i)return;let t;this.ExcelDataColumn.includes(r)&&(t=r+"_Key",this.ExcelDataColumn.push(t)),this.ExcelTable.includes(t)||this.ExcelTable.push(t),this.ExcelTable.includes("TempProductName")||this.ExcelTable.push("TempProductName"),this.ExcelTable.includes("TempProductCode")||this.ExcelTable.push("TempProductCode"),this.ccdv.includes(i)||(this.ccdv.push(i,b.d.document.GetCostCenterDetailsBYCostCenterID(i,a).Tables[0]),this.CCQuery.push(i,""),this.COls.push(i,t),this.temp.push(i,[]));try{const s=this.ExcelTable[e][0][r]?.toString().trim().replace(/'/g,"''")||"",o=+this.Feature.SelectedValue;this.ccdv[i].RowFilter=o>4e4&&o<5e4&&""!==a?`${a}='${s}'`:this.IsCode?`Code='${s}'`:`Name='${s}'`}catch(s){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+s.toString())}this.ccdv[i].length>0&&(this.ExcelTable[e][t]=this.ccdv[i][0].NodeID,this.ccdv[i][0].Name?this.ExcelTable[e].TempProductName=this.ccdv[i][0].Name:this.ExcelTable[e].TempProductCode=this.ccdv[i][0].Code)}CheckCostCenterExtraField(e,i,r,a,u,c,t){if(i<5e4&&(!c||11==i)&&2!=i&&3!=i&&12!=i)return;let s;this.ExcelDataColumn.includes(r)&&(s=r+"_Key",this.ExcelDataColumn.push(s)),this.ExcelDataColumn.includes(s)||this.ExcelDataColumn.push(s),this.ccdv.hasOwnProperty(i)||(this.ccdv.push({[i]:b.d.document.GetCostCenterDetailsBYCostCenterID(i,u).Tables[0]}),this.CCQuery.push({[i]:""}),this.COls.push({[i]:s}),this.temp.push({[i]:[]}));try{const o=this.ExcelTable[e][r]?.toString().trim().replace(/'/g,"''")||"",m=+this.Feature.SelectedValue;m>4e4&&m<5e4&&""!==u&&this.ccdv[0][i].filter(n=>n.SCOLName==o)}catch(o){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+o.toString())}this.ccdv[i].length>0&&(this.ExcelTable[e][s]=this.ccdv[i][0].NodeID)}CheckCostCenterField(e,i,r,a,u){let c,t;if(i<5e4&&(!a||11==i)&&93!=i&&92!=i&&94!=i&&95!=i&&83!=i&&2!=i&&3!=i&&5!=i&&6!=i&&7!=i&&12!=i&&72!=i&&77!=i&&76!=i)return;if(this.ExcelDataColumn.includes(r)&&(t=r+"_Key"),3==i&&parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){let o=r+"_PrdTypeID";this.ExcelDataColumn.Contains(o)||this.ExcelDataColumn.push(o)}38==this._DocumentType&&(0!=this.PosRegisterDim&&this.PosRegisterDim==i&&(this.PosRegisterField=r),0!=this.PosShiftDim&&this.PosShiftDim==i&&(this.PosShiftField=r)),this.ExcelDataColumn.Contains(t)||this.ExcelDataColumn.push(t),12==i&&(this.ExcelDataColumn.Contains("ExchangeRate")||this.ExcelDataColumn.push("ExchangeRate")),this.ccdv.find(o=>o.hasOwnProperty(i))||(this.ccdv.push({[i]:b.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0]}),this.CCQuery.push({[i]:""}),this.CCQueryData.Items.push(te._p.ComboBoxItems_3(r,"",i.toString())),this.COls.push({[i]:t}),this.temp.push({[i]:[]}));try{let o=this.ExcelDataColumn.indexOf(r);const m=this.ExcelTable[0][o]?.toString().trim().replace(/'/g,"''");let h=[];if(h=this.ccdv.find(l=>l.hasOwnProperty(i))[i],h)if("95"==this.Feature.SelectedValue&&93==i&&m){const l=m.substring(0,m.indexOf(",")).trim();c=h.filter(u?g=>g.Code==l:g=>g.Name==l)}else c=h.filter(12==i?l=>l.Name==m:u?l=>l.Code==m:l=>l.Name==m)}catch(o){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+o.toString())}const s=c;if(c.length>0)this.ExcelTable[e][t]=s[0].NodeID,u&&this.ExcelDataColumn.includes(r+"_Name")&&(this.ExcelTable[e][r+"_Name"]=s[0].Name),!this.ExcelDataColumn.includes(r+"_Curr")&&Object.keys(s[0]).includes("Curr")&&this.ExcelDataColumn.push(r+"_Curr"),!this.ExcelDataColumn.includes(r+"_Exch")&&Object.keys(s[0]).includes("Exch")&&this.ExcelDataColumn.push(r+"_Exch"),this.ExcelDataColumn.includes(r+"_Curr")&&Object.keys(s[0]).includes("Curr")&&(this.ExcelTable[e][r+"_Curr"]=s[0].Curr),this.ExcelDataColumn.includes(r+"_Exch")&&Object.keys(s[0]).includes("Exch")&&(this.ExcelTable[e][r+"_Exch"]=s[0].Exch),this.ExcelDataColumn.includes(r+"_PrdTypeID")&&Object.keys(s[0]).includes("PrdTypeID")&&(this.ExcelTable[e][r+"_PrdTypeID"]=s[0].PrdTypeID),12==i&&(this.ExcelTable[e].ExchangeRate=s[0].ExchangeRate);else{const o=this.ExcelTable[e][this.ExcelDataColumn.indexOf(r)]?.toString().trim();let m=this.temp.find(h=>h.hasOwnProperty(i));if(o&&o.length>0&&!Object.keys(this.temp[m]).includes(o)){this.temp.push({[i]:o});const h=this.grData.Table.filter(l=>l.FieldName===r&&"-16"===l.FeatureFieldName),n=` <Row AccountName="${U.Dw.GetValidXml(o.replace(/'/g,"''"))}"${h.length>0?' IsGroup="1"':""} ></Row> `;this.CCQuery.push({[i]:this.CCQuery[i]+n});for(let l of this.CCQueryData.Items)if(l.Parent===i.toString()){l.Value+=`${o}~${e+1},`;break}}}}CheckBulkCostCenterField(e,i,r,a,u){if(2===i||3===i){let c;if(this.ExcelDataColumn.includes(r)&&(c=r+"_Key",this.ExcelDataColumn.push(c)),this.ExcelTable.includes(c)||this.ExcelTable.push(c),!this.ccdv.includes(i)){const t=b.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0];this.ccdv.push(i,t),this.CCQuery.push(i,""),this.CCQueryData.Items.push(te._p.ComboBoxItems_3(r,"",i.toString())),this.COls.push({ColCCId:c}),this.temp.push({ColCCId:[]})}try{const t=this.ExcelTable[e][r]?.toString().trim().replace(/'/g,"''")||"";this.ccdv[i].RowFilter=this.IsCode?`Code='${t}'`:`Name='${t}'`}catch(t){Logger.ErrorLog("ImportUtilityViewModel:: CheckCostCenterField"+t.toString())}if(this.ccdv[i].length>0)this.ExcelTable[e][c]=this.ccdv[i][0].NodeID,u&&this.ExcelTable.includes(`${r}_Name`)&&(this.ExcelTable[e][`${r}_Name`]=this.ccdv[i][0].Name),!this.ExcelTable.includes(`${r}_Curr`)&&this.ccdv[i].Table.Columns.includes("Curr")&&this.ExcelTable.push(`${r}_Curr`),!this.ExcelTable.includes(`${r}_Exch`)&&this.ccdv[i].Table.Columns.includes("Exch")&&this.ExcelTable.push(`${r}_Exch`),this.ExcelTable.includes(`${r}_Curr`)&&this.ccdv[i].Table.Columns.includes("Curr")&&(this.ExcelTable[e][`${r}_Curr`]=this.ccdv[i][0].Curr),this.ExcelTable.includes(`${r}_Exch`)&&this.ccdv[i].Table.Columns.includes("Exch")&&(this.ExcelTable[e][`${r}_Exch`]=this.ccdv[i][0].Exch);else{const t=this.ExcelTable[e][r]?.toString().trim()||"";if(!this.temp[i].includes(t)&&t.length>0){this.temp[i].push(t),this.grData.Table.filter(o=>o.FieldName===r&&"-16"===o.FeatureFieldName).length>0?this.CCQuery.push(i,this.CCQuery[i]+` <Row AccountName="${U.Dw.GetValidXml(t.replace(/'/g,"''"))}" IsGroup="1" ></Row> `):this.CCQuery.push(i,this.CCQuery[i]+` <Row AccountName="${U.Dw.GetValidXml(t.replace(/'/g,"''"))}" ></Row> `);for(const o of this.CCQueryData.Items)if(o.Parent===i.toString()){o.Value+=`${t}~${e+1},`;break}}}}}CheckLookupField(e,i,r){let a,u;if(this.ExcelDataColumn.includes(r)&&(a=r+"_Key",this.ExcelDataColumn.push(a)),this.ExcelTable[e].includes(a)||this.ExcelTable[e].push(a),!this.lookupdv.includes(i)){const c=b.d.report.GetDataTable("IMP002",String(i));this.lookupdv.push({[i]:c}),this.lookupQuery.push({[i]:""}),this.COls.push({[i]:a}),this.lookuptemp.push({[i]:[]})}try{let c=this.ExcelDataColumn.indexOf(r);const t=this.ExcelTable[e][c]?.toString().trim().replace(/'/g,"''")||"";u=this.lookupdv[0][i].filter(s=>s.Name==t)}catch(c){Logger.ErrorLog("ImportUtilityViewModel:: CheckLookupField"+c.toString())}if(u.length>0)this.ExcelTable[e][a]=u[0].NodeID;else{const c=this.ExcelTable[e][r]?.toString().trim()||"";!this.lookuptemp[0][i].includes(c)&&c.length>0&&(this.lookuptemp[0][i].push(c),this.lookupQuery.push(i,this.lookupQuery[0][i]+` <Row lookup="${U.Dw.GetValidXml(c.replace(/'/g,"''"))}" ></Row> `))}}CheckAssignedCostCenters(e,i,r,a){if(i<5e4&&7!=i)return;let u=this.ExcelTable[r].ColumnName+"_Key";this.ExcelTable.includes(u)||this.ExcelTable.push(u),this.ccdv.includes(i)||(b.d.document.GetCostCenterDetailsBYCostCenterID(i,""),this.CCQuery.push(i,""),this.COls.push(i,u),this.temp.push(i,[]));let c=this.ExcelTable[e][r].toString().replace(/'/g,"''")||"";if(c.length>0){let t=c.split(",");c="",("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==i&&(c+="<XML>");for(let s=0;s<t.length;s++){if(this.ccdv[i].RowFilter=a?"Code='"+t[s].Trim()+"'":"Name='"+t[s].Trim()+"'",0==this.ccdv[i].length&&"3"==this.Feature.SelectedValue&&i>5e4&&i<59999&&!this.DoNotCreateCostCenter){let o=b.d.document.SetImportDataWithDataset('<XML><Row AccountName="'+t[s].Trim()+'" ></Row> </XML>',i.toString(),this.IsUpdate);null!=o&&o.Tables[0].length>0&&(c+='<Row CostCenterId="'+i+'" NodeID="'+o.Tables[0][0].NodeID.toString()+'" />')}this.ccdv[i].length>0&&(c+="92"!=this.Feature.SelectedValue&&"93"!=this.Feature.SelectedValue||7!=i?'<Row CostCenterId="'+i+'" NodeID="'+this.ccdv[i][0].NodeID.toString()+'" />':'<Row UserID="'+this.ccdv[i][0].NodeID.toString()+'" />')}("92"==this.Feature.SelectedValue||"93"==this.Feature.SelectedValue)&&7==i&&(c+="</XML>"),c.length>0&&(this.ExcelTable[e][u]=c)}}FillCostCenterFields(e){let i=!1;for(const[r,a]of Object.entries(this.CCQuery))if(""!==a){let u=!1;if(this.NotesList?.length>0)for(const t of this.NotesList)if(this.ExcelTable[this.COls[r].replace("_Key","")]===t.Note.Label&&t.IsModified){u=!0;break}let c=null;if("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue){if(u){let t=[];t.push(`<XML>${a}</XML>`),t.push(r.toString()),t.push(b.d.SessionManager.CompanyIndex),c=b.d.document.SetImportDataWithDataset(`<XML>${a}</XML>`,r.toString(),this.IsUpdate)}}else{let t=[];t.push(`<XML>${a}</XML>`),t.push(r.toString()),t.push(b.d.SessionManager.CompanyIndex),c=b.d.document.SetImportDataWithDataset(`<XML>${a}</XML>`,r.toString(),this.IsUpdate)}if(c?.Tables?.length>0){let t=0;if("3"===this.Feature.SelectedValue)for(let s=0;s<c.Tables.length;s++){const o=c.Tables[s].Columns;if(o[0].ColumnName.toLowerCase().includes("nodeid")&&o[1].ColumnName.toLowerCase().includes("name")){t=s;break}}this.ccdv.push(r,c.Tables[t]),i=!0}}if(i)for(const[r,a]of Object.entries(this.CCQuery))if(""!==a)for(let u=0;u<this.ccdv[r].length;u++)if(e){const c=this.CostCenterFieldsAllTables.Tables[0].filter(s=>s.ColumnCostCenterID==r),t=this.grData;for(const s of c){const o=t.Table.filter(m=>m.FeatureFieldName==s.CostCenterColID);for(const m of o){const h=m[0],n=this.ExcelTable.filter(l=>l[h]===this.ccdv[r][u].Name);for(const l of n)l[`${h}_Key`]=this.ccdv[r][u].NodeID}}}else{const c=this.ExcelTable[this.COls[r].replace("_Key","")],t=this.ExcelTable.filter(s=>s[c]===this.ccdv[r][u].Name);for(const s of t)s[this.COls[r]]=this.ccdv[r][u].NodeID}}FillLookupFields(){let e=!1;for(const i of this.lookupQuery)for(const[r,a]of Object.entries(i))if(""!==a){const u=b.d.document.SetImportLookupData(`<XML>${a}</XML>`,r,b.d.SessionManager.CompanyIndex);this.lookupdv.push(r,u[u.Table.length-1]),e=!0}if(e)for(const i of this.lookupQuery)for(const[r,a]of Object.entries(i))if(""!==a)for(let u=0;u<this.lookupdv[r].length;u++){const c=this.COls[r].replace("_Key",""),t=this.lookupdv[r][u].Name,s=this.ExcelTable.filter(o=>o[c]===t);for(const o of s)o[this.COls[r]]=this.lookupdv[r][u].NodeID}}ConstructFormulaFields(){this.fldDict=new at.bT;let e=new ge.Nl;if(e.setFieldDetails("RATE",1,1,"",0,!1,!1),this.fldDict.push("RATE",e),e=new ge.Nl,e.setFieldDetails("NET",2,1,"",0,!1,!1),this.fldDict.push("NET",e),e=new ge.Nl,e.setFieldDetails("AVGRATE",2,1,"",0,!1,!1),this.fldDict.push("AVGRATE",e),e=new ge.Nl,e.setFieldDetails("QTY",3,1,"",0,!1,!1),this.fldDict.push("QTY",e),e=new ge.Nl,e.setFieldDetails("GROSS",3,1,"",0,!1,!1),this.fldDict.push("GROSS",e),e=new ge.Nl,e.setFieldDetails("LASTPURCHASERATE",2,1,"",0,!1,!1),this.fldDict.push("LASTPURCHASERATE",e),e=new ge.Nl,e.setFieldDetails("LASTLANDINGRATE",2,1,"",0,!1,!1),this.fldDict.push("LASTLANDINGRATE",e),e=new ge.Nl,e.setFieldDetails("CONVERSIONQTY",3,1,"",0,!1,!1),this.fldDict.push("CONVERSIONQTY",e),e=new ge.Nl,e.setFieldDetails("UNITS",3,1,"",0,!1,!1),this.fldDict.push("UNITS",e),e=new ge.Nl,e.setFieldDetails("BASEQTY",3,1,"",1,!1,!1),this.fldDict.push("BASEQTY",e),e=new ge.Nl,e.setFieldDetails("FreeQTY",3,1,"",1,!1,!1),this.fldDict.push("FreeQTY",e),e=new ge.Nl,e.setFieldDetails("EXCHANGERATE",3,1,"",0,!1,!1),this.fldDict.push("EXCHANGERATE",e),this.CostCenterFieldsAllTables.Tables.length>0)for(const i of this.costCenterTableZero){const r=null!==i.IsColumnUserDefined&&""!==i.IsColumnUserDefined.toString()&&"true"===i.IsColumnUserDefined.toString(),a=i.SysColumnName?.toString()||"",u=i.ResourceData?.toString().replace(/\*$/,"")||"";r&&a.includes("dcNum")&&(e=new ge.Nl,e.setFieldDetails(u,3,1,"",0,!1,!1),this.fldDict.push(u,e),e=new ge.Nl,e.setFieldDetails("Calc"+u,3,1,"",0,!1,!1),this.fldDict.push("Calc"+u,e)),40067===parseInt(this.Feature.SelectedValue)?(r&&a.includes("dcCCNID")&&(e=new ge.Nl,e.setFieldDetails(a,3,1,"",0,!1,!1),this.fldDict.push(a,e)),r&&a.includes("dcAlpha")&&(e=new ge.Nl,e.setFieldDetails(a,3,1,"",0,!1,!1),this.fldDict.push(a,e))):(r&&a.includes("dcCCNID")&&(e=new ge.Nl,e.setFieldDetails(u,3,1,"",0,!1,!1),this.fldDict.push(u,e)),r&&a.includes("dcAlpha")&&(e=new ge.Nl,e.setFieldDetails(u,3,1,"",0,!1,!1),this.fldDict.push(u,e)))}}setFieldDetails(e,i,r){""!=r.Trim()?e[i].setFieldDetails(r):e[i].setFieldDetails(0)}GetWorkFlow(e){let r=e,a=this.CostCenterFieldsAllTables.Tables[9].filter(u=>1===u.Action||6===u.Action);for(let u=0;u<a.length;u++){if(""===a[u].Expression?.toString().trim())return parseInt(a[u].WorkFlowID);try{const c=this.eval.EvaluateExpression(a[u].Expression,r);if(null!==c&&"1"===c.toString())return parseInt(a[u].WorkFlowID)}catch(c){Logger.ErrorLog("ImportUtilitViewModel: GetWorkFlow error - "+c.message)}}return 0}BuildCCXML(e,i){let r="<XML>";for(const a of this.grData.Table){if(null===a[1]||""===a[1]||"0"===a[1])continue;const u=i.filter(c=>c.CostCenterColID==a[1]);if(u.length>0){const c=u[0];if(c.IsColumnUserDefined&&"LISTBOX"===c.ColumnDataType){const s=e[`${a[0]}_Key`];if(s&&parseInt(s)>0){const o=parseInt(c.ColumnCostCenterID);(2===o||3===o||o>5e4)&&(r+=`<Row CostCenterID="${o}" NODEID="${s}" />`)}}}}return r+="</XML>",r}CalculateAVGValue(e){e[this.GrossField]=parseFloat(e[this.QtyField])*parseFloat(e[this.RateField])}validateBatchInfo(e){Logger.InfoLog("ValidateBatchInfo: entering Quantity check"),e.forEach(i=>{if(""!==i.BatchID?.toString()){let r=0;r=parseFloat(i.BalQty)||0;const a=this.ExcelTable.filter(u=>u.BatchID===i.BatchID);if(a.length>0){let u=parseFloat(i.BalQty)||0,c=0;a.forEach(t=>{const s=t[this.QtyField];s&&!isNaN(parseFloat(s))&&(c=parseFloat(s),u-=c)}),i.BalQty=u}}}),Logger.InfoLog("ValidateBatchInfo: exiting Quantity check")}addBatchInformation(e){Logger.info("Entering AddBatchInformation");const r=Number(b.d.SessionManager.Preferences["Maintain Dimensionwise Batches"]||0),a=[...this.costCenterTableZero],u=[];let c=!1,t="",s="";for(const o of this.grData.Table){if(!o[1]||"0"===o[1])continue;const m=a.filter(h=>h.CostCenterColID===o[1].toString());if(m.length>0){const h=m[0];r>0&&h.ColumnCostCenterID.toString()===r.toString()?(t=o[0],c=!0):"50002"===h.ColumnCostCenterID.toString()&&b.d.SessionManager.Preferences.EnableLocationWise&&b.d.SessionManager.Preferences["LW Batches"]?s=o[0]:["int","numeric","float"].includes(h.UserColumnType.toLowerCase())&&"0"===h.IsCalculate&&""===h.Formula&&u.push(te._p.ComboBoxItems_2(o[0],h.UserColumnType.toLowerCase()))}}for(let o=0;o<e.length;o++)try{const m=this.DocDv[o];if(!m[this.ProductFieldName+"_Key"]||"1"===m.IsNewRow)continue;const h=Number(m[this.ProductFieldName+"_Key"]);new Date(m[this.DocDateField]),this.ScreenObject.CostCenterID=Number(this.Feature.SelectedValue),this.ScreenObject.LocationID=0;let l=-1;c&&m[t]&&(l=Number(m[t+"_Key"]||-1)),s&&(this.ScreenObject.LocationID=Number(m[s+"_Key"]));const g=this.ScreenObject.GetProductwiseBatches(h,0,this.VoucherType,null,l,!0,"");let T=Number(m[this.QtyField])||0;const S=Number(m[this.GrossField])||0,I=Number(m[this.RateField])||0;for(const d of u)d.Aliasname=m[d.Name]||"0";if(T>0){let d=T,y=0,D=0;this.validateBatchInfo(g[0]);for(const p of g[0]){if(0===d)break;let F=Number(p.BalQty)||0;if(0===F)continue;const E=()=>{const V={...m};V.BSRNO=o,V.BATCHNUMBER_Sys=p.BATCHNUMBER||"",V.BatchID=p.BatchID||"",V[this.QtyField]=F,this.GrossField&&V[this.RateField]&&(V[this.GrossField]=F*Number(V[this.RateField])),D=F*I;for(const L of u)L.Aliasname&&Number(L.Aliasname)>0&&(V[L.Name]=D/S*Number(L.Aliasname));V.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(m)+1,0,V)};if(d>=F){if(0===y){m.BATCHNUMBER_Sys=p.BATCHNUMBER,m.BatchID=p.BatchID,m[this.QtyField]=F,m.BSRNO=o,this.ExcelTable.includes(this.GrossField)&&m[this.RateField]&&(m[this.GrossField]=F*Number(m[this.RateField])),D=F*I;for(const V of u)V.Aliasname&&Number(V.Aliasname)>0&&(m[V.Name]=D/S*Number(V.Aliasname))}else E();y++,d-=F}else 0===y?(m.BATCHNUMBER_Sys=p.BATCHNUMBER,m.BatchID=p.BatchID,m[this.QtyField]=d):(F=d,E()),y++,d=0}if(d>0&&g[0].length>0){const p={...m};p.BSRNO=o,p.BATCHNUMBER_Sys="",p.BatchID="",p[this.QtyField]=d,p[this.RateField]&&(p[this.GrossField]=d*Number(p[this.RateField])),D=d*I;for(const F of u)F.Aliasname&&Number(F.Aliasname)>0&&(p[F.Name]=D/S*Number(F.Aliasname));p.IsNewRow="1",this.ExcelTable.splice(this.ExcelTable.indexOf(m)+1,0,p)}}}catch(m){Logger.error("AddBatchInformation : "+m.message)}return Logger.info("Exiting AddBatchInformation"),this.ExcelTable}getValidXml(e){return e?.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")||""}importDocumentEdit(){if(0===this.grData.Table.filter(a=>Number(a.FeatureFieldName)>0).length)return this.DisplayMessage="Select atleast one field for Update",void(this.MessageVisibility=!0);let i=0;const r=[...this.costCenterTableZero];for(let a=0;a<this.ExcelTable.length;a++){let u="",c="";for(let o=0;o<this.grData.Table.length;o++){const m=this.grData[o];if(!m.FeatureFieldName)continue;const h=r.find(n=>n.CostCenterColID===m.FeatureFieldName.toString());if(h){const n=this.ExcelTable[a][m.FieldName];Number(m.FeatureFieldName)<0?c+=`${h.SysColumnName}='${n}' AND `:u+=`${h.SysColumnName}='${n}',`}}u.endsWith(",")&&(u=u.slice(0,-1)),c.endsWith("AND ")&&(c=c.slice(0,-4));let t=`UPDATE INV_DocDetails SET ${u}`;c&&(t+=` WHERE ${c}`),t+=`; UPDATE ACC_DocDetails SET ${u}`,c&&(t+=` WHERE ${c}`),b.d.common.GetDataSetQuery(t)&&(i++,this.FailedRecourdList.push({Message:t,Name:""})),this.ImportedCount="Imported :"+(a+1-i),this.FailedCount=`Failed :${i}`}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage=`Import completed ( Total :${this.ExcelTable.length} ${this.ImportedCount} ${this.FailedCount} )`,this.MessageVisibility=!0}ImportDocument(){var e=this;return(0,Fe.A)(function*(){try{Logger.InfoLog("Entering ImportDocument ");let d,c=!0,t=!1,s=!1,o=!1,m=!1,h=!1,n=!1,l=!1,g=!1,T=0,S=0,I=0,y=0;if(e.CostCenterFieldsAllTables.Tables.length>2&&Object.keys(e.CostCenterFieldsAllTables.Tables[2][0]).includes("DocumentType")&&(y=N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType)),e._DocumentType=y,38==e._DocumentType){const X=b.d.document.GetDataSet("\n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                      where Name='Registers'\n  \n                      Select Value from ADM_GlobalPreferences WITH(NOLOCK)    \n                              where Name='PosShifts' and Value is not null and ISNUMERIC(Value)=1");X&&X.Tables?.length>0&&(X.Tables[0].length>0&&X.Tables[0][0].Value&&""!==X.Tables[0][0].Value.toString()&&(e.PosRegisterDim=Number(X.Tables[0][0].Value)),X.Tables.length>1&&X.Tables[1].length>0&&X.Tables[1][0].Value&&""!==X.Tables[1][0].Value.toString()&&(e.PosShiftDim=Number(X.Tables[1][0].Value)))}[1,2,3,4,6,13,25,26,27,31,34,39].includes(y)?e.VoucherType=1:[11,38,5,7,9,24,33,10,8,12].includes(y)&&(e.VoucherType=-1);let f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DonotupdateAccounts"===H.PrefName);if(f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DonotupdateInventory"===H.PrefName),f.length>0&&f[0].PrefValue&&(e.DonotUpdateInventory="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DuplicateProduct_IncrementQuantity"===H.PrefName),f.length>0&&f[0].PrefValue&&(t="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DuplicateProductClubBins"===H.PrefName),f.length>0&&f[0].PrefValue&&(s="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"AutoBatches"===H.PrefName),f.length>0&&f[0].PrefValue&&(o="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DumpStockCodes"===H.PrefName),f.length>0&&f[0].PrefValue&&(h="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DimWiseCurrency"===H.PrefName),f.length>0&&f[0].PrefValue&&"true"===f[0].PrefValue.toLowerCase()){const H=e.CostCenterFieldsAllTables.Tables[3].find(X=>"CurrencyDim"===X.PrefName);H&&H.PrefValue&&(S=parseInt(H.PrefValue,10))}f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DontSaveIf_QtyIsZero"===H.PrefName),f.length>0&&f[0].PrefValue&&(n="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DontSaveIf_RateZero"===H.PrefName),f.length>0&&f[0].PrefValue&&(g="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"DontSaveIf_ValueZero"===H.PrefName),f.length>0&&f[0].PrefValue&&(g="true"===f[0].PrefValue.toLowerCase()),f=e.CostCenterFieldsAllTables.Tables[3].filter(H=>"BatchBasedon"===H.PrefName),f.length>0&&f[0].PrefValue&&(e.BatchBasedon=f[0].PrefValue),s&&(t=!0),e.CostCenterFieldsAllTables.Tables.length>5&&e.CostCenterFieldsAllTables.Tables[5].map(H=>H.hasOwnProperty("name"))&&(f=e.CostCenterFieldsAllTables.Tables[5].filter(H=>"BinsDimension"==H.name),f.length>0&&f[0].value&&parseInt(f[0].value,10)>5e4&&(T=parseInt(f[0].value,10)));let B,D="",p="",F="",E="",V="",L="",O="",x="";if(e.ProfileID>-20&&e.ProfileID<0){e.ExcelTable.includes("Uniqu")||e.ExcelTable.push("Uniqu");let H=[];if(H.push("<XML>"),e.ExcelTable.includes("IsNewRow")){e.ExcelTable.filter(P=>"1"!==P.IsNewRow);for(let P=0;P<e.ExcelTable.length;P++){const _=e.ExcelTable[P];if(_.ProductCode&&(!e.ExcelTable.includes("RevenUStatus")||"Passed"!=e.ExcelTable[P].RevenUStatus.toString())){Logger.debug(`ImportUtility-RowNo ${P}`);let Y=`<Row Seq="${P}" `;Y+=`PCode="${U.Dw.GetValidXml(_.ProductCode)}" `,Y+=`Facility="${U.Dw.GetValidXml(_.Facility)}" `,e.ExcelTable.includes("businessunit")?Y+=`BUnit="${U.Dw.GetValidXml(_.businessunit)}" `:e.ExcelTable.includes("businessunit")&&(Y+=`BUnit="${U.Dw.GetValidXml(_["business unit"])}" `),Y+=`Department="${U.Dw.GetValidXml(_.Department)}" `,Y+=`WareHouse="${U.Dw.GetValidXml(_.Store)}" `,Y+=`DocDate="${e.formatDate(_.DocDate)}" `,_.Uniqu=_.DocNo+_.ProductCode+_.Department+_.Store,Y+="/>",H.push(Y)}}H.push("</XML>");const X=b.d.document.GetTMOImport(H);e.ExcelTable.includes("Department_Key")||e.ExcelTable.push("Department_Key"),e.ExcelTable.includes("Store_Key")||e.ExcelTable.push("Store_Key"),e.ExcelTable.includes("Facility_Key")||e.ExcelTable.push("Facility_Key"),e.ExcelTable.includes("businessunit")&&!e.ExcelTable.includes("BusinessUnit_Key")?e.ExcelTable.push("BusinessUnit_Key"):e.ExcelTable.includes("business unit")&&!e.ExcelTable.includes("Business Unit_Key")&&e.ExcelTable.push("Business Unit_Key"),e.ExcelTable.includes("Rate")||e.ExcelTable.push("Rate"),e.ExcelTable.includes("Gross")||e.ExcelTable.push("Gross"),e.ExcelTable.includes("TMOCODE")&&e.ExcelTable.Remove("TMOCODE"),e.ExcelTable.push("TMOCODE");const z=e.costCenterTableZero.filter(P=>"ProductID"==P.SysColumnName);if(z.length>0&&0==e.grData.Table.filter(P=>P.FeatureFieldName+z[0].CostCenterColID.toString()).length){let P={};P[1]=z[0].CostCenterColID.toString(),P[0]="TMOCODE",e.grData.Table.push(P)}if(e.costCenterTableZero.filter(P=>"dcalpha1"==P.SysColumnName),z.length>0&&0==e.grData.Table.filter(P=>P.FeatureFieldName+z[0].CostCenterColID.toString()).length){let P={};P[1]=z[0].CostCenterColID.toString(),P[0]="Uniqu",e.grData.Table.push(P)}if(e.costCenterTableZero.filter(P=>"dcalpha1"==P.SysColumnName),z.length>0&&0==e.grData.Table.filter(P=>P.FeatureFieldName+z[0].CostCenterColID.toString()).length){let P={};P[1]=z[0].CostCenterColID.toString(),P[0]="Rate",e.grData.Table.push(P)}if(e.costCenterTableZero.filter(P=>"Gross"==P.SysColumnName),z.length>0&&0==e.grData.Table.filter(P=>P.FeatureFieldName+z[0].CostCenterColID.toString()).length){let P={};P[1]=z[0].CostCenterColID.toString(),P[0]="Gross",e.grData.Table.push(P)}e.ExcelTable.includes("TMOCODE_Key")||e.ExcelTable.push("TMOCODE_Key"),e.ExcelTable.includes("Green Code")||e.ExcelTable.push("Green Code"),e.ExcelTable.includes("RevenUReason")||e.ExcelTable.push("RevenUReason"),e.ExcelTable.includes("RevenUStatus")||e.ExcelTable.push("RevenUStatus"),e.ExcelTable.includes("Cr")||e.ExcelTable.push("Cr"),e.ExcelTable.includes("DB")||e.ExcelTable.push("DB"),e.ExcelTable.includes("UOMID")||e.ExcelTable.push("UOMID"),V="CreditAccount",L="DebitAccount";const M=[];for(const P of e.grData.Table){if(null==P[1]||""==P[1].toString()||"0"==P[1].toString())continue;const _=e.costCenterTableZero.filter(Y=>Y.CostCenterColID===Y[1]);_.length>0&&("int"==_[0].UserColumnType.toString().toLowerCase()||"numeric"==_[0].UserColumnType.toString().toLowerCase()||"float"==_[0].UserColumnType.toString().toLowerCase())&&null!=_[0].IsCalculate&&""!=_[0].IsCalculate.toString()&&"0"==_[0].IsCalculate.toString()&&""==_[0].Formula.toString()&&M.push(te._p.ComboBoxItems_2(P[0].toString(),_[0].UserColumnType.toString().toLowerCase())),_.length>0&&"FLOAT"==_[0].ColumnDataType.toString().toUpperCase()&&("quantity"==_[0].SysColumnName.toString().toLowerCase()?e.QtyField=P[0].toString():"rate"==_[0].SysColumnName.toString().toLowerCase()?e.RateField=P[0].toString():"avgrate"==_[0].SysColumnName.toString().toLowerCase()?(e.isAvgrate=!0,e.RateField=P[0].toString()):"FreeQTY"==_[0].SysColumnName.toString()?E=P[0].toString():("gross"==_[0].SysColumnName.toString().toLowerCase()||"avgratevalue"==_[0].SysColumnName.toString().toLowerCase())&&(e.GrossField=P[0].toString()))}let oe=new at.bT,be=new at.bT;for(d=0;d<e.ExcelTable.length;d++){if(e.ExcelTable.includes("IsNewRow")&&"1"==e.ExcelTable[d].IsNewRow.toString())continue;let P=null;if(P=X.Tables[0].filter(1==e.VoucherType?_=>_.ProductID>0&&_.Seq===d.toString():_=>_.BalQty>0&&_.Seq===d.toString()),P.length>0){if(e.ExcelTable[d].Facility_Key=P[0].Loc,e.ExcelTable[d].Store_Key=P[0].Store,e.ExcelTable[d].Department_Key=P[0].Dep,e.ExcelTable.includes("businessunit")?e.ExcelTable[d].BusinessUnit_Key=P[0].Div:e.ExcelTable.includes("business unit")&&(e.ExcelTable[d]["Business Unit_Key"]=P[0].Div),e.ExcelTable[d].TMOCODE=P[0].ProductCode,e.ExcelTable[d].TMOCODE_Key=P[0].ProductID,e.ExcelTable[d]["Green Code"]=P[0].GreenCode,e.ExcelTable[d].UOMID=P[0].UOMID,e.ExcelTable[d].Cr=P[0].PurchaseAccountID,e.ExcelTable[d].DB=P[0].ClosingStockAccountID,"5"==P[0].ProductTypeid.toString()){e.ExcelTable.includes("BATCHNUMBER_Sys")||(e.ExcelTable.push("BATCHNUMBER_Sys"),e.ExcelTable.push("BatchID"),e.ExcelTable.push("IsNewRow"),e.ExcelTable.push("BSRNO"));let Ke,De,_=0,Y=0,re=0,ce=0,Ce=0,Ue=0;if(_=parseFloat(e.ExcelTable[d][e.QtyField].toString().Trim()),re=parseFloat(e.ExcelTable[d][e.GrossField].toString().Trim()),ce=parseFloat(e.ExcelTable[d][e.RateField].toString().Trim()),Y=_,1==e.VoucherType){let Ee=b.d.SessionManager.document.GetDataSet('select top 50 a.InvDocDetailsid,uomconvertedqty BalQty,a.docdate,a.BatchID,c.Batchnumber from Inv_DocDetails a with(nolock) join INV_Batches c on a.BatchID=c.BatchID  and c.STATUSID = 77 join com_docccdata b on a.invdocdetailsid=b.invdocdetailsid \n                                          where isqtyignored = 0 and dcCCNID9 = " + drprrows[0]["Store"].toString() + @"  and a.productid = " + drprrows[0]["ProductID"].toString() + ((complete.ContainsKey(drprrows[0]["ProductID"].toString())) ? " and a.InvDocDetailsid not in (" + complete[drprrows[0]["ProductID"].toString()] + ") " : "") + " and vouchertype = -1 order by docdate desc'),xe=parseFloat(e.ExcelTable[d].Qty.toString().Trim());Y=xe,Ue=0;for(const Se of Ee.Tables[0])if(""!=Se.BatchID.toString()){let Je=0;Je=parseFloat(Se.BalQty.toString());const Le=!1;if(Object.keys(be).includes(Se.InvDocDetailsid.toString())&&(Je-=be[Se.InvDocDetailsid.toString()]),Je>0){if(0==Ue)De=e.ExcelTable[d];else{const qe=e.ExcelTable.filter(tt=>tt.BSRNO===d.toString()&&tt.BatchID===Se.BatchID.toString());if(qe.length>0)De=qe[0];else{let tt={};for(const Bt of e.ExcelTable)tt[Bt.ColumnName]=e.ExcelTable[d][Bt.ColumnName];tt.IsNewRow="1",e.ExcelTable.push(tt)}}if(Ue++,xe>=Je?(De.Qty=Le&&""!=De.Qty.toString()?parseInt(De.Qty.toString())+Je:Je,xe-=Je,Object.keys(oe).includes(P[0].ProductID.toString())?oe[P[0].ProductID.toString()]+=","+Se.InvDocDetailsid.toString():oe.push(P[0].ProductID.toString(),Se.InvDocDetailsid.toString()),Object.keys(be).includes(Se.InvDocDetailsid.toString())&&be.Remove(Se.InvDocDetailsid.toString())):(De.Qty=Le&&""!=De.Qty.toString()?N.J0.Int(De.Qty.toString())+xe:xe,be.ContainsKey(Se.InvDocDetailsid.toString())?be[Se.InvDocDetailsid.toString()]+=xe:be.push(Se.InvDocDetailsid.toString(),xe),xe=0),De.BATCHNUMBER_Sys=Se.Batchnumber.toString(),De.BatchID=Se.BatchID.toString(),De.BSRNO=d,0==xe)break}}if(xe>0)if(new Date((new Date).getFullYear()+3,12,31),Ee=b.d.SessionManager.document('declare @lft bigint\n  \n                                      select @lft=BatchID from[INV_Batches] WITH(NOLOCK)\n                                        where[ProductID] = " + drprrows[0]["ProductID"].toString() + @" and[BatchNumber] = \'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\'\n\n                                        if (@lft is null)\n                                        BEGIN\n                                          select @lft=rgt from[INV_Batches] WITH(NOLOCK)\n                                          where batchid = 1\n  \n                                          INSERT INTO[INV_Batches]([BatchNumber], [ExpiryDate], [StatusID], [ProductID], [Depth], [ParentID], [lft], [rgt]\n                                            , [IsGroup], [CompanyGUID], [GUID], [CreatedBy], [CreatedDate])\n                                        VALUES(\'SK" + ((drprrows[0]["Loc"].toString() == "5") ? "SH" : "MCA") + @"BATCH\', convert(float, convert(datetime, \'" + dtExp.toLocaleDateString("dd/MMM/yyyy") + @"\')), 77, " + drprrows[0]["ProductID"].toString() + @", 1, 1, @lft, @lft + 1, 0, \'admin\', newid(), \'admin\', convert(float, convert(datetime, \'" + new Date().toLocaleDateString("dd/MMM/yyyy") + @"\')))\n      \n                                          select @@identity\n\n                                        update[INV_Batches] \n                                          set rgt = @lft + 2\n                                          where batchid = 1\n                                        END\n                                        ELSE \n                                          select @lft'),null!=Ee&&Ee.Tables.length>0&&Ee.Tables[0].Rows.length>0&&!Ee.Tables[0].includes("ErrorMessage"))if(Y!=xe){let Le={};for(const qe of e.ExcelTable)Le[qe.ColumnName]=e.ExcelTable[d][qe.ColumnName];Le.IsNewRow="1",Le.BSRNO=d,Le.BatchID=Ee.Tables[0][0][0].toString(),Le.BATCHNUMBER_Sys="SK"+("5"==P[0].Loc.toString()?"SH":"MCA")+"BATCH",Le.Qty=xe,e.ExcelTable.push(Le)}else e.ExcelTable[d].BSRNO=d,e.ExcelTable[d].BatchID=Ee.Tables[0][0][0].toString(),e.ExcelTable[d].Qty=xe,e.ExcelTable[d].BATCHNUMBER_Sys="SK"+("5"==P[0].Loc.toString()?"SH":"MCA")+"BATCH";else if(Y!=xe){let Le={};for(const qe of e.ExcelTable)Le[qe.ColumnName]=e.ExcelTable[d][qe.ColumnName];Le.IsNewRow="1",Le.BSRNO=d,Le.BatchID=0,Le.Qty=xe,e.ExcelTable.push(Le)}}else{var r=X.Tables[0].Compute("sum(BalQty)","Seq="+d.toString());if(null!=r&&N.J0.Int(r)>=_){for(let Ae of M)Ae.Aliasname=e.ExcelTable.includes(Ae.Name)&&""!=e.ExcelTable[d][Ae.Name].toString()?e.ExcelTable[d][Ae.Name].toString():"0";for(const Ae of P)if(""!=Ae.BatchID.toString()){let Ee;Ee=0,Ee=parseFloat(Ae.BalQty.toString());let Et=Ee.toString();b.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=b.d.SessionManager.Preferences.DecimalsinQty&&(Et=Ee.toString("N"+b.d.SessionManager.Preferences.DecimalsinQty)),Ee=N.J0.Int(Et);const xe=e.ExcelTable.filter(Se=>Se.BatchID===Ae.BatchID.toString());if(xe.length>0){Ce=0;for(let Se=0;Se<xe.length;Se++)""!=xe[Se][e.QtyField].toString()&&parseFloat(xe[Se][e.QtyField].toString())&&(Ee-=Ce)}if(Ee>0){if(0==Ue)De=e.ExcelTable[d];else{let Se={};for(const Je of e.ExcelTable)Se[Je.ColumnName]=e.ExcelTable[d][Je.ColumnName];Se.IsNewRow="1",e.ExcelTable.push(Se)}Ue++,De.TMOCODE=Ae.ProductCode,De.TMOCODE_Key=Ae.ProductID,De["Green Code"]=Ae.GreenCode,De.UOMID=Ae.UOMID,De.Cr=Ae.PurchaseAccountID,De.DB=Ae.ClosingStockAccountID,_>=Ee?(De[e.QtyField]=Ee,_-=Ee):(De[e.QtyField]=_,_=0),De.BATCHNUMBER_Sys=Ae.Batchnumber.toString(),De.BatchID=Ae.BatchID.toString(),De.BSRNO=d,e.ExcelTable.includes(e.GrossField)&&""==e.ExcelTable.GrossField.Expression&&""!=De.RateField.toString()&&(De.GrossField=N.J0.Int(Ee)*N.J0.Int(De.RateField)),Ke=Ee*ce;for(const Se of M)null!=Se.Aliasname&&""!=Se.Aliasname.toString()&&N.J0.Int(Se.Aliasname)>0&&(De[Se.Name]=Ke/re*N.J0.Int(Se.Aliasname));if(0==_)break}}if(_>0&&Y!=_){De={};for(const Ae of e.ExcelTable)De[Ae.ColumnName]=e.ExcelTable[d][Ae.ColumnName];De.IsNewRow="1",De.BSRNO=d,De.QtyField=_,e.ExcelTable.push(De)}}}}}else P=X.Tables[0].filter(_=>_.ProductID&&_.Seq==d.i.toString()),P.length>0&&(e.ExcelTable[d].Facility_Key=P[0].Loc,e.ExcelTable[d].Store_Key=P[0].Store,e.ExcelTable[d].Department_Key=P[0].Dep,e.ExcelTable.includes("businessunit")?e.ExcelTable[d].BusinessUnit_Key=P[0].Div:e.ExcelTable.includes("business unit")&&(e.ExcelTable[d]["Business Unit_Key"]=P[0].Div),e.ExcelTable[d].TMOCODE=P[0].ProductCode,e.ExcelTable[d].TMOCODE_Key=P[0].ProductID,e.ExcelTable[d]["Green Code"]=P[0].GreenCode,e.ExcelTable[d].UOMID=P[0].UOMID,e.ExcelTable[d].Cr=P[0].PurchaseAccountID,e.ExcelTable[d].DB=P[0].ClosingStockAccountID)}}}if(!e.ScanDocument(t,s,T,h))return;if(e.ConstructFormulaFields(),e.IsInventory=(0,K.yG0)(e.CostCenterFieldsAllTables.Tables[2][0].IsInventory.toString()),""==e.DocNumberField&&""==p&&!(e.ProfileID>-20&&e.ProfileID<0))return e.DisplayMessage="Document No. Not Exists",void(e.MessageVisibility=!0);if(""==e.DocDateField)return e.DisplayMessage="Doc Date Not Exists",void(e.MessageVisibility=!0);if(38==e._DocumentType){if(""==e.PosRegisterField)return e.DisplayMessage="Pos register does not Exists",void(e.MessageVisibility=!0);if(""==e.PosShiftField)return e.DisplayMessage="Pos shift does not Exists",void(e.MessageVisibility=!0)}if(16!=y&&17!=y&&28!=y&&29!=y&&3!=y&&8!=y&&13!=y&&31!=y&&32!=y){if(e.FillAccountValues(),""==V)return e.DisplayMessage="Credit account does not Exists",void(e.MessageVisibility=!0);if(""==L)return e.DisplayMessage="Debit account does not Exists",void(e.MessageVisibility=!0)}if(e.IsInventory)if(40062==parseInt(e.Feature.SelectedValue)||40067==parseInt(e.Feature.SelectedValue)||40068==parseInt(e.Feature.SelectedValue)||40051==parseInt(e.Feature.SelectedValue)||40069==parseInt(e.Feature.SelectedValue)||40089==parseInt(e.Feature.SelectedValue))e.QtyField="0",e.GrossField="0",e.RateField="0";else{if(""==e.QtyField)return e.DisplayMessage="Quantity does not Exists",void(e.MessageVisibility=!0);if(n&&(f=e.ExcelTable.filter(H=>"0"===H.QtyField),f.length>0))return e.DisplayMessage=b.d.GetResource("Doc_ZeroQty")+" "+e.ExcelTable.indexOf(f[0])+1,void(e.MessageVisibility=!0);if(""==e.RateField)return e.DisplayMessage="Rate does not Exists",void(e.MessageVisibility=!0);if(l&&(f=e.ExcelTable.filter(H=>"0"===H.RateField),f.length>0))return e.DisplayMessage=b.d.GetResource("Doc_ZeroRate")+" "+e.ExcelTable.indexOf(f[0])+1,void(e.MessageVisibility=!0);if(""==e.GrossField)return e.DisplayMessage="Value does not Exists",void(e.MessageVisibility=!0);if(g&&(f=e.ExcelTable.filter(H=>"0"===H.GrossField),f.length>0))return e.DisplayMessage=b.d.GetResource("Doc_ZeroValue")+" "+e.ExcelTable.indexOf(f[0])+1,void(e.MessageVisibility=!0)}e.FillLookupFields(),e.DoNotCreateCostCenter||e.FillCostCenterFields(!1),B=e.costCenterTableZero;let q=B.filter(H=>"AccountId"===H.SysColumnName||"AccountIdCode"===H.SysColumnName);if(q.length>1){const H=q[0].CostCenterColID,X=q[1].CostCenterColID;if(2==e.grData.Table.filter(G=>G.FeatureFieldName==H||G.FeatureFieldName==X).length)return e.DisplayMessage="Both Account Code & Name Exists",void(e.MessageVisibility=!0)}if(B.filter(H=>"DebitAccount"===H.SysColumnName||"DebitAccountCode"===H.SysColumnName).length>1){const H=q[0].CostCenterColID,X=q[1].CostCenterColID;if(2==e.grData.Table.filter(G=>G.FeatureFieldName==H||G.FeatureFieldName==X).length)return e.DisplayMessage="Both DebitAccount Code & Name Exists",void(e.MessageVisibility=!0)}if(B.filter(H=>"CreditAccount"===H.SysColumnName||"CreditAccountCode"===H.SysColumnName).length>1){const H=q[0].CostCenterColID,X=q[1].CostCenterColID;if(2==e.grData.Table.filter(G=>G.FeatureFieldName==H||G.FeatureFieldName==X).length)return e.DisplayMessage="Both CreditAccount Code & Name Exists",void(e.MessageVisibility=!0)}let k=0,ie=0;k=b.d.SessionManager.Preferences["Maintain Dimensionwise stock"].toString();let ne=!1;ne=b.d.SessionManager.Preferences["Location Stock"];let W,Re=!1,ye="",w="";if(B=e.costCenterTableZero,ne||k>0)for(const H of e.grData.Table){const X=H.FeatureFieldName;if(null==X||""==X.toString()||"0"==X.toString())continue;let z=B.filter(G=>G.CostCenterColID==X.toString());z.length>0&&k>0&&z[0].ColumnCostCenterID.toString()==k.toString()&&(ye=H.FieldName.toString(),Re=!0),z.length>0&&ne&&"50002"==z[0].ColumnCostCenterID.toString()&&b.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,K.yG0)(b.d.SessionManager.Preferences.EnableLocationWise)&&(w=H.FieldName.toString())}e.DocDv=e.ExcelTable,e.ProfileID>-20&&e.ProfileID<0?(e.ExcelTable.includes("RevenUStatus")&&e.DocDv.filter(H=>null==H.RevenUStatus||"Passed"==H.RevenUStatus),e.ExcelTable.includes("IsNewRow")?e.DocDv.sort((H,X)=>new Date(H[e.DocDateField]||"").getTime()-new Date(X[e.DocDateField]||"").getTime()||Number(H.BSRNO||0)-Number(X.BSRNO||0)||Number(H.IsNewRow||0)-Number(X.IsNewRow||0)):e.DocDv.sort((H,X)=>new Date(H[e.DocDateField]||"").getTime()-new Date(X[e.DocDateField]||"").getTime())):e.DocDv.sort(""!=p?(H,X)=>X.VoucherNoField-H.VoucherNoField:""!=e.DocPrefixField?(H,X)=>X.DocPrefixField-H.DocPrefixField&&H.DocNumberField-X.DocNumberField:(H,X)=>X.DocNumberField-H.DocNumberField),!(e.ProfileID>-20&&e.ProfileID<0)&&e.ExcelDataColumn.includes("IMPORT_STATUS")&&e.DocDv.filter(H=>null==H.IMPORT_STATUS||"PASS"==H.IMPORT_STATUS),o&&-1==e.VoucherType&&!(e.ProfileID>-20&&e.ProfileID<0)&&(e.ExcelTable.includes("BATCHNUMBER_Sys")||(e.ExcelTable.push("BATCHNUMBER_Sys"),e.ExcelTable.push("BatchID"),e.ExcelTable.push("IsNewRow"),e.ExcelTable.push("BSRNO"),e.ExcelTable=e.addBatchInformation(e.DocDv)));let de=0,$e=0,A=0,Be=0,J=0,ae="",R="",Q="",_e="",Te="",Xe="",v="",se="",me="",fe="",he="",Me="",ke="",Ne="",pe="",He="",Qe="",lt="",st=[];st.push({AccountID:null,Amount:null,IsCredit:null,AccountName:null}),e.ProgressMax=N.J0.Int(e.DocDv.length);let Ye,Pe,et,Oe="",St="",je="",Tt="",ft="",ut="",We="",ot="",Ot="",fi="",Ut="",mt=!1,kt=!1,Gt=!1,Ze=1,Ie=1,ct=0,we=1;for(e.IsInventory||(Te+="<DocumentXML>"),Xe+="<AttachmentsXML>",d=0;d<e.DocDv.length;d++,Ze++,e.ProgressValue++){if(Logger.DebugLog("ImportUtility-seqNo "+Ze.toString()),ct=0,$e=A,ae=R,St=je,""!=p){if(""==e.DocDv[d][p].toString().Trim())continue;let X;X=""!=e.Delimiter.toString()?e.DocDv[d][p].toString().Trim().Split(e.Delimiter[0]):e.DocDv[d][p].toString().Trim().Split(),R=X[X.length()-1],A=N.J0.Int(X[X.length()-1]),X.length()>=2&&(je=X[X.length()-2])}else{if(""!=e.DocNumberField){if(""==e.DocDv[d][e.ExcelDataColumn.indexOf(e.DocNumberField)].toString().Trim())continue;A=N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(e.DocNumberField)].toString().Trim()),R=e.DocDv[d][e.ExcelDataColumn.indexOf(e.DocNumberField)].toString().Trim()}else if(e.ProfileID>-20&&e.ProfileID<0){if(""==e.DocDv[d][F].toString().Trim())continue;if(""==e.DocDv[d].TMOCODE_Key.toString().Trim()){e.DocDv[d].RevenUStatus="Failed",e.DocDv[d].RevenUReason="Product not found",Ie++,de++;continue}if(""==e.DocDv[d].Facility_Key.toString().Trim()){e.DocDv[d].RevenUStatus="Failed",e.DocDv[d].RevenUReason="Facility not found",Ie++,de++;continue}if(""==e.DocDv[d].Store_Key.toString().Trim()){e.DocDv[d].RevenUStatus="Failed",e.DocDv[d].RevenUReason="Store not found",Ie++,de++;continue}let X;X.append("<PXML>"),X.append("<Row "),X.append(` ProductID="${e.DocDv[d].TMOCODE_Key}" `),X.append(' QTY="1" '),X.append(' DETAILSID="0" '),X.append(` avgwhere=" and dcccnid2=${e.DocDv[d].Facility_Key} and dcccnid9=${e.DocDv[d].Store_Key}"`),X.append(" ></Row>"),X.append("</PXML>");const z=e.ScreenObject.GetReconcileAvgRate(X.toString(),(0,ve._U)(e.DocDv[d][F].toString()));null!=z&&z.Tables.length>0&&z.Tables[0].includes("AvgRate")&&z.Tables[0].Rows.length>0&&(e.DocDv[d].Rate=z.Tables[0][0].AvgRate,""!=e.DocDv[d].Qty.toString()&&""!=z.Tables[0][0].AvgRate.toString()&&(e.DocDv[d].Gross=N.J0.Int(e.DocDv[d].Qty.toString())*N.J0.Int(z.Tables[0][0].AvgRate.toString())))}je=""!=e.DocPrefixField?e.DocDv[d][e.ExcelDataColumn.indexOf(e.DocPrefixField)].toString():""}if(($e!=A||e.PartialSave||St!=je||d>0&&e.ProfileID>-20&&e.ProfileID<0&&(!e.ExcelDataColumn.includes("IsNewRow")||"1"!=e.DocDv[d][e.ExcelDataColumn.indexOf("IsNewRow")].toString()))&&""!=Te.toString()&&"<DocumentXML>"!=Te.toString()){e.IsInventory||(Te+="</DocumentXML>"),Xe+="</AttachmentsXML>",e.BulkSave&&(v.Insert(0,"<DocXML>"),se.Insert(0,"<NumXML>"),me.Insert(0,"<TextXML>"),fe.Insert(0,"<CCXML>"),Te.Insert(0,"<AccXML>"),Qe.Insert(0,"<EXTRAXML>"),lt.Insert(0,"<DocExtraXML>"),v+="</DocXML>",se+="</NumXML>",me+="</TextXML>",fe+="</CCXML>",Te+="</AccXML>",Qe+="</EXTRAXML>",lt+="</DocExtraXML>",e.argParam=[Te.toString(),v.toString(),se.toString(),me.toString(),fe.toString(),Qe.toString(),lt.toString()],Logger.DebugLog("BulkImportUtility-Rows "+Te.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+se.toString()),Logger.DebugLog("BulkImportUtility-Text "+me.toString()),Logger.DebugLog("BulkImportUtility-CC "+fe.toString())),$e!=A&&(e.PrevDocID=0);let X=0;e.strSerial.length>0&&(X=e.strSerial.length),e.strSerial.length>0&&e.strSerial.length!=X&&(e.DocDv[d-Ie].xIMP_STATUSx="FAIL",e.DocDv[d-Ie].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(d-Ie),de++,e.FailedRecourdList.push({Message:e.ErrorMessage,Name:je+"-"+R}));let z=yield e.SaveDocument(ie,St,ae,Tt,ft,ut,e.IsInventory,Te.toString(),Xe.toString(),st,ot,Be,J,e.fldDict,we,Pe,e.argParam);if(ie=z?.docId,e.ErrorMessage=z?.errorMessage,ie<1){if(e.DocDv[d-Ie].xIMP_STATUSx="FAIL",e.DocDv[d-Ie].IMPORT_MESSAGE=e.ErrorMessage,e.ExcelTable.includes("RevenUStatus")&&(e.DocDv[d-Ie].RevenUStatus="Failed",e.DocDv[d-Ie].RevenUReason=e.ErrorMessage),de++,!(e.ProfileID>-20&&e.ProfileID<0)){for(let j=0;j<e.grData.Table.length;j++)if(e.DocDv.filter(""!=D?ue=>ue.DocNumberField==ue.PreviousDocNumber:ue=>ue.VoucherNoField==ue.PreviousDocNumber),e.DocDv.includes(e.grData.Table[j][0].toString()+"_Key")&&e.DocDv.length>0)for(let ue=0;ue<e.DocDv.length;ue++)""==e.DocDv[ue][e.grData.Table[j][0].toString()+"_Key"].toString()&&e.FailedRecourdList.push({Message:"Invalid "+e.grData.Table[j][0].toString()+" at Row No:"+(ue+1),Name:je+"-"+ae});let G;G=e.ExcelTable.includes("IMPORT_STATUS")?e.DocDv.filter(j=>null==e.DocDv.IMPORT_STATUS||"PASS"==e.DocDv.IMPORT_STATUS):[]}e.FailedRecourdList.push({Message:e.ErrorMessage,Name:St+"-"+ae}),e.strSerial=[]}else e.DocDv[d-Ie].xIMP_STATUSx="PASS",e.DocDv[d-Ie].IMPORT_MESSAGE="",e.ExcelTable.includes("RevenUStatus")&&(e.DocDv[d-Ie].RevenUStatus="pass",e.DocDv[d-Ie].RevenUReason=e.ErrorMessage),I++,e.strSerial=[];e.ImportedCount=e.IsSaveDocValidate?"Valid :"+I.toString():"Imported :"+I.toString(),e.FailedCount="Failed :"+de.toString(),Tt="",ft="",ut="",(!(e.ProfileID>-20&&e.ProfileID<0)||e.DocDv[d][F].toString().Trim()!=e.PrevDocDate)&&(Ze=1),ot="",Ie=1,Te="",Xe="",st=[],J=0,Be=0,e.BulkSave&&(v="",se="",me="",fe=""),e.IsInventory||(Te+="<DocumentXML>"),Xe+="<AttachmentsXML>"}if(40079==N.J0.Int(e.Feature.SelectedValue)){for(const G of e.grData.Table){const j=G.FeatureFieldName;let ue=e.ExcelDataColumn.indexOf(G.FieldName);if(null==j||""==j.toString()||"0"==j.toString())continue;let M=B.filter(oe=>oe.CostCenterColID==j.toString());if(M.length>0){let oe=M[0].SysColumnName.toString();Logger.InfoLog("ImportCosCenters Columnname ="+oe),"dcalpha1"==oe.toLowerCase()?e.PayrollMonth=(0,ve._U)(e.DocDv[d][ue]):"dcccnid51"==oe.toLowerCase()&&(fi=e.DocDv[d][ue].toString()+"_Key",Ut=e.DocDv[d][ue].toString())}}let z=b.d.document.GetDataSet('SELECT * FROM INV_DOCDETAILS I WITH(NOLOCK)\n                                          JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                                          WHERE CostCenterID = 40079 AND ISDATE(t.dcAlpha1) = 1 AND c.dcCCNID51 = " + EmpID + " AND CONVERT(DATETIME, t.dcAlpha1) = CONVERT(DATETIME, \'" + PayrollMonth + "\')');if(null!=z&&z.Rows.length>0){e.DisplayMessage="Attendance Dimension Wise already Posted For the Month",de++,e.FailedRecourdList.push({Name:Ut.toString(),Message:e.DisplayMessage});continue}}e.ProfileID>-20&&e.ProfileID<0&&(e.ExcelTable.includes("IsNewRow")&&"1"==e.DocDv[d].IsNewRow.toString()?Ie++:e.DocDv[d].Uniqu.toString());let H=0;do{if(1==H&&(ct=0),e.BulkSave||(e.IsInventory&&(Te+="\x11"),Te+="<Row>",Te+="<AccountsXML>",v="",se="",me="",fe="",He="",Me="",ke="",he="",Ne="",et=0,Pe=1,we=1),S>5e4&&B.filter(j=>j.SysTableName==j.COM_DocCCData&&j.ColumnCostCenterID==j.CurrencyDim).length>0){let j=e.grData.Table.filter(ue=>ue.FeatureFieldName==B[0].CostCenterColID.toString());j.length>0&&e.ExcelDataColumn.includes(j[0].FieldName.toString()+"_Curr")&&null!=e.DocDv[d][j[0].FieldName.toString()+"_Curr"]&&""!=e.DocDv[d][j[0].FieldName.toString()+"_Curr"].toString()&&parseInt(e.DocDv[d][j[0].FieldName.toString()+"_Curr"].toString())}Gt=!1,Oe="",Ye=!1,We="",Ot="",mt=!1,e.BulkSave?(v+='<Transactions  DocSeqNo="'+Ze.toString()+'" ',se+='<Numeric  DocSeqNo="'+Ze.toString()+'" ',fe+='<CostCenters  DocSeqNo="'+Ze.toString()+'" ',me+='<Alpha  DocSeqNo="'+Ze.toString()+'" '):(v+='<Transactions DocSeqNo="'+Ze.toString()+'" ',se+='<Numeric Query="',me+='<Alpha Query="',fe+='<CostCenters Query="'),v+=e.DoNotCreateCostCenter?'Create="0" ':'Create="1" ',v+='DocDetailsID="0" ';let X,z=!1;e.IsInventory&&e.ExcelDataColumn.includes(e.ProductFieldName+"_PrdTypeID")&&!N.J0.StringIsNullOrEmpty(e.DocDv[d][e.ProductFieldName+"_PrdTypeID"].toString())&&(e.ProductTypeID=N.J0.Int(e.DocDv[d][e.ProductFieldName+"_PrdTypeID"]));for(const G of e.grData.Table){let j=e.ExcelDataColumn.indexOf(G.FieldName);const ue=G.FeatureFieldName;if(null==ue||""==ue.toString()||"0"==ue.toString())continue;let M=B.filter(oe=>oe.CostCenterColID==ue.toString());if(M.length>0){X=M[0].SysColumnName.toString();let be,oe="";if(e.fldDict.ContainsKey(M[0].ResourceData.toString().TrimEnd("*"))&&e.fldDict[M[0].ResourceData.toString().TrimEnd("*")].setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),("voucherno"==X.toLowerCase()||"docnumber"==X.toLowerCase())&&e.IsUpdate){let P="";P=e.IsInventory?N.J0.StringIsNullOrEmpty(e.DocPrefixField)?'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM Inv_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + this.Feature.SelectedValue + " AND DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo ':N.J0.StringIsNullOrEmpty(e.DocPrefixField)?'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND DocNumber=\'" + CurrentDocNo ':'SELECT DocID FROM ACC_DocDetails WITH(NOLOCK) WHERE CostCenterID=" + Feature.SelectedValue + " AND  DocPrefix=\'" + this.DocDv[i][DocPrefixField].toString() + "\' AND DocNumber=\'" + CurrentDocNo';const _=b.d.document.GetDataSet(P);null!=_&&_.Tables[0].Rows.length>0&&(ie=N.J0.Int(_.Tables[0][0].DocID.toString()))}if(e.isAvgrate&&"AVGRATE"==X.toUpperCase()){e.BuildCCXML(e.DocDv[d].Row,B);let re,_=N.J0.Int(e.DocDv[d][e.ProductFieldName+"_Key"]),Y=N.J0.Int(e.DocDv[d][e.QtyField]);re=(0,ve._U)(e.DocDv[d][F].toString()),e.ScreenObject.DocDate.Date=re.Date,e.ScreenObject.CostCenterID=N.J0.Int(e.Feature.SelectedValue),e.ScreenObject.AvgrateExists=!0,e.ScreenObject.LocationID=0,""!=w&&(e.ScreenObject.LocationID=N.J0.Int(e.DocDv[d][w+"_Key"].toString()));let ce=0;Re&&""!=ye&&(ce=N.J0.Int(e.DocDv[d][ye+"_Key"].toString()));const Ce=e.ScreenObject.GetProductTypeDetails(_.toString(),re.Date,1,Y,"0",null,!1,"",!0,ce,null);if(null!=Ce&&Ce.Tables.length>0&&Ce.Tables[0].includes("AvgRate")&&""!=Ce.Tables[0][0].AvgRate.toString()){let Ue=0;Ue=N.J0.Int(N.J0.Int(Ce.Tables[0][0].AvgRate.toString()("N"+b.d.SessionManager.Preferences.DecimalsinAmount))),e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)]=Ue,e.fldDict.RATE.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),e.DocDv[d][e.ExcelDataColumn.indexOf(e.GrossField)]=N.J0.Int(Y*N.J0.Int(e.DocDv[d][e.RateField]("N"+b.d.SessionManager.Preferences.DecimalsinAmount)))}}else"RATE"==X.toUpperCase()&&e.fldDict.RATE.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString());if("quantity"==X.toLowerCase()&&e.fldDict.QTY.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),"FreeQTY"==X&&e.fldDict.FreeQTY.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),"EXCHANGERATE"==X.toUpperCase()&&(e.fldDict.EXCHANGERATE.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),Pe=N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString())),"gross"==X.toLowerCase()&&e.fldDict.GROSS.setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),"docdate"==X.toLowerCase())Tt=e.DocDv[d][j].toString().Trim();else if("duedate"==X.toLowerCase())ft=e.DocDv[d][j].toString().Trim();else if("billno"==X.toLowerCase())ut=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString().replace("&","&amp;").Trim(),v+=X+'="'+ut+'" ';else if("billwisedocno"==X.toLowerCase())ot=e.DocDv[d][j].toString().Trim();else if("accountid"==X.toLowerCase())Oe=e.DocDv[d][j].toString().Trim();else if("accountidcode"==X.toLowerCase())Oe=e.DocDv[d][j].toString().Trim(),Ye=!0;else if("refno"==X.toLowerCase()&&e.IsSnoBasedLinking&&Object.keys(e.ccdv).includes("400")&&Object.keys(e.ccdv).includes("43")){let P=null;var a=e.grData.Table.filter(_=>"-501"==_.FeatureFieldName);a.length>0&&(P=e.ccdv[400].ToTable().filter(_=>_.VoucherNo==e.ExcelTable[d][G[0].toString()].Trim()&&_.DocSeqNo==e.ExcelTable[d][a[0][0].toString()].Trim())),P.length()>0&&(v+=' LinkedInvDocDetailsID="'+P[0].InvDocDetailsID.toString()+'" ',v+=' RefNO="'+e.ExcelTable[d][G[0].toString()].Trim()+'" ',P=e.ccdv[43].ToTable().filter(_=>_.CostCenterIDLinked==P[0].CostCenterID.toString()),P.length()>0&&(v+=' LinkedFieldName="'+P[0].SysColumnName.toString()+'" '))}else if("Batchno"==M[0].SysColumnName.toString()||"MfgDate"==M[0].SysColumnName.toString()||"ExpDate"==M[0].SysColumnName.toString()){if("MfgDate"==M[0].SysColumnName.toString()||"ExpDate"==M[0].SysColumnName.toString()){let P;P=(0,ve._U)(e.DocDv[d][j].toString().Trim()),P&&(Ne+=" "+M[0].SysColumnName.toString()+'="'+P.toLocaleDateString("dd/MMM/yyyy")+'" ')}else if(1==e.VoucherType){Ne+=' BatchID="0" '+M[0].SysColumnName.toString()+'="'+e.DocDv[d][j].toString().Trim()+'" ';try{if(e.ControlGen=new gt.ControlGenerator,e.ControlGen.LoadScreen_2(e,16),e.ControlGen.InitAutoCode(e.ControlGen.Data.Tables[9],!1),e.ControlGen.IsAutoCode&&(e.ControlGen.SetAutoCode(e.BatchCode,!1,1,e.ControlGen.Data.Tables[9]),!N.J0.StringIsNullOrEmpty(e.BatchCode.Text))){let P=0,_=0,Y="";if(P=N.J0.Int(e.BatchCode.Text),d>0&&P>0){if(P+=d,_=N.J0.Int(e.ControlGen.Data.Tables[9][0].CodeNumberLength.toString()),_-=P.toString().length,_>0)for(let re=0;re<_;re++)Y+="0";e.BatchCode.Text=Y+P.toString(),Ne+=' BatchCode="'+e.BatchCode.Text.Trim()+'" ',Ne+=' BatchCurrID="'+P+'" '}else Ne+=' BatchCode="'+e.BatchCode.Text.Trim()+'" ',Ne+=' BatchCurrID="'+P+'" '}}catch{}}else if(!o){let P=0;const _=N.J0.Int(e.DocDv[d][e.ProductFieldName+"_Key"]);let Y,re;Y=(0,ve._U)(e.DocDv[d][F].toString()),e.ScreenObject.DocDate.Date=Y.Date,e.ScreenObject.CostCenterID=N.J0.Int(e.Feature.SelectedValue),""!=w&&(e.ScreenObject.LocationID=N.J0.Int(e.DocDv[d][w+"_Key"].toString())),Re&&""!=ye&&(re=(0,ve._U)(e.DocDv[d][ye+"_Key"].toString()));const ce=e.ScreenObject.GetProductwiseBatches(_,P,e.VoucherType,null,re,!0,"");if(null!=ce&&ce.Tables.length>0&&ce.Tables[0].Rows.length>0&&!ce.Tables[0].includes("ErrorMessage"))for(let Ce of ce.Tables[0].Rows)if(Ce.BATCHNUMBER.toString()==e.DocDv[d][j].toString().Trim()){Ne+=' BatchID="'+Ce.BatchID.toString()+'" '+M[0].SysColumnName.toString()+'="'+e.DocDv[d][j].toString().Trim()+'" Quantity="'+e.DocDv[d][e.ExcelDataColumn.indexOf(e.QtyField)].ToString().trim()+'"';break}}}else if("SerialNo"==M[0].SysColumnName.toString()){m=!0;let P=null;-1==e.VoucherType&&null!=e.DocDv[d][e.ProductFieldName+"_Key"]&&""!=e.DocDv[d][e.ProductFieldName+"_Key"].toString()&&(P=b.d.document.GetSerialNumberScreenDetails(parseInt(e.DocDv.ProductFieldName_Key),0,0,0,0,!1,""));let _=e.DocDv[d][j].toString().Trim().split(",");if(_.length>0){pe+="<xml>";for(let Y=0;Y<_.length;Y++){if(pe+="<Row ",pe+=' SerialProductID="0" ',pe+=' SerialNumber="'+U.Dw.GetValidXml(_[Y].toString()).Trim()+'" ',0==Y&&(e.strSerial=e.strSerial.concat(_)),1==e.VoucherType)pe+=' StatusID="157" ',pe+=' RefInvDocDetailsID="0" ',pe+=' IsAvailable="1" ',pe+=' SerialGUID="'+N.J0.NewGuid().toString()+'" ';else if(-1==e.VoucherType&&(pe+=' StatusID="158" ',null!=P&&P.Tables.length>1&&P.Tables[1].Rows.length>0)){let re=P.Tables[1].filter(ce=>ce["SerialNumber="]==_[Y].toString().Trim()+"'");null!=re&&re.length()>0&&(pe+=' RefInvDocDetailsID="'+re[0].InvDocDetailsID.toString()+'" ',pe+=' IsAvailable="0" ',pe+=' SerialGUID="'+re[0].SerialGUID.toString()+'" ')}pe+=" ></Row>"}pe+="</xml>"}}else if("DebitAmount"==M[0].SysColumnName.toString()&&null!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&""!=e.DocDv[d][j].toString().Trim()&&N.J0.Int(e.DocDv[d][j].toString().Trim())>0)et=N.J0.Int(e.DocDv[d][j].toString().Trim()),""!=O&&""!=e.DocDv[d][O+"_Key"].toString()&&(we=N.J0.Int(e.DocDv[d][O+"_Key"].toString())),""!=x&&""!=e.DocDv[d][x].toString()&&(Pe=N.J0.Int(e.DocDv[d][x].toString())),v+=e.ScreenObject.GetAccountTransaction(Oe,"PactReservedAccount",Ye,et.toString(),we,Pe);else if("CreditAmount"==M[0].SysColumnName.toString()&&null!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&""!=e.DocDv[d][j].toString().Trim()&&N.J0.Int(e.DocDv[d][j].toString().Trim())>0)et=N.J0.Int(e.DocDv[d][j].toString().Trim()),""!=O&&""!=e.DocDv[d][O+"_Key"].toString()&&(we=N.J0.Int(e.DocDv[d][O+"_Key"].toString())),""!=x&&""!=e.DocDv[d][x].toString()&&(Pe=N.J0.Int(e.DocDv[d][x].toString())),v+=e.ScreenObject.GetAccountTransaction("PactReservedAccount",Oe,Ye,et.toString(),we,Pe);else if("Attachments"==M[0].SysColumnName.toString())try{_e=e.DocDv[d][j].toString().Trim();let P=_e.split(";");for(let _ in P);}catch{Q=""}else if(null!=M[0].IsColumnUserDefined&&""!=M[0].IsColumnUserDefined.toString()&&(0,K.yG0)(M[0].IsColumnUserDefined.toString())){if("LISTBOX"==M[0].ColumnDataType.toString())5!=N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&h&&b.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")&&b.d.SessionManager.Preferences.POSItemCodeDimension==M[0].ColumnCostCenterID.toString()&&""!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()?v.toString().Contains("StockCode=")||(v+=' StockCode="'+e.DocDv[d][j].toString().Trim()+'" '):""!=e.DocDv[d][G.FieldName.toString()+"_Key"].toString()&&N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"])>0&&(5==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType)&&1==H?M[0].UserColumnName.toString().Contains("TO")&&""!=e.DocDv[d][G.FieldName.toString()+"_Key"].toString()&&N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"])>0&&(he+=e.BulkSave?M[0].SysColumnName.toString()+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':M[0].SysColumnName.toString()+"="+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+", "):M[0].UserColumnName.toString().Contains("Batch_")&&M[0].SysColumnName.toString().Contains("CCNID")?He+=M[0].SysColumnName.toString()+"="+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+", ":5==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType)&&0==H&&!M[0].UserColumnName.toString().Contains("TO")&&""!=e.DocDv[d][G.FieldName.toString()+"_Key"].toString()&&N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"])>0?fe+=e.BulkSave?M[0].SysColumnName.toString()+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':M[0].SysColumnName.toString()+"="+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+", ":5!=N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&""!=e.DocDv[d][G.FieldName.toString()+"_Key"].toString()&&N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"])>0&&(e.BulkSave?fe+=M[0].SysColumnName.toString()+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':fe.toString().Contains(M[0].SysColumnName.toString()+"=")||(fe+=M[0].SysColumnName.toString()+"="+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+", ")),"dcccnid2"==M[0].SysColumnName.toString().toLowerCase()?J=N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==M[0].SysColumnName.toString().toLowerCase()&&(Be=N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim())),40067==N.J0.Int(e.Feature.SelectedValue)&&e.fldDict["GROSS"+M[0].FieldName.toString().TrimEnd("*")].setFieldValue(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()));else if("CostCenterString"==M[0].ColumnDataType.toString()){if(5!=N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&""!=e.DocDv[d][G.FieldName.toString()+"_Key"].toString()&&N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"])>0){let P="dcCCNID"+(N.J0.Int(M[0].CostcenterID.toString())-5e4);fe.toString().Contains(P)||(fe+=e.BulkSave?P+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':P+"="+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+", "),"dcccnid2"==P.toLowerCase()?J=N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):"dcccnid1"==P.toLowerCase()&&(Be=N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()))}}else if("TEXT"==M[0].ColumnDataType.toString()||"String"==M[0].ColumnDataType.toString()||"COMBOBOX"==M[0].ColumnDataType.toString()){let P=0;if(P=N.J0.Int(M[0].ColumnCostCenterID.toString()),44==P)M[0].UserColumnName.toString().Contains("Batch_")&&M[0].SysColumnName.toString().Contains("Alpha")?ke+=X+"='"+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+"', ":me+=e.BulkSave?X+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':X+"=N'"+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+"', ";else if(P>0)me+=e.BulkSave?X+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+'" ':X+"=N'"+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+"', ";else if(M[0].UserColumnName.toString().Contains("Batch_")&&M[0].SysColumnName.toString().Contains("Alpha"))ke+=X+"='"+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+"', ";else if(M[0].UserColumnType.toString().toLowerCase().Contains("date")){let _;if(_=(0,ve._U)(e.DocDv[d][j].toString().Trim()),e.EDate)if("date"==M[0].UserColumnType.toString().toLowerCase()){if(me+=e.BulkSave?X+'="'+e.EDate.toLocaleDateString("dd/MMM/yyyy")+'" ':X+"=N'"+e.EDate.toLocaleDateString("dd/MMM/yyyy")+"', ",40067==N.J0.Int(e.Feature.SelectedValue)){let Y;e.fldDict["Date"+M[0].SysColumnName.toString().TrimEnd("*")].setFieldDetails(e.EDate.toLocaleDateString("dd/MMM/yyyy")[d][G.FieldName.toString()]),Y=e.GetDailyAttendanceDetails(0,N.J0.Int(e.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID4.getFieldResult()),_.Date,0,0,"",""),Y&&(me+=Y)}}else if("datetime"==M[0].UserColumnType.toString().toLowerCase())if(40067==N.J0.Int(e.Feature.SelectedValue)){let Y,re,ce;if(_=(0,ve._U)(e.fldDict.dcAlpha1.getFieldResult().toString()+" "+e.DocDv[d][j].toString().Trim()),me+=e.BulkSave?X+'="'+e.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+_.TimeOfDay.toString()+'" ':X+"=N'"+e.EDate.toLocaleDateString("dd/MMM/yyyy")+" "+_.TimeOfDay.toString()+"', ",e.fldDict["Date"+M[0].SysColumnName.toString().TrimEnd("*")].setFieldDetails(e.EDate.toLocaleDateString("dd/MMM/yyyy")[d][G.FieldName.toString()]),Y=e.GetDailyAttendanceDetails(2,N.J0.Int(e.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID4.getFieldResult()),_.Date,0,0,e.fldDict.dcAlpha2.getFieldResult().toString(),e.fldDict.dcAlpha3.getFieldResult().toString()),""!=Y.toString()){se+=Y;let Ce=e.GetDailyAttendanceDetails(1,N.J0.Int(e.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID4.getFieldResult()),(0,ve._U)(e.fldDict.dcAlpha1.getFieldResult()),re,ce,"","");null!=Ce&&(se+=Ce),v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="1" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1"')}}else me+=e.BulkSave?X+'="'+e.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")+'" ':X+"=N'"+e.EDate.toLocaleDateString("dd/MMM/yyyy hh:mm:ss tt")+"', "}else if("attachment"==M[0].UserColumnType.toString().toLowerCase())try{_e=e.DocDv[d][j].toString().Trim()}catch{Q=""}else if(40068==N.J0.Int(e.Feature.SelectedValue)&&(U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()).Trim().toLowerCase().Contains("earning")||U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()).Trim().toLowerCase().Contains("deduction")))U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()).Trim().toLowerCase().Contains("earning")?me+=e.BulkSave?X+'="2" ':X+"=N'2', ":U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()).Trim().toLowerCase().Contains("deduction")&&(me+=e.BulkSave?X+'="3" ':X+"=N'3', "),v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="1" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ');else{let _=e.DocDv[d][j].toString().Trim();if(_.Contains("\n")){let Y=N.J0.Int(b.d.SessionManager.Preferences.CtrlTFontSize),re=_.split("\n");if(null!=re&&re.length>0){let ce='"',Ce="<FlowDocument FontFamily="+ce+b.d.SessionManager.Preferences.CtrlTFontName+ce+" FontSize="+ce+Y+ce+" xmlns="+ce+"http://schemas.microsoft.com/winfx/2006/xaml/presentation"+ce+">";for(let Ue=0;Ue<re.length;Ue++)Ce+="<Paragraph>"+U.Dw.GetValidTextXml(re[Ue])+"</Paragraph>";Ce+="</FlowDocument>",me+=e.BulkSave?X+'="'+U.Dw.GetValidXml(Ce)+'" ':X+"=N'"+U.Dw.GetValidXml(Ce)+"', "}}else e.BulkSave?me+=X+'="'+U.Dw.GetValidTextXml(e.DocDv[d][j].toString().Trim())+'" ':(me+=X+"=N'"+U.Dw.GetValidTextXml(e.DocDv[d][j].toString().Trim())+"', ",e.IsInventory&&5==e.ProductTypeID&&!N.J0.StringIsNullOrEmpty(e.BatchBasedon)&&X.toLowerCase()==e.BatchBasedon.toLowerCase()&&"1"==e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&(e.IgnoreBatch=1))}}else if(null!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&""!=e.DocDv[d][j].toString().Trim())if("ProductString"==M[0].ColumnDataType.toString())e.DocDv.includes("TempProductName")&&""!=e.DocDv[d].TempProductName.toString().Trim()?v+='ProductID="'+U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim())+'" ':e.ExcelDataColumn.includes("TempProductCode")&&(v+=' IsProductCode="1" ProductID="'+U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim())+'" ');else if(null!=M[0].IsCalculate&&""!=M[0].IsCalculate.toString()&&"0"==M[0].IsCalculate.toString()&&""!=M[0].Formula.toString()){se+=e.BulkSave?M[0].SysColumnName.toString()+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ':M[0].SysColumnName.toString()+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())+", ";let P="";try{let _=e.fldDict;oe=b.d.eval.EvaluateExpression(M[0].Formula.toString(),_).toString(),e.BulkSave?(se+="dcCalc"+M[0].SysColumnName.toString().replace("dc","")+'="'+oe+'" ',se+="dcCalcNumFC"+M[0].SysColumnName.toString().replace("dcNum","")+'="'+oe+'" '):(se+="dcCalc"+M[0].SysColumnName.toString().replace("dc","")+"="+oe+", ",se+="dcCalcNumFC"+M[0].SysColumnName.toString().replace("dcNum","")+"="+oe+", "),e.fldDict["Calc"+M[0].ResourceData.toString().TrimEnd("*")].setFieldDetails(oe)}catch(_){return e.DisplayMessage="Error during calculating formula  "+M[0].Formula.toString()+" , Message :"+_.Message,void(e.MessageVisibility=!0)}for(const[_,Y]of Object.entries(e.fldDict))P=P+"\n "+_+"=:"+Y.toString()}else if("CostCenterString"!=M[0].ColumnDataType.toString())if(40067==N.J0.Int(e.Feature.SelectedValue)&&"36560"==String(G.FeatureFieldName)){let P="";if(""!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString())P=e.DocDv[d][j].toString().Trim(),se+=e.BulkSave?M[0].SysColumnName.toString()+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ':M[0].SysColumnName.toString()+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())+", ",e.fldDict["Calc"+M[0].ResourceData.toString().TrimEnd("*")].setFieldDetails(e.DocDv[d][j].toString().Trim()),se+=e.BulkSave?"dcCalc"+M[0].SysColumnName.toString().replace("dc","")+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ':"dcCalc"+M[0].SysColumnName.toString().replace("dc","")+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())+", ";else{let Y;Y=e.fldDict.dcAlpha3.getFieldResult()-e.fldDict.dcAlpha2.getFieldResult(),P=Y.Hours+"."+Y.Minutes,se+=e.BulkSave?M[0].SysColumnName.toString()+'="'+N.J0.Int(P)+'" ':M[0].SysColumnName.toString()+"="+N.J0.Int(P)+", ",e.fldDict["Calc"+M[0].ResourceData.toString().TrimEnd("*")].setFieldDetails(P.toString()),se+=e.BulkSave?"dcCalc"+M[0].SysColumnName.toString().replace("dc","")+'="'+N.J0.Int(P)+'" ':"dcCalc"+M[0].SysColumnName.toString().replace("dc","")+"="+N.J0.Int(P)+", "}let _=e.GetDailyAttendanceDetails(1,N.J0.Int(e.fldDict.dcCCNID51.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID2.getFieldResult()),N.J0.Int(e.fldDict.dcCCNID4.getFieldResult()),(0,ve._U)(e.fldDict.dcAlpha1.getFieldResult()),e.intValidDay,N.J0.Int(P),"","");""!=String(_)&&(se+=_),v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="1" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="1"  Rate="0"  Gross="0" UOMConversion="1" ')}else e.BulkSave?(se+=M[0].SysColumnName.toString()+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ',e.fldDict["Calc"+M[0].ResourceData.toString().TrimEnd("*")].setFieldDetails(e.DocDv[d][j].toString().Trim()),se+="dcCalcNum"+M[0].SysColumnName.toString().replace("dcNum","")+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ',b.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,K.yG0)(b.d.SessionManager.Preferences["Use Foreign Currency"])&&(se+="dcCalcNumFC"+M[0].SysColumnName.toString().replace("dcNum","")+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())*Pe+'" ',se+="dcCurrID"+M[0].SysColumnName.toString().replace("dcNum","")+'="'+we+'" ',se+="dcExchRT"+M[0].SysColumnName.toString().replace("dcNum","")+'="'+Pe+'" ')):(se+=M[0].SysColumnName.toString()+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())+", ",e.fldDict["Calc"+M[0].ResourceData.toString().TrimEnd("*")].setFieldDetails(e.DocDv[d][j].toString().Trim()),se+="dcCalcNum"+M[0].SysColumnName.toString().replace("dcNum","")+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())+", ",b.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,K.yG0)(b.d.SessionManager.Preferences["Use Foreign Currency"])&&(se+="dcCalcNumFC"+M[0].SysColumnName.toString().replace("dcNum","")+"="+N.J0.Int(e.DocDv[d][j].toString().Trim())*Pe+", ",se+="dcCurrID"+M[0].SysColumnName.toString().replace("dcNum","")+"="+we+", ",se+="dcExchRT"+M[0].SysColumnName.toString().replace("dcNum","")+"="+Pe+", "))}else if("DATE"==M[0].ColumnDataType.toString())W=(0,ve._U)(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()),W&&(M[0].UserColumnName.toString().Contains("Batch_")&&!M[0].SysColumnName.toString().Contains("alpha")&&(Me+=X+"='"+W.toLocaleDateString("dd/MMM/yyyy")+"', "),""!=e.DocDv[d][j].toString().Trim()&&(v+=M[0].SysColumnName.toString()+'="'+W.toLocaleDateString("dd/MMM/yyyy")+'" '));else if("quantity"!=X.toLowerCase()&&"FreeQTY"!=X||v.toString().Contains("Quantity="))if("AVGRATE"!=M[0].SysColumnName.toString()&&"AVGRATEVALUE"!=M[0].SysColumnName.toString()||"FLOAT"!=M[0].ColumnDataType.toString()||null==e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()||""==e.DocDv[d][j].toString().Trim())if((M[0].SysColumnName.toString().endsWith("Rate")||M[0].SysColumnName.toString().endsWith("ExchRT"))&&M[0].UserColumnName.toString().Contains("Batch_")){let P=0;P=parseFloat(e.DocDv[d][j].toString().Trim()),P>0&&(Me+=M[0].SysColumnName.toString()+"='"+P+"', ")}else if("Amount"!=M[0].SysColumnName.toString()&&"FLOAT"==M[0].ColumnDataType.toString()&&null!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&""!=e.DocDv[d][j].toString().Trim()&&"ExchangeRate"!=M[0].SysColumnName.toString())v+=M[0].SysColumnName.toString()+'="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ';else if("ProductString"==M[0].ColumnDataType.toString())e.DocDv.includes("TempProductName")&&""!=e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim()?v+='ProductID="'+U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim())+'" ':e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim()&&(v+=' IsProductCode="1" ProductID="'+U.Dw.GetValidXml(e.DocDv[d][e.ExcelDataColumn.indexOf("TempProductName")].toString().Trim())+'" '),v+=' IsProductBarcode="1" ';else if("ProductID"==M[0].SysColumnName.toString())if(z=!0,e.BulkSave)v+=M[0].SysColumnName.toString()+'="'+e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName.toString()+"_Key")].toString()+'" ';else if(e.ProfileID>-20&&e.ProfileID<0&&e.ExcelDataColumn.includes("TMOCODE_Key"))v+=' IsProductBarcode="0" ',v+=' IsProductCode="2" ',v+=' ProductID="'+e.DocDv[d][e.ExcelDataColumn.indexOf("TMOCODE_Key")].toString().Trim()+'" ';else if(e.IsProductwiseBarcode){let P=!1;Object.keys(M[0]).toString().toLowerCase().includes("parentccdefaultcolid")&&"261"==M[0].ParentCCDefaultColID.toString()&&(v+=' IsProductCode="1" ',P=!0),e.ReadBarcode(P,e.DocDv[d],e.DocDv[d][j].toString().Trim(),G.FieldName.toString()),v+=M[0].SysColumnName.toString()+'="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" ',v+=' IsProductBarcode="1" '}else v+=' IsProductBarcode="0" ',Object.keys(M[0]).toString().toLowerCase().includes("parentccdefaultcolid")&&"261"==M[0].ParentCCDefaultColID.toString()&&(v+=' IsProductCode="1" '),v+=M[0].SysColumnName.toString()+'="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" ';else if("CurrencyID"==M[0].SysColumnName.toString())we=N.J0.Int(e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim());else if("ExchangeRate"==M[0].SysColumnName.toString())Pe=N.J0.Int(e.DocDv[d][j].toString().Trim());else if(M[0].SysColumnName.toString().endsWith("CurrID")&&M[0].UserColumnName.toString().Contains("Batch_")){let P=e.CostCenterFieldsAllTables.Tables[6];P.RowFilter="IsBaseCurrency='True'",P.length>0&&(Me+=M[0].SysColumnName.toString()+"='"+e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()+"', ")}else if("ExchangeRate"==M[0].SysColumnName.toString())Gt&&(Pe=N.J0.Int(e.DocDv[d][j].toString().Trim()));else if("DebitAccount"==M[0].SysColumnName.toString())e.BulkSave?(e.CheckBulkCostCenterField(d,2,M[0].SysColumnName.toString(),!1,!0),v+=M[0].SysColumnName.toString()+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString()+'" ',Oe=e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):(Oe=e.DocDv[d][j].toString().Trim(),e.IsInventory&&(v+=M[0].SysColumnName.toString()+'="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" '));else if("DebitAccountCode"==M[0].SysColumnName.toString())e.BulkSave?(e.CheckBulkCostCenterField(d,2,M[0].SysColumnName.toString(),!1,!0),v+=' DebitAccount="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString()+'" ',Oe=e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):(Oe=e.DocDv[d][j].toString().Trim(),Ye=!0,e.IsInventory&&(v+=' DebitAccount="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" ',Ye&&(v+=' DrAccCode="1" ')));else if("CreditAccount"==M[0].SysColumnName.toString())e.BulkSave?(e.CheckBulkCostCenterField(d,2,M[0].SysColumnName.toString(),!1,!0),v+=M[0].SysColumnName.toString()+'="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString()+'" ',We=e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):(We=e.DocDv[d][j].toString().Trim(),e.IsInventory&&(v+=M[0].SysColumnName.toString()+'="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" '));else if("CreditAccountCode"==M[0].SysColumnName.toString())e.BulkSave?(e.CheckBulkCostCenterField(d,2,M[0].SysColumnName.toString(),!1,!0),v+=' CreditAccount="'+e.DocDv[d][G.FieldName.toString()+"_Key"].toString()+'" ',We=e.DocDv[d][G.FieldName.toString()+"_Key"].toString().Trim()):(We=e.DocDv[d][j].toString().Trim(),mt=!0,e.IsInventory&&(v+=' CreditAccount="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" ',mt&&(v+=' CrAccCode="1" ')));else if("Unit"==M[0].SysColumnName.toString()){if(Ot=e.DocDv[d][j].toString().Trim(),kt=!0,e.IsInventory)if(e.ExcelTable.includes(G.FieldName+"_Key")){let P;if(v+=' Unit="'+e.DocDv[d][G.FieldName+"_Key"].toString().Trim()+'" ',P=e.ExcelTable.includes(e.ProductFieldName+"_Key")&&N.J0.StringIsNullOrEmpty(e.DocDv[d][e.ProductFieldName+"_Key"].toString())?b.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(e.DocDv[d][G.FieldName+"_Key"])+" WHERE P.ProductID = 1"):b.d.document.GetDataSet("SELECT C.Conversion Conversion FROM INV_Product P WITH(NOLOCK) LEFT JOIN COM_UOM C WITH(NOLOCK) on C.UOMID="+N.J0.Int(e.DocDv[d][G.FieldName+"_Key"])+" WHERE P.ProductID = "+N.J0.Int(e.DocDv[d][e.ProductFieldName+"_Key"])),null!=P&&P.Tables.length>0&&P.Tables[0].Rows.length>0)if(P.Tables[0].includes("Conversion")&&""!=P.Tables[0][0].Conversion.toString()){let _=1;_=parseFloat(P.Tables[0][0].Conversion.toString()),v+=' UOMConversion="'+_.toString()+'" ',v+=' UOMConvertedQty="'+N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(e.QtyField)].ToString().trim())*_+'" '}else v+=' UOMConversion="1" ',v+=' UOMConvertedQty="'+N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(e.QtyField)].ToString().trim())+'" ';else v+=' UOMConversion="1" ',v+=' UOMConvertedQty="'+N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(e.QtyField)].ToString().trim())+'" '}else kt&&(v+=' Unit="1" ',v+=' UOMConversion="1" ',v+=' UOMConvertedQty="'+N.J0.Int(e.DocDv[d][e.ExcelDataColumn.indexOf(e.QtyField)].ToString().trim())+'" ')}else if("Amount"!=M[0].SysColumnName.toString()||e.IsInventory)""!=M[0].SysColumnName.toString()&&(v+=M[0].SysColumnName.toString()+'="'+U.Dw.GetValidXml(e.DocDv[d][j].toString().Trim())+'" ');else{let P="",_="";""!=Oe?P=Oe:""!=L&&(P=e.DocDv[d][L].toString().Trim(),Ye=e.IsDrFieldCode),""!=We?_=We:""!=V&&(_=e.DocDv[d][V].toString().Trim(),mt=e.IsCrFieldCode),et=N.J0.Int(e.DocDv[d][j].toString().Trim()),""!=O&&""!=e.DocDv[d][O+"_Key"].toString()&&(we=N.J0.Int(e.DocDv[d][O+"_Key"].toString())),""!=x&&""!=e.DocDv[d][x].toString()&&(Pe=N.J0.Int(e.DocDv[d][x].toString())),v+=e.getAccountTransaction(P,_,Ye,mt,et.toString(),we,Pe)}else"AVGRATE"==M[0].SysColumnName.toString()?(v+='Rate="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ',v+='AverageRate="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" '):v+='Gross="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ';else""!=E&&e.ExcelDataColumn.includes(E)&&""!=e.DocDv[d][e.ExcelDataColumn.indexOf(E)].toString()&&parseFloat(e.DocDv[d][e.ExcelDataColumn.indexOf(E)].toString())&&N.J0.Int(parseFloat(e.DocDv[d][e.ExcelDataColumn.indexOf(E)].toString()))>0?(v+=' Quantity="'+N.J0.Int(parseFloat(e.DocDv[d][e.ExcelDataColumn.indexOf(E)].toString().Trim()))+'" ',v+=' IsQtyFreeOffer="1" '):"quantity"==X.toLowerCase()&&(v+=' Quantity="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" ',""==e.UnitFieldName.Trim()&&(v+=' UOMConversion="1" ',v+=' UOMConvertedQty="'+N.J0.Int(e.DocDv[d][j].toString().Trim())+'" '));if(null!=M[0].PostingType&&""!=M[0].PostingType.toString()&&e.IsInventory){if(""==oe&&(oe=e.DocDv[d][j].toString().Trim()),be=parseFloat(oe),!c&&(3==N.J0.Int(M[0].PostingType.toString())||4==N.J0.Int(M[0].PostingType.toString()))&&""!=oe&&be&&0!=N.J0.Int(oe)){let P="";P+="<Accounts ",e.BulkSave&&(P+='DocSeqNo="'+(d+1).toString()+'" ');let _="",Y="";var u;""!=M[0].DrRefColID.toString()&&N.J0.Int(M[0].DrRefColID.toString())>0?(u=e.grData.Table.filter(re=>re.FeatureFieldName==M[0].DrRefID.toString())).length>0?_=e.ExcelTable.includes(u[0].FieldName.toString()+"_Key")&&""!=e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString()?e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString():e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].DrRefID.toString()),N.J0.Int(M[0].DrRefColID.toString()),0,e.DocDv[d][u[0].FieldName.toString()]).toString():(u=e.costCenterTableZero.filter(re=>re.CostcenterColID===M[0].DrRefID.toString())).length>0&&("2"==u[0].Columncostcenterid.toString()?(e.costCenterTableZero.filter(re=>re.SysColumnName===u[0].SysColumnName.toString()+"Code"),u=e.costCenterTableZero.filter(re=>re.SysColumnName===u[0].SysColumnName.toString()+"Code")):u=e.costCenterTableZero.filter(re=>re.SysColumnName===u[0].SysColumnName.toString()+"' AND CostcenterColID<>"+u[0].CostcenterColID.toString()),u.length>0&&(u=e.grData.Table.filter(re=>re.FeatureFieldName==u[0].CostcenterColID.toString())).length>0&&(_=e.ExcelTable.includes(u[0].FieldName.toString()+"_Key")&&""!=e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString()?e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].DrRefID.toString()),N.J0.Int(M[0].DrRefColID.toString()),N.J0.Int(e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString())).toString():e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].DrRefID.toString()),N.J0.Int(M[0].DrRefColID.toString()),0,e.DocDv[d][u[0].FieldName.toString()],!0).toString())):null!=M[0].DebitAccount&&""!=M[0].DebitAccount.toString()&&N.J0.Int(M[0].DebitAccount.toString())>0?_=M[0].DebitAccount.toString():""!=Oe?_=Oe:""!=L&&(e.BulkSave?(e.CheckBulkCostCenterField(d,2,L,!1,!0),_=e.DocDv[d][L+"_Key"].toString().Trim()):_=e.DocDv[d][L].toString().Trim()),""!=M[0].CrRefColID.toString()&&N.J0.Int(M[0].CrRefColID.toString())>0?(u=e.grData.Table.filter(ce=>ce.FeatureFieldName==u[0].CrRefID.toString())).length>0?Y=e.ExcelTable.includes(u[0].FieldName.toString()+"_Key")&&""!=e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString()?e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString():e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].CrRefID.toString()),N.J0.Int(M[0].CrRefColID.toString()),0,e.DocDv[d][u[0].FieldName.toString()]).toString():(u=e.costCenterTableZero.filter(ce=>ce.CostcenterColID===u[0].CrRefID.toString())).length>0&&(u="2"==u[0].Columncostcenterid.toString()?e.costCenterTableZero.filter(ce=>ce.SysColumnName===u[0].SysColumnName.toString()+"Code"):e.costCenterTableZero.filter(ce=>ce.SysColumnName===u[0].SysColumnName.toString()+"' AND CostcenterColID<>"+u[0].CostcenterColID.toString())).length>0&&(u=e.grData.Table.filter(ce=>ce.FeatureFieldName==u[0].CostcenterColID.toString())).length>0&&(Y=e.ExcelTable.includes(u[0].FieldName.toString()+"_Key")&&""!=e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString()?e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].CrRefID.toString()),N.J0.Int(M[0].CrRefColID.toString()),N.J0.Int(e.DocDv[d][u[0].FieldName.toString()+"_Key"].toString())).toString():e.ScreenObject.GetAccountByRef(N.J0.Int(M[0].CrRefID.toString()),N.J0.Int(M[0].CrRefColID.toString()),0,e.DocDv[d][u[0].FieldName.toString()],!0).toString()):null!=M[0].CreditAccount&&""!=M[0].CreditAccount.toString()&&N.J0.Int(M[0].CreditAccount.toString())>0?Y=M[0].CreditAccount.toString():""!=We?Y=We:""!=V&&(e.BulkSave?(e.CheckBulkCostCenterField(d,2,V,!1,!0),Y=e.DocDv[d][V+"_Key"].toString().Trim()):Y=e.DocDv[d][V].toString().Trim()),P+=e.getAccountTransaction(_.toString(),Y.toString(),!1,!1,oe,we,Pe),P+=" ></Accounts>",Te+=P.toString(),e.FillBillWiseDt(st,Y.toString(),oe,!0),e.FillBillWiseDt(st,_.toString(),oe,!1)}(2==N.J0.Int(M[0].PostingType.toString())||4==N.J0.Int(M[0].PostingType.toString()))&&""!=oe&&be&&0!=N.J0.Int(oe)&&(ct+=N.J0.Int(oe))}38==e._DocumentType&&("5"==M[0].SectionID.toString()||"6"==M[0].SectionID.toString()||"7"==M[0].SectionID.toString()||"8"==M[0].SectionID.toString()||"9"==M[0].SectionID.toString()||"10"==M[0].SectionID.toString()||"11"==M[0].SectionID.toString()||"12"==M[0].SectionID.toString()||"13"==M[0].SectionID.toString())&&""!=e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()&&(e.PosPayModesXML.Append('<XML Amount="').Append(e.DocDv[d][e.ExcelDataColumn.indexOf(G.FieldName)].toString()).Append('" '),e.PosPayModesXML.Append(' AvailAmount="').Append("").Append('" '),e.PosPayModesXML.Append(' DBColumnName="').Append(X).Append('" '),e.PosPayModesXML.Append(' Type="').Append(M[0].SectionID.toString()).Append('" '),e.PosPayModesXML.Append(' DocDate="').Append((0,ve._U)(e.DocDv[d][F].toString())).Append('" '),e.PosPayModesXML.Append(' RegisterID="').Append(e.DocDv[d][e.PosRegisterField+"_Key"].toString()).Append('" '),e.PosPayModesXML.Append(' ShiftID="').Append(e.DocDv[d][e.PosShiftField+"_Key"].toString()).Append('" '),e.PosPayModesXML.Append(" />"))}}e.IsInventory&&(v+=e.DonotUpdateInventory?'IsQtyIgnored="1" ':'IsQtyIgnored="0" ',v+='StockValue="'+(ct*Pe).toString()+'" ',v+='StockValueFC="'+ct.toString()+'" ',v+='CurrencyID="'+we.toString()+'" ',v+='ExchangeRate="'+Pe.toString()+'" ',z||(B.filter(G=>"Productid"==G.SysColumnName),e.ProductID=N.J0.Int(B[0].UserDefaultValue.toString()),B.length>0&&""!=B[0].UserDefaultValue.toString()&&e.ProductID&&e.ProductID>0&&(v+=' ProductID="'+e.ProductID.toString()+'" IsProductCode="2" '))),(3==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())||8==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())||13==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString()))&&(3==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())||13==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())||8==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString()))&&(v.toString().Contains("DebitAccount=")||(v+='DebitAccount="PactReservedAccount" '),v.toString().Contains("CreditAccount=")||(v+=' CreditAccount="PactReservedAccount" ')),40062==N.J0.Int(e.Feature.SelectedValue)&&(v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="-62" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="-62"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||(v+=' LineNarration="" '),v.toString().Contains("CommonNarration=")||(v+=' CommonNarration="" '),v+=' RefNO="" '),40051==N.J0.Int(e.Feature.SelectedValue)&&(v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="0" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||(v+=' LineNarration="" '),v.toString().Contains("CommonNarration=")||(v+=' CommonNarration="" '),v+=' RefNO="" '),40069==N.J0.Int(e.Feature.SelectedValue)&&(v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="0" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||(v+=' LineNarration="" '),v.toString().Contains("CommonNarration=")||(v+=' CommonNarration="" '),v+=' RefNO="" '),40089==N.J0.Int(e.Feature.SelectedValue)&&(v+='LinkedInvDocDetailsID= "0"  LinkedFieldName= "" Unit="1" ',!e.ExcelTable.includes("QuantityValue")&&e.ExcelTable.includes("RateValue")?v+=' Quantity="0" UOMConversion="1"  Gross="0" ':e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")?v+=' Rate="0"  Gross="0" ':!e.ExcelTable.includes("QuantityValue")&&!e.ExcelTable.includes("RateValue")&&(v+=' Quantity="0"  Rate="0"  Gross="0" UOMConversion="1"'),v.toString().Contains("LineNarration=")||(v+=' LineNarration="" '),v.toString().Contains("CommonNarration=")||(v+=' CommonNarration="" '),v+=' RefNO="" '),5==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&1==H?(fe+=e.BulkSave?he+" ></CostCenters>":he+'" ></CostCenters>',v+=' VoucherType="1" '):(fe+=e.BulkSave?" ></CostCenters>":'" ></CostCenters>',5==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&(v+=' VoucherType="-1" ')),!e.IsInventory&&!N.J0.StringIsNullOrEmpty(ot)&&(v+=' BillWiseDocNo="'+ot+'" '),v+=" ></Transactions>",e.BulkSave?(se+=" ></Numeric>",me+=" ></Alpha>"):(se+='" ></Numeric>',me+='" ></Alpha>',Te+="</AccountsXML>"),(o&&-1==e.VoucherType&&!m||1==e.VoucherType&&e.ProfileID>-20&&e.ProfileID<0)&&""!=e.DocDv[d].BATCHNUMBER_Sys.toString()&&""!=e.DocDv[d][e.QtyField].toString()&&N.J0.Int(e.DocDv[d][e.QtyField].toString())>0&&(Ne+='  ProductID="'+e.ProductID+'" Batchno="'+e.DocDv[d].BATCHNUMBER_Sys.toString()+'" BatchID="'+e.DocDv[d].BatchID.toString()+'" Quantity="'+e.DocDv[d][e.QtyField].toString()+'" '),Ne.length>0&&(Ne.Insert(0,"<xml><Row  "),Ne+=1==e.VoucherType?'  StaticFieldsQuery="'+Me+'"   TextFields="'+ke+'"   CCFields="'+He+'" ></Row></xml> ':" ></Row></xml> "),e.BulkSave||(Te+=v.toString()+se.toString()+me.toString()+fe.toString()+"<EXTRAXML>"+Ne+pe+"</EXTRAXML>",Te+="</Row>"),H++}while(5==N.J0.Int(e.CostCenterFieldsAllTables.Tables[2][0].DocumentType.toString())&&1==H);Ne=" ",pe=" "}if(e.IsInventory||(Te+="</DocumentXML>"),Xe+="</AttachmentsXML>",e.IsInventory&&e.FillLocRefVisibility&&e.FillLocalReference&&e.DocItems.Items.length>0&&5==e.ProductTypeID&&!N.J0.StringIsNullOrEmpty(e.BatchBasedon)){let H="",X="",z=null;for(let G=0;G<e.DocItems.Items.length;G++)if(e.DocItems.Items[G].IsChecked){let j=e.costCenterTableZero.filter(M=>M.CostcenterColID===e.DocItems.Items[G].Value),ue=e.grData.Table.filter(M=>M.CostcenterColID===e.DocItems.Items[G].Value);if(ue.length>0&&(X=e.IsCode?2==N.J0.Int(j[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(j[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(j[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(j[0].ColumnCostCenterID)?"ProductName":"Name",H="SELECT "+j[0].ParentCostCenterColSysName+" ID FROM "+j[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+X+"='"+e.DocDv[d-1][ue[0].FieldName.toString()]+"'",z=b.d.document.GetDataSet(H),null!=z&&z.length>0)){H="";let M=[];M.push(e.DocItems.Items[G].Value),M.push(e.Feature.SelectedValue),M.push(z[0].ID.toString()),M.push(new Date("dd/MMM/yyyy")),M.push(0),M.push("<XML></XML>"),M.push(0),M.push(b.d.SessionManager.LanguageID);let oe=b.d.document.GetReferenceData(JSON.stringify(M));if(null!=oe&&oe.Tables[0].Rows.length>0)for(let be=0;be<oe.Tables[0].Columns.length;be++)oe.Tables[0].Columns[be].ColumnName.toString().toLowerCase()==e.BatchBasedon.toLowerCase()&&"1"==oe.Tables[0][0][oe.Tables[0].Columns[be].ColumnName.toString()]&&(e.IgnoreBatch=1)}}}if(""!=Te.toString()){if(e.BulkSave){v.Insert(0,"<DocXML>"),se.Insert(0,"<NumXML>"),me.Insert(0,"<TextXML>"),fe.Insert(0,"<CCXML>"),Te.Insert(0,"<AccXML>"),Qe.Insert(0,"<EXTRAXML>"),lt.Insert(0,"<DocExtraXML>"),v+="</DocXML>",se+="</NumXML>",me+="</TextXML>",fe+="</CCXML>",Te+="</AccXML>",Qe+="</EXTRAXML>",lt+="</DocExtraXML>";let z=[];z.push(Te.toString()),z.push(v.toString()),z.push(se.toString()),z.push(me.toString()),z.push(fe.toString()),z.push(Qe.toString()),z.push(lt.toString()),Logger.DebugLog("BulkImportUtility-Rows "+Te.toString()),Logger.DebugLog("BulkImportUtility-Static "+v.toString()),Logger.DebugLog("BulkImportUtility-Numeric "+se.toString()),Logger.DebugLog("BulkImportUtility-Text "+me.toString()),Logger.DebugLog("BulkImportUtility-CC "+fe.toString())}$e!=A&&(e.PrevDocID=0);let H=0;e.strSerial.length>0&&(H=e.strSerial.length),e.strSerial.length>0&&e.strSerial.length!=H&&(e.DocDv[d-Ie].xIMP_STATUSx="FAIL",e.DocDv[d-Ie].IMPORT_MESSAGE="Duplicate Serial Number at RowNo :: "+(d-Ie),de++,e.FailedRecourdList.push({Name:je+"-"+R,Message:e.ErrorMessage}),e.strSerial=[]);let X=yield e.SaveDocument(ie,je,R.toString(),Tt,ft,ut,e.IsInventory,Te.toString(),Xe.toString(),st,ot,Be,J,e.fldDict,we,Pe,e.argParam);if(ie=X?.docId,e.ErrorMessage=X?.errorMessage,ie<1){if(e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("xIMP_STATUSx")]="FAIL",e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("IMPORT_MESSAGE")]=e.ErrorMessage,e.ExcelDataColumn.includes("RevenUStatus")&&(e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("RevenUStatus")]="Failed",e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("RevenUReason")]=e.ErrorMessage),de++,!(e.ProfileID>-20&&e.ProfileID<0)){let z,G;for(let j=0;j<e.grData.Table.length;j++)if(z=e.DocDv.filter(""!=D?ue=>ue[e.ExcelDataColumn.indexOf(D)]==R:ue=>ue[e.ExcelDataColumn.indexOf(p)]==R),e.ExcelDataColumn.includes(e.grData.Table[j].FieldName.toString()+"_Key")&&z.length>0)for(let ue=0;ue<e.DocDv.length;ue++)""==e.DocDv[ue][e.grData.Table[j].FieldName.toString()+"_Key"].toString()&&e.FailedRecourdList.push({Name:je+"-"+R,Message:"Invalid "+e.grData.Table[j][0].toString()+" at Row No:"+(ue+1)});G=e.ExcelDataColumn.includes("IMPORT_STATUS")?e.DocDv.filter(j=>null==j[e.ExcelDataColumn.indexOf("IMPORT_STATUS")]||"PASS"==j[e.ExcelDataColumn.indexOf("IMPORT_STATUS")]):""}e.FailedRecourdList.push({Name:je+"-"+R,Message:e.ErrorMessage}),e.strSerial=[]}else e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("xIMP_STATUSx")]="PASS",e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("IMPORT_MESSAGE")]="",e.ExcelDataColumn.includes("RevenUStatus")&&(e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("RevenUStatus")]="pass",e.DocDv[d-Ie][e.ExcelDataColumn.indexOf("RevenUReason")]=e.ErrorMessage),I++,e.strSerial=[];if(e.IgnoreBatch=0,null!=e.ErrorMessage&&e.ErrorMessage.includes("Saved")&&e.FillLocRefVisibility&&e.FillLocalReference&&e.DocItems.Items.length>0){let z="",G="",j="",M=null;e.ScreenObject.CostCenterID=N.J0.Int(e.Feature.SelectedValue);const oe=e.ScreenObject.GetProductTypeDetails(e.DocDv[d-1][e.ProductFieldName+"_Key"].toString(),(0,ve._U)(e.DocDv[d-1][F].toString()),1,N.J0.Int(e.DocDv[d-1][e.QtyField]),"0",null,!1,"",!0,0,null);null!=oe&&oe.Tables.length>4&&oe.Tables[4].Rows.length>0&&oe.Tables[4].Columns[0].ColumnName.Contains("SysColumnName")&&(z='"UPDATE TXT SET " + dsPrd.Tables[4].Rows[0]["SysColumnName"].toString() + "=" + dsPrd.Tables[4].Rows[0]["Value"].toString() + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNUMData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',b.d.document.GetDataSet(z));for(let be=0;be<e.DocItems.Items.length;be++)if(e.DocItems.Items[be].IsChecked){let P=e.costCenterTableZero.filter(Y=>Y.CostcenterColID===e.DocItems.Items[be].Value),_=e.grData.Table.filter(Y=>Y.FeatureFieldName===e.DocItems.Items[be].Value);if(_.length>0&&(j=e.IsCode?2==N.J0.Int(P[0].ColumnCostCenterID)?"AccountCode":3==N.J0.Int(P[0].ColumnCostCenterID)?"ProductCode":"Code":2==N.J0.Int(P[0].ColumnCostCenterID)?"AccountName":3==N.J0.Int(P[0].ColumnCostCenterID)?"ProductName":"Name",z="SELECT "+P[0].ParentCostCenterColSysName+" ID FROM "+P[0].ParentCostCenterSysName+" WITH(NOLOCK) WHERE "+j+"='"+e.DocDv[d-1][_[0].FieldName.toString()]+"'",M=b.d.document.GetDataSet(z),null!=M&&M.length>0)){z="";let Y=[];Y.push(e.DocItems.Items[be].Value),Y.push(e.Feature.SelectedValue),Y.push(M[0].ID.toString()),Y.push(new Date("dd/MMM/yyyy")),Y.push(0),Y.push("<XML></XML>"),Y.push(0),Y.push(b.d.SessionManager.LanguageID);const re=b.d.document.GetReferenceData(JSON.stringify(Y));if(null!=re&&re.Tables[0].Rows.length>0)for(let ce=0;ce<re.Tables[0].length;ce++)G=re.Tables[0].Columns[ce].ColumnName.toString(),G.Contains("dcAlpha")&&!G.endsWith("Name")?(z='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=\'" + dsLRef.Tables[0][0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',b.d.document.GetDataSet(z)):G.Contains("dcAlpha")&&G.endsWith("Name")?(z='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString().replace("Name", "") + "=\'" + dsLRef.Tables[0][0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + "\' FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                         JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                         WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',b.d.document.GetDataSet(z)):G.Contains("dcNum")||G.Contains("dcCalcNum")?(z='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0][0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocNumData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',b.d.document.GetDataSet(z)):G.Contains("dcCCNID")&&!G.Contains("Group")&&!G.Contains("Name")&&!G.Contains("Code")&&!G.Contains("lft")&&!G.Contains("rgt")&&(z='"UPDATE TXT SET " + dsLRef.Tables[0].Columns[n].ColumnName.toString() + "=" + dsLRef.Tables[0][0][dsLRef.Tables[0].Columns[n].ColumnName.toString()] + " FROM " + strVType + @"_DocDetails I WITH(NOLOCK) \n                                                          JOIN COM_DocCCData TXT WITH(NOLOCK) ON TXT." + strVType + @"DocDetailsID = I." + strVType + @"DocDetailsID\n                                                          WHERE I.VoucherNo = \'" + ErrorMessage.Substring(12, ErrorMessage.IndexOf("[") - 13) ',b.d.document.GetDataSet(z))}}}}if(e.ListVisbility=e.FailedRecourdList.length>0,e.ImportedCount=e.IsSaveDocValidate?"Valid :"+I.toString():"Imported :"+I.toString(),e.FailedCount="Failed :"+de.toString(),e.RefreshGrid=!e.RefreshGrid,e.grData.RefreshGrid=!0,e.MessageVisibility=!0,e.DisplayMessage=e.IsSaveDocValidate?"Validation completed ( Total :"+(I+de).toString()+" "+e.ImportedCount+" "+e.FailedCount+" )":"Import completed ( Total :"+(I+de).toString()+" "+e.ImportedCount+" "+e.FailedCount+" )",e.ProfileID>-20&&e.ProfileID<0)if(e.UpdateStatusInExcel)try{const H=e.workbookK,X=H.SheetNames[0];let G=ze.Wp.sheet_to_json(H.Sheets[X],{header:1}),j=G[0];const ue=Ce=>(j.includes(Ce)||(j.push(Ce),G[0]=j),j.indexOf(Ce));let M=ue("TMOCODE"),oe=ue("Green Code"),be=ue("RevenUStatus"),P=ue("RevenUReason");for(let Ce=1;Ce<G.length;Ce++){if("1"===e.ExcelTable[Ce-1]?.IsNewRow)continue;let Ke=G[Ce];(!Ke[be]||"Passed"!==Ke[be])&&("pass"===e.ExcelTable[Ce-1]?.RevenUStatus?(Ke[be]="Passed",e.ExcelTable[Ce-1].RevenUStatus="Passed"):Ke[be]=e.ExcelTable[Ce-1]?.RevenUStatus||"",Ke[M]=e.ExcelTable[Ce-1]?.TMOCODE||"",Ke[oe]=e.ExcelTable[Ce-1]?.["Green Code"]||"",Ke[P]=e.ExcelTable[Ce-1]?.RevenUReason||""),G[Ce]=Ke}const _=ze.Wp.aoa_to_sheet(G);H.Sheets[X]=_;const Y=ze.M9(H,{bookType:"xlsx",type:"array"}),re=new Blob([Y],{type:"application/octet-stream"}),ce=document.createElement("a");ce.href=URL.createObjectURL(re),ce.download="Updated_File.xlsx",ce.click()}catch(H){console.error("Error updating Excel:",H)}else e.UpdateExcelSheet()}catch(c){Logger.ErrorLog("importuitlity","ImportDocument ",c.Message,c)}Logger.InfoLog("Exiting ImportDocument ")})()}setQuery(){let e,i,r;const a=parseInt(this.Feature.SelectedValue,10);let u="";const c="INV_DocDetails";u="acc_docdetails"===c.toLowerCase()?"D.AccDocDetailsID":"D.InvDocDetailsID";let o,m,h,n,t=[],s=[],l=0;const g={};g[c]="D",t.push(u),s.push(`${c} D with(nolock)`);for(const S of this.grData.Table){if(i=this.costCenterTableZero.filter(I=>I.CostCenterColID===parseInt(S[1],10)),e=i[0],h="T"+l,m=e.SysTableName||c,o=e.SysColumnName,r=null!=e.ColumnCostCenterID?parseInt(e.ColumnCostCenterID,10):0,a>4e4)if("COM_DocTextData"===m)if(g.COM_DocTextData||(g.COM_DocTextData="TXT",s.push(`INNER JOIN COM_DocTextData TXT with(nolock) ON TXT.${u}=D.${u}`)),"DATE"===e.ColumnDataType)o=`convert(datetime,${o})`,t.push(`'' AS C${l}`),t.push(`${o} AS C${l}_Key`);else if("LISTBOX"===e.UserColumnType){let I;if("44"===e.ColumnCostCenterID.toString())I=`,case when ${o} is not null and isnumeric(${o})=1 then (SELECT Name FROM COM_Lookup with(nolock) WHERE NodeID=${o}) else '' end`;else{let d,y,f,D=b.d.report.GetTableColumns(parseInt(e.ColumnCostCenterID));D.TableName=d,D.PrimaryKey=y,D.ColumnName=f,I=`,case when ${o} is not null and isnumeric(${o})=1 then (SELECT ${f} FROM ${d} with(nolock) WHERE ${y}=${o}) else '' end`}t.push(`${I} AS C${l}`),t.push(`case when isnumeric(${o})=1 then ${o} else convert(bigint,-1) end AS C${l}_Key`)}else"LOOKUP"===e.UserColumnType?(t.push(`${o} AS C${l}`),t.push(`${o} AS C${l}_Key`)):t.push(`${o} AS C${l}`);else"COM_DocNumData"===m?(g.COM_DocNumData||(g.COM_DocNumData="NUM",s.push(`INNER JOIN COM_DocNumData NUM with(nolock) ON NUM.${u}=D.${u}`)),t.push(`${o} AS C${l}`)):"COM_DocCCData"===m?(g.COM_DocCCData||(g.COM_DocCCData="DCC",n="acc_docdetails"===c.toLowerCase()?"AccDocDetailsID":"InvDocDetailsID",s.push(`INNER JOIN COM_DocCCData DCC with(nolock) ON DCC.${n}=D.${n}`)),g[o]||(g[o]=h,s.push(`INNER JOIN ${e.ParentCostCenterSysName} ${h} with(nolock) ON ${h}.NodeID=DCC.${o}`)),t.push(`${g[o]}.${this.IsCode?"Code":"Name"} AS C${l}`)):r>0&&!["AccountTypeID","StatusID"].includes(o)?(g[o]||(g[o]=h,s.push(`INNER JOIN ${e.ParentCostCenterSysName} ${g[o]} with(nolock) ON ${g[o]}.${e.ParentCostCenterColSysName}=D.${o}`)),t.push(`${g[o]}.${this.getColumnName(e)} AS C${l}`)):(o=`D.${o}`,"DATE"===e.ColumnDataType?(o=`convert(datetime,${o})`,t.push(`${o} AS C${l}`)):t.push(`${o} AS C${l}`));l++}let T="SELECT "+t.join(", ")+" FROM "+s.join(" ");return T+=" WHERE ",T+=a>4e4&&a<5e4?`D.CostCenterID=${a} AND D.DocID in (${this.SavedIDs})`:`D.NodeID in (${this.SavedIDs})`,T}getColumnName(e){let i;i="parentid"===e.SysColumnName.toString().toLowerCase()?parseInt(this.Feature.SelectedValue,10):parseInt(e.ColumnCostCenterID,10);let r=0;const a=parseInt(e.ParentCCDefaultColID,10);return isNaN(a)||(r=a),2===i?238===r?"AccountCode":"AccountName":3===i?261===r?"ProductCode":"ProductName":16===i?"BatchNumber":"Name"}ReadBarcode(e,i,r,a){let u=[],c="";c=r,u.push("<XML>"),u.push('<Row CostcenterID="3"'),u.push(e?' syscolname="ProductCode"':' syscolname="ProductName"'),u.push(` value="${r}" />`),""!==u.join("")&&u.push("</XML>");let t=b.d.document.GetCCValues_xml(u.join("")),s=!1;if(t&&t.length>0&&t[0].length>0&&t[0][0].hasOwnProperty("CostCenterID"))for(let o=0;o<t[0].length;o++)i[a]=e?t[0][o].Code?.toString()||"":t[0][o].Name?.toString()||"",s=!0;return s}getAccountTransaction(e,i,r,a,u,c,t){let s=[],o=parseFloat(u);return o<0?(s.push(`DebitAccount="${U.Dw.GetValidXml(i)}" `),s.push(`CreditAccount="${U.Dw.GetValidXml(e)}" `),s.push(`Amount="${(o*t*-1).toString()}" `),s.push(`AmtFc="${(-1*o).toString()}" `),s.push('IsNegative="1" '),r&&s.push(' CrAccCode="1" '),a&&s.push(' DrAccCode="1" ')):o>0&&(s.push(`DebitAccount="${U.Dw.GetValidXml(e)}" `),s.push(`CreditAccount="${U.Dw.GetValidXml(i)}" `),s.push(`Amount="${(o*t).toString()}" `),s.push(`AmtFc="${o.toString()}" `),a&&s.push(' CrAccCode="1" '),r&&s.push(' DrAccCode="1" ')),s.push(`CurrencyID="${c.toString()}" `),s.push(`ExchangeRate="${t.toString()}" `),s.join("")}FillBillWiseDt(e,i,r,a){let u,c;u=parseFloat(r),u<0&&(a=!a,u*=-1);const t=i.replace(/'/g,"''").replace(/&/g,"&amp;"),s=e.filter(o=>o.AccountID===t);if(s.length>0)if(c=s[0],!!c.IsCredit!==a){const o=parseFloat(c.Amount.toString());if(o>u)c.Amount=parseFloat(c.Amount.toString())-u;else if(o<u)c.Amount=u-o,c.IsCredit=a;else if(o===u){const m=e.indexOf(c);m>-1&&e.splice(m,1)}}else c.Amount=parseFloat(c.Amount.toString())+u;else c={AccountID:i,Amount:u,IsCredit:a},e.push(c)}SaveDocument(e,i,r,a,u,c,t,s,o,m,h,n,l,g,T,S,I){var d=this;return(0,Fe.A)(function*(){const y=[];y.push(d.Feature.SelectedValue),y.push(e),y.push(i),y.push(r),y.push(d.formatDDMMMYYYY(a)),y.push(""!==u?d.formatDDMMMYYYY(u):null),y.push(c);const f=!0===window.BulkSave;if(f&&t?(y.push(I[0]),y.push(I[1]),y.push(I[2]),y.push(I[3]),y.push(I[4]),y.push(I[5]),y.push(I[6])):y.push(s),t){let E="";if(0==m.length){if(E+="<BillWise> ",h.Contains(";")){let V=h.split(";");for(let L=0;L<V.length;L++)if(""!=V[L].toString())for(let O of m){E+="<Row ",E+='DocSeqNo="1" ',E+='AccountID="'+O.AccountID.toString()+'" ',E+=' IsNewReference="0" ',E+=' Narration="" ';let x=0;if(V[L].toString().Contains("~")){let B=V[L].split("~");B.length>1&&""!=B[1].toString()&&(x=parseFloat(B[1].toString()))}if(0==x&&(x=parseFloat(O.Amount.toString())),(0,K.yG0)(O.IsCredit.toString())?(E+='AdjAmount="-'+x*S+'" ',E+='AmountFC="-'+x+'" '):(E+='AdjAmount="'+x*S+'" ',E+='AmountFC="'+x+'" '),E+='AdjCurrID="'+T.toString()+'" ',E+='AdjExchRT="'+S.toString()+'" ',V[L].toString().Contains("~")){let B=V[L].split("~");B.length>1&&""!=B[1].toString()&&(E+='RefDocNo="'+B[0]+'" ')}else E+='RefDocNo="'+V[L]+'" ';E+='IsDocPDC="0" ',E+=" ></Row>"}}else for(let V=0;V<m.length;V++)E+="<Row ",E+='DocSeqNo="1" ',E+='AccountID="'+m[V].AccountID.toString()+'" ',E+=' IsNewReference="1" ',E+=' Narration="" ',(0,K.yG0)(m[V].IsCredit.toString())?(E+='AdjAmount="-'+(parseFloat(m[V].Amount.toString())*S).toString()+'" ',E+='AmountFC="-'+m[V].Amount.toString()+'" '):(E+='AdjAmount="'+(parseFloat(m[V].Amount.toString())*S).toString()+'" ',E+='AmountFC="'+m[V].Amount.toString()+'" '),E+='AdjCurrID="'+T+'" ',E+='AdjExchRT="'+S+'" ',E+='RefDocNo="'+h+'" ',E+='IsDocPDC="0" ',E+=" ></Row>";E+=" </BillWise>"}E.replace("&","&amp;"),y.push(E.toString())}y.push(""),y.push(o);const D=window.ProfileID??0,p=window.UniquNo??"";if(D>-20&&D<0){const E=new Date(a);if(d.formatDDMMMYYYY(E)===d.formatDDMMMYYYY(new Date)&&(4===l||5===l))return{docId:-999,errorMessage:"Transactions cannot be processed for Current Date"};y.push(d.PrevDocID>0&&a===d.PrevDocDate?`<XML ImpDocID="${d.PrevDocID.toString()}"  UniquNo="${4===l||5===l?p:""}" />`:`<XML ImpDocID="0" UniquNo="${4===l||5===l?p:""}" />`)}else{let E="",V="";const L=new Date(a),O=L.getMonth()+1;E=O>=b.d.SessionManager.AccountingFromMonth?`1/${d.formatMonthName(b.d.SessionManager.AccountingFromMonth)}/${L.getFullYear()}`:`1/${d.formatMonthName(b.d.SessionManager.AccountingFromMonth)}/${L.getFullYear()-1}`,V=O<b.d.SessionManager.AccountingFromMonth?`${d.daysInMonth(L.getFullYear(),b.d.SessionManager.AccountingToMonth)}/${d.formatMonthName(b.d.SessionManager.AccountingToMonth)}/${L.getFullYear()}`:`${d.daysInMonth(L.getFullYear()+1,b.d.SessionManager.AccountingToMonth)}/${d.formatMonthName(b.d.SessionManager.AccountingToMonth)}/${L.getFullYear()+1}`;const x=!0===window.PartialSave,B=window.ProductTypeID??0,q=window.BatchBasedon??"",$=window.IgnoreBatch??0;f&&t?y.push(`<XML  FinancialSartDate="${E}" FinancialEndDate="${V}" ${d.getQuery()} ><ScheduleActivityXml></ScheduleActivityXml></XML>`):x&&d.PrevDocID>0&&a===d.PrevDocDate?y.push(`<XML FinancialSartDate="${E}" FinancialEndDate="${V}" ImpDocID="${d.PrevDocID.toString()}"  UniquNo="${4===l||5===l?p:""}" />`):t&&5===B&&""!==q&&1===$?y.push(`<XML FinancialSartDate="${E}" FinancialEndDate="${V}" IgnoreBatches="${$}" />`):38===d._DocumentType?(y.push(`<XML FinancialSartDate="${E}" FinancialEndDate="${V}" ><ScheduleActivityXml></ScheduleActivityXml> <PosPayModes>${d.PosPayModesXML.toString()}</PosPayModes></XML>`),d.PosPayModesXML.clear()):y.push(`<XML FinancialSartDate="${E}" FinancialEndDate="${V}" />`)}f&&y.push("<ProjectPlanXml />"),y.push("true"),y.push(l),y.push(n),y.push(d.GetWorkFlow(g)),y.push(b.d.SessionManager.RoleID),t&&y.push(""),y.push(0),y.push(0),y.push(b.d.SessionManager.CompanyGUID),y.push(b.d.SessionManager.UserName),y.push(b.d.SessionManager.UserID),y.push(b.d.SessionManager.LanguageID),y.push(b.d.SessionManager.IsOffline);let F="";if(console.log("ObjArray--\x3e",y),d.IsSaveDocValidate){const V=b.d.document.SetTempInvDocument_Validate(y).ds;return V&&V.tables&&V.tables.length>0&&V.tables[0]&&V.tables[0].length>0&&V.tables[0].sErrors&&V.tables[0].sErrors.length>0?(F=V.tables[0].sErrors,e=-1234567890):(F="",e=1234567890),{docId:e,errorMessage:F}}{let E=null,V="";return E=t?f?yield(0,yt._)(b.d.document.SetTempBulkInvDoc(y)):yield(0,yt._)(b.d.document.SetTempInvDocument(y)):yield(0,yt._)(b.d.document.SetTempAccDocument(y)),V=null!=E&&E.Tables.length>0&&E.Tables[E.Tables.length-1].length>0&&E.Columns[E.Tables.length-1].Contains("ErrorMessage")?E.Tables[E.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",F=V||"",(e=E?.obj||0)>0&&(d.PrevDocID=e||0,d.PrevDocDate=a||"",d.SavedIDs.length>0&&(d.SavedIDs+=","),d.SavedIDs+=e.toString()),{docId:e,errorMessage:F}}})()}getQuery(){let e="";const i=new Ge,r=new Ge,a=new Ge,u=new Ge,c=new Ge,t=new Ge,s=new Ge,o=new Ge,m=new Ge,h=this.costCenterTableZero.filter(n=>String(n.Costcenterid)===String(this.Feature.SelectedValue));for(let n=0;n<h.length;n++){const l=String(h[n].SysColumnName).toLowerCase();l.startsWith("dcnum")?(i.append(h[n].SysColumnName).append(","),b.d.SessionManager.Preferences["Use Foreign Currency"]&&b.d.SessionManager.Preferences["Use Foreign Currency"]&&(i.append("dcCurrID").append(String(h[n].SysColumnName).replace("dcNum","")).append(","),i.append("dcExchRT").append(String(h[n].SysColumnName).replace("dcNum","")).append(","),i.append("dcCalcNumFC").append(String(h[n].SysColumnName).replace("dcNum","")).append(",")),i.append("dcCalc").append(String(h[n].SysColumnName).replace("dc","")).append(","),u.append("X.value('@").append(h[n].SysColumnName).append("','Float'),"),b.d.SessionManager.Preferences["Use Foreign Currency"]&&b.d.SessionManager.Preferences["Use Foreign Currency"]&&(u.append("X.value('@dcCurrID").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcExchRT").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),"),u.append("X.value('@dcCalcNumFC").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),")),u.append("X.value('@dcCalc").append(String(h[n].SysColumnName).replace("dc","")).append("','Float'),"),this.ScreenObject.DocID>0&&(s.append(h[n].SysColumnName).append("="),s.append("X.value('@").append(h[n].SysColumnName).append("','Float'),"),b.d.SessionManager.Preferences["Use Foreign Currency"]&&b.d.SessionManager.Preferences["Use Foreign Currency"]&&(s.append("dcCurrID").append(String(h[n].SysColumnName).replace("dcNum","")).append("="),s.append("X.value('@dcCurrID").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),"),s.append("dcExchRT").append(String(h[n].SysColumnName).replace("dcNum","")).append("="),s.append("X.value('@dcExchRT").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),"),s.append("dcCalcNumFC").append(String(h[n].SysColumnName).replace("dcNum","")).append("="),s.append("X.value('@dcCalcNumFC").append(String(h[n].SysColumnName).replace("dcNum","")).append("','Float'),")),s.append("dcCalc").append(String(h[n].SysColumnName).replace("dc","")).append("="),s.append("X.value('@dcCalc").append(String(h[n].SysColumnName).replace("dc","")).append("','Float'),"))):l.startsWith("dcalpha")?(a.append(h[n].SysColumnName).append(","),t.append("X.value('@").append(h[n].SysColumnName).append("','Nvarchar(max)'),"),this.ScreenObject.DocID>0&&(m.append(h[n].SysColumnName).append("="),m.append("X.value('@").append(h[n].SysColumnName).append("','Nvarchar(max)'),"))):l.startsWith("dcccnid")&&(r.append(h[n].SysColumnName).append(","),c.append("isnull(X.value('@").append(h[n].SysColumnName).append("','BIGINT'),1),"),this.ScreenObject.DocID>0&&(o.append(h[n].SysColumnName).append("="),o.append("isnull(X.value('@").append(h[n].SysColumnName).append("','BIGINT'),1),")))}return e+=' NumCols="'+i.toString()+'" ',e+=' TextCols="'+a.toString()+'" ',e+=' CCCols="'+r.toString()+'" ',e+=' NumSelCols="'+u.toString()+'" ',e+=' TextSelCols="'+t.toString()+'" ',e+=' CCSelCols="'+c.toString()+'" ',this.ScreenObject.DocID>0&&(e+=' NumUpdateCols="'+s.toString()+'" ',e+=' TextUpdateCols="'+m.toString()+'" ',e+=' CCUpdateCols="'+o.toString()+'" '),e.toString()}ClearVaraiables(){this.ccdv=[],this.CCQuery=[],this.CCQueryData.Items=[],this.IsScaned=!1,this.IsPreviewDataOk=!1,this.COls=[],this.temp=[],this.GroupExists=!1,this.lookupdv=[],this.lookupQuery=[],this.lookuptemp=[],this.NotesList=[],this.ErrorList=[],this.RulesList=[]}OnImportData(e){this.IsSaveDocValidate=!1,this.ImportingMessage="Importing Data Please Wait....",this.ImportDataClick()}ImportDataClick(){if(N.J0.Int(this.Feature.SelectedValue),null==this.ActualFileName||""===this.ActualFileName)return Logger.InfoLog("Entered into  SelectFiletoImport..."),this.DisplayMessage=b.d.GetResource("SelectFiletoImport"),this.MessageVisibility=!0,this.ImportVisbility=!0,void Logger.InfoLog("Exited into  SelectFiletoImport...");{const r=b.d.common.GetDataSet("DOC0844",this.Feature.SelectedValue);if(!this.IsUpdate&&r.Tables[1]&&r.Tables[1].length>0&&this.Feature.SelectedItem.Name.ToString().toUpperCase()==r.Tables[1][0].Name.ToString().toUpperCase()&&(N.J0.Int(this.Feature.SelectedValue)<4e4||N.J0.Int(this.Feature.SelectedValue)>=5e4)&&!this.IsUpdate&&r.Tables[1].length>0&&this.Feature.SelectedItem.Name.toUpperCase()===r.Tables[1][0].Name.toUpperCase()&&(Number(this.Feature.SelectedValue)<4e4||Number(this.Feature.SelectedValue)>=5e4)&&r&&r.Tables[0].length>0){if(!this.ExcelTable.includes("CodeNumber"))return this.DisplayMessage="CodeNumber Mandatory While Using Auto Code",void(this.MessageVisibility=!0);if(!this.ExcelTable.includes("CodePrefix"))return this.DisplayMessage="CodePrefix Mandatory While Using Auto Code",void(this.MessageVisibility=!0)}if(this.ValidateBeforeImport){if(this.grData.Table.length>0&&("40"!==this.Feature.SelectedValue||"Dimension Wise Price Chart"!==this.Feature.SelectedItem.Name)){let a=Object.values(this.grData.Table.reduce((c,t)=>{const s=t.FeatureFieldName;return c[s]||(c[s]={Name:s,ColCount:0}),c[s].ColCount++,c},{}));a.sort((c,t)=>c.Name.localeCompare(t.Name));const u=a;for(const[c,t]of Object.entries(u))if(c.ColCount>1&&c.Name){const s=this.grData.Table.filter(o=>o.FeatureFieldName===c.Name);if(s.length>1)return this.DisplayMessage="Duplicate fields selected at Rows "+(this.grData.Table.indexOf(s[0])+1)+" & "+(this.grData.Table.indexOf(s[1])+1),void(this.MessageVisibility=!0)}}if(!this.ValidateExcelData())return}Logger.InfoLog("After ValidateBeforeImport check..."),this.FailedRecourdList=[],this.ProgressVisbility=!0,this.ProgressValue=0,this.ImportVisbility=!1,this.MessageVisibility=!1,this.ImportedCount="",this.FailedCount="",Logger.InfoLog("Before ClearVaraiables()..."),this.ClearVaraiables(),Logger.InfoLog("After ClearVaraiables()..."),Logger.InfoLog("Before  ExcelTable check..."),null!=this.ExcelTable&&(Logger.InfoLog("ExcelTable is not null... Rows :: "+this.ExcelTable.length),("2"===this.Feature.SelectedValue||"3"===this.Feature.SelectedValue||Number(this.Feature.SelectedValue)>5e4&&Number(this.Feature.SelectedValue)<=50075)&&("Account Dimension wise Cr/Dr Limits"!==this.Feature.SelectedItem.Name&&"Account Report Template"!==this.Feature.SelectedItem.Name&&"Account Contacts"!==this.Feature.SelectedItem.Name&&"Account Address"!==this.Feature.SelectedItem.Name||"2"!==this.Feature.SelectedValue)&&("KIT PRODUCTS"!==this.Feature.SelectedItem.Name.toUpperCase()&&"Product QC"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM"!==this.Feature.SelectedItem.Name&&"Products With Multiple UOM Barcode"!==this.Feature.SelectedItem.Name&&"Products With Vendor Multiple Barcode"!==this.Feature.SelectedItem.Name&&"PRODUCTS WISE BINS"!==this.Feature.SelectedItem.Name.toUpperCase()||"3"!==this.Feature.SelectedValue)&&"JOB OUTPUT"!==this.Feature.SelectedItem.Name.toUpperCase()&&"PRODUCTS WITH SUBSTITUTES"!==this.Feature.SelectedItem.Name.toUpperCase()?(Logger.InfoLog("Before groupmethod()..."),this.groupmethod(),Logger.InfoLog("After groupmethod()...")):(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<5e4&&(this.MapDebitCreditAccountFields(),this.CheckAvgRateexists()),this.ProgressMax=this.ExcelTable.length,this.worker_DoWork(),this.worker_RunWorkerCompleted()))}}ValidateExcelData(){if(this.IsUpdate)return!0;try{const e=Number(this.Feature.SelectedValue);if(2===e||3===e||e>5e4||e>4e4&&e<5e4){if(this.ExcelTable&&this.ExcelTable.length>0){const i=[...this.ExcelTable];if(e>4e4&&e<5e4){if(this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const r=this.costCenterTableZero.filter(a=>a.CostCenterID===e&&1===a.IsMandatory);if(r.length>0)for(const a of r){let u=this.grData.Table.filter(c=>c.FeatureFieldName===String(a.CostCenterColID));if(!u||0===u.length){let c=!1;const t=String(a.SysColumnName).toUpperCase();if("PRODUCTID"===t){const s=this.costCenterTableZero.filter(o=>o.CostCenterID===e&&o.SysColumnName===t&&o.CostCenterColID!==a.CostCenterColID);for(const o of s)if(this.grData.Table.some(m=>m.FeatureFieldName===String(o.CostCenterColID))){c=!0;break}}else if("DEBITACCOUNT"===t||"DEBITACCOUNTCODE"===t){const s=this.costCenterTableZero.filter(o=>o.CostCenterID===e&&("DebitAccount"===o.SysColumnName||"DebitAccountCode"===o.SysColumnName)&&o.CostCenterColID!==a.CostCenterColID);for(const o of s)if(this.grData.Table.some(m=>m.FeatureFieldName===String(o.CostCenterColID))){c=!0;break}}else if("CREDITACCOUNT"===t||"CREDITACCOUNTCODE"===t){const s=this.costCenterTableZero.filter(o=>o.CostCenterID===e&&("CreditAccount"===o.SysColumnName||"CreditAccountCode"===o.SysColumnName)&&o.CostCenterColID!==a.CostCenterColID);for(const o of s)if(this.grData.Table.some(m=>m.FeatureFieldName===String(o.CostCenterColID))){c=!0;break}}if(!c)return this.DisplayMessage=`${a.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}}}else if((2===e||3===e||e>5e4)&&this.costCenterTableZero&&this.CostCenterFieldsAllTables.Tables.length>0&&this.costCenterTableZero.length>0&&this.costCenterTableZero.hasOwnProperty("IsMandatory")){const r=this.costCenterTableZero.filter(a=>a.CostCenterID===e&&1===a.IsMandatory);if(r.length>0)for(const a of r){let u=String(a.SysColumnName||"").trim().toUpperCase();if(""===u||2===e&&["ACCOUNTID","PARENTID","ACCOUNTTYPEID","STATUSID","ISGROUP","ACCOUNTGROUP"].includes(u)||3===e&&["PRODUCTID","PARENTID","PRODUCTTYPEID","VALUATIONID","STATUSID","ISLOTWISE","PRODUCTGROUP"].includes(u)||e>5e4&&"ISGROUP"===u)continue;const c=this.grData.Table.filter(t=>t.FeatureFieldName===String(a.CostCenterColID));if(!c||0===c.length)return this.DisplayMessage=`${a.ResourceData} - field is Mandatory, please map this field and try again`,this.MessageVisibility=!0,!1}}if(this.grData.Table.length>0)for(let r=0;r<i.length;r++)for(let a=0;a<this.grData.Table.length;a++){if(!this.grData.Table[a].FeatureFieldName)continue;const u=this.costCenterTableZero.filter(c=>String(c.CostCenterColID)===this.grData.Table[a].FeatureFieldName);if(u.length>0){const c=this.grData.Table[a].FieldName,t=String(u[0].UserColumnType||"").trim().toUpperCase();if(this.costCenterTableZero[0].hasOwnProperty("IsMandatory")&&u[0].IsMandatory&&"0"!==u[0].IsMandatory){const m=String(i[r][c]||"").trim();if(["NUMERIC","BIGINT","FLOAT","INT"].includes(t)&&(""===m||isNaN(Number(m))||0===Number(m)))return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory/invalid, check at Row No. ${r+1}`,this.MessageVisibility=!0,!1;if(""===m)return this.DisplayMessage=`${u[0].ResourceData} - field data is Mandatory, check at Row No. ${r+1}`,this.MessageVisibility=!0,!1}if(["DATE","DATETIME","FIXEDDATE","FIXEDDATETIME"].includes(t)){const o=String(i[r][c]||"").trim();if(""!==o){const m=new Date(o);if(isNaN(m.getTime())||1===m.getFullYear())return this.DisplayMessage=`${u[0].ResourceData} - field data is invalid, check at Row No. ${r+1}`,this.MessageVisibility=!0,!1}}}}return!0}return this.DisplayMessage="Excel data not found.",this.MessageVisibility=!0,!1}return!0}catch(e){return this.DisplayMessage=e.message,this.MessageVisibility=!0,Logger.ErrorLog(`Exception :: ValidateExcelData() - Message :: ${e.message}\nStack Trace :: ${e.stack}`),!1}}ImportEmployeeData(){let e=0,i=0,r=0,u=0,t="",s="",o="",m=!0,h=[],n=null,g=null,T=null;this.GradeFromDate=new Date(this.dtValue.getFullYear(),0,1),this.LocFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DeptFromDate=new Date(this.dtValue.getFullYear(),0,1),this.DesgFromDate=new Date(this.dtValue.getFullYear(),0,1);let S=this.costCenterTableZero,I=this.costCenterTableZero;this.objCG.Data=b.d.common.GetScreenInfo(50051),console.log(" this.objCG.Data",this.objCG.Data),this.objCG.IsEmpImport=!0,this.objCG.InitAutoCode(this.objCG.Data.Tables[7],!1);let d=null,y=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().Length>0&&(y=new N.VB,y.LoadXml(this.CodeDef[0].PrefixContent.toString()));for(let D=0;D<this.ExcelTable.length;D++){this.objEmp=new Ct.h,null!=y&&(d=this.GetCodeData(this.ExcelTable[D],0));for(let p=0;p<this.grData.Table.length;p++){if(g=this.ExcelDataColumn.indexOf(this.DtImport[p].FieldName),null==this.grData.Table[p].FeatureFieldName||""==this.grData.Table[p].FeatureFieldName.toString())continue;const E=S.filter(V=>V.CostCenterColID==this.grData.Table[p].FeatureFieldName.toString());if(E.length>0){let V=E[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+V),V){case"Code":this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g),0==this.IsUpdate?""==this.objEmp.EmpCode&&(this.objEmp.EmpCode=this.ExcelTable[D][g]):this.objEmp.EmpCode=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()];break;case"Name":0==this.objEmp.SelectedNodeID&&(this.objEmp.SelectedNodeID=this.GetEmployeeGroupID(g)),""==this.objEmp.EmpCode.toString()&&0==this.IsUpdate&&null==this.objEmp.EmpCode&&(this.objEmp.EmpCode=""),this.objEmp.EmpName=this.ExcelTable[D][g];break;case"ParentGroupName":this.objEmp.SelectedNodeID=N.J0.StringIsNullOrEmpty(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()+"_Key"].toString())?1:N.J0.Int(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()+"_Key"].toString());break;case"CodePrefix":null==d&&(this.objEmp.CodePrefix=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"CodeNumber":null==d&&(this.objEmp.CodeNumber=N.J0.Int(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]));break;case"AliasName":this.objEmp.EmpAliasName=this.ExcelTable[D][g];break;case"StatusID":const L=this.objCG.Data.Tables[3].filter(O=>O.Status==this.ExcelTable[D][g]);L.length>0?this.objEmp.StatusID=N.J0.Int(L[0].StatusID):(n=b.d.document.GetEmpImportDetails(0,this.ExcelTable[D][g],0),this.objEmp.StatusID=N.J0.Int(n.Tables[0].StatusID));break;case"RptManager":if("null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]){let O;1==this.IsCode&&(O=b.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Code='"+this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=O&&O.Rows.length>0?N.J0.Int(O.Rows[0].NodeId.toString()):0),0==this.IsCode&&(O=b.d.document.GetDataSet("select top 1 NodeID from Com_cc50051 where Name='"+this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]+"'"),this.objEmp.RptManager=null!=O&&O.Rows.length>0?N.J0.Int(O.Rows[0].NodeId.toString()):0)}else this.objEmp.RptManager=0;break;case"EmpType":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[D][this.grData.Table[p].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.EmpTypeID=N.J0.Int(this.objCG.Data.Tables[8][0].NodeID):(n=b.d.document.GetEmpImportDetails(1,this.ExcelTable[D][this.grData.Table[p].FieldName.toString()],104),this.objEmp.EmpTypeID=N.J0.Int(n.Tables[0][0].NodeID))):this.objEmp.EmpTypeID=0;break;case"Gender":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]?(this.objCG.Data.Tables[8].RowFilter="Name='"+this.ExcelTable[D][this.grData.Table[p].FieldName.toString().Trim()]+"'",this.objCG.Data.Tables[8].length>0?this.objEmp.Gender=this.objCG.Data.Tables[8][0].NodeID.toString():(n=b.d.document.GetEmpImportDetails(1,this.ExcelTable[D][this.grData.Table[p].FieldName.toString()],104),this.objEmp.Gender=n.Tables[0][0].NodeID.toString())):this.objEmp.Gender="0";break;case"DOJ":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.objEmp.DOJ=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()])),this.Doj=this.objEmp.DOJ;break;case"DOB":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.objEmp.DOB=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]));break;case"ProbationDays":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.objEmp.ProbationDays=N.J0.Int(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]));break;case"DOConfirmation":this.objEmp.DOConfirmation="null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]?new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]):this.objEmp.DOJ.AddDays(this.objEmp.ProbationDays);break;case"Assigned_VacDaysPeriod":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.strVacDayPeriod=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"CurrencyID":this.CostCenterFieldsAllTables.Tables[2].filter(O=>O.Name==this.ExcelTable[D][this.grData.Table[p].FieldName.toString().Trim()]),this.intCurrencyID=this.CostCenterFieldsAllTables.Tables[2].length>0?N.J0.Int(this.CostCenterFieldsAllTables.Tables[2][0].CurrencyID):1;break;case"GradeFromDate":"null"!=this.CostCenterFieldsAllTables[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.GradeFromDate=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]),t="Grade");break;case"LocFromDate":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.LocFromDate=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]),t="Loc");break;case"DeptFromDate":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.DeptFromDate=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]),t="Dept");break;case"DesgFromDate":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.DesgFromDate=new Date(this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]),t="Desg");break;case"GradeRemarks":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.GradeRemarks=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"LocRemarks":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.LocRemarks=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"DeptRemarks":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.DeptRemarks=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"DesgRemarks":"null"!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString().ToLower()].toString()&&""!=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]&&(this.DesgRemarks=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]);break;case"DimensionImage":try{this.grData.Table[p].FieldName.toString()}catch{s=""}break;case"Attachments":if("50051"==this.Feature.SelectedValue)try{let O=this.ExcelTable[D][this.grData.Table[p].FieldName.toString()];O.Length>0&&O.Split(";")}catch{o=""}break;default:if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let O=b.d.document.GetDataSet("Select NodeID,Code,Name FROM COM_CC50051 WITH(NOLOCK) WHERE "+this.UpdateBasedOn.SelectedValue+" = '"+this.ExcelTable[D][this.grData.Table[p].FieldName.toString()]+"' ");null!=O&&O.Rows.length>0&&(this.objEmp.EmpCode=O.Rows[0].Code.toString(),this.objEmp.EmpName=O.Rows[0].Name.toString())}}}}if(1==this.IsUpdate&&null!=this.objEmp.EmpCode.toString()&&""!=this.objEmp.EmpName.toString()){if(u=0,1==this.IsUpdate&&0==this.IsCode&&(h=b.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+this.objEmp.EmpName+"'")),1==this.IsUpdate&&1==this.IsCode&&(h=b.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+this.objEmp.EmpCode+"'")),h.length>0&&(u=N.J0.Int(h[0].NodeID),this.objEmp.GUID=h[0].GUID.toString(),this.objEmp.EmpCode=h[0].Code.toString(),this.objEmp.CodePrefix=h[0].CodePrefix.toString(),this.objEmp.CodeNumber=N.J0.Int(h[0].CodeNumber),this.objEmp.SelectedNodeID=N.J0.Int(h[0].ParentID),this.dsEdit=this.objEmpEss.GetEmpMasterDetails(),0)){if(I.filter(p=>"COM_CC50051"==p.sysTableName),I.length>0)for(let p=0;p<I.length;p++){let F=I[p].SysColumnName.toString(),E=I[p].CostCenterColID.toString();switch(Logger.InfoLog("ImportCosCenters-Update Columnname ="+F),this.drupd=this.grData.Table.filter(V=>V.FeatureFieldName==E),F){case"AliasName":0==this.drupd.length&&(this.objEmp.EmpAliasName=T.Tables[0][0].AliasName.toString());break;case"StatusID":0==this.drupd.length&&(this.objEmp.StatusID=N.J0.Int(T.Tables[0][0].StatusID.toString()));break;case"EmpType":0==this.drupd.length&&(this.objEmp.EmpTypeID=N.J0.Int(T.Tables[0][0].EmpType.toString()));break;case"Gender":0==this.drupd.length&&(this.objEmp.Gender=T.Tables[0][0].Gender.toString());break;case"RptManager":N.J0.Int(E.toString())>0&&0==this.drupd.length&&(this.objEmp.RptManager=N.J0.Int(T.Tables[0][0].RptManager.toString()));break;case"DOJ":0==this.drupd.length?(this.dtValue=new Date(T.Tables[0][0].cDOJ.toString()),this.objEmp.DOJ=new Date(this.dtValue),this.Doj=this.objEmp.DOJ):""==t.toString()?(this.strHistoryMsg="",h=b.d.document.GetDataSet("select Top 1 Convert(DateTime,FromDate) FromDate From COM_HistoryDetails with(nolock) Where CostCenterID=50051 and HistoryCCID=50053 And NodeID='"+u.toString()+"' Order By Convert(DateTime,FromDate)"),h.length>0&&this.Doj.toLocaleDateString("MMM/yyyy")!=new Date(h[0].FromDate).toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with history dimensions")):("Grade"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.GradeFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg="Doj dependency with grade dimension"),"Loc"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.LocFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with location dimension"),"Dept"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DeptFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with department dimension"),"Desg"==t.toString()&&this.Doj.toLocaleDateString("MMM/yyyy")!=this.DesgFromDate.toLocaleDateString("MMM/yyyy")&&(this.strHistoryMsg=this.strHistoryMsg+" Doj dependency with designation dimension"));break;case"DOB":0==this.drupd.length&&(this.dtValue=new Date(T.Tables[0][0].cDOB.toString()),this.objEmp.DOB=new Date(this.dtValue));break;case"ProbationDays":0==this.drupd.length&&(this.objEmp.ProbationDays=N.J0.Int(T.Tables[0][0].ProbationDays.toString()));break;case"DOConfirmation":0==this.drupd.length&&(this.dtValue=new Date(T.Tables[0][0].cDOConfirmation.toString()),this.objEmp.DOConfirmation=new Date(this.dtValue));break;case"CurrencyID":0==this.drupd.length&&(this.intCurrencyID=""!=T.Tables[0][0].CurrencyID.toString()?N.J0.Int(T.Tables[0][0].CurrencyID.toString()):1)}}T.Tables[7].Rows.length>0&&(this.EmpGrade=N.J0.Int(T.Tables[7][0].CCNID53.toString()))}0==u?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"No Employee Exist"}),m=!1):(m=!0,""!=this.strHistoryMsg.toString()?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.strHistoryMsg.toString()}),m=!1):(this.strHistoryMsg="",this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,D,g),""!=this.strHistoryMsg.toString()&&(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:"Dependency with code/fromdate in history dimensions"}),m=!1)))}if(1==m&&(this.objEmp.NodeID=u,this.objEmp.NotesXML="",this.objEmp.ContactsXML="",this.objEmp.AddressXML="",s.length>0&&(s="<AttachmentsXML>"+s+"</AttachmentsXML>"),o.length>0&&(o="<AttachmentsXML>"+o+"</AttachmentsXML>"),this.objEmp.AttachmetsXML=o+s,this.objEmp.CustomFieldsQuery=this.GetCustomFieldsQuery(this.objCG.Data,null,D,g),""!=this.IDHistoryMessage.toString()&&(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.IDHistoryMessage.toString()}),m=!1),1==m)){this.objEmp.CustomCostCenterFieldsQuery=this.GetCustomCostCenterFieldsQuery(this.objCG.Data,null,D,g);let p="";if("TRUE"==b.d.SessionManager.Preferences.EnableLocationWise.toUpperCase()&&b.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")){if(null!=this.objEmp.CustomCostCenterFieldsQuery&&this.objEmp.CustomCostCenterFieldsQuery.length>0){let E=this.objEmp.CustomCostCenterFieldsQuery.split(",");if(E.length>0)for(let V=0;V<E.length;V++)null!=E[V]&&E[V].Contains("CCNID2=")&&(p+='<Row  CostCenterId="50002" NodeID="'+E[V].replace("'","").substring(8)+'" />')}""==p?this.objEmp.CCMapXML="":this.objEmp.CCMapXML+="<XML>"+p+"</XML>"}else this.objEmp.CCMapXML="";this.objEmp.HistoryXML=this.HistoryCCXML,this.objEmp.DocumentsXML="",this.objEmp.IDHistoryXML=this.HistoryCCXML,this.objEmp.PaymentModeXML=this.PaymentModeXML,this.objEmp.AccLinkXML=this.SetComponentAccountMapping(null,u,D),this.objEmp.PrimaryContactQuery="",this.objEmp.PayQuery=this.GetEmployeePayQuery(null,D,u),this.objEmp.dsPayStructure=""!=this.objEmp.PayQuery.toString()?"True"==b.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1):null,0==this.objEmp.StatusID&&(this.objEmp.StatusID=""!=b.d.SessionManager.Preferences.DefaultEmpStatus?N.J0.Int(b.d.SessionManager.Preferences.DefaultEmpStatus):250),this.objEmp.IsImport=!0,this.objEmp.RotationalLeave="";let F=0;this.objEmpEss.SaveEmpMaster("","SaveEmpMaster").subscribe(E=>{this.DisplayMessage=E.Message,F=E.RetValue,r=F,r<0?(i++,this.FailedRecourdList.push({Name:this.objEmp.EmpName.toString(),Message:this.DisplayMessage})):e++},E=>{console.log("Employee Master Save : "+JSON.stringify(E))})}this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString()}let f=i+e;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+f.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCustomFieldsQuery(e,i,r,a){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomFieldsQuery");let t,m,c=null,s="",o="",h="",n="",l="",g="",T="",S="",I="",d="",y="",f=["Code","Name","StatusID","AliasName","EmpType","RptManager","DOJ","DOB","Gender","ProbationDays","DOConfirmation"],D=e.Tables[0].filter(F=>!f.includes(F.SysColumnName));if(D.length>0){for(let F=0;F<=D.length-1;F++)for(let E=0;E<this.grData.Table.length;E++)if(null!=this.grData.Table[E].FeatureFieldName&&""!=this.grData.Table[E].FeatureFieldName.toString()&&D[F].CostCenterColID.toString()==this.grData.Table[E].FeatureFieldName.toString()){if(("PassportNo"==D[F].SysColumnName.toString()||"VisaNo"==D[F].SysColumnName.toString()||"IqamaNo"==D[F].SysColumnName.toString()||"ContractNo"==D[F].SysColumnName.toString()||"IDNo"==D[F].SysColumnName.toString()||"LicenseNo"==D[F].SysColumnName.toString()||"MedicalNo"==D[F].SysColumnName.toString())&&(T="",S="",I="",d="",y="",t=this.ExcelTable[r][a],null!=t&&""!=t)){h+='<Row Number="'+t+'"';let V=e.Tables[0];V.RowFilter="SysColumnName='"+D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+"IssDate'";let L=this.grData.Table.filter(B=>B.FeatureFieldName==V[0].CostCenterColID.toString()),O=new Date;if(V.length>0&&null!=L&&L.length>0){let B=new Date;(""==this.ExcelTable[r][L[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][L[0].FieldName.toString().Trim()]))&&(T=B.toLocaleDateString("dd/MMM/yyyy"))}if(V.RowFilter="SysColumnName='"+D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+"ExpDate'",V.length>0){let B=L;null!=B&&B.length>0&&(""==this.ExcelTable[r][B[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][B[0].FieldName.toString().Trim()]))&&(S=O.toLocaleDateString("dd/MMM/yyyy"))}if(null!=T&&""!=T&&T.length>0){if(null!=S&&""!=S&&S.length>0&&new Date(T)>new Date(S)&&(this.IDHistoryMessage+=D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+" ExpDate Should be greater than IssDate "),h+=' IssDate="'+new Date(T).toLocaleDateString("dd MMM yyyy")+'"',null!=S&&""!=S&&S.length>0&&(h+=' ExpDate="'+new Date(S).toLocaleDateString("dd MMM yyyy")+'"'),"ContractNo"==D[F].SysColumnName.toString()){if(V.RowFilter="SysColumnName='"+D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+"ExtendDate'",V.length>0){let B=L;null!=B&&B.length>0&&(""==this.ExcelTable[r][B[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][B[0].FieldName.toString().Trim()]))&&(I=O.toLocaleDateString("dd/MMM/yyyy"))}null!=I&&""!=I&&I.length>0&&(h+=' ExtendDate="'+new Date(I).toLocaleDateString("dd MMM yyyy")+'"')}if("VisaNo"==D[F].SysColumnName.toString()&&b.d.SessionManager.Preferences.ContainsKey("CountryDimension")&&""!=b.d.SessionManager.Preferences.CountryDimension&&parseInt(b.d.SessionManager.Preferences.CountryDimension)>0){let B=this.grData.Table.filter(q=>"-14"==q.FeatureFieldName);if(null!=B&&B.length>0&&(c=b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][B[0].FieldName.toString()],parseInt(b.d.SessionManager.Preferences.CountryDimension)),c.Tables.length>0))for(let q=0;q<c.Tables.length;q++)c.Tables[q].includes("NodeID")&&(d=String(c.Tables[q][0].NodeID));null!=d&&""!=d&&d.length>0&&(h+=' Country="'+d.toString()+'"'),B=this.grData.Table.filter(q=>"-15"==q.FeatureFieldName),null!=B&&B.length>0&&""!=this.ExcelTable[r][B[0].FieldName.toString().Trim()]&&(y=this.ExcelTable[r][B[0].FieldName.toString()]),null!=y&&""!=y&&y.length>0&&(h+=' IsDefault="'+y.toString()+'"')}}let x="";if("PassportNo"==D[F].SysColumnName.toString()?x="-51001":"VisaNo"==D[F].SysColumnName.toString()?x="-51002":"IqamaNo"==D[F].SysColumnName.toString()?x="-51003":"ContractNo"==D[F].SysColumnName.toString()?x="-51004":"IDNo"==D[F].SysColumnName.toString()?x="-51005":"LicenseNo"==D[F].SysColumnName.toString()?x="-51006":"MedicalNo"==D[F].SysColumnName.toString()&&(x="-51007"),h+=' DType="'+x+'"',h+=' sDType="'+D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+'"',null!=i){let B=i;B.filter(q=>q.DType==x),B.Sort="Field2 DESC",null!=T&&""!=T&&T.length>0&&B.length>0&&""!=B[0].Field5.toString()&&new Date(T)<new Date(parseFloat(B[0].Field5)).AddDays(2)&&(this.IDHistoryMessage+=D[F].SysColumnName.toString().substring(0,D[F].SysColumnName.toString().length-2)+" IssDate Should be greater than "+new Date(parseFloat(B[0].Field5)).AddDays(2).toLocaleDateString("dd MMM yyyy")+" "),h+=B.length>0?' SNo="'+B.length+'1"':' SNo="1"'}else h+=' SNo="1"';h+="/>"}if("PaymentMode"==D[F].SysColumnName.toString()&&(t=this.ExcelTable[r][a],null!=t&&""!=t)){n+='<Row PaymentMode="'+t+'"',t="";let V=e.Tables[0];if(V.RowFilter="SysColumnName='iBank'",V.length>0){let L=this.grData.Table.filter(O=>O.FeatureFieldName==V[0].CostCenterColID.toString());if(c=b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][L[0].FieldName.toString()],parseInt(V[0].ColumnCostCenterID)),c.Tables.length>0)for(let O=0;O<c.Tables.length;O++)c.Tables[O].includes("NodeID")&&(t=String(c.Tables[O][0].NodeID))}if(n+=null!=t&&""!=t?' iBank="'+t+'"':' iBank="0"',V.RowFilter="SysColumnName='BankAccNo'",t="",V.length>0){let L=this.grData.Table.filter(O=>O.FeatureFieldName==V[0].CostCenterColID.toString());null!=L&&L.length>0&&(t=this.ExcelTable[r][L[0].FieldName.toString()])}if(n+=' BankAccNo="'+t+'"',V.RowFilter="SysColumnName='IBANNo'",t="",V.length>0){let L=this.grData.Table.filter(O=>O.FeatureFieldName==V[0].CostCenterColID.toString());null!=L&&L.length>0&&(t=this.ExcelTable[r][L[0].FieldName.toString()])}if(n+=' IBANNo="'+t+'"',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',null!=i){let L=i;L.filter(O=>"-51011"==O.DType),L.Sort="Field2 DESC",n+=L.length>0?' SNo="'+L.length+'1"':' SNo="1"'}else n+=' SNo="1"';n+="/>"}if("text"==D[F].UserColumnType.toString().toLowerCase())"30406"==D[F].CostCenterColID.toString()||"30407"==D[F].CostCenterColID.toString()?"Bank Transfer"==s.toString()?(t=this.ExcelTable[r][a],o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"):("Cash"==s.toString()||"Cheque"==s.toString()||"Demand Draft"==s.toString())&&(t="",o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"):"PAY_EmpPay"!=D[F].SysTableName.toString()&&"PAY_EmpAccountsLinking"!=D[F].SysTableName.toString()&&(t=this.ExcelTable[r][a],o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combobox"==D[F].UserColumnType.toString().toLowerCase())"30366"==D[F].CostCenterColID.toString()||"36894"==D[F].CostCenterColID.toString()||"30367"==D[F].CostCenterColID.toString()?(t="","null"!=this.ExcelTable[r][a].toString()&&""!=this.ExcelTable[r][a]&&(e.Tables[8].RowFilter="Name='"+this.ExcelTable[r][a]+"'",e.Tables[8].length>0?t=String(e.Tables[8][0].NodeID):("30366"==D[F].CostCenterColID.toString()?c=b.d.document.GetEmpImportDetails(1,this.ExcelTable[r][a],108):"36894"==D[F].CostCenterColID.toString()?c=b.d.document.GetEmpImportDetails(1,this.ExcelTable[r][a],114):"30367"==D[F].CostCenterColID.toString()&&(c=b.d.document.GetEmpImportDetails(1,this.ExcelTable[r][a],122)),t=String(c.Tables[0][0].NodeID))),o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"):"RoleID"==D[F].SysColumnName.toString()?(t="",m=b.d.document.GetDataSet("select RoleID from ADM_PRoles where Name='"+this.ExcelTable[r][a]+"'"),null!=m&&m.length>0&&(t=m.Rows[0].RoleID.toString()),o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"):(t=this.ExcelTable[r][a],"PaymentMode"==D[F].SysColumnName.toString()&&(s=t),o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',");else if("combotextvalue"==D[F].UserColumnType.toString().toLowerCase()&&"30366"!=D[F].CostCenterColID.toString()&&"36894"!=D[F].CostCenterColID.toString())""!=this.strVacDayPeriod.toString()&&(t=this.ExcelTable[r][a],o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',",t=this.strVacDayPeriod,o+="VacDaysPeriod=N'"+t.replace("'","''")+"',");else if("date"==D[F].UserColumnType.toString().toLowerCase())t=this.ExcelTable[r][a],""!=t&&(t=new Date(t).toLocaleDateString("dd/MMM/yyyy"),D[F].SysColumnName.toString().toLowerCase().Contains("ccalpha")?o+=D[F].SysColumnName+"=N'"+t+"',":o+=D[F].SysColumnName+"=CONVERT(FLOAT,CONVERT(DATETIME,'"+t+"')),");else if("COM_CC50051"==D[F].SysTableName.toString()&&"listbox"==D[F].UserColumnType.toString().toLowerCase()){if(t="","30117"==D[F].CostCenterColID.toString())t=this.intCurrencyID.toString(),o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',";else if("30402"==D[F].CostCenterColID.toString()&&"Bank Transfer"==s.toString()){if(c=b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][a],parseInt(D[F].ColumnCostCenterID)),c.Tables.length>0)for(let V=0;V<c.Tables.length;V++)c.Tables[V].includes("NodeID")&&(t=String(c.Tables[V][0].NodeID));o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"}else if("30003"!=D[F].CostCenterColID.toString()&&"30402"!=D[F].CostCenterColID.toString()&&"30117"!=D[F].CostCenterColID.toString()){if(c=null!=D[F].ColumnCostCenterID&&null!=D[F].ColumnCostCenterID&&"44"==D[F].ColumnCostCenterID.toString()?b.d.document.GetEmpImportDetails(1,this.ExcelTable[r][a],parseInt(D[F].ColumnCostCenterID)):b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][a],parseInt(D[F].ColumnCostCenterID)),c.Tables.length>0)for(let V=0;V<c.Tables.length;V++)c.Tables[V].includes("NodeID")&&(t=String(c.Tables[V][0].NodeID));o+=D[F].SysColumnName+"=N'"+t.replace("'","''")+"',"}}else if("checkedlistbox"==D[F].UserColumnType.toString().toLowerCase()){if("checkinoutdevice"==D[F].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[r][a],""!=t&&(o+=D[F].SysColumnName+"=N'"+t+"',")),"attsetdimnodes"==D[F].SysColumnName.toString().toLowerCase()&&(t=this.ExcelTable[r][a],""!=t)){let V=t.split(",");if(b.d.SessionManager.Preferences.ContainsKey("AttendanceDimension")&&""!=b.d.SessionManager.Preferences.AttendanceDimension.toString()&&"4"!=b.d.SessionManager.Preferences.AttendanceDimension.toString()){let L="SELECT NodeID,Code,Name FROM "+this.ScreenObject.GetTableName(parseInt(b.d.SessionManager.Preferences.AttendanceDimension))+" WITH(NOLOCK) WHERE IsGroup=0",O=b.d.document.GetDataSet(L);if(null!=O&&O.length>0){let x,B="";for(var p of V)""!=p.toString()&&(x=O.filter(q=>q.Name==q.toString()),null!=x&&x.length>0&&(null!=B&&B.length>0&&(B+=","),B+=x[0].NodeID));o+=D[F].SysColumnName+"=N'"+B+"',"}}}}else("radiobutton"==D[F].UserColumnType.toString().toLowerCase()||"checkbox"==D[F].UserColumnType.toString().toLowerCase())&&(t=this.ExcelTable[r][a],""!=t&&(o+=D[F].SysColumnName+"=N'"+t+"',"))}null!=h&&h.length>0&&(l="<XML>"+h+"</XML>"),null!=n&&n.length>0?g="<XML>"+n+"</XML>":this.IsUpdate||(n+='<Row PaymentMode="Cash"',n+=' iBank="0"',n+=' BankAccNo=""',n+=' IBANNo=""',n+=' StatusID="1"',n+=' DType="-51011"',n+=' sDType="PaymentMode"',n+=' SNo="1"',n+="/>",g="<XML>"+n+"</XML>")}return o.toString()}GetCustomCostCenterFieldsQuery(e,i,r,a){Logger.InfoLog("ImportEmployeeData:: Inside GetCustomCostCenterFieldsQuery");let c,t="",s="",o="",m=null,h=e.Tables[0].filter(n=>null!==n.SectionID||0);if(h.length>0){for(let n=0;n<=h.length-1;n++)for(let l=0;l<this.grData.Table.length;l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&h[n].CostCenterColID.toString()==this.grData.Table[l].FeatureFieldName.toString())if("COM_CCCCDATA"==h[n].SysTableName.toString()&&"listbox"==h[n].UserColumnType.toString().toLowerCase()&&""==h[n].UserProbableValues.toString()){if(c="","null"!=this.ExcelTable[r][a].toLowerCase().toString()&&""!=this.ExcelTable[r][a].toString()&&"CurrencyID"!=h[n].SysColumnName.toString()&&"iBank"!=h[n].SysColumnName.toString()){if(m=b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][a].toString(),parseInt(h[n].ColumnCostCenterID)),m.Tables.length>0)for(let g=0;g<m.Tables.length;g++)m.Tables[g].includes("NodeID")&&(c=String(m.Tables[g][0].NodeID));o+=h[n].SysColumnName+"=N'"+c.replace("'","''")+"',"}}else if("listbox"==h[n].UserColumnType.toString().toLowerCase()&&("H"==h[n].UserProbableValues.toString().toUpperCase()||"HP2"==h[n].UserProbableValues.toString().toUpperCase()||"HP3"==h[n].UserProbableValues.toString().toUpperCase())){if(c="","null"!=this.ExcelTable[r][a].toLowerCase().toString()&&""!=this.ExcelTable[r][a].toString()&&(m=b.d.document.GetEmpImportDetails(3,this.ExcelTable[r][a].toString(),parseInt(h[n].ColumnCostCenterID)),m.Tables.length>0))for(let g=0;g<m.Tables.length;g++)m.Tables[g].includes("NodeID")&&(c=String(m.Tables[g][0].NodeID));if(o+=h[n].SysColumnName+"=N'"+c.replace("'","''")+"',",""!=c.toString())if(null!=i){let g=i;g.RowFilter="CCID='"+parseInt(h[n].ColumnCostCenterID)+"'";let T=new Date,S=new Date;if(g.length>1){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(h[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(c)+"'",50053==parseInt(h[n].ColumnCostCenterID))T=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.GradeFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),g[g.length-1].HistoryNodeID.toString()==c.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")||this.GradeFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Grade Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(h[n].ColumnCostCenterID))T=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.LocFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),g[g.length-1].HistoryNodeID.toString()==c.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")||this.LocFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Location Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(h[n].ColumnCostCenterID))T=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.DesgFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),g[g.length-1].HistoryNodeID.toString()==c.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DesgFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Designation Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(h[n].ColumnCostCenterID))T=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.DeptFromDate<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),g[g.length-1].HistoryNodeID.toString()==c.toString()&&(new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")==this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")||this.DeptFromDate<new Date(g[g.length-1].FromDate))&&(this.strHistoryMsg=this.strHistoryMsg+" Department Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let I=this.grData.Table.filter(y=>y.FeatureFieldName==h[n].CostCenterColID.toString()+"000");if(null!=I&&I.length>0){let y=new Date;(""==this.ExcelTable[r][I[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][I[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",y<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date"),g[g.length-1].HistoryNodeID.toString()==c.toString()&&y<new Date(g[g.length-1].FromDate)&&(this.strHistoryMsg=this.strHistoryMsg+" Date")}if("HP3"==h[n].UserProbableValues.toString().toUpperCase()){let y=this.grData.Table.filter(f=>f.FeatureFieldName==h[n].CostCenterColID.toString()+"001");null!=y&&y.length>0&&((""==this.ExcelTable[r][y[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][y[0].FieldName.toString().Trim()]))&&(S=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+S.toLocaleDateString("dd/MMM/yyyy")+"'")}let d=this.grData.Table.filter(y=>y.FeatureFieldName==h[n].CostCenterColID.toString()+"002");if(null!=d&&d.length>0){let y="";y=this.ExcelTable[r][d[0].FieldName.toString().Trim()],t=t+" Remarks='"+y+"'"}}t+=" Modified='1' />",new Date(g[g.length-1].FromDate).toLocaleDateString("MMM/yyyy")==T.toLocaleDateString("MMM/yyyy")&&"HP3"!=h[n].UserProbableValues.toString().toUpperCase()?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==h[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(T.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>")}else if(1==g.length){if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(h[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(c)+"'",50053==parseInt(h[n].ColumnCostCenterID))T=new Date(this.GradeFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.GradeFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.GradeRemarks+"'";else if(50002==parseInt(h[n].ColumnCostCenterID))T=new Date(this.LocFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.LocFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.LocRemarks+"'";else if(50069==parseInt(h[n].ColumnCostCenterID))T=new Date(this.DesgFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DesgFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DesgRemarks+"'";else if(50004==parseInt(h[n].ColumnCostCenterID))T=new Date(this.DeptFromDate.toLocaleDateString("dd/MMM/yyyy")),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.DeptFromDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date"),t=t+" Remarks='"+this.DeptRemarks+"'";else{let I=this.grData.Table.filter(y=>y.FeatureFieldName==h[n].CostCenterColID.toString()+"000");if(null!=I&&I.length>0&&((""==this.ExcelTable[r][I[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][I[0].FieldName.toString().Trim()]))&&(T=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" FromDate='"+T.toLocaleDateString("dd/MMM/yyyy")+"'",this.Doj>this.EDate&&(this.strHistoryMsg=this.strHistoryMsg+" Check Doj/From Date")),"HP3"==h[n].UserProbableValues.toString().toUpperCase()){let y=this.grData.Table.filter(f=>f.FeatureFieldName==h[n].CostCenterColID.toString()+"001");null!=y&&y.length>0&&((""==this.ExcelTable[r][y[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][y[0].FieldName.toString().Trim()]))&&(S=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+S.toLocaleDateString("dd/MMM/yyyy")+"'")}let d=this.grData.Table.filter(y=>y.FeatureFieldName==h[n].CostCenterColID.toString()+"002");if(null!=d&&d.length>0){let y="";y=this.ExcelTable[r][d[0].FieldName.toString().Trim()],t=t+" Remarks='"+y+"'"}}t+=" Modified='1' />",this.Doj.toLocaleDateString("MMM/yyyy")!=T.toLocaleDateString("MMM/yyyy")?(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t="HP3"==h[n].UserProbableValues.toString().toUpperCase()?t+" ToDate='"+new Date(g[g.length-1].ToDate).toLocaleDateString("dd/MMM/yyyy")+"'":t+" ToDate='"+new Date(T.AddMonths(0).AddDays(-1)).toLocaleDateString("dd/MMM/yyyy")+"'",t=t+" Remarks='"+String(g[g.length-1].Remarks)+"'",t+=" Modified='1' /></XML>"):(t=t+"<Row ID='"+String(g[g.length-1].HistoryID)+"'",t=t+" CCID='"+String(g[g.length-1].CCID)+"'",t=t+" NodeID='"+String(g[g.length-1].HistoryNodeID)+"'",t=t+" FromDate='"+new Date(g[g.length-1].FromDate).toLocaleDateString("dd/MMM/yyyy")+"'",t+=" Remarks='' Modified='2' /></XML>")}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(h[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(c)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==h[n].UserProbableValues.toString().toUpperCase()){let I=this.grData.Table.filter(d=>d.FeatureFieldName==h[n].CostCenterColID.toString()+"001");null!=I&&I.length>0&&((""==this.ExcelTable[r][I[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][I[0].FieldName.toString().Trim()]))&&(S=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+S.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}else{if(t+="<XML><Row ID='0'",t=t+" CCID='"+String(h[n].ColumnCostCenterID)+"'",t=t+" NodeID='"+String(c)+"'",t=t+" FromDate='"+this.Doj.toLocaleDateString("dd/MMM/yyyy")+"'","HP3"==h[n].UserProbableValues.toString().toUpperCase()){let g=new Date,T=this.grData.Table.filter(S=>S.FeatureFieldName==h[n].CostCenterColID.toString()+"001");null!=T&&T.length>0&&((""==this.ExcelTable[r][T[0].FieldName.toString().Trim()]||N.J0.isValidDate(this.ExcelTable[r][T[0].FieldName.toString().Trim()]))&&(g=new Date(this.EDate.toLocaleDateString("dd/MMM/yyyy"))),t=t+" ToDate='"+g.toLocaleDateString("dd/MMM/yyyy")+"'")}t=50053==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.GradeRemarks+"'":50002==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.LocRemarks+"'":50069==parseInt(h[n].ColumnCostCenterID)?t+" Remarks='"+this.DesgRemarks+"'":t+" Remarks='"+this.DeptRemarks+"'",t+=" Modified='1' /></XML>"}}""!=t.toString()&&(s="<History>"+t+"</History>")}return o.toString()}GetEmployeeGroupID(e){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeeGroupID");let i=0,a=(new gt.ControlGenerator,this.costCenterTableZero),u=null;if(a.filter(t=>"3003"==t.CostCenterColID).length>0&&(u=this.ExcelTable.includes(a[0].UserColumnName.toString())?b.d.document.GetEmpImportDetails(2,this.ExcelTable[e][a[0].UserColumnName.toString()],0):b.d.document.GetEmpImportDetails(2,"Employee",0),u.Tables.length>0))for(let t=0;t<u.Tables.length;t++)u.Tables[t].includes("NodeID")&&(i=parseInt(u.Tables[t][0].NodeID));return i}GetEmployeePayQuery(e,i,r){Logger.InfoLog("ImportEmployeeData:: Inside GetEmployeePayrollQuery");let a="",u=0,c=this.costCenterTableZero;if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("EarComponentID"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("DedComponentID"),this.dtPayrollD.push("NodeID"),this.dsPayStructure="True"==b.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()?this.dsEmpPay(this.EmpGrade):this.dsEmpPay(1),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let t=[],s=this.dsPayStructure.Tables[0];s.RowFilter="Type=1 AND Applicable='Yes' AND FieldType<>'OverTime'";for(let o=0;o<s.length;o++)t={},t.SlNo=(o+1).toString(),t.Earnings=s[o].ComponentName.toString(),t.EarSNo=s[o].SNo.toString(),t.EarFormula=s[o].Formula.toString(),t.EarRoff=s[o].ROff.toString(),t.EarValue=(0).ToString(b.d.SessionManager.sPayrollDecimals),t.EarAddToNet=s[o].AddToNet.toString(),t.EarFType=s[o].FieldType.toString(),"EmployeeMaster"!=t.EarFType.toString()&&(t.Earnings_GRAY="1",t.EarValue_GRAY="1"),t.EarComponentID=s[o].ComponentID.toString(),t.NodeID=s[o].CostCenterColID.toString(),this.dtPayrollE.push(t);s.RowFilter="Type=2 AND Applicable='Yes' AND FieldType<>'NetSalary' AND FieldType<>'OverTime'";for(let o=0;o<s.length;o++)t={},t.SlNo=(o+1).toString(),t.Deductions=s[o].ComponentName.toString(),t.DedSNo=s[o].SNo.toString(),t.DedFormula=s[o].Formula.toString(),t.DedROff=s[o].ROff.toString(),t.DedValue=(0).ToString(b.d.SessionManager.sPayrollDecimals),t.DedAddToNet=s[o].AddToNet.toString(),t.DedFType=s[o].FieldType.toString(),"EmployeeMaster"!=t.DedFType.toString()&&(t.Deductions_GRAY="1",t.DedValue_GRAY="1"),t.DedComponentID=s[o].ComponentID.toString(),t.NodeID=s[o].CostCenterColID.toString(),this.dtPayrollD.push(t)}if(c.filter(t=>"PAY_EmpPay"==t.sysTableName),c.length>0)for(let t=0;t<c.length;t++)for(let s=0;s<this.grData.Table.length;s++)null==this.grData.Table.FeatureFieldName||""==this.grData.Table.FeatureFieldName.toString()||"float"==c[t].ColumnDataType.toString().toLowerCase()&&c[t].CostCenterColID.toString()==this.grData.Table.FeatureFieldName.toString()&&("BasicMonthly"==c[t].sysColumnName.toString()?(u=parseFloat(this.ExcelTable[i][this.grData.Table.FieldName.toString()]),a+=c[t].SysColumnName.toString()+"="+u+",",null!=e&&(e[0].BasicMonthly=u)):"-1"!=c[t].UserDefaultValue.toString()&&(a+=c[t].SysColumnName.toString()+"="+this.ExcelTable[i][this.grData.Table.FieldName.toString()]+","));if(null!=e){let t=e;if(t.Sort="EffectFrom DESC,SeqNo DESC",t.length>0){for(let s=0;s<this.dtPayrollE.length;s++)null!=this.dtPayrollE[s].EarSNo&&null!=this.dtPayrollE[s].EarSNo&&""!=this.dtPayrollE[s].EarSNo.toString()&&(this.dtPayrollE[s].EarValue=parseFloat(t[0]["Earning"+this.dtPayrollE[s].EarSNo]).ToString(b.d.SessionManager.sPayrollDecimals));for(let s=0;s<this.dtPayrollD.length;s++)null!=this.dtPayrollD[s].DedSNo&&null!=this.dtPayrollD[s].DedSNo&&""!=this.dtPayrollD[s].DedSNo.toString()&&(this.dtPayrollD[s].DedValue=parseFloat(t[0]["Deduction"+this.dtPayrollD[s].DedSNo]).ToString(b.d.SessionManager.sPayrollDecimals))}}if(this.ExecuteFormulas(u,i,r),null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let t=0;t<this.dtPayrollE.length;t++)null!=this.dtPayrollE[t].EarSNo&&null!=this.dtPayrollE[t].EarSNo&&""!=this.dtPayrollE[t].EarSNo.toString()&&""!=this.dtPayrollE[t].EarValue.toString().Trim()&&(a+="Earning"+this.dtPayrollE[t].EarSNo+"="+this.dtPayrollE[t].EarValue.toString().replace(",","")+",");if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let t=0;t<this.dtPayrollD.length;t++)null!=this.dtPayrollD[t].DedSNo&&null!=this.dtPayrollD[t].DedSNo&&""!=this.dtPayrollD[t].DedSNo.toString()&&""!=this.dtPayrollD[t].DedValue.toString().Trim()&&(a+="Deduction"+this.dtPayrollD[t].DedSNo+"="+this.dtPayrollD[t].DedValue.toString().replace(",","")+",");return""!=a.toString()&&(a+="NetSalary="+(this.totEarnings-this.totDeductions).toString()+","),a}ExecuteFormulas(e,i,r){const a=b.d.report.GetDataTable("IMP002",String(r));let t,u=30,c=(0).ToString(b.d.SessionManager.sPayrollDecimals);this.totEarnings=0,this.totDeductions=0,u="Actual Days"==b.d.SessionManager.Preferences.EmpMasterPayDays?b.d.SessionManager.PayrollMonthEnd.Subtract(b.d.SessionManager.PayrollMonthStart).Days+1:parseInt(b.d.SessionManager.Preferences.EmpMasterPayDays),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.fldDict=new at.bT,t=new ge.Nl("Basic",""),this.fldDict.Basic=t,this.fldDict.Basic.setFieldDetails(e),t=new ge.Nl("TotalDays",""),this.fldDict.TotalDays=t,this.fldDict.TotalDays.setFieldDetails(u),t=new ge.Nl("DaysAttended",""),this.fldDict.DaysAttended=t,this.fldDict.DaysAttended.setFieldDetails(u),t=new ge.Nl("PayrollMonthNo",""),this.fldDict.PayrollMonthNo=t,this.fldDict.PayrollMonthNo.setFieldDetails(b.d.SessionManager.PayrollMonth.getMonth()+1),t=new ge.Nl("PayrollYearNo",""),this.fldDict.PayrollYearNo=t,this.fldDict.PayrollYearNo.setFieldDetails(b.d.SessionManager.PayrollMonth.getFullYear()),t=new ge.Nl("DOJMonth",""),this.fldDict.DOJMonth=t,a.length>0&&a[0].CDOJ&&""!==a[0].CDOJ.toString()?this.fldDict.DOJMonth.setFieldDetails(new Date(a[0].CDOJ).getMonth()+1):this.fldDict.DOJMonth.setFieldDetails(new Date(this.Doj).getMonth()+1),t=new ge.Nl("DOJYear",""),this.fldDict.DOJYear=t,a.length>0&&a[0].CDOJ&&""!==a[0].CDOJ.toString()?this.fldDict.DOJYear.setFieldDetails(new Date(a[0].CDOJ).getFullYear()):this.fldDict.DOJYear.setFieldDetails(new Date(this.Doj).getFullYear()),t=new ge.Nl("DORMonth",""),this.fldDict.DORMonth=t,a.length>0&&a[0].CDORelieve&&""!==a[0].CDORelieve.toString()?this.fldDict.DORMonth.setFieldDetails(new Date(a[0].CDORelieve).getMonth()+1):this.fldDict.DORMonth.setFieldDetails(1),t=new ge.Nl("DORYear",""),this.fldDict.DORYear=t,a.length>0&&a[0].CDORelieve&&""!==a[0].CDORelieve.toString()?this.fldDict.DORYear.setFieldDetails(new Date(a[0].CDORelieve).getFullYear()):this.fldDict.DORYear.setFieldDetails(2200);let s=this.grData.Table;const o=this.dsEmpPay(1);let m;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(t=new ge.Nl(this.dtPayrollE[n].Earnings,""),this.fldDict[this.dtPayrollE[n].Earnings]=t,m=this.dsPayStructure[0].filter(l=>l.CostCenterColID===this.dtPayrollE[n].NodeID.toString()),m.length>0&&(m=o[0].filter(l=>l.ComponentID===m[0].ComponentID.toString()),m.length>0)){const l=s.find(g=>g.FeatureFieldName===m[0].CostCenterColID.toString());if(l){const g=this.ExcelTable[i][l.FieldName];this.dtPayrollE[n].EarValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollE[n].Earnings].setFieldDetails(this.dtPayrollE[n].EarValue),t=new ge.Nl("Calc"+this.dtPayrollE[n].Earnings,""),this.fldDict["Calc"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldDetails(this.dtPayrollE[n].EarValue),t=new ge.Nl("Arr_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Arr_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Arr_"+this.dtPayrollE[n].Earnings].setFieldDetails(0),t=new ge.Nl("Adj_"+this.dtPayrollE[n].Earnings,""),this.fldDict["Adj_"+this.dtPayrollE[n].Earnings]=t,this.fldDict["Adj_"+this.dtPayrollE[n].Earnings].setFieldDetails(0)}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(t=new ge.Nl(this.dtPayrollD[n].Deductions,""),this.fldDict[this.dtPayrollD[n].Deductions]=t,m=this.dsPayStructure[0].filter(l=>l.CostCenterColID===this.dtPayrollD[n].NodeID.toString()),m.length>0&&(m=o[0].filter(l=>l.ComponentID===m[0].ComponentID.toString()),m.length>0)){const l=s.find(g=>g.FeatureFieldName===m[0].CostCenterColID.toString());if(l){const g=this.ExcelTable[i][l.FieldName];this.dtPayrollD[n].DedValue=g?parseFloat(g):0}}this.fldDict[this.dtPayrollD[n].Deductions].setFieldDetails(this.dtPayrollD[n].DedValue),t=new ge.Nl("Calc"+this.dtPayrollD[n].Deductions,""),this.fldDict["Calc"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Calc"+this.dtPayrollD[n].Deductions].setFieldDetails(this.dtPayrollD[n].DedValue),t=new ge.Nl("Arr_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Arr_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Arr_"+this.dtPayrollD[n].Deductions].setFieldDetails(0),t=new ge.Nl("Adj_"+this.dtPayrollD[n].Deductions,""),this.fldDict["Adj_"+this.dtPayrollD[n].Deductions]=t,this.fldDict["Adj_"+this.dtPayrollD[n].Deductions].setFieldDetails(0)}const h=this.fldDict;for(let n=0;n<this.dtPayrollE.length;n++)if(this.dtPayrollE[n].EarSNo){if(this.dtPayrollE[n].EarFormula)try{c=parseFloat(b.d.eval.EvaluateExpression(this.dtPayrollE[n].EarFormula.toString(),h)).ToString(b.d.SessionManager.sPayrollDecimals),this.dtPayrollE[n].EarValue=this.RoundOffValue(parseFloat(c),parseFloat(this.dtPayrollE[n].EarROff)),this.fldDict[this.dtPayrollE[n].Earnings].setFieldDetails(this.dtPayrollE[n].EarValue),this.fldDict["Calc"+this.dtPayrollE[n].Earnings].setFieldDetails(this.dtPayrollE[n].EarValue)}catch{}this.dtPayrollE[n].EarAddToNet&&("Net"===this.dtPayrollE[n].EarAddToNet||"NetAndTax"===this.dtPayrollE[n].EarAddToNet)&&(this.totEarnings+=parseFloat(this.dtPayrollE[n].EarValue))}for(let n=0;n<this.dtPayrollD.length;n++)if(this.dtPayrollD[n].DedSNo){if(this.dtPayrollD[n].DedFormula)try{if(c=parseFloat(b.d.eval.EvaluateExpression(this.dtPayrollE[n].DedFormula.toString(),h)).ToString(b.d.SessionManager.sPayrollDecimals),"ESI"==this.dtPayrollD[n].Deductions.toString().toUpperCase())c=Math.max(parseFloat(c)).ToString(b.d.SessionManager.sPayrollDecimals);else if("PT"==this.dtPayrollD[n].Deductions.toString().toUpperCase()){let l=c.replace(",","");c=(0).ToString(b.d.SessionManager.sPayrollDecimals);let g=this.dsPayStructure.Tables[0].length>0?this.dsPayStructure.Tables[0]:this.dsPayStructure.Tables[1];if(g.length>0){let S,I,d;if(new Date(g[0].PayrollMonth),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let D=0;D=N.J0.GetEmployeeGrade(r.toString(),S,I,d)}let f=b.d.document.GetDataSet(`\nDECLARE @SQL NVARCHAR(MAX),@Val nvarchar(50),@Val2 nvarchar(50),@PayrollMonth NVARCHAR(100),@PayrollStart NVARCHAR(100),@PayrollEnd NVARCHAR(100)\nSET @PayrollMonth='" + dtPM.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollStart='" + dtPMS.toLocaleDateString("dd/MMM/yyyy") + "' SET @PayrollEnd='" + dtPME.toLocaleDateString("dd/MMM/yyyy") + @"'\n\nSELECT @Val= Value FROM ADM_GlobalPreferences WITH(NOLOCK) WHERE Name='PayrollPTDimension'\nIF(@Val IS NOT NULL AND @Val<>'' and CONVERT(INT,@Val)>50000)\nBEGIN\nSelect @Val2='CCNID'+CONVERT(NVARCHAR,(CONVERT(INT,@Val)-50000))\nSET @SQL='\tSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) \nWHERE NodeID IN(" + EmpNodeID + @")AND CostCenterID=50051 AND HistoryCCID='+@Val+'   \nAND (CONVERT(DATETIME,FromDate)<=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR CONVERT(DATETIME,FromDate) BETWEEN CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollStart)+''') AND CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollEnd)+''')) \nAND (CONVERT(DATETIME,ToDate)>=CONVERT(DATETIME,'''+CONVERT(NVARCHAR,@PayrollMonth)+''') OR ToDate IS NULL) \n\nSELECT NodeID as EmpSeqNo,'+@Val2+' as PTDimension FROM COM_CCCCDATA WITH(NOLOCK) WHERE CostCenterID=50051 AND NodeID=" + ${r}\n\nEXEC(@SQL)\n\nEND\nELSE\nBEGIN\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\nSELECT  NodeID as EmpSeqNo,HistoryNodeID as PTDimension FROM COM_HistoryDetails WITH(NOLOCK) WHERE 1<>1\n\nEND\n\nSELECT CONVERT(DATETIME,PayrollDate) as PayrollMonth,*\nFROM PAY_PayrollPT WITH(NOLOCK) \nWHERE CONVERT(DATETIME,PayrollDate)=@PayrollMonth `);if(null!=f&&f.Tables.length>0){let D="1";f.Tables[0].length>0?D=f.Tables[0][0].PTDimension.toString():f.Tables[1].length>0&&(D=f.Tables[1][0].PTDimension.toString());let p=f.Tables[2];if(f.Tables[0].length>0||f.Tables[1].length>0){let F=f.Tables[2];if(F.RowFilter="NodeID="+D+" AND Formula<>''",null!=F&&F.length>0&&null!=F[0].Formula&&null!=F[0].Formula&&""!=F[0].Formula.toString().Trim()){let E=this.fldDict;c=parseFloat(b.d.eval.EvaluateExpression(F[0].Formula.toString(),E)).toString()}else p.RowFilter="NodeID="+D+" AND FromSlab<="+l+" AND ToSlab>="+l,p.length>0&&(c=p[0].Amount.toString())}}}}this.dtPayrollD[n].DedValue=this.RoundOffValue(parseFloat(c),parseFloat(this.dtPayrollD[n].DedROff)),this.fldDict[this.dtPayrollD[n].Deductions.toString()].setFieldDetails(this.dtPayrollD[n].DedValue.toString()),this.fldDict["Calc"+this.dtPayrollD[n].Deductions.toString()].setFieldDetails(this.dtPayrollD[n].DedValue.toString())}catch{}this.dtPayrollD[n].DedAddToNet&&("Net"===this.dtPayrollD[n].DedAddToNet||"NetAndTax"===this.dtPayrollD[n].DedAddToNet)&&(this.totDeductions+=parseFloat(this.dtPayrollD[n].DedValue))}this.dblNetSalary=this.totEarnings-this.totDeductions}SetComponentAccountMapping(e,i,r){Logger.InfoLog("ImportEmployeeData:: Inside SetComponentAccountMapping");let a=[],u=[...this.costCenterTableZero],c=[],t=[],s=null,o=[];const m=n=>{o.push({EmpSeqNo:n.EmpSeqNo||"",ComponentID:n.ComponentID||"",ComponentName:n.ComponentName||"",UserDefaultValue:n.UserDefaultValue||"",Type:n.Type||"",SNo:n.SNo||"",DebitAccountID:n.DebitAccountID||"",CreditAccountID:n.CreditAccountID||"",Flag:n.Flag||""})};if(this.dsPayStructure=this.dsEmpPay(this.EmpGrade),this.dsPayStructure&&this.dsPayStructure[0]&&this.dsPayStructure[0].length>0){let n=this.dsPayStructure[0].filter(l=>["1","2","3"].includes(l.Type?.toString()));m({EmpSeqNo:i.toString(),ComponentID:"-301",ComponentName:"SalaryAccID",UserDefaultValue:"-2",Type:"-301",SNo:"-301",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"}),m({EmpSeqNo:i.toString(),ComponentID:"-302",ComponentName:"PayableAccID",UserDefaultValue:"-2",Type:"-302",SNo:"-302",DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"});for(let l=0;l<n.length;l++)m({EmpSeqNo:i.toString(),ComponentID:n[l].ComponentID.toString(),ComponentName:n[l].ComponentName+"_Acc",UserDefaultValue:"-2",Type:n[l].Type.toString(),SNo:n[l].SNo.toString(),DebitAccountID:"0",CreditAccountID:"0",Flag:"-1"})}if(e&&e.length>0)for(let n=0;n<o.length;n++)if(o[n].ComponentID){let l=e.filter(g=>g.ComponentID?.toString()===o[n].ComponentID.toString());l.length>0&&(o[n].DebitAccountID=l[0].DebitAccountID.toString(),o[n].CreditAccountID=l[0].CreditAccountID.toString(),o[n].Flag="0")}c=[...o];let h=u.filter(n=>"PAY_EmpAccountsLinking"===n.sysTableName||["SalaryAccID","PayableAccID"].includes(n.SysColumnName)).sort((n,l)=>n.SysColumnName.localeCompare(l.SysColumnName,void 0,{sensitivity:"base"}));if(h.length>0){for(let n=0;n<h.length;n++)for(let l=0;l<this.grData.Table.length;l++)if(this.grData.Table.FeatureFieldName&&("text"===h[n].ColumnDataType.toLowerCase()&&h[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()||h[n].CostCenterColID.toString()===this.grData.Table.FeatureFieldName.toString()&&["SalaryAccID","PayableAccID"].includes(h[n].SysColumnName.toString()))){let g=h[n].SysColumnName.toString();if(c.filter(S=>S.ComponentName===g).length>0){if(("-2"===h[n].UserDefaultValue.toString()||["SalaryAccID","PayableAccID"].includes(g))&&(t=o.filter(S=>S.ComponentName===g),t.length>0)){let S=this.ExcelTable[r][this.grData[l].FieldName.toString()];if(S&&""!==S.toString()){if(s=b.d.document.GetEmpImportDetails(3,S.toString(),2),s&&s.length>0)for(let I=0;I<s.length;I++)void 0!==s[I][0]?.NodeID&&(t[0].DebitAccountID=s[I][0].NodeID.toString());t[0].Flag="0"}}if("-3"===h[n].UserDefaultValue.toString()&&(t=o.filter(S=>S.ComponentName===g),t.length>0)){let S=this.ExcelTable[r][this.grData[l].FieldName.toString()];if(S&&""!==S.toString()){if(s=b.d.document.GetEmpImportDetails(3,S.toString(),2),s&&s.length>0)for(let I=0;I<s.length;I++)void 0!==s[I][0]?.NodeID&&(t[0].CreditAccountID=s[I][0].NodeID.toString());t[0].Flag="0"}}}}if(c=o.filter(n=>"0"===n.Flag?.toString()),c.length>0){a.push("<Rows>");for(let n=0;n<c.length;n++)a.push(`<Row EmpSeqNo="${i.toString()}" ComponentID="${c[n].ComponentID.toString()}" Type="${c[n].Type.toString()}" SNo="${c[n].SNo.toString()}" DebitAccountID="${c[n].DebitAccountID.toString()}" CreditAccountID="${c[n].CreditAccountID.toString()}" />`);a.push("</Rows>")}}return a.join("")}RoundOffValue(e,i){if(i>0&&e>0){let r=0,a=!1;r=e%i,r>0&&(i/r<=2&&(a=!0),e-=r,a&&(e+=i))}return e.ToString(b.d.SessionManager.sPayrollDecimals).replace(",","")}dsEmpPay(e){return this.dsEmpPayWithDate(e,null)}dsEmpPayWithDate(e,i){let r=`\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,8,len(SysColumnName)-7)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Earning%' \n          and a.Type=1 and a.GradeID=${e}\n        `;r+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,r+=`\n          union\n          SELECT c.CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          join ADM_COSTCENTERDEF c WITH(NOLOCK) on SUBSTRING(SysColumnName,10,len(SysColumnName)-9)=a.SNO\n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE c.COSTCENTERID=409 AND c.SysColumnName LIKE 'Deduction%' \n          and a.Type=2 and a.GradeID=${e}\n        `,r+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,r+=`\n          union\n          SELECT a.NodeID CostCenterColID,b.Name as ComponentName,CONVERT(DATETIME,a.PayrollDate) as PayrollMonth,a.* \n          ,ROW_NUMBER() OVER (PARTITION BY Type ORDER BY Type) AS Serial\n          FROM COM_CC50054 a WITH(NOLOCK) \n          LEFT JOIN COM_CC50052 b WITH(NOLOCK) on b.NodeID=a.ComponentID\n          WHERE a.GradeID=${e} and a.Type in(3,4)\n        `,r+=null===i?` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e}) `:` AND PayrollDate=(Select Max(PayrollDate) From COM_CC50054 WITH(NOLOCK) Where GradeID=${e} AND Convert(Datetime,PayrollDate)<=Convert(Datetime,'${i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}')) `,r+=" Order By a.Type,a.SNo ";let a=null;return b.d.report.DataSetAsyn("RPT022",r.toString()).then(u=>{a=u.Tables[0]}).catch(u=>{alert(u)}),a}ImportEmployeeDocuments(){let e,i=0,r=0,a=0,u=0,c=0,m="",h="",n=[],l=[],g=this.costCenterTableZero,T=this.grData.Table;if(T.filter(I=>"-251"==I.FeatureFieldName),!(T.length>0))return this.DisplayMessage="Please select employee field",void(this.MessageVisibility=!0);if(T[0].FieldName.toString(),this.grData.Table.length>0){let I=this.costCenterTableZero.filter(y=>y.syscolumnname==y.Field1),d=this.grData.Table;if(d.filter(y=>y.FeatureFieldName==I[0].costcentercolid.toString()),d.length<=0)return this.DisplayMessage="Please select "+I[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0);if(I=this.costCenterTableZero.filter(y=>y.syscolumnname==y.Field2),d.filter(y=>y.FeatureFieldName==I[0].costcentercolid.toString()),d.length<=0)return this.DisplayMessage="Please select "+I[0].Usercolumnname.toString()+" field",void(this.MessageVisibility=!0)}for(let I=0;I<this.ExcelTable.length;I++){e=new Ct.h;for(let y=0;y<this.grData.Table.length;y++)if(null!=this.grData.Table[y].FeatureFieldName&&""!=this.grData.Table[y].FeatureFieldName.toString()&&(g.filter(f=>f.CostCenterColID==this.grData.Table[y].FeatureFieldName.toString()),g.length>0)){let f=g[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+f),f){case"Pay_Employee":e.EmpCode=this.ExcelTable[I][this.grData.Table[y].FieldName.toString()],e.EmpName=this.ExcelTable[I][this.grData.Table[y].FieldName.toString()],n=b.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),n.length>0?(c=parseInt(n[0].NodeID),e.EmpCode=n[0].Code.toString(),e.EmpName=n[0].Name.toString()):(l=b.d.document.GetDataSet("select * from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'"),l.length>0&&(c=parseInt(l[0].NodeID),e.EmpCode=l[0].Code.toString(),e.EmpName=l[0].Name.toString()));break;case"Field1":if(m=this.ExcelTable[I][this.grData.Table[y].FieldName.toString()],""==m||null==m)return this.DisplayMessage="Import completed ( Total :"+(r+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",h=h+"please check Name at Row No "+(I+1).toString()+"in Excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:h}),void(this.ListVisbility=!0);break;case"Field2":if(m=this.ExcelTable[I][this.grData.Table[y].FieldName.toString()],""==m||null==m)return this.DisplayMessage="Import completed ( Total :"+(r+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",h=h+"please check DateOfBirth at Row No "+(I+1).toString()+" in excel",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:h}),void(this.ListVisbility=!0)}}e.NodeID=c,e.DocumentsXML=this.GetEmpDocumentXML(c,this.IsUpdate,this.costCenterTableZero,I),u=e.SaveEmpDocuments(),a=u,a<0?(r++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):i++}this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+r.toString();let S=r+i;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+S.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpDocumentXML(e,i,r,a){Logger.InfoLog("ImportEmployeeDocument::Entering GetEmpDocumentXML");let u="",c="",t="",s="",o="",m=r,h=[];if(m.RowFilter="sysTableName='PAY_EmpDetail' ",m.length>0){if(i){let n=m.Table.filter(g=>g.syscolumnname==g.Field1&&g.syscolumnname==this.Feature.SelectedValue.toString()),l=b.d.document.GetDataSet("select * from pay_Empdetail where DType="+this.Feature.SelectedValue.toString()+" and EmployeeId="+e+" and Field1= '"+this.ExcelTable[a][n[0].FieldName.toString().toLowerCase()].toString()+"'");l.length>0&&null!=l?(o+='<Row Action="MODIFY"',o+=' NodeID="'+l.Rows[0].NodeId.toString()+'"'):(o+='<Row Action="NEW"',o+=' NodeID="0"')}else o+='<Row Action="NEW"',o+=' NodeID="0"';o+=' DType="'+this.Feature.SelectedValue.toString()+'"';for(let n=0;n<this.grData.Table.length;n++)for(let l=0;l<m.length;l++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&m[l].CostCenterColID.toString()==this.grData.Table[n].FeatureFieldName.toString())if("combobox"==m[l].UserColumnType.toString().toLowerCase()&&m[l].sysColumnName.toString().toLowerCase().Contains("field")){if(u="","null"!=this.ExcelTable[a][this.grData.Table[n].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[a][this.grData.Table[n].FieldName.toString()])if("44"==m[l].ColumnCostCenterID.toString()){h=b.d.document.GetEmpImportDetails(1,this.ExcelTable[a][this.grData.Table[n].FieldName.toString()],parseInt(m[l].ColumnCCListViewTypeID.toString()));for(let g=0;g<h.length;g++)h[g].includes("NodeID")&&(u=String(h[g][0].NodeID))}else u=this.ExcelTable[a][this.grData.Table[n].FieldName.toString()];c+=m[l].sysColumnName.toString()+"=N'"+u.replace("'","''")+"',"}else if("listbox"==m[l].UserColumnType.toString().toLowerCase()&&m[l].sysColumnName.toString().toLowerCase().Contains("ccnid")){if(u="",h=b.d.document.GetEmpImportDetails(3,this.ExcelTable[a][this.grData.Table[n].FieldName.toString()],parseInt(m[l].ColumnCostCenterID)),h.length>0)for(let g=0;g<h.length;g++)h[g].includes("NodeID")&&(u=String(h[g][0].NodeID));s+=m[l].SysColumnName+"=N'"+u.replace("'","''")+"',"}else"text"==m[l].UserColumnType.toString().toLowerCase()&&m[l].sysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=m[l].sysColumnName.toString()+"=N'"+this.ExcelTable[a][this.grData.Table[n].FieldName.toString()]+"',":"date"==m[l].UserColumnType.toString().toLowerCase()&&(m[l].sysColumnName.toString().toLowerCase().Contains("field")||m[l].sysColumnName.toString().toLowerCase().Contains("ccalpha"))?(u=this.ExcelTable[a][this.grData.Table[n].FieldName.toString()],""!=u&&(u=new Date(u).toLocaleDateString("dd/MMM/yyyy"),m[l].SysColumnName.toString().toLowerCase().Contains("ccalpha")?t+=m[l].sysColumnName.toString()+"=N'"+this.ExcelTable[a][this.grData.Table[n].FieldName.toString()]+"',":c+=m[l].sysColumnName.toString()+"=N'"+this.ExcelTable[a][this.grData.Table[n].FieldName.toString()]+"',")):"EmployeeID"==m[l].sysColumnName.toString()&&""!=m[l].sysColumnName.toString()?c+=m[l].sysColumnName.toString()+"="+e+",":c+=m[l].sysColumnName.toString()+"=N'"+this.ExcelTable[a][this.grData.Table[n].FieldName.toString()]+"',";o+=' StaticFields ="'+c.toString().Trim(",")+'" ',o+=' ExtraTextFields ="'+t.toString().Trim(",")+'" ',o+=' CCFields ="'+s.toString().Trim(",")+'" ',o+="/>"}return o.length>0&&(o.Insert(0,"<Data>"),o+="</Data>"),Logger.InfoLog("ImportEmployeeDocument::Exiting GetEmpDocumentXML which RETURN XML="+o),o.toString()}ImportEmployeeAppraisal(){let e=new Ct.h,i=0,r=0,a=0,u=!0,c=!1,s="",o=[],m=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++){e=new Ct.h,u=!0,s="";let g=0;for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(m.filter(I=>I.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),m.length>0)){let I=m[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+I),I){case"Code":e.EmpCode=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()];break;case"Name":e.EmpName=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()];break;case"EffectFromDate":"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.dtEffectFrom=new Date(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]));break;case"ActAppraisalFrom":"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.dtActAppraisalFrom=new Date(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]));break;case"NextAppraisalDate":"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.dtNextAppraisalDate=new Date(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]));break;case"BasicMonthly":c=!0,this.dblBasicMonthly=parseFloat(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]);break;case"AnnualCTC":this.dblAnnualCTC=parseFloat(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]);break;case"AppraisalRemarks":"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.AppraisalRemarks=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]);break;case"AppraisalReason":"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.AppraisalReason=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]);break;case"Percentage":c=!0,"null"!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().toLowerCase()].toString()&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(this.dblPercentage=parseFloat(this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]))}}let T=b.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Code='"+e.EmpCode+"'");if(T.length>0&&1==this.IsCode?(a=parseInt(T.Rows[0].NodeID),e.EmpCode=T.Rows[0].Code.toString(),e.EmpName=T.Rows[0].Name.toString(),e.DOJ=new Date(T.Rows[0].DateOfJoining.toString()),this.Doj=e.DOJ):(o=b.d.document.GetDataSet("select *,Convert(DateTime,DOJ) DateOfJoining from Com_CC50051 with(nolock) where Name='"+e.EmpName+"'"),o.length>0&&(a=parseInt(o[0].NodeID),e.EmpCode=o[0].Code.toString(),e.EmpName=o[0].Name.toString(),e.DOJ=new Date(o[0].DateOfJoining.toString()),this.Doj=e.DOJ)),null!=this.Doj&&(this.dtEffectFrom<this.Doj||this.dtActAppraisalFrom<this.Doj)&&(s="EffectFrom and ApplyFrom should be Grater than or Equal to the Date of Joining."),""==s.toString()){let I=b.d.document.GetDataSet('Select * From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + lngNodeID + @" AND SeqNo<>" + 0 + @"\n                            AND Month(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Month + " AND YEAR(Convert(DateTime,EffectFrom))=" + dtEffectFrom.Year');null!=I&&I.length>0&&(this.IsUpdate?g=parseFloat(I.Rows[0].SeqNo.toString()):s="Appraisals already defined for this Month, Can't allow More than once.")}if(""==s.toString()&&"False"==b.d.SessionManager.Preferences.AllowAppraisalIfProcessed&&b.d.document.GetDataSet('SELECT TOP 1 CONVERT(DATETIME,a.DueDate) as PayrollMonth  \n                                                FROM INV_DocDetails a WITH(NOLOCK) \n                                                JOIN COM_DocCCData b WITH(NOLOCK) ON b.InvDocDetailsID=a.InvDocDetailsID\n                                                JOIN COM_DocTextData d WITH(NOLOCK) ON d.InvDocDetailsID=a.InvDocDetailsID\n                                                WHERE a.CostCenterID=40054 and a.StatusID=369 AND b.dcCCNID51=" + lngNodeID + @" \n                                                AND ( CONVERT(DATETIME,d.dcAlpha17) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' OR CONVERT(DATETIME,d.dcAlpha18) > \'" + dtEffectFrom.Date.toLocaleDateString("dd MMM yyyy") + "\' )').length>0&&(s="Appraisal can not be processed. Because already processed payrolls exists."),""!=s.toString()&&(r++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:s.toString()}),u=!1),u){e.NodeID=a;let S=[];S.push(a),S.push(b.d.SessionManager.UserID),S.push(b.d.SessionManager.RoleID),S.push(b.d.SessionManager.LanguageID),this.dsEmpEdit=this.objEmpEss.GetEmpMasterDetails(),null!=this.dsEmpEdit&&this.dsEmpEdit.Tables.length>0?("True"==b.d.SessionManager.Preferences.GradeWiseMonthlyPayroll.toString()&&this.dsEmpEdit.Tables[7].length>0&&(this.EmpGrade=parseInt(this.dsEmpEdit.Tables[7][0].CCNID53.toString())),e.DocumentsXML=this.GetEmpAppraisal(a,!1,this.costCenterTableZero,n,this.dsEmpEdit.Tables[14],c)):e.DocumentsXML=this.GetEmpAppraisal(a,!1,this.costCenterTableZero,n,null,c),null==b.d.document.GetDataSet(e.DocumentsXML)?(r++,this.FailedRecourdList.push({Name:e.EmpName.toString(),Message:this.DisplayMessage})):i++}}this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+r.toString();let h=r+i;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+h.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetEmpAppraisal(e,i,r,a,u,c){Logger.InfoLog("ImportEmployeeAppraisal::Entering GetEmpAppraisal");let t="",s="",o="",m=0;this.dtPayrollE=[],this.dtPayrollD=[];let h=this.costCenterTableZero;if(h.filter(n=>n.sysTableName==n.PAY_EmpPay||n.sysColumnName==n.Percentage),h.length>0){if(c){if(this.dtPayrollE.push("SlNo"),this.dtPayrollE.push("Earnings"),this.dtPayrollE.push("EarValue"),this.dtPayrollE.push("EarAddToNet"),this.dtPayrollE.push("EarFType"),this.dtPayrollE.push("Earnings_GRAY"),this.dtPayrollE.push("EarValue_GRAY"),this.dtPayrollE.push("EarSNo"),this.dtPayrollE.push("EarFormula"),this.dtPayrollE.push("EarROff"),this.dtPayrollE.push("NodeID"),this.dtPayrollD.push("SlNo"),this.dtPayrollD.push("Deductions"),this.dtPayrollD.push("DedValue"),this.dtPayrollD.push("DedAddToNet"),this.dtPayrollD.push("DedFType"),this.dtPayrollD.push("Deductions_GRAY"),this.dtPayrollD.push("DedValue_GRAY"),this.dtPayrollD.push("DedSNo"),this.dtPayrollD.push("DedFormula"),this.dtPayrollD.push("DedROff"),this.dtPayrollD.push("NodeID"),this.dtPayrollD=[],this.dtPayrollE=[],this.dsPayStructure=this.dsEmpPay(this.EmpGrade),null!=this.dsPayStructure&&this.dsPayStructure.Tables.length>0&&this.dsPayStructure.Tables[0].length>0){let n={},l=this.dsPayStructure.Tables[0];l.filter(g=>1==g.Type&&"Yes"==g.Applicable&&"OverTime"==g.FieldType);for(let g=0;g<l.length;g++)n={},n.SlNo=(g+1).toString(),n.Earnings=l[g].ComponentName.toString(),n.EarSNo=l[g].SNo.toString(),n.EarFormula=l[g].Formula.toString(),n.EarRoff=l[g].ROff.toString(),n.EarValue=(0).ToString(b.d.SessionManager.sPayrollDecimals),n.EarAddToNet=l[g].AddToNet.toString(),n.EarFType=l[g].FieldType.toString(),"EmployeeMaster"!=n.EarFType.toString()&&(n.Earnings_GRAY="1",n.EarValue_GRAY="1"),n.NodeID=l[g].CostCenterColID.toString(),this.dtPayrollE.push(n);l.filter(g=>2==g.Type&&"Yes"==g.Applicable&&"NetSalary"==g.FieldType&&"OverTime"==g.FieldType);for(let g=0;g<l.length;g++)n={},n.SlNo=(g+1).toString(),n.Deductions=l[g].ComponentName.toString(),n.DedSNo=l[g].SNo.toString(),n.DedFormula=l[g].Formula.toString(),n.DedROff=l[g].ROff.toString(),n.DedValue=(0).ToString(b.d.SessionManager.sPayrollDecimals),n.DedAddToNet=l[g].AddToNet.toString(),n.DedFType=l[g].FieldType.toString(),"EmployeeMaster"!=n.DedFType.toString()&&(n.Deductions_GRAY="1",n.DedValue_GRAY="1"),n.NodeID=l[g].CostCenterColID.toString(),this.dtPayrollD.push(n)}if(null!=u){let n=u;if(n.Sort="EffectFrom DESC,SeqNo DESC",n.length>0){for(let l=0;l<this.dtPayrollE.length;l++)null!=this.dtPayrollE[l].EarSNo&&null!=this.dtPayrollE[l].EarSNo&&""!=this.dtPayrollE[l].EarSNo.toString()&&(this.dtPayrollE[l].EarValue=parseFloat(n[0]["Earning"+this.dtPayrollE[l].EarSNo]).ToString(b.d.SessionManager.sPayrollDecimals));for(let l=0;l<this.dtPayrollD.length;l++)null!=this.dtPayrollD[l].DedSNo&&null!=this.dtPayrollD[l].DedSNo&&""!=this.dtPayrollD[l].DedSNo.toString()&&(this.dtPayrollD[l].DedValue=parseFloat(n[0]["Deduction"+this.dtPayrollD[l].DedSNo]).ToString(b.d.SessionManager.sPayrollDecimals))}}}for(let n=0;n<h.length;n++)for(let l=0;l<this.grData.Table.length;l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&"float"==h[n].ColumnDataType.toString().toLowerCase()&&h[n].CostCenterColID.toString()==this.grData.Table[l].FeatureFieldName.toString())if("BasicMonthly"==h[n].sysColumnName.toString())m=parseFloat(this.ExcelTable[a][this.grData.Table[l].FieldName.toString()]),o+=h[n].SysColumnName.toString()+"="+m+",",this.dblNetSalary=0,this.ExecuteFormulas(m,a,e);else if("Percentage"==h[n].sysColumnName.toString()){let g=0,T=0;if(this.dblPercentage>0){let I=b.d.document.GetDataSet('Select EmployeeID,SeqNo,Convert(DateTime,EffectFrom) EffectFrom,BasicMonthly From PAY_EmpPay WITH(NOLOCK) \n                            Where EmployeeID=" + EmpNode + @" AND SeqNo<>" + 0 + @"\n                            AND Convert(DateTime,EffectFrom)<=CONVERT(DATETIME,\'" + dtEffectFrom.toLocaleDateString("dd MMM yyyy") + "\') ORDER BY EffectFrom DESC');null!=I&&I.length>0&&(T=parseFloat(I.Rows[0].BasicMonthly.toString())),g=T*this.dblPercentage/100,T+=g,this.dblBasicMonthly=T,this.dblNetSalary=0,this.ExecuteFormulas(this.dblBasicMonthly,a,e)}}else"-1"!=h[n].UserDefaultValue.toString()&&(o+=h[n].SysColumnName.toString()+"="+this.ExcelTable[a][this.grData.Table[l].FieldName.toString()]+",")}if(this.IsUpdate){if(this.EditSeqNo>0){if(t+="UPDATE PAY_EmpPay SET EffectFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),ApplyFrom=CONVERT(INT,CONVERT(DATETIME, '",t+=this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy"),t+="')),NetSalary=",t+=this.dblNetSalary,t+=",BasicMonthly=",t+=this.dblBasicMonthly,t+=",AnnualCTC=",t+=this.dblAnnualCTC,t+=",Remarks='",t+=this.AppraisalRemarks.Append("'"),t+=",Reason='",t+=this.AppraisalReason.Append("'"),t+=",ModifiedBy='",t+=b.d.SessionManager.UserName,t+="'",t+=",ModifiedDate=CONVERT(FLOAT,GETDATE())",t+=this.dblPercentage>0?",Percentage="+this.dblPercentage:",Percentage=0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString()+"="+this.dtPayrollE[n].EarValue.toString);if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString()+"="+this.dtPayrollD[n].DedValue.toString);t+=" WHERE SeqNo="+this.EditSeqNo}}else{if(t+="INSERT INTO PAY_EmpPay(EmployeeID,EffectFrom,ApplyFrom,NetSalary,BasicMonthly,AnnualCTC,Remarks,Reason,CreatedBy,CreatedDate,ModifiedDate,Percentage",s+="VALUES("+e+",CONVERT(INT,CONVERT(DATETIME,'"+this.dtEffectFrom.toLocaleDateString("dd/MMM/yyyy")+"')),CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.toLocaleDateString("dd/MMM/yyyy")+"')),",s+=this.dblNetSalary,s+=","+this.dblBasicMonthly,s+=","+this.dblAnnualCTC,s+=",'"+this.AppraisalRemarks+"'",s+=",'"+this.AppraisalReason+"'",s+=",'"+b.d.SessionManager.UserName+"'",s+=",CONVERT(FLOAT,GETDATE())",s+=",CONVERT(FLOAT,GETDATE())",s+=this.dblPercentage>0?","+this.dblPercentage:",0",null!=this.dtPayrollE&&this.dtPayrollE.length>0)for(let n=0;n<this.dtPayrollE.length;n++)null!=this.dtPayrollE[n].EarSNo&&null!=this.dtPayrollE[n].EarSNo&&""!=this.dtPayrollE[n].EarSNo.toString()&&""!=this.dtPayrollE[n].EarValue.toString().Trim()&&(t+=",Earning"+this.dtPayrollE[n].EarSNo.toString(),s+=","+this.dtPayrollE[n].EarValue.toString());if(null!=this.dtPayrollD&&this.dtPayrollD.length>0)for(let n=0;n<this.dtPayrollD.length;n++)null!=this.dtPayrollD[n].DedSNo&&null!=this.dtPayrollD[n].DedSNo&&""!=this.dtPayrollD[n].DedSNo.toString()&&""!=this.dtPayrollD[n].DedValue.toString().Trim()&&(t+=",Deduction"+this.dtPayrollD[n].DedSNo.toString(),s+=","+this.dtPayrollD[n].DedValue.toString());t+=")"+s.toString()+")",new Date(this.dtNextAppraisalDate.toLocaleDateString("MMM yyyy"))>new Date(this.dtActAppraisalFrom.toLocaleDateString("MMM yyyy"))?t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtNextAppraisalDate.toLocaleString("dd/MMM/yyyy")+"')) WHERE NodeID="+e:t+=" UPDATE COM_CC50051 SET NextAppraisalDate=CONVERT(INT,CONVERT(DATETIME, '"+this.dtActAppraisalFrom.AddMonths(1).Date.toString()+"')) WHERE NodeID="+e}return Logger.InfoLog("ImportEmployeeAppraisal::Exiting GetEmpAppraisalXML which RETURN XML="+t),t.toString()}FillQtyRateCombo(){this.QtyRateVisible=!0,this.QtyCombo.Items.Clear(),this.RateCombo.Items.Clear(),this.QtyCombo.Items.push(te._p.ComboBoxItems_2("","")),this.RateCombo.Items.push(te._p.ComboBoxItems_2("",""));for(const e of this.ExcelTable)(e.DataType==typeof parseFloat||e.DataType==typeof parseInt)&&(this.QtyCombo.Items.push(te._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)),this.RateCombo.Items.push(te._p.ComboBoxItems_2(e.ColumnName,e.ColumnName)));this.RateCombo.Items.push(te._p.ComboBoxItems_2("AVGRATE","AVGRATE"))}CheckAvgRateexists(){let e=this.costCenterTableZero;if(this.IsQtyChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let i of this.grData.Table)if("GrossValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(this.ExcelTable.includes("QuantityValue")){this.ExcelTable.Remove("QuantityValue");for(let i of this.grData.Table)if("QuantityValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(null!=this.QtyText.Text&&""!=this.QtyText.Text){let i=0;if(i=N.J0.Int(this.QtyText.Text),!this.ExcelTable.some(r=>"QuantityValue"===r.columnName)&&i>0){let r={ColumnName:"QuantityValue",DataType:"number",DefaultValue:N.J0.Int(i)};if(this.ExcelTable.push(r),e=this.costCenterTableZero,e.filter(a=>"Quantity"==a.SysColumnName),!(e.length>0))return this.DisplayMessage="Quantity field doesnot exists",void(this.MessageVisibility=!0);{let a={FieldName:"QuantityValue"};a.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(a)}}}else if(null!=this.QtyCombo.SelectedValue&&""!=this.QtyCombo.SelectedValue&&!this.ExcelTable.includes("QuantityValue")){let i=0;if(i=N.J0.Int(this.QtyText.Text),this.ExcelTable.push({ColumnName:"QuantityValue",DataType:"number",Expression:this.QtyCombo.SelectedValue}),e.filter(a=>"Quantity"==a.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let a={FieldName:"QuantityValue"};a.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(a)}}}if(this.IsRateChecked){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let i of this.grData.Table)if("GrossValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(this.ExcelTable.includes("RateValue")){this.ExcelTable.Remove("RateValue");for(let i in this.grData.Table)if("RateValue"==i.FieldName.toString()){this.grData.Table.Remove(i);break}}if(null!=this.RateText.Text&&""!=this.RateText.Text){let i=0;if(i=parseFloat(this.RateText.Text),!this.ExcelTable.includes("RateValue")&&i>0){if(this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",ReadOnly:!1}),e=this.costCenterTableZero,e.filter(a=>"Quantity"==a.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let a={FieldName:"RateValue"};a.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(a)}}}else if("AVGRATE"==this.RateCombo.SelectedValue){let i;this.ExcelTable.includes("AVGRATE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),i={},i.FieldName="AVGRATE",i.FeatureFieldName="-27",this.grData.Table.push(i)),this.ExcelTable.includes("AVGRATEVALUE")||(this.ExcelTable.push({ColumnName:"AVGRATE",DataType:"number",DefaultValue:0}),i={},i.FieldName="AVGRATEVALUE",i.FeatureFieldName="-28",this.grData.Table.push(i))}else if(null!=this.RateCombo.SelectedValue&&""!=this.RateCombo.SelectedValue&&!this.ExcelTable.includes("RateValue")){let i=0;if(i=parseFloat(this.QtyText.Text),this.ExcelTable.push({ColumnName:"RateValue",DataType:"number",Expression:this.RateCombo.SelectedValue,ReadOnly:!1}),e.filter(a=>"Quantity"==a.SysColumnName),!(e.length>0))return this.DisplayMessage="Rate field doesnot exists",void(this.MessageVisibility=!0);{let a={FieldName:"RateValue"};a.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(a)}}}if(this.IsQtyChecked||this.IsRateChecked&&"AVGRATE"!=this.RateCombo.SelectedValue){if(this.ExcelTable.includes("GrossValue")){this.ExcelTable.Remove("GrossValue");for(let a of this.grData.Table)if("GrossValue"==a.FieldName.toString()){this.grData.Table.Remove(a);break}}let i,r;if(e.filter(a=>"Quantity"==a.SysColumnName),e.length>0){let a=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());a.length>0&&(i=a[0].FieldName.toString())}if(e.filter(a=>"Quantity"==a.SysColumnName),e.length>0){let a=this.grData.Table.filter(u=>u.FeatureFieldName==e[0].CostCenterColID.toString());a.length>0&&(r=a[0].FieldName.toString())}if(""!=r&&""!=i&&(this.ExcelTable.push({ColumnName:"GrossValue",DataType:"number",Expression:r*i,ReadOnly:!1}),e=this.costCenterTableZero,e.filter(u=>"Gross"==u.SysColumnName),e.length>0)){let u={FieldName:"GrossValue"};u.FeatureFieldName=e[0].CostCenterColID.toString(),this.grData.Table.push(u)}}}Importbackgroundprocess(){this.ExcelDataColumn.includes("IMPORT_STATUS")||this.ExcelDataColumn.push("IMPORT_STATUS"),this.ExcelDataColumn.includes("xIMP_STATUSx")||this.ExcelDataColumn.push("xIMP_STATUSx"),this.ExcelDataColumn.includes("IMPORT_MESSAGE")||this.ExcelDataColumn.push("IMPORT_MESSAGE"),this.ProgressVisbility=!0,this.ImportVisbility=!1,this.ProgressMax=this.ExcelTable.length,this.worker1_DoWork(),this.worker1_RunWorkerCompleted()}groupmethod(){var e=this;return(0,Fe.A)(function*(){for(let r of e.grData.Table){let a=e.costCenterTableZero;if(""!=r.FeatureFieldName.toString()){const u=a.filter(c=>c.CostCenterColID==r.FeatureFieldName.toString());if(u.length>0){let c=u[0].SysColumnName.toString();if("group"==c.toLowerCase()||"isgroup"==c.toLowerCase()||"parentid"==c.toLowerCase()){e.GroupExists=!0,e.tempfield=r.FieldName.toString();break}}}}let i;if(e.ProgressVisbility=!1,e.ImportVisbility=!0,e.DisplayMessage="Scanning of data is in process, please wait...",e.MessageVisibility=!0,e.GroupExists){e.IsExcel?(e.ExcelTable=[],e.dvMain=e.dsexcel):e.dvMain=e.ExcelTable;try{i=e.dvMain.filter(r=>"1"==r[e.tempfield]||"YES"==r[e.tempfield]),e.ExcelTable.length>0?e.GroupsImport=!0:i="",e.ExcelTable=e.dvMain,yield e.onPreviewDataClick(),e.DisplayMessage="",e.MessageVisibility=!1,e.GroupExists=!1,e.IsPreviewDataOk&&e.Importbackgroundprocess()}catch(r){return e.DisplayMessage=r.Message,Logger.ErrorLog(" Message: - "+r.stack),void(e.MessageVisibility=!0)}}else yield e.onPreviewDataClick(),e.IsPreviewDataOk&&(e.DisplayMessage="",e.MessageVisibility=!1,e.Importbackgroundprocess())})()}worker1_DoWork(){this.ExcelDataColumn.includes("IMPORT_STATUS")||this.ExcelDataColumn.push("IMPORT_STATUS"),this.ExcelDataColumn.includes("xIMP_STATUSx")||this.ExcelDataColumn.push("xIMP_STATUSx"),this.ExcelDataColumn.includes("IMPORT_MESSAGE")||this.ExcelDataColumn.push("IMPORT_MESSAGE"),"50051"==this.Feature.SelectedValue.toString()?"PAYROLL EMPLOYEE_APPRAISAL"==this.Feature.SelectedItem.Name.toString().toUpperCase()?this.ImportEmployeeAppraisal():this.ImportEmployeeData():this.ImportCosCenters()}worker1_RunWorkerCompleted(){if(this.ProgressVisbility=!1,this.ImportVisbility=!0,this.GroupExists){this.ClearVaraiables();try{this.ExcelTable=[],this.dvMain.filter(e=>"0"==e.tempfield||"NO"==e.tempfield),this.ExcelTable=this.dvMain,this.GroupsImport=!1,this.onPreviewDataClick(),this.DisplayMessage="",this.MessageVisibility=!1,this.GroupExists=!1,this.IsPreviewDataOk&&this.Importbackgroundprocess()}catch(e){return this.DisplayMessage=e.Message,Logger.ErrorLog(" Message: - "+e.stack),void(this.MessageVisibility=!0)}}}worker_RunWorkerCompleted(){if(Logger.InfoLog("Entered into  worker_RunWorkerCompleted()..."),this.ProgressVisbility=!1,this.ImportVisbility=!0,parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4){if(this.isCreditRowAdded)for(let e of this.grData.Table)"CreditAccount"==e[0].toString()&&this.grData.Table.Remove(e);if(this.isDebitRowAdded)for(let e of this.grData.Table)if("DebitAccount"==e[0].toString()){this.grData.Table.Remove(e);break}this.isCreditRowAdded=!1,this.isDebitRowAdded=!1}Logger.InfoLog("Exit from worker_RunWorkerCompleted()...")}worker_DoWork(){if(Logger.InfoLog("Entered into  worker_DoWork()..."),Logger.InfoLog("ImportUtilityViewModel: entering worker_DoWork"),null!=this.Feature.SelectedValue&&""!=this.Feature.SelectedValue&&this.grData.Table.length>0)if(this.ExcelDataColumn.includes("IMPORT_STATUS")||this.ExcelDataColumn.push("IMPORT_STATUS"),this.ExcelDataColumn.includes("xIMP_STATUSx")||this.ExcelDataColumn.push("xIMP_STATUSx"),this.ExcelDataColumn.includes("IMPORT_MESSAGE")||this.ExcelDataColumn.push("IMPORT_MESSAGE"),-100==parseInt(this.Feature.SelectedValue))this.ImportAttachments();else if(2==parseInt(this.Feature.SelectedValue)&&"Account Dimension wise Cr/Dr Limits"==this.Feature.SelectedItem.Name)this.ImportAccountDimwiseCrDrLimits();else if(2==parseInt(this.Feature.SelectedValue)&&"Account Report Template"==this.Feature.SelectedItem.Name)this.ImportAccountReportTemplate();else if(2==parseInt(this.Feature.SelectedValue)&&"Account Contacts"==this.Feature.SelectedItem.Name)this.ImportAccountContacts();else if(2==parseInt(this.Feature.SelectedValue)&&"Account Address"==this.Feature.SelectedItem.Name)this.ImportAccountAddress();else if(3==parseInt(this.Feature.SelectedValue)&&"Services to Dimension"==this.Feature.SelectedItem.Name)this.ImportServicestoDimension();else if(3==parseInt(this.Feature.SelectedValue)&&"Products With Multiple UOM"==this.Feature.SelectedItem.Name)this.ImportProductwiseMultipleUOM();else if(3==parseInt(this.Feature.SelectedValue)&&"Products With Multiple UOM Barcode"==this.Feature.SelectedItem.Name)this.ImportProductwiseMultipleUOMBarcode();else if(3==parseInt(this.Feature.SelectedValue)&&"Products With Vendor Multiple Barcode"==this.Feature.SelectedItem.Name)this.ImportProductwiseVendorMultipleBarcode();else if(3==parseInt(this.Feature.SelectedValue)&&"PRODUCTS WISE BINS"==this.Feature.SelectedItem.Name.toUpperCase())this.ImportProductWiseBins();else if(3==parseInt(this.Feature.SelectedValue)&&"PRODUCTS WITH SUBSTITUTES"==this.Feature.SelectedItem.Name.toUpperCase())this.ImportProductWithSubstitues();else if(3==parseInt(this.Feature.SelectedValue)&&"KIT PRODUCTS"==this.Feature.SelectedItem.Name.toUpperCase())this.ImportKitProducts();else if(3==parseInt(this.Feature.SelectedValue)&&"Product QC"==this.Feature.SelectedItem.Name)this.ImportQCProducts();else if(7==parseInt(this.Feature.SelectedValue))this.ImportUsers();else if(10==parseInt(this.Feature.SelectedValue))this.ImportCrossDimension();else if(8==parseInt(this.Feature.SelectedValue)&&"Dimension Move"==this.Feature.SelectedItem.Name)this.ImportDimensionMove();else if(11==parseInt(this.Feature.SelectedValue))this.ImportUOM();else if(16==parseInt(this.Feature.SelectedValue))this.ImportBatches();else if(40==parseInt(this.Feature.SelectedValue)&&"Dimension Wise Price Chart"==this.Feature.SelectedItem.Name)this.ImportDimensionWisePriceChart();else if(40==parseInt(this.Feature.SelectedValue))this.ImportPriceChart();else if(44==parseInt(this.Feature.SelectedValue))this.ImportLookUps();else if(45==parseInt(this.Feature.SelectedValue))this.ImportTaxChart();else if(72==parseInt(this.Feature.SelectedValue))this.ImportAssets();else if(73==parseInt(this.Feature.SelectedValue))this.ImportCases();else if(74==parseInt(this.Feature.SelectedValue)||75==parseInt(this.Feature.SelectedValue)||77==parseInt(this.Feature.SelectedValue))this.ImportAssetMaster(parseInt(this.Feature.SelectedValue));else if(76==parseInt(this.Feature.SelectedValue)&&"Bill Of Materials With Multiple Stage"==this.Feature.SelectedItem.Name)this.ImportMultipleStageBoms();else if(76==parseInt(this.Feature.SelectedValue))this.ImportBoms();else if(93==parseInt(this.Feature.SelectedValue)&&"Unit Rates"==this.Feature.SelectedItem.Name)this.ImportUnitRates();else if(83==parseInt(this.Feature.SelectedValue)&&"CRM Customer With Address"==this.Feature.SelectedItem.Name)this.ImportCRMCustomers(!0);else if(83==parseInt(this.Feature.SelectedValue)&&"CRM Customer With Contacts"==this.Feature.SelectedItem.Name)this.ImportCRMCustomers(!1);else if(86==parseInt(this.Feature.SelectedValue))this.ImportLeads();else if(!(92==parseInt(this.Feature.SelectedValue)&&"Property Particulars"==this.Feature.SelectedItem.Name||93==parseInt(this.Feature.SelectedValue)&&"Unit Particulars"==this.Feature.SelectedItem.Name)&&"Particulars Import"!=this.Feature.SelectedItem.Name&&92!=parseInt(this.Feature.SelectedValue)&&93!=parseInt(this.Feature.SelectedValue)&&94!=parseInt(this.Feature.SelectedValue)&&95!=parseInt(this.Feature.SelectedValue))if(101==parseInt(this.Feature.SelectedValue))this.ImportBudget();else if(110!=parseInt(this.Feature.SelectedValue)||"PAYROLL EMPLOYEE_ADDRESS"!=this.Feature.SelectedItem.Name.toUpperCase())if(114==parseInt(this.Feature.SelectedValue))this.ImportFollowUps();else if(115==parseInt(this.Feature.SelectedValue))this.ImportLeadsWithProduct();else if(151==parseInt(this.Feature.SelectedValue)&&"Schemes & Discounts BasedOn Unique Dimension"==this.Feature.SelectedItem.Name)this.ImportSchemesDiscountsBasedOnUniqueDimension();else if(151==parseInt(this.Feature.SelectedValue))this.ImportSchemesDiscounts();else if(153==parseInt(this.Feature.SelectedValue))this.ImportDimensionMapping();else if(parseInt(this.Feature.SelectedValue)>=251&&parseInt(this.Feature.SelectedValue)<=255)this.ImportEmployeeDocuments();else if(400!=parseInt(this.Feature.SelectedValue)||"Document Edit"!=this.Feature.SelectedItem.Name)if(40054==parseInt(this.Feature.SelectedValue))this.ImportMonthlyPayroll();else if(parseInt(this.Feature.SelectedValue)>4e4&&parseInt(this.Feature.SelectedValue)<5e4)this.ImportDocument();else if(parseInt(this.Feature.SelectedValue)>6e4)this.ImportLookUps();else if("Job Output"==this.Feature.SelectedItem.Name)this.ImportJobOutput();else{this.GroupExists=!1,this.tempfield="";for(let t of this.grData.Table){let s=this.costCenterTableZero;if(""!=t.FeatureFieldName.toString()){let o=s.filter(m=>m.CostCenterColID==t.FeatureFieldName.toString());if(o.length>0){let m=o[0].SysColumnName.toString();if("group"==m.toLowerCase()||"isgroup"==m.toLowerCase()||"parentid"==m.toLowerCase()){this.GroupExists=!0,this.tempfield=t.FieldName.toString();break}}}}if(this.GroupExists){let t,s,o;this.IsExcel?(this.ExcelTable=[],t=this.dsexcel[0]):t=this.ExcelTable;try{s=t.filter(m=>"1"==m[this.tempfield]||"YES"==m[this.tempfield]),this.ExcelTable.length>0&&(this.GroupsImport=!0,this.ImportCosCenters())}catch(m){return this.DisplayMessage=m.Message,Logger.ErrorLog(" Message: - "+m.stack),void(this.MessageVisibility=!0)}this.ClearVaraiables();try{this.ExcelTable=[],o=t.filter(m=>"0"==m[this.tempfield]||"NO"==m[this.tempfield]),this.ExcelTable=t.ToTable(),this.GroupsImport=!1,this.ImportCosCenters()}catch(m){return this.DisplayMessage=m.Message,Logger.ErrorLog(" Message: - "+m.stack),void(this.MessageVisibility=!0)}}else this.ImportCosCenters()}this.UpdateStatusInExcel&&this.UpdateExcelSheet(),Logger.InfoLog("ImportUtilityViewModel: exiting worker_DoWork")}ImportMonthlyPayroll(){}ImportAccountDimwiseCrDrLimits(){let e=this.costCenterTableZero,i=0,r="",a="",u="",c=[],t=[];t=this.ExcelTable;let s="";this.ScanServiceDimensionFields(!1);let o="",m="",h=this.grData.Table;if(h.filter(n=>"238"==n.FeatureFieldName),h.length>0&&(o=h[0].FieldName.toString()),h.filter(n=>"239"==n.FeatureFieldName),h.length>0&&(m=h[0].FieldName.toString()),this.IsCode&&""==o)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][o].toString()&&(s=this.ExcelTable[n][o].toString(),t.filter(l=>l.strCodeColumn==s)):""!=this.ExcelTable[n][m].toString()&&(s=this.ExcelTable[n][m].toString(),t.filter(l=>l.strNameColumn==s)),0==c.filter(l=>l.Name.toUpperCase()==s.toUpperCase()).length){for(let S=0;S<t.length;S++){u+="<Row ",u+=' Sno="'+S+'1" ';for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[I].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"CCNID2":u+=" LocationID ='"+t[S][this.grData.Table[I].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CCNID1":u+=" DivisionID ='"+t[S][this.grData.Table[I].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Dimension":u+=" DimensionID ='"+t[S][this.grData.Table[I].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"Currency":u+=" CurrencyID ='"+t[S][this.grData.Table[I].FieldName.toString()+"_Key"].toString().Trim()+"'  ";break;case"CreditDays":u+=" CreditDays ='"+t[S][this.grData.Table[I].FieldName.toString().Trim()]+"'  ";break;case"CreditLimit":u+=" Credit ='"+t[S][this.grData.Table[I].FieldName.toString().Trim()]+"'  ";break;case"DebitDays":u+=" DebitDays ='"+t[S][this.grData.Table[I].FieldName.toString().Trim()]+"'  ";break;case"DebitLimit":u+=" Debit ='"+t[S][this.grData.Table[I].FieldName.toString().Trim()]+"'  ";break;case"AccountCode":0==S&&(r=t[S][this.grData.Table[I].FieldName.toString().Trim()],this.IsCode&&c.push(te._p.ComboBoxItems_1(r)));break;case"AccountName":0==S&&(a=t[S][this.grData.Table[I].FieldName.toString().Trim()],this.IsCode||c.push(te._p.ComboBoxItems_1(a)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let l,g,T=[];T.push(u.toString()),T.push(a),T.push(r),T.push(this.IsCode),T.push(b.d.SessionManager.CompanyGUID),T.push(b.d.SessionManager.UserName),T.push(b.d.SessionManager.UserID),T.push(b.d.SessionManager.LanguageID),g=b.d.document.SetImportDataToAccLocDivLimits(T),l=g,g<=0&&(i++,this.FailedRecourdList.push({Name:" Account  Name : "+s,Message:l})),u="",this.ImportedCount="Imported :"+(n+t.length-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountReportTemplate(){let e=this.costCenterTableZero,i=null;this.CostCenterFieldsAllTables.length>1&&(i=this.CostCenterFieldsAllTables[1]);let r=0,a="",u="",c="",t=[],s=[];s=this.ExcelTable;let o="",m="",h="",n=this.grData.Table;if(n.filter(l=>"238"==l.FeatureFieldName),n.length>0&&(m=n[0].FieldName.toString()),n.filter(l=>"239"==l.FeatureFieldName),n.length>0&&(h=n[0].FieldName.toString()),this.grData.Table=n,this.IsCode&&""==m)return this.DisplayMessage="Please select account code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==h)return this.DisplayMessage="Please select account name field",void(this.MessageVisibility=!0);for(let l=0;l<this.ExcelTable.length;l++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[l][m].toString()&&(o=this.ExcelTable[l][m].toString(),s.filter(g=>g.strCodeColumn==U.Dw.GetValidXml(o))):""!=this.ExcelTable[l][h].toString()&&(o=this.ExcelTable[l][h].toString(),s.filter(g=>g.strNameColumn==U.Dw.GetValidXml(o))),0==t.filter(g=>g.Name.toUpperCase()==o.toUpperCase()).length){for(let I=0;I<s.length;I++){c+="<Row ",c+=' Sno="'+I+'1" ';let d=0;for(let y=0;y<this.grData.Table.length;y++){let f=null;if(null!=this.grData.Table[y].FeatureFieldName&&""!=this.grData.Table[y].FeatureFieldName.toString()&&(s.filter(D=>D.CostCenterColID==this.grData.Table[y].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"TemplateNodeID":if(f=i.Select(null==i||this.IsCode?p=>p.Code==s[I][this.grData.Table[y].FieldName.toString()]&&1==p.Depth:p=>p.Name==s[I][this.grData.Table[y].FieldName.toString()]&&1==p.Depth),!(f.length>0))return this.DisplayMessage="Only Level 1 groups are allowed at Row "+(I+1),void(this.MessageVisibility=!0);c+=' TemplateNodeID ="'+f[0].NodeID.toString()+'"',d=parseInt(f[0].NodeID.toString());break;case"DrNodeID":if(f=i.Select(" NodeID='"+d+"'"),!(f.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(I+1),void(this.MessageVisibility=!0);{let p=0,F=0;if(p=parseInt(f[0].lft.toString()),F=parseInt(f[0].rgt.toString()),f=i.Select(this.IsCode?"Code ='"+s[I][this.grData.Table[y].FieldName.toString()]+"' and lft>='"+p+"'  and rgt<='"+F+"'":"Name ='"+s[I][this.grData.Table[y].FieldName.toString()]+"' and lft>='"+p+"'  and rgt<='"+F+"'"),!(f.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(I+1),void(this.MessageVisibility=!0);c+=' DrNodeID ="'+f[0].NodeID.toString()+'"'}break;case"CrNodeID":if(f=i.Select(" NodeID='"+d+"'"),!(f.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(I+1),void(this.MessageVisibility=!0);{let p=0,F=0;if(p=parseInt(f[0].lft.toString()),F=parseInt(f[0].rgt.toString()),f=i.Select(this.IsCode?"Code ='"+s[I][this.grData.Table[y].FieldName.toString()]+"' and lft>='"+p+"'  and rgt<='"+F+"'":"Name ='"+s[I][this.grData.Table[y].FieldName.toString()]+"' and lft>='"+p+"'  and rgt<='"+F+"'"),!(f.length>0))return this.DisplayMessage="Only selected groups of Template are allowed at Row "+(I+1),void(this.MessageVisibility=!0);c+=' CrNodeID ="'+f[0].NodeID.toString()+'"'}break;case"RTDate":{let p;if(p=""!=s[I][this.grData.Table[y].FieldName.toString().Trim()]&&N.J0.isValidDate(s[I][this.grData.Table[y].FieldName.toString().Trim()]),p)c+=' RTDate="'+new Date(p.Year,p.Month,1).toLocaleDateString("dd/MMM/yyyy")+'"';else if(""!=s[I][this.grData.Table[y].FieldName.toString().Trim()])return this.DisplayMessage="Invalid Date at Row "+(I+1),void(this.MessageVisibility=!0)}break;case"RTGroup":c+=' RTGroup="'+s[I][this.grData.Table[y].FieldName.toString()]+'"';break;case"AccountCode":0==I&&(a=s[I][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode&&t.push(te._p.ComboBoxItems_1(a)));break;case"AccountName":0==I&&(u=s[I][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode||t.push(te._p.ComboBoxItems_1(u)))}}c+="></Row>"}c.Insert(0,"<XML>"),c+="</XML>";let g,S,T=[];T.push(c.toString()),T.push(u),T.push(a),T.push(this.IsCode),T.push(b.d.SessionManager.CompanyGUID),T.push(b.d.SessionManager.UserName),T.push(b.d.SessionManager.UserID),T.push(b.d.SessionManager.LanguageID),S=b.d.document.SetImportDataToAccReportTemplate(T),S<=0&&(r++,this.FailedRecourdList.push({Name:" Account  Name : "+o,Message:g})),c="",this.ImportedCount="Imported :"+(l+s.length-r).toString(),this.FailedCount="Failed :"+r.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWiseBins(){let e=this.costCenterTableZero,i=0,r="",a="",u="",c=[],t=[];t=this.ExcelTable;let s="",o="",m="",h=this.grData.Table;if(h.filter(n=>"261"==n.FeatureFieldName),h.length>0&&(o=h[0].FieldName.toString()),h.filter(n=>"262"==n.FeatureFieldName),h.length>0&&(m=h[0].FieldName.toString()),this.IsCode&&""==o)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][o].toString()&&(s=this.ExcelTable[n][o].toString(),t.filter(l=>l.strPCodeColumn==s.replace("'","''"))):""!=this.ExcelTable[n][m].toString()&&(s=this.ExcelTable[n][m].toString(),t.filter(l=>l.strPNameColumn==s.replace("'","''"))),0==c.filter(l=>l.Name.toUpperCase()==s.toUpperCase()).length){for(let S=0;S<t.length;S++){u+="<Row ",u+=' Sno="'+S+'1" ';for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[I].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"BinDimension":u+=" Bin ='"+U.Dw.GetValidTextXml(t[S][this.grData.Table[I].FieldName.toString().Trim()])+"'  ";break;case"Capacity":u+=" Capacity ='"+t[S][this.grData.Table[I].FieldName.toString().Trim()]+"'  ";break;case"IsDefault":"true"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()||"yes"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()||"y"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()||"1"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()||"on"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="1" ':u+=e[0].SysColumnName.toString()+' ="0" ';break;case"StatusID":"in active"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()||"2"==t[S][this.grData.Table[I].FieldName.toString().Trim()].toLowerCase()?u+=e[0].SysColumnName.toString()+' ="2" ':u+=e[0].SysColumnName.toString()+' ="1" ';break;case"DimesionWiseBin":u+=" DimesionWiseBin ='"+U.Dw.GetValidTextXml(t[S][this.grData.Table[I].FieldName.toString().Trim()])+"'  ";break;case"ProductCode":0==S&&(r=t[S][this.grData.Table[I].FieldName.toString().Trim()],this.IsCode&&c.push(te._p.ComboBoxItems_1(r.replace("'","''"))));break;case"ProductName":0==S&&(a=t[S][this.grData.Table[I].FieldName.toString().Trim()],this.IsCode||c.push(te._p.ComboBoxItems_1(a.replace("'","''"))))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let l,T,g=[];g.push(u.toString()),g.push(a),g.push(r),g.push(this.IsCode),g.push(b.d.SessionManager.CompanyIndex),T=b.d.document.SetImportDataToProductBins(g),T<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+s,Message:l})),u="",this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductWithSubstitues(){let e=this.costCenterTableZero,i=0,r=0,a=0,u="",c="",t="",s="",o="",m=[],h=[];h=this.ExcelTable;let l="",g=this.grData.Table;g.filter(T=>"11386"==T.FeatureFieldName),g.length>0&&(s=g[0].FieldName.toString());for(let T=0;T<this.ExcelTable.length;T++,this.ProgressValue++)if(l=this.ExcelTable[a][s].toString(),h.filter(S=>S.strGroupColumn==l),0==m.filter(S=>S.Name.toUpperCase()==l.toUpperCase()).length){for(let f=0;f<h.length;f++){o+="<Row ";for(let D=0;D<this.grData.Table.length;D++)if(null!=this.grData.Table[D].FeatureFieldName&&""!=this.grData.Table[D].FeatureFieldName.toString()&&(e.filter(p=>p.CostCenterColID==this.grData.Table[D].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"SNO":o+=" SNO ='"+h[f][this.grData.Table[D].FieldName.toString().Trim()]+"'  ";break;case"ProductCode":0==f&&(u=h[f][this.grData.Table[D].FieldName.toString().Trim()],this.IsCode&&m.push(te._p.ComboBoxItems_1(u)));break;case"ProductName":0==f&&(c=h[f][this.grData.Table[D].FieldName.toString().Trim()],this.IsCode||m.push(te._p.ComboBoxItems_1(c)));break;case"SubstituteGroupName":t=h[f][this.grData.Table[D].FieldName.toString()];break;case"SubstituteProduct":o+=" SubProduct ='"+h[f][this.grData.Table[D].FieldName.toString().Trim()]+"'  "}o+=' ExRowNo="'+a+'" ></Row>',a+=1}o.Insert(0,"<SubstituteXML>"),o+="</SubstituteXML>",T=a;let I=[];I.push(c),I.push(u),I.push(t),I.push(o.toString()),I.push(this.IsCode),I.push(b.d.SessionManager.CompanyIndex);let y=b.d.document.SetImportDataToProductSubstitutes(I);if(null!=y&&y.Tables[0].length>0)for(let f=0;f<y.Tables[0].length;f++)"Success"==y.Tables[0][f].Status.toString()?(r++,this.ExcelTable[parseInt(y.Tables[0][f].ExRowNo)].xIMP_STATUSx="PASS",this.ExcelTable[parseInt(y.Tables[0][f].ExRowNo)].IMPORT_MESSAGE=y.Tables[0][f].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:y.Tables[0][f].SMessage.toString()})):"Fail"==y.Tables[0][f].Status.toString()&&(i++,this.ExcelTable[parseInt(y.Tables[0][f].ExRowNo)].xIMP_STATUSx="FAIL",this.ExcelTable[parseInt(y.Tables[0][f].ExRowNo)].IMPORT_MESSAGE=y.Tables[0][f].SMessage.toString(),this.FailedRecourdList.push({Name:" Product  Name : ",Message:y.Tables[0][f].SMessage.toString()}));o="",this.ImportedCount="Imported :"+r.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportKitProducts(){let e=this.costCenterTableZero,i=0,r="",a="",u="",c=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let s="",o="",m="",h=this.grData.Table;if(h.filter(n=>"261"==n.FeatureFieldName),h.length>0&&(o=h[0].FieldName.toString()),h.filter(n=>"262"==n.FeatureFieldName),h.length>0&&(m=h[0].FieldName.toString()),this.IsCode&&""==o)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[n][o].toString()&&(s=this.ExcelTable[n][o].toString(),t.filter(l=>l.strPCodeColumn==s)):""!=this.ExcelTable[n][m].toString()&&(s=this.ExcelTable[n][m].toString(),t.filter(l=>l.strGroupColumn==s)),0==c.filter(l=>l.Name.toUpperCase()==s.toUpperCase()).length){let l=!1;for(let I=0;I<t.length;I++){l=!1,u+="<Row ",u+=' RowNo="'+I+'1" ';for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(y=>y.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Kit_Product":if(""==t[I][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()||l)return this.DisplayMessage="Error Invalid Kit Product @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[I][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ",l=!0;break;case"Kit_Product_Code":if(""==t[I][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()||l)return this.DisplayMessage="Error Invalid Kit Product Code @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Product ='"+t[I][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+"'  ",l=!0;break;case"Kit_Qty":if(""==t[I][this.grData.Table[d].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit Qty @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Qty ='"+t[I][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"Kit_UOM":if(""==t[I][this.grData.Table[d].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);{let f=this.grData.Table.filter(p=>"-34"==p.FeatureFieldName),D=null;if(f.length>0?D=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[I][this.grData.Table[d].FieldName.toString().Trim()]+"' and ProductCode='"+this.ExcelTable[n][this.ExcelDataColumn.indexOf(f[0].FieldName.toString().Trim())]+"'"):(f=this.grData.Table.filter(p=>"-30"==p.FeatureFieldName),f.length>0&&(D=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[I][this.grData.Table[d].FieldName.toString().Trim()]+"' and ProductName='"+this.ExcelTable[n][this.ExcelDataColumn.indexOf(f[0].FieldName.toString().Trim())]+"'"))),(null==D||0==D.length)&&(D=this.CostCenterFieldsAllTables[4].Select("UnitName='"+t[I][this.grData.Table[d].FieldName.toString().Trim()]+"'  and (ProductName is null or ProductName='DynamicSet')")),!(D.length>0))return this.DisplayMessage="Error Invalid Kit UOM @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Unit ='"+D[0].UOMID.toString()+"'"}break;case"Kit_Rate":if(""==t[I][this.grData.Table[d].FieldName.toString().Trim()])return this.DisplayMessage="Error Invalid rate @ row "+(n+1),void(this.MessageVisibility=!0);u+=" Rate ='"+t[I][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"Kit_Link":""==t[I][this.grData.Table[d].FieldName.toString().Trim()]||"OPTIONAL"!=t[I][this.grData.Table[d].FieldName.toString().Trim()].toUpperCase()&&"O"!=t[I][this.grData.Table[d].FieldName.toString().Trim()]&&"1"!=t[I][this.grData.Table[d].FieldName.toString().Trim()]?""!=t[I][this.grData.Table[d].FieldName.toString().Trim()]&&("MANDATORY"==t[I][this.grData.Table[d].FieldName.toString().Trim()]||"M"==t[I][this.grData.Table[d].FieldName.toString().Trim()]||"2"==t[I][this.grData.Table[d].FieldName.toString().Trim()])&&(u+=" LINK ='2'"):u+=" LINK ='1'";break;case"ProductCode":0==I&&(r=t[I][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode&&c.push(te._p.ComboBoxItems_1(r)));break;case"ProductName":0==I&&(a=t[I][this.grData.Table[d].FieldName.toString().Trim()],this.IsCode||c.push(te._p.ComboBoxItems_1(a)))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let g,S,T=[];T.push(a),T.push(r),T.push(this.IsCode),T.push(b.d.SessionManager.CompanyIndex),S=b.d.document.SetImportKitProducts(T),S<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+s,Message:g})),u="",this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAttachments(){let e=this.costCenterTableZero,i=0,r=0,a="",u="";if(!this.ScanCostCenterFields(!1))return;let c="",t="",s=[],o=[];o=this.ExcelTable;let m="",h="",n="",l=this.grData.Table;if(l.filter(g=>"12"==g.FeatureFieldName),l.length>0&&(h=l[0].FieldName.toString()),l.filter(g=>"13"==g.FeatureFieldName),l.length>0&&(n=l[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(this.IsCode&&""==h)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==n)return this.DisplayMessage="Please select name field",void(this.MessageVisibility=!0);for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[g][h].toString()&&(m=this.ExcelTable[g][h].toString(),o.filter(T=>T.strPCodeColumn==m)):""!=this.ExcelTable[g][n].toString()&&(m=this.ExcelTable[g][n].toString(),o.filter(T=>T.strPNameColumn==m)),!s.Contains(m.toUpperCase())){for(let d=0;d<o.length;d++){c+='<Row Action="NEW" ';for(let y=0;y<this.grData.Table.length;y++)if(null!=this.grData.Table[y].FeatureFieldName&&""!=this.grData.Table[y].FeatureFieldName.toString()&&(e.filter(f=>f.CostCenterColID==this.grData.Table[y].FeatureFieldName.toString()),e.length>0)){let f=e[0].SysColumnName.toString();switch(f){case"Type":""!=o[d][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim()&&(c+=' Type ="'+o[d][this.grData.Table[y].FieldName.toString()+"_Key"].toString().Trim()+'"  ');break;case"IssueDate":case"Validtill":{let D;D=N.J0.isValidDate(o[d][this.grData.Table[y].FieldName.toString().Trim()]),D&&(c+=f+'="'+D.toLocaleDateString("dd/MMM/yyyy")+'" ');break}case"FileDescription":case"Remarks":case"DocNo":case"RefNo":c+=f+'="'+o[d][this.grData.Table[y].FieldName.toString().Trim()]+'"  ';break;case"stat":case"status":"active"==o[d][this.grData.Table[y].FieldName.toString().Trim()].toLowerCase()||"1"==o[d][this.grData.Table[y].FieldName.toString().Trim()]?c+='stat="1"  ':c+='stat="0"  ';break;case"FileName":break;case"Code":0==d&&(a=o[d][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode&&s.push(a.toUpperCase()));break;case"Name":0==d&&(u=o[d][this.grData.Table[y].FieldName.toString().Trim()],this.IsCode||s.push(u.toUpperCase()))}}c+="></Row>"}if(0==t.toString().length){t+="<Detxml ";for(let d=0;d<this.grData.Table.length;d++)null==this.grData.Table[d].FeatureFieldName||""==this.grData.Table[d].FeatureFieldName.toString()||(e.filter(y=>y.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),e.length>0&&"1"==e[0].IsUnique.toString()&&(t+=" "+e[0].SysColumnName.toString()+'="1" '+e[0].SysColumnName.toString()+'Text="'+e[0].ResourceData.toString()+'" '));t+="></Detxml>",c+=t.toString()}else c+=t.toString();c.Insert(0,"<AttachmentsXML>"),c+="</AttachmentsXML>";let T,I,S=[];S.push(c.toString()),S.push(this.QtyCombo.SelectedValue),S.push(u),S.push(a),S.push(this.IsCode),S.push(b.d.SessionManager.CompanyIndex),I=b.d.document.ImportAttachments(S),I>0?r++:I<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+m,Message:T})),c="",this.ImportedCount="Imported :"+r.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportQCProducts(){let e=this.costCenterTableZero,i=0,r="",a="",u="",c=[];if(!this.ScanCostCenterFields(!1))return;let t=[];t=this.ExcelTable;let s="",o="",m="",h=this.grData.Table;if(h.filter(l=>"261"==l.FeatureFieldName),h.length>0&&(o=h[0].FieldName.toString()),h.filter(l=>"262"==l.FeatureFieldName),h.length>0&&(m=h[0].FieldName.toString()),this.IsCode&&""==o)return this.DisplayMessage="Please select product code field",void(this.MessageVisibility=!0);if(!this.IsCode&&""==m)return this.DisplayMessage="Please select product name field",void(this.MessageVisibility=!0);for(let l=0;l<this.ExcelTable.length;l++,this.ProgressValue++)if(this.IsCode?""!=this.ExcelTable[l][o].toString()&&(s=this.ExcelTable[l][o].toString(),t.filter(g=>g.strPCodeColumn==s)):""!=this.ExcelTable[l][m].toString()&&(s=this.ExcelTable[l][m].toString(),t.filter(g=>g.strPNameColumn==s)),!c.includes(s.toUpperCase())){let g;for(let d=0;d<t.length;d++){u+="<Row ",u+=' RowNo="'+d+'1" ';let y=!1;for(let f=0;f<this.grData.Table.length;f++)if(null!=this.grData.Table[f].FeatureFieldName&&""!=this.grData.Table[f].FeatureFieldName.toString()&&(e.filter(D=>D.CostCenterColID==this.grData.Table[f].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"QC Name":case"QC Code":if(""==t[d][this.grData.Table[f].FieldName.toString()+"_Key"].toString().Trim())return this.DisplayMessage="Error Invalid Kit QC @ row "+(l+1),void(this.MessageVisibility=!0);y||(u+=" TestCaseID ='"+t[d][this.grData.Table[f].FieldName.toString()+"_Key"].toString().Trim()+"'  ",y=!0);break;case"Document":if(""!=t[d][this.grData.Table[f].FieldName.toString().Trim()]){var n=this.Feature.Items.firstOrDefault(p=>p.Name.toLowerCase()==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase());if(null==n)return this.DisplayMessage="Error Document @ row "+(l+1),void(this.MessageVisibility=!0);u+=" Document ='"+n+"'  "}break;case"Type":"numeric"==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase()?u+=" Type ='0' ":u+=" Type ='1' ";break;case"Min":parseFloat(t[d][this.grData.Table[f].FieldName.toString().Trim()])&&(u+=" Min ='"+g+"'  ");break;case"Max":parseFloat(t[d][this.grData.Table[f].FieldName.toString().Trim()])&&(u+=" Max ='"+g+"'  ");break;case"Probable val":u+=" Probableval ='"+t[d][this.grData.Table[f].FieldName.toString().Trim()]+"'  ";break;case"Sample":parseFloat(t[d][this.grData.Table[f].FieldName.toString().Trim()])&&(u+=" Sample ='"+g+"'  ");break;case"SampleType":"value"==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='0'  ":"number"==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='1'  ":"percentage value"==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase()?u+=" SampleType ='2'  ":"percentage number"==t[d][this.grData.Table[f].FieldName.toString().Trim()].toLowerCase()&&(u+=" SampleType ='3'  ");break;case"Observation":parseFloat(t[d][this.grData.Table[f].FieldName.toString().Trim()])&&(u+=" Observation ='"+g+"'  ");break;case"Varience":parseFloat(t[d][this.grData.Table[f].FieldName.toString().Trim()])&&(u+=" Varience ='"+g+"'  ");break;case"ProductCode":0==d&&(r=t[d][this.grData.Table[f].FieldName.toString().Trim()],this.IsCode&&c.push(r.toUpperCase()));break;case"ProductName":0==d&&(a=t[d][this.grData.Table[f].FieldName.toString().Trim()],this.IsCode||c.push(a.toUpperCase()))}u+="></Row>"}u.Insert(0,"<XML>"),u+="</XML>";let T,I,S=[];S.push(u.toString()),S.push(a),S.push(r),S.push(this.IsCode),S.push(b.d.SessionManager.CompanyIndex),I=b.d.document.ImportQCProducts(S),I<=0&&(i++,this.FailedRecourdList.push({Name:" Product  Name : "+s,Message:T})),u="",this.ImportedCount="Imported :"+(l+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ReturnMultipleAddress(e,i,r){let a=null,u=null,c=null,t="";for(let s=0;s<e.length;s++){let o;if(a="",u="",c="",o=this.grData.Table.filter(r?m=>"26707"==m.FeatureFieldName:m=>"24321"==m.FeatureFieldName),!r&&o.length>0&&""!=e[s][o[0][0].toString()]&&"Primary"==e[s][o[0][0].toString()]?t+='<Rows Action="NEW"':t+='<Row Action="NEW"',o.length>0)try{t+=r?' AddressTypeID="'+e[s][o[0][0].toString()]!=""&&"Address"==e[s][o[0][0].toString()]?"1":""!=e[s][o[0][0].toString()]&&"Billing"==e[s][o[0][0].toString()]?"2":""!=e[s][o[0][0].toString()]&&"Shipping"==e[s][o[0][0].toString()]?"3":'0"':' AddressTypeID="'+e[s][o[0][0].toString()]!=""&&"Primary"==e[s][o[0][0].toString()]?"1":""!=e[s][o[0][0].toString()]&&"Secondary"==e[s][o[0][0].toString()]?"2":'0"'}catch(m){Logger.ErrorLog("ReturnMultipleAddress, Error Message :"+m.Message)}else t+=' AddressTypeID="2"';for(let m=0;m<this.grData.Table.length;m++)null==this.grData.Table[m].FeatureFieldName||""==this.grData.Table[m].FeatureFieldName.toString()||(i.filter(h=>h.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),26707!=parseInt(this.grData.Table[m].FeatureFieldName)&&24321!=parseInt(this.grData.Table[m].FeatureFieldName)&&i.length>0&&(null!=this.lstAddressFields&&this.lstAddressFields.filter(h=>h==parseInt(this.grData.Table[m].FeatureFieldName)).length>0||null!=this.lstContactFields&&this.lstContactFields.filter(h=>h==parseInt(this.grData.Table[m].FeatureFieldName)).length>0)&&(i[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=i[0].SysColumnName.toString().replace("Contact_","")+"=N'"+U.Dw.GetValidXml(e[s][this.grData.Table[m].FieldName.toString().Trim()])+"',":this.lstAddressFields.length>0&&i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")||this.lstContactFields.length>0&&i[0].SysColumnName.toString().toUpperCase().startsWith("CONTACT_CCNID")?c+=i[0].SysColumnName.toString().replace("Contact_","")+"='"+e[s][this.grData.Table[m].FieldName.toString()+"_Key"].toString()+"',":a+=i[0].SysColumnName.toString().replace("Contact_","")+"=N'"+U.Dw.GetValidXml(e[s][this.grData.Table[m].FieldName.toString()])+"',"));t+=' StaticFields ="'+a.toString().Trim(",")+'" ',t+=' ExtraTextFields ="'+u.toString().Trim(",")+'" ',t+=' CCFields ="'+c.toString().Trim(",")+'" ',t+="/>"}return t.length>0&&(t.Insert(0,"<Data>"),t+="</Data>"),t.toString()}ValidateBudgetRow(e,i,r){this.DisplayMessage="";let a=null;if(i<=0)for(var u of(a=new Dt.zd(0,""),a.amount=r,this.ccdv))null!=(c=this.Feature.Items.filter(s=>s.Value==u.Key.toString()))&&e.includes(c.Name+"_Key")&&(e[c.Name+"_Key"].toString().length>0?a.addDimValue(e[c.Name+"_Key"].toString()):a.addDimValue("1"));else for(var u of(a=new Dt.zd,a.rowID=i,a.amount=r,this.ccdv)){var c;null!=(c=this.Feature.Items.filter(m=>m.Value==u.Key.toString()))&&e.includes(c.Name+"_Key")&&(e[c.Name+"_Key"].toString().length>0?a.addDimValue(e[c.Name+"_Key"].toString()):a.addDimValue(""))}if(this.budgetInput=[],this.budgetInput.push(this.inpRow),this.budgetInput=[],this.myBudget=new Dt.__(this.budgetTable,this.ccdv.length),this.DataCollection.Budgetid>0&&(i=this.myBudget.getDimensionRowId(i,this.inpRow)),i<=0){let s=[],o=this.myBudget.checkAddBudgetConflicts(this.inpRow,s,"");if(0!=o)return this.DisplayMessage="",this.inpRow.linkedDimRows="",this.inpRow.tempLinkedDimRows=0,this.DisplayMessage;{let m;if(this.budgetTable.length>0&&(m=this.budgetTable[this.budgetTable.length-1].RowID+1),o=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,s,m),0==o){this.myBudget.getTransactionLogSummary(s,this.strTransLog);let n=new Dt.zd(this.inpRow);n.rowID=m,this.budgetTable.push(n)}}}else{if(this.myBudget.checkEditBudgetConflicts(this.inpRow,"")>0)return this.DisplayMessage="",this.DisplayMessage;a=null,0==this.getDimensionRow(this.inpRow.rowID,a)&&this.assignDimRowValues(this.inpRow,a)}return this.DisplayMessage}getDimensionRow(e,i){for(let a=0;a<this.budgetTable.length;a++)if(this.budgetTable[a].rowID==e)return 0;return 1}assignDimRowValues(e,i){i.rowID=e.rowID,i.amount=e.amount,i.budgetUsed=e.budgetUsed,i.linkedDimRows=e.linkedDimRows,i.nAnys=e.nAnys,i.nAnysComputed=e.nAnysComputed,i.tempLinkedDimRows=e.tempLinkedDimRows,i.row.Clear();for(let r=0;r<e.row.length;r++)i.row.push(e.row[r])}ImportBudget(){let e=this.costCenterTableZero;this.DataCollection=new Pt.t;for(let T=0;T<this.ExcelTable.length;T++)for(let S of this.grData.Table)if(null!=S[1]&&""!=S[1].toString()&&"0"!=S[1].toString()&&(e.filter(I=>I.CostCenterColID==I[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)this.CheckCostCenterField(T,parseInt(e[0].ColumnCostCenterID.toString()),S.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){if("TOWER NAME"!=S.FieldName.toString().Trim().toUpperCase()&&"UNIT TYPE"!=S.FieldName.toString().Trim().toUpperCase()&&null!=this.ExcelTable[T][S.FieldName.toString()]&&""!=this.ExcelTable[T][S.FieldName.toString().Trim()]&&!N.J0.Int(this.ExcelTable[T][S.FieldName.toString().Trim()]))return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[T][S.FieldName.toString()]&&""!=this.ExcelTable[T][S.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[T][S.FieldName.toString().Trim()]))return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[T][S.FieldName.toString().Trim()]))return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0);let i=0;this.FillCostCenterFields(!1),this.DataCollection.CCList="",this.DataCollection.RelationsXML="";let u,r="",a=this.grData.Table.filter(T=>"23207"==T.FeatureFieldName);if(!(a.length>0))return void(this.DisplayMessage="Profile Name Not Selected");r=a[0].FieldName.toString(),u=this.toTableDistinct(this.ExcelTable,r);let c="",t=0,s="",o=[];o=this.ExcelTable;let m="",h=b.d.document.GetDataSet(" SELECT distinct(BudgetDefID),BudgetName FROM COM_BudgetDef WITH(NOLOCK) \n            SELECT DISTINCT BudgetDefID,CostCenterID,CCCodeTypeID FROM COM_BudgetDefDims WITH(NOLOCK) "),n=h.Tables[0],l=0;for(let T=0;T<u.length;T++){if(m=u[T][r].toString().Trim(),0==m.length||(o.filter(p=>p.strBudgetNameField==m),0==o.length))continue;this.DataCollection.BudgetName=m,n.filter(p=>p.BudgetName==m),this.DataCollection.Budgetid=n.length>0?parseInt(n[0].BudgetDefID):0;let S=[],I=1,d=1,y=0,f="";for(let p=0;p<o.length;p++){I=1,d=1,f="",y=0,s+='<Row Budget="0" ',s+=' Sno="'+p+'1" ';let F="",E=[];for(let L=0;L<this.grData.Table.length;L++)if(null!=this.grData.Table[L].FeatureFieldName&&""!=this.grData.Table[L].FeatureFieldName.toString()&&(e.filter(O=>O.CostCenterColID==this.grData.Table[L].FeatureFieldName.toString()),e.length>0))switch(c="",e[0].SysColumnName.toString()){case"AnnualAmount":c=o[p][this.grData.Table[L].FieldName.toString().Trim()],""!=c&&(t=parseFloat(c));break;case"Rate":c=o[p][this.grData.Table[L].FieldName.toString().Trim()],""!=c&&(y=parseFloat(c));break;case"BudgetCode":case"BudgetName":0==p&&(c=o[p][this.grData.Table[L].FieldName.toString().Trim()],E.push(te._p.ComboBoxItems_1(c)));break;case"FinYearStartDate":0==p&&(c=o[p][this.grData.Table[L].FieldName.toString().Trim()],this.DataCollection.StartYear=new Date(c));break;case"BudgetType":if(0==p){switch(c=o[p][this.grData.Table[L].FieldName.toString().Trim()],c.toUpperCase().split(" ")[0]){case"ANNAUL":this.BudgetType=0;break;case"HALFYEARLY":this.BudgetType=1;break;case"MONTHLY":this.BudgetType=3;break;case"QUATERLY":this.BudgetType=2}this.DataCollection.BudgetTypeID=this.BudgetType,this.DataCollection.BudgetType=c}break;case"CarryForward":f=o[p][this.grData.Table[L].FieldName.toString().Trim()],"monthly"==f.toLowerCase()?f="M":"half yearly"==f.toLowerCase()?f="H":"quarterly"==f.toLowerCase()?f="Q":"yearly"==f.toLowerCase()&&(f="Y");break;case"Currency":I=parseInt(o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString().Trim()),d=parseFloat(o[p].ExchangeRate.toString().Trim());break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&("2"==e[0].ColumnCostCenterID.toString()?(F+="AccountID ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"' ",s+="AccountID ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"'  "):"3"==e[0].ColumnCostCenterID.toString()?(F+="ProductID ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"' ",s+="ProductID ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"'  "):(F+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"' ",s+=" CC"+(parseInt(e[0].ColumnCostCenterID)-5e4)+" ='"+o[p][this.grData.Table[L].FieldName.toString()+"_Key"].toString()+"'  "))}if(S.Contains(F))return void(this.DisplayMessage="Duplicate Dimensions At Row No : "+(this.ExcelTable.indexOf(o[p].Row)+1));if(S.push(F),0==this.DataCollection.BudgetTypeID)s+=' Rate="'+y+'" ',s+=' AnnualAmount="'+t+'" ',s+=' YearH1Amount="'+t/2+'" ',s+=' YearH2Amount="'+t/2+'" ',s+=' Qtr1Amount="'+t/4+'" ',s+=' Qtr2Amount="'+t/4+'" ',s+=' Qtr3Amount="'+t/4+'" ',s+=' Qtr4Amount="'+t/4+'" ',s+=' Month1Amount="'+t/12+'" ',s+=' Month2Amount="'+t/12+'" ',s+=' Month3Amount="'+t/12+'" ',s+=' Month4Amount="'+t/12+'" ',s+=' Month5Amount="'+t/12+'" ',s+=' Month6Amount="'+t/12+'" ',s+=' Month7Amount="'+t/12+'" ',s+=' Month8Amount="'+t/12+'" ',s+=' Month9Amount="'+t/12+'" ',s+=' Month10Amount="'+t/12+'" ',s+=' Month11Amount="'+t/12+'" ',s+=' Month12Amount="'+t/12+'" ',s+=' CF="'+f+'" ',s+=' Currency="'+I+'" ',s+=' ExchangeRate="'+d+'" ';else if(1==this.DataCollection.BudgetTypeID){t=0;for(let L=0;L<this.grData.Table.length;L++)null==this.grData.Table[L].FeatureFieldName||""==this.grData.Table[L].FeatureFieldName.toString()||(e.filter(O=>O.CostCenterColID==this.grData.Table[L].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("YEARH")&&(s+=e[0].SysColumnName.toString()+' ="'+o[p][this.grData.Table[L].FieldName.toString().Trim()]+'" ',""!=o[p][this.grData.Table[L].FieldName.toString()]&&(t+=parseFloat(o[p][this.grData.Table[L].FieldName.toString()]))));s+=' Rate="'+y+'" ',s+=' AnnualAmount="'+t+'" ',s+=' Qtr1Amount="'+t/4+'" ',s+=' Qtr2Amount="'+t/4+'" ',s+=' Qtr3Amount="'+t/4+'" ',s+=' Qtr4Amount="'+t/4+'" ',s+=' Month1Amount="'+t/12+'" ',s+=' Month2Amount="'+t/12+'" ',s+=' Month3Amount="'+t/12+'" ',s+=' Month4Amount="'+t/12+'" ',s+=' Month5Amount="'+t/12+'" ',s+=' Month6Amount="'+t/12+'" ',s+=' Month7Amount="'+t/12+'" ',s+=' Month8Amount="'+t/12+'" ',s+=' Month9Amount="'+t/12+'" ',s+=' Month10Amount="'+t/12+'" ',s+=' Month11Amount="'+t/12+'" ',s+=' Month12Amount="'+t/12+'" ',s+=' CF="'+f+'" ',s+=' Currency="'+I+'" ',s+=' ExchangeRate="'+d+'" '}else if(2==this.DataCollection.BudgetTypeID){t=0;for(let L=0;L<this.grData.Table.length;L++)null==this.grData.Table[L].FeatureFieldName||""==this.grData.Table[L].FeatureFieldName.toString()||(e.filter(O=>O.CostCenterColID==this.grData.Table[L].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("QTR")&&(s+=e[0].SysColumnName.toString()+' ="'+o[p][this.grData.Table[L].FieldName.toString().Trim()]+'" ',""!=o[p][this.grData.Table[L].FieldName.toString()]&&(t+=parseFloat(o[p][this.grData.Table[L].FieldName.toString()]))));s+=' Rate="'+y+'" ',s+=' AnnualAmount="'+t+'" ',s+=' YearH1Amount="'+t/2+'" ',s+=' YearH2Amount="'+t/2+'" ',s+=' Month1Amount="'+t/12+'" ',s+=' Month2Amount="'+t/12+'" ',s+=' Month3Amount="'+t/12+'" ',s+=' Month4Amount="'+t/12+'" ',s+=' Month5Amount="'+t/12+'" ',s+=' Month6Amount="'+t/12+'" ',s+=' Month7Amount="'+t/12+'" ',s+=' Month8Amount="'+t/12+'" ',s+=' Month9Amount="'+t/12+'" ',s+=' Month10Amount="'+t/12+'" ',s+=' Month11Amount="'+t/12+'" ',s+=' Month12Amount="'+t/12+'" ',s+=' CF="'+f+'" ',s+=' Currency="'+I+'" ',s+=' ExchangeRate="'+d+'" '}else if(3==this.DataCollection.BudgetTypeID){t=0;for(let L=0;L<this.grData.Table.length;L++)null==this.grData.Table[L].FeatureFieldName||""==this.grData.Table[L].FeatureFieldName.toString()||(e.filter(O=>O.CostCenterColID==this.grData.Table[L].FeatureFieldName.toString()),e.length>0&&e[0].SysColumnName.toString().toUpperCase().Contains("MONTH")&&(s+=e[0].SysColumnName.toString()+' ="'+o[p][this.grData.Table[L].FieldName.toString().Trim()]+'" ',""!=o[p][this.grData.Table[L].FieldName.toString()]&&(t+=parseFloat(o[p][this.grData.Table[L].FieldName.toString()]))));s+=' Rate="'+y+'" ',s+=' AnnualAmount="'+t+'" ',s+=' YearH1Amount="'+t/2+'" ',s+=' YearH2Amount="'+t/2+'" ',s+=' Qtr1Amount="'+t/4+'" ',s+=' Qtr2Amount="'+t/4+'" ',s+=' Qtr3Amount="'+t/4+'" ',s+=' Qtr4Amount="'+t/4+'" ',s+=' CF="'+f+'" ',s+=' Currency="'+I+'" ',s+=' ExchangeRate="'+d+'" '}if(s+="></Row>",!this.IsUpdate&&this.DataCollection.Budgetid>0)return this.DisplayMessage="Duplicate Budget Name ="+this.DataCollection.BudgetName,void(this.MessageVisibility=!0);if(this.DisplayMessage=this.ValidateBudgetRow(o[p].Row,0,t),null==this.DisplayMessage&&(this.DisplayMessage=""),this.DisplayMessage.length>0)return void(this.MessageVisibility=!0)}if(this.DataCollection.Status=1,s.Insert(0,"<XML>"),s+="</XML>",this.DataCollection.SbXML=s.toString(),null!=this.ccdv)for(var g of this.ccdv){this.DataCollection.NumDimensions++;let p=h.Tables[1].Select("CostCenterID="+g.Key+" and BudgetDefID="+this.DataCollection.Budgetid);this.DataCollection.CCList+='<Row CC="'+g.Key+'" CCCodeTypeID="'+(null!=p&&p.length>0&&!N.J0.IsEmpty(p[0].CCCodeTypeID.toString())?p[0].CCCodeTypeID.toString():"0")+'"/>'}this.DataCollection.CCList.length>0&&(this.DataCollection.CCList="<XML>"+this.DataCollection.CCList+"</XML>"),this.DataCollection.RelationsXML=s.toString(),this.DataCollection.SelectedNodeID=1;let D=0;this.DataCollection.IsAppend=this.AppendData,this.DisplayMessage=this.DataCollection.SetImportBudget(),D<=0&&(i++,this.FailedRecourdList.push({Name:" Budget  Name : "+m,Message:this.DisplayMessage})),s="",l+=o.length,this.ImportedCount="Imported :"+(T+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+"(Rows), "+u.length+"(Profiles) "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}static ReturnAnnaulAmount(e,i){}ImportAccountContacts(){let e=this.costCenterTableZero;for(let o=0;o<this.ExcelTable.length;o++)for(let m of this.grData.Table)if(null!=m[1]&&""!=m[1].toString()&&"0"!=m[1].toString()&&(e.filter(h=>h.CostCenterColID==h[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(o,parseInt(e[0].ColumnCCListViewTypeID.toString()),m.FieldName.toString()):this.CheckCostCenterField(o,parseInt(e[0].ColumnCostCenterID.toString()),m.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){if(null!=this.ExcelTable[o][m.FieldName.toString()]&&""!=this.ExcelTable[o][m.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][m.FieldName.toString().Trim()]))return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[o][m.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let h;if(h=null!=this.ExcelTable[o][m.FieldName.toString()]&&""!=this.ExcelTable[o][m.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[o][m.FieldName.toString().Trim()]),h)return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[o][m.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[o][m.FieldName.toString().Trim()]))return this.DisplayMessage=m.FieldName.toString()+" "+this.ExcelTable[o][m.FieldName.toString().Trim()]+" at Row "+(o+1).toString(),void(this.MessageVisibility=!0);let i=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let r="",a="",u="",c="",t=0,s=2;for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){r="",a="",u="",t=0,s=2,c="";for(let h=0;h<this.grData.Table.length;h++)if(null!=this.grData.Table[h].FeatureFieldName&&""!=this.grData.Table[h].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[h].FeatureFieldName.toString()),e.length>0)){let n=e[0].SysColumnName.toString();switch(n){case"ContactTypeID":case"AddressTypeID":s="primary"==this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()].toLowerCase()?1:2;break;case"FeaturePK":null!=this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"]&&""!=this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString()&&(t=parseInt(this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString().Trim()));break;case"Status":"in active"==this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()].toLowerCase()?a+=n+" =404, ":a+=n+" =403, ";break;case"FirstName":c=U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()]),a+=n+" =N'"+c+"', ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" ='"+this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"', ":a+=n+" ='"+this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?r+=n+" ='"+this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"', ":a+=n+" ='"+this.ExcelTable[o][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?u+=n+" =N'"+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()]?a+=n+" ='0', ":a+=n+" =N'"+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[h].FieldName.toString().Trim()])+"', "}}let m;if(t>0){let h=[];h.push(parseInt(this.Feature.SelectedValue)),h.push(t),h.push(s),h.push(a),h.push(u),h.push(r),h.push(b.d.SessionManager.UserName),h.push(b.d.SessionManager.UserID),h.push(b.d.SessionManager.RoleID),h.push(b.d.SessionManager.LanguageID),m=b.d.document.SetImportContracts(h),m<=0&&(i++,this.FailedRecourdList.push({Name:"Name : "+c,Message:m}))}else i++,this.FailedRecourdList.push({Name:"Name : "+c,Message:"Account not found"});this.ImportedCount="Imported :"+(o+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAccountAddress(){let e=this.costCenterTableZero,i="",r="";for(let n=0;n<this.ExcelTable.length;n++)for(let l of this.grData.Table)if(null!=l[1]&&""!=l[1].toString()&&"0"!=l[1].toString()&&(e.filter(g=>g.CostCenterColID==g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),l.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),l.FieldName.toString(),!1,this.IsCode);else if((e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase())&&"ContactTypeID"!=e[0].SysColumnName.toString()){let g;if(g=null!=this.ExcelTable[n][l.FieldName.toString()]&&""!=this.ExcelTable[n][l.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][l.FieldName.toString().Trim()]),g)return this.DisplayMessage=l.FieldName.toString()+" "+this.ExcelTable[n][l.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}let a=0,u=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let c="",t="",s="",o="",m=0,h=1;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++){c="",t="",s="",m=0,h=1,o="";for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(I=>I.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0)){let I=e[0].SysColumnName.toString();switch(I){case"AddressTypeID":h="address"==this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?1:"billing"==this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()].toLowerCase()?2:3;break;case"AccountCode":null!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(i=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()]);break;case"AccountName":null!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&""!=this.ExcelTable[n][this.grData.Table[S].FieldName.toString()]&&(r=this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()]);break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?s+=I+" ='"+this.ExcelTable[n][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":t+=I+" ='"+this.ExcelTable[n][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?c+=I+" ='"+this.ExcelTable[n][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":t+=I+" ='"+this.ExcelTable[n][this.grData.Table[S].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?s+=I+" =N'"+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()]?t+=I+" ='0', ":t+=I+" =N'"+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[S].FieldName.toString().Trim()])+"', "}}let l,g=[];g.push(parseInt(i)),g.push(r),g.push(h),g.push(t),g.push(s),g.push(c),g.push(this.IsCode),g.push(b.d.SessionManager.UserName),g.push(b.d.SessionManager.UserID),g.push(b.d.SessionManager.RoleID),g.push(b.d.SessionManager.LanguageID),l=b.d.document.SetImportAddress(g),l<=0?(a++,this.FailedRecourdList.push({Name:"Name : "+o,Message:l}),this.ExcelTable[n].xIMP_STATUSx="FAIL",this.ExcelTable[n].IMPORT_MESSAGE=l):(u++,this.FailedRecourdList.push({Name:"Name : "+o,Message:l}),this.ExcelTable[n].xIMP_STATUSx="PASS",this.ExcelTable[n].IMPORT_MESSAGE=l),this.ImportedCount="Imported :"+u.toString(),this.FailedCount="Failed :"+a.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportDimensionMove(){let e;if(e=this.grData.Table.filter(n=>"-1"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Grop Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-2"==n.FeatureFieldName),1!=e.length)return this.DisplayMessage="Node Field Not Found",void(this.MessageVisibility=!0);if(e=this.grData.Table.filter(n=>"-3"==n.FeatureFieldName||"-4"==n.FeatureFieldName),!(e.length>0))return this.DisplayMessage="Dimension Field Not Found",void(this.MessageVisibility=!0);let r,a,u,c,t,s,o,i=0,m=new Kt.d,h=this.costCenterTableZero;for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&"-4"!=this.grData.Table[n].FeatureFieldName.toString()&&(this.ExcelTable.includes(this.grData.Table[n].FieldName.toString()+"_Key")||this.ExcelTable.push(this.grData.Table[n].FieldName.toString()+"_Key"),"-3"==this.grData.Table[n].FeatureFieldName.toString()&&this.grData.Table.filter(l=>"-4"==l.FeatureFieldName).length>0))for(let l=0;l<this.ExcelTable.length;l++)this.ExcelTable[l][this.grData.Table[n].FieldName.toString()+"_Key"]=this.ExcelTable[l][this.grData.Table.filter(g=>"-4"==g.FeatureFieldName)[0].FieldName.toString()];for(let n=0;n<this.ExcelTable.length;n++){r=a=u=c=0,o=s=t="";for(let l=0;l<this.grData.Table.length;l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&(h.filter(g=>g.CostCenterColID==this.grData.Table[l].FeatureFieldName.toString()),h.length>0))switch(t=h[0].SysColumnName.toString(),t){case"DimensionID":r=parseInt(this.ExcelTable[n][this.grData.Table[l].FieldName.toString()]);break;case"DimensionName":""==this.ExcelTable[n][this.grData.Table[l].FieldName.toString()+"_Key"].toString()&&this.CheckCostCenterField(n,5,this.grData.Table[l].FieldName.toString(),!1,this.IsCode),r=parseInt(this.ExcelTable[n][this.grData.Table[l].FieldName.toString()+"_Key"].toString());break;case"Node":this.CheckCostCenterField(n,parseInt(r),this.grData.Table[l].FieldName.toString(),!1,this.IsCode),o=this.ExcelTable[n][this.grData.Table[l].FieldName.toString().Trim()],a=parseInt(this.ExcelTable[n][this.grData.Table[l].FieldName.toString()+"_Key"].toString());break;case"Group":this.CheckCostCenterField(n,parseInt(r),this.grData.Table[l].FieldName.toString(),!1,this.IsCode),s=this.ExcelTable[n][this.grData.Table[l].FieldName.toString()],u=parseInt(this.ExcelTable[n][this.grData.Table[l].FieldName.toString()+"_Key"].toString())}t=m.MoveCostCenter(r,a.toString(),u,0),i++,this.FailedRecourdList.push({Name:"Node : "+o+" ; Group : "+s,Message:t}),this.ImportedCount="Imported :"+(n+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProperty(){let e=this.costCenterTableZero;for(let m=0;m<this.ExcelTable.length;m++)for(let h of this.grData.Table){this.ExcelDataColumn.indexOf(h.FieldName);const l=h.FeatureFieldName;if(null==l||""==l.toString()||"0"==l.toString())continue;let g=e.filter(T=>T.CostCenterColID==l.toString());if(g.length>0)if(null!=g[0].ColumnCostCenterID&&""!=g[0].ColumnCostCenterID.toString()&&parseInt(g[0].ColumnCostCenterID.toString())>0)44==parseInt(g[0].ColumnCostCenterID)?this.CheckLookupField(m,parseInt(g[0].ColumnCCListViewTypeID.toString()),h.FieldName.toString()):this.CheckCostCenterField(m,parseInt(g[0].ColumnCostCenterID.toString()),h.FieldName.toString(),!1,this.IsCode);else if("int"!=g[0].ColumnDataType.toString().toLowerCase()&&"bigint"!=g[0].ColumnDataType.toString().toLowerCase()||"IsGroup"==g[0].SysColumnName.toString()){if("float"==g[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[m][h.FieldName.toString()]&&""!=this.ExcelTable[m][h.FieldName.toString()].toString().Trim()&&!parseFloat(this.ExcelTable[m][h.FieldName.toString()].toString().Trim()))return this.DisplayMessage=h.FieldName.toString()+" "+this.ExcelTable[m][h.FieldName.toString()].toString().Trim()+" at Row "+(m+1).toString(),void(this.MessageVisibility=!0)}else if("datetime"==g[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[m][h.FieldName.toString()].toString().Trim()))return this.DisplayMessage=h.FieldName.toString()+" "+this.ExcelTable[m][h.FieldName.toString()].toString().Trim()+" at Row "+(m+1).toString(),void(this.MessageVisibility=!0)}else if(null!=this.ExcelTable[m][h.FieldName.toString()]&&""!=this.ExcelTable[m][h.FieldName.toString()].toString().Trim()&&!parseFloat(this.ExcelTable[m][h.FieldName.toString()].toString().Trim()))return this.DisplayMessage=h.FieldName.toString()+" "+this.ExcelTable[m][h.FieldName.toString()].toString().Trim()+" at Row "+(m+1).toString(),void(this.MessageVisibility=!0)}let i=0;this.FillLookupFields(),this.FillCostCenterFields(!1);let r="",a="",u="",c="",t="",s="",o="";this.CCNodeDet.Clear();for(let m=0;m<this.ExcelTable.length;m++,this.ProgressValue++){u="",c="",t="",r="",a="",s+="<Row ";for(let g=0;g<this.grData.Table.length;g++){if(null==this.grData.Table[g].FeatureFieldName||""==this.grData.Table[g].FeatureFieldName.toString())continue;let T=e.filter(S=>S.CostCenterColID==this.grData.Table[g].FeatureFieldName.toString());if(T.length>0){let S=T[0].SysColumnName.toString();switch(S){case"Code":r=this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim();break;case"Name":a=this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim();break;case"StatusID":"in active"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim().toLowerCase()?s+=S+' ="423" ':s+=S+' ="422" ';break;case"IsGroup":"true"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim().toLowerCase()||"yes"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim().toLowerCase()||"y"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim().toLowerCase()||"1"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim()||"on"==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim().toLowerCase()?s+='IsGroup ="1" ':s+='IsGroup ="0" ';break;case"ParentID":s+=S+' ="'+U.Dw.GetValidXml(this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim())+'" ';break;default:null!=T[0].ColumnCostCenterID&&""!=T[0].ColumnCostCenterID.toString()&&parseInt(T[0].ColumnCostCenterID.toString())>0&&!S.Contains("Assigned_")?44==parseInt(T[0].ColumnCostCenterID.toString())||2==parseInt(T[0].ColumnCostCenterID.toString())?null!=T[0].IsColumnUserDefined&&""!=T[0].IsColumnUserDefined.toString()&&(0,K.yG0)(T[0].IsColumnUserDefined.toString())&&T[0].SysColumnName.toString().toLowerCase().Contains("alpha")?t+=S+" ='"+this.ExcelTable[m][this.grData.Table[g].FieldName.toString()+"_Key"].toString()+"', ":c+=S+" ='"+this.ExcelTable[m][this.grData.Table[g].FieldName.toString()+"_Key"].toString()+"', ":null!=T[0].IsColumnUserDefined&&""!=T[0].IsColumnUserDefined.toString()&&(0,K.yG0)(T[0].IsColumnUserDefined.toString())?u+=S+" ='"+this.ExcelTable[m][this.grData.Table[g].FieldName.toString()+"_Key"].toString()+"', ":c+=S+" ='"+this.ExcelTable[m][this.grData.Table[g].FieldName.toString()+"_Key"].toString()+"', ":S.Contains("Assigned_")||(null!=T[0].IsColumnUserDefined&&""!=T[0].IsColumnUserDefined.toString()&&(0,K.yG0)(T[0].IsColumnUserDefined.toString())&&T[0].SysColumnName.toString().toLowerCase().Contains("alpha")?t+=S+" =N'"+U.Dw.GetValidXml(this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim())+"', ":"float"==T[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim()?c+=S+" ='0', ":c+=S+" =N'"+U.Dw.GetValidXml(this.ExcelTable[m][this.grData.Table[g].FieldName.toString()].toString().Trim())+"', ")}T[0].SysColumnName.toString().startsWith("Assigned_")&&parseInt(T[0].ColumnCostCenterID)>0&&(this.CheckAssignedCostCenters(m,parseInt(T[0].ColumnCostCenterID),this.grData.Table[g].FieldName.toString(),this.IsCode),o+=this.ExcelTable[m][this.grData.Table[g].FieldName.toString()+"_Key"].toString())}}s+=" ></Row>";let h="";h+="<XML><Row ",""!=c&&(h+=' ExtraFields ="'+c+'" '),""!=t&&(h+=' ExtraUserDefinedFields ="'+t+'" '),""!=u&&(h+=' CostCenterFields ="'+u+'" '),h+=" ></Row></XML>",s.Replace("&","&amp;"),b.d.document.SetImportDataToProperty(s.toString(),h.toString(),"",this.Feature.SelectedValue,r,a,"",o.toString(),this.IsUpdate,this.IsCode)?.RetValue>0&&(i++,this.FailedRecourdList.push({Name:" Code : "+r+" ; Name : "+a,Message:void 0}),s="",o="",this.ImportedCount="Imported :"+(m+1-i).toString(),this.FailedCount="Failed :"+i.toString()),this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}}ImportLeadsWithProduct(){let e=this.costCenterTableZero,i=0,r="",a="",u="",c="",t="",s="",o="",m=[];if(!this.ExcelTable.includes("Company")&&!this.ExcelTable.includes("LeadCode"))return this.DisplayMessage="Company/LeadCode should present in excel",void(this.MessageVisibility=!0);for(let T=0;T<this.ExcelTable.length;T++)for(const S of this.grData.Table)if(null!=S[1]&&""!=S[1].toString()&&"0"!=S[1].toString()&&(e.filter(I=>I.CostCenterColID===I[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(T,parseInt(e[0].ColumnCCListViewTypeID.toString()),S.FieldName.toString()):this.CheckCostCenterField(T,parseInt(e[0].ColumnCostCenterID.toString()),S.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let I;if("25623"!=S.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=S.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=S.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=S.FeatureFieldName.toString().Trim().toUpperCase()&&(I=null!=this.ExcelTable[T][S.FieldName.toString()]&&""!=this.ExcelTable[T][S.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[T][S.FieldName.toString().Trim()]),I))return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let I;if(I=null!=this.ExcelTable[T][S.FieldName.toString()]&&""!=this.ExcelTable[T][S.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[T][S.FieldName.toString().Trim()]),I)return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let I;if(I=!N.J0.isValidDate(this.ExcelTable[T][S.FieldName.toString().Trim()]),I)return this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[T][S.FieldName.toString().Trim()]+" at Row "+(T+1).toString(),void(this.MessageVisibility=!0)}this.FillCostCenterFields(!1),this.FillLookupFields();let n,h="";this.CCNodeDet=[];let l="",g=[];g=this.ExcelTable,t="",m=[];for(let T=0;T<this.ExcelTable.length;T++,this.ProgressValue++)if(this.IsCode?this.ExcelTable.includes("LeadCode")&&""!=this.ExcelTable[T].LeadCode.toString()&&(t=U.Dw.GetValidXml(this.ExcelTable[T].LeadCode.toString().Trim()),g.filter(S=>S.LeadCode==t)):this.ExcelTable.includes("Company")&&""!=this.ExcelTable[T].Company.toString()&&(t=U.Dw.GetValidXml(this.ExcelTable[T].Company.toString().Trim()),g.filter(S=>S.Company==t)),0==m.filter(S=>S.Name.toUpperCase()==t.toUpperCase()).length){let S="",I="",d="",y="";y+="<XML>",s+="<Row ";for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(e.filter(E=>E.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()&&"CRM_ProductMapping"!==E.CostCenterColID),h="",e.length>0))switch(h=e[0].SysColumnName.toString(),h){case"Code":r=this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()];break;case"Company":a=this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":s+=h+'="'+this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":n=N.J0.isValidDate(this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]),n&&(s+=h+'="'+n.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":s+=h+'="'+this.ExcelTable[T][this.grData.Table[F].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()?s+='  Mode ="0" ':"existing"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()?s+='  Mode ="1" ':"account"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()?s+='  Mode ="2" ':"customer"==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()&&(s+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":I+=h+"='"+this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]+"'  ";break;case"Email1":I+="Email='"+this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":d+=h+"='"+this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?h.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?S+=h+" ='"+this.ExcelTable[T][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ":c+=h+" ='"+this.ExcelTable[T][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()]?c+=h+" ='0', ":c+=h+" =N'"+U.Dw.GetValidXml(this.ExcelTable[T][this.grData.Table[F].FieldName.toString().Trim()])+"', "}s+=" ></Row>",y+="</XML>",o+="<XML><Row ",""!=c&&(o+=' ExtraFields ="'+c.Trim(",")+'" '),""!=d&&(o+=' TabDetails ="'+d.Trim(",")+'" '),""!=S&&(o+=' CostCenterFields ="'+S+'" '),""!=I&&(o+='ContactFields ="'+I.Trim(",")+'" '),o+=" ></Row></XML>",s.replace("&","&amp;");for(let F=0;F<g.length;F++){u="",l+="<Row ",l+=' Sno="'+F+'1" ';for(let E=0;E<this.grData.Table.length;E++)if(null!=this.grData.Table[E].FeatureFieldName&&""!=this.grData.Table[E].FeatureFieldName.toString()&&(e.filter(V=>V.CostCenterColID==this.grData.Table[E].FeatureFieldName.toString()&&"CRM_ProductMapping"!==V.CostCenterColID),e.length>0))switch(h=e[0].SysColumnName.toString(),h){case"ProductID":l+=" Product ='"+g[F][this.grData.Table[E].FieldName.toString()]+"'  ";break;case"CRMProduct":l+=" CRMProduct ='"+g[F][this.grData.Table[E].FieldName.toString()]+"'  ";break;case"Description":l+=" Description ='"+g[F][this.grData.Table[E].FieldName.toString()]+"'  ";break;case"Quantity":l+=" Quantity ='"+g[F][this.grData.Table[E].FieldName.toString()]+"'  ";break;case"Code":0==F&&(r=g[F][this.grData.Table[E].FieldName.toString().Trim()],this.IsCode&&m.push(te._p.ComboBoxItems_1(r)));break;case"Company":0==F&&(a=g[F][this.grData.Table[E].FieldName.toString().Trim()],this.IsCode||m.push(te._p.ComboBoxItems_1(a)));break;default:this.ExcelTable.includes(this.grData.Table[E].FieldName.toString()+"_Key")?u+=e[0].SysColumnName.toString()+" =N'"+g[F][this.grData.Table[E].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==g[F][this.grData.Table[E].FieldName.toString().Trim()]?u+=e[0].SysColumnName.toString()+" ='0', ":u+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(g[F][this.grData.Table[E].FieldName.toString().Trim()])+"', "}""!=u&&(l+=' ExtraFields ="'+u.Trim(",")+'" '),l+="></Row>",u="",F>0&&T++}l.Insert(0,"<XML>"),l+="</XML>";let f,p,D=[];D.push(l.toString()),D.push(a),D.push(this.IsCode),D.push(s.toString()),D.push(o.toString()),D.push(this.IsDuplicateNameAllowed),D.push(this.IsAutoCodeGen),D.push(this.IsUpdate),D.push(b.d.SessionManager.CompanyIndex),D.push(b.d.SessionManager.UserName),D.push(b.d.SessionManager.UserID),D.push(b.d.SessionManager.RoleID),D.push(b.d.SessionManager.LanguageID),p=b.d.document.SetImportDataToLeadProducts(D),p<=0&&(i++,this.FailedRecourdList.push({Name:" Company Name : "+t,Message:f})),l="",s="",o="",u="",c="",d="",S="",I="",this.ImportedCount="Imported :"+(T+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLeads(){let e=this.costCenterTableZero;for(let s=0;s<this.ExcelTable.length;s++)for(let o of this.grData.Table)if(null!=o[1]&&""!=o[1].toString()&&"0"!=o[1].toString()&&(e.filter(m=>m.CostCenterColID===m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(s,parseInt(e[0].ColumnCCListViewTypeID.toString()),o.FieldName.toString()):this.CheckCostCenterField(s,parseInt(e[0].ColumnCostCenterID.toString()),o.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let m;if("25623"!=o.FeatureFieldName.toString().Trim().toUpperCase()&&"25772"!=o.FeatureFieldName.toString().Trim().toUpperCase()&&"25629"!=o.FeatureFieldName.toString().Trim().toUpperCase()&&"25630"!=o.FeatureFieldName.toString().Trim().toUpperCase()&&(m=null!=this.ExcelTable[s][o.FieldName.toString()]&&""!=this.ExcelTable[s][o.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[s][o.FieldName.toString().Trim()]),m))return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=null!=this.ExcelTable[s][o.FieldName.toString()]&&""!=this.ExcelTable[s][o.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[s][o.FieldName.toString().Trim()]),m)return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=!N.J0.isValidDate(this.ExcelTable[s][o.FieldName.toString().Trim()]),m)return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}let i=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,r="",a="",u="",c="";this.CCNodeDet=[];for(let s=0;s<this.ExcelTable.length;s++,this.ProgressValue++){let o="",m="",h="",n="",l="";l+="<XML>",c+="<Row ";for(let d=0;d<this.grData.Table.length;d++)if(null!=this.grData.Table[d].FeatureFieldName&&""!=this.grData.Table[d].FeatureFieldName.toString()&&(e.filter(y=>y.CostCenterColID==this.grData.Table[d].FeatureFieldName.toString()),r="",e.length>0))switch(r=e[0].SysColumnName.toString(),r){case"Code":a=this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()];break;case"Company":u=this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()];break;case"StatusID":case"Subject":case"AssignedTo":case"CreatedBy":c+=r+'="'+this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]+'" ';break;case"Date":case"CreatedDate":t=N.J0.isValidDate(this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]),t&&(c+=r+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"SourceLookUpID":case"RatinglookupID":case"CampaignID":case"IndustryLookUpID":case"SalutationID":case"RoleLookupID":case"ParentID":c+=r+'="'+this.ExcelTable[s][this.grData.Table[d].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"new"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()?c+='  Mode ="0" ':"existing"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"lead"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"existing lead"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()||"existinglead"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()?c+='  Mode ="1" ':"account"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()?c+='  Mode ="2" ':"customer"==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()].toLowerCase()&&(c+='  Mode ="3" ');break;case"FirstName":case"MiddleName":case"LastName":case"JobTitle":case"Phone1":case"Phone2":case"Fax":case"Department":h+=r+"='"+this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"Email1":h+="Email='"+this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;case"Address1":case"Address2":case"Address3":case"City":case"State":case"Zip":case"Birthday":case"Anniversary":n+=r+"='"+this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]+"'  ";break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?r.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?o+=r+" ='"+this.ExcelTable[s][this.grData.Table[d].FieldName.toString()+"_Key"].toString()+"', ":m+=r+" ='"+this.ExcelTable[s][this.grData.Table[d].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()]?m+=r+" ='0', ":m+=r+" =N'"+U.Dw.GetValidXml(this.ExcelTable[s][this.grData.Table[d].FieldName.toString().Trim()])+"', "}c+=" ></Row>",l+="</XML>";let g="";g+="<XML><Row ",""!=m&&(g+=' ExtraFields ="'+m.Trim(",")+'" '),""!=n&&(g+=' TabDetails ="'+n.Trim(",")+'" '),""!=o&&(g+=' CostCenterFields ="'+o+'" '),""!=h&&(g+='ContactFields ="'+h.Trim(",")+'" '),g+=" ></Row></XML>",c.replace("&","&amp;");let T,S=[];S.push(c.toString()),S.push(g.toString()),S.push(parseInt(this.Feature.SelectedValue)),S.push(a),S.push(u),S.push(this.IsUpdate),S.push(this.IsCode),S.push(this.IsUpdate),S.push(b.d.SessionManager.CompanyIndex),S.push(b.d.SessionManager.UserName),S.push(b.d.SessionManager.UserID),S.push(b.d.SessionManager.RoleID),S.push(b.d.SessionManager.LanguageID),T=b.d.document.SetImportDataToCRM(S),T<=0&&(i++,this.FailedRecourdList.push({Name:"Code : "+a+" ; Name : "+u,Message:T})),c="",this.ImportedCount="Imported :"+(s+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCases(){let e=this.costCenterTableZero;for(let s=0;s<this.ExcelTable.length;s++)for(let o of this.grData.Table)if(null!=o[1]&&""!=o[1].toString()&&"0"!=o[1].toString()&&(e.filter(m=>m.CostCenterColID===m[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(s,parseInt(e[0].ColumnCCListViewTypeID.toString()),o.FieldName.toString()):this.CheckCostCenterField(s,parseInt(e[0].ColumnCostCenterID.toString()),o.FieldName.toString(),!1,this.IsCode);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let m;if("24238"!=o.FeatureFieldName.toString().Trim().toUpperCase()&&(m=null!=this.ExcelTable[s][o.FieldName.toString()]&&""!=this.ExcelTable[s][o.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[s][o.FieldName.toString().Trim()]),m))return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=null!=this.ExcelTable[s][o.FieldName.toString()]&&""!=this.ExcelTable[s][o.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[s][o.FieldName.toString().Trim()]),m)return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){let m;if(m=!N.J0.isValidDate(this.ExcelTable[s][o.FieldName.toString().Trim()]),m)return this.DisplayMessage=o.FieldName.toString()+" "+this.ExcelTable[s][o.FieldName.toString().Trim()]+" at Row "+(s+1).toString(),void(this.MessageVisibility=!0)}let i=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,r="",a="",u="",c="";this.CCNodeDet=[];for(let s=0;s<this.ExcelTable.length;s++,this.ProgressValue++){let o="",m="";c+="<Row ";for(let T=0;T<this.grData.Table.length;T++)if(null!=this.grData.Table[T].FeatureFieldName&&""!=this.grData.Table[T].FeatureFieldName.toString()&&"-200"!=this.grData.Table[T].FeatureFieldName.toString()&&(e.filter(S=>S.CostCenterColID===this.grData.Table[T].FeatureFieldName.toString()),r="",e.length>0))switch(r=e[0].SysColumnName.toString(),r){case"CaseNumber":a=this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()];break;case"CustomerID":u=this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()];break;case"CreatedBy":case"Subject":case"AssignedTo":case"ParentID":case"IsGroup":c+=r+'="'+this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()]+'" ';break;case"CreatedDate":case"CreateDate":case"CloseDate":case"AssignedDate":t=N.J0.isValidDate(this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()]),t&&(c+=r+'="'+t.toLocaleDateString("dd/MMM/yyyy")+'" ');break;case"CasePriorityLookupID":case"CaseOriginLookupID":case"CaseTypeLookupID":case"ServiceLvlLookupID":case"StatusID":case"BillingMethod":c+=r+'="'+this.ExcelTable[s][this.grData.Table[T].FieldName.toString()+"_Key"].toString().Trim()+'" ';break;case"Mode":"account"==this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()?c+=r+'="1" ':"customer"==this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()].toLowerCase()&&(c+=r+'="2" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?r.toLowerCase().Contains("ccnid")&&null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?o+=r+" ='"+this.ExcelTable[s][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":m+=r+" ='"+this.ExcelTable[s][this.grData.Table[T].FieldName.toString()+"_Key"].toString()+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()]?m+=r+" ='0', ":m+=r+" =N'"+U.Dw.GetValidXml(this.ExcelTable[s][this.grData.Table[T].FieldName.toString().Trim()])+"', "}c+=" ></Row>";let h="";h+="<XML><Row ",""!=m&&(h+=' ExtraFields ="'+m.Trim(",")+'" '),""!=o&&(h+=' CostCenterFields ="'+o+'" '),h+=" ></Row></XML>",c.replace("&","&amp;");let n,l=[];l.push(c.toString()),l.push(h.toString()),l.push(parseInt(this.Feature.SelectedValue)),l.push(a),l.push(u),l.push(this.IsUpdate),l.push(this.IsCode),l.push(this.IsUpdate),l.push(b.d.SessionManager.CompanyIndex),l.push(b.d.SessionManager.UserName),l.push(b.d.SessionManager.UserID),l.push(b.d.SessionManager.RoleID),l.push(b.d.SessionManager.LanguageID),n=b.d.document.SetImportDataToCRM(l),n<=0&&(i++,this.FailedRecourdList.push({Name:"Code : "+a+" ; Name : "+u,Message:n})),c="",this.ImportedCount="Imported :"+(s+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportFollowUps(){let e=this.costCenterTableZero;for(let n=0;n<this.ExcelTable.length;n++)for(let l of this.grData.Table)if(null!=l[1]&&""!=l[1].toString()&&"0"!=l[1].toString()&&(e.filter(g=>g.CostCenterColID===g[1].toString()),e.length>0))if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)44==parseInt(e[0].ColumnCostCenterID)?this.CheckLookupField(n,parseInt(e[0].ColumnCCListViewTypeID.toString()),l.FieldName.toString()):this.CheckCostCenterField(n,parseInt(e[0].ColumnCostCenterID.toString()),l.FieldName.toString(),!1,!1);else if(e[0].ColumnDataType&&"int"==e[0].ColumnDataType.toString().toLowerCase()||e[0].ColumnDataType&&"bigint"==e[0].ColumnDataType.toString().toLowerCase()){let g;if(g=null!=this.ExcelTable[n][l.FieldName.toString()]&&""!=this.ExcelTable[n][l.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][l.FieldName.toString().Trim()]),g)return this.DisplayMessage=l.FieldName.toString()+" "+this.ExcelTable[n][l.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){if(null!=this.ExcelTable[n][l.FieldName.toString()]&&""!=this.ExcelTable[n][l.FieldName.toString().Trim()]&&!parseFloat(this.ExcelTable[n][l.FieldName.toString().Trim()]))return this.DisplayMessage=l.FieldName.toString()+" "+this.ExcelTable[n][l.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0)}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[n][l.FieldName.toString().Trim()]))return this.DisplayMessage=l.FieldName.toString()+" "+this.ExcelTable[n][l.FieldName.toString().Trim()]+" at Row "+(n+1).toString(),void(this.MessageVisibility=!0);let i=0,r=0;this.FillCostCenterFields(!1),this.FillLookupFields();let t,a="",u="",c="",s=[],o="",m="",h=this.grData.Table;if(e.filter(n=>"-1"===n.FeatureFieldName),h.length>0&&(m=h[0].FieldName.toString()),N.J0.IsEmpty(this.QtyCombo.SelectedValue))return this.DisplayMessage="Select Dimension",void(this.MessageVisibility=!0);if(""==m)return this.DisplayMessage="Please select code field",void(this.MessageVisibility=!0);h=this.ExcelTable;for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(""!=this.ExcelTable[n][m].toString()&&(o=this.ExcelTable[n][m].toString(),h.filter(l=>l.strPCodeColumn===o)),!s.Contains(o.toUpperCase())){for(let S=0;S<h.length;S++){c+="<Row ";for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID===this.grData.Table[I].FeatureFieldName.toString()),e.length>0))switch(a=e[0].SysColumnName.toString(),a){case"Code":u=h[S][this.grData.Table[I].FieldName.toString().Trim()],s.push(u.toUpperCase());break;case"Feedback":c+=a+' ="'+U.Dw.GetValidXml(h[S][this.grData.Table[I].FieldName.toString().Trim()]).replace("\n","~")+'" ';break;case"Date":t=N.J0.isValidDate(h[S][this.grData.Table[I].FieldName.toString().Trim()]),t&&(c+=a+'="'+t.toString("dd/MMM/yyyy hh:mm:ss tt")+'" ');break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?c+=a+' ="'+h[S][this.grData.Table[I].FieldName.toString()+"_Key"].toString()+'" ':c+=a+' ="'+U.Dw.GetValidXml(h[S][this.grData.Table[I].FieldName.toString().Trim()])+'" '}c+="></Row>"}let l,g=[];g.push(c.toString()),g.push(""),g.push(parseInt(this.Feature.SelectedValue)),g.push(u),g.push(this.QtyCombo.SelectedValue),g.push(this.IsUpdate),g.push(this.IsCode),g.push(this.IsUpdate),g.push(b.d.SessionManager.CompanyIndex),g.push(b.d.SessionManager.UserName),g.push(b.d.SessionManager.UserID),g.push(b.d.SessionManager.RoleID),g.push(b.d.SessionManager.LanguageID),l=b.d.document.SetImportDataToCRM(g),l<=0?(i++,this.FailedRecourdList.push({Name:" Code : "+o,Message:l})):r++,c="",this.ImportedCount="Imported :"+r.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCRMCustomers(e){let i=this.costCenterTableZero;if(!this.ExcelTable.includes("CustomerName")&&!this.ExcelTable.includes("CustomerCode"))return this.DisplayMessage="CustomerName/CustomerCode should present in excel",void(this.MessageVisibility=!0);if(!this.ScanCostCenterFields(!1))return;let r=0,a="",u=[],c=[];c=this.ExcelTable;let t="",s=null,o=[],m=[],h=null;null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(h=new N.VB,h.LoadXml(this.CodeDef[0].PrefixContent.toString())),a+="<XML>";for(let n=0;n<this.ExcelTable.length;n++,this.ProgressValue++)if(null!=h&&(s=this.GetCodeData(this.ExcelTable[n],0)),this.IsCode?this.ExcelTable.includes("CustomerCode")&&""!=this.ExcelTable[n].CustomerCode.toString()&&(t=U.Dw.GetValidXml(this.ExcelTable[n].CustomerCode.toString().Trim()),c.filter(l=>l.CustomerCode===t)):this.ExcelTable.includes("CustomerName")&&""!=this.ExcelTable[n].CustomerName.toString()&&(t=U.Dw.GetValidXml(this.ExcelTable[n].CustomerName.toString().Trim()),c.filter(l=>l.CustomerName===t)),0==u.filter(l=>l.Name.toUpperCase()==t.toUpperCase()).length){o.length=0;let ie,l=!1,g=!1,T=!1,S=!1,I=!1,d=!1,y=!1,f=!1,D=!1,p="",F="",E="",V="",L="",O="",x="",B="",q="",$=0,Z=0,k="";m.length=0,a+="<Row ";for(let w=0;w<this.grData.Table.length;w++)if(null!=this.grData.Table[w].FeatureFieldName&&""!=this.grData.Table[w].FeatureFieldName.toString()&&(i.filter(W=>W.CostCenterColID==this.grData.Table[w].FeatureFieldName.toString()&&W.SysTableName!=W.Com_Contacts&&W.usercolumnname!=W.Contact_),i.length>0)){let W=i[0].SysColumnName.toString();switch(W){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][1].length>0&&(a+='StatusID ="'+this.CostCenterFieldsAllTables[1][1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(a+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":a+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables[1][2].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][2].length>0&&(a+='TypeID ="'+this.CostCenterFieldsAllTables[1][2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":d=!0,this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1][3].length>0?a+='ValuationID ="'+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+'" ':d=!1;break;case"UOMID":I=!0,O+="UOMID ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":a+='PurchaseAccount ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ',g=!0;break;case"SalesAccountID":case"SalesAccount":l=!0,a+='SalesAccount ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":f=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?O+=i[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?O+=i[0].SysColumnName.toString()+" ='2', ":O+=i[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":y=!0,"FIRST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?O+=i[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?O+=i[0].SysColumnName.toString()+" ='2', ":O+=i[0].SysColumnName.toString()+" ='0', ";break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":a+=i[0].SysColumnName.toString()+' ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].Contains("-")){let de=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].split("-");$=de.length>0&&N.J0.Int(de[0]),$?$=parseInt(de[0]):($=0,Z=de.length>1&&N.J0.Int(de[1])),Z=Z?parseInt(de[1]):0}else $=N.J0.Int(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])?parseInt(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==s&&(a+='AccountCode ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" '),this.IsCode&&u.push(te._p.ComboBoxItems_1(U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])));break;case"CodePrefix":case"CodeNumber":null==s&&(a+=W+'="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":a+='AccountName ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ',F=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()],this.IsCode||u.push(te._p.ComboBoxItems_1(F));break;case"ParentGroup":case"ParentGroupName":a+='GroupName ="'+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+'" ';break;case"AccountId":case"CustomerId":"65"==this.Feature.SelectedValue.toString()&&("CustomerId"==i[0].SysColumnName.toString()?V+=" CCID='83'  CustomerName ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]+"'  ":"AccountId"==i[0].SysColumnName.toString()&&(V+=" CCID='2'   CustomerName ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]+"'  "));break;case"Group":case"isGroup":case"IsGroup":case"IsBillwise":D=!0,"true"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()?a+=i[0].SysColumnName.toString()+' ="1" ':a+=i[0].SysColumnName.toString()+' ="0" ';break;case"ParentID":"3"==this.Feature.SelectedValue&&("true"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toLowerCase()?a+='IsGroup="1" ':a+='IsGroup ="0" ');break;case"COGSAccountID":this.ExcelTable.includes(this.grData.Table[w].FieldName.toString()+"_Key")&&(O+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', "),T=!0;break;case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[w].FieldName.toString()+"_Key")&&(O+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', "),S=!0;break;case"Assigned_Locations":case"Assigned_Insurance":o+=this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString();break;case"Base_Name":m.push({BaseName:this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]});break;case"Base_Conversion":m.push({Conversion:this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]});break;case"Conversion_UnitName":m.push({UnitName:this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]});break;case"Conversion_UnitValue":m.push({ConversionUnit:this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]});break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[w].FieldName.toString()+"_Key")&&(B+="Product ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?""!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]||"M"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]||"2"==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])&&(B+=i[0].SysColumnName.toString()+" ='2'  "):B+=i[0].SysColumnName.toString()+" ='1'  ";break;case"ProductImage":if("3"==this.Feature.SelectedValue)try{this.grData.Table[w].FieldName.toString()}catch{L=""}break;case"SubstituteGroup":E+="GroupName ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()]+"'  ";break;default:null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0?null!=i[0].IsColumnUserDefined&&""!=i[0].IsColumnUserDefined.toString()&&(0,K.yG0)(i[0].IsColumnUserDefined.toString())?""!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()?p+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', ":p+=i[0].SysColumnName.toString()+" ='1', ":O+=i[0].SysColumnName.toString()+" ='"+this.ExcelTable[n][this.grData.Table[w].FieldName.toString()+"_Key"].toString()+"', ":null!=i[0].IsColumnUserDefined&&""!=i[0].IsColumnUserDefined.toString()&&(0,K.yG0)(i[0].IsColumnUserDefined.toString())?null!=i[0].SysColumnName&&i[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(k+=i[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+"', "):i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()]?O+=i[0].SysColumnName.toString()+" ='0', ":O+=i[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[n][this.grData.Table[w].FieldName.toString().Trim()])+"', "}}if(null!=s&&(a+='AccountCode="'+s.Code.toString()+'" ',a+='CodePrefix="'+s.Prefix.toString()+s.Suffix.toString()+'" ',a+='CodeNumber="'+s.Number.toString()+'"'),g||(3==parseInt(this.Feature.SelectedValue)?i.filter(w=>"SysColumnName"===w.SysColumnName):i.filter(w=>"PurchaseAccount"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" =N'"+i[0].UserDefaultValue.toString()+"', ")),l||(3==parseInt(this.Feature.SelectedValue)?i.filter(w=>"SalesAccountID"===w.SysColumnName):i.filter(w=>"SalesAccount"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" =N'"+i[0].UserDefaultValue.toString()+"', ")),!d&&this.CostCenterFieldsAllTables[1].length>6&&(this.CostCenterFieldsAllTables[1][6].RowFilter="Name='DefaultProductValuation'",this.CostCenterFieldsAllTables[1][6].length>0?(this.CostCenterFieldsAllTables[1][3].RowFilter="ResourceData='"+this.CostCenterFieldsAllTables[1][6][0].Value.toString()+"'",3==parseInt(this.Feature.SelectedValue)&&i.filter(w=>"ValuationID"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" ='"+this.CostCenterFieldsAllTables[1][3][0].ValuationID.toString()+"', ")):(i.filter(w=>"ValuationID"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', "))),T||(i.filter(w=>"COGSAccountID"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ")),S||(i.filter(w=>"ClosingStockAccountID"===w.SysColumnName),i.length>0&&(O+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ")),I||(i.filter(w=>"UOMID"===w.SysColumnName),i.length>0?O+=i[0].SysColumnName.toString()+" ='"+i[0].UserDefaultValue.toString()+"', ":""!=this.Feature.SelectedValue&&null!=this.Feature.SelectedValue&&2!=parseInt(this.Feature.SelectedValue)&&65!=parseInt(this.Feature.SelectedValue)&&51!=parseInt(this.Feature.SelectedValue)&&(O+=" UOMID ='1', ")),!D){let w=!1;w=(0,K.yG0)(b.d.SessionManager.Preferences.On.toString()),a+=w?'IsBillwise ="1" ':' IsBillwise="0" '}if(!f&&"2"==this.Feature.SelectedValue&&(O+=" DrOptionID='0', "),!y&&"2"==this.Feature.SelectedValue&&(O+=" CrOptionID='0', "),""!=O&&(a+='ExtraFields ="'+O.substring(0,O.length-2)+'" '),null!=this.Feature.SelectedItem&&"Product With Services(One-One)"==this.Feature.SelectedItem.Name?q="One-One":null!=this.Feature.SelectedItem&&"Product With Services(Many-One)"==this.Feature.SelectedItem.Name&&(q="Many-One"),""!=q&&(a+='LinkOption="'+q+'"  '),""!=B&&(a+='LinkFields ="'+B.substring(0,B.length-2)+'" '),""!=E&&(a+='Substitutes ="'+E.substring(0,E.length-2)+'" '),""!=V&&(a+='CustomerName ="'+V.substring(0,V.length-2)+'" '),""!=L&&(a+='ProductImage ="'+L+'" '),""!=k&&(a+='ExtraUserDefinedFields ="'+k.substring(0,k.length-2)+'" '),""!=p&&(a+='CostCenterFields ="'+p.substring(0,p.length-2)+'" '),""!=x&&(a+='PrimaryContactQuery ="'+x.substring(0,x.length-2)+'" '),m.toString().length>0&&(m.toString().includes("Conversion=")||m.push({Conversion:"1",ProductWiseUOM:m.toString()})),""==F)continue;o.length>0&&o.Insert(0,"<XML>"),a+=" ></Row>",a+="</XML>";let ne=[],ye=this.ReturnMultipleAddress(c,i,e);ne.push(a.toString()),ne.push(o.toString()),ne.push(ye),ne.push(parseInt(this.Feature.SelectedValue)),ne.push(b.d.SessionManager.CompanyIndex),ne.push(b.d.SessionManager.UserName),ne.push(b.d.SessionManager.UserID),ne.push(b.d.SessionManager.RoleID),ne.push(b.d.SessionManager.LanguageID),ie=b.d.document.SetImportCRMCustomerData(ne),ie>0&&(r++,this.FailedRecourdList.push({Name:F,Message:ie})),a="",a+="<XML>",this.ImportedCount="Imported :"+(n+1-r).toString(),this.FailedCount="Failed :"+r.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}toTableDistinct(e,i){const r=new Set,a=[];for(const u of e){const c=u[i];r.has(c)||(r.add(c),a.push({[i]:c}))}return a}ImportUOM(){let e=this.GetBomFieldName("FeatureFieldName=-1");if(""==e)return this.DisplayMessage="Base Name Not Exists",void(this.MessageVisibility=!0);const i=this.GetBomFieldName("FeatureFieldName=-2");if(""==i)return this.DisplayMessage="Unit Name Not Exists",void(this.MessageVisibility=!0);const r=this.GetBomFieldName("FeatureFieldName=-3");if(""==i)return this.DisplayMessage="Conversion Not Exists",void(this.MessageVisibility=!0);let a=0,u=0,c=0;const t=this.CostCenterFieldsAllTables.Tables[1];let s=[];s=this.toTableDistinct(this.ExcelTable,e),s.includes(e)||s.push(e),s.includes("BaseID")||s.push("BaseID"),s.includes("UOMID")||s.push("UOMID"),s.includes("Conversion")||s.push("Conversion"),s.includes("UOMXML")||s.push("UOMXML");for(let g=0;g<s.length;g++)t.filter(T=>T.BaseName===s[e].toString().Trim().replace("'","''")),t.length>0?(s.BaseID=t[0].BaseID,s.UOMID=t[0].UOMID,s.Conversion=t[0].Conversion):s.BaseID=-100;this.ExcelTable.includes("UOMID")||this.ExcelTable.push("UOMID");for(let g=0;g<this.ExcelTable.length;g++)t.filter(T=>T.BaseName===this.ExcelTable[g][e].toString().Trim().replace("'","''")&&T.UnitName==this.ExcelTable[g][i].toString().Trim().replace("'","''")),t.length>0&&(this.ExcelTable[g].UOMID=t[0].UOMID);let m,h,o=this.ExcelTable;for(let g=0;g<s.length;g++)if(o.filter(T=>T.BaseName===s[e].toString()),o.length>0){h=1,m="",m+="<XML>",""!=s.BaseID.toString()&&"-100"!=s.BaseID.toString()&&(m+="<Row RowNo='1'",m+=" PrimaryKey='"+s.UOMID+"'",m+=" MapAction='UPDATE'",m+=" UName='"+s[e]+"'",m+=" ConversionRate='"+s.Conversion+"' />",h=2);for(let T=0;T<o.length;T++)m+="<Row RowNo='"+(T+h)+"'",""!=o[T].UOMID.toString()?(m+=" PrimaryKey='"+o[T].UOMID.toString()+"'",m+=" MapAction='UPDATE'"):(m+=" PrimaryKey='0'",m+=" MapAction='NEW'"),m+=" UName='"+o[T][i].toString()+"'",m+=" ConversionRate='"+o[T][r].toString()+"' />";m+="</XML>",s.UOMXML=m.toString(),m.Clear()}let n=null;for(let g=0;g<s.length;g++,this.ProgressValue++)n=[],n.push(s[e].toString()),n.push(s.BaseID.toString()),n.push(s.UOMXML.toString()),n.push(!1),n.push(b.d.SessionManager.CompanyGUID),n.push(b.d.SessionManager.UserName),n.push(b.d.SessionManager.RoleID),n.push(b.d.SessionManager.LanguageID),b.d.inventory.AddUOM(n,"AddUOM").subscribe(T=>{this.DisplayMessage=T.Message,c=T.RetValue,this.MessageVisibility=!0},T=>{alert(JSON.stringify(T))}),c<0?(u++,this.FailedRecourdList.push({Name:s[e].toString(),Message:this.ErrorMessage})):a++,this.ImportedCount="Imported :"+a.toString(),this.FailedCount="Failed :"+u.toString();let l=u+a;this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+l.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportMultipleStageBoms(){if(!this.ScanCostCenterFields(!0))return;let e=this.GetBomFieldName("FeatureFieldName=555026");if(""==e)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);let i=0,r=0,a=1,u=1,c=1,t=0,s=51,o=0,m="",h="",n="",l="",g="",T=0,S=0,I=0,d="",y="",f="",D="",p=0;var F=new F,E=new F;const V=this.CostCenterFieldsAllTables.Tables[0];let L=this.ExcelTable;const O=this.grData.Table;let ne,x=null,B="",q="",$="",Z="",k=this.ExcelTable,ie=this.ExcelTable;for(let w=k.length-1;w>0;w--)O.length>0&&(ie.includes(k[w].ColumnName+"_Key")&&ie.Remove(k[w].ColumnName+"_Key"),ie.Remove(k[w].ColumnName)),O.filter(W=>W.FeatureFieldName<"0"&&W.FeatureFieldName==k[w].ColumnName),O.length>0&&(ie.includes(k[w].ColumnName+"_Key")&&k.Remove(k[w].ColumnName+"_Key"),k.Remove(k[w].ColumnName));for(let w=0;w<k.length;w++)ne.push(k[w].ColumnName);k=this.toTableDistinct(L,ne);for(let w=0;w<ie.length;w++)ne.push(ie[w].ColumnName);ie=this.toTableDistinct(L,ne);const Re=ie;ie.includes("StagesXML")||k.push("StagesXML"),ie.includes("BOMProductXML")||k.push("BOMProductXML"),ie.includes("BOMExpenseXML")||k.push("BOMExpenseXML"),ie.includes("BOMResourceXML")||k.push("BOMResourceXML");for(let w=0;w<k.length;w++){if(Re.filter(W=>W.BomName<k[w][e].toString().replace("'","''")),B+="<Stages>",Re.length>0)for(let W=0;W<Re.length;W++)m=this.GetFieldValue("FeatureFieldName=-11",Re[W]),B+='<Stage ID="-'+m+'" ',B+='StageNodeID="'+this.GetFieldValue("FeatureFieldName=-10",Re[W])+'" ',B+='Parent="1" ',B+='lft="'+m+'" ',B+='Depth="1" />';if(B+="</Stages>",k[w].StagesXML=B.toString(),B="",L.filter(W=>W.BomName<k[w][e].toString().replace("'","''")),L.length>0){q+="<BOMProductXML>",$+="<BOMExpenseXML>",Z+="<BOMResourceXML>";for(let W=0;W<L.length;W++)D=this.GetFieldValue("FeatureFieldName=-9",L[W]).toUpperCase(),"IP"==D||"OP"==D?(q+="<Row ",q+=" BOMProductID='0'",q+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",L[W])+"'",q+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",L[W])+"'",T=parseFloat(this.GetFieldValue("FeatureFieldName=-2",L[W])),q+=" Quantity='"+T+"'",q+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",L[W])+"'",S=parseFloat(this.GetFieldValue("FeatureFieldName=-4",L[W])),q+=" UnitPrice='"+S+"'","IP"==D?(q+=" ProductUse='1'",q+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",L[W])+"'",m=this.GetFieldValue("FeatureFieldName=-7",L[W]).toUpperCase(),q+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",L[W]).toUpperCase(),q+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'"):"OP"==D&&(q+=" ProductUse='2'"),I=parseFloat(this.GetFieldValue("FeatureFieldName=-5",L[W])),I>0||(I=T*S),q+=" Value='"+I+"'/>"):"EXPENSES"==D?($+="<Row ",$+=" ExpenseID='0'",$+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",L[W])+"'",$+=" Name='"+this.GetFieldValue("FeatureFieldName=-12",L[W])+"'",$+=" ResourceID='1'",$+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-13",L[W])+"'",$+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-14",L[W])+"'",m=this.GetFieldValue("FeatureFieldName=-7",L[W]).toUpperCase(),$+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",L[W]).toUpperCase(),$+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'",$+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",L[W])+"'/>"):"MACHINES"==D&&(Z+="<Row ",Z+=" BOMResourceID='0'",Z+=" StageID='-"+this.GetFieldValue("FeatureFieldName=-11",L[W])+"'",Z+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-15",L[W])+"'",Z+=" Hours='"+this.GetFieldValue("FeatureFieldName=-16",L[W])+"'",Z+=" Options='"+this.GetFieldValue("FeatureFieldName=-17",L[W])+"'",Z+=" MachineDim1='"+this.GetFieldValue("FeatureFieldName=-18",L[W])+"'",Z+=" MachineDim2='"+this.GetFieldValue("FeatureFieldName=-19",L[W])+"'",m=this.GetFieldValue("FeatureFieldName=-7",L[W]).toUpperCase(),Z+="NO"==m||""==m||"0"==m?" IncInStageCost='0'":" IncInStageCost='1'",m=this.GetFieldValue("FeatureFieldName=-8",L[W]).toUpperCase(),Z+="NO"==m||""==m||"0"==m?" IncInFinalCost='0'":" IncInFinalCost='1'",Z+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",L[W])+"'/>");q+="</BOMProductXML>",k[w].BOMProductXML=q.toString(),q="",$+="</BOMExpenseXML>",k[w].BOMExpenseXML=$.toString(),$="",Z+="</BOMResourceXML>",k[w].BOMResourceXML=Z.toString(),Z=""}}for(let w=0;w<k.length;w++,this.ProgressValue++){a=1,u=1,c=1,t=0,s=51,o=0,h="",n="",l="",g="",d="",y="",f="",F=new F;for(let W=0;W<this.grData.Table.length;W++)if(null!=this.grData.Table[W].FeatureFieldName&&""!=this.grData.Table[W].FeatureFieldName.toString()&&!this.grData.Table[W].FeatureFieldName.toString().startsWith("-")&&(L.filter(de=>de.CostCenterColID===this.grData.Table[W].FeatureFieldName.toString()),V.length>0))switch(V[0].SysColumnName.toString()){case"BOMCode":h=k[w][this.grData.Table[W].FieldName.toString()];break;case"BOMName":n=k[w][this.grData.Table[W].FieldName.toString()];break;case"Date":F=N.J0.isValidDate(k[w][this.grData.Table[W].FieldName.toString().Trim()]);break;case"ProductID":o=parseInt(k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString());break;case"Packing":f=k[w][this.grData.Table[W].FieldName.toString()];break;case"UOMID":t=parseInt(k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString());break;case"FPQty":g=k[w][this.grData.Table[W].FieldName.toString()];break;case"LocationID":u=parseInt(k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString());break;case"DivisionID":c=parseInt(k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString());break;case"Group":a=parseInt(k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString());break;case"Description":l=k[w][this.grData.Table[W].FieldName.toString()];break;case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+k[w][this.grData.Table[W].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(s=parseInt(this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()));break;default:null!=V[0].ColumnCostCenterID&&""!=V[0].ColumnCostCenterID.toString()&&parseInt(V[0].ColumnCostCenterID.toString())>0?44==parseInt(V[0].ColumnCostCenterID.toString())?V[0].SysColumnName.toString().Contains("Alpha")&&(d+=V[0].SysColumnName.toString()+" ='"+k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString()+"', "):V[0].SysColumnName.toString().Contains("Alpha")?d+=V[0].SysColumnName.toString()+" ='"+k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString()+"', ":null!=V[0].IsColumnUserDefined&&""!=V[0].IsColumnUserDefined.toString()&&(0,K.yG0)(V[0].IsColumnUserDefined.toString())&&(ie.includes(this.grData.Table[W].FieldName.toString()+"_Key")&&""!=k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString()&&"0"!=k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString()?y+=V[0].SysColumnName.toString()+" ='"+k[w][this.grData.Table[W].FieldName.toString()+"_Key"].toString()+"', ":y+=V[0].SysColumnName.toString()+" ='1', "):null!=V[0].SysColumnName&&V[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&(V.Table.Columns.Contains("UserColumnType")&&V[0].UserColumnType.toString().toLowerCase().Contains("date")||V[0].ColumnDataType&&V[0].ColumnDataType.toString().toLowerCase().Contains("date")?(E=new F,(E=""==k[w][this.grData.Table[W].FieldName.toString().Trim()]||N.J0.isValidDate(k[w][this.grData.Table[W].FieldName.toString().Trim()]))&&(d+=V[0].SysColumnName.toString()+" ='"+E.Date.toLocaleDateString("dd/MMM/yyyy")+"', ")):d+=V[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(k[w][this.grData.Table[W].FieldName.toString().Trim()].replace("'","''"))+"', ")}x=new Rt.b,x.BOMID=0,x.Code=h,x.Name=n,x.Date=F,x.ProductID=o,x.Packing=f,x.UOMID=t,x.FPQty=parseFloat(g),x.FPQty<=0&&(x.FPQty=1),x.LocationID=u,x.DivisionID=c,x.group=!1,x.selectednodeid=a,x.Desc=l,x.StatusID=s,x.StageXML=k[w].StagesXML.toString(),x.BOMProductXML=k[w].BOMProductXML.toString(),x.BOMExpenseXML=k[w].BOMExpenseXML.toString(),x.BOMResourceXML=k[w].BOMResourceXML.toString(),x.CustomFieldsQuery=d,x.CustomCCQuery=y,x.WID=0,p=this.DisplayMessage=x.AddMultiStageBOM(),p<0?(r++,this.FailedRecourdList.push({Name:n,Message:this.ErrorMessage})):i++,this.ImportedCount="Imported :"+i.toString(),this.FailedCount="Failed :"+r.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+(r+i).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportBoms(){if(!this.ScanCostCenterFields(!0))return;let e=0,i=0,a=this.ExcelTable,u="",c="",t=this.GetBomFieldName("FeatureFieldName=555026"),s="",o="",m="";if(""==t)return this.DisplayMessage="Bom Name Not Exists",void(this.MessageVisibility=!0);a.sort((l,g)=>l.BomName.localeCompare(g.BomName)),s+="<BOMProductXML>",o+="<BOMExpenseXML>",m+="<BOMResourceXML>";for(let l=0;l<a.length;l++,this.ProgressValue++)u=c,c=a[l][t].toString(),u!=c&&l>0&&(s+="</BOMProductXML>",o+="</BOMExpenseXML>",m+="</BOMResourceXML>",this.SaveBom(a[l-1],s.toString(),o.toString(),m.toString())<0?(i++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString(),s="",o="",m="",s+="<BOMProductXML>",o+="<BOMExpenseXML>",m+="<BOMResourceXML>"),""!=this.GetFieldValue("FeatureFieldName=-1",a[l])?(s+="<Row ",s+=" BOMProductID='0'",s+=" ProductUse='1'",s+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-1",a[l])+"'",s+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",a[l])+"'",s+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",a[l])+"'",s+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",a[l])+"'",s+=" Action='New'",s+=" Wastage='"+this.GetFieldValue("FeatureFieldName=-6",a[l])+"'",s+=" Value='"+this.GetFieldValue("FeatureFieldName=-5",a[l])+"'/>"):""!=this.GetFieldValue("FeatureFieldName=-12",a[l])&&(s+="<Row ",s+=" BOMProductID='0'",s+=" ProductUse='2'",s+=" ProductID='"+this.GetFieldValue("FeatureFieldName=-12",a[l])+"'",s+=" Quantity='"+this.GetFieldValue("FeatureFieldName=-2",a[l])+"'",s+=" UOMID='"+this.GetFieldValue("FeatureFieldName=-3",a[l])+"'",s+=" UnitPrice='"+this.GetFieldValue("FeatureFieldName=-4",a[l])+"'",s+=" Action='New'",s+=" Value='"+this.GetFieldValue("FeatureFieldName=-6",a[l])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-7",a[l])&&(o+="<Row ",o+=" ExpenseID='0'",o+=" ResourceID='1'",o+=" CreditAccountID='"+this.GetFieldValue("FeatureFieldName=-7",a[l])+"'",""!=this.GetFieldValue("FeatureFieldName=-15",a[l])&&(o+=" DebitAccountID='"+this.GetFieldValue("FeatureFieldName=-15",a[l])+"'"),o+=" Action='New'",o+=" Value='"+this.GetFieldValue("FeatureFieldName=-8",a[l])+"'/>"),""!=this.GetFieldValue("FeatureFieldName=-9",a[l])&&(m+="<Row ",m+=" BOMResourceID='0'",m+=" ResourceID='"+this.GetFieldValue("FeatureFieldName=-9",a[l])+"'",m+=" Hours='"+this.GetFieldValue("FeatureFieldName=-10",a[l])+"'",m+=" Action='New'",m+=" Value='"+this.GetFieldValue("FeatureFieldName=-11",a[l])+"'/>");s+="</BOMProductXML>",o+="</BOMExpenseXML>",m+="</BOMResourceXML>",this.SaveBom(a[a.length-1],s.toString(),o.toString(),m.toString())<0?(i++,this.FailedRecourdList.push({Name:u,Message:this.ErrorMessage})):e++,this.ImportedCount="Imported :"+e.toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed ( Total :"+(i+e).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SaveBom(e,i,r,a){let u,c=new Rt.b;return c.BOMID=0,c.Code=this.GetFieldValue("FeatureFieldName=555025",e),c.Name=this.GetFieldValue("FeatureFieldName=555026",e),""!=this.GetFieldValue("FeatureFieldName=23902",e)&&(c.Date=new Date(this.GetFieldValue("FeatureFieldName=23902",e))),c.ProductID=parseInt(this.GetFieldValue("FeatureFieldName=23899",e)),""!=this.GetFieldValue("FeatureFieldName=23900",e)&&(c.LocationID=parseInt(this.GetFieldValue("FeatureFieldName=23900",e))),""!=this.GetFieldValue("FeatureFieldName=23901",e)&&(c.DivisionID=parseInt(this.GetFieldValue("FeatureFieldName=23901",e))),c.group=!1,c.selectednodeid=0,c.Desc=this.GetFieldValue("FeatureFieldName=23903",e),c.StatusID=51,c.BOMProductXML=i,c.BOMExpenseXML=r,c.BOMResourceXML=a,c.CustomFieldsQuery="",c.CustomCCQuery="",u=c.AddBOM(""),u}GetBomFieldName(e){let i="";const r=this.grData.Table,a=this.CostCenterFieldsAllTables.Tables[0],[u,c]=e.split("=");return r.filter(t=>t[u.trim()]?.toString()===c.trim()),r.length>0&&(a.filter(t=>t.CostCenterColID===r[0][1].toString()),i=a.length>0&&""!=a[0].ColumnCostCenterID.toString()&&parseInt(a[0].ColumnCostCenterID.toString())>0?r[0][0].toString()+"_Key":r[0][0].toString()),i}GetFieldValue(e,i){let r=this.GetBomFieldName(e);return i.includes(r)?i[r].toString().Trim():""}ReadStructure(e,i){const r=new DOMParser,a=r.parseFromString(e,"application/xml");if(a){const u=a.childNodes[0];this.Feature.SelectedValue=u.attributes[0].value,this.Feature.SetSelectedItem_2(u.attributes[1].value,u.attributes[0].value),this._FeatureSelectedValue=this.Feature.SelectedItem.Aliasname,this.OnSelectionChanged(this),this.IsDuplicateNameAllowed=u.attributes.length>2&&"1"===u.attributes[2].value&&"IsDuplicate"===u.attributes[2].name,this.IsAutoCodeGen=u.attributes.length>3&&"1"===u.attributes[3].value&&"IsCodeAutoGen"===u.attributes[3].name,this.IsUpdate=u.attributes.length>4&&"1"===u.attributes[4].value&&"IsUpdate"===u.attributes[4].name,this.IsCode=u.attributes.length>5&&"1"===u.attributes[5].value&&"IsCodeBase"===u.attributes[5].name,this.IsProductwiseBarcode=u.attributes.length>6&&"1"===u.attributes[6].value&&"IsProductwiseBarcode"===u.attributes[6].name,this.BulkSave=u.attributes.length>7&&"1"===u.attributes[7].value&&"IsBulkSave"===u.attributes[7].name,null!==u.getAttribute("ValidateBeforeImport")&&(this.ValidateBeforeImport="1"===u.getAttribute("ValidateBeforeImport")),null!==u.getAttribute("UpdateStatusInExcel")&&(this.UpdateStatusInExcel="1"===u.getAttribute("UpdateStatusInExcel")),null!==u.getAttribute("AppendData")&&(this.AppendData="1"===u.getAttribute("AppendData")),null!==u.getAttribute("FillLocalReference")&&(this.FillLocalReference="1"===u.getAttribute("FillLocalReference")),Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4&&this.QtyRateVisible&&(null!==u.getAttribute("IsQtyChecked")&&(this.IsQtyChecked="true"===u.getAttribute("IsQtyChecked")),null!==u.getAttribute("QtyText")&&(this.QtyText.Text=u.getAttribute("QtyText")),null!==u.getAttribute("QtyCombo")&&(this.QtyCombo.SelectedValue=u.getAttribute("QtyCombo")),null!==u.getAttribute("IsRateChecked")&&(this.IsRateChecked="true"===u.getAttribute("IsRateChecked")),null!==u.getAttribute("RateText")&&(this.RateText.Text=u.getAttribute("RateText")),null!==u.getAttribute("RateCombo")&&(this.RateCombo.SelectedValue=u.getAttribute("RateCombo"))),null!==u.getAttribute("DoNotCreateCostCenter")&&(this.DoNotCreateCostCenter="1"===u.getAttribute("DoNotCreateCostCenter")),(Number(this.Feature.SelectedValue)>4e4&&Number(this.Feature.SelectedValue)<=5e4||93===Number(this.Feature.SelectedValue))&&this.LoadDocItems();for(let c=1;c<u.childNodes.length;c++){const t=u.childNodes[c];if(t.nodeName)for(let s=0;s<this.grData.Table.length;s++)""!==t.nodeName&&"Localref"!==t.nodeName&&(s+1).toString()===t.attributes[0].value&&(this.grData.Table[s].FeatureFieldName=t.attributes[2].value.toString())}this.grData.RefreshColumns();for(let c=0;c<u.childNodes.length;c++){const t=u.childNodes[c];if("Localref"===t.nodeName){const o=r.parseFromString(t.outerHTML,"application/xml").childNodes[0];for(let m=0;m<o.childNodes.length;m++){const h=o.childNodes[m];for(let n=0;n<this.DocItems.Items.length;n++)this.DocItems.Items[n].Value===h.attributes[2].value&&(this.DocItems.Items[n].IsChecked=!0)}}}this.grData.RefreshColumns()}}LoadDocItems(){let e=b.d.report.GetDataTable("IMP004",String(this.Feature.SelectedValue),b.d.SessionManager.LanguageID);if(null!=e&&e[0].length>0&&0==this.DocItems.Items.length)for(let i=0;i<e[0].length;i++)this.DocItems.Items.push(te.oN.CheckedListBoxItem_2(e[0][i].ResourceData.toString(),e[0][i].CostCenterColID.toString()))}OnSave(e){var i=this;return(0,Fe.A)(function*(){if(e.toString().Contains("Save")){let a="";if(i.grData.Table.length>0)if(N.J0.IsEmpty(i.Feature.SelectedValue)||"70"!=i.Feature.SelectedValue.toString()){a+='<XML Parent="'+i.Feature.SelectedValue+'" ParentName="'+N.J0.EncodeXML(i.Feature.SelectedItem.Name)+'"',a+=' IsDuplicate="'+(0,K.yG0)(i.IsDuplicateNameAllowed)+'" ',a+=' IsCodeAutoGen="'+(0,K.yG0)(i.IsAutoCodeGen)+'" ',a+=' IsUpdate="'+(0,K.yG0)(i.IsUpdate)+'" ',a+=' IsCodeBase="'+(0,K.yG0)(i.IsCode)+'"  ',a+=' IsProductwiseBarcode="'+(0,K.yG0)(i.IsProductwiseBarcode)+'" ',a+=' IsBulkSave="'+(0,K.yG0)(i.BulkSave)+'"   ',a+=' ValidateBeforeImport="'+(0,K.yG0)(i.ValidateBeforeImport)+'" ',a+=' UpdateStatusInExcel="'+(0,K.yG0)(i.UpdateStatusInExcel)+'" ',a+=' AppendData="'+(0,K.yG0)(i.AppendData)+'" ',a+=' FillLocalReference="'+(0,K.yG0)(i.FillLocalReference)+'" ',parseInt(i.Feature.SelectedValue)>4e4&&parseInt(i.Feature.SelectedValue)<=5e4&&i.QtyRateVisible&&(a+=' IsQtyChecked="'+i.IsQtyChecked+'" ',a+=' QtyText="'+i.QtyText.Text+'" ',a+=' QtyCombo="'+i.QtyCombo.SelectedValue+'" ',a+=' IsRateChecked="'+i.IsRateChecked+'" ',a+=' RateText="'+i.RateText.Text+'" ',a+=' RateCombo="'+i.RateCombo.SelectedValue+'" '),a+=' DoNotCreateCostCenter="'+(0,K.yG0)(i.DoNotCreateCostCenter)+'" ',a+=" > ";for(let u=0;u<i.grData.Table.length;u++)""!=i.grData.Table[u].FeatureFieldName&&null!=i.grData.Table[u].FeatureFieldName&&null!=i.grData.Table[u].FeatureFieldName&&(a+="<Row   ",a+=' RowNo="'+(u+1)+'"',a+=' FieldName="'+i.grData.Table[u].FieldName.toString()+'"',a+=' FeatureFieldName="'+N.J0.EncodeXML(i.grData.Table[u].FeatureFieldName.toString())+'"',a+="/>");if(i.DocItems.Items.length>0&&parseInt(i.Feature.SelectedValue)>4e4&&parseInt(i.Feature.SelectedValue)<=5e4||93==parseInt(i.Feature.SelectedValue)){let u=0;a+="<Localref>";for(let c=0;c<i.DocItems.Items.length;c++)i.DocItems.Items[c].IsChecked&&(u++,a+='<Row RowNo="'+u+'" ResData="'+i.DocItems.Items[c].Name+'" ColID="'+i.DocItems.Items[c].Value+'" />');a+="</Localref>"}if(a+="</XML>","SaveProfile"==e.toString()){if(null==i.ProfileName.Text||""==i.ProfileName.Text)return i.DisplayMessage="Enter Profile name",void(i.MessageVisibility=!0);{let u,c;c=b.d.document.SaveImportDetails(i.ProfileID,i.ProfileName.Text,i.ActualFileName,a.toString(),!1),i.DisplayMessage=c?.Message,u=c?.RetValue,i.MessageVisibility=!0,u>0&&(i.ProfileID=u)}}else if("SaveRim"==e.toString()){const u=a.toString?a.toString():a,c=new Blob([u],{type:"text/plain;charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(c),t.download="export.rim";try{console.log("ImportUtilityViewModel::Entering SaveFile"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(t.href),i.DisplayMessage="Saved file successfully",i.MessageVisibility=!0,console.log("ImportUtilityViewModel::Exiting SaveFile")}catch(s){i.DisplayMessage="Error in Exporting",i.MessageVisibility=!0,console.error("ImportUtilityViewModel::Error SaveFile",s)}}}else{if(!(i.BankAccounts.SelectedValue>0))return i.DisplayMessage=b.d.GetResource("SelectBankAccount"),void(i.MessageVisibility=!0);a+='<XML Parent="'+i.Feature.SelectedValue+'" ParentName="'+i.Feature.SelectedItem.Name+'"',a+=' IsDuplicate="'+(0,K.yG0)(i.IsDuplicateNameAllowed)+'" ',a+=' IsCodeAutoGen="'+(0,K.yG0)(i.IsAutoCodeGen)+'" ',a+=' IsUpdate="'+(0,K.yG0)(i.IsUpdate)+'" ',a+=' IsCodeBase="'+(0,K.yG0)(i.IsCode)+'"   ',a+=' IsProductwiseBarcode="'+(0,K.yG0)(i.IsProductwiseBarcode)+'" ',a+=' IsBulkSave="'+(0,K.yG0)(i.BulkSave)+'" ',a+=' ValidateBeforeImport="'+(0,K.yG0)(i.ValidateBeforeImport)+'" ',a+=' UpdateStatusInExcel="'+(0,K.yG0)(i.UpdateStatusInExcel)+'" ',a+=' AppendData="'+(0,K.yG0)(i.AppendData)+'" ',a+=' FillLocalReference="'+(0,K.yG0)(i.FillLocalReference)+'" ',a+=" > ",a+="<Row   ";for(let c=0;c<i.grData.Table.length;c++)if(""!=i.grData.Table[c].FeatureFieldName.toString()&&null!=i.grData.Table[c].FeatureFieldName){const t=i.ImportCols[1].ComboData.Table.Rows;for(const s of t)i.grData.Table[c].FeatureFieldName.toString()==s.CostCenterColID.toString()&&(a+=s.SysColumnName.toString()+'="'+i.grData.Table[c].FieldName.toString()+'" ')}a+="/>",a+="</XML>",i.DisplayMessage=b.d.document.SaveBRSDetails(a.toString(),i.BankAccounts.SelectedValue),i.MessageVisibility=!0}}else if("Open"==e.toString()){console.log("ImportUtilityViewModel::Entering OpenFile");const a=document.createElement("input");a.type="file",a.accept=".rim",a.onchange=function(){var u=(0,Fe.A)(function*(c){const t=c.target;if(!t.files||0===t.files.length)return;const s=t.files[0];try{const o=yield s.text();i.ReadStructure(o,!1),i.grData.RefreshColumns(),i.grData.RefreshGrid=!0,console.log("FromOpen",i.grData.Table)}catch(o){console.error("ImportUtilityViewModel::Error OpenFile",o)}finally{document.body.removeChild(a)}});return function(c){return u.apply(this,arguments)}}(),document.body.appendChild(a),a.click(),console.log("",i.grData.Table)}else if("Define"==e.toString()){if(i.LoadDocItems(),i.DocItems.Items.length>0)var r=new Jt.o;r.PactListBoxViewModel_1(i.DocItems.Items,b.d.GetResource("DDesigner_LRef")),b.d.page.ShowDialog(r,Qt.f,{ShowCenter:!0,Title:b.d.GetResource("DDesigner_LRef")})}else if("Preview"==e.toString())try{if(parseInt(i.Feature.SelectedValue.toString())>4e4&&parseInt(i.Feature.SelectedValue.toString())<5e4?i.ScanDocument(!1,!1,0,!1):i.IsScaned||i.ScanCostCenterFields(!1),i.IsScaned&&i.CCQuery.length>0)for(let u of i.CCQueryData.Items)if(""!=u.Value&&i.grData.Table.filter(t=>t.FieldName==t.Name).length>0){let t=new Ve.AddNoteViewModel;t.NoteID=0,u.Value.split(",");let o=i.grData.Table.filter(m=>m.FieldName==m.Name&&"-16"==m.FeatureFieldName);if(o.length>0)t.Note.Text="New Group("+u.Name+") will be created ";else if(o=i.grData.Table.filter(m=>m.FieldName==m.Name),o.length>0){const m=i.CostCenterFieldsAllTables.Tables[0];m.filter(h=>h.CostCenterColID===o[0].FeatureFieldName.toString()),m.length>0&&(t.Note.Text="New Dimension, "+m[0].UserColumnName.toString()+" ("+u.Name+") will be created ")}else t.Note.Text="New Dimension,  "+u.Name+" will be created ";t.Note.ToolTipDescription=u.Value,t.Note.Label=u.Name,i.NotesList.push(t)}if(i.ExcelTable.length>0){if(0==i.NotesList.length&&0==i.ErrorList.length&&0==i.RulesList.length&&("2"==i.Feature.SelectedValue||"3"==i.Feature.SelectedValue||parseInt(i.Feature.SelectedValue)>5e4&&parseInt(i.Feature.SelectedValue)<=50075))i.IsPreviewDataOk=!0;else{let u=i.ExcelTable,c=new Wt;c.PreviewDataViewModel(u,i),yield b.d.page.openDialog(c,Di,{ShowCenter:!0,Title:""}),console.log("afterClosePopup")}i.IsScaned||(null!=i.dsexcel&&(i.dsexcel=[]),i.ExcelTable=i.dsexcel[0])}}catch(a){Logger.ErrorLog("ImportUtilityViewModel::Error OpenFile",a.message)}else if("ExportFailedRecords"==e.toString()){const a=m=>null==m?"":String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),u=[];u.push("<html><body style='color:blac;background-color:white;'>"),u.push("<style>"),u.push(".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt}"),u.push(".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}"),u.push("</style>"),u.push("<table border=1 width='450' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >"),u.push("<tr>"),u.push("<tr><td class='hdr'><b>Sno<b></td>"),u.push("<td class='hdr' width='150'><b>Failed Records<b></td>"),u.push("<td class='hdr' width='250'><b>Message<b></td></tr>"),u.push("</tr>");for(let m=0;m<i.FailedRecourdList.length;m++){const h=i.FailedRecourdList[m]||{Name:"",Message:""};u.push(`<tr${m%2==1?"class='alt'":""}>`),u.push(`<td align='left' >${m+1} </td>`),u.push(`<td align='left' > ${a(h.Name)}</td>`),u.push(`<td align='left' >${a(h.Message)}</td>`),u.push("</tr>")}u.push("</table>"),u.push("</body></html>");const c=u.join(""),t=new Blob([c],{type:"applicaton/vnd.ms-excel"}),s=document.createElement("a"),o=URL.createObjectURL(t);s.setAttribute("href",o),s.setAttribute("download","ExportedRecords.xls"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}else if("Verify"==e.toString()){if(0==i.SavedIDs.length)return void(i.DisplayMessage="No records saved");let a,u,c=0,t="";t+="<PactRevenURpts>\n                < ID />\n                <Name>Import </Name>\n                < PactRevenURptDef >\n                <Name>Import </Name>\n                < ArabicName > Report </ArabicName>\n                < TotalColumns > 3 </TotalColumns>\n                < TotalGroups > 0 </TotalGroups>\n                < GridLines > 3 </GridLines>\n                < VAlign > Bottom </VAlign>\n                < Columns >\n                <HeaderHeight>30 </HeaderHeight>\n                < RowHeight > 22 </RowHeight>\n                < SubRowHeight > 22 </SubRowHeight>";for(let m of i.grData.Table)a=i.CostCenterFieldsAllTables.Tables[0].filter(h=>h.CostCenterColID==m[1].toString()),u=a[0],t+='<ColumnDef><Identity><ID>C" + colCnt + @"</ID>\n                    < Sequence > " + colCnt + @" </Sequence>\n                    < Caption > " + row[0].toString() + @" </Caption>\n                    < Category > 103 </Category>\n                    < Field > 26445 </Field>\n                    < SelectedField > 25543 </SelectedField>\n                ',"DATE"==u.ColumnDataType.toString()?t+="<Type>STRING</Type>":"FLOAT"==u.ColumnDataType.toString()?t+="<Type>FLOAT</Type>":t+="<Type>STRING</Type>",t+="</Identity>\n                    < Width > 120 </Width>\n                    < HeaderAppearance >\n                    <Alignment>Center </Alignment>\n                    < Font > Calibri </Font>\n                    < FontSize > 12 </FontSize>\n                    < FontBold > True </FontBold>\n                    </HeaderAppearance>\n                    < DataAppearance > ","FLOAT"==u.ColumnDataType.toString()&&(t+="<Alignment>Right</Alignment>"),t+="<Alignment>Left</Alignment>",t+="<Font>Calibri</Font>\n                    < FontSize > 13 </FontSize>\n                    </DataAppearance>","DATE"==u.ColumnDataType.toString()?t+="<Format><DateType>dd/MMM/yyyy</DateType></Format>":"FLOAT"==u.ColumnDataType.toString()?t+="<Format>\n                        < Decimals > -1 </Decimals>\n                        < Commas > -1 </Commas>\n                        </Format>":t+="<Format></Format>",t+="</ColumnDef>",c++;t+="</Columns>\n                < Groups > </Groups>\n                < ReportTotal >\n                <Identity>\n                <ID></ID>\n                < Prefix > REPORT TOTAL </Prefix>\n                    < ShowCaption > 1 </ShowCaption>\n                    < Level > 0 </Level>\n                    </Identity>\n                    < Appearance >\n                    <ShowUnder></ShowUnder>\n                    < Width > -1 </Width>\n                    < Height > 22 </Height>\n                    < Border > 0 </Border>\n                    < Visibility > 0 </Visibility>\n                    < Font > Calibri </Font>\n                    < Alignment > Left </Alignment>\n                    < FontSize > 14 </FontSize>\n                    < FontBold > True </FontBold>\n                    </Appearance>\n                    < Format >\n                    <Decimals>2 </Decimals>\n                    < Commas > 1 </Commas>\n                    </Format>\n                    < Columns >\n                    </Columns>\n                    </ReportTotal>\n\n                    </PactRevenURptDef>\n                    < Filters >\n                    <PreDataFetch>\n                    <TreeFilter></TreeFilter>\n                    < FieldFilter > </FieldFilter>\n                    </PreDataFetch>\n                    < PostDataFetch > </PostDataFetch>\n                    </Filters>\n                    </PactRevenURpts>";let s=[];s.push("ReportName"),s.push("ReportTypeID"),s.push("ReportID"),s.push("ReportTypeName"),s.push("IsUserDefined"),s.push("ReportDefnXML"),s.push("StaticReportType"),s.push("DefaultPreferences"),s.push("CustomPreferences"),s.push("TreeXML"),s.push("ReportBody"),s.push("ReportHeader"),s.push("PageHeader"),s.push("PageFooter"),s.push("ReportFooter"),s.push("RowColumnReportsMap"),s.push("KPIXML"),s.push("QUERY"),s.push("MatrixXML"),s.push("FormulaFields");let o={ReportID:0,ReportName:"Import",ReportTypeID:0,ReportTypeName:"Grid",IsUserDefined:1};o.ReportDefnXML=t.toString(),o.StaticReportType=0,o.DefaultPreferences="",o.CustomPreferences="<XML><HideCostCenterTree>1</HideCostCenterTree><HidePrefetch>1</HidePrefetch></XML>",o.TreeXML="",o.ReportBody="",o.ReportHeader="",o.PageHeader="",o.PageFooter="",o.ReportFooter="",o.FormulaFields="",o.QUERY=i.setQuery(),o.MatrixXML="",s.push(o)}else"Validate"==e.toString()&&(i.IsSaveDocValidate=!0,i.ImportingMessage="Validating Data Please Wait....",i.ImportDataClick())})()}ScanCostCenterFields(e){if(this.IsScaned)return!0;this.NotesList=[],this.Previewinfo="";let h,S,i=null,r=null,a=null,c=!1,t=!1,s=!1,o=!1,T="";Logger.InfoLog("ImportCosCenters --\x3eEntering ScanCostCenterFields reading excel data for filling id of Account/Product/Dimensions"),3==parseInt(this.Feature.SelectedValue)?(S=this.CostCenterFieldsAllTables.Tables[8].filter(d=>"NameSameasCode"==d.Name),S.length>0&&(this.NameSameasCode=(0,K.yG0)(S[0].Value))):parseInt(this.Feature.SelectedValue)>5e4&&(S=this.CostCenterFieldsAllTables.Tables[6].filter(d=>"NameSameasCode"==d.Name),S.length>0&&(this.NameSameasCode=(0,K.yG0)(S[0].Value)));for(let d=0;d<this.ExcelTable.length;d++)for(let y of this.grData.Table){let f=this.ExcelDataColumn.indexOf(y.FieldName);const D=y.FeatureFieldName;if(null!=D&&""!=D.toString()&&"0"!=D.toString()&&(i=this.CostCenterFieldsAllTables.Tables[0].filter(p=>p.CostCenterColID==D.toString()),i.length>0)){if(i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_FromDate")&&i[0].CostCenterColID.toString().endsWith("000")||i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_ToDate")&&i[0].CostCenterColID.toString().endsWith("001")||i[0].SysColumnName.toString().toUpperCase().startsWith("CCNID")&&i[0].SysColumnName.toString().endsWith("_Remarks")&&i[0].CostCenterColID.toString().endsWith("002"))continue;if("AccountName"==i[0].SysColumnName.toString()&&"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==i[0].SysColumnName.toString()||"BOMName"==i[0].SysColumnName.toString()||"Name"==i[0].SysColumnName.toString()||"FirstName"==i[0].SysColumnName.toString()||"Company"==i[0].SysColumnName.toString()||"CaseNumber"==i[0].SysColumnName.toString()||"ProductName"==i[0].SysColumnName.toString()||"BaseName"==i[0].SysColumnName.toString()||"BatchNumber"==i[0].SysColumnName.toString()||"ProfileName"==i[0].SysColumnName.toString())c=!0;else if("IsBillwise"==i[0].SysColumnName.toString()||"IsGroup"==i[0].SysColumnName.toString()){if("IsBillwise"==i[0].SysColumnName.toString()&&(s=!0),"yes"!=this.ExcelTable[d][f].toLowerCase()&&"no"!=this.ExcelTable[d][f].toLowerCase()&&!(0,K.yG0)(this.ExcelTable[d][f])){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage=s?"Incorrect Billwise information at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", expected Yes/No]":"Incorrect Group information at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", expected Yes/No] at Excel ColumnName "+this.ExcelTable[y.FieldName.toString()],this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(p);let F=new Ve.AddNoteViewModel;F.NoteID=0;let E=String(d+1),V=this.ExcelTable[d][f];F.Note.Text=s?`Incorrect Billwise information at Row  ${E}, ${V}, expected Yes/No`:`Incorrect Group information at Row " ${E}, ${V},expected Yes/No] at Excel ColumnName  ${V}`,this.ErrorList.push(F)}}}else if("UOMID"==i[0].SysColumnName.toString()||"unit"==i[0].SysColumnName.toString().toLowerCase()||"PurchaseUOM"==i[0].SysColumnName.toString()){let p=this.ExcelDataColumn[f]+"_Key";if(this.ExcelDataColumn.includes(p)||(this.ExcelDataColumn.push(p),this.temp.includes(parseInt(i[0].ColumnCostCenterID.toString()))||this.temp.push(parseInt(i[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[d][f]){let F;h=4,a=r=null,e?(h=2,""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0?(a=this.CostCenterFieldsAllTables.Tables[0].filter(E=>"ProductID"==E.SysColumnName&&E.CostCenterColID>0),a.length>0&&(r=this.grData.Table.filter(E=>E.FeatureFieldName==a[0].CostCenterColID.toString()))):(r=this.grData.Table.filter(E=>"-1"==E.FeatureFieldName),0==r.length&&(r=this.grData.Table.filter(E=>"-12"==E.FeatureFieldName))),r.length>0&&(F=this.CostCenterFieldsAllTables.Tables[h].filter(this.IsCode?E=>E.UnitName==this.ExcelTable[d][f]&&E.ProductCode==this.ExcelTable[d][this.ExcelDataColumn.indexOf(r[0].FieldName.toString().Trim())]:E=>E.UnitName==this.ExcelTable[d][f]&&E.ProductName==this.ExcelTable[d][this.ExcelDataColumn.indexOf(r[0].FieldName.toString().Trim())])),0==F.length&&(F=this.CostCenterFieldsAllTables.Tables[h].filter(E=>E.UnitName==this.ExcelTable[d][f]&&null!==E.ProductName&&"DynamicSet"==E.ProductName))):(""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0&&(a=this.CostCenterFieldsAllTables.Tables[0].filter(this.IsCode?E=>"ProductCode"==E.SysColumnName&&E.CostCenterColID>0:E=>"ProductName"==E.SysColumnName&&E.CostCenterColID>0),a.length>0&&(r=this.grData.Table.filter(E=>E.FeatureFieldName==a[0].CostCenterColID.toString()))),r.length>0?(F=this.CostCenterFieldsAllTables.Tables[h].filter(this.IsCode?E=>E.UnitName==this.ExcelTable[d][f]&&E.ProductCode==this.ExcelTable[d][this.ExcelDataColumn.indexOf(r[0].FieldName.toString().Trim())]:E=>E.UnitName==this.ExcelTable[d][f]&&E.ProductName==this.ExcelTable[d][this.ExcelDataColumn.indexOf(r[0].FieldName.toString().Trim())]),0==F.length&&(F=this.CostCenterFieldsAllTables.Tables[h].filter(E=>E.UnitName==this.ExcelTable[d][f].replace("'","''")))):F=this.CostCenterFieldsAllTables.Tables[h].filter(E=>E.UnitName==this.ExcelTable[d][f].replace("'","''"))),F.length>0?this.ExcelTable[d][p]=F[0].UOMID.toString():(this.temp.includes(parseInt(i[0].ColumnCostCenterID.toString()))||this.temp.push({[parseInt(i[0].ColumnCostCenterID.toString())]:[]}),this.temp[parseInt(i[0].ColumnCostCenterID.toString())].Contains(this.ExcelTable[d][f].toLowerCase())||(this.temp[parseInt(i[0].ColumnCostCenterID.toString())].push(this.ExcelTable[d][f].toLowerCase()),this.Uomsb+="<Row  PrimaryKey='0' UName='"+U.Dw.GetValidXml(this.ExcelTable[d][f])+"'  ConversionRate='1' MapAction='NEW' />"))}}else if("SubstituteGroup"==i[0].SysColumnName.toString()||"SubstituteProduct"==i[0].SysColumnName.toString())this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),e,!1);else if(i[0].SysColumnName.toString().startsWith("Assigned_")&&parseInt(i[0].ColumnCostCenterID)>0)"7"==this.Feature.SelectedValue?this.CheckAssignedCostCenters(d,parseInt(i[0].ColumnCostCenterID),y.FieldName.toString(),this.IsCode):""!=i[0].CostCenterColID.toString()&&parseInt(i[0].CostCenterColID.toString())>0?this.CheckAssignedCostCenters(d,parseInt(i[0].ColumnCostCenterID),y.FieldName.toString(),!0):this.CheckAssignedCostCenters(d,parseInt(i[0].ColumnCostCenterID),y.FieldName.toString(),!1);else if(null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0)""!=this.ExcelTable[d][f]&&("Cross Dimension"==this.Feature.SelectedItem.Name&&this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),e,this.IsCode),44==parseInt(i[0].ColumnCostCenterID)?this.CheckLookupField(d,parseInt(i[0].ColumnCCListViewTypeID.toString()),y.FieldName.toString()):"76"==this.Feature.SelectedValue&&"Bill Of Materials With Multiple Stage"==this.Feature.SelectedItem.Name?this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),e,this.IsCode):"Job Output"==this.Feature.SelectedItem.Name&&"Code"==i[0].SysColumnName.toString()?this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),!0,!0):"Job Output"==this.Feature.SelectedItem.Name&&-158!=parseInt(y.FeatureFieldName)?this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),!0,this.IsCode):-1==parseInt(y.FeatureFieldName)||-12==parseInt(y.FeatureFieldName)||-7==parseInt(y.FeatureFieldName)||-9==parseInt(y.FeatureFieldName)?this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),!0,!1):parseInt(y.FeatureFieldName)>0||-16==parseInt(y.FeatureFieldName)||-30==parseInt(y.FeatureFieldName)||-23==parseInt(y.FeatureFieldName)||-29==parseInt(y.FeatureFieldName)||-30==parseInt(y.FeatureFieldName)?this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),e,this.IsCode):this.CheckCostCenterField(d,parseInt(i[0].ColumnCostCenterID.toString()),y.FieldName.toString(),e,!0));else if("StatusID"!=i[0].SysColumnName.toString()&&("RoleID"!=i[0].SysColumnName.toString()||50051!=parseInt(i[0].CostCenterID)))if("AccountTypeID"==i[0].SysColumnName.toString()){if(t=!0,a=null,a=this.CostCenterFieldsAllTables.Tables[2].filter(p=>(p.ResourceData?p.ResourceData.toString().toLowerCase():"")==(this.ExcelTable[d][f]?this.ExcelTable[d][f].toString().toLowerCase():"")),0==a.length){T="";for(let p of this.CostCenterFieldsAllTables.Tables[2])T+=p.ResourceData.toString()+",";if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect Account Type at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", Expected values : "+T.substring(0,T.length-1)+"]",this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect Account Type at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", Expected values : "+T.substring(0,T.length-1)+"]",this.ErrorList.push(p)}}}else if("Contact_ContactTypeID"==i[0].SysColumnName.toString()){if(T="",T=this.ExcelTable[d][f],"Primary"!=T&&"Secondary"!=T){if("2"!=this.Feature.SelectedValue&&"3"!=this.Feature.SelectedValue)return this.DisplayMessage="Incorrect contact Type  information at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", Expected values 'Primary, Secondary]",this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect contact Type  information at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", Expected values 'Primary, Secondary]",this.ErrorList.push(p)}}}else if("ProductTypeID"==i[0].SysColumnName.toString()){t=!0,a=null,a=this.CostCenterFieldsAllTables.Tables[2].filter(p=>(p.ResourceData?p.ResourceData.toString().toLowerCase():"")==(this.ExcelTable[d][f]?this.ExcelTable[d][f].toString().toLowerCase():"")),T="";for(let p of this.CostCenterFieldsAllTables.Tables[2])T+=p.ResourceData.toString()+",";if(0==a.length){let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect Product Type at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+", Expected values : -"+T.substring(0,T.length-1)+"]",this.ErrorList.push(p)}}else if("ValuationID"==i[0].SysColumnName.toString()){o=!0,T="";for(let p of this.CostCenterFieldsAllTables.Tables[3])T+=p.ResourceData.toString()+",";if("FIFO"!=this.ExcelTable[d][f]&&"LIFO"!=this.ExcelTable[d][f]&&"Weighted Average"!=this.ExcelTable[d][f]&&""!=this.ExcelTable[d][f]){let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect Valuation Method at Row "+(d+1).toString()+", ["+this.ExcelTable[d][f]+" , Expected values :- "+T.substring(0,T.length-1)+"]",this.ErrorList.push(p)}}else if(i[0].ColumnDataType&&"int"==i[0].ColumnDataType.toString().toLowerCase()||i[0].ColumnDataType&&"bigint"==i[0].ColumnDataType.toString().toLowerCase()){if(!parseInt(this.ExcelTable[d][f])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+y.FieldName.toString()+" information at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+", Expected numeric values]",this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect "+y.FieldName.toString()+" information at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+", Expected numeric values]",this.ErrorList.push(p)}}}else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){if(""!=this.ExcelTable[d][f]&&!parseFloat(this.ExcelTable[d][f])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+y.FieldName.toString()+" at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+"]",this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect "+y.FieldName.toString()+" at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+", Expected numeric values]",this.ErrorList.push(p)}}}else if(i[0].ColumnDataType&&"datetime"==i[0].ColumnDataType.toString().toLowerCase()&&!N.J0.isValidDate(this.ExcelTable[d][f])){if(!("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue||parseInt(this.Feature.SelectedValue)>5e4))return this.DisplayMessage="Incorrect "+y.FieldName.toString()+" at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+", Expected Date in format 'dd/MMM/yyy']",this.MessageVisibility=!0,!1;{let p=new Ve.AddNoteViewModel;p.NoteID=0,p.Note.Text+="Incorrect "+y.FieldName.toString()+" at Row "+(d+1).toString()+",["+this.ExcelTable[d][f]+", Expected Date in format 'dd/MMM/yyy']",this.ErrorList.push(p)}}}}let I=c;if("50051"==this.Feature.SelectedValue){let d="",y="",f="",D=null;const p=this.grData.Table;if(D=p.filter(F=>"30000"==F.FeatureFieldName),D.length>0&&(d=D[0].FieldName.toString()),D=p.filter(F=>"30001"==F.FeatureFieldName),D.length>0&&(y=D[0].FieldName.toString()),this.IsCode&&""==d)return this.DisplayMessage="Please select employee code field",this.MessageVisibility=!0,!1;if(!this.IsCode&&""==y&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select employee name field",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""==y&&(null==this.UpdateBasedOn.SelectedValue||""==this.UpdateBasedOn.SelectedValue))return this.DisplayMessage="Please select Based on Unique Field to Update",this.MessageVisibility=!0,!1;if(this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue){let F=this.CostCenterFieldsAllTables.Tables[0].Select("SysColumnName='"+this.UpdateBasedOn.SelectedValue+"'");if(null!=F&&F.length>0&&(f=F[0].SysColumnName.toString(),D=p.filter(E=>E.FeatureFieldName==F[0].CostCenterColID.toString()),0==D.length))return this.DisplayMessage="Please select Employee - "+F[0].UserColumnName.toString()+" field in the Mappings",this.MessageVisibility=!0,!1}this.IsUpdate&&!this.IsCode&&""!=this.UpdateBasedOn.SelectedValue&&(I=!0)}if(!I&&!c&&this.ExcelTable.length>0&&!this.NameSameasCode&&"10"!=this.Feature.SelectedValue)return this.DisplayMessage="Name does not exists",this.MessageVisibility=!0,!1;if(("2"==this.Feature.SelectedValue||"3"==this.Feature.SelectedValue)&&!t&&this.ExcelTable.length>0&&!this.IsUpdate){let d=new Ve.AddNoteViewModel;d.NoteID=0,d.Note.Text="2"==this.Feature.SelectedValue?"Account Type not selected, debtors will be set as default type.":"Product Type not selected, General will be set as default type.",this.RulesList.push(d)}if(!s&&"2"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let d=new Ve.AddNoteViewModel;d.NoteID=0,d.Note.Text="Bill wise is not set for Debtors / Creditors type of account, by default it will set to Yes",this.RulesList.push(d)}if(!o&&"3"==this.Feature.SelectedValue&&this.ExcelTable.length>0&&!this.IsUpdate){let d=new Ve.AddNoteViewModel;d.NoteID=0,d.Note.Text="Valuation method is not set product, by default it will set to defined at product preferences",this.RulesList.push(d)}return!0}extradataImport(e,i,r){this.FillLookupFields(),this.DoNotCreateCostCenter||this.FillCostCenterFields(!1);let a=[];if(""!=i.toString()){Logger.InfoLog("ScanCostCenterFields: Importing UOM Dat values="+i.toString()),i+="</XML>",a.push(""),a.push(0),a.push("<XML>"+i.toString()),a.push(1),a.push(b.d.SessionManager.CompanyGUID),a.push(b.d.SessionManager.UserName),a.push(b.d.SessionManager.RoleID),a.push(b.d.SessionManager.LanguageID);let u=b.d.document.AddUOMWithDataset(a);if(null!=u&&u.Tables.length>0&&u.Columns[0].Contains("ErrorMessage"))return this.DisplayMessage=u.Tables[0][0].ErrorMessage.toString(),!1;for(let c=0;c<u.Tables[0].length;c++){const t=u.Tables[0][c].UnitName.toString().replace("*","**"),s=this.ExcelTable[r.replace("_Key","")],o=this.ExcelTable.filter(m=>m[s]?.toString()===t);if(o.length>0)for(let m of o)m[r]=u.Tables[0][c].UOMID.toString()}}return!0}ScanServiceDimensionFields(e){const i=this.CostCenterFieldsAllTables.Tables[0];let r=null;new Ge;for(let u=0;u<this.ExcelTable.length;u++)for(let c of this.grData.Table)if(null!=c.FeatureFieldName&&""!=c.FeatureFieldName.toString()&&"0"!=c.FeatureFieldName.toString()&&(r=i.filter(t=>t.CostCenterColID==c.FeatureFieldName.toString()),r.length>0&&null!=r[0].ColumnCostCenterID&&""!=r[0].ColumnCostCenterID.toString()&&parseInt(r[0].ColumnCostCenterID.toString())>0))if(""!=this.ExcelTable[u][c.FieldName.toString()]&&"3"==this.Feature.SelectedValue)this.CheckCostCenterField(u,parseInt(i[0].ColumnCostCenterID.toString()),c.FieldName.toString(),e,!1);else if(""!=this.ExcelTable[u][c.FieldName.toString()]&&"Account Dimension wise Cr/Dr Limits"==this.Feature.SelectedItem.Name){if(this.IsCode){let t=this.ExcelTable[c.FieldName.toString()].ColumnName+"_Name";this.ExcelTable.includes(t)||this.ExcelTable.push(t)}this.CheckCostCenterField(u,parseInt(i[0].ColumnCostCenterID.toString()),c.FieldName.toString(),e,this.IsCode)}return this.FillCostCenterFields(e),!0}ImportServicestoDimension(){const e=this.CostCenterFieldsAllTables.Tables[0];if(!this.ScanServiceDimensionFields(!1))return;let i=0,r="",a=[];r+="<XML>";for(let u=0;u<this.ExcelTable.length;u++,this.ProgressValue++){a.length=0;let o,c="",t="",s="";r+="<Row ";for(let h=0;h<this.grData.Table.length;h++)if(null!=this.grData.Table[h].FeatureFieldName&&""!=this.grData.Table[h].FeatureFieldName.toString()&&(e.filter(n=>n.CostCenterColID==this.grData.Table[h].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Dimension":s="CostCenterID='"+this.CostCenterid.toString()+"'  NodeID='"+this.ExcelTable[u][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"', ";break;case"ServiceName":"3"==this.Feature.SelectedValue.toString()&&(r+='AccountName ="'+U.Dw.GetValidXml(this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()])+'" ',c=this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]),this.ExcelTable.includes(this.grData.Table[h].FieldName.toString()+"_Key")&&(t+="Product ='"+this.ExcelTable[u][this.grData.Table[h].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]?""!=this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]||"M"==this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()]||"2"==this.ExcelTable[u][this.grData.Table[h].FieldName.toString().Trim()])&&(t+=e[0].SysColumnName.toString()+" ='2'  "):t+=e[0].SysColumnName.toString()+" ='1'  "}if(""!=s&&(r+='LinkOption="'+s.substring(0,s.length-2)+'"  '),""!=t&&(r+='LinkFields ="'+t.substring(0,t.length-2)+'" '),""==c)continue;r+=" ></Row>",r+="</XML>";let m=[];m.push(r.toString()),m.push(this.Feature.SelectedValue),m.push(b.d.SessionManager.CompanyIndex),o=b.d.document.SetImportServicetoDimension(m),o>0&&(i++,this.FailedRecourdList.push({Name:c,Message:o})),r="",r+="<XML>",this.ImportedCount="Imported :"+(u+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}onPreviewcallback(){this.IsPreviewDataOk&&this.ImportCosCenters()}onPreviewDataClick(){var e=this;return(0,Fe.A)(function*(){e.IsScaned=!1,e.ScanCostCenterFields(!1)&&(e.IsScaned=!0,yield e.OnSave("Preview"))})()}ImportCosCenters(){var e=this;return(0,Fe.A)(function*(){Logger.InfoLog("Entering ImportCosCenters ");const i=e.costCenterTableZero;if(("2"==e.Feature.SelectedValue||"3"==e.Feature.SelectedValue||parseInt(e.Feature.SelectedValue)>=5e4&&parseInt(e.Feature.SelectedValue)<=50075)&&!e.IsScaned)yield e.onPreviewDataClick();else if(!e.ScanCostCenterFields(!1))return;if(!e.extradataImport(!1,e.Uomsb,e.UomCol))return;e.GroupsImport&&0==e.GroupTotCount&&(e.GroupfailCount=0,e.GroupTotCount=0),Logger.InfoLog("After validating data");let s,m,r=0,a=0,u="",c=null,t="",o="",h=null;if(null!=e.CodeDef&&e.IsAutoCodeGen){Logger.InfoLog("check for code information from defination");let A=e.CodeDef.filter(Be=>0==Be.IsName||null==Be.IsName);A.length>0&&A[0].PrefixContent.toString().length>0&&(h=new N.VB,h.LoadXml(A[0].PrefixContent.toString()))}t+="<XML>",o+="<History>";let n=!1,l=!1,g=!1,T=!1,S=!1,I=!1,d=!1,y=!1,f=!1,D=!1,p=0,F=0,E=0,V=0,L=0,O="",x="",B="",q="",$="",Z="",k="",ie="",ne="",Re="",ye="",w="",W=null;for(let A=0;A<e.ExcelTable.length;A++,e.ProgressValue++){if("PASS"==e.ExcelTable[A].IMPORT_STATUS){a++;continue}if(Logger.InfoLog("Excel table row no:"+A+1),s="",n=!1,l=!1,g=!1,T=!1,S=!1,I=!1,d=!1,y=!1,f=!1,D=!1,p=0,F=0,E=0,V=0,O="",x="",B="",q="",$="",Z="",k="",ie="",ne="",Re="",ye="",w="",m="",null!=h&&(Logger.InfoLog("ImportCosCenters Getting code information for the row"),c=e.GetCodeData(e.ExcelTable[A],0)),e.ExcelTable.includes("IsDeleted")&&""!=e.ExcelTable[A].IsDeleted.toString()&&(0,K.yG0)(e.ExcelTable[A].IsDeleted.toString())){if(w="",w="2"==e.Feature.SelectedValue?"AccountName":"3"==e.Feature.SelectedValue?"ProductName":"Name",i.filter(ae=>ae.SysColumnName==w).length>0){let ae=e.grData.Table.filter(R=>R.FeatureFieldName==i[0].CostCenterColID.toString());ae.length>0&&(x=e.ExcelTable[A][ae[0].FieldName.toString().Trim()].toString())}r++,e.FailedRecourdList.push({Name:x,Message:"New data exist for masters"});continue}t+="<Row ";for(let J=0;J<e.grData.Table.length;J++){let R=e.ExcelDataColumn.indexOf(e.DtImport[J].FieldName);if(null==e.grData.Table[J].FeatureFieldName||""==e.grData.Table[J].FeatureFieldName.toString()||"-200"==e.grData.Table[J].FeatureFieldName.toString())continue;let Q=i.filter(_e=>_e.CostCenterColID==e.grData.Table[J].FeatureFieldName.toString());if(Q.length>0){let _e=Q[0].SysColumnName.toString();switch(Logger.InfoLog("ImportCosCenters Columnname ="+_e),_e){case"StatusID":const Te=e.CostCenterFieldsAllTables.Tables[1].filter(he=>he.ResourceData==e.ExcelTable[A][R]);Te.length>0&&(t+='StatusID ="'+Te[0].StatusID.toString()+'" ');break;case"AccountTypeID":const Xe=e.CostCenterFieldsAllTables.Tables[2].filter(he=>he.ResourceData==e.ExcelTable[A][R]);if(Xe.length>0){t+='TypeID ="'+Xe[0].AccountTypeID.toString()+'" ';try{p=parseInt(Xe[0].AccountTypeID.toString())}catch{p=0}}break;case"CustomerTypeID":t+='TypeID ="1" ';break;case"ProductTypeID":const v=e.CostCenterFieldsAllTables.Tables[2].filter(he=>he.ResourceData==e.ExcelTable[A][R]);v.length>0&&(t+='TypeID ="'+v[0].ProductTypeID.toString()+'" ');break;case"ValuationID":const se=e.CostCenterFieldsAllTables.Tables[3].filter(he=>he.ResourceData==e.ExcelTable[A][R]);I=!0,se.length>0?t+='ValuationID ="'+se[0].ValuationID.toString()+'" ':I=!1;break;case"UOMID":S=!0,k+="UOMID ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseUOM":k+="PurchaseUOM ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":t+='PurchaseAccount ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ',l=!0;break;case"SalesAccountID":case"SalesAccount":n=!0,t+='SalesAccount ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ';break;case"DrOptionID":y=!0,"FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"FDOM"==e.ExcelTable[A][R].toUpperCase()||"1"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"LDOM"==e.ExcelTable[A][R].toUpperCase()||"2"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==e.ExcelTable[A][R].toUpperCase()||"BC"==e.ExcelTable[A][R].toUpperCase()||"3"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DUFDM"==e.ExcelTable[A][R].toUpperCase()||"4"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DUFDM"==e.ExcelTable[A][R].toUpperCase()||"5"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DOFDM"==e.ExcelTable[A][R].toUpperCase()||"6"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DOFDM"==e.ExcelTable[A][R].toUpperCase()||"7"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==e.ExcelTable[A][R].toUpperCase()||"LDNM"==e.ExcelTable[A][R].toUpperCase()||"8"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='8', ":k+=Q[0].SysColumnName.toString()+" ='0', ";break;case"CrOptionID":d=!0,"FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"FDOM"==e.ExcelTable[A][R].toUpperCase()||"1"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"LDOM"==e.ExcelTable[A][R].toUpperCase()||"2"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='2', ":"BILLING CYCLE"==e.ExcelTable[A][R].toUpperCase()||"BC"==e.ExcelTable[A][R].toUpperCase()||"3"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='3', ":"DUE DATE AS FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DUFDM"==e.ExcelTable[A][R].toUpperCase()||"4"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='4', ":"DUE DATE AS LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DUFDM"==e.ExcelTable[A][R].toUpperCase()||"5"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='5', ":"DOC DATE AS FIRST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DOFDM"==e.ExcelTable[A][R].toUpperCase()||"6"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='6', ":"DOC DATE AS LAST DAY OF MONTH"==e.ExcelTable[A][R].toUpperCase()||"DOFDM"==e.ExcelTable[A][R].toUpperCase()||"7"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='7', ":"LAST DAY OF NEXT MONTH"==e.ExcelTable[A][R].toUpperCase()||"LDNM"==e.ExcelTable[A][R].toUpperCase()||"8"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='8', ":k+=Q[0].SysColumnName.toString()+" ='0', ";break;case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":t+=Q[0].SysColumnName.toString()+' ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ';break;case"Year":if(e.ExcelTable[A][R].Contains("-")){let he=[];he=e.ExcelTable[A][R].split("-"),E=he.length>0&&parseInt(he[0]),E=E?parseInt(he[0]):0,V=he.length>1&&parseInt(he[1]),V=V?parseInt(he[1]):0}else E=parseInt(e.ExcelTable[A][R])?parseInt(e.ExcelTable[A][R]):0;break;case"AccountCode":case"FirstName":case"ProductCode":case"CustomerCode":case"Code":null==c&&(t+='AccountCode ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" '),(3==parseInt(e.Feature.SelectedValue)||parseInt(e.Feature.SelectedValue)>5e4)&&e.NameSameasCode&&(t+='AccountName ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ');break;case"CodePrefix":case"CodeNumber":null==c&&(t+=_e+'="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ');break;case"AccountName":case"CustomerName":case"Company":case"Name":case"ProductName":"51"!=e.Feature.SelectedValue.toString()?(e.NameSameasCode||(t+='AccountName ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" '),x=e.ExcelTable[A][R]):"CustomerName"==Q[0].SysColumnName.toString()?(t+='AccountName ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ',x=e.ExcelTable[A][R]):null!=Q[0].ColumnCostCenterID&&""!=Q[0].ColumnCostCenterID.toString()&&parseInt(Q[0].ColumnCostCenterID.toString())>0&&(k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ");break;case"BarcodeID":t+='BarcodeID="'+e.ExcelTable[A][R]+'" ';break;case"ProductGroup":case"ParentGroupName":t+='GroupName ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ',N.J0.IsEmpty(e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString())?(t+='SelectedNode ="1" ',F=1):(t+='SelectedNode ="'+U.Dw.GetValidXml(e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString().Trim())+'" ',F=parseInt(e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()));break;case"AccountId":case"CustomerId":"65"==e.Feature.SelectedValue.toString()&&("CustomerId"==Q[0].SysColumnName.toString()?q+=" CCID='83'  CustomerName ='"+U.Dw.GetValidXml(e.ExcelTable[A][R])+"'  ":"AccountId"==Q[0].SysColumnName.toString()&&(q+=" CCID='2'   CustomerName ='"+U.Dw.GetValidXml(e.ExcelTable[A][R])+"'  "));break;case"IsGroup":case"IsBillwise":if("IsGroup"==_e){if(Logger.InfoLog("Group value"+e.ExcelTable[A][R].toLowerCase()),("true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R]||"on"==e.ExcelTable[A][R].toLowerCase())&&e.CCQuery.length>0&&e.ccdv.length>0)for(var de of e.CCQuery)if(console.log("itemsCCQuery",de),""!=de.value&&de.Key.toString()==e.Feature.SelectedValue&&!D)for(let he=0;he<e.ccdv[de.Key].length;he++){const Me=e.ccdv[de].Name.toString().replace("*","**"),ke=e.ExcelTable[e.COls[de.Key].replace("_Key","")];if(e.ExcelTable.filter(pe=>pe[ke]?.toString()===Me).length>0&&e.ccdv[de.Key][he].Name.toString()==x){D=!0;break}}}else f=!0;"true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R]||"on"==e.ExcelTable[A][R].toLowerCase()?t+=Q[0].SysColumnName.toString()+' ="1" ':t+=Q[0].SysColumnName.toString()+' ="0" ';break;case"PlanningMethod":"mrp"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R].toLowerCase()?k+=Q[0].SysColumnName.toString()+" ='1' , ":k+=Q[0].SysColumnName.toString()+" ='0' , ";break;case"ProcurementMethod":"produced"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R].toLowerCase()?k+=Q[0].SysColumnName.toString()+" ='1' , ":k+=Q[0].SysColumnName.toString()+" ='0' , ";break;case"BinWise":"true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R].toLowerCase()||"on"==e.ExcelTable[A][R].toLowerCase()?t+=Q[0].SysColumnName.toString()+' ="1" ':t+=Q[0].SysColumnName.toString()+' ="0" ';break;case"IsPacking":case"BOM":e.ExcelTable.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&!N.J0.IsEmpty(e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString())&&(k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ");break;case"IsBillOfEntry":"fifo"==e.ExcelTable[A][R].toLowerCase()||"2"==e.ExcelTable[A][R]?k+=Q[0].SysColumnName.toString()+" ='2' , ":"true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R]||"on"==e.ExcelTable[A][R].toLowerCase()?k+=Q[0].SysColumnName.toString()+" ='1' , ":k+=Q[0].SysColumnName.toString()+" ='0' , ";break;case"IsLotwise":case"IsWeightable":"true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R]||"on"==e.ExcelTable[A][R].toLowerCase()?k+=Q[0].SysColumnName.toString()+" ='1' , ":k+=Q[0].SysColumnName.toString()+" ='0' , ";break;case"ParentID":if("3"==e.Feature.SelectedValue)if(Logger.InfoLog("Parent value"+e.ExcelTable[A][R].toLowerCase()),"true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R].toLowerCase()||"on"==e.ExcelTable[A][R].toLowerCase()){if(t+='IsGroup="1" ',("true"==e.ExcelTable[A][R].toLowerCase()||"yes"==e.ExcelTable[A][R].toLowerCase()||"y"==e.ExcelTable[A][R].toLowerCase()||"1"==e.ExcelTable[A][R].toLowerCase()||"on"==e.ExcelTable[A][R].toLowerCase())&&e.CCQuery.length>0&&e.ccdv.length>0)for(var de of e.CCQuery)if(""!=de.value&&de.Key.toString()==e.Feature.SelectedValue&&!D)for(let Me=0;Me<e.ccdv[de.Key].length;Me++){const ke=e.ccdv[de].Name.toString().replace("*","**"),Ne=e.ExcelTable[e.COls[de.Key].replace("_Key","")];if(e.ExcelTable.filter(He=>He[Ne]?.toString()===ke).length>0&&e.ccdv[de.Key][Me].Name.toString()==x){D=!0;break}}}else t+='IsGroup ="0" ';else t+='GroupName ="'+U.Dw.GetValidXml(e.ExcelTable[A][R])+'" ';break;case"COGSAccountID":e.ExcelTable.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&(k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', "),g=!0;break;case"ClosingStockAccountID":e.ExcelTable.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&(k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', "),T=!0;break;case"Base_Name":m+="BaseName='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"' ";break;case"Base_Conversion":m+="Conversion='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"' ";break;case"Conversion_UnitName":m+="UnitName='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":m+="ConversionUnit='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"' ";break;case"MultiBarcode":m+="MultiBarcode='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"' ";break;case"ServiceCode":case"ServiceName":e.ExcelTable.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&(ne+="Product ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==e.ExcelTable[A][R]||"OPTIONAL"!=e.ExcelTable[A][R].toUpperCase()&&"O"!=e.ExcelTable[A][R]&&"1"!=e.ExcelTable[A][R]?""!=e.ExcelTable[A][R]&&("MANDATORY"==e.ExcelTable[A][R]||"M"==e.ExcelTable[A][R]||"2"==e.ExcelTable[A][R])&&(ne+=Q[0].SysColumnName.toString()+" ='2'  "):ne+=Q[0].SysColumnName.toString()+" ='1'  ";break;case"AccountImage":case"ProductImage":case"DimensionImage":let me;if(me=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()],me.length>0){let he=me.split(";");try{me=he[0]}catch{$=""}try{for(let Me=1;Me<he.length;Me++)me=he[Me]}catch{Z=""}}break;case"Attachments":let fe=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()];if(fe.length>0){let he=fe.split(";");try{for(let Me of he);}catch{Z=""}}break;case"SubstituteGroup":B+="GroupName ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"'  ";break;default:if(null!=Q[0].ColumnCostCenterID&&""!=Q[0].ColumnCostCenterID.toString()&&parseInt(Q[0].ColumnCostCenterID.toString())>0&&"COM_ADDRESS"!=Q[0].SysTableName.toString().toUpperCase())if(44==parseInt(Q[0].ColumnCostCenterID.toString()))""!=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]&&(Q[0].SysColumnName.toString().Contains("Alpha")?ye+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ":k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ");else if(Q[0].SysColumnName.toString().Contains("Alpha"))ye+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=Q[0].IsColumnUserDefined&&""!=Q[0].IsColumnUserDefined.toString()&&(0,K.yG0)(Q[0].IsColumnUserDefined.toString())&&!Q[0].SysColumnName.toString().startsWith("Assigned_")&&"COM_ADDRESS"!=Q[0].SysTableName.toString().toUpperCase()){if(e.ExcelDataColumn.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&""!=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()&&(u=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"' "),Q[0].SysColumnName.toString().endsWith("_FromDate")||Q[0].SysColumnName.toString().endsWith("_ToDate")||!Q[0].SysColumnName.toString().startsWith("CCNID")||Q[0].SysColumnName.toString().endsWith("_Remarks")?parseInt(Q[0].CostCenterID.toString())>=5e4&&parseInt(Q[0].CostCenterID.toString())<=50050&&3==parseInt(Q[0].ColumnCostCenterID.toString())&&(O+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', "):e.ExcelDataColumn.includes(e.grData.Table[J].FieldName.toString()+"_Key")&&""!=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()?O+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ":O+=Q[0].SysColumnName.toString()+" ='1', ",Q[0].SysColumnName.toString().endsWith("_FromDate")){u="";let he="",Me=new Date,ke=null,Ne=e.grData.Table.filter(pe=>pe.FeatureFieldName==e.grData.Table[J].FeatureFieldName.toString().substring(0,e.grData.Table[J].FeatureFieldName.toString().length-3));if(null!=Ne&&Ne.length>0){e.ExcelTable.includes(Ne[0].FieldName.toString()+"_Key")&&""!=e.ExcelTable[A][Ne[0].FieldName.toString()+"_Key"].toString()&&"0"!=e.ExcelTable[A][Ne[0].FieldName.toString()+"_Key"].toString()&&(u=e.ExcelTable[A][Ne[0].FieldName.toString()+"_Key"].toString()+"' ");let pe=e.grData.Table.filter(Qe=>Qe.FeatureFieldName==Ne[0].FeatureFieldName.toString()+"001'");null!=pe&&pe.length>0&&null!=e.ExcelTable[A][pe[0].FieldName.toString()]&&null!=e.ExcelTable[A][pe[0].FieldName.toString()]&&""!=e.ExcelTable[A][pe[0].FieldName.toString()]&&(ke=new Date(e.ExcelTable[A][pe[0].FieldName.toString()]));let He=e.grData.Table.filter(Qe=>Qe.FeatureFieldName==Ne[0].FeatureFieldName.toString()+"002'");null!=He&&He.length>0&&(he=e.ExcelTable[A][He[0].FieldName.toString()])}o+="<XML><Row",(""==e.ExcelTable[A][R]||N.J0.isValidDate(e.ExcelTable[A][R]))&&(o+=" ID='0' CCID='"+Q[0].ColumnCostCenterID.toString()+"' NodeID='"+u),o+="FromDate='"+Me.toLocaleDateString("dd MMM yyyy").toString(),ke.HasValue&&(o+="' ToDate='"+ke.Value.toLocaleDateString("dd MMM yyyy").toString()),o+="' Modified='1' ",o+="Remarks='"+he+"' ",u="",o+="/></XML>"}}else null!=Q[0].IsColumnUserDefined&&""!=Q[0].IsColumnUserDefined.toString()&&(0,K.yG0)(Q[0].IsColumnUserDefined.toString())&&Q[0].SysColumnName.toString().startsWith("Assigned_")?s+=e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString():k+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=Q[0].IsColumnUserDefined&&""!=Q[0].IsColumnUserDefined.toString()&&(0,K.yG0)(Q[0].IsColumnUserDefined.toString()))if(null==Q[0].SysColumnName||!Q[0].SysColumnName.toString().toLowerCase().Contains("alpha")&&"COM_ADDRESS"!=Q[0].SysTableName.toString().toUpperCase())null==Q[0].SysColumnName||"COM_CCCCData"!=Q[0].SysTableName.toString()||!Q[0].SysColumnName.toString().toLowerCase().Contains("series")&&"IsManual"!=Q[0].SysColumnName.toString()?ie+=Q[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(e.ExcelTable[A][R])+"', ":O+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()]+"', ";else if(Object.keys(Q[0]).includes("UserColumnType")&&Q[0].UserColumnType.toString().toLowerCase().Contains("date")||Q[0].ColumnDataType.toString().toLowerCase().Contains("date")){let he=e.Date;(""==e.ExcelTable[A][R]||N.J0.isValidDate(e.ExcelTable[A][R]))&&(ye+=Q[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(he).ToString("dd/MMM/yyyy")+"', ")}else"COM_ADDRESS"==Q[0].SysTableName.toString().toUpperCase()&&parseInt(Q[0].ColumnCostCenterID.toString())>0?ie+=Q[0].SysColumnName.toString()+" ='"+e.ExcelTable[A][e.grData.Table[J].FieldName.toString()+"_Key"].toString()+"', ":"COM_ADDRESS"==Q[0].SysTableName.toString().toUpperCase()?ie+=Q[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(e.ExcelTable[A][R])+"', ":ye+=Q[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(e.ExcelTable[A][R])+"', ";else if("float"==Q[0].ColumnDataType.toString().toLowerCase()&&""==e.ExcelTable[A][R])k+=Q[0].SysColumnName.toString()+" ='0', ";else if(Object.keys(Q).includes("UserColumnType")&&Q[0].UserColumnType.toString().toLowerCase().Contains("date")||Q[0].ColumnDataType.toString().toLowerCase().Contains("date")){let he=e.Date;(""==e.ExcelTable[A][R]||N.J0.isValidDate(e.ExcelTable[A][R]))&&(k+=Q[0].SysColumnName.toString()+" ='"+N.J0.ParseDate(he).ToString("dd/MMM/yyyy")+"', ")}else k+=Q[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(e.ExcelTable[A][e.grData.Table[J].FieldName.toString().trim().replace("'","''")])+"', "}}}if(null!=c){if(c.Table.Contains("ErrorMessage"))return e.DisplayMessage=c.ErrorMessage.toString(),Logger.InfoLog("Code generation error "+c.ServerMessage.toString()),void(e.MessageVisibility=!0);t+='AccountCode="'+c.Code.toString()+'" ',t+='CodePrefix="'+c.Prefix.toString()+c.Suffix.toString()+'" ',t+='CodeNumber="'+c.Number.toString()+'" '}if("3"!=e.Feature.SelectedValue||e.IsUpdate||t.toString().Contains('IsGroup="1" ')){if(!e.IsUpdate&&!l){let J=i.filter(ae=>"PurchaseAccount"==ae.SysColumnName);if(J.length>0){let ae=J[0].UserDefaultValue;k+=J[0].SysColumnName.toString()+" =N'"+(null!=ae?ae.toString():"")+"', "}if(!n){let ae=i.filter(R=>"SalesAccount"==R.SysColumnName);if(ae.length>0){let R=ae[0].UserDefaultValue;k+=ae[0].SysColumnName.toString()+" =N'"+(null!=R?R.toString():"")+"', "}}if(!g){let ae=i.filter(R=>"COGSAccountID"==R.SysColumnName);if(ae.length>0){let R=ae[0].UserDefaultValue;k+=ae[0].SysColumnName.toString()+" ='"+(null!=R?R.toString():"")+"', "}}if(!T){let ae=i.filter(R=>"ClosingStockAccountID"==R.SysColumnName);if(ae.length>0){let R=ae[0].UserDefaultValue;k+=ae[0].SysColumnName.toString()+" ='"+(null!=R?R.toString():"")+"', "}}if(!S){let ae=i.filter(R=>"UOMID"==R.SysColumnName);if(ae.length>0){let R=ae[0].UserDefaultValue;k+=ae[0].SysColumnName.toString()+" ='"+(null!=R?R.toString():"")+"', "}else""!=e.Feature.SelectedValue&&null!=e.Feature.SelectedValue&&2!=parseInt(e.Feature.SelectedValue)&&65!=parseInt(e.Feature.SelectedValue)&&51!=parseInt(e.Feature.SelectedValue)&&(k+=" UOMID ='1', ")}}}else if(e.CostCenterFieldsAllTables.Tables[8].RowFilter="Name='Copygroupdatatonode'",F>0&&e.CostCenterFieldsAllTables.Tables[8].length>0&&(0,K.yG0)(e.CostCenterFieldsAllTables.Tables[8][0].Value.toString())){if(L!=F){L=F;let J=new Vt.c;J.ProductID=F,W=J.GetCopyProductDetails(F)}if(null!=W&&W.Tables.length>7&&W.Tables[0].length>0&&e.CostCenterFieldsAllTables.Tables[8].length>0){Object.keys(W.Tables[0][0]).includes("CreatedDate"),Object.keys(W.Tables[0][0]).Remove("CreatedDate"),Object.keys(W.Tables[0][0]).includes("ModifiedDate")&&Object.keys(W.Tables[0][0]).Remove("ModifiedDate");for(let J=0;J<e.CostCenterFieldsAllTables.Tables[10].length;J++)e.grData.Table.find(R=>R.FeatureFieldName==e.CostCenterFieldsAllTables.Tables[10][J].CostCenterColID.toString()).length>0&&(W.Tables[0].includes(e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString())?"CurrencyID"==e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()&&""==W.Tables[0][0][e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()]?k+=e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()+" =N'1', ":k+=e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()+" =N'"+W.Tables[0][0][e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()]+"', ":W.Tables[1].includes(e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString())?ye+=e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()+"='"+W.Tables[1][0][e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()]+"', ":W.Tables[7].includes(e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString())&&(O+=e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()+"=N'"+W.Tables[7][0][e.CostCenterFieldsAllTables.Tables[10][J].SysColumnName.toString()]+"', "))}}else{if(!l){let J=i.filter(ae=>"PurchaseAccountID"==ae.SysColumnName);J.length>0&&(k+=J[0].SysColumnName.toString()+" =N'"+J[0].UserDefaultValue.toString()+"', ")}if(!n){let J=i.filter(ae=>"SalesAccountID"==ae.SysColumnName);J.length>0&&(k+=J[0].SysColumnName.toString()+" =N'"+J[0].UserDefaultValue.toString()+"', ")}if(!I&&e.CostCenterFieldsAllTables.Tables.length>6)if(e.CostCenterFieldsAllTables.Tables[6].filter(ae=>"DefaultProductValuation"==ae.Name).length>0)e.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+e.CostCenterFieldsAllTables.Tables[6][0].Value.toString()+"'",3==parseInt(e.Feature.SelectedValue)&&i.filter(R=>"ValuationID"==R.SysColumnName).length>0&&(k+=i[0].SysColumnName.toString()+" ='"+e.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+"', ");else{let ae=i.filter(R=>"ValuationID"==R.SysColumnName);ae.length>0&&(k+=ae[0].SysColumnName.toString()+" ='"+ae[0].UserDefaultValue.toString()+"', ")}if(!g){let J=i.filter(ae=>"COGSAccountID"==ae.SysColumnName);J.length>0&&(k+=J[0].SysColumnName.toString()+" ='"+J[0].UserDefaultValue.toString()+"', ")}if(!T){let J=i.filter(ae=>"ClosingStockAccountID"==ae.SysColumnName);J.length>0&&(k+=J[0].SysColumnName.toString()+" ='"+J[0].UserDefaultValue.toString()+"', ")}if(!S){let J=i.filter(ae=>"UOMID"==ae.SysColumnName);J.length>0?k+=J[0].SysColumnName.toString()+" ='"+J[0].UserDefaultValue.toString()+"', ":null!=parseInt(e.Feature.SelectedValue)&&2!=parseInt(e.Feature.SelectedValue)&&65!=parseInt(e.Feature.SelectedValue)&&51!=parseInt(e.Feature.SelectedValue)&&(k+=" UOMID ='1', ")}}if(!f&&!e.IsUpdate){let J=!1;J=(0,K.yG0)(b.d.SessionManager.Preferences.On.toString()),"2"==e.Feature.SelectedValue&&0==p&&(p=7),t+=!J||6!=p&&7!=p?' IsBillwise="0" ':'IsBillwise ="1" '}let Be;if(D&&null!=e.Feature.SelectedValue&&("2"==e.Feature.SelectedValue||"3"==e.Feature.SelectedValue||parseInt(e.Feature.SelectedValue)>5e4)&&(t+=' Move ="1" '),!y&&"2"==e.Feature.SelectedValue&&(k+=" DrOptionID='0', "),!d&&"2"==e.Feature.SelectedValue&&(k+=" CrOptionID='0', "),""!=k&&(t+='ExtraFields ="'+k.substring(0,k.length-2)+'" '),null!=e.Feature.SelectedItem&&"Product With Services(One-One)"==e.Feature.SelectedItem.Name?Re="One-One":null!=e.Feature.SelectedItem&&"Product With Services(Many-One)"==e.Feature.SelectedItem.Name&&(Re="Many-One"),""!=Re&&(t+='LinkOption="'+Re+'"  '),""!=ne&&(t+='LinkFields ="'+ne.substring(0,ne.length-2)+'" '),""!=B&&(t+='Substitutes ="'+B.substring(0,B.length-2)+'" '),""!=q&&(t+='CustomerName ="'+q.substring(0,q.length-2)+'" '),""!=$&&(t+='ProductImage ="'+$+'" '),""!=ye&&(t+='ExtraUserDefinedFields ="'+ye.substring(0,ye.length-2)+'" '),""!=O&&(t+='CostCenterFields ="'+O.substring(0,O.length-2)+'" '),""!=ie&&(t+='PrimaryContactQuery ="'+ie.substring(0,ie.length-2)+'" '),m.toString().length>0&&(m.toString().Contains("Conversion=")||(m+="Conversion='1' "),t+='ProductWiseUOM="'+m.toString()+'" '),""!=x||!(3==parseInt(e.Feature.SelectedValue)||parseInt(e.Feature.SelectedValue)>5e4)||e.NameSameasCode){if(s.length>0&&(s.Insert(0,'<XML IsImport="1" >'),s+="</XML>"),Z.length>0&&(Z="<XML>"+Z+"</XML>"),t+=" ></Row>",t+="</XML>",o+="</History>",D){let J=b.d.document.SetImportData(t.toString(),s.toString(),o.toString(),e.Feature.SelectedValue,e.IsDuplicateNameAllowed,e.IsAutoCodeGen,e.IsUpdate,e.IsCode,Z);J.RetValue>0?(e.ExcelTable[A].xIMP_STATUSx="FAIL",e.ExcelTable[A].IMPORT_MESSAGE=Be,r++,e.FailedRecourdList.push({Name:x,Message:J.Message})):(e.ExcelTable[A].xIMP_STATUSx="PASS",e.ExcelTable[A].IMPORT_MESSAGE="")}else{let J=b.d.document.SetImportData(t.toString(),s.toString(),o.toString(),e.Feature.SelectedValue,e.IsDuplicateNameAllowed,e.IsAutoCodeGen,e.IsUpdate,e.IsCode,Z);J?.RetValue>0?(e.ExcelTable[A].xIMP_STATUSx="FAIL",e.ExcelTable[A].IMPORT_MESSAGE=Be,r++,e.FailedRecourdList.push({Name:x,Message:J.Message})):(e.ExcelTable[A].xIMP_STATUSx="PASS",e.ExcelTable[A].IMPORT_MESSAGE="")}t="",t+="<XML>",o="",o+="<History>",e.ImportedCount="Imported :"+(A+1-r).toString(),e.FailedCount="Failed :"+r.toString()}}let $e=e.ExcelTable.length-a;e.GroupsImport&&(e.GroupfailCount=r,e.GroupTotCount=$e),e.GroupTotCount>0&&e.GroupsImport?(e.ImportedCount="Imported :"+(e.GroupTotCount-e.GroupfailCount).toString(),e.FailedCount="Failed :"+e.GroupfailCount.toString()):(e.ImportedCount="Imported :"+(e.GroupTotCount+$e-(e.GroupfailCount+r)).toString(),e.FailedCount="Failed :"+(e.GroupfailCount+r).toString()),e.ListVisbility=e.FailedRecourdList.length>0,e.UpdateExcelSheet(),e.DisplayMessage=e.GroupsImport?"Import completed ( Total :"+e.GroupTotCount.toString()+" "+e.ImportedCount+" "+e.FailedCount+" )":"Import completed ( Total :"+(e.GroupTotCount+$e).toString()+" "+e.ImportedCount+" "+e.FailedCount+" )",e.MessageVisibility=!0})()}ImportJobOutput(){let e=this.costCenterTableZero,i=0;if(!this.ScanCostCenterFields(!1))return;let r=0,u="";this.CheckProductUOMdata();let s="",n=0,l=0;n=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let g=0;g<this.ExcelTable.length;g++,this.ProgressValue++){if(u+="<XML>",s=this.ExcelTable[g][n].toString(),this.lst.filter(I=>I.Name==s).length>0)continue;l+=1,u+="<Row ",u+=' RowNo="'+l+'" ';for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString())if(e.filter(d=>d.CostCenterColID==this.grData.Table[I].FeatureFieldName.toString()),"Code"==e[0].SysColumnName.toString())u+='NodeID="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()+"_key"].toString()+'" ',u+='Code="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()]+'" ';else if("Name"==e[0].SysColumnName.toString())u+='Name="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()]+'" ';else if(""!=e[0].ColumnCostCenterID.toString()&&113==parseInt(e[0].ColumnCostCenterID.toString())){let d=this.CostCenterFieldsAllTables[5];d.filter(y=>y.ResourceData==this.ExcelTable[g][this.grData.Table[I].FieldName.toString()]),u+=e[0].SysColumnName.toString()+'="'+d[0].ItemArray[1].toString()+'" '}else""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()+"_key"].toString()+'" ':"-154"==e[0].CostCenterColID.toString()?u+='Qty="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()]+'" ':"-155"==e[0].CostCenterColID.toString()?"BOM"==this.ExcelTable[g][this.grData.Table[I].FieldName.toString()].toUpperCase()?u+='IsBom="0" ':"QTY"==this.ExcelTable[g][this.grData.Table[I].FieldName.toString()].toUpperCase()&&(u+='IsBom="1" '):"-157"==e[0].CostCenterColID.toString()&&(u+=e[0].SysColumnName.toString()+'="'+this.ExcelTable[g][this.grData.Table[I].FieldName.toString()]+'" ');u+=">",u+="</Row>",u+="</XML>";let T,S=[];S.push(u.toString()),S.push(this.Feature.SelectedValue),S.push(b.d.SessionManager.CompanyIndex),T=b.d.document.SetImportJobOutputData(S),this.DisplayMessage=T,u="",T<0&&(r++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),i++}this.ImportedCount="Imported :"+(i-r).toString(),this.FailedCount="Failed :"+r.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportLookUps(){let e=this.costCenterTableZero,i=0,r=0;for(let a of this.ExcelTable){let u;this.name="";let c="",t="",s=!1;u=parseInt(this.CostCenterFieldsAllTables[1][0].NodeID);for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(l=>l.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0)){let l=e[0].SysColumnName.toString();"Code"==l&&(c=a[this.grData.Table[n].FieldName.toString()]),"Name"==l&&(this.name=a[this.grData.Table[n].FieldName.toString()]),"AliasName"==l&&(t=a[this.grData.Table[n].FieldName.toString()]),"Default"==l&&("1"==a[this.grData.Table[n].FieldName.toString()]||"yes"==a[this.grData.Table[n].FieldName.toString()].toLowerCase())&&(s=!0)}let m,h=[];h.push(parseInt(u)),h.push(c),h.push(this.name),h.push(t),h.push(1),h.push(s?1:0),h.push(""),h.push(b.d.SessionManager.CompanyGUID),h.push(b.d.SessionManager.UserName),h.push(b.d.SessionManager.RoleID),h.push(b.d.SessionManager.LanguageID),m=b.d.document.SetLookupImport(h),this.DisplayMessage=m,m<0&&(i++,this.FailedRecourdList.push({Name:this.name,Message:this.DisplayMessage})),r++}this.ImportedCount="Imported :"+(r-i).toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportCrossDimension(){let s,e=this.costCenterTableZero,r="",a="",u=0,c=0,t="";if(!this.ScanCostCenterFields(!1))return;t+="<XML>",s+="<XML>";for(let h=0;h<this.ExcelTable.length;h++,this.ProgressValue++){t+="<Row ",s+="<Row ",t+='Sno ="'+(h+1)+'" ',s+='Sno ="'+(h+1)+'" ';for(let n=0;n<this.grData.Table.length;n++)if(null!=this.grData.Table[n].FeatureFieldName&&""!=this.grData.Table[n].FeatureFieldName.toString()&&(e.filter(l=>l.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))if(r=e[0].SysColumnName.toString(),c=parseInt(e[0].ColumnCostCenterID),r.Contains("Dim_"))u=c;else switch(r){case"Document":t+='Document="'+this.ExcelTable[h][this.grData.Table[n].FieldName.toString()]+'" ';break;case"CreditAccount":t+='CreditAccount="'+this.ExcelTable[h][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"DebitAccount":t+='DebitAccount="'+this.ExcelTable[h][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"In/From":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(h,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimIn="'+this.ExcelTable[h][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;case"For/To":e[0].ColumnCostCenterID=u,this.CheckCostCenterField(h,parseInt(e[0].ColumnCostCenterID.toString()),this.grData.Table[n].FieldName.toString(),!1,this.IsCode),t+='DimFor="'+this.ExcelTable[h][this.grData.Table[n].FieldName.toString()+"_key"].toString()+'" ';break;default:a.Contains(c.toString())||(a+=c+",")}t+=" />",s+=" />"}t+="</XML>",s+="</XML>";let m=[];m.push(u),m.push(a),m.push(t.toString()),m.push(s.toString()),m.push(this.IsUpdate),m.push(this.IsCode),m.push(b.d.SessionManager.UserName),m.push(b.d.SessionManager.UserID),m.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SetImportCrossDimension(m),t="",s="",this.MessageVisibility=!0}ScanBatchfields(){let e=this.costCenterTableZero;for(let i of this.grData.Table)e.filter(r=>r.CostCenterColID==i[1].toString()),e.length>0&&("BatchNumber"==e[0].SysColumnName.toString()?this.batchnumberfield=e[0].SysColumnName.toString():"MfgDate"==e[0].SysColumnName.toString()?this.mfgdatefield=e[0].SysColumnName.toString():"ExpiryDate"==e[0].SysColumnName.toString()?this.expdatefield=e[0].SysColumnName.toString():"ProductID"==e[0].SysColumnName.toString()?this.productidfield=e[0].SysColumnName.toString():"BatchCode"==e[0].SysColumnName.toString()&&(this.bcodefield=e[0].SysColumnName.toString()))}ImportBatches(){let e=this.costCenterTableZero,i=this.CostCenterFieldsAllTables[this.CostCenterFieldsAllTables.length-2];if(this.ScanBatchfields(),!this.ScanCostCenterFields(!1))return;let c,r=0,a=null,u="";if(this.xDocCodeDef=null,null!=this.CodeDef&&this.IsAutoCodeGen&&this.CodeDef[0].PrefixContent.toString().length>0&&(this.xDocCodeDef=new N.VB,this.xDocCodeDef.LoadXml(this.CodeDef[0].PrefixContent.toString())),""==this.batchnumberfield)return this.DisplayMessage="Batch number field is mandatory",void(this.MessageVisibility=!0);if(""==this.bcodefield&&!this.IsAutoCodeGen)return this.DisplayMessage="Batch code field  is mandatory",void(this.MessageVisibility=!0);for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){let s=!1,o="",m="",h="",n="";c.length=0;let l="",g="",T="",S="",I="",d=new Lt.Batch;u+="<Row ";for(let D=0;D<this.grData.Table.length;D++)if(null!=this.grData.Table[D].FeatureFieldName&&""!=this.grData.Table[D].FeatureFieldName.toString()&&(e.filter(p=>p.CostCenterColID==this.grData.Table[D].FeatureFieldName.toString()),e.length>0)){let p=e[0].SysColumnName.toString();switch(p){case"StatusID":this.CostCenterFieldsAllTables[1].RowFilter="ResourceData='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables[1].length>0&&(u+='StatusID ="'+this.CostCenterFieldsAllTables[1][0].StatusID.toString()+'" ');break;case"MfgDate":let F;if(F=""==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),F)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);d.MfgDate=F,T=F.Date.toLocaleDateString("dd/MMM/yyyy");break;case"ExpiryDate":let E;if(E=""==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),E)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);d.ExpiryDate=E,g=E.Date.toLocaleDateString("dd/MMM/yyyy");break;case"RetestDate":let V;if(V=""==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]||!N.J0.isValidDate(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),V)return this.DisplayMessage="Invalid "+e[0].ResourceData.toString()+" at Row:"+(t+1).toString()+" "+this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]+" date expected",void(this.MessageVisibility=!0);l=V.Date.toLocaleDateString("dd/MMM/yyyy");break;case"MRPRate":let L=0;L=parseFloat(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),d.MRPRate=L;break;case"RetailRate":let O=0;O=parseFloat(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),d.RetailRate=O;break;case"StockistRate":let x=0;x=parseFloat(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]),d.StockistRate=x;break;case"ProductID":d.ProductID=parseInt(this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString().Trim());break;case"BatchCode":null==a&&(d.BatchCode=this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]);break;case"CodePrefix":case"CodeNumber":null==a&&(u+=p+'="'+U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])+'" ',"CodePrefix"==p?d.CodePrefix=U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]):"CodeNumber"==p&&(d.CodeNumber=parseInt(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])));break;case"BatchNumber":u+='AccountName ="'+U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])+'" ',m=this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()],I=m;break;case"IsGroup":"true"==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()].toLowerCase()?(u+=e[0].SysColumnName.toString()+' ="1" ',d.IsGroup=s=!0):(u+=e[0].SysColumnName.toString()+' ="0" ',d.IsGroup=s=!1);break;case"ParentID":""!=this.ExcelTable[t][this.grData.Table[D].FieldName.toString()]&&(i.RowFilter=this.IsCode?"BatchNumber='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()]+"'":"BatchCode='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()]+"'",d.BatchGroup=i.length>0?parseInt(i[0].BatchID.toString()):1);break;case"VendorAccountID":this.ExcelTable.includes(this.grData.Table[D].FieldName.toString()+"_Key")&&(h+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()+"', ");break;default:null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0?44==parseInt(e[0].ColumnCostCenterID.toString())?h+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&!e[0].SysColumnName.toString().startsWith("Assigned_")?""!=this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()&&"0"!=this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()?o+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()+"', ":o+=e[0].SysColumnName.toString()+" ='1', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())&&e[0].SysColumnName.toString().startsWith("Assigned_")?c+=this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString():h+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[t][this.grData.Table[D].FieldName.toString()+"_Key"].toString()+"', ":null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?S+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])+"', ":n+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])+"', ":e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()]?h+=e[0].SysColumnName.toString()+" ='0', ":h+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[t][this.grData.Table[D].FieldName.toString().Trim()])+"', "}}if(null!=this.xDocCodeDef&&(a=this.GetCodeData(this.ExcelTable[t],d.BatchGroup)),null!=a&&(d.BatchCode=a.Code.toString(),d.CodePrefix=a.Prefix.toString()+a.Suffix.toString(),d.CodeNumber=parseInt(a.Number.toString())),""!=h&&(u+='ExtraFields ="'+h.substring(0,h.length-2)+'" '),""!=S&&(u+='ExtraUserDefinedFields ="'+S.substring(0,S.length-2)+'" '),""!=o&&(u+='CostCenterFields ="'+o.substring(0,o.length-2)+'" '),""!=n&&(u+='PrimaryContactQuery ="'+n.substring(0,n.length-2)+'" '),""==I)continue;c.length>0&&(c.Insert(0,"<XML>"),c+="</XML>");let f,y=[];if(y.push(I),y.push(""!=T?d.MfgDate:""==T&&s?null:"1/JAN/1900"),y.push(""!=g?d.ExpiryDate:""==g&&s?null:"1/JAN/1900"),y.push(d.MRPRate),y.push(d.RetailRate),y.push(d.StockistRate),d.ProductID>0)y.push(d.ProductID);else{if(!s&&0==d.ProductID)return this.DisplayMessage="Product field is required",void(this.MessageVisibility=!0);y.push(0)}y.push(""!=l?l.toString():null),y.push(d.BatchGroup>1?d.BatchGroup:1),d.StaticFieldsQuery=h,d.CustomFieldsQuery=S,d.CustomCostCenterFieldsQuery=o,Lt.Batch.QuickAddBatch(f,y,!1),f<=0&&(r++,this.FailedRecourdList.push({Name:I,Message:f})),this.ImportedCount="Imported :"+(t+1-r).toString(),this.FailedCount="Failed :"+r.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckDetails(e,i){for(let r of this.lst)if(r.Name==e&&r.Value==i)return!1;return!0}ImportProductwiseMultipleUOM(){let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let i=0,r=0,a="",u="",c="";this.CheckProductUOMdata(),a+="<XML>";let t="",s=0;s=this.IsCode?this.codecolnum:this.namecolnum,this.lst=[];for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){if(t=this.ExcelTable[o][s].toString(),this.lst.filter(F=>F.Name==t).length>0)continue;this.lst.push(te._p.ComboBoxItems_1(t));let f,m="",h="",n="",l="",g="",T="",S="",I=0,d=0,y="";a+="<Row ";for(let F=0;F<this.grData.Table.length;F++)if(null!=this.grData.Table[F].FeatureFieldName&&""!=this.grData.Table[F].FeatureFieldName.toString()&&(e.filter(E=>E.CostCenterColID==this.grData.Table[F].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"StatusID":this.CostCenterFieldsAllTables.Tables[1].RowFilter="ResourceData='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[1].length>0&&(a+='StatusID ="'+this.CostCenterFieldsAllTables.Tables[1][0].StatusID.toString()+'" ');break;case"AccountTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(a+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].AccountTypeID.toString()+'" ');break;case"CustomerTypeID":a+='TypeID ="1" ';break;case"ProductTypeID":this.CostCenterFieldsAllTables.Tables[2].RowFilter="ResourceData='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[2].length>0&&(a+='TypeID ="'+this.CostCenterFieldsAllTables.Tables[2][0].ProductTypeID.toString()+'" ');break;case"ValuationID":this.CostCenterFieldsAllTables.Tables[3].RowFilter="ResourceData='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]+"'",this.CostCenterFieldsAllTables.Tables[3].length>0&&(a+='ValuationID ="'+this.CostCenterFieldsAllTables.Tables[3][0].ValuationID.toString()+'" ');break;case"UOMID":l+="UOMID ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ";break;case"PurchaseAccountID":case"PurchaseAccount":a+='PurchaseAccount ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ';break;case"SalesAccountID":case"SalesAccount":a+='SalesAccount ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ';break;case"DrOptionID":case"CrOptionID":"FIRST DAY OF MONTH"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toUpperCase()||"FDOM"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toUpperCase()||"1"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]?l+=e[0].SysColumnName.toString()+" ='1', ":"LAST DAY OF MONTH"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toUpperCase()||"LDOM"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]?l+=e[0].SysColumnName.toString()+" ='2', ":l+=e[0].SysColumnName.toString()+" ='0', ";break;case"CodePrefix":a+='CodePrefix ="'+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()]+'" ';break;case"CodeNumber":a+='CodeNumber ="'+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()]+'" ';break;case"Make":case"Model":case"Variant":case"Segment":case"CreditDays":case"CreditLimit":case"AliasName":case"DebitDays":case"DebitLimit":a+=e[0].SysColumnName.toString()+' ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ';break;case"Year":if(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].Contains("-")){let V=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].split("-");I=V.length>0&&parseInt(V[0]),I=I?parseInt(V[0]):0,d=V.length>1&&parseInt(V[1])?parseInt(V[1]):0}else I=parseInt(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])?parseInt(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]):0;break;case"AccountCode":case"ProductCode":case"CustomerCode":case"Code":a+='AccountCode ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ';break;case"AccountName":case"CustomerName":case"Name":case"ProductName":"51"!=this.Feature.SelectedValue.toString()||"CustomerName"==e[0].SysColumnName.toString()?(a+='AccountName ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ',h=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]):null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0&&(l+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ");break;case"ParentGroupName":a+='GroupName ="'+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+'" ';break;case"ParentID":case"IsBillwise":"true"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"yes"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"y"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"1"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()||"on"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toLowerCase()?a+=e[0].SysColumnName.toString()+' ="1" ':a+=e[0].SysColumnName.toString()+' ="0" ';break;case"COGSAccountID":case"ClosingStockAccountID":this.ExcelTable.includes(this.grData.Table[F].FieldName.toString()+"_Key")&&(l+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ");break;case"Assigned_Locations":case"Assigned_Dimension":u+=this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString();break;case"ServiceCode":case"ServiceName":this.ExcelTable.includes(this.grData.Table[F].FieldName.toString()+"_Key")&&(T+="Product ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"'  ");break;case"LINK":""==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]||"OPTIONAL"!=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()].toUpperCase()&&"O"!=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]&&"1"!=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]?""!=this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]&&("MANDATORY"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]||"M"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]||"2"==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])&&(T+=e[0].SysColumnName.toString()+" ='2'  "):T+=e[0].SysColumnName.toString()+" ='1'  ";break;case"SubstituteGroup":n+="GroupName ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()]+"'  ";break;default:if(null!=e[0].ColumnCostCenterID&&""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID.toString())>0)null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString())?m+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ":l+=e[0].SysColumnName.toString()+" ='"+this.ExcelTable[o][this.grData.Table[F].FieldName.toString()+"_Key"].toString()+"', ";else if(null!=e[0].IsColumnUserDefined&&""!=e[0].IsColumnUserDefined.toString()&&(0,K.yG0)(e[0].IsColumnUserDefined.toString()))null!=e[0].SysColumnName&&e[0].SysColumnName.toString().toLowerCase().Contains("alpha")?y+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+"', ":g+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+"', ";else{if("-19"==e[0].CostCenterColID.toString()||"-20"==e[0].CostCenterColID.toString()||"-21"==e[0].CostCenterColID.toString()||"-22"==e[0].CostCenterColID.toString())continue;e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()&&""==this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()]?l+=e[0].SysColumnName.toString()+" ='0', ":l+=e[0].SysColumnName.toString()+" =N'"+U.Dw.GetValidXml(this.ExcelTable[o][this.grData.Table[F].FieldName.toString().Trim()])+"', "}}if(""!=S&&(a+='LinkOption="'+S+'"  '),""!=T&&(a+='LinkFields ="'+T.substring(0,T.length-2)+'" '),""!=n&&(a+='Substitutes ="'+n.substring(0,n.length-2)+'" '),""!=this.ExcelTable[o].ProductwiseUOMConversion.toString()&&(c+=this.ExcelTable[o].ProductwiseUOMConversion.toString()),""==h)continue;a+=" ></Row>",a+="</XML>";let p=[];p.push(a.toString()),p.push(u.toString()),p.push(c.toString()),p.push(this.IsDuplicateNameAllowed),p.push(this.IsAutoCodeGen),p.push(!1),p.push(this.Feature.SelectedValue),p.push(this.IsUpdate),p.push(this.IsCode),p.push(b.d.SessionManager.UserName),p.push(b.d.SessionManager.UserID),p.push(b.d.SessionManager.LanguageID),b.d.document.SetImportProductWithMultipleUOM(p)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[o].ProductwiseUOMConversionCount.toString()?i+=parseInt(this.ExcelTable[o].ProductwiseUOMConversionCount.toString()):i++,this.FailedRecourdList.push({Name:h,Message:f})):r+=parseInt(this.ExcelTable[o].ProductwiseUOMConversionCount.toString()),a="",a+="<XML>",this.ImportedCount="Imported :"+r.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseMultipleUOMBarcode(){if(!this.ScanCostCenterFields(!1))return;let i=0,r=0,a="";this.CheckProductUOMdata();let u="",c=0;c=this.IsCode?this.codecolnum:this.namecolnum,this.lst.Clear();for(let t=0;t<this.ExcelTable.length;t++,this.ProgressValue++){if(u=this.ExcelTable[t][c].toString(),this.lst.filter(m=>m.Name==u).length>0)continue;this.lst.push(te._p.ComboBoxItems_1(u)),""!=this.ExcelTable[t].ProductwiseUOMConversion.toString()&&(a+=this.ExcelTable[t].ProductwiseUOMConversion.toString());let s,o=[];o.push(u),o.push(a.toString()),o.push(this.IsUpdate),o.push(this.IsCode),o.push(b.d.SessionManager.CompanyGUID),o.push(b.d.SessionManager.UserName),o.push(b.d.SessionManager.UserID),o.push(b.d.SessionManager.LanguageID),b.d.document.SetImportProductWithMultipleUOMBarcode(o)<0?(this.ExcelTable.includes("ProductwiseUOMConversionCount")&&""!=this.ExcelTable[t].ProductwiseUOMConversionCount.toString()?i+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()):i++,this.FailedRecourdList.push({Name:u,Message:s})):r+=parseInt(this.ExcelTable[t].ProductwiseUOMConversionCount.toString()),this.ImportedCount="Imported :"+r.toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}FillUnitRates(){this.costCenterTableZero=[];let e={CostCenterColID:"-1"};e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitCode",e.ResourceData="Unit Code",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-2",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="UnitName",e.ResourceData="Unit Name",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-3",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Amount",e.ResourceData="Amount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-4",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="Discount",e.ResourceData="Discount",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-5",e.CostcenterID=this.Feature.SelectedValue,e.SysColumnName="AnnualRent",e.ResourceData="AnnualRent",this.costCenterTableZero.push(e),e={},e.CostCenterColID="-6",e.CostcenterID=this.Feature.SelectedValue,e.ColumnDataType="DATE",e.SysColumnName="WEF",e.ResourceData="WEF",this.costCenterTableZero.push(e)}FillUnitRateXML(){let e=this.costCenterTableZero,i="",r="",a="",t=0,s=0;for(let o=0;o<this.grData.Table.length;o++)if(null!=this.grData.Table[o].FeatureFieldName&&""!=this.grData.Table[o].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[o].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":this.IsCode&&(t=o,r=this.grData.Table[o].FieldName.toString());break;case"UnitName":this.IsCode||(s=o,a=this.grData.Table[o].FieldName.toString())}if(t>0||s>0){this.ExcelTable.includes("UnitRatexml")||this.ExcelTable.push("UnitRatexml"),this.lst.Clear(),this.excelview=this.ExcelTable;let o,m="",h=0;h=this.IsCode?t:s;for(let n=0;n<this.ExcelTable.length;n++)if(o=this.ExcelTable[n][h].toString(),0==this.lst.filter(l=>l.Name==o).length){this.lst.push(te._p.ComboBoxItems_1(o)),this.excelview.filter(this.IsCode?S=>S.colcode==o:S=>S.colname==o),m+="<XML>";let g,T,l=0;for(let S of this.excelview){m+="<Row  ",m+=" UnitRateID='0'  ",m+=" Action=\"NEW\"  MapAction='0'  ";for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[n].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":T=N.J0.Int(S[this.grData.Table[I].FieldName.toString()]),T&&(i+="Amount='"+T+"' ");break;case"Discount":T=N.J0.Int(S[this.grData.Table[I].FieldName.toString()]),T&&(i+="Discount='"+T+"' ");break;case"AnnualRent":T=N.J0.Int(S[this.grData.Table[I].FieldName.toString()]),T&&(i+="AnnualRent='"+T+"' ");break;case"WEF":g=N.J0.isValidDate(S[this.grData.Table[I].FieldName.toString()]),g&&(i+="WEF='"+g.toString("dd/MMMyyyyy")+"' ")}m+=i.toString(),m+="/>",l++}m+="</XML>";for(let S of this.ExcelTable)S[h].toString()==o&&(S.UnitRatexml=m.toString())}}}ImportUnitRates(){this.DisplayMessage="",this.MessageVisibility=!1;let s,e=this.costCenterTableZero,i=0,r="",a="",u="",c="";for(let o=0;o<this.grData.Table.length;o++)if(null!=this.grData.Table[o].FeatureFieldName&&""!=this.grData.Table[o].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[o].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"UnitCode":r=this.grData.Table[o].FieldName.toString();break;case"UnitName":a=this.grData.Table[o].FieldName.toString()}if(this.lst.Clear(),this.excelview=this.ExcelTable,""!=r||""!=a)for(let o=0;o<this.ExcelTable.length;o++,this.ProgressValue++){if(s=""!=r?this.ExcelTable[o][r].toString():this.ExcelTable[o][a].toString(),0==this.lst.filter(m=>m.Name==s).length){this.lst.push(te._p.ComboBoxItems_1(s)),this.excelview.filter(""!=r?l=>l.colcode==s:l=>l.colname==s),""!=r&&(u=this.ExcelTable[o][r].toString()),""!=a&&(c=this.ExcelTable[o][a].toString());let h,n,m=0;if(this.excelview.length>0){let l="";l+="<XML>";for(let T of this.excelview){l+="<Row  ",l+=" UnitRateID='0'  ",l+=" Action=\"NEW\"  MapAction='0'  ";for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(I=>I.CostCenterColID==this.grData.Table[o].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Amount":n=N.J0.Int(T[this.grData.Table[S].FieldName.toString()]),h=N.J0.isValidDate(T[this.grData.Table[S].FieldName.toString()]),n&&(l+="Amount='"+n+"' ");break;case"Discount":n&&(l+="Discount='"+n+"' ");break;case"AnnualRent":n&&(l+="AnnualRent='"+n+"' ");break;case"WEF":h&&(l+="WithEffFrom='"+h.toLocaleDateString("dd/MMM/yyyy")+"' ")}l+="/>",m++}l+="</XML>";let g=[];g.push(u),g.push(c),g.push(l.toString()),g.push(b.d.SessionManager.CompanyGUID),g.push(b.d.SessionManager.UserName),g.push(b.d.SessionManager.UserID),g.push(b.d.SessionManager.LanguageID),b.d.document.SetImportUnitRates(g)<0&&(i++,this.FailedRecourdList.push({Name:s,Message:void 0}))}}this.ImportedCount="Imported :"+(this.lst.length+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportProductwiseVendorMultipleBarcode(){this.DisplayMessage="",this.MessageVisibility=!1;let e=this.costCenterTableZero;if(!this.ScanCostCenterFields(!1))return;let i=0,r="",a="",t="",s="";this.CheckProductVendorMultipleBarcode();let o,m=0,h=0;for(let l=0;l<this.grData.Table.length;l++)if(null!=this.grData.Table[l].FeatureFieldName&&""!=this.grData.Table[l].FeatureFieldName.toString()&&(e.filter(g=>g.CostCenterColID==this.grData.Table[l].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(m=l,r=this.grData.Table[l].FieldName.toString());break;case"ProductName":this.IsCode||(h=l,a=this.grData.Table[l].FieldName.toString())}this.lst.Clear();let n=0;n=this.IsCode?m:h,t+="<XML>";for(let l=0;l<this.ExcelTable.length;l++,this.ProgressValue++){let g="";if(o=this.ExcelTable[l][n].toString(),0==this.lst.filter(T=>T.Name==o).length){t+="<Row ",this.lst.push(te._p.ComboBoxItems_1(o));for(let I=0;I<this.grData.Table.length;I++)if(null!=this.grData.Table[I].FeatureFieldName&&""!=this.grData.Table[I].FeatureFieldName.toString()&&(e.filter(d=>d.CostCenterColID==this.grData.Table[l].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":t+='AccountCode ="'+U.Dw.GetValidXml(this.ExcelTable[l][this.grData.Table[I].FieldName.toString().Trim()])+'" ';break;case"ProductName":t+='AccountName ="'+U.Dw.GetValidXml(this.ExcelTable[l][this.grData.Table[I].FieldName.toString().Trim()])+'" ',g=this.ExcelTable[l][this.grData.Table[I].FieldName.toString().Trim()]}let T;if(""==g)continue;t+=" ></Row>",t+="</XML>",""!=this.ExcelTable[l].ProdVendorMulBarcode.toString()&&(s+=this.ExcelTable[l].ProdVendorMulBarcode.toString());let S=[];S.push(t.toString()),S.push(s.toString()),S.push(this.Feature.SelectedValue),S.push(this.IsDuplicateNameAllowed),S.push(this.IsUpdate),S.push(this.IsCode),S.push(b.d.SessionManager.CompanyGUID),S.push(b.d.SessionManager.UserName),S.push(b.d.SessionManager.UserID),S.push(b.d.SessionManager.LanguageID),b.d.document.SetImportProductVendorMultipleBarcode(S)<0&&(i++,this.FailedRecourdList.push({Name:g,Message:T}))}t="",t+="<XML>",this.ImportedCount="Imported :"+(l+1-i).toString(),this.FailedCount="Failed :"+i.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}CheckProductUOMdata(){let e=this.costCenterTableZero,i="";for(let r=0;r<this.grData.Table.length&&"-19"!=this.grData.Table[r][1].toString();r++)if(null!=this.grData.Table[r].FeatureFieldName&&""!=this.grData.Table[r].FeatureFieldName.toString()&&(e.filter(a=>a.CostCenterColID==this.grData.Table[r].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(this.codecolnum=r,this.colcode=this.grData.Table[r].FieldName.toString());break;case"ProductName":this.IsCode||(this.namecolnum=r,this.colname=this.grData.Table[r].FieldName.toString())}if(this.columnexist){this.ExcelTable.includes("ProductwiseUOMConversion")||(this.ExcelTable.push("ProductwiseUOMConversion"),this.ExcelTable.push("ProductwiseUOMConversionCount")),this.lst.Clear(),this.excelview=this.ExcelTable;let a,r="",u=0;u=this.IsCode?this.codecolnum:this.namecolnum;for(let c=0;c<this.ExcelTable.length;c++)if(a=this.ExcelTable[c][u].toString(),0==this.lst.filter(t=>t.Name==a).length){this.lst.push(te._p.ComboBoxItems_1(a)),this.excelview.filter(this.IsCode?s=>s.colcode==a:s=>s.colname==a),r+="<Data>";let t=0;for(let s of this.excelview){r+="<Row RowNo='"+(t+1)+"'    ",r+=" UnitiD='0'  ",r+=" Action=\"NEW\"  MapAction='0'  ",r+=" BaseID='-100'  ";for(let o=0;o<this.grData.Table.length;o++)if(null!=this.grData.Table[o].FeatureFieldName&&""!=this.grData.Table[o].FeatureFieldName.toString()&&(e.filter(m=>m.CostCenterColID==this.grData.Table[c].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Base_Name":i+="BaseName='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"Base_Conversion":i+="Conversion='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"Conversion_UnitName":i+="UnitName='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"Conversion_UnitValue":i+="ConversionUnit='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"MultiBarcode":i+="MultiBarcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"BaseMultiBarcode":i+="BaseMultiBarcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ";break;case"UOM_Barcode":""!=s[this.grData.Table[o].FieldName.toString()]&&(this.ShowBarcodeDimension?(i+="Barcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ",i+="BarKey='"+s[this.grData.Table[o].FieldName.toString()+"_Key"].toString()+"' "):(i+="Barcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ",i+="BarKey='0' "));break;case"Base_Barcode":""!=s[this.grData.Table[o].FieldName.toString()]&&(this.ShowBarcodeDimension?(i+="BaseBarcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ",i+="BaseBarKey='"+s[this.grData.Table[o].FieldName.toString()+"_Key"].toString()+"' "):(i+="BaseBarcode='"+s[this.grData.Table[o].FieldName.toString()]+"' ",i+="BaseBarKey='0' "))}r+=i.toString(),r+="/>",t++}r+="</Data>";for(let s of this.ExcelTable)s[u].toString()==a&&(s.ProductwiseUOMConversion=r.toString(),s.ProductwiseUOMConversionCount=this.excelview.length)}}}CheckProductVendorMultipleBarcode(){let e=this.costCenterTableZero,i="",r="",a="",t=0,s=0,o=!1;for(let m=0;m<this.grData.Table.length;m++)if(null!=this.grData.Table[m].FeatureFieldName&&""!=this.grData.Table[m].FeatureFieldName.toString()&&(e.filter(h=>h.CostCenterColID==this.grData.Table[m].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"ProductCode":this.IsCode&&(t=m,r=this.grData.Table[m].FieldName.toString());break;case"ProductName":this.IsCode||(s=m,a=this.grData.Table[m].FieldName.toString());break;case"Vendor":"-23"==this.grData.Table[m][1].toString()&&(o=!0)}if(o){this.ExcelTable.includes("ProdVendorMulBarcode")||this.ExcelTable.push("ProdVendorMulBarcode"),this.lst.Clear(),this.excelview=this.ExcelTable;let m,h="",n=0;n=this.IsCode?t:s;for(let l=0;l<this.ExcelTable.length;l++)if(m=this.ExcelTable[l][n].toString(),0==this.lst.filter(g=>g.Name==m).length){this.lst.push(te._p.ComboBoxItems_1(m)),this.excelview.filter(this.IsCode?T=>T.colcode==m:T=>T.colname==m),h+="<VendorsXML>";let g=0;for(let T of this.excelview){h+="<Row  ",h+=" VendorID='0'  ",h+=" Action=\"NEW\"  MapAction='0'  ";for(let S=0;S<this.grData.Table.length;S++)if(null!=this.grData.Table[S].FeatureFieldName&&""!=this.grData.Table[S].FeatureFieldName.toString()&&(e.filter(I=>I.CostCenterColID==this.grData.Table[S].FeatureFieldName.toString()),e.length>0))switch(e[0].SysColumnName.toString()){case"Vendor":i+="AccountID='"+T[this.grData.Table[S].FieldName.toString()+"_Key"]+"' ";break;case"ETA":i+="LeadTime='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Priority":i+="Priority='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Min. Order Quantity":i+="MinOrderQty='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Barcode":i+="Barcode='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Volume":i+="Volume='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Weight":i+="Weight='"+T[this.grData.Table[S].FieldName.toString()]+"' ";break;case"Remarks":i+="Remarks='"+T[this.grData.Table[S].FieldName.toString()]+"' "}h+=i.toString(),h+="/>",g++}h+="</VendorsXML>";for(let T of this.ExcelTable)T[n].toString()==m&&(T.ProdVendorMulBarcode=h.toString())}}}ReturnDimensionProfileID(){return b.d.document.GetDataSet("SELECT distinct ProfileID ,ProfileName FROM COM_DimensionMappings WITH(NOLOCK) \nSELECT * FROM COM_DimensionMappings WITH(NOLOCK)")}ReturnSchemeProfileID(){return b.d.document.GetDataSet(" SELECT distinct(ProfileID),ProfileName FROM ADM_SchemesDiscounts WITH(NOLOCK) ").Tables[0]}ImportPriceChart(){let e,i=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let r=null,a=null,u="",c="",t="";if(i.filter(l=>"3"==l.ColumnCostCenterID),i.length>0)for(let l of this.grData.Table)if(l[1].toString()==i[0].CostCenterColID.toString()){t=l.FieldName.toString();break}for(let l=0;l<this.ExcelTable.length;l++){this.ExcelTable[l].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(i.filter(T=>T.CostCenterColID==g[1].toString()),i.length>0))if(""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID)>0)e=parseInt(i[0].ColumnCostCenterID),this.CheckCostCenterFieldName(l,e,g.FieldName.toString(),t,!1)||(this.ExcelTable[l].xIMP_STATUSx="FAIL",this.ExcelTable[l].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[l][g.FieldName.toString().Trim()]+" at Row "+(l+1).toString(),this.FailedRecourdList.push({Name:r,Message:this.ExcelTable[l].IMPORT_MESSAGE.toString()}),l<this.ExcelTable.length-1&&l++);else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"ProfileName",!0))r=this.ExcelTable[l][g.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(i[0].SysColumnName.toString(),"PriceType",!0))""==this.ExcelTable[l][g.FieldName.toString().Trim()]||"ALL"!=this.ExcelTable[l][g.FieldName.toString().Trim()].toUpperCase()&&"A"!=this.ExcelTable[l][g.FieldName.toString().Trim()]&&"0"!=this.ExcelTable[l][g.FieldName.toString().Trim()]?""==this.ExcelTable[l][g.FieldName.toString().Trim()]||"SALE"!=this.ExcelTable[l][g.FieldName.toString().Trim()].toUpperCase()&&"S"!=this.ExcelTable[l][g.FieldName.toString().Trim()]&&"1"!=this.ExcelTable[l][g.FieldName.toString().Trim()]?""==this.ExcelTable[l][g.FieldName.toString().Trim()]||"PURCHASE"!=this.ExcelTable[l][g.FieldName.toString().Trim()].toUpperCase()&&"P"!=this.ExcelTable[l][g.FieldName.toString().Trim()]&&"2"!=this.ExcelTable[l][g.FieldName.toString().Trim()]?""!=this.ExcelTable[l][g.FieldName.toString().Trim()]&&("REORDER LEVEL"==this.ExcelTable[l][g.FieldName.toString().Trim()].toUpperCase()||"RL"==this.ExcelTable[l][g.FieldName.toString().Trim()]||"3"==this.ExcelTable[l][g.FieldName.toString().Trim()])&&(c+=' Type="3" '):c+=' Type="2" ':c+=' Type="1" ':c+=' Type="0" ';else if(i[0].ColumnDataType&&"float"==i[0].ColumnDataType.toString().toLowerCase()){let T;T=!parseFloat(this.ExcelTable[l][g.FieldName.toString().Trim()]),T&&(this.ExcelTable[l].xIMP_STATUSx="FAIL",this.ExcelTable[l].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[l][g.FieldName.toString().Trim()]+" at Row "+(l+1).toString(),this.FailedRecourdList.push({Name:r,Message:this.ExcelTable[l].IMPORT_MESSAGE.toString()}),l<this.ExcelTable.length-1&&l++),c+=i[0].SysColumnName.toString()+'="'+T+'" ',this.UpdateColumns+=i[0].SysColumnName.toString()+","}else if(i[0].ColumnDataType&&"datetime"==i[0].ColumnDataType.toString().toLowerCase()){let T=new Date;T=this.ExcelTable[l][g.FieldName.toString().Trim()],N.J0.isValidDate(T)?this.sbQuery+=i[0].SysColumnName.toString()+'="'+T.toLocaleDateString("dd MMM yyyy")+'" ':(this.ExcelTable[l].xIMP_STATUSx="FAIL",this.ExcelTable[l].IMPORT_MESSAGE=g.FieldName.toString()+" "+this.ExcelTable[l][g.FieldName.toString().Trim()]+" at Row "+(l+1).toString(),this.FailedRecourdList.push({Name:r,Message:this.ExcelTable[l].IMPORT_MESSAGE.toString()}),l<this.ExcelTable.length-1&&l++)}if(0==l||a==r){if(0==this.ExcelTable[l].PID.toString().length&&(this.ExcelTable[l].xIMP_STATUSx="FAIL",this.ExcelTable[l].IMPORT_MESSAGE="Select Product at Row "+(l+1).toString(),l<this.ExcelTable.length-1&&l++),a=r,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==a).length){let g=-1;g=this.ReturnProfileIDBasedOnName(a,g),new bt.T,this.lstDuplicate.push(te._p.ComboBoxItems_1(a))}u+="<Row ",u+=this.sbQuery.toString(),u+=c.toString(),u+="/>",this.ExcelTable[l].xIMP_STATUSx="PASS"}else l--,this.SavePriceChart(u,a),a=r}u.length>0&&this.SavePriceChart(u,r),this.ListVisbility=this.FailedRecourdList.length>0;let m=this.ExcelTable.filter(l=>"PASS"==l.xIMP_STATUSx).length.toString(),h=this.ExcelTable.filter(l=>"FAIL"==l.xIMP_STATUSx).length.toString(),n=parseInt(m)+parseInt(h);m="Imported :"+m,h="Failed :"+h,this.DisplayMessage="Import completed ( Total :"+n.toString()+" "+m+" "+h+" )",this.FailedRecourdList.length>0&&(this.ListVisbility=!0),this.MessageVisibility=!0}ImportSchemesDiscountsBasedOnUniqueDimension(){let e,i;i=this.ReturnSchemeProfileID();let r=i,a=this.costCenterTableZero,u=null,c=null,t=null,s=null,o="",m="",h="",l="",T="";a.filter(f=>"3"==f.CostCenterColID);let S=0,I=this.grData.Table.filter(f=>"3"==f.FeatureFieldName);I.length>0&&I[0].FieldName.toString(),I=this.grData.Table.filter(f=>"-3"==f.FeatureFieldName),I.length>0&&(l=I[0].FieldName.toString()),I=this.grData.Table.filter(f=>"-2"==f.FeatureFieldName),I.length>0&&(T=I[0].FieldName.toString()),I=this.grData.Table.filter(f=>"-1"==f.FeatureFieldName),I.length>0&&I[0].FieldName.toString(),this.UniqueDimensionFill(),this.FreeUniqueDimensionFill();let d,y=new Date;for(let f=0;f<this.ExcelTable.length;f++){if(this.UpdateColumns="",T.length>0){if(s=this.ExcelTable[f][T].toString().Trim(),t!=s&&(h.length>0?(h.Insert(0,"<ProductsXML>"),h+="</ProductsXML>",o.replace("#@PRODXML@#",h.toString())):o.replace("#@PRODXML@#",""),h=""),this.ExcelTable[f][l].toString().Trim().length>0){if(""==this.ExcelTable[f][l+"_Key"].toString())return this.DisplayMessage=l+" "+this.ExcelTable[f][l].toString().Trim()+" at Row "+(f+1).toString(),void(this.MessageVisibility=!0);h+='<Row ProductID="'+this.ExcelTable[f][l+"_Key"].toString()+'" ';for(let D of this.grData.Table)if(null!=D[1]&&""!=D[1].toString()&&"0"!=D[1].toString()&&(a.filter(p=>p.CostCenterColID==D[1].toString()),a.length>0))if(d=a[0].SysColumnName.toString(),0==N.J0.stringCompare(a[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[f][D.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[f][D.FieldName.toString().Trim()]?""==this.ExcelTable[f][D.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[f][D.FieldName.toString().Trim()]?""!=this.ExcelTable[f][D.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[f][D.FieldName.toString().Trim()])&&(h+=' IsQtyPercent="2" '):h+=' IsQtyPercent="1" ':h+=' IsQtyPercent="0" ';else if(a[0].ColumnDataType&&"float"==a[0].ColumnDataType.toString().toLowerCase()){let p;if(p=this.ExcelTable[f][D.FieldName.toString().Trim()],!parseFloat(p))return this.DisplayMessage=D.FieldName.toString()+" "+this.ExcelTable[f][D.FieldName.toString().Trim()]+" at Row "+(f+1).toString(),void(this.MessageVisibility=!0);h+=a[0].SysColumnName.toString()+'="'+p+'" ',this.UpdateColumns+=a[0].SysColumnName.toString()+","}h+="/>"}if(t==s)continue}for(let D of this.grData.Table)if(null!=D[1]&&""!=D[1].toString()&&"0"!=D[1].toString()&&(a.filter(p=>p.CostCenterColID==D[1].toString()),a.length>0))if(d=a[0].SysColumnName.toString(),""!=a[0].ColumnCostCenterID.toString()&&parseInt(a[0].ColumnCostCenterID)>0){if(e=parseInt(a[0].ColumnCostCenterID),"FreeProduct"!=d){let p;if(""==this.ExcelTable[f][D.FieldName.toString()+"_Key"].toString())return this.DisplayMessage=D.FieldName.toString()+" "+this.ExcelTable[f][D.FieldName.toString().Trim()]+" at Row "+(f+1).toString(),void(this.MessageVisibility=!0);3==e?this.sbQuery+='ProductID="'+this.ExcelTable[f][D.FieldName.toString()+"_Key"].toString()+'" ':2==e?this.sbQuery+='AccountID="'+this.ExcelTable[f][D.FieldName.toString()+"_Key"].toString()+'" ':p=e-5e4,this.sbQuery+="CC"+p+'="'+this.ExcelTable[f][D.FieldName.toString()+"_Key"].toString()+'" '}}else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[f][D.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[f][D.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[f][D.FieldName.toString().Trim()]?""==this.ExcelTable[f][D.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[f][D.FieldName.toString().Trim()]?""!=this.ExcelTable[f][D.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[f][D.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[f][D.FieldName.toString().Trim()])&&(m+=' IsQtyPercent="2" '):m+=' IsQtyPercent="1" ':m+=' IsQtyPercent="0" ';else if(a[0].ColumnDataType&&"float"==a[0].ColumnDataType.toString().toLowerCase()){let p;if(p=this.ExcelTable[f][D.FieldName.toString().Trim()],!parseFloat(p))return this.DisplayMessage=D.FieldName.toString()+" "+this.ExcelTable[f][D.FieldName.toString().Trim()]+" at Row "+(f+1).toString(),void(this.MessageVisibility=!0);m+=a[0].SysColumnName.toString()+'="'+p+'" ',this.UpdateColumns+=a[0].SysColumnName.toString()+","}else if(a[0].ColumnDataType&&"date"==a[0].ColumnDataType.toString().toLowerCase()){if(y=this.ExcelTable[f][D.FieldName.toString().Trim()],!N.J0.isValidDate(y))return this.DisplayMessage=D.FieldName.toString()+" "+this.ExcelTable[f][D.FieldName.toString().Trim()]+" at Row "+(f+1).toString(),void(this.MessageVisibility=!0);m+=a[0].SysColumnName.toString()+'="'+y.toLocaleDateString("dd MMM yyyy")+'" '}if(t=s,0==f||c==u)c=u,this.IsUpdate&&0==this.lstDuplicate.filter(D=>D.Name==c).length&&(r.filter(D=>D.ProfileName==c),r.length>0&&(S=parseInt(r[0].ProfileID.toString())),this.lstDuplicate.push(te._p.ComboBoxItems_1(c))),o+="<Row> ",o+="<XML ",r.filter(D=>D.ProfileName==c),r.length>0&&(S=parseInt(r[0].ProfileID.toString())),o+=this.sbQuery.toString(),o+='SchemeID="0" ',o+='StatusID="500018" ',o+=m.toString(),o+=">",T.length>0&&(o+="#@PRODXML@#"),o+="</XML>",o+="</Row>";else{f--,o.Insert(0,"<XML>"),o+="</XML>",r.filter(F=>F.ProfileName==c),r.length>0&&(S=parseInt(r[0].ProfileID.toString()));let p=[];p.push(S),p.push(c),p.push(o.toString()),p.push(b.d.SessionManager.CompanyGUID),p.push(b.d.SessionManager.UserName),p.push(b.d.SessionManager.UserID),p.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveSchemes(p),c=u,o="",h="",t=null}}if(o.length>0){r.filter(p=>p.ProfileName==c),r.length>0&&(S=parseInt(r[0].ProfileID.toString())),h.length>0?(h.Insert(0,"<ProductsXML>"),h+="</ProductsXML>",o.replace("#@PRODXML@#",h.toString())):o.replace("#@PRODXML@#",""),o.Insert(0,"<XML>"),o+="</XML>";let D=[];D.push(S),D.push(c),D.push(o.toString()),D.push(b.d.SessionManager.CompanyGUID),D.push(b.d.SessionManager.UserName),D.push(b.d.SessionManager.UserID),D.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveSchemes(D)}this.ListVisbility=this.FailedRecourdList.length>0}ImportSchemesDiscounts(){let e,i;i=this.ReturnSchemeProfileID();let r=i,a=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("FPID")||this.ExcelTable.push("FPID");let u=null,c=null,t=null,s=null,o=500018,m="",h="",n="",l="",g="",S="";a.filter(D=>3==D.ColumnCostCenterID);let I=0,d=this.grData.Table.filter(D=>"3"==D.FeatureFieldName);d.length>0&&(l=d[0].FieldName.toString()),d=this.grData.Table.filter(D=>"-3"==D.FeatureFieldName),d.length>0&&(g=d[0].FieldName.toString()),d=this.grData.Table.filter(D=>"-2"==D.FeatureFieldName),d.length>0&&(S=d[0].FieldName.toString()),d=this.grData.Table.filter(D=>"-1"==D.FeatureFieldName),d.length>0&&d[0].FieldName.toString();let y,f=new Date;for(let D=0;D<this.ExcelTable.length;D++){if(h="",this.ExcelTable[D].Query="",this.sbQuery="",this.UpdateColumns="",S.length>0){if(s=this.ExcelTable[D][S].toString().Trim(),t!=s&&(n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",m.replace("#@PRODXML@#",n.toString())):m.replace("#@PRODXML@#",""),n=""),this.ExcelTable[D][g].toString().Trim().length>0){if(!this.CheckCostCenterFieldName(D,3,g,"FreeProduct",!1))return this.DisplayMessage=g+" "+this.ExcelTable[D][g].toString().Trim()+" at Row "+(D+1).toString(),void(this.MessageVisibility=!0);n+='<Row ProductID="'+this.ExcelTable[D].FPID.toString()+'" ';for(let p of this.grData.Table)if(null!=p[1]&&""!=p[1].toString()&&"0"!=p[1].toString()&&(a.filter(F=>F.CostCenterColID==p[1].toString()),a.length>0))if(y=a[0].SysColumnName.toString(),0==N.J0.stringCompare(a[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[D][p.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[D][p.FieldName.toString().Trim()]?""==this.ExcelTable[D][p.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[D][p.FieldName.toString().Trim()]?""!=this.ExcelTable[D][p.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[D][p.FieldName.toString().Trim()])&&(n+=' IsQtyPercent="2" '):n+=' IsQtyPercent="1" ':n+=' IsQtyPercent="0" ';else if(a[0].ColumnDataType&&"float"==a[0].ColumnDataType.toString().toLowerCase()){let F;if(F=this.ExcelTable[D][p.FieldName.toString().Trim()],!parseFloat(F))return this.DisplayMessage=p.FieldName.toString()+" "+this.ExcelTable[D][p.FieldName.toString().Trim()]+" at Row "+(D+1).toString(),void(this.MessageVisibility=!0);n+=a[0].SysColumnName.toString()+'="'+F+'" ',this.UpdateColumns+=a[0].SysColumnName.toString()+","}n+="/>"}if(t==s)continue}for(let p of this.grData.Table)if(null!=p[1]&&""!=p[1].toString()&&"0"!=p[1].toString()&&(a.filter(F=>F.CostCenterColID==p[1].toString()),a.length>0))if(y=a[0].SysColumnName.toString(),""!=a[0].ColumnCostCenterID.toString()&&parseInt(a[0].ColumnCostCenterID)>0){if(e=parseInt(a[0].ColumnCostCenterID),"FreeProduct"!=y&&!this.CheckCostCenterFieldName(D,e,p.FieldName.toString(),l,!1))return this.DisplayMessage=p.FieldName.toString()+" "+this.ExcelTable[D][p.FieldName.toString().Trim()]+" at Row "+(D+1).toString(),void(this.MessageVisibility=!0)}else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[D][p.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"StatusID",!0))o="Active"==this.ExcelTable[D][p.FieldName.toString()]?500018:500019;else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"IsQtyPercent",!0))""==this.ExcelTable[D][p.FieldName.toString().Trim()]||"VALUE"!=this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()&&"0"!=this.ExcelTable[D][p.FieldName.toString().Trim()]?""==this.ExcelTable[D][p.FieldName.toString().Trim()]||"QTY"!=this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[D][p.FieldName.toString().Trim()]?""!=this.ExcelTable[D][p.FieldName.toString().Trim()]&&("PERCENTAGE AS DISCOUNT"==this.ExcelTable[D][p.FieldName.toString().Trim()].toUpperCase()||"2"==this.ExcelTable[D][p.FieldName.toString().Trim()])&&(h+=' IsQtyPercent="2" '):h+=' IsQtyPercent="1" ':h+=' IsQtyPercent="0" ';else if(a[0].ColumnDataType&&"float"==a[0].ColumnDataType.toString().toLowerCase()){let F;if(F=this.ExcelTable[D][p.FieldName.toString().Trim()],!parseFloat(F))return this.DisplayMessage=p.FieldName.toString()+" "+this.ExcelTable[D][p.FieldName.toString().Trim()]+" at Row "+(D+1).toString(),void(this.MessageVisibility=!0);h+=a[0].SysColumnName.toString()+'="'+F+'" ',this.UpdateColumns+=a[0].SysColumnName.toString()+","}else if(a[0].ColumnDataType&&"date"==a[0].ColumnDataType.toString().toLowerCase()){if(f=this.ExcelTable[D][p.FieldName.toString().Trim()],!N.J0.isValidDate(f))return this.DisplayMessage=p.FieldName.toString()+" "+this.ExcelTable[D][p.FieldName.toString().Trim()]+" at Row "+(D+1).toString(),void(this.MessageVisibility=!0);h+=a[0].SysColumnName.toString()+'="'+f.toLocaleDateString("dd MMM yyyy")+'" '}if(t=s,0==D||c==u)c=u,this.IsUpdate&&0==this.lstDuplicate.filter(p=>p.Name==c).length&&(r.filter(p=>p.ProfileName==c),r.length>0&&(I=parseInt(r[0].ProfileID.toString())),this.lstDuplicate.push(te._p.ComboBoxItems_1(c))),m+="<Row> ",m+="<XML ",r.filter(p=>p.ProfileName==c),r.length>0&&(I=parseInt(r[0].ProfileID.toString())),m+=this.sbQuery.toString(),m+='SchemeID="0" ',m+='StatusID="'+o+'" ',m+=h.toString(),m+=">",S.length>0&&(m+="#@PRODXML@#"),m+="</XML>",m+="</Row>";else{D--,m.Insert(0,"<XML>"),m+="</XML>",r.filter(E=>E.ProfileName==c),r.length>0&&(I=parseInt(r[0].ProfileID.toString()));let F=[];F.push(I),F.push(c),F.push(m.toString()),F.push(b.d.SessionManager.CompanyGUID),F.push(b.d.SessionManager.UserName),F.push(b.d.SessionManager.UserID),F.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveSchemes(F),c=u,m="",n="",t=null}}if(m.length>0){r.filter(F=>F.ProfileName==c),r.length>0&&(I=parseInt(r[0].ProfileID.toString())),n.length>0?(n.Insert(0,"<ProductsXML>"),n+="</ProductsXML>",m.replace("#@PRODXML@#",n.toString())):m.replace("#@PRODXML@#",""),m.Insert(0,"<XML>"),m+="</XML>";let p=[];p.push(I),p.push(c),p.push(m.toString()),p.push(b.d.SessionManager.CompanyGUID),p.push(b.d.SessionManager.UserName),p.push(b.d.SessionManager.UserID),p.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveSchemes(p)}this.ListVisbility=this.FailedRecourdList.length>0}ImportDimensionMapping(){let e,i=0,r=this.ReturnDimensionProfileID(),a=r.Tables[0],u=r.Tables[1],c=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID");let t=null,s=null,o="",m="",h="";c.filter(l=>"3"==l.ColumnCostCenterID);let n=0;if(c.length>0)for(let l of this.grData.Table)if(l[1].toString()==c[0].CostCenterColID.toString()){h=l.FieldName.toString();break}for(let l=0;l<this.ExcelTable.length;l++){m="",this.ExcelTable[l].Query="",this.sbQuery="",this.UpdateColumns="";for(let g of this.grData.Table)if(null!=g[1]&&""!=g[1].toString()&&"0"!=g[1].toString()&&(c.filter(T=>T.CostCenterColID==g[1].toString()),c.length>0))if(""!=c[0].ColumnCostCenterID.toString()&&parseInt(c[0].ColumnCostCenterID)>0){if(e=parseInt(c[0].ColumnCostCenterID),!this.CheckCostCenterFieldName(l,e,g.FieldName.toString(),h,!0))return this.DisplayMessage=g.FieldName.toString()+" "+this.ExcelTable[l][g.FieldName.toString().Trim()]+" at Row "+(l+1).toString(),void(this.MessageVisibility=!0)}else 0==N.J0.stringCompare(c[0].SysColumnName.toString(),"ProfileName",!0)?t=this.ExcelTable[l][g.FieldName.toString().Trim()]:c[0].ColumnDataType&&"bit"==c[0].ColumnDataType.toString().toLowerCase()&&("YES"==this.ExcelTable[l][g.FieldName.toString()].toUpperCase()||"1"==this.ExcelTable[l][g.FieldName.toString()]?i=1:("NO"==this.ExcelTable[l][g.FieldName.toString()].toUpperCase()||"0"==this.ExcelTable[l][g.FieldName.toString()])&&(i=0),m+='<Row cols ="'+c[0].SysColumnName.toString().replace("BasedCC","")+'"  IsBase="'+i+'" />');if(0==l||s==t)s=t,this.IsUpdate&&0==this.lstDuplicate.filter(g=>g.Name==s).length&&(a.filter(g=>g.ProfileName==s),a.length>0&&(n=parseInt(a[0].ProfileID.toString())),this.lstDuplicate.push(te._p.ComboBoxItems_1(s))),o+="<Row ",n>0?(u.RowFilter=this.sbQuery.toString().replace(" "," AND ").replace('"',"'")+" ProfileID='"+n+"'",o+=u.length>0?'DimMapID="'+u[0].DimensionMappingsID.toString()+'" ':'DimMapID="0" '):o+='DimMapID="0" ',o+=this.sbQuery.toString(),o+="/>";else{l--,o.Insert(0,"<XML>"),m.Insert(0,"<XML>"),o+="</XML>",m+="</XML>",a.filter(S=>S.ProfileName==s),a.length>0&&(n=parseInt(a[0].ProfileID.toString()));let T=[];T.push(n),T.push(s),T.push(o.toString()),T.push(m.toString()),T.push(""),T.push(!1),T.push(b.d.SessionManager.CompanyGUID),T.push(b.d.SessionManager.UserName),T.push(b.d.SessionManager.UserID),T.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveDimensionMap(T),s=t,o="",m=""}}if(o.length>0){a.filter(T=>T.ProfileName==s),a.length>0&&(n=parseInt(a[0].ProfileID.toString())),o.Insert(0,"<XML>"),m.Insert(0,"<XML>"),o+="</XML>",m+="</XML>";let g=[];g.push(n),g.push(s),g.push(o.toString()),g.push(m.toString()),g.push(""),g.push(!1),g.push(b.d.SessionManager.CompanyGUID),g.push(b.d.SessionManager.UserName),g.push(b.d.SessionManager.UserID),g.push(b.d.SessionManager.LanguageID),this.DisplayMessage=b.d.document.SaveDimensionMap(g)}this.ListVisbility=this.FailedRecourdList.length>0}ImportTaxChart(){let e,a=this.costCenterTableZero;this.ExcelTable.includes("Query")||this.ExcelTable.push("Query"),this.ExcelTable.includes("PID")||this.ExcelTable.push("PID"),this.ExcelTable.includes("DocID")||this.ExcelTable.push("DocID"),this.ExcelTable.includes("ColID")||this.ExcelTable.push("ColID");let u=null,c=null,t="",s="",o=new Date;for(let m=0;m<this.ExcelTable.length&&m!=this.ExcelTable.length;m++){s="";let l,h=0,n=0,g="",T="";this.ExcelTable[m].Query="",this.sbQuery="",this.UpdateColumns="",this.TaxCCUpdate="";for(let S of this.grData.Table)if(null!=S[1]&&""!=S[1].toString()&&"0"!=S[1].toString()&&(a.filter(I=>I.CostCenterColID==S[1].toString()),a.length>0))if(""!=a[0].ColumnCostCenterID.toString()&&parseInt(a[0].ColumnCostCenterID)>0)e=parseInt(a[0].ColumnCostCenterID),this.CheckCostCenterFieldName(m,e,S.FieldName.toString(),"",!1)||(this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[m][S.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++);else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"ProfileName",!0))u=this.ExcelTable[m][S.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"DocID",!0))g=this.ExcelTable[m][S.FieldName.toString().Trim()];else if(0==N.J0.stringCompare(a[0].SysColumnName.toString(),"ColID",!0))T=this.ExcelTable[m][S.FieldName.toString().Trim()];else if(a[0].ColumnDataType&&"float"==a[0].ColumnDataType.toString().toLowerCase()){let I;I=this.ExcelTable[m][S.FieldName.toString().Trim()],parseFloat(I)||(this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[m][S.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++),s+=' Price="'+I+'"  '}else a[0].ColumnDataType&&"date"==a[0].ColumnDataType.toString().toLowerCase()&&(o=this.ExcelTable[m][S.FieldName.toString().Trim()],N.J0.isValidDate(o)?this.sbQuery+=a[0].SysColumnName.toString()+'="'+o.toLocaleDateString("dd MMM yyyy")+'" ':(this.DisplayMessage=S.FieldName.toString()+" "+this.ExcelTable[m][S.FieldName.toString().Trim()]+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++));if(this.TaxCCUpdate.length>0&&(this.sbQuery+=' CCUpdate="'+this.TaxCCUpdate+'"'),g.length>0){if(l=b.d.document.GetDocumentIDByName(g),null!=l&&(l.Tables[0].length>0&&(h=parseInt(l.Tables[0][0].CostCenterID.toString())),0==h&&(this.DisplayMessage="Invalid Document"+g+"at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++),null!=l&&l.Tables.length>1&&l.Tables[1].length>0))if(T.length>0){let S=l.Tables[1];S.RowFilter="UserColumnName='"+T.toString()+"'",S.length>0?n=parseInt(S[0].CostCenterColID.toString()):(this.DisplayMessage="Invalid Column name "+T+" at Row "+(m+1).toString(),this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++)}else this.DisplayMessage="Column name does not exist",this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++}else this.DisplayMessage="Document name does not exist",this.MessageVisibility=!0,this.ExcelTable[m].xIMP_STATUSx="FAIL",this.ExcelTable[m].IMPORT_MESSAGE=this.DisplayMessage,this.DisplayMessage="",m++;if(0==m||c==u)c=u,t+="<Row ",t+=' DocID="'+h+'" ',t+=' ColID="'+n+'" ',t+=this.sbQuery.toString(),t+=s.toString(),t+="/>",this.ExcelTable[m].xIMP_STATUSx="PASS";else{this.DisplayMessage="";let S=0;if(this.IsUpdate&&(S=this.ReturnTaxProfileIDBasedOnName(c,S),S<=0)){this.DisplayMessage="Profile with "+c+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage});continue}if(""==this.DisplayMessage){let I,d;t.Insert(0,"<XML>"),t+="</XML>",d=this.oChart.SetTaxChartNew(S<=0&&!this.IsUpdate?0:S,c,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=d,I<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage}),m--}c=u,t=""}}if(t.length>0){let h,n,m=0;this.IsUpdate&&(m=this.ReturnTaxProfileIDBasedOnName(c,m),m<=0&&(this.DisplayMessage="Profile with "+c+" does not exist",this.MessageVisibility=!0,this.FailedRecourdList.push({Name:c,Message:this.DisplayMessage}))),t.Insert(0,"<XML>"),t+="</XML>",n=this.oChart.SetTaxChartNew(this.ProfileID<=0&&!this.IsUpdate?0:m,c,0,!1,t.toString(),"",!0),this.MessageVisibility=!0,this.DisplayMessage=n,h<0&&this.FailedRecourdList.push({Name:u,Message:this.DisplayMessage})}this.ListVisbility=this.FailedRecourdList.length>0}UniqueDimensionFill(){let e=null,i=[];for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(this.CostCenterID=parseInt(a.FeatureFieldName),this.CostCenterID>0&&!i.includes(this.CostCenterID)&&(2==this.CostCenterID||3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(a[0].toString()+"_Key")||this.ExcelTable.push(a[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var r=this.grData.Table.filter(c=>c.FeatureFieldName==u);if(!(r.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!i.includes(u)){this.ExcelTable.includes(r[0][0].toString()+"_Key")||this.ExcelTable.push(r[0][0].toString()+"_Key");let t="";for(let o=0;o<this.ExcelTable.length;o++)""!=t&&(t+=","),t+="'"+U.Dw.GetValidXml(this.ExcelTable[o][r[0][0].toString()])+"'";let s=b.d.document.GetCCValues(t,u,this.IsCode?1:0);i.push(u,s)}this.ExcelTable.includes("UniqDim")||this.ExcelTable.push("UniqDim");let c="";for(let t=0;t<this.ExcelTable.length;t++)e=i[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][r[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=c&&(c+=" or "),3==this.CostCenterID?c+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?c+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(c+=" ("+(this.IsCode?"Code":"Name")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].UniqDim=e[0].ID.toString());if(""!=c){let s=b.d.document.GetCCValues(c,this.CostCenterID,"ccnid"+(u-5e4));i.push(this.CostCenterID,s)}}}else{let c="";for(let s=0;s<this.ExcelTable.length;s++)""!=c&&(c+=","),c+="'"+U.Dw.GetValidXml(this.ExcelTable[s][a[0].toString()])+"'";let t=b.d.document.GetCCValues(c,this.CostCenterID,this.IsCode?1:0);i.push(this.CostCenterID,t)}}for(let a=0;a<this.ExcelTable.length;a++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let c=parseInt(u.FeatureFieldName);if(c>0&&(2==c||3==c||11==c||c>5e4)&&i.Contains(c)&&null!=i[c]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[a][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[a][u[0].toString()].Trim().replace("'","''")+"'",i[c].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[a].UniqDim.toString()),e=i[c].Select(t),null!=e&&e.length>0&&(this.ExcelTable[a][u[0].toString()+"_Key"]=e[0].ID.toString())}}}FreeUniqueDimensionFill(){let e=null,i=[];for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(this.CostCenterID=-parseInt(a.FeatureFieldName),this.CostCenterID>0&&!i.Contains(this.CostCenterID)&&(3==this.CostCenterID||11==this.CostCenterID||this.CostCenterID>5e4))){this.ExcelTable.includes(a[0].toString()+"_Key")||this.ExcelTable.push(a[0].toString()+"_Key");let u=this.ScreenObject.GetUniqueDimension(this.CostCenterID,this.IsCode);if(u>5e4){var r=this.grData.Table.filter(c=>c.FeatureFieldName=="-"+u);if(!(r.length>0))return this.DisplayMessage="Define Unique dimension column",void(this.MessageVisibility=!0);{if(!i.Contains(u)){this.ExcelTable.includes(r[0][0].toString()+"_Key")||this.ExcelTable.push(r[0][0].toString()+"_Key");let t="";for(let o=0;o<this.ExcelTable.length;o++)""!=t&&(t+=","),t+="'"+U.Dw.GetValidXml(this.ExcelTable[o][r[0][0].toString()])+"'";let s=b.d.document.GetCCValues(t,u,this.IsCode?1:0);i.push(u,s)}this.ExcelTable.includes("FreeUniqDim")||this.ExcelTable.push("FreeUniqDim");let c="";for(let t=0;t<this.ExcelTable.length;t++)e=i[u].Select((this.IsCode?"Code":"Name")+"='"+this.ExcelTable[t][r[0][0].toString()].Trim().replace("'","''")+"'"),e.length>0&&(""!=c&&(c+=" or "),3==this.CostCenterID?c+=" ("+(this.IsCode?"ProductCode":"ProductName")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":2==this.CostCenterID?c+=" ("+(this.IsCode?"AccountCode":"AccountName")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")":this.CostCenterID>5e4&&(c+=" ("+(this.IsCode?"Code":"Name")+"='"+U.Dw.GetValidXml(this.ExcelTable[t][a[0].toString()])+"' and ccnid"+(u-5e4)+"="+e[0].ID.toString()+")"),this.ExcelTable[t].FreeUniqDim=e[0].ID.toString());if(""!=c){let s=b.d.document.GetCCValues(c,this.CostCenterID,"ccnid"+(u-5e4));i.push(this.CostCenterID,s)}}}else{let c="";for(let s=0;s<this.ExcelTable.length;s++)""!=c&&(c+=","),c+="'"+U.Dw.GetValidXml(this.ExcelTable[s][a[0].toString()])+"'";let t=b.d.document.GetCCValues(c,this.CostCenterID,this.IsCode?1:0);i.push(this.CostCenterID,t)}}for(let a=0;a<this.ExcelTable.length;a++)for(let u of this.grData.Table){if(null==u[1]||""==u[1].toString()||"0"==u[1].toString())continue;let c=-parseInt(u.FeatureFieldName);if(c>0&&(3==c||11==c||c>5e4)&&i.Contains(c)&&null!=i[c]){let t="";t=this.IsCode?"Code='"+this.ExcelTable[a][u[0].toString()].Trim().replace("'","''")+"'":"Name='"+this.ExcelTable[a][u[0].toString()].Trim().replace("'","''")+"'",i[c].Columns.Contains("dim")&&(t+=" and dim="+this.ExcelTable[a].FreeUniqDim.toString()),e=i[c].Select(t),null!=e&&e.length>0&&(this.ExcelTable[a][u[0].toString()+"_Key"]=e[0].ID.toString())}}}ImportDimensionWisePriceChart(){let e=this.costCenterTableZero,i=[],r=null;for(let y=0;y<this.ExcelTable.length;y++)r=this.grData.Table.filter(f=>f.FieldName==this.ExcelTable[y]&&-5e4==f.FieldName),r.length>0&&i.push(this.ExcelTable[y].ColumnName,this.ExcelTable[y].DataType);if(r=this.grData.Table.filter(y=>5e4==y.FieldName),r.length>0)for(let y=0;y<r.length;y++)parseInt(r[y][1].toString())<-5e4&&(e.filter(f=>f.CostCenterColID==r[y][1].toString()),e.length>0&&!i.includes(e[0].SysColumnName.toString())&&(i.push(e[0].SysColumnName.toString()),i.push(e[0].SysColumnName.toString()+"_Value",typeof parseFloat)));let a=null,u=null,c=!0;for(let y=0;y<this.ExcelTable.length;y++){a={};for(let f of this.grData.Table)null==f[1]||""==f[1].toString()||"0"==f[1].toString()||parseInt(f[1].toString())>-5e4&&(a[f.FieldName.toString()]=this.ExcelTable[y][f.FieldName.toString()]);c=!0;for(let f=0;f<this.ExcelTable.length;f++)r=this.grData.Table.filter(D=>D.FieldName==this.ExcelTable[f]&&-5e4==D.FeatureFieldName),r.length>0&&(c=!1,this.grData.Table.filter(D=>D.CostCenterColID==r[0][1].toString()),a[e[0].SysColumnName.toString()]=this.ExcelTable[f].ColumnName,a[e[0].SysColumnName.toString()+"_Value"]=this.ExcelTable[y][r[0].FieldName.toString()],i.push(a.ItemArray));c&&i.push(a.ItemArray)}for(let y=0;y<this.ExcelTable.length;y++){r=this.grData.Table.filter(f=>f.FieldName==this.ExcelTable[y]&&f.FeatureFieldName<-5e4);for(let f=0;f<r.length;f++)this.grData.Table.Remove(r[f]);""!=e[0].SysColumnName.toString()&&0==this.grData.Table.filter(f=>f.FieldName==e[0].SysColumnName.toString()).length&&(u={},u.FieldName=e[0].SysColumnName.toString(),u.FeatureFieldName=-parseInt(e[0].CostCenterColID.toString()),this.grData.Table.push(u))}this.UniqueDimensionFill();let t="",s="",o="";if(this.grData.Table.filter(y=>"3"==y.FeatureFieldName))return this.DisplayMessage="Product Not Exists",void(this.MessageVisibility=!0);let m=null;if(this.ExcelTable.filter(y=>y.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0&&(m=this.ExcelTable.filter(y=>y.FeatureFieldName=="3".FieldName.toString()+"_Key]<>''").length>0),null==m)return this.DisplayMessage="Enter valid data",void(this.MessageVisibility=!0);if(this.grData.Table.filter(y=>"-1"==y.FeatureFieldName).length>0&&(t=this.grData.Table.filter(y=>"-1"==y.FeatureFieldName)[0].FieldName.toString()),""==t)return this.DisplayMessage="Profile Name Not Exists",void(this.MessageVisibility=!0);m.Sort="["+t+"]",this.grData.Table.filter(y=>"-4"==y.FeatureFieldName).length>0&&(s=this.grData.Table.filter(y=>"-4"==y.FeatureFieldName)[0].FieldName.toString());let h="",n="",l=0,g=0,S="",I=new Date;for(let y=0;y<m.length;y++,this.ProgressValue++){h=n,n=m[y][t].toString(),h!=n&&y>0&&(this.SavePriceChart(S,h)<=0?(g++,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage})):l++,this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+g.toString(),S=""),""!=s&&(e.filter(f=>f.SysColumnName==m[y][s].toString()||f.UserColumnName==m[y][s].toString()),e.length>0&&(o=e[0].SysColumnName.toString())),S+="<Row ";for(let f of this.grData.Table)if(null!=f[1]&&""!=f[1].toString()&&"0"!=f[1].toString()&&(e.filter(D=>D.CostCenterColID==f[1].toString()),e.length>0))if(""!=e[0].ColumnCostCenterID.toString()&&parseInt(e[0].ColumnCostCenterID)>0){if(S+=e[0].SysColumnName.toString()+'="'+m[y][f.FieldName.toString()+"_Key"].toString()+'" ',m.Table.Columns.Contains(f.FieldName.toString()+"_Value")&&!N.J0.IsEmpty(o)){let D=m[y][f.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(D))return this.DisplayMessage=f.FieldName.toString()+" "+m[y][f.FieldName.toString()+"_Value"].toString().Trim()+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);S+=o+'="'+D+'" '}}else if(0==N.J0.stringCompare(e[0].SysColumnName.toString(),"PriceType",!0))""==m[y][f.FieldName.toString().Trim()]||"ALL"!=m[y][f.FieldName.toString().Trim()].toUpperCase()&&"A"!=m[y][f.FieldName.toString().Trim()]&&"0"!=m[y][f.FieldName.toString().Trim()]?""==m[y][f.FieldName.toString().Trim()]||"SALE"!=m[y][f.FieldName.toString().Trim()].toUpperCase()&&"S"!=m[y][f.FieldName.toString().Trim()]&&"1"!=m[y][f.FieldName.toString().Trim()]?""==m[y][f.FieldName.toString().Trim()]||"PURCHASE"!=m[y][f.FieldName.toString().Trim()].toUpperCase()&&"P"!=m[y][f.FieldName.toString().Trim()]&&"2"!=m[y][f.FieldName.toString().Trim()]?""!=m[y][f.FieldName.toString().Trim()]&&("REORDER LEVEL"==m[y][f.FieldName.toString().Trim()].toUpperCase()||"RL"==m[y][f.FieldName.toString().Trim()]||"3"==m[y][f.FieldName.toString().Trim()])&&(S+=' Type="3" '):S+=' Type="2" ':S+=' Type="1" ':S+=' Type="0" ';else if(e[0].ColumnDataType&&"float"==e[0].ColumnDataType.toString().toLowerCase()){let D=m[y][f.FieldName.toString()+"_Value"].toString().Trim();if(!parseFloat(D))return this.DisplayMessage=f.FieldName.toString()+" "+m[y][f.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);S+=e[0].SysColumnName.toString()+'="'+D+'" '}else if(e[0].ColumnDataType&&"datetime"==e[0].ColumnDataType.toString().toLowerCase()){if(I=m[y][f.FieldName.toString().Trim()],!N.J0.isValidDate(I))return this.DisplayMessage=f.FieldName.toString()+" "+m[y][f.FieldName.toString().Trim()]+" at Row "+(y+1).toString(),void(this.MessageVisibility=!0);S+=e[0].SysColumnName.toString()+'="'+I.toLocaleDateString("dd MMM yyyy")+'" '}S+=" />"}this.SavePriceChart(S,h)<=0?(g++,this.FailedRecourdList.push({Name:h,Message:this.DisplayMessage})):l++,this.ImportedCount="Imported :"+l.toString(),this.FailedCount="Failed :"+g.toString(),this.DisplayMessage="Import completed ( Total :"+(g+l).toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}SavePriceChart(e,i){if(e.length>0){e.Insert(0,"<XML>"),e+="</XML>";try{let a=new bt.T,u=0;try{this.IsUpdate&&(u=this.ReturnProfileIDBasedOnName(i,u))}catch(c){Logger.ErrorLog("Error Save Price chart message ="+c.Message)}this.DisplayMessage=a.SetPriceChartNew(u,i,0,!1,e.toString(),"",0,!0),this.FailedRecourdList.push({Name:i,Message:this.DisplayMessage})}catch{}}return 0}ReturnProfileIDBasedOnName(e,i){let r=b.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCPrices WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&""!=r.Tables[0][0][0].toString()&&(i=parseInt(r.Tables[0][0][0])),i}ReturnTaxProfileIDBasedOnName(e,i){let r=b.d.document.GetDataSet(" SELECT isnull(ProfileID,0) FROM COM_CCTaxes WITH(NOLOCK) WHERE ProfileName='"+e+"'");return null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&""!=r.Tables[0][0][0].toString()&&(i=parseInt(r.Tables[0][0][0])),i}CheckCostCenterFieldName(e,i,r,a,u){if(!this.ccdv.includes(i)){let t=b.d.document.GetCostCenterDetailsBYCostCenterID(i,"").Tables[0];this.ccdv.push(i,t)}if(this.IsCode?11==i?(""!=a&&this.IsCode&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"' and ProductCode='"+this.ExcelTable[e][a].toString().Trim().replace("'","''")+"'"),0==this.ccdv[i].length&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"' and (ProductCode is null or ProductCode='DynamicSet')")):this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"'":11==i?(""!=a&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"' and ProductName='"+this.ExcelTable[e][a].toString().Trim().replace("'","''")+"'"),0==this.ccdv[i].length&&(this.ccdv[i].RowFilter="Code='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"' and (ProductName is null or ProductName='DynamicSet')")):this.ccdv[i].RowFilter="Name='"+this.ExcelTable[e][r].toString().Trim().replace("'","''")+"'",this.ccdv[i].length>0){if(3==i)"FreeProduct"==a?this.ExcelTable[e].FPID=this.ccdv[i][0].NodeID:(this.ExcelTable[e].PID=this.ccdv[i][0].NodeID,this.sbQuery+='ProductID="'+this.ccdv[i][0].NodeID+'" ');else if(2==i)this.sbQuery+='AccountID="'+this.ccdv[i][0].NodeID+'" ';else if(11==i)this.sbQuery+='UOMID="'+this.ccdv[i][0].NodeID+'" ';else if(12==i)this.sbQuery+='CurrencyID="'+this.ccdv[i][0].NodeID+'" ';else if(u)this.sbQuery+="CCNID"+i-5e4+'="'+this.ccdv[i][0].NodeID+'" ';else if(45==parseInt(this.Feature.SelectedValue)){this.TaxCCUpdate+=",CCNID"+(i-5e4)+"="+this.ccdv[i][0].NodeID;var c="CC"+(i-5e4);this.IsUpdate&&(this.sbQuery+=c+'="'+this.ccdv[i][0].NodeID+'" ')}else this.sbQuery+=c-5e4+'="'+this.ccdv[i][0].NodeID+'" ';return!0}return!1}ReturnAssets(){return b.d.document.GetDataSet("select AssetID,AssetCode,AssetName,GUID from ACC_Assets WITH(NOLOCK)")}ImportAssets(){let i,e=0,r="",a="",u="",c="",t=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let s="",o=null,m=null,h=this.objCG.GetScreenInfo(72),n=null;h.Tables.length>0&&null!=h.Tables[0]&&(n=h.Tables[0]);let S,f,l=new Ft(n),g=1,T="",I="",d="",y=0;this.IsUpdate&&(g=-1);for(let D=0;D<this.ExcelTable.length;D++,this.ProgressValue++){S="",T="",I="",s="",y=0;for(let x=0;x<l.lstColumn.length;x++)l.lstColumn[x].ActualValue="";for(let x=0;x<this.grData.Table.length;x++)null==this.grData.Table[x].FeatureFieldName||""==this.grData.Table[x].FeatureFieldName.toString()||(t.filter(B=>""!==B.SysColumnName&&B.CostcenterColID.toString()===this.grData.Table[x].FeatureFieldName.toString()),t.length>0&&(d=t[0].SysColumnName.toString(),"CodePrefix"==d&&""!=this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]?this.objAsset.CodePrefix=this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]:"CodeNumber"==d&&""!=this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]?this.objAsset.CodeNumber=parseInt(this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]):l[0].SysColumnName.ActualValue="LISTBOX"==l[0].SysColumnName.UserColumnType.toUpperCase()&&l[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[D][this.grData.Table[x].FieldName.toString()+"_Key"].toString():"DATE"==l[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]?new Date(this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[D][this.grData.Table[x].FieldName.toString()]));let p=b.d.document.GetDataSet("select DeprStartValue,EstimateLife,IsDeprSchedule,CONVERT(DATETIME,OriginalDeprStartDate) OriginalDeprStartDate,PreviousDepreciation,SalvageValue,Period,Convert(DateTime,DeprStartDate) DeprStartDate,DepreciationMethod,AveragingMethod from ACC_Assets with(nolock) where AssetCode='"+l[0].AssetCode.ActualValue+"'"),F=b.d.document.GetDataSet("SELECT AD.AssetID FROM ACC_Assets A WITH(NOLOCK) JOIN ACC_AssetDepSchedule AD WITH(NOLOCK) ON A.AssetID=AD.AssetID WHERE A.AssetCode='"+l[0].AssetCode.ActualValue+"' AND AD.VoucherNo IS NOT NULL");if(""!=l[0].WarrantyNo.ActualValue&&(l[0].WarrantyNo.ActualValue="Yes"==l[0].WarrantyNo.ActualValue?"1":"2"),""!=l[0].IsDeprSchedule.ActualValue?l[0].IsDeprSchedule.ActualValue="Yes"==l[0].IsDeprSchedule.ActualValue?"1":"0":this.IsUpdate&&""==l[0].IsDeprSchedule.ActualValue&&null!=p&&p.length>0&&(l[0].IsDeprSchedule.ActualValue=p.Rows[0].IsDeprSchedule.toString()),""!=l[0].DepreciationMethod.ActualValue?l[0].DepreciationMethod.ActualValue="Straight Line"==l[0].DepreciationMethod.ActualValue||"Straight Line Method"==l[0].DepreciationMethod.ActualValue?"1":"2":this.IsUpdate&&null!=p&&p.length>0&&""==l[0].DepreciationMethod.ActualValue&&(l[0].DepreciationMethod.ActualValue=p.Rows[0].DepreciationMethod.toString()),""!=l[0].Period.ActualValue?l[0].Period.ActualValue="Yearly"==l[0].Period.ActualValue?"2":"1":this.IsUpdate&&null!=p&&p.length>0&&""==l[0].Period.ActualValue&&(l[0].Period.ActualValue=p.Rows[0].Period.toString()),""!=l[0].AveragingMethod.ActualValue?l[0].AveragingMethod.ActualValue="None"==l[0].AveragingMethod.ActualValue?"1":"2":this.IsUpdate&&null!=p&&p.length>0&&""==l[0].AveragingMethod.ActualValue&&(l[0].AveragingMethod.ActualValue=p.Rows[0].AveragingMethod.toString()),""!=l[0].IncludeSalvageInDepr.ActualValue&&(l[0].IncludeSalvageInDepr.ActualValue="Yes"==l[0].IncludeSalvageInDepr.ActualValue?"1":"2"),""!=l[0].IsMainCovered.ActualValue&&(l[0].IsMainCovered.ActualValue="Yes"==l[0].IsMainCovered.ActualValue?"1":"2"),""!=l[0].IsInsCovered.ActualValue&&(l[0].IsInsCovered.ActualValue="Yes"==l[0].IsInsCovered.ActualValue?"1":"2"),""!=l[0].InsType.ActualValue&&("Quarterly"==l[0].InsType.ActualValue?l[0].InsType.ActualValue="1":"Half-Yearly"==l[0].InsType.ActualValue?l[0].InsType.ActualValue="2":("Anually"==l[0].InsType.ActualValue||"Yearly"==l[0].InsType.ActualValue)&&(l[0].InsType.ActualValue="3")),this.IsUpdate&&null!=p&&p.length>0&&""==l[0].DeprStartDate.ActualValue?i=new Date(p.Rows[0].DeprStartDate).toLocaleDateString("dd MMM yyyy"):this.IsUpdate||""!=l[0].DeprStartDate.ActualValue?""!=l[0].DeprStartDate.ActualValue&&(i=new Date(l[0].DeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")):(l[0].DeprStartDate.ActualValue=" convert(float,convert(datetime,'"+new Date("dd MMM yyyy")+"'))",i=new Date("dd MMM yyyy")),this.IsUpdate||""!=l[0].DeprEndDate.ActualValue)this.IsUpdate||""!=l[0].EstimateLife.ActualValue?this.IsUpdate&&""==l[0].EstimateLife.ActualValue&&null!=p&&p.length>0&&(l[0].EstimateLife.ActualValue=p.Rows[0].EstimateLife.toString()):l[0].EstimateLife.ActualValue=Nt.D.CalculateEstimateLife(new Date(i),""!=l[0].DeprEndDate.ActualValue?new Date(r):new Date(l[0].DeprEndDate.ActualValue));else if(""!=l[0].EstimateLife.ActualValue){let x=l[0].EstimateLife.ActualValue.split(".");f=x[0],parseInt(f)?(l[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(i).AddYears(f).toString()+"'))",r=new Date(i).AddYears(f).toString()):(l[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(i).toString()+"'))",r=new Date(i).toString()),x.length>1&&N.J0.DoubleTryParse(f)&&(l[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(r).AddMonths(f).toString()+"'))",r=new Date(r).AddMonths(f).toString()),x.length>2&&N.J0.DoubleTryParse(f)&&(l[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(r).AddDays(f).toString()+"'))",r=new Date(r).AddDays(f).toString()),l[0].DeprEndDate.ActualValue=" convert(float,convert(datetime,'"+new Date(r).toLocaleDateString("dd MMM yyyy")+"'))"}!this.IsUpdate&&""==l[0].ParentAssetID.ActualValue&&(l[0].ParentAssetID.ActualValue="1",m=b.d.document.GetDataSet("select * from ACC_Assets A with(nolock) where A.AssetID="+l[0].ParentAssetID.ActualValue),m.length>0&&(""!=m.Rows[0].ClassID.toString()&&(l[0].ClassID.UserDefaultValue=m.Rows[0].ClassID.toString()),l[0].PostingGroupID.UserDefaultValue=null!=m.Rows[0].PostingGroupID?m.Rows[0].PostingGroupID.toString():"0",l[0].DeprBookID.UserDefaultValue=m.Rows[0].DeprBookID.toString())),""!=l[0].ClassID.ActualValue?(b.d.document.GetAssetNodeID(2,l[0].ClassID.ActualValue,this.IsCode),y>0&&(l[0].ClassID.ActualValue=y.toString())):this.IsUpdate||(l[0].ClassID.ActualValue=l[0].ClassID.UserDefaultValue),""!=l[0].ClassID.ActualValue?(this.objAsset.AssetClassID=parseInt(l[0].ClassID.ActualValue),o=rt.V.GetAssetClassDetails(this.objAsset.AssetClassID),null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&(l[0].PostingGroupID.UserDefaultValue=null!=o.Tables[0][0].FAAccountsID&&null!=o.Tables[0][0].FAAccountsID?o.Tables[0][0].FAAccountsID.toString():"0",l[0].DeprBookID.UserDefaultValue=null!=o.Tables[0][0].DeprBookID?o.Tables[0][0].DeprBookID.toString():"0",l[0].Period.UserDefaultValue=o.Tables[0][0].DeprPosting.toString(),l[0].EstimateLife.UserDefaultValue=null!=o.Tables[0][0].TotalYears?o.Tables[0][0].TotalYears.toString():"0")):this.IsUpdate||(l[0].ClassID.ActualValue="1"),!this.IsUpdate&&""==l[0].PostingGroupID.ActualValue&&(l[0].PostingGroupID.ActualValue=l[0].PostingGroupID.UserDefaultValue),""!=l[0].PostingGroupID.ActualValue&&(this.objAsset.PostingGroupID=parseInt(l[0].PostingGroupID.ActualValue),o=rt.V.GetPostingGroupDetails(this.objAsset.PostingGroupID),null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&(l[0].AcqnCostACCID.UserDefaultValue=null!=o.Tables[0][0].AcqnCostACCID?o.Tables[0][0].AcqnCostACCID.toString():"0",l[0].DeprExpenseACCID.UserDefaultValue=null!=o.Tables[0][0].DeprExpenseACCID?o.Tables[0][0].DeprExpenseACCID.toString():"0",l[0].AccumDeprACCID.UserDefaultValue=null!=o.Tables[0][0].AccumDeprACCID?o.Tables[0][0].AccumDeprACCID.toString():"0",l[0].AccumDeprDispACCID.UserDefaultValue=null!=o.Tables[0][0].AccumDeprDispACCID?o.Tables[0][0].AccumDeprDispACCID.toString():"0",l[0].AcqnCostDispACCID.UserDefaultValue=null!=o.Tables[0][0].AcqnCostDispACCID?o.Tables[0][0].AcqnCostDispACCID.toString():"0",l[0].GainsDispACCID.UserDefaultValue=null!=o.Tables[0][0].GainsDispACCID?o.Tables[0][0].GainsDispACCID.toString():"0",l[0].LossDispACCID.UserDefaultValue=null!=o.Tables[0][0].LossDispACCID?o.Tables[0][0].LossDispACCID.toString():"0",l[0].MaintExpenseACCID.UserDefaultValue=null!=o.Tables[0][0].MaintExpenseACCID?o.Tables[0][0].MaintExpenseACCID.toString():"0")),""!=l[0].DeprBookID.ActualValue?(b.d.document.GetAssetNodeID(4,l[0].DeprBookID.ActualValue,this.IsCode),y>0&&(l[0].DeprBookID.ActualValue=y.toString())):this.IsUpdate||(l[0].DeprBookID.ActualValue=l[0].DeprBookID.UserDefaultValue),""!=[0].DeprBookGroupID.ActualValue&&y>0&&y.toString(),""!=l[0].DeprBookID.ActualValue&&(this.objAsset.DeprBookID=parseInt(l[0].DeprBookID.ActualValue),o=rt.V.GetDeprBookDetails(this.objAsset.DeprBookID),null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&(l[0].DepreciationMethod.UserDefaultValue=o.Tables[0][0].DeprBookMethod.toString(),l[0].AveragingMethod.UserDefaultValue=o.Tables[0][0].AveragingMethod.toString(),g=parseInt(o.Tables[0][0].SalvageValueType.toString()),o.Tables[0][0].SalvageValue.toString(),l[0].IncludeSalvageInDepr.UserDefaultValue=(0,K.yG0)(o.Tables[0][0].IncludeSalvageInDepr)?"1":"0"));for(let x=0;x<l.lstColumn.length;x++)""==l.lstColumn[x].ActualValue&&""!=l.lstColumn[x].UserDefaultValue&&!this.IsUpdate&&(l.lstColumn[x].ActualValue=l.lstColumn[x].UserDefaultValue),l.lstColumn[x].SysColumnName.toLowerCase().Contains("ccnid")?""==l.lstColumn[x].ActualValue?this.IsUpdate||(T+=l.lstColumn[x].SysColumnName+" ='1', "):T+=l.lstColumn[x].SysColumnName+" ='"+l.lstColumn[x].ActualValue+"', ":l.lstColumn[x].SysColumnName.toLowerCase().Contains("alpha")&&(Number(l.lstColumn[x].ColumnCostCenterID)>0?""!=l.lstColumn[x].ActualValue&&(I+=l.lstColumn[x].SysColumnName+" ='"+l.lstColumn[x].ActualValue+"', "):""!=l.lstColumn[x].ActualValue&&(I+=l.lstColumn[x].SysColumnName+" =N'"+l.lstColumn[x].ActualValue+"', "));if(this.IsUpdate&&null!=p&&p.length>0&&""==l[0].PreviousDepreciation.ActualValue&&(l[0].PreviousDepreciation.ActualValue=p.Rows[0].PreviousDepreciation.toString()),"0"==l[0].DeprStartValue.ActualValue?l[0].DeprStartValue.ActualValue=(parseFloat(l[0].PurchaseValue.ActualValue)-parseFloat(l[0].PreviousDepreciation.ActualValue)).toString():this.IsUpdate&&null!=p&&p.length>0&&""==l[0].DeprStartValue.ActualValue&&(l[0].DeprStartValue.ActualValue=p.Rows[0].DeprStartValue.toString()),""!=l[0].SerialNo.ActualValue&&(s+=" SerialNo=N'"+l[0].SerialNo.ActualValue+"',"),""!=l[0].ClassID.ActualValue&&(s+=" ClassID=N'"+l[0].ClassID.ActualValue+"',"),""!=l[0].PostingGroupID.ActualValue&&(s+=" PostingGroupID=N'"+l[0].PostingGroupID.ActualValue+"',"),""!=[0].DeprBookGroupID.ActualValue&&(s+=" DeprBookGroupID=N'"+[0].DeprBookGroupID.ActualValue+"',"),""!=l[0].TotalQtyPurchase.ActualValue&&(s+=" TotalQtyPurchase=N'"+l[0].TotalQtyPurchase.ActualValue+"',"),""!=l[0].LocationID.ActualValue&&(s+=" LocationID=N'"+l[0].LocationID.ActualValue+"',"),""!=l[0].EmployeeID.ActualValue&&(s+=" EmployeeID=N'"+l[0].EmployeeID.ActualValue+"',"),""!=l[0].Description.ActualValue&&(s+=" Description=N'"+l[0].Description.ActualValue+"',"),""!=l[0].DeprBookID.ActualValue&&(s+=" DeprBookID=N'"+l[0].DeprBookID.ActualValue+"',"),""!=l[0].IsDeprSchedule.ActualValue&&(s+=" IsDeprSchedule=N'"+l[0].IsDeprSchedule.ActualValue+"',"),""!=l[0].DepreciationMethod.ActualValue&&(s+=" DepreciationMethod=N'"+l[0].DepreciationMethod.ActualValue+"',"),""!=l[0].Period.ActualValue&&(s+=" Period=N'"+l[0].Period.ActualValue+"',"),""!=l[0].AveragingMethod.ActualValue&&(s+=" AveragingMethod=N'"+l[0].AveragingMethod.ActualValue+"',"),g>=1&&(s+=" SalvageValueType=N'"+g+"',"),g>=0&&(s+=1==g?" SalvageValueName=N'Value*',":" SalvageValueName=N'Percentage',"),""!=[0].SalvageValue.ActualValue&&(s+=" SalvageValue=N'"+[0].SalvageValue.ActualValue+"',"),""!=l[0].EstimateLife.ActualValue&&(s+=" EstimateLife=N'"+l[0].EstimateLife.ActualValue+"',"),""!=l[0].IncludeSalvageInDepr.ActualValue&&(s+=" IncludeSalvageInDepr=N'"+l[0].IncludeSalvageInDepr.ActualValue+"',"),""!=l[0].DeprStartDate.ActualValue&&(s+=" DeprStartDate= convert(float,convert(datetime,'"+new Date(i).toLocaleDateString("dd MMM yyyy")+"')),"),""!=l[0].OriginalDeprStartDate.ActualValue&&(s+=" OriginalDeprStartDate= convert(float,convert(datetime,'"+new Date(l[0].OriginalDeprStartDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=l[0].DeprEndDate.ActualValue&&(l[0].DeprEndDate.ActualValue.Contains("convert")?s+=" DeprEndDate="+l[0].DeprEndDate.ActualValue+",":s+=" DeprEndDate= convert(float,convert(datetime,'"+new Date(l[0].DeprEndDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=l[0].PurchaseInvoiceNo.ActualValue&&(s+=" PurchaseInvoiceNo=N'"+l[0].PurchaseInvoiceNo.ActualValue+"',"),""!=l[0].PurchaseDate.ActualValue&&(s+=" PurchaseDate= convert(float,convert(datetime,'"+new Date(l[0].PurchaseDate.ActualValue).toLocaleDateString("dd MMM yyyy")+"')),"),""!=l[0].SupplierAccountID.ActualValue&&(s+=" SupplierAccountID=N'"+l[0].SupplierAccountID.ActualValue+"',"),""!=l[0].UOM.ActualValue&&(s+=" UOM=N'"+l[0].UOM.ActualValue+"',"),""!=l[0].PurchaseValue.ActualValue&&(s+=" PurchaseValue=N'"+l[0].PurchaseValue.ActualValue+"',"),""!=l[0].DeprStartValue.ActualValue&&(s+=" DeprStartValue=N'"+l[0].DeprStartValue.ActualValue+"',"),""!=l[0].PreviousDepreciation.ActualValue&&(s+=" PreviousDepreciation=N'"+l[0].PreviousDepreciation.ActualValue+"',"),""!=l[0].WarrantyNo.ActualValue&&(s+=" WarrantyNo=N'"+l[0].WarrantyNo.ActualValue+"',"),""!=l[0].WarrantyExpiryDate.ActualValue&&(s+=" WarrantyExpiryDate=N'"+l[0].WarrantyExpiryDate.ActualValue+"',"),""!=l[0].PONo.ActualValue&&(s+=" PONo=N'"+l[0].PONo.ActualValue+"',"),""!=l[0].PODate.ActualValue&&(s+=" PODate= convert(float,convert(datetime,'"+l[0].PODate.ActualValue+"')),"),""!=l[0].GRNNo.ActualValue&&(s+=" GRNNo=N'"+l[0].GRNNo.ActualValue+"',"),""!=l[0].GRNDate.ActualValue&&(s+=" GRNDate="+l[0].GRNDate.ActualValue+","),""!=l[0].CapitalizationNo.ActualValue&&(s+=" CapitalizationNo=N'"+l[0].CapitalizationNo.ActualValue+"',"),""!=l[0].CapitalizationDate.ActualValue&&(s+=" CapitalizationDate=N'"+l[0].CapitalizationDate.ActualValue+"',"),""!=l[0].IsMainCovered.ActualValue&&(s+=" IsMainCovered=N'"+l[0].IsMainCovered.ActualValue+"',"),""!=l[0].MaintStartDate.ActualValue&&(s+=" MaintStartDate="+l[0].MaintStartDate.ActualValue+","),""!=l[0].MaintExpiryDate.ActualValue&&(s+=" MaintExpiryDate="+l[0].MaintExpiryDate.ActualValue+","),""!=l[0].NextServiceDate.ActualValue&&(s+=" NextServiceDate="+l[0].NextServiceDate.ActualValue+","),""!=l[0].MainVendorAccID.ActualValue&&(s+=" MainVendorAccID=N'"+l[0].MainVendorAccID.ActualValue+"',"),""!=l[0].InsVendorAccID.ActualValue&&(s+=" InsVendorAccID=N'"+l[0].InsVendorAccID.ActualValue+"',"),""!=l[0].IsInsCovered.ActualValue&&(s+=" IsInsCovered=N'"+l[0].IsInsCovered.ActualValue+"',"),""!=l[0].InsEffectiveDate.ActualValue&&(s+=" InsEffectiveDate="+l[0].InsEffectiveDate.ActualValue+","),""!=l[0].InsExpiryDate.ActualValue&&(s+=" InsExpiryDate="+l[0].InsExpiryDate.ActualValue+","),""!=l[0].InsType.ActualValue&&(s+=" InsType=N'"+l[0].InsType.ActualValue+"',"),""!=l[0].InsPolicyNo.ActualValue&&(s+=" InsPolicyNo=N'"+l[0].InsPolicyNo.ActualValue+"',"),""!=l[0].InsPremium.ActualValue&&(s+=" InsPremium=N'"+l[0].InsPremium.ActualValue+"',"),""!=l[0].PolicyCoverage.ActualValue&&(s+=" PolicyCoverage=N'"+l[0].PolicyCoverage.ActualValue+"',"),""!=[0].AcqnCostACCID.ActualValue?s+=" AcqnCostACCID=N'"+[0].AcqnCostACCID.ActualValue+"',":this.IsUpdate||(s+=" AcqnCostACCID=N'0',"),""!=l[0].DeprExpenseACCID.ActualValue?s+=" DeprExpenseACCID=N'"+l[0].DeprExpenseACCID.ActualValue+"',":this.IsUpdate||(s+=" DeprExpenseACCID=N'0',"),""!=l[0].AccumDeprACCID.ActualValue?s+=" AccumDeprACCID=N'"+l[0].AccumDeprACCID.ActualValue+"',":this.IsUpdate||(s+=" AccumDeprACCID=N'0',"),""!=l[0].AccumDeprDispACCID.ActualValue?s+=" AccumDeprDispACCID=N'"+l[0].AccumDeprDispACCID.ActualValue+"',":this.IsUpdate||(s+=" AccumDeprDispACCID=N'0',"),""!=l[0].AcqnCostDispACCID.ActualValue?s+=" AcqnCostDispACCID=N'"+l[0].AcqnCostDispACCID.ActualValue+"',":this.IsUpdate||(s+=" AcqnCostDispACCID=N'0',"),""!=l[0].GainsDispACCID.ActualValue?s+=" GainsDispACCID=N'"+l[0].GainsDispACCID.ActualValue+"',":this.IsUpdate||(s+=" GainsDispACCID=N'0',"),""!=l[0].LossDispACCID.ActualValue?s+=" LossDispACCID=N'"+l[0].LossDispACCID.ActualValue+"',":this.IsUpdate||(s+=" LossDispACCID=N'0',"),""!=l[0].MaintExpenseACCID.ActualValue?s+=" MaintExpenseACCID=N'"+l[0].MaintExpenseACCID.ActualValue+"',":this.IsUpdate||(s+=" MaintExpenseACCID=N'0',"),""!=l[0].LocationID.ActualValue&&"0"!=l[0].LocationID.ActualValue&&(S+='<Row ID="0" CCID="1" NodeID="'+l[0].LocationID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),""!=l[0].EmployeeID.ActualValue&&"0"!=l[0].EmployeeID.ActualValue&&(S+='<Row ID="0" CCID="2" NodeID="'+l[0].EmployeeID.ActualValue+'" FromDate="'+new Date("dd MMM yyyy")+'" Remarks="" />'),this.IsUpdate){let x=this.ReturnAssets();if(null!=x&&x.Tables.length>0)if(this.IsCode){let B=x.Tables[0].filter(q=>q.AssetCode==l[0].AssetCode.ActualValue);B.length>0&&(this.objAsset.AMAssetID=parseInt(B[0].AssetID.toString()),this.objAsset.AMGUID=B[0].GUID.toString())}else{let B=x.Tables[0].filter(q=>q.AssetName==l[0].AssetName.ActualValue);B.length>0&&(this.objAsset.AMAssetID=parseInt(B[0].AssetID.toString()),this.objAsset.AMGUID=B[0].GUID.toString())}null==this.objAsset.AMGUID&&(this.objAsset.AMGUID=N.J0.NewGuid()),(""==l[0].PurchaseValue.ActualValue||""==l[0].ParentAssetID.ActualValue)&&(m=b.d.document.GetDataSet("select isnull(PurchaseValue,0) PurchaseValue,ParentAssetID,isnull(SerialNo,'') SerialNo from ACC_Assets A with(nolock) where A.AssetID="+this.objAsset.AMAssetID))}else this.objAsset.AMAssetID=0,this.objAsset.AMGUID=N.J0.NewGuid();this.objAsset.AMCode=l[0].AssetCode.ActualValue,this.objAsset.AMName=l[0].AssetName.ActualValue,this.objAsset.AMStatusID=1,this.objAsset.Sno=""!=l[0].SerialNo.ActualValue?l[0].SerialNo.ActualValue:""==l[0].SerialNo.ActualValue&&null!=m&&m.length>0?String(m.Rows[0].SerialNo):l[0].SerialNo.ActualValue,""!=l[0].PurchaseValue.ActualValue?this.objAsset.AMPurchaseValue=l[0].PurchaseValue.ActualValue:""==l[0].PurchaseValue.ActualValue&&m.length>0&&(this.objAsset.AMPurchaseValue=String(m.Rows[0].PurchaseValue)),""!=l[0].ParentAssetID.ActualValue?this.objAsset.AMParentAssetID=parseInt(l[0].ParentAssetID.ActualValue):""==l[0].ParentAssetID.ActualValue&&m.length>0&&(this.objAsset.AMParentAssetID=parseInt(m.Rows[0].ParentAssetID)),this.objAsset.AMGroup=!1;for(let x of this.grData.Table)null==x[1]||""==x[1].toString()||"0"==x[1].toString()||(t.filter(B=>B.CostCenterColID==B[1].toString()),t.length>0&&(this.objAsset.AMGroup=!1,0==N.J0.stringCompare(t[0].SysColumnName.toString(),"IsGroup",!0)&&(""==this.ExcelTable[D][x.FieldName.toString().Trim()]||"YES"!=this.ExcelTable[D][x.FieldName.toString().Trim()].toUpperCase()&&"1"!=this.ExcelTable[D][x.FieldName.toString().Trim()]?""!=this.ExcelTable[D][x.FieldName.toString().Trim()]&&("NO"==this.ExcelTable[D][x.FieldName.toString().Trim()].toUpperCase()||"0"==this.ExcelTable[D][x.FieldName.toString().Trim()])&&(this.objAsset.AMGroup=!1):this.objAsset.AMGroup=!0)));this.objAsset.DetailsXML=s.toString().replace("&","&amp;"),this.objAsset.ChangeValueXML="",this.objAsset.CustomFieldsQuery=I,this.objAsset.CustomCostCenterFieldsQuery=T,this.ErrorMessage="";let E=null;l[0].OriginalDeprStartDate.ActualValue.length>0?E=new Date(l[0].OriginalDeprStartDate.ActualValue):this.IsUpdate&&null!=p&&p.length>0&&0==l[0].OriginalDeprStartDate.ActualValue.length&&(E=new Date(p.Rows[0].OriginalDeprStartDate.toString()));let V=l[0].PreviousDepreciation.ActualValue;N.J0.DoubleTryParse(V);let L="";if(L=""==[0].SalvageValue.ActualValue?"0":2==g?(parseFloat([0].SalvageValue.ActualValue)*(parseFloat(l[0].DeprStartValue.ActualValue)+V)/100).toString():parseFloat([0].SalvageValue.ActualValue).toString(),this.IsUpdate&&null!=p&&p.length>0&&""==[0].SalvageValue.ActualValue&&p.Rows[0].SalvageValue.toString(),"1"==l[0].IsDeprSchedule.ActualValue?(this.objAsset.DepreciationXML=this.GetDepreciationXML(parseFloat(l[0].DeprStartValue.ActualValue),l[0].EstimateLife.ActualValue,l[0].IsDeprSchedule.ActualValue,E,V,L,l[0].Period.ActualValue,new Date(i),l[0].DepreciationMethod.ActualValue,l[0].AveragingMethod.ActualValue),this.ErrorMessage=this.objAsset.DepreciationXML):this.objAsset.DepreciationXML="",S.length>0&&(S="<XML>"+S+"</XML>"),this.objAsset.HistoryXML=S,this.objAsset.NotesXML="",a="",u="",this.objAsset.AttachmetsXML="",""!=l[0].AssetImage.ActualValue){let x=l[0].AssetImage.ActualValue;if(x.length>0){let B=x.split(";");try{x=B[0]}catch{a=""}}}if(""!=l[0].Attachments.ActualValue){let x=l[0].Attachments.ActualValue;if(x.length>0){let B=x.split(";");try{for(let q of B);}catch{u=""}}}a.length>0&&(this.objAsset.AttachmetsXML=a),u.length>0&&(this.objAsset.AttachmetsXML+=u);let O=0;if(this.IsUpdate&&null!=F&&0==F.Tables[0].length&&!N.J0.IsEmpty(this.objAsset.DepreciationXML)&&(c=rt.V.DeleteAssetDeprSchedule(this.objAsset.AMAssetID)),O=0,0==this.ErrorMessage.length&&!c.Contains("exists")){let x=this.objAsset.SetAssetManagementDetails();this.ErrorMessage=x}O<=0&&(e++,this.FailedRecourdList.push({Name:"Code :: "+l[0].AssetCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(D+1-e).toString(),this.FailedCount="Failed :"+e.toString(),this.DisplayMessage="Import completed for Row :: "+(D+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ImportAssetMaster(e){let i=0,r=this.costCenterTableZero;if(!this.ScanAssetCostCenterFields(this.IsCode))return;this.FillCostCenterFields(!1);let a=null,u=null,c=b.d.document.GetScreenInfo(e),t=null;c.Tables.length>0&&null!=c.Tables[0]&&(t=c.Tables[0]);let s=new Ft(t),o="",m=0;for(let h=0;h<this.ExcelTable.length;h++,this.ProgressValue++){this.objAsset.AssetClassID=0,this.objAsset.DeprBookID=0,this.objAsset.PostingGroupID=0;for(let l=0;l<s.lstColumn.length;l++)s.lstColumn[l].ActualValue="";for(let l=0;l<this.grData.Table.length;l++)null==this.grData.Table[l].FeatureFieldName||""==this.grData.Table[l].FeatureFieldName.toString()||(r.filter(g=>""!==g.SysColumnName&&g.CostcenterColID.toString()===this.grData.Table[l].FeatureFieldName.toString()),r.length>0&&(o=r[0].SysColumnName.toString(),s[0].SysColumnName.ActualValue="LISTBOX"==s[0].SysColumnName.UserColumnType.toUpperCase()&&s[0].SysColumnName.ColumnCostCenterID>0?this.ExcelTable[h][this.grData.Table[l].FieldName.toString()+"_Key"].toString():"DATE"==s[0].SysColumnName.UserColumnType.toUpperCase()&&""!=this.ExcelTable[h][this.grData.Table[l].FieldName.toString()]?new Date(this.ExcelTable[h][this.grData.Table[l].FieldName.toString()]).toLocaleDateString("dd MMM yyyy"):this.ExcelTable[h][this.grData.Table[l].FieldName.toString()],""!=s[0].SysColumnName.ActualValue&&("DeprPosting"==o?"monthly"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="1":"yearly"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="2":"quarterly"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="3":"halfyearly"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(s[0].SysColumnName.ActualValue="4"):"DeprBookID"==o||"FAAccountsID"==o?(m=0,"DeprBookID"==o?b.d.document.GetAssetNodeID(4,s[0].SysColumnName.ActualValue,this.IsCode):"FAAccountsID"==o&&b.d.document.GetAssetNodeID(3,s[0].SysColumnName.ActualValue,this.IsCode),m>0&&(s[0].SysColumnName.ActualValue=m.toString())):"StatusID"==o?(u=c.Tables[3].Select(c.Tables[3].Columns[1].ColumnName+"='"+s[0].SysColumnName.ActualValue+"' OR "+c.Tables[3].Columns[2].ColumnName+"='"+s[0].SysColumnName.ActualValue+"'"),u.length>0&&(s[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprBookMethod"==o?(u=c.Tables[4].Select(c.Tables[4].Columns[1].ColumnName+"='"+s[0].SysColumnName.ActualValue+"'"),u.length>0&&(s[0].SysColumnName.ActualValue=u[0][0].toString())):"DeprMethodBasedOn"==o?"acquisitionvalue/total"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="1":"percentageonacquisitionvalue"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(s[0].SysColumnName.ActualValue="2"):"AveragingMethod"==o?"calendardays"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="1":"fullmonth"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()?s[0].SysColumnName.ActualValue="2":"midmonth"==s[0].SysColumnName.ActualValue.replace(" ","").toLowerCase()&&(s[0].SysColumnName.ActualValue="3"):"SalvageValueType"==o?"value"==s[0].SysColumnName.ActualValue.toLowerCase()?s[0].SysColumnName.ActualValue="1":"percentage"==s[0].SysColumnName.ActualValue.toLowerCase()&&(s[0].SysColumnName.ActualValue="2"):"IncludeSalvageInDepr"==o&&(s[0].SysColumnName.ActualValue="yes"==s[0].SysColumnName.ActualValue.toLowerCase()||"1"==s[0].SysColumnName.ActualValue?"True":"False"))));if(this.IsUpdate){let l="";if(this.IsCode?74==e?l="select * from ACC_AssetClass with(nolock) where AssetClassCode='"+s[0].AssetClassCode.ActualValue+"'":75==e?l="select * from ACC_DeprBook with(nolock) where DeprBookCode='"+s[0].DeprBookCode.ActualValue+"'":77==e&&(l="select * from ACC_PostingGroup with(nolock) where PostGroupCode='"+s[0].PostGroupCode.ActualValue+"'"):74==e?l="select * from ACC_AssetClass with(nolock) where AssetClassName='"+s[0].AssetClassName.ActualValue+"'":75==e?l="select * from ACC_DeprBook with(nolock) where DeprBookName='"+s[0].DeprBookName.ActualValue+"'":77==e&&(l="select * from ACC_PostingGroup with(nolock) where PostGroupName='"+s[0].PostGroupName.ActualValue+"'"),a=b.d.document.GetDataSet(l),a.length>0){74==e?this.objAsset.AssetClassID=N.J0.Int(a.Rows[0][0].toString()):75==e?this.objAsset.DeprBookID=N.J0.Int(a.Rows[0][0].toString()):77==e&&(this.objAsset.PostingGroupID=N.J0.Int(a.Rows[0][0].toString())),this.objAsset.GUID=a.Rows[0].GUID.toString();for(let g=0;g<s.lstColumn.length;g++)""==s.lstColumn[g].ActualValue&&(s.lstColumn[g].ActualValue=a.Rows[0][s.lstColumn[g].SysColumnName].toString())}null==this.objAsset.GUID&&(this.objAsset.GUID=N.J0.NewGuid())}let n=0;if(74==e){this.objAsset.AssetClassCode=s[0].AssetClassCode.ActualValue.replace("&","&amp;"),this.objAsset.AssetClassName=s[0].AssetClassName.ActualValue.replace("&","&amp;"),this.objAsset.StatusID=N.J0.Int(s[0].StatusID.ActualValue),this.objAsset.PostingGroupID=N.J0.Int(s[0].FAAccountsID.ActualValue),this.objAsset.DeprBookID=N.J0.Int(s[0].DeprBookID.ActualValue),this.objAsset.DeprTypeID=N.J0.Int(s[0].DeprPosting.ActualValue),this.objAsset.TotalYears=N.J0.DoubleTryParse(s[0].TotalYears.ActualValue);let l=this.objAsset.SaveAssetClass();this.ErrorMessage=l}else if(75==e){this.objAsset.DeprBookCode=s[0].DeprBookCode.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookName=s[0].DeprBookName.ActualValue.replace("&","&amp;"),this.objAsset.DeprBookMethod=N.J0.Int(s[0].DeprBookMethod.ActualValue),this.objAsset.StatusID=N.J0.Int(s[0].StatusID.ActualValue),this.objAsset.AveragingMethodID=N.J0.Int(s[0].AveragingMethod.ActualValue),this.objAsset.DeprBookMethodBasedOnValue=N.J0.DoubleTryParse(s[0].BasedOnValue.ActualValue),this.objAsset.DeprBookMethodBasedOn=N.J0.Int(s[0].DeprMethodBasedOn.ActualValue),""==s[0].SalvageValueType.ActualValue&&(s[0].SalvageValueType.ActualValue="1"),""==s[0].IncludeSalvageInDepr.ActualValue&&(s[0].IncludeSalvageInDepr.ActualValue="False");let l=this.objAsset.SaveDeprBook(parseInt(s[0].SalvageValueType.ActualValue),parseFloat([0].SalvageValue.ActualValue),(0,K.yG0)(s[0].IncludeSalvageInDepr.ActualValue));this.ErrorMessage=l}else 77==e&&(this.objAsset.PostGroupCode=s[0].PostGroupCode.ActualValue.replace("&","&amp;"),this.objAsset.PostGroupName=s[0].PostGroupName.ActualValue.replace("&","&amp;"),this.objAsset.AcqnCostACCID=N.J0.Int([0].AcqnCostACCID.ActualValue),this.objAsset.AccumDeprACCID=N.J0.Int(s[0].AccumDeprACCID.ActualValue),this.objAsset.AcqnCostDispACCID=N.J0.Int(s[0].AcqnCostDispACCID.ActualValue),this.objAsset.AccumDeprDispACCID=N.J0.Int(s[0].AccumDeprDispACCID.ActualValue),this.objAsset.GainsDispACCID=N.J0.Int(s[0].GainsDispACCID.ActualValue),this.objAsset.LossDispACCID=N.J0.Int(s[0].LossDispACCID.ActualValue),this.objAsset.MaintExpenseACCID=N.J0.Int(s[0].MaintExpenseACCID.ActualValue),this.objAsset.DeprExpenseACCID=N.J0.Int(s[0].DeprExpenseACCID.ActualValue),this.objAsset.StatusID=N.J0.Int(s[0].StatusID.ActualValue),this.objAsset.SaveFAPostingGroup());n<=0&&(i++,74==e?this.FailedRecourdList.push({Name:"Code :: "+s[0].AssetClassCode.ActualValue,Message:this.ErrorMessage}):75==e?this.FailedRecourdList.push({Name:"Code :: "+s[0].DeprBookCode.ActualValue,Message:this.ErrorMessage}):77==e&&this.FailedRecourdList.push({Name:"Code :: "+s[0].PostGroupCode.ActualValue,Message:this.ErrorMessage})),this.ListVisbility=this.FailedRecourdList.length>0,this.ImportedCount="Imported :"+(h+1-i).toString(),this.FailedCount="Failed :"+i.toString(),this.DisplayMessage="Import completed for Row :: "+(h+1).toString(),this.MessageVisibility=!0}this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}ScanAssetCostCenterFields(e){let i=this.costCenterTableZero;for(let r=0;r<this.ExcelTable.length;r++)for(let a of this.grData.Table)if(null!=a[1]&&""!=a[1].toString()&&"0"!=a[1].toString()&&(i.filter(u=>u.CostCenterColID==a[1].toString()),i.length>0&&(null!=i[0].ColumnCostCenterID&&""!=i[0].ColumnCostCenterID.toString()&&parseInt(i[0].ColumnCostCenterID.toString())>0&&""!=this.ExcelTable[r][a.FieldName.toString()]&&parseInt(a.FeatureFieldName)>0&&this.CheckCostCenterField(r,parseInt(i[0].ColumnCostCenterID.toString()),a.FieldName.toString(),!1,e),("UOM"==i[0].SysColumnName.toString()||"11"==i[0].ColumnCostCenterID.toString())&&(this.UomCol=this.ExcelTable[a.FieldName.toString()].ColumnName+"_Key",this.ExcelTable.Contains(this.UomCol)||(this.ExcelTable.push(this.UomCol),this.temp.push(parseInt(i[0].ColumnCostCenterID.toString()))),""!=this.ExcelTable[r][a.FieldName.toString().Trim()])))){let u=2;this.CostCenterFieldsAllTables.Tables[u].filter(t=>t.UnitName==this.ExcelTable[r][a.FieldName.toString().Trim()]).length>0&&(this.ExcelTable[r][this.UomCol]=this.CostCenterFieldsAllTables.Tables[u][0].UOMID.toString())}return!0}GetDepreciationXML(e,i,r,a,u,c,t,s,o,m){this.ErrorMessage="";let n=0,l=0,g=0;try{let d=i.split(".");n=N.J0.Int(d[0]),d.length>1&&(l=N.J0.Int(d[1])),d.length>2&&(g=N.J0.Int(d[2]))}catch{}if("0"!=r&&n<=0&&l<=0&&g<=0)return e>0&&(this.ErrorMessage="Enter EstimatedLife in Depreciation Tab"),"";if(g>0&&"3"==m)return this.ErrorMessage="Mid-Month method can not be applied if estimated life provided with days.","";let T,S=s;T=S.AddYears(n),T=T.AddMonths(l),T=T.AddDays(g),T=T.AddDays(-1);let I=new Nt.D(0);return I.CallFromAssetSave=!0,I.GetScheduleData(e,n,l,g,a,u,parseFloat(c),o,t,0,m,S,T,null,this.objAsset.DeprBookID.toString()),this.ErrorMessage=I.ErrorMessage,I.GetXML()}ImportUsers(){let e=[];e.push(1,"Cash"),e.push(2,"Bank"),e.push(3,"BankCC"),e.push(4,"Sales"),e.push(5,"Purchase"),e.push(6,"Creditors"),e.push(7,"Debtors"),e.push(8,"Trading Income"),e.push(9,"Trading Expense"),e.push(10,"Petty Cash"),e.push(11,"Income"),e.push(12,"Expense"),e.push(13,"Assets"),e.push(14,"Liabilities"),e.push(15,"Contra Asset"),e.push(16,"Equity");let i=[];i.push(1,"General"),i.push(2,"Serialised Items"),i.push(3,"Kit"),i.push(4,"Matrix"),i.push(5,"Batch"),i.push(6,"Service Item"),i.push(7,"Serialised & Kit"),i.push(8,"Dynamic"),i.push(9,"Assembled"),i.push(10,"Asset"),i.push(11,"Modifiers"),i.push(12,"Modifiers with Inventory");let r=[],a="";if(0==this.grData.Table.filter(x=>"22898"==x.FeatureFieldName).length)return this.DisplayMessage="UserName Not Exists",void(this.MessageVisibility=!0);let u=this.costCenterTableZero,c=null,t="",s=0,o="",m="",h="",n="",l="",g="",T="",S="",I="",d="1",y="True",f="",D=0,p=0,F=0,E=0,V=1,L=0;this.FillCostCenterFields(!1);for(let x=0;x<this.ExcelTable.length;x++,this.ProgressValue++){o="",m="",h="",l="",g="",T="",S="",I="",d="1",y="True",D=0,p=0,F=0,E=0,V=1,L=0,f="",t="",a="";for(let $=0;$<this.grData.Table.length;$++)if(null!=this.grData.Table[$].FeatureFieldName&&""!=this.grData.Table[$].FeatureFieldName.toString()&&(u.filter(Z=>Z.CostCenterColID===this.grData.Table[$].FeatureFieldName.toString()),u.length>0)){switch(n=u[0].SysColumnName.toString(),n){case"UserName":this.CheckCostCenterField(x,7,this.grData.Table[$].FieldName.toString(),!1,this.IsCode),o=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&""!=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()&&(D=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()),c=b.d.document.GetUsersDet(D.toString()));break;case"Password":m=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()];break;case"Email1Password":case"Email2Password":N.J0.IsEmptySpace(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])?h+=n+" =N'',":h+=n+" =N'@ENC@"+N.J0.EncryptString(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])+"',";break;case"DivisionID":this.CheckCostCenterField(x,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(E=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"LocationID":this.CheckCostCenterField(x,parseInt(u[0].ColumnCostCenterID.toString()),this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(F=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"RoleID":this.CheckCostCenterField(x,6,this.grData.Table[$].FieldName.toString(),!1,this.IsCode),this.ExcelTable.Contains(this.grData.Table[$].FieldName.toString()+"_Key")&&(p=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()));break;case"StatusID":V="in active"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()].toLowerCase()?2:1;break;case"AccountTypes":if(T=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],T.length>0){let k=T.split(";");T="";for(let ie=0;ie<k.length;ie++)for(let ne of e)k[ie].toString()==ne.Value&&(T+='<Row  CostCenterId="2" FeatureTypeID="'+ne.Key+'"/>')}break;case"ProductTypes":if(S=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()],S.length>0){let k=S.split(";");S="";for(let ie=0;ie<k.length;ie++)for(var O of i)k[ie].toString()==O.Value&&(S+='<Row  CostCenterId="3" FeatureTypeID="'+O.Key+'"/>')}break;case"LicenseCount":L=parseInt(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()]);break;case"Online/Offline":y="OFFLINE"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString()].toUpperCase()?"False":"True";break;case"2StepVerificationMode":I=this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()];break;case"Language":d="ENGLISH"==this.ExcelTable[x][this.grData.Table[$].FieldName.toString()].toUpperCase()?"1":"2";break;case"UserImage":let Z=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()];if(Z.length>0){let k=Z.split(";");try{Z=k[0]}catch{g=""}}break;default:n.startsWith("Assigned_")||(null!=u[0].ColumnCostCenterID&&""!=u[0].ColumnCostCenterID.toString()&&parseInt(u[0].ColumnCostCenterID.toString())>0?h+=n+" ='"+this.ExcelTable[x][this.grData.Table[$].FieldName.toString()+"_Key"].toString()+"',":h+=n+" =N'"+U.Dw.GetValidXml(this.ExcelTable[x][this.grData.Table[$].FieldName.toString().Trim()])+"',")}if(n.startsWith("Assigned_")){let Z=null,k=this.ExcelTable[x][this.grData.Table[$].FieldName.toString()],ie=[];if(ie.Clear(),!N.J0.IsEmpty(k)){Z=k.split(",");let ne=parseInt(u[0].ColumnCostCenterID.toString());this.grData.Table[$].FieldName.toString();for(let ye=0;ye<Z.length;ye++)ie.push(ne,b.d.document.GetCostCenterDetailsBYCostCenterID(ne,"").Tables[0]),ie[ne].RowFilter=this.IsCode?"Code='"+Z[ye].toString().Trim().replace("'","''")+"'":"Name='"+Z[ye].toString().Trim().replace("'","''")+"'",ie[ne].length>0&&(f+='<Row  CostCenterId="'+ne+'" NodeID="'+ie[ne][0].NodeID+'"/>'),ie.Clear()}}}l=null!=c&&c.Tables[0].length>0?c.Tables[0][0].GUID.toString():N.J0.NewGuid(),(T.length>0||S.length>0)&&(t+="<XML>",T.length>0&&(t+=T),S.length>0&&(t+=S),t+="</XML>"),f.length>0&&(a+="<XML>",a+=f,a+="</XML>");let B=0;r.push(D),r.push(p),r.push(o),r.push(N.J0.EncryptString(m)),r.push(V),r.push(d),r.push(y),r.push(I),r.push(""),r.push("False"),r.push(h),r.push(b.d.SessionManager.CompanyIndex),r.push(a.toString()),r.push(t.toString()),r.push(""),r.push(L),r.push(""),r.push(g),r.push(""),r.push(""),r.push(F),r.push(E),r.push(N.J0.NewGuid()),r.push(l),r.push(b.d.SessionManager.UserName),r.push(b.d.SessionManager.UserID),r.push(b.d.SessionManager.RoleID),r.push(b.d.SessionManager.LanguageID);let q=b.d.document.CreateUser(r);q&&(B=q.UID),r.Clear(),B<=0&&(s++,this.FailedRecourdList.push({Name:"Name : "+o,Message:this.ErrorMessage})),this.ImportedCount="Imported :"+(x+1-s).toString(),this.FailedCount="Failed :"+s.toString()}this.ListVisbility=this.FailedRecourdList.length>0,this.DisplayMessage="Import completed ( Total :"+this.ExcelTable.length.toString()+" "+this.ImportedCount+" "+this.FailedCount+" )",this.MessageVisibility=!0}GetCodeData(e,i){try{let u,c,r=this.grData.Table,a="",t=!1;for(let h of this.xDocCodeDef.DocumentElement)if(u=parseInt(h.attributes.CCCID.Value),-5==u)t=!0;else if(u>0){if(r.filter(n=>n.FeatureFieldName==h.attributes.CCCID.Value),r.length>0){let n=U.Dw.GetValidXml(e[r[0].FieldName.toString().Trim()]);if(n.length>0)if(c=h.attributes.Type.Value.toUpperCase(),"DATE"==c){let l=n;N.J0.isValidDate(l)&&(a+='<Row ColID="'+u+'" Value="'+l.toLocaleDateString("dd MMM yyyy")+'" />')}else e.includes(r[0].FieldName+"_Key")&&""!=e[r[0].FieldName+"_Key"].toString()?a+='<Row ColID="'+u+'" Value="'+e[r[0].FieldName+"_Key"].toString()+'" />':a+='<Row ColID="'+u+'" Value="'+n+'" />'}}else u<0&&(r.filter(n=>n.FeatureFieldName==h.attributes.CCCID.Value),r.length>0&&e.includes(r[0].FieldName+"_Key")&&""!=e[r[0].FieldName+"_Key"].toString()&&(a+='<Row ColID="'+u+'" Value="'+e[r[0].FieldName+"_Key"].toString()+'" />'));a.length>0&&(a.Insert(0,"<Data>"),a+="</Data>");let s=1;16!=parseInt(this.Feature.SelectedValue)||1==i?i=0:s=i,t&&0==i&&(this.costCenterTableZero.filter(h=>"ParentGroupName"==h.SysColumnName),this.costCenterTableZero.length>0&&(r.filter(h=>h.FeatureFieldName==this.costCenterTableZero[0].CostCenterColID.toString()),r.length>0&&(s=this.GetParentID(parseInt(this.Feature.SelectedValue),U.Dw.GetValidXml(e[r[0].FieldName.toString().Trim()])))));let o=!1,m=this.grData.Table.filter(h=>"IsGroup"==h.FieldName);return m.length>0&&("true"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"yes"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"y"==e[m[0].FieldName.toString().Trim()].toLowerCase()||"1"==e[m[0].FieldName.toString().Trim()]||"on"==e[m[0].FieldName.toString().Trim()].toLowerCase())&&(o=!0),b.d.common.GetCodeData(parseInt(this.Feature.SelectedValue),s,a.toString(),!1,o)}catch(r){return Logger.ErrorLog("Import :: GetCodeData ",r),null}}GetParentID(e,i){try{let r,a;2==e?(r="AccountName",a="AccountID"):3==e?(r="ProductName",a="ProductID"):(r="Name",a="ID");let t=b.d.document.GetDataSet("declare @SQL nvarchar(500)\nselect @SQL=TableName from adm_features with(nolock) where featureid=\" + CostCenterID + @\"\nset @SQL='select \" + PK + \" ID from '+@SQL+' with(nolock) where \" + colName + \"=''\" + GroupName + @\"'''\nexec(@SQL) ");return N.J0.Int(t.Tables[0].ID.toString())}catch{return 1}}OnMessageCallBack(){this.res="Yes"}ConvertHoursToMinutes(e){let i=0,r=0,a=0;const u=e.split(":");return a=N.J0.Int(u[0]),u.length>1&&(r=N.J0.Int(u[1]),1==r.toString().length&&(r=parseInt(r.toString()+"0",10))),i=60*a+r,i}GetDailyAttendanceDetails(e,i,r,a,u,c,t,s,o){try{this.ConstructFormulaFields();let m=[],h=null,n=null,l="",g="",T="";if(0==e){m.push(u.toLocaleDateString("dd/MMM/yyyy")),m.push(0),m.push(r),m.push(i),m.push(b.d.SessionManager.UserID),m.push(b.d.SessionManager.LanguageID);let S=b.d.common.GetDataSet_SP(m,"spPAY_ExtGetTimings");S.Tables.length>0&&(this.intValidDay=parseInt(S.Tables[0][0].VALIDDAY),this.FromDateTime=new Date(S.Tables[0][0].STARTTIME),this.ToDatetime=new Date(S.Tables[0][0].ENDTIME)),g+="dcAlpha5=N'"+S.Tables[0][0].VALIDDAY.toString()+"', ",g+="dcAlpha4=N'0', ",g+="dcAlpha10=N'1', ",g+="dcAlpha11=N'1', ",g+="dcAlpha12=N'0', ",g+="dcAlpha13=N'1', ",n=this.grData.Table,n.filter(I=>36591==I.FeatureFieldName),0==n.length&&(g+="dcAlpha2=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay.toString()+"', ",this.setFieldDetails(this.fldDict,"dcAlpha2",this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.FromDateTime.TimeOfDay)),n.RowFilter="FeatureFieldName=36592",0==n.length&&(g+="dcAlpha3=N'"+this.FromDateTime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay.toString()+"', ",this.setFieldDetails(this.fldDict,"dcAlpha3",this.ToDatetime.Date.toLocaleDateString("dd/MMM/yyyy")+" "+this.ToDatetime.TimeOfDay)),T=g}else if(1==e){if(m.push(i),m.push(0),m.push(t),m.push(u.toLocaleDateString("dd/MMM/yyyy")),m.push(r>0?r:1),m.push(a>0?a:1),m.push(0),m.push(1),m.push(c),m.push(b.d.SessionManager.UserID),m.push(b.d.SessionManager.LanguageID),h=b.d.common.GetDataSet_SP(m,"spPAY_ExtCalcHours"),h.Tables.length>0){this.dblTotalHours=0;let y,f,D,p,S=null,I="",d="",F=1;if(y=f=p=D=0,S=this.costCenterTableZero,S.length>0){S.RowFilter="CostCenterColID=36561",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(h.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(h.Tables[0][0].NRMLHRSOP.toString().Trim())+", ",D=parseFloat(h.Tables[0][0].NRMLHRSOP.toString().Trim())),S.RowFilter="CostCenterColID=36562",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(h.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(h.Tables[0][0].NORMALRATEOP.toString().Trim())+", ",p=parseFloat(h.Tables[0][0].NORMALRATEOP.toString().Trim())),parseFloat(D)>0&&(f=this.ConvertHoursToMinutes(D.toString())*(p/60),y=f),S.RowFilter="CostCenterColID=36563",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(h.Tables[0][0].BREAKHRSOP.toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(h.Tables[0][0].BREAKHRSOP.toString().Trim())+", ");for(let E=5;E<=14;E++)p=D=f=0,d="OT"+F.toString(),I="dcNum"+E.toString(),S.RowFilter="sysColumnName='"+I+"'",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())+", ",D=parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())),d="OT"+F.toString()+"Rate",I="dcNum"+(E+1).toString(),S.RowFilter="sysColumnName='"+I+"'",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())+", ",p=parseFloat(h.Tables[0][0][d+"OP"].toString().Trim())),parseFloat(D)>0&&(f=this.ConvertHoursToMinutes(D.toString())*(p/60),y+=f),E++,F++;S.RowFilter="CostCenterColID=36574",S.length>0&&(l+=S[0].SysColumnName.toString()+"="+parseFloat(y.toString().Trim())+", ",l+="dcCalc"+S[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(y.toString().Trim())+", ")}T=l}}else if(2==e){if("0"!=s.toString()&&"0"!=o.toString()&&(n=this.grData.Table,n.filter(S=>36560==S.FeatureFieldName),0==n.length&&(n=this.costCenterTableZero,n.RowFilter="CostCenterColID=36560",n.length>0))){let S="",I=new Date(o),d=new Date(s),y=N.J0.ParseDate(I).Subtract(N.J0.ParseDate(d));S=y.Hours+"."+y.Minutes,this.dblTotalHours=parseFloat(S),l+=n[0].SysColumnName.toString()+"="+parseFloat(S)+", ",l+="dcCalc"+n[0].SysColumnName.toString().replace("dc","")+"="+parseFloat(S)+", "}T=l}return T.toString()}catch(m){return Logger.ErrorLog("Import :: GetDailyAttendanceDetails ",m.message),null}}UpdateExcelSheet(){if(this.UpdateStatusInExcel&&this.IsExcel&&this.ExcelTable&&0!==this.ExcelTable.length)try{const e=this.workbookK,i=e.SheetNames[0];let a=this.ExcelData,u=0,c=0,t=0;for(let o=0;o<150;o++){const m=a[0]?.[o];if("IMPORT_STATUS"===m){if(u=o,c>0)break}else if("IMPORT_MESSAGE"===m){if(c=o,u>0)break}else(!m||""===m)&&0===t&&(t=o-1)}0===u&&(t++,a[0][t]="IMPORT_STATUS",u=t),0===c&&(t++,a[0][t]="IMPORT_MESSAGE",c=t);for(let o=0;o<this.ExcelTable.length;o++){if(this.ExcelTable[o].IsNewRow&&"1"===this.ExcelTable[o].IsNewRow.toString())continue;const m=o+1;a[m]||(a[m]=[]),(!a[m][u]||"PASS"!==a[m][u])&&(a[m][u]=this.ExcelTable[o].xIMP_STATUSx||"",a[m][c]=this.ExcelTable[o].IMPORT_MESSAGE||"")}const s=ze.Wp.aoa_to_sheet(a);e.Sheets[i]=s,ze._h(e,this.ActualFileName)}catch(e){console.error("Error in UpdateExcelSheet:",e.message||e)}}s2ab(e){const i=new ArrayBuffer(e.length),r=new Uint8Array(i);for(let a=0;a<e.length;a++)r[a]=255&e.charCodeAt(a);return i}formatDDMMMYYYY(e){const r=e instanceof Date?e:new Date(e);return isNaN(r.getTime())?"":`${("0"+r.getDate()).slice(-2)}/${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r.getMonth()]}/${r.getFullYear()}`}formatMonthName(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][Math.max(1,Math.min(12,e))-1]}daysInMonth(e,i){return new Date(e,i,0).getDate()}FillBomDetails(){const e=this.Feature?.SelectedValue;[{CostCenterColID:"-1",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"RawMaterial",ResourceKey:b.d.GetResource("RawMaterial")},{CostCenterColID:"-12",ColumnCostCenterID:"3",ColumnDataType:"LISTBOX",SysColumnName:"OutPutProduct",ResourceKey:b.d.GetResource("OutPutProduct")},{CostCenterColID:"-2",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Qty",ResourceKey:b.d.GetResource("Quantity")},{CostCenterColID:"-3",ColumnCostCenterID:"11",ColumnDataType:"LISTBOX",SysColumnName:"UOMID",ResourceKey:b.d.GetResource("UOM")},{CostCenterColID:"-4",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"UnitPrice",ResourceKey:b.d.GetResource("UnitPrice  ")},{CostCenterColID:"-5",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Value",ResourceKey:b.d.GetResource("Value")},{CostCenterColID:"-6",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"Wastage",ResourceKey:b.d.GetResource("Waistage")},{CostCenterColID:"-7",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"CreditAccount",ResourceKey:"Credit Account"},{CostCenterColID:"-15",ColumnCostCenterID:"2",ColumnDataType:"LISTBOX",SysColumnName:"DebitAccount",ResourceKey:"Debit Account"},{CostCenterColID:"-8",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"ExpenseCharges",ResourceKey:b.d.GetResource("ExpenseCharges")},{CostCenterColID:"-9",ColumnCostCenterID:"71",ColumnDataType:"LISTBOX",SysColumnName:"Machine",ResourceKey:b.d.GetResource("Machine")},{CostCenterColID:"-10",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"HRS",ResourceKey:b.d.GetResource("HRS")},{CostCenterColID:"-11",ColumnCostCenterID:"0",ColumnDataType:"FLOAT",SysColumnName:"MachineCharges",ResourceKey:b.d.GetResource("MachineCharges")}].forEach(r=>{const a={CostCenterColID:r.CostCenterColID,CostcenterID:e,ColumnCostCenterID:r.ColumnCostCenterID,ColumnDataType:r.ColumnDataType,SysColumnName:r.SysColumnName,ResourceData:r.ResourceKey,IsColumninuse:"true",IsColumnUserDefined:"false"};this.CostCenterFieldsAllTables.push(a),this.costCenterTableZero.push(a)})}}class Ft{constructor(e){this.lstColumn=[];for(let i=0;i<e.length;i++){const r=e[i];this.lstColumn.push({CostCenterColID:Number(r.CostCenterColID),ResourceData:(r.ResourceData||"").toString().replace(/ /g,""),SysColumnName:(r.SysColumnName||"").toString(),UserColumnName:(r.UserColumnName||"").toString().replace(/ /g,""),ColumnDataType:(r.ColumnDataType||"").toString(),UserColumnType:(r.UserColumnType||"").toString(),UserDefaultValue:(r.UserDefaultValue||"").toString(),ActualValue:"",ColumnCostCenterID:Number(r.ColumnCostCenterID)})}}getByCostCenterColID(e){for(const i of this.lstColumn)if(i.CostCenterColID===e)return i;return null}getByCostCenterColIDAndName(e,i){for(const r of this.lstColumn)if(i&&""!==i||e>0)if(i&&""!==i&&e>0){if(r.SysColumnName===i&&r.CostCenterColID===e)return r}else if(i&&""!==i){if(r.SysColumnName===i)return r}else if(r.CostCenterColID===e)return r;return null}}class vt{ColumnsXML(e,i){let r="";return r+=8===e&&"Dimension Move"===i?"<XML>\n  <Col ID='DimensionID' Width='100' Combo='TEXT'><Caption>DimensionID**</Caption></Col>\n  <Col ID='DimensionName' Width='160' Combo='TEXT'><Caption>DimensionName**</Caption></Col>\n  <Col ID='Node' Width='160' Combo='TEXT'><Caption>Node*</Caption></Col>\n  <Col ID='Group' Width='160' Combo='TEXT'><Caption>Group*</Caption></Col>\n  <Row DimensionID='2' DimensionName='Account' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='3' DimensionName='Product' Node='NNNXXX' Group='GGGXXX' />\n  <Row DimensionID='50002' DimensionName='Location' Node='NNNXXX' Group='GGGXXX' />\n  </XML>":400===e&&"Document Edit"===i?"<XML>\n  <Col ID='VoucherNo' Width='100' Combo='TEXT'><Caption>Doc No*</Caption></Col>\n  <Col ID='OldValue1' Width='160' Combo='TEXT'><Caption>Old Value1*</Caption></Col>\n  <Col ID='NewValue1' Width='160' Combo='TEXT'><Caption>New Value1*</Caption></Col>\n  <Col ID='OldValue2' Width='160' Combo='TEXT'><Caption>Old Value2*</Caption></Col>\n  <Col ID='NewValue2' Width='160' Combo='TEXT'><Caption>New Value2*</Caption></Col>\n  <Col ID='OldValueN' Width='160' Combo='TEXT'><Caption>Old ValueN*</Caption></Col>\n  <Col ID='NewValueN' Width='160' Combo='TEXT'><Caption>New ValueN*</Caption></Col>\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='' NewValue2='' OldValueN='OldXXXN' NewValueN='NewXXXN' />\n  <Row VoucherNo='XXX-XXX/XX/X' OldValue1='OldXXX1' NewValue1='NewXXX1' OldValue2='OldXXX2' NewValue2='NewXXX2' OldValueN='' NewValueN='' />\n  </XML>":"<XML></XML>",r}BuildGrid(e,i){let r=new dt.vv;r.Columns=[],r.Table=[],r.SearchVisible=!1;let a=new ht.O7,u=new N.VB;u.LoadXml(this.ColumnsXML(e,i));for(let c of u.DocumentElement.children)if("Col"==c.Name)a=new ht.O7,a.Header=c.SelectSingleNode("Caption").InnerText,a.DisplayMember=c.attributes.ID.Value,a.ReadOnly=!0,a.Width=null!=c.attributes.Width?parseInt(c.attributes.Width.Value):160,r.Columns.push(a),r.TableColumns.push(c.attributes.ID.Value);else if("Row"==c.Name){r.NewRow();const s=c,o={};for(const m of r.TableColumns)o[m]=s.getAttribute(m);r.TableColumns.push(o)}return r.Visible=null!=r.Columns&&r.Columns.length>0,r}}},93621:(Mt,it,le)=>{le.d(it,{t:()=>b});var Fe=le(86739);class b{constructor(){this.CCID=0,this.Status=0,this.BudgetTypeID=0,this.BugetID=0,this.NumDimensions=0,this.QtyType=0,this.IsQtyBudget=0,this.isGroup=!1,this.ChkBudgetOnlyForDefnAccounts=!1,this.Budgetid=0,this.SelectedNodeID=0,this.SbXML=null,this.RelationsXML=null,this.BudgetName=null,this.BudgetType=null,this.CCList="",this.strNonAccountingDocs=null,this.NonAccDocsField=null,this.strInvAccountingDocs=null,this.InvAccDocsField=null,this.AccountTypes=null}GetBudgetScreenDetails(K,pt,te=""){let U=[];return U.push(K),U.push(pt),U.push(te),U.push(Fe.d.SessionManager.UserID),U.push(Fe.d.SessionManager.LanguageID),Fe.d.common.GetBudgetScreenDetails(U)}SaveBudgetScreenDetails(){let K=[];return K.push(this.SbXML),K.push(this.NumDimensions),K.push(this.CCList),K.push(this.RelationsXML),K.push(this.StartYear),K.push(this.BudgetName),K.push(this.BudgetTypeID),K.push(this.BudgetType),K.push(this.Status),K.push(this.IsQtyBudget),K.push(this.Budgetid),K.push(this.SelectedNodeID),K.push(this.isGroup),K.push(this.QtyType),K.push(this.ChkBudgetOnlyForDefnAccounts),K.push(this.strNonAccountingDocs),K.push(this.NonAccDocsField),K.push(this.strInvAccountingDocs),K.push(this.InvAccDocsField),K.push(this.AccountTypes),K.push(Fe.d.SessionManager.CompanyGUID),K.push(Fe.d.SessionManager.UserName),K.push(Fe.d.SessionManager.UserID),K.push(Fe.d.SessionManager.LanguageID),Fe.d.common.SaveBudgetScreenDetails(K)}SetImportBudget(){let K=[];return K.push(this.SbXML),K.push(this.NumDimensions),K.push(this.CCList),K.push(this.RelationsXML),K.push(this.StartYear),K.push(this.BudgetName),K.push(this.BudgetTypeID),K.push(this.BudgetType),K.push(this.Status),K.push(this.IsQtyBudget),K.push(this.Budgetid),K.push(this.SelectedNodeID),K.push(this.isGroup),K.push(this.QtyType),K.push(this.ChkBudgetOnlyForDefnAccounts),K.push(this.strNonAccountingDocs),K.push(this.NonAccDocsField),K.push(this.strInvAccountingDocs),K.push(this.InvAccDocsField),K.push(this.AccountTypes),K.push(this.IsAppend),K.push(Fe.d.SessionManager.CompanyGUID),K.push(Fe.d.SessionManager.UserName),K.push(Fe.d.SessionManager.UserID),K.push(Fe.d.SessionManager.LanguageID),Fe.d.common.SaveBudgetScreenDetails(K)}}},39559:(Mt,it,le)=>{le.d(it,{h:()=>Fe});class Fe{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}}}]);