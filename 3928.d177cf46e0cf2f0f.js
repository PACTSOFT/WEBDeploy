"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3928],{93928:(W,I,g)=>{g.r(I),g.d(I,{POSExitViewModel:()=>U});var y=g(10467),w=g(23823),N=g(81669),j=g(72099),T=g(98669),E=g(24028),M=g(49710),O=g(32026),o=g(86739),V=g(18569),x=g(38859),P=g(32647),D=g(8787),R=g(71548),A=g(78906),L=g(35725),G=g(31562),b=g(75706),p=g(2360),v=g(17560),H=g(95050);class U extends w.g{get Parent(){return this._parent}get DTPayModes(){return this.DTPayModesObj.Table}get DtReport(){return this.DtReportObj.Table}constructor(){super(),this.ButtonClick=new N.Yk,this.DayClose=new j.c(0),this.HoldVisibility=!1,this.DraftVisibility=!1,this.ExitVisible=!1,this.ShowDetailSection=!0,this.SkipDefaultCloseReport=!1,this.OptionsVisible=!1,this.GridVisible=!1,this.PrintVisibility=!1,this.Shift=new T.y$,this.PrintDate=new E.P6(0),this.OKVisible=!0,this.CancelVisible=!0,this.BackVisible=!1,this.ShowDenomHelp=!1,this.NumericPADView=null,this.TouchVisibility=!1,this.LoginVisi=!1,this.ReportVisibility=!1,this.DtExit=[],this.IsPayMode=!1,this.IsShiftClose=!1,this.IsDiff=!1,this.ManagerLoggedin=!1,this.oReport=null,this.Denom=null,this.DenomXML="",this.RegName="",this.CloseType=0,this.DtDiffPosting=new D.VB,this.ClassName="POSExitViewModel"}POSExitViewModel_1(t,e,S,l){this.DayClose.Visible=!1,this._parent=t,this.OptionsVisible=e,this.HoldVisibility=S,this.DraftVisibility=l,this.DayClose.Label="Day Close",!e&&!S&&!l&&(this.ExitVisible=!0),this.OptionsVisible?(this.Title="Options",this.Options_CashIN=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash In"),this.Options_CashOut=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Out"),this.Options_CashRegister=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Register"),o.d.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=o.d.SessionManager.Preferences.PosShifts.toString()&&parseInt(o.d.SessionManager.Preferences.PosShifts.toString())>5e4&&(this.Options_ShiftClose=!0),this.Options_ShiftClose&&(this.Shift.CCID=parseInt(o.d.SessionManager.Preferences.PosShifts.toString()),this.Shift.TypeID=1),this.Options_DayClose=!0):this.Title=this.HoldVisibility?o.d.GetResource("Com_SaveAsHold"):l?o.d.GetResource("Remarks"):"Exit",this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExitVisible&&this.InitGrid()}InitGrid(){this.Exit_UserExit=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Exit"),this.Exit_UserClose=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Close"),this.Exit_ShiftClose=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Shift Close"),this.Exit_DayClose=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Day Close"),this.ShowDetailSection=o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"ShowDetailsGridWhileDayClose"),o.d.SessionManager.Preferences.ContainsKey("SkipDefaultCloseReport")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.SkipDefaultCloseReport.toString())&&(this.SkipDefaultCloseReport=(0,P.yG0)(o.d.SessionManager.Preferences.SkipDefaultCloseReport)),this.SkipDefaultCloseReport&&(this.ShowDetailSection=!1),this.DTPayModesObj=new M.vv,this.DTPayModesObj.Columns=[],this.DTPayModesObj.Table=[],this.DTPayModesObj.TableColumns.push("Name"),this.DTPayModesObj.TableColumns.push("NameWithKey"),this.DTPayModesObj.TableColumns.push("Amount"),this.DTPayModesObj.DataTypes.Double.push("Amount"),this.DTPayModesObj.TableColumns.push("Type"),this.DTPayModesObj.TableColumns.push("SysColumnName"),this.DTPayModesObj.TableColumns.push("DenomXML"),this.DtReportObj=new M.vv,this.DtReportObj.Columns=[],this.DtReportObj.Table=[],this.DtReportObj.TableColumns.push("NameWithKey"),this.DtReportObj.TableColumns.push("Amount"),this.DtReportObj.TableColumns.push("AmountActual"),this.DtReportObj.DataTypes.Double.push("AmountActual"),this.DtReportObj.TableColumns.push("SysColumnName"),this.DtReportObj.TableColumns.push("Type"),this.DtReportObj.TableColumns.push("StyleIsBold"),this.DtReportObj.TableColumns.push("Row_Background"),this.Parent.ScreenObject.Preferences.ContainsKey("PosPostings")&&"true"==this.Parent.ScreenObject.Preferences.PosPostings.toLowerCase()&&this.DtReportObj.TableColumns.push("PostJV"),this.ExitGrid=new M.vv,this.ExitGrid.Columns=[],this.ExitGrid.Table=[],this.ExitGrid.Width="",this.ExitGrid.Height=250,this.ExitGrid.RowHeight=this.Parent.GridRowHeight,this.ExitGrid.BeginEdit.Subscribe(this,"OnExitGridBeginEdit");let t=[],e=new V.O7;e.Header="Name",e.DisplayMember="NameWithKey",e.DisableTab=!0,e.Width=220,e.ReadOnly=!0,e.DisableTab=!0,t.push(e),e=new V.O7,e.Header="Value",e.DisplayMember="Amount",e.DataType="FLOAT",e.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinAmount,e.Width=180,t.push(e),this.ExitGrid.Columns=t}IsHoldDocsExits(){let t=o.d.document.GetDocumentDrafts(this.Parent.ScreenObject.RegisterNodeID,this.Parent.CostCenterID,2,!1,!0,this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID);return!D.J0.IsEmpty(t)&&t.Tables.length>0&&t.Tables[0].length>0}OnButtonClick(t){var e=this;return(0,y.A)(function*(){if(null!=t){let S=0;!D.J0.IsEmpty(e.ExitGrid)&&e.ExitGrid.gridObj&&null!=e.ExitGrid.gridObj.getActiveCellNode()&&e.ExitGrid.gridObj.getEditorLock().commitCurrentEdit();const{LoginViewModel:l}=yield Promise.resolve().then(g.bind(g,20608)),{LoginScreenComponent:r}=yield Promise.resolve().then(g.bind(g,28925));switch(t.toString()){case"Login":let n=yield new l(e.router);n.IsPosMangr=!0,n.ShowRememberMe=!1,n.ShowDefaultCompany=!1;const{ReportViewModel:c}=yield Promise.resolve().then(g.bind(g,35725));o.d.page.ShowDialog(n,r).subscribe(()=>{if(n.IsLoggedIn){e.BackVisible=!0,e.LoginVisi=!1;let s=new c;s.ReportViewModel_1(18),s.ShowHeaderButtons=!1,s.SearchVisibility=!1,e.Report=s,e.ReportVisibility=!0}});break;case"Cancel":case"Back":o.d.page.HideDialog(e.PopUpGUID);break;case"DayClose":if(S=yield e.ValidatePosUser(),0==S){if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSDayClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose)return void alert("There are some Hold documents exits, can not allow Day Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Day Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSDayClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose)return void alert("There are some Hold documents exits, can not allow Day Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Day Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(o.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(o.d.SessionManager.Preferences.PosShifts)>5e4&&e.Parent.ScreenObject.ShiftNodeID>0){let s;if(s=o.d.admin.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,104,"","","").obj,s<0)return e.DisplayMessage="Close all shifts before DayClose",void(e.MessageVisibility=!0)}if(e.CloseType=1,o.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileDayClose")&&""!=o.d.SessionManager.Preferences.DontShowPaymodeWhileDayClose&&(0,P.yG0)(o.d.SessionManager.Preferences.DontShowPaymodeWhileDayClose)){let s,a={RetVal:0};A.a.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","",a),s=a.RetVal,o.d.page.HideDialog(e.PopUpGUID),o.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!1,e.Paymodes(null)}break;case"ShiftClose":if(S=yield e.ValidatePosUser(),0==S){if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSShiftClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose)return void alert("There are some Hold documents exits, can not allow Shift Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Shift Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSShiftClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose)return void alert("There are some Hold documents exits, can not allow Shift Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Shift Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(e.CloseType=2,o.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileShiftClose")&&""!=o.d.SessionManager.Preferences.DontShowPaymodeWhileShiftClose&&(0,P.yG0)(o.d.SessionManager.Preferences.DontShowPaymodeWhileShiftClose)){let s,a={RetVal:0};A.a.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","",a),s=a.RetVal,o.d.page.HideDialog(e.PopUpGUID),o.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!0,e.Paymodes(null)}break;case"UserClose":if(S=yield e.ValidatePosUser(),0==S){if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSUserClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose)return void alert("There are some Hold documents exits, can not allow User Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to User Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(o.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSUserClose")&&!D.J0.IsEmpty(o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose.toString())&&"None"!=o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose&&e.IsHoldDocsExits()){if("Stop"==o.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose)return void alert("There are some Hold documents exits, can not allow User Close.");{let s=yield new b.MessageDialogViewModel;if(s.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to User Close.?","Yes","No"),yield o.d.page.openDialog(s,p.MessageDialogViewModelComponent,{ShowCenter:!0,Title:s.lblTitle}),"Yes"!=s.res)return}}if(e.CloseType=3,o.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileUserClose")&&""!=o.d.SessionManager.Preferences.DontShowPaymodeWhileUserClose&&(0,P.yG0)(o.d.SessionManager.Preferences.DontShowPaymodeWhileUserClose)){let s;s=o.d.admin.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","").obj,o.d.page.HideDialog(e.PopUpGUID),o.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!1,e.Paymodes(null)}break;case"UserExit":if(S=yield e.ValidatePosUser(),0==S&&confirm("Do you really want to exit?")){let a=new v.v;e.CloseType=0,e.CloseSession(),a.OnChange.Subscribe(H.RibbonExtViewModel,"OnTabItemClick")}break;case"LockScreen":if(confirm("Do you really want to lock?")){let s=yield new l(e.router);s.IsUserLock=!0,s.CancelVisiblity=!1,s.ShowRememberMe=!1,s.ShowDefaultCompany=!1,s.Title="Un Lock",o.d.page.HideDialog(e.PopUpGUID),o.d.page.ShowDialog(s,r)}break;case"CashOut":if(o.d.SessionManager.Preferences.ContainsKey("CashOut")&&""!=o.d.SessionManager.Preferences.CashOut&&"0"!=o.d.SessionManager.Preferences.CashOut){o.d.page.HideDialog(e.PopUpGUID);const{PostVoucherSaveViewModel:s}=yield Promise.resolve().then(g.bind(g,37147)),{PostVoucherSaveComponent:a}=yield Promise.resolve().then(g.bind(g,45684));let h=new s(e.Parent,parseInt(o.d.SessionManager.Preferences.CashOut),0,0,1,1,!1,!1);o.d.page.ShowDialog(h,a,{ShowCenter:!0,NoWidth:!1})}break;case"CashIN":if(o.d.SessionManager.Preferences.ContainsKey("CashIn")&&""!=o.d.SessionManager.Preferences.CashIn&&"0"!=o.d.SessionManager.Preferences.CashIn){o.d.page.HideDialog(e.PopUpGUID);const{PostVoucherSaveViewModel:s}=yield Promise.resolve().then(g.bind(g,37147)),{PostVoucherSaveComponent:a}=yield Promise.resolve().then(g.bind(g,45684));let h=new s(e.Parent,parseInt(o.d.SessionManager.Preferences.CashIn),0,0,1,1,!1,!1);o.d.page.ShowDialog(h,a,{ShowCenter:!0,NoWidth:!1})}break;case"CashRegister":o.d.page.HideDialog(e.PopUpGUID);const{POSCashRegisterViewModel:u}=yield g.e(7347).then(g.bind(g,27347)),{POSCashRegisterComponent:f}=yield g.e(9093).then(g.bind(g,89093));let i=new u(e.Parent);o.d.page.ShowDialog(i,f,{ShowCenter:!0,NoWidth:!1});break;case"HoldDoc":if(0!=e.Parent.DocID)return e.DisplayMessage=o.d.GetResource("Documentalreadysaved"),void(e.MessageVisibility=!0);if(null==e.Parent.HoldDocName||""==e.Parent.HoldDocName.Text.trim())return e.DisplayMessage="Enter Name",void(e.MessageVisibility=!0);e.Parent.SaveDraft(!1,!1),o.d.page.HideDialog(e.PopUpGUID);break;case"OK":if(e.IsPayMode)2==e.CloseType&&(e.DayClose.IsChecked=!1,e.DayClose.Visible=!0),e.TouchVisibility=!1,e.FillGrid(!1),e.BackVisible=o.d.SessionManager.IsActionAssigned(e.Parent.CostCenterID,"CanEditPayMode"),e.IsDiff&&(e.LoginVisi=!0);else{if("1"!=o.d.SessionManager.UserID&&e.IsDiff&&o.d.SessionManager.IsActionAssigned(e.Parent.CostCenterID,"DonotcloseifDiffinPayMode"))return e.DisplayMessage="Difference in PayModes",void(e.MessageVisibility=!0);4==e.CloseType?(e.CallPrint(e.Parent.ScreenObject.ShiftNodeID),o.d.page.HideDialog(e.PopUpGUID)):e.CloseSession()}break;case"Previous":e.BackVisible=!1,e.CancelVisible=!0,e.ShowDenomHelp=!0,e.LoginVisi=!1,e.ReportVisibility=!1,e.IsPayMode=!0,e.IsDiff=!1,e.ExitGrid.Columns[1].ReadOnly=!1,e.ExitGrid.Height=250,e.ExitGrid.RefreshColumns(),e.ExitGrid.Table=e.DtExit,e.DtReport.Clear(),e.TouchVisibility=e.Parent.FooterTouchVisible,e.DayClose.Visible&&(e.DayClose.Visible=!1);break;case"PrintDayClose":e.PrintVisibility=!0,e.OptionsVisible=!1,e.Shift.Visible=!1,e.PrintDate.Label=o.d.GetResource("Doc_Date");break;case"PrintShiftClose":e.PrintVisibility=!0,e.OptionsVisible=!1,e.Shift.Visible=!0,e.Shift.Label="Shift",e.PrintDate.Label=o.d.GetResource("Doc_Date");break;case"PrintOK":if(!e.PrintDate.Date)return e.DisplayMessage="select Date",void(e.MessageVisibility=!0);if(e.Shift.Visible&&0==e.Shift.SelectedValue)return e.DisplayMessage="select shift",void(e.MessageVisibility=!0);e.CloseType=e.Shift.Visible?5:4,e.InitGrid(),e.GridVisible=!0,e.PrintVisibility=!1,e.FillGrid(!0)}}})()}ValidatePosUser(){return(0,y.A)(function*(){let t=0,e=!1,S=o.d.page.tabs.find(l=>l.params?.obj instanceof G.POSDocumentViewModel);if(null!=S){let r,l=S.params?.obj;if(r=l.ScreenObject.GridData.filter(n=>n.ProductID_Key>0),r.length>0)return e=yield l.CheckingPosRows(),e||(t=1),t}return o.d.page.tabs.forEach(l=>{if(null!=l.params.obj&&"POSDocumentViewModel"==l.params.obj.ClassName)for(let r=0;r<l.params.obj.ScreenObject.GridData.length;r++)l.params.obj.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!D.J0.IsEmpty(l.params.obj.ScreenObject.GridData[r].ProductID_Key)&&(l.params.obj.CheckingPosRows(),t++)}),t})()}OnExitGridBeginEdit(t,e,S){return!(!this.IsPayMode||"Amount"!=e||"5"!=t.Type.toString()||0==t.DenomXML.toString().length)||(this.IsPayMode&&"Amount"==e&&null!=this.NumericPADView&&""!=t[e].toString()&&(this.NumericPADView.txt.Text=t[e].toString()),!1)}Paymodes(t){let e=null;null==t?(this.ShowDenomHelp=!0,this.IsPayMode=!0):t.Tables.length>10&&t.Columns[10].Contains("DetailsXML")&&t.Tables[10].length>0&&""!=t.Tables[10][0].DetailsXML.toString()&&e.ReadXml(t.Tables[10][0].DetailsXML.toString()),this.DTPayModesObj.Clear();let S=this.Parent.ScreenObject.Data.Tables[0].filter(r=>r.SectionID>4&&11!=r.SectionID,"SectionID");if(S.length>0){let r=2;for(let n=0;n<S.length;n++){const c=S[n];if(c.SysColumnName.toString().toLowerCase().Contains("currid")||c.SysColumnName.toString().toLowerCase().Contains("exchrt"))continue;let d={};if(d.Name=c.ResourceData.toString(),d.NameWithKey=r<=10?c.ResourceData.toString()+" (F"+r+")":c.ResourceData.toString(),d.SysColumnName=c.SysColumnName.toString(),d.Type=c.SectionID.toString(),!D.J0.IsEmpty(e)&&e.Tables.length>0&&e.Columns[0].Contains("SysColName")){var l=e.Tables[0].filter(u=>u.SysColName==c.SysColumnName.toString());l.length>0&&!D.J0.IsEmpty(l[0].Amount)&&(d.Amount=l[0].Amount.toString())}this.DTPayModes.push(d),r++}}null==t&&(this.ExitGrid.Table=this.DTPayModes),this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=0,this.ExitGrid.SetFocusongrid=!0,this.TouchVisibility=this.Parent.FooterTouchVisible}FillGrid(t){var e=this;return(0,y.A)(function*(){!t&&e.Parent.ScreenObject.Preferences.ContainsKey("POSDiffJVFields")&&""!=e.Parent.ScreenObject.Preferences.POSDiffJVFields&&e.DtDiffPosting.ReadXml(e.Parent.ScreenObject.Preferences.POSDiffJVFields);let l=window.innerHeight-320;l<400&&(l=400),e.ExitGrid.Columns[1].ReadOnly=!0,e.ExitGrid.Height=l,e.ExitGrid.RefreshColumns(),e.CancelVisible=!!(t||e.Parent.ScreenObject.Preferences.ContainsKey("Cancelinclose")&&"true"==e.Parent.ScreenObject.Preferences.Cancelinclose.toLowerCase()),e.ShowDenomHelp=!1,e.IsPayMode=!1;let r,n=0;if(t)r=e.PrintDate.Date,e.Shift.Visible&&(n=e.Shift.SelectedValue);else{e.IsShiftClose&&(n=e.Parent.ScreenObject.ShiftNodeID);let d=e.Parent.ScreenObject.HeaderFields.find(u=>u instanceof E.Lc&&"docdate"==u.DBColumnName.toLowerCase());r=null!=d&&""!=d.DefaultValue?D.J0.ParseDate(d.DefaultValue):e.Parent.DocumentDate}let c=A.a.GetPOSDetails(e.Parent.PosSessionID,r,e.CloseType,e.Parent.ScreenObject.RegisterNodeID,n,"");if(c.Tables.length>1&&c.Columns[1].Contains("Prefix")&&t){if(c.Tables.length>10&&c.Columns[10].Contains("Isclose")&&c.Tables[10].length>0&&"Not close"==c.Tables[10][0].Isclose.toString())return e.DisplayMessage=4==e.CloseType?"Day not closed":"Shift not closed",e.MessageVisibility=!0,e.GridVisible=!1,void(e.PrintVisibility=!0);e.Paymodes(c)}e.DtExit=JSON.parse(JSON.stringify(e.ExitGrid.Table)),e.SkipDefaultCloseReport||(e.ExitGrid.Table=yield e.CloseData(c),e.ExitGrid.refreshDatawithIDs()),e.ShowDetailSection||(e.ExitGrid.Height=35,e.OKVisible=!1,e.OnButtonClick("OK"))})()}CloseData(t){var e=this;return(0,y.A)(function*(){if(null==e.oReport){const{ReportViewModel:l}=yield Promise.resolve().then(g.bind(g,35725));e.oReport=new l,e.oReport.ReportViewModel_1(190)}else e.oReport.Data.Clear();if(t.Tables.length>1&&t.Columns[1].Contains("Prefix")){t.Columns[t.Tables.length-1].Contains("Name")&&t.Tables[t.Tables.length-1].length>0&&(e.RegName=t.Tables[t.Tables.length-1][0].Name.toString());let l=e.Parent.ScreenObject.Preferences.POSFields.toString().split(","),r=null;e.Parent.ScreenObject.Preferences.ContainsKey("POSJVFields")&&(r=e.Parent.ScreenObject.Preferences.POSJVFields.toString().split(","));let n,c=0,d=null,u=null;t.Tables[1].length>0&&""!=t.Tables[1][0].orders.toString()&&(d=t.Tables[1][0].orders.toString().split(",")),t.Tables[1].length>0&&""!=t.Tables[1][0].GiftVSale.toString()&&(u=t.Tables[1][0].GiftVSale.toString().split(",")),n=e.AddRow("Sales(vouchers)","",!1,!0);let f=t.Tables[1].filter(i=>38==i.documenttype);for(let i=0;i<f.length;i++)null!=d&&d.Contains(f[i].costcenterid.toString())||null!=u&&u.Contains(f[i].costcenterid.toString())||(e.AddRow(f[i].DocumentName.toString()+"-Starting No",f[i].Prefix.toString()+f[i].MinNumber.toString(),!1,!1),e.AddRow(f[i].DocumentName.toString()+"-Ending No",f[i].Prefix.toString()+f[i].MAXNumber.toString(),!1,!1),""!=f[i].cnt.toString()&&(c+=parseInt(f[i].cnt.toString())));n.Amount=c;for(let i=0;i<l.length;i++){let s=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=s&&(n=e.AddRow(s.Header,t.Tables[0].length>0?t.Tables[0][0][i].toString():"FLOAT"==s.DataType?"0":"","FLOAT"==s.DataType,!1),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(n.SysColumnName=l[i],n.PostJV=1))}if(null!=d&&d.length>0){e.AddRow("","",!1,!0),c=0,n=e.AddRow("Orders(vouchers)","",!1,!0);for(let i=0;i<f.length;i++)d.Contains(f[i].costcenterid.toString())&&(e.AddRow(f[i].DocumentName.toString()+"-Starting No",f[i].Prefix.toString()+f[i].MinNumber.toString(),!1,!1),e.AddRow(f[i].DocumentName.toString()+"-Ending No",f[i].Prefix.toString()+f[i].MAXNumber.toString(),!1,!1),""!=f[i].cnt.toString()&&(c+=parseInt(f[i].cnt.toString())));if(n.Amount=c,t.Tables.length>8&&t.Tables[8].length>0)for(let i=0;i<l.length;i++){let s=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=s&&(n=e.AddRow(s.Header,t.Tables[8][0][i].toString(),"FLOAT"==s.DataType,!1))}}if(null!=u&&u.length>0){e.AddRow("","",!1,!0),c=0,n=e.AddRow("Gift (vouchers)","",!1,!0);for(let i=0;i<f.length;i++)u.Contains(f[i].costcenterid.toString())&&(e.AddRow(f[i].DocumentName.toString()+"-Starting No",f[i].Prefix.toString()+f[i].MinNumber.toString(),!1,!1),e.AddRow(f[i].DocumentName.toString()+"-Ending No",f[i].Prefix.toString()+f[i].MAXNumber.toString(),!1,!1),""!=f[i].cnt.toString()&&(c+=parseInt(f[i].cnt.toString())));if(n.Amount=c,t.Tables.length>9&&t.Tables[9].length>0)for(let i=0;i<l.length;i++){let s=e.Parent.ScreenObject.ColumnSource.filter(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=s&&(n=e.AddRow(s.Header,t.Tables[9][0][i].toString(),"FLOAT"==s.DataType,!1))}}e.AddRow("","",!1,!1),c=0,n=e.AddRow("Return(vouchers)","",!1,!0),f=t.Tables[1].filter(i=>39==i.documenttype);for(let i=0;i<f.length;i++)e.AddRow(f[i].DocumentName.toString()+"-Starting No",f[i].Prefix.toString()+f[i].MinNumber.toString(),!1,!1),e.AddRow(f[i].DocumentName.toString()+"-Ending No",f[i].Prefix.toString()+f[i].MAXNumber.toString(),!1,!1),""!=f[i].cnt.toString()&&(c+=parseInt(f[i].cnt.toString()));if(n.Amount=c,t.Tables.length>4&&t.Tables[4].length>0)for(let i=0;i<l.length;i++){let s=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=s&&(n=e.AddRow(s.Header,t.Tables[4][0][i].toString(),"FLOAT"==s.DataType,!1))}if(e.AddRow("","",!1,!1),e.Parent.ScreenObject.Preferences.ContainsKey("POSFields")&&""!=e.Parent.ScreenObject.Preferences.POSFields)for(let i=0;i<l.length;i++)if(null==e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase())){let a=e.DTPayModes.filter(h=>h.SysColumnName.toLowerCase()==l[i].toLowerCase());if(a.length>0){e.AddRow(a[0].Name.toString(),"",!1,!0),a[0].Name="  "+a[0].Name;let m,h=0;if("5"==a[0].Type.toString()){if(t.Tables.length>2&&t.Tables[2].length>0&&t.Columns[2].Contains("Amount"))for(let C=0;C<t.Tables[2].length;C++)n="300"==t.Tables[2][C].RefCCID.toString()?e.AddRow("  Opening "+a[0].Name.toString(),t.Tables[2][C].Amount.toString(),!0,!1):e.AddRow(a[0].Name.toString()+" IN",t.Tables[2][C].Amount.toString(),!0,!1),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString(),""!=t.Tables[2][C].Amount.toString()&&(!e.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")||""==e.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode||!(0,P.yG0)(e.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)||"300"!=t.Tables[2][C].RefCCID.toString())&&(h+=parseFloat(t.Tables[2][C].Amount.toString()));t.Tables.length>3&&t.Tables[3].length>0&&t.Columns[3].Contains("Amount")&&""!=t.Tables[3][0].Amount.toString()&&(n=e.AddRow(a[0].Name.toString()+" OUT",t.Tables[3][0].Amount.toString(),!0,!1),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString(),""!=t.Tables[3][0].Amount.toString()&&(h-=parseFloat(t.Tables[3][0].Amount.toString())))}if("5"==a[0].Type.toString()?(m=0,t.Tables[0].length>0&&""!=t.Tables[0][0][t.Columns[0][i]].toString()&&(m+=parseFloat(t.Tables[0][0][t.Columns[0][i]].toString())),t.Tables.length>5&&t.Tables[5].length>0&&""!=t.Tables[5][0][t.Columns[0][0]].toString()&&(m-=parseFloat(t.Tables[5][0][t.Columns[0][0]].toString())),h+=m,n=e.AddRow(a[0].Name.toString()+" Sales",m.toString(),!0,!1),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(n.SysColumnName=l[i],n.PostJV=1)):(n=e.AddRow(a[0].Name.toString(),t.Tables[0].length>0?t.Tables[0][0][t.Columns[0][i]].toString():"0",!0,!1),t.Tables[0].length>0&&""!=t.Tables[0][0][t.Columns[0][i]].toString()&&(h+=parseFloat(t.Tables[0][0][t.Columns[0][i]].toString())),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(n.SysColumnName=l[i],n.PostJV=1)),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString(),t.Tables.length>7&&t.Tables[7].length>0&&""!=t.Tables[7][0][t.Columns[0][i]].toString()&&(n=e.AddRow(a[0].Name.toString()+" Reciept",t.Tables[7][0][t.Columns[0][i]].toString(),!0,!1),h+=parseFloat(t.Tables[7][0][t.Columns[0][i]].toString())),t.Tables.length>8&&t.Tables[8].length>0&&""!=t.Tables[8][0][t.Columns[0][i]].toString()&&(n=e.AddRow(a[0].Name.toString()+" Orders",t.Tables[8][0][t.Columns[0][i]].toString(),!0,!1),h+=parseFloat(t.Tables[8][0][t.Columns[0][i]].toString())),t.Tables.length>9&&t.Tables[9].length>0&&""!=t.Tables[9][0][t.Columns[0][i]].toString()&&(n=e.AddRow(a[0].Name.toString()+" Gift vouchers",t.Tables[9][0][t.Columns[0][i]].toString(),!0,!1),h+=parseFloat(t.Tables[9][0][t.Columns[0][i]].toString())),t.Tables.length>4&&t.Tables[4].length>0&&""!=t.Tables[4][0][t.Columns[0][i]].toString()&&("5"==a[0].Type.toString()?(m=0,""!=t.Tables[4][0][i].toString()&&(m+=parseFloat(t.Tables[4][0][t.Columns[0][i]].toString())),t.Tables.length>6&&t.Tables[6].length>0&&""!=t.Tables[6][0][t.Columns[0][0]].toString()&&(m-=parseFloat(t.Tables[6][0][t.Columns[0][0]].toString())),h-=m,null!=n&&e.DtReportObj.TableColumns.Contains("PostJV")&&"1"==n.PostJV.toString()&&""!=n.AmountActual.toString()&&m>0&&(n.AmountActual=parseFloat(n.AmountActual.toString())-m),n=e.AddRow("  Sales Return",m.toString(),!0,!1)):(null!=n&&e.DtReportObj.TableColumns.Contains("PostJV")&&"1"==n.PostJV.toString()&&""!=n.AmountActual.toString()&&""!=t.Tables[4][0][t.Columns[0][i]].toString()&&(n.AmountActual=parseFloat(n.AmountActual.toString())-parseFloat(t.Tables[4][0][t.Columns[0][i]].toString())),n=e.AddRow("  Sales Return",t.Tables[4][0][t.Columns[0][i]].toString(),!0,!1),h-=parseFloat(t.Tables[4][0][i].toString())),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString()),n=e.AddRow(a[0].Name.toString()+" @Register",D.J0.IsEmpty(a[0].Amount)?"0":a[0].Amount.toString(),!0,!1),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString(),e.DtDiffPosting.Tables.length>0&&e.DtDiffPosting.Columns[0].Contains("Name")){var S=e.DtDiffPosting.Tables[0].filter(C=>C.Name==-n.Type.toString());e.DtReportObj.TableColumns.Contains("PostJV")&&S.length>0&&(n.SysColumnName="RegPOs",n.PostJV=1)}if(h=D.J0.IsEmpty(a[0].Amount)?-h:parseFloat(a[0].Amount.toString())-h,h=parseFloat(h.ToString("N"+o.d.SessionManager.Preferences.DecimalsinAmount)),0!=h&&!e.IsDiff&&(e.IsDiff=!0),n=e.AddRow(a[0].Name.toString()+" Diff",h.toString(),!0,!1),n.SysColumnName=a[0].SysColumnName.toString(),n.Type=a[0].Type.toString(),e.DtDiffPosting.Tables.length>0&&e.DtDiffPosting.Columns[0].Contains("Name")){let C=e.DtDiffPosting.Tables[0].filter(F=>F.Name==n.Type);e.DtReportObj.TableColumns.Contains("PostJV")&&C.length>0&&(n.SysColumnName="DiffPOs",n.PostJV=1)}}else{let h=e.Parent.ScreenObject.Data.Tables[0].filter(m=>m.SysColumnName.toLowerCase()==l[i].toLowerCase());h.length>0&&(t.Tables[0].length>0&&(n=e.AddRow(h[0].ResourceData.toString(),t.Tables[0][0][t.Columns[0][i]].toString(),!1,!1)),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(n.SysColumnName=l[i],n.PostJV=1))}}if(null!=e.Denom&&null!=e.Denom.GrdDenomination&&null!=e.Denom.GrdDenomination.Table&&e.Denom.GrdDenomination.Table.length>0&&e.Denom.GrdDenomination.TableColumns.Contains("Notes")&&e.Denom.GrdDenomination.TableColumns.Contains("NotesTender")){n=e.AddRow("Denominations","",!1,!0);for(let i=0;i<e.Denom.GrdDenomination.Table.length;i++)!D.J0.IsEmpty(e.Denom.GrdDenomination.Table[i].Notes.toString())&&!D.J0.IsEmpty(e.Denom.GrdDenomination.Table[i].NotesTender.toString())&&(n=e.AddRow(e.Denom.GrdDenomination.Table[i].Notes.toString()+" X "+e.Denom.GrdDenomination.Table[i].NotesTender.toString(),(parseFloat(e.Denom.GrdDenomination.Table[i].Notes.toString())*parseFloat(e.Denom.GrdDenomination.Table[i].NotesTender.toString())).toString(),!1,!1));e.AddRow("Total",e.Denom.GetTotal().toString(),!1,!1)}}return e.DtReport})()}AddRow(t,e,S,l){let r=new x.Ji(this.oReport.ReportColumns.length);l&&(r.Cells[0].IsNormal=!1,r.Cells[0].CellAppearance=this.oReport.ReportColumns[0].DataAppearance.Clone(),r.Cells[0].CellAppearance.IsBold=!0,r.Cells[0].IsNormal=!1,r.Cells[1].CellAppearance=this.oReport.ReportColumns[1].DataAppearance.Clone(),r.Cells[1].CellAppearance.IsBold=!0),r.Cells[0].Text=t;let n=0;S?(n=D.J0.DoubleTryParse(e),this.oReport.SetCellValue(n,this.oReport.ReportColumns[1].DataFormat,"FLOAT",r.Cells[1])):r.Cells[1].Text=e,this.oReport.Data.push(r);let c=this.DtReportObj.NewRow();return c.NameWithKey=t,l&&(c.StyleIsBold="1"),S?(c.Amount=r.Cells[1].Text,c.AmountActual=n,t.Contains("Diff")&&(n>0&&(c.Row_Background="GREEN"),n<0&&(c.Row_Background="RED"))):c.Amount=e,this.DtReport.push(c),c}GetJVXML(t,e){if(e.IsValid=!0,!this.DtReportObj.TableColumns.Contains("PostJV"))return"";let l=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,{message:""},!1,!1);o.d.SessionManager.RegisterCCID>0&&this.Parent.ScreenObject.RegisterNodeID>0&&!l.toString().Contains("dcCCNID"+(o.d.SessionManager.RegisterCCID-5e4).toString()+"=")&&(l+=" dcCCNID"+(o.d.SessionManager.RegisterCCID-5e4).toString()+"="+this.Parent.ScreenObject.RegisterNodeID.toString()+", "),this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn&&o.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(o.d.SessionManager.Preferences.PosShifts)>5e4&&this.Parent.ScreenObject.ShiftNodeID>0&&!l.toString().Contains("dcCCNID"+(parseInt(o.d.SessionManager.Preferences.PosShifts)-5e4).toString()+"=")&&(l+=" dcCCNID"+(parseInt(o.d.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.Parent.ScreenObject.ShiftNodeID.toString()+", ");let r,n,d,c="";for(let s=0;s<this.DtReport.length;s++)if("1"==D.J0.StringValue(this.DtReport[s].PostJV)&&!D.J0.IsEmpty(this.DtReport[s].AmountActual)&&(d="DiffPOs"==this.DtReport[s].SysColumnName.toString()?this.DtDiffPosting.Tables[0].filter(a=>a.Name==this.DtReport[s].Type.toString()):"RegPOs"==this.DtReport[s].SysColumnName.toString()?this.DtDiffPosting.Tables[0].filter(a=>a.Name="-"+this.DtReport[s].Type.toString()):this.Parent.ScreenObject.Data.Tables[0].filter(a=>a.SysColumnName==this.DtReport[s].SysColumnName.toString()),d.length>0)){if(r=D.J0.IntTryParse(d[0].DebitAccount.toString()),n=D.J0.IntTryParse(d[0].CreditAccount.toString()),r<=0&&d[0].Table.Columns.Contains("DrRefColID")&&""!=d[0].DrRefColID.toString()&&parseInt(d[0].DrRefColID.toString())>0){let a=this.Parent.ScreenObject._CCFields.find(h=>h.DBColumnName.toLowerCase()==d[0].DRSysColumnName.toString().toLowerCase());null!=a&&a instanceof T.y$&&a.SelectedValue>0&&(r=this.Parent.ScreenObject.GetAccountByRef(parseInt(d[0].DrRefID.toString()),parseInt(d[0].DrRefColID.toString()),a.SelectedValue))}if(n<=0&&d[0].Table.Columns.Contains("CrRefColID")&&""!=d[0].CrRefColID.toString()&&parseInt(d[0].CrRefColID.toString())>0){let a=this.Parent.ScreenObject._CCFields.find(h=>h.DBColumnName.toLowerCase()==d[0].CRSysColumnName.toString().toLowerCase());null!=a&&a instanceof T.y$&&a.SelectedValue>0&&(n=this.Parent.ScreenObject.GetAccountByRef(parseInt(d[0].CrRefID.toString()),parseInt(d[0].CrRefColID.toString()),a.SelectedValue))}if(this.DtReportObj.TableColumns.Contains("DebitAccount")||this.DtReportObj.TableColumns.push("DebitAccount"),this.DtReportObj.TableColumns.Contains("CreditAccount")||this.DtReportObj.TableColumns.push("CreditAccount"),!(r>0))return e.IsValid=!1,this.DisplayMessage="DebitAccount not defined for "+this.DtReport[s].NameWithKey.toString(),this.MessageVisibility=!0,"";if(this.DtReport[s].DebitAccount=r,!(n>0))return e.IsValid=!1,this.DisplayMessage="Credit not defined for "+this.DtReport[s].NameWithKey.toString(),this.MessageVisibility=!0,"";this.DtReport[s].CreditAccount=n,c+=r+",",c+=n+","}c.length>1&&(c=c.Remove(0,c.length));let u=this.Parent.ScreenObject.CheckIsBillWise(c),f=1,i="";for(let s=0;s<this.DtReport.length;s++)"1"==D.J0.StringValue(this.DtReport[s].PostJV)&&D.J0.IsEmpty(this.DtReport[s].AmountActual)&&0!=parseFloat(this.DtReport[s].AmountActual.toString())&&(i+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+f+'" Amount="'+this.DtReport[s].AmountActual.toString().Replace("-","")+'" ',i+=' AmtFc="'+this.DtReport[s].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(this.DtReport[s].AmountActual.toString())>0?i+='DebitAccount="'+this.DtReport[s].DebitAccount.toString()+'" CreditAccount="-99" ></Transactions> ':i+='CreditAccount="'+this.DtReport[s].DebitAccount.toString()+'" DebitAccount="-99" ></Transactions> ',i+=' <Numeric /> <Alpha /> <CostCenters  Query="'+l+'"  /> <EXTRAXML>',null!=u&&u.Tables.length>0&&u.Columns[0].Contains("AccountId")&&(d=u.Tables[0].filter(a=>a.AccountId==this.DtReport[s].DebitAccount.toString()),d.length>0&&"true"==d[0].IsBillwise.toString().toLowerCase()&&(i+='<BillWise> <Row DocSeqNo="'+f+'" AccountID="'+this.DtReport[s].DebitAccount.toString(),i+='" AmountFC="'+this.DtReport[s].AmountActual.toString()+'" AdjAmount="'+this.DtReport[s].AmountActual.toString()+'"',i+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),i+="   </EXTRAXML>  </Row>",f++,i+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+f+'" Amount="'+this.DtReport[s].AmountActual.toString().Replace("-","")+'" ',i+=' AmtFc="'+this.DtReport[s].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(this.DtReport[s].AmountActual.toString())>0?i+='DebitAccount="-99" CreditAccount="'+this.DtReport[s].CreditAccount.toString()+'" ></Transactions> ':i+='CreditAccount="-99" DebitAccount="'+this.DtReport[s].CreditAccount.toString()+'" ></Transactions> ',i+=' <Numeric /> <Alpha /> <CostCenters  Query="'+l+'"  /> <EXTRAXML>',null!=u&&u.Tables.length>0&&u.Columns[0].Contains("AccountId")&&(d=u.Tables[0].filter(a=>a.AccountId==this.DtReport[s].CreditAccount.toString()),d.length>0&&"true"==d[0].IsBillwise.toString().toLowerCase()&&(i+='<BillWise> <Row DocSeqNo="'+f+'" AccountID="'+this.DtReport[s].CreditAccount.toString(),i+='" AmountFC="-'+this.DtReport[s].AmountActual.toString()+'" AdjAmount="-'+this.DtReport[s].AmountActual.toString()+'"',i+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),i+="   </EXTRAXML>  </Row>",f++);return i.length>0&&(i="<DocumentXML>"+i+"</DocumentXML>"),i.toString()}CloseSession(){let t,e,l="",r="";if(this.CloseType>0&&(r+="<XML>",this.DTPayModes.forEach(d=>{r+='<Row Type="'+D.J0.String(d.Type),r+='" SysColName="'+D.J0.String(d.SysColumnName),r+='" Name="'+D.J0.String(d.Name),r+='" Amount="'+D.J0.String(d.Amount)+'" />',"5"==d.Type.toString()&&0!=D.J0.String(d.DenomXML).length&&(this.DenomXML=d.DenomXML.toString())}),r+="</XML>"),1==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"1"==this.Parent.ScreenObject.Preferences.PosJVOn||2==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn){let d={IsValid:""};if(l=this.GetJVXML(!0,d),t=d.IsValid,!t)return this.Parent.DisplayMessage=this.DisplayMessage,this.Parent.MessageVisibility=!0,void o.d.page.HideDialog(this.PopUpGUID)}let n=this.Parent.ScreenObject.ShiftNodeID;5==this.CloseType&&this.Shift.Visible&&this.Shift.SelectedValue>0&&(n=this.Shift.SelectedValue),e=o.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,n,this.Parent.DocumentDate,this.CloseType,this.DenomXML,l,r.toString()).obj,(e>0||-100==e)&&(this.DayClose.IsChecked&&this.DayClose.Visible?e=o.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,n,this.Parent.DocumentDate,1,"","","").obj:-100==e&&(confirm("All shifts are closed.Closing the Day.")||o.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,n,this.Parent.DocumentDate,1,"","","")),this.CloseType>0&&(this.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&(0,P.yG0)(this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)&&(this.ExitGrid.SelectedItem=null,this.Denom=new O.AddDenominationViewModel(this,null),this.Denom.Currency.Label="Closing Imprest",o.d.page.ShowDialog(this.Denom,R.AddDenominationComponent)),this.CallPrint(n)),o.d.page.HideDialog(this.PopUpGUID),o.d.page.removeActiveTab())}AddDenom(){this.ExitGrid.SelectedItem.DenomXML=this.Denom.GetXML(),this.ExitGrid.SelectedItem.Amount=this.Denom.GetTotal(),o.d.page.HideDialog(this.PopUpGUID)}CallPrint(t){o.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"PrintClosingReport")&&this.NewPrintCode(t)}ExportFile(t,e,S){this.DisplayMessage="Print"==t?"Printing data please wait...":"Exporting data please wait...";let l={};e.InitPrintOrExport(l),l.Type=t;let r="";r=null!=e.FromDatePicker?e.FromDatePicker.Date.ToString("dd/MMM/yyyy"):this.Parent.DocumentDate.ToString("dd/MMM/yyyy"),l.PrintDataOnSeperatePageBy=o.d.SessionManager.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?o.d.SessionManager.Preferences.PrintDataOnSeperatePageBy:"",l.DimensionFiltersKeys.Clear(),l.DimensionFiltersValues.Clear(),l.DimensionFiltersKeys.push(o.d.SessionManager.RegisterCCID),l.DimensionFiltersValues.push(this.Parent.ScreenObject.RegisterNodeID.toString()),o.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(o.d.SessionManager.Preferences.PosShifts)>5e4&&(l.DimensionFiltersKeys.push(o.d.SessionManager.Preferences.PosShifts),l.DimensionFiltersValues.push(S.toString())),o.d.SessionManager.DivisionID>0&&(l.DimensionFiltersKeys.push(50001),l.DimensionFiltersValues.push(o.d.SessionManager.DivisionID.toString())),o.d.SessionManager.LocationID>0&&(l.DimensionFiltersKeys.push(50002),l.DimensionFiltersValues.push(o.d.SessionManager.LocationID.toString())),"PDF"==t?l.lst=[]:"Print"==t?(l.lst=[],l.Type="PDF"):("Excel"==t||"OpenXML"==t)&&(l.lst=[]),l.al="al",o.d.report.ExportReport(e.Data,e.ReportColumns,l,"POSEXIT",[],[],r).subscribe(n=>{"Print"==t?o.d.SessionManager.printTab(n.FileName):(o.d.SessionManager.Download(n.FileName,n.FileName),D.J0.IsEmpty(n.Message)&&!D.J0.IsEmpty(n.FileName)&&(this.DisplayMessage="Exported Successfully"))},n=>{console.log(n)})}NewPrintCode(t){let e="<XML><Row ColID='FROMDATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>";e+="<Row ColID='TODATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>",e+="<Row ColID='"+o.d.SessionManager.RegisterCCID+"' Value='"+this.Parent.ScreenObject.RegisterNodeID+"'/>",this.Parent.ScreenObject.LocationID>0&&(e+="<Row ColID='50002' Value='"+this.Parent.ScreenObject.LocationID+"'/>"),o.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(o.d.SessionManager.Preferences.PosShifts)>5e4&&t>0&&(e+="<Row ColID='"+o.d.SessionManager.Preferences.PosShifts+"' Value='"+t+"'/>"),e+="</XML>";let S=new L.ReportViewModel;return S.RecordCount="",S.PostFilterData=[],S.ReportSummaryData=[],S.ReportSummaryDataColumns=[],S.ReportViewModel_Document(50,e,190,!0,this,null),this.ExportFile("Print",S,t),""}GetReportDataTable(){let e=[];return this.SkipDefaultCloseReport||this.ExitGrid.Table.forEach(S=>{let l={};l.RegID=this.Parent.ScreenObject.RegisterNodeID,l.RegName=this.Parent.ScreenObject.RegisterNodeID.toString(),l.Name=S.NameWithKey,l.StyleIsBold=S.StyleIsBold,l.Value=l[this.Parent.DocumentDate.ToString("ddMMMyyyy")]=S.Amount.toString(),e.push(l)}),e.length>0&&(e[0].CloseType=3==this.CloseType?"UserClose":2==this.CloseType?"ShiftClose":"DAY CLOSE"),e}OnPreviewKeyDown(t){if(this.IsPayMode)if(112==t.keyCode)this.IsPayMode&&(null!=this.ExitGrid.SelectedItem&&"5"==this.ExitGrid.SelectedItem.Type.toString()?(this.Denom.Currency.Label="Cash Collection",this.Denom=new O.AddDenominationViewModel(this,this.ExitGrid.SelectedItem.DenomXML.toString()),o.d.page.ShowDialog(this.Denom,R.AddDenominationComponent)):this.ExitGrid.Table.forEach(e=>{"5"==e.Type.toString()&&(this.ExitGrid.SelectedItem=e,this.Denom.Currency.Label="Cash Collection",this.Denom=new O.AddDenominationViewModel(this,this.ExitGrid.SelectedItem.DenomXML.toString()),o.d.page.ShowDialog(this.Denom,R.AddDenominationComponent))}));else if(t.keyCode>=91&&t.keyCode<=101){let e=t.keyCode-91;e<this.ExitGrid.Table.length&&(this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=e+1,this.ExitGrid.SetFocusongrid=!0)}}}}}]);