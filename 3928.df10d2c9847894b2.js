"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3928],{93928:(W,I,c)=>{c.r(I),c.d(I,{POSExitViewModel:()=>H});var y=c(10467),w=c(23823),N=c(81669),j=c(72099),T=c(98669),E=c(24028),M=c(49710),O=c(32026),s=c(86739),V=c(18569),x=c(38859),p=c(32647),S=c(8787),R=c(71548),A=c(78906),L=c(35725),G=c(31562),P=c(75706),b=c(2360),v=c(17560),U=c(95050);class H extends w.g{get Parent(){return this._parent}get DTPayModes(){return this.DTPayModesObj.Table}get DtReport(){return this.DtReportObj.Table}constructor(){super(),this.ButtonClick=new N.Yk,this.DayClose=new j.c(0),this.HoldVisibility=!1,this.DraftVisibility=!1,this.ExitVisible=!1,this.OptionsVisible=!1,this.GridVisible=!1,this.PrintVisibility=!1,this.Shift=new T.y$,this.PrintDate=new E.P6(0),this.CancelVisible=!0,this.BackVisible=!1,this.ShowDenomHelp=!1,this.NumericPADView=null,this.TouchVisibility=!1,this.LoginVisi=!1,this.ReportVisibility=!1,this.DtExit=[],this.IsPayMode=!1,this.IsShiftClose=!1,this.IsDiff=!1,this.ManagerLoggedin=!1,this.oReport=null,this.Denom=null,this.DenomXML="",this.RegName="",this.CloseType=0,this.DtDiffPosting=new S.VB,this.ClassName="POSExitViewModel"}POSExitViewModel_1(t,e,f,l){this.DayClose.Visible=!1,this._parent=t,this.OptionsVisible=e,this.HoldVisibility=f,this.DraftVisibility=l,this.DayClose.Label="Day Close",!e&&!f&&!l&&(this.ExitVisible=!0),this.OptionsVisible?(this.Title="Options",this.Options_CashIN=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash In"),this.Options_CashOut=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Out"),this.Options_CashRegister=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Options - Cash Register"),s.d.SessionManager.Preferences.ContainsKey("PosShifts")&&""!=s.d.SessionManager.Preferences.PosShifts.toString()&&parseInt(s.d.SessionManager.Preferences.PosShifts.toString())>5e4&&(this.Options_ShiftClose=!0),this.Options_ShiftClose&&(this.Shift.CCID=parseInt(s.d.SessionManager.Preferences.PosShifts.toString()),this.Shift.TypeID=1),this.Options_DayClose=!0):this.Title=this.HoldVisibility?s.d.GetResource("Com_SaveAsHold"):l?s.d.GetResource("Remarks"):"Exit",this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExitVisible&&this.InitGrid()}InitGrid(){this.Exit_UserExit=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Exit"),this.Exit_UserClose=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"User Close"),this.Exit_ShiftClose=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Shift Close"),this.Exit_DayClose=s.d.SessionManager.IsActionAssigned(this._parent.CostCenterID,"Day Close"),this.DTPayModesObj=new M.vv,this.DTPayModesObj.Columns=[],this.DTPayModesObj.Table=[],this.DTPayModesObj.TableColumns.push("Name"),this.DTPayModesObj.TableColumns.push("NameWithKey"),this.DTPayModesObj.TableColumns.push("Amount"),this.DTPayModesObj.DataTypes.Double.push("Amount"),this.DTPayModesObj.TableColumns.push("Type"),this.DTPayModesObj.TableColumns.push("SysColumnName"),this.DTPayModesObj.TableColumns.push("DenomXML"),this.DtReportObj=new M.vv,this.DtReportObj.Columns=[],this.DtReportObj.Table=[],this.DtReportObj.TableColumns.push("NameWithKey"),this.DtReportObj.TableColumns.push("Amount"),this.DtReportObj.TableColumns.push("AmountActual"),this.DtReportObj.DataTypes.Double.push("AmountActual"),this.DtReportObj.TableColumns.push("SysColumnName"),this.DtReportObj.TableColumns.push("Type"),this.DtReportObj.TableColumns.push("StyleIsBold"),this.DtReportObj.TableColumns.push("Row_Background"),this.Parent.ScreenObject.Preferences.ContainsKey("PosPostings")&&"true"==this.Parent.ScreenObject.Preferences.PosPostings.toLowerCase()&&this.DtReportObj.TableColumns.push("PostJV"),this.ExitGrid=new M.vv,this.ExitGrid.Columns=[],this.ExitGrid.Table=[],this.ExitGrid.Width="",this.ExitGrid.Height=250,this.ExitGrid.RowHeight=this.Parent.GridRowHeight,this.ExitGrid.BeginEdit.Subscribe(this,"OnExitGridBeginEdit");let t=[],e=new V.O7;e.Header="Name",e.DisplayMember="NameWithKey",e.DisableTab=!0,e.Width=220,e.ReadOnly=!0,e.DisableTab=!0,t.push(e),e=new V.O7,e.Header="Value",e.DisplayMember="Amount",e.DataType="FLOAT",e.DecimalPoints=s.d.SessionManager.Preferences.DecimalsinAmount,e.Width=180,t.push(e),this.ExitGrid.Columns=t}IsHoldDocsExits(){let t=s.d.document.GetDocumentDrafts(this.Parent.ScreenObject.RegisterNodeID,this.Parent.CostCenterID,2,!1,!0,this.Parent.ScreenObject.LocationID,this.Parent.ScreenObject.DivisionID);return!S.J0.IsEmpty(t)&&t.Tables.length>0&&t.Tables[0].length>0}OnButtonClick(t){var e=this;return(0,y.A)(function*(){if(null!=t){let f=0;!S.J0.IsEmpty(e.ExitGrid)&&e.ExitGrid.gridObj&&null!=e.ExitGrid.gridObj.getActiveCellNode()&&e.ExitGrid.gridObj.getEditorLock().commitCurrentEdit();const{LoginViewModel:l}=yield Promise.resolve().then(c.bind(c,20608)),{LoginScreenComponent:r}=yield Promise.resolve().then(c.bind(c,28925));switch(t.toString()){case"Login":let o=yield new l(e.router);o.IsPosMangr=!0,o.ShowRememberMe=!1,o.ShowDefaultCompany=!1;const{ReportViewModel:g}=yield Promise.resolve().then(c.bind(c,35725));s.d.page.ShowDialog(o,r).subscribe(()=>{if(o.IsLoggedIn){e.BackVisible=!0,e.LoginVisi=!1;let n=new g;n.ReportViewModel_1(18),n.ShowHeaderButtons=!1,n.SearchVisibility=!1,e.Report=n,e.ReportVisibility=!0}});break;case"Cancel":case"Back":s.d.page.HideDialog(e.PopUpGUID);break;case"DayClose":if(f=yield e.ValidatePosUser(),0==f){if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSDayClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose)return void alert("There are some Hold documents exits, can not allow Day Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Day Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSDayClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSDayClose)return void alert("There are some Hold documents exits, can not allow Day Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Day Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(s.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(s.d.SessionManager.Preferences.PosShifts)>5e4&&e.Parent.ScreenObject.ShiftNodeID>0){let n;if(n=s.d.admin.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,104,"","","").obj,n<0)return e.DisplayMessage="Close all shifts before DayClose",void(e.MessageVisibility=!0)}if(e.CloseType=1,s.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileDayClose")&&""!=s.d.SessionManager.Preferences.DontShowPaymodeWhileDayClose&&(0,p.yG0)(s.d.SessionManager.Preferences.DontShowPaymodeWhileDayClose)){let n,a={RetVal:0};A.a.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","",a),n=a.RetVal,s.d.page.HideDialog(e.PopUpGUID),s.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!1,e.Paymodes(null)}break;case"ShiftClose":if(f=yield e.ValidatePosUser(),0==f){if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSShiftClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose)return void alert("There are some Hold documents exits, can not allow Shift Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Shift Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSShiftClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSShiftClose)return void alert("There are some Hold documents exits, can not allow Shift Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to Shift Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(e.CloseType=2,s.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileShiftClose")&&""!=s.d.SessionManager.Preferences.DontShowPaymodeWhileShiftClose&&(0,p.yG0)(s.d.SessionManager.Preferences.DontShowPaymodeWhileShiftClose)){let n,a={RetVal:0};A.a.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","",a),n=a.RetVal,s.d.page.HideDialog(e.PopUpGUID),s.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!0,e.Paymodes(null)}break;case"UserClose":if(f=yield e.ValidatePosUser(),0==f){if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSUserClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose)return void alert("There are some Hold documents exits, can not allow User Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to User Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(s.d.SessionManager.Preferences.ContainsKey("ActionWhenHoldDocsExistsOnPOSUserClose")&&!S.J0.IsEmpty(s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose.toString())&&"None"!=s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose&&e.IsHoldDocsExits()){if("Stop"==s.d.SessionManager.Preferences.ActionWhenHoldDocsExistsOnPOSUserClose)return void alert("There are some Hold documents exits, can not allow User Close.");{let n=yield new P.MessageDialogViewModel;if(n.MessageDialogViewModel_6(e,"Confirmation","There are some Hold documents exits, do you want to proceed to User Close.?","Yes","No"),yield s.d.page.openDialog(n,b.MessageDialogViewModelComponent,{ShowCenter:!0,Title:n.lblTitle}),"Yes"!=n.res)return}}if(e.CloseType=3,s.d.SessionManager.Preferences.ContainsKey("DontShowPaymodeWhileUserClose")&&""!=s.d.SessionManager.Preferences.DontShowPaymodeWhileUserClose&&(0,p.yG0)(s.d.SessionManager.Preferences.DontShowPaymodeWhileUserClose)){let n;n=s.d.admin.POSLogin(e.Parent.ScreenObject.RegisterNodeID,e.Parent.ScreenObject.ShiftNodeID,e.Parent.DocumentDate,e.CloseType,"","","").obj,s.d.page.HideDialog(e.PopUpGUID),s.d.page.removeActiveTab()}else e.ExitVisible=!1,e.GridVisible=!0,e.IsShiftClose=!1,e.Paymodes(null)}break;case"UserExit":if(f=yield e.ValidatePosUser(),0==f&&confirm("Do you really want to exit?")){let a=new v.v;e.CloseType=0,e.CloseSession(),a.OnChange.Subscribe(U.RibbonExtViewModel,"OnTabItemClick")}break;case"LockScreen":if(confirm("Do you really want to lock?")){let n=yield new l(e.router);n.IsUserLock=!0,n.CancelVisiblity=!1,n.ShowRememberMe=!1,n.ShowDefaultCompany=!1,n.Title="Un Lock",s.d.page.HideDialog(e.PopUpGUID),s.d.page.ShowDialog(n,r)}break;case"CashOut":if(s.d.SessionManager.Preferences.ContainsKey("CashOut")&&""!=s.d.SessionManager.Preferences.CashOut&&"0"!=s.d.SessionManager.Preferences.CashOut){s.d.page.HideDialog(e.PopUpGUID);const{PostVoucherSaveViewModel:n}=yield Promise.resolve().then(c.bind(c,37147)),{PostVoucherSaveComponent:a}=yield Promise.resolve().then(c.bind(c,45684));let D=new n(e.Parent,parseInt(s.d.SessionManager.Preferences.CashOut),0,0,1,1,!1,!1);s.d.page.ShowDialog(D,a,{ShowCenter:!0,NoWidth:!1})}break;case"CashIN":if(s.d.SessionManager.Preferences.ContainsKey("CashIn")&&""!=s.d.SessionManager.Preferences.CashIn&&"0"!=s.d.SessionManager.Preferences.CashIn){s.d.page.HideDialog(e.PopUpGUID);const{PostVoucherSaveViewModel:n}=yield Promise.resolve().then(c.bind(c,37147)),{PostVoucherSaveComponent:a}=yield Promise.resolve().then(c.bind(c,45684));let D=new n(e.Parent,parseInt(s.d.SessionManager.Preferences.CashIn),0,0,1,1,!1,!1);s.d.page.ShowDialog(D,a,{ShowCenter:!0,NoWidth:!1})}break;case"CashRegister":s.d.page.HideDialog(e.PopUpGUID);const{POSCashRegisterViewModel:u}=yield c.e(7347).then(c.bind(c,27347)),{POSCashRegisterComponent:d}=yield c.e(9093).then(c.bind(c,89093));let i=new u(e.Parent);s.d.page.ShowDialog(i,d,{ShowCenter:!0,NoWidth:!1});break;case"HoldDoc":if(0!=e.Parent.DocID)return e.DisplayMessage=s.d.GetResource("Documentalreadysaved"),void(e.MessageVisibility=!0);if(null==e.Parent.HoldDocName||""==e.Parent.HoldDocName.Text.trim())return e.DisplayMessage="Enter Name",void(e.MessageVisibility=!0);e.Parent.SaveDraft(!1,!1),s.d.page.HideDialog(e.PopUpGUID);break;case"OK":if(e.IsPayMode)2==e.CloseType&&(e.DayClose.IsChecked=!1,e.DayClose.Visible=!0),e.TouchVisibility=!1,e.FillGrid(!1),e.BackVisible=s.d.SessionManager.IsActionAssigned(e.Parent.CostCenterID,"CanEditPayMode"),e.IsDiff&&(e.LoginVisi=!0);else{if("1"!=s.d.SessionManager.UserID&&e.IsDiff&&s.d.SessionManager.IsActionAssigned(e.Parent.CostCenterID,"DonotcloseifDiffinPayMode"))return e.DisplayMessage="Difference in PayModes",void(e.MessageVisibility=!0);4==e.CloseType?(e.CallPrint(e.Parent.ScreenObject.ShiftNodeID),s.d.page.HideDialog(e.PopUpGUID)):e.CloseSession()}break;case"Previous":e.BackVisible=!1,e.CancelVisible=!0,e.ShowDenomHelp=!0,e.LoginVisi=!1,e.ReportVisibility=!1,e.IsPayMode=!0,e.IsDiff=!1,e.ExitGrid.Columns[1].ReadOnly=!1,e.ExitGrid.Height=250,e.ExitGrid.RefreshColumns(),e.ExitGrid.Table=e.DtExit,e.DtReport.Clear(),e.TouchVisibility=e.Parent.FooterTouchVisible,e.DayClose.Visible&&(e.DayClose.Visible=!1);break;case"PrintDayClose":e.PrintVisibility=!0,e.OptionsVisible=!1,e.Shift.Visible=!1,e.PrintDate.Label=s.d.GetResource("Doc_Date");break;case"PrintShiftClose":e.PrintVisibility=!0,e.OptionsVisible=!1,e.Shift.Visible=!0,e.Shift.Label="Shift",e.PrintDate.Label=s.d.GetResource("Doc_Date");break;case"PrintOK":if(!e.PrintDate.Date)return e.DisplayMessage="select Date",void(e.MessageVisibility=!0);if(e.Shift.Visible&&0==e.Shift.SelectedValue)return e.DisplayMessage="select shift",void(e.MessageVisibility=!0);e.CloseType=e.Shift.Visible?5:4,e.InitGrid(),e.GridVisible=!0,e.PrintVisibility=!1,e.FillGrid(!0)}}})()}ValidatePosUser(){return(0,y.A)(function*(){let t=0,e=!1,f=s.d.page.tabs.find(l=>l.params?.obj instanceof G.POSDocumentViewModel);if(null!=f){let r,l=f.params?.obj;if(r=l.ScreenObject.GridData.filter(o=>o.ProductID_Key>0),r.length>0)return e=yield l.CheckingPosRows(),e||(t=1),t}return s.d.page.tabs.forEach(l=>{if(null!=l.params.obj&&"POSDocumentViewModel"==l.params.obj.ClassName)for(let r=0;r<l.params.obj.ScreenObject.GridData.length;r++)l.params.obj.ScreenObject.GridDataColumns.Contains("ProductID_Key")&&!S.J0.IsEmpty(l.params.obj.ScreenObject.GridData[r].ProductID_Key)&&(l.params.obj.CheckingPosRows(),t++)}),t})()}OnExitGridBeginEdit(t,e,f){return!(!this.IsPayMode||"Amount"!=e||"5"!=t.Type.toString()||0==t.DenomXML.toString().length)||(this.IsPayMode&&"Amount"==e&&null!=this.NumericPADView&&""!=t[e].toString()&&(this.NumericPADView.txt.Text=t[e].toString()),!1)}Paymodes(t){let e=null;null==t?(this.ShowDenomHelp=!0,this.IsPayMode=!0):t.Tables.length>10&&t.Columns[10].Contains("DetailsXML")&&t.Tables[10].length>0&&""!=t.Tables[10][0].DetailsXML.toString()&&e.ReadXml(t.Tables[10][0].DetailsXML.toString()),this.DTPayModesObj.Clear();let f=this.Parent.ScreenObject.Data.Tables[0].filter(r=>r.SectionID>4&&11!=r.SectionID,"SectionID");if(f.length>0){let r=2;for(let o=0;o<f.length;o++){const g=f[o];if(g.SysColumnName.toString().toLowerCase().Contains("currid")||g.SysColumnName.toString().toLowerCase().Contains("exchrt"))continue;let h={};if(h.Name=g.ResourceData.toString(),h.NameWithKey=r<=10?g.ResourceData.toString()+" (F"+r+")":g.ResourceData.toString(),h.SysColumnName=g.SysColumnName.toString(),h.Type=g.SectionID.toString(),!S.J0.IsEmpty(e)&&e.Tables.length>0&&e.Columns[0].Contains("SysColName")){var l=e.Tables[0].filter(u=>u.SysColName==g.SysColumnName.toString());l.length>0&&!S.J0.IsEmpty(l[0].Amount)&&(h.Amount=l[0].Amount.toString())}this.DTPayModes.push(h),r++}}null==t&&(this.ExitGrid.Table=this.DTPayModes),this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=0,this.ExitGrid.SetFocusongrid=!0,this.TouchVisibility=this.Parent.FooterTouchVisible}FillGrid(t){!t&&this.Parent.ScreenObject.Preferences.ContainsKey("POSDiffJVFields")&&""!=this.Parent.ScreenObject.Preferences.POSDiffJVFields&&this.DtDiffPosting.ReadXml(this.Parent.ScreenObject.Preferences.POSDiffJVFields);let f=window.innerHeight-320;f<400&&(f=400),this.ExitGrid.Columns[1].ReadOnly=!0,this.ExitGrid.Height=f,this.ExitGrid.RefreshColumns(),this.CancelVisible=!!(t||this.Parent.ScreenObject.Preferences.ContainsKey("Cancelinclose")&&"true"==this.Parent.ScreenObject.Preferences.Cancelinclose.toLowerCase()),this.ShowDenomHelp=!1,this.IsPayMode=!1;let l,r=0;if(t)l=this.PrintDate.Date,this.Shift.Visible&&(r=this.Shift.SelectedValue);else{this.IsShiftClose&&(r=this.Parent.ScreenObject.ShiftNodeID);let g=this.Parent.ScreenObject.HeaderFields.find(h=>h instanceof E.Lc&&"docdate"==h.DBColumnName.toLowerCase());l=null!=g&&""!=g.DefaultValue?S.J0.ParseDate(g.DefaultValue):this.Parent.DocumentDate}let o=A.a.GetPOSDetails(this.Parent.PosSessionID,l,this.CloseType,this.Parent.ScreenObject.RegisterNodeID,r,"");if(o.Tables.length>1&&o.Columns[1].Contains("Prefix")&&t){if(o.Tables.length>10&&o.Columns[10].Contains("Isclose")&&o.Tables[10].length>0&&"Not close"==o.Tables[10][0].Isclose.toString())return this.DisplayMessage=4==this.CloseType?"Day not closed":"Shift not closed",this.MessageVisibility=!0,this.GridVisible=!1,void(this.PrintVisibility=!0);this.Paymodes(o)}this.DtExit=JSON.parse(JSON.stringify(this.ExitGrid.Table)),this.CloseData(o)}CloseData(t){var e=this;return(0,y.A)(function*(){if(null==e.oReport){const{ReportViewModel:l}=yield Promise.resolve().then(c.bind(c,35725));e.oReport=new l,e.oReport.ReportViewModel_1(190)}else e.oReport.Data.Clear();if(t.Tables.length>1&&t.Columns[1].Contains("Prefix")){t.Columns[t.Tables.length-1].Contains("Name")&&t.Tables[t.Tables.length-1].length>0&&(e.RegName=t.Tables[t.Tables.length-1][0].Name.toString());let l=e.Parent.ScreenObject.Preferences.POSFields.toString().split(","),r=null;e.Parent.ScreenObject.Preferences.ContainsKey("POSJVFields")&&(r=e.Parent.ScreenObject.Preferences.POSJVFields.toString().split(","));let o,g=0,h=null,u=null;t.Tables[1].length>0&&""!=t.Tables[1][0].orders.toString()&&(h=t.Tables[1][0].orders.toString().split(",")),t.Tables[1].length>0&&""!=t.Tables[1][0].GiftVSale.toString()&&(u=t.Tables[1][0].GiftVSale.toString().split(",")),o=e.AddRow("Sales(vouchers)","",!1,!0);let d=t.Tables[1].filter(i=>38==i.documenttype);for(let i=0;i<d.length;i++)null!=h&&h.Contains(d[i].costcenterid.toString())||null!=u&&u.Contains(d[i].costcenterid.toString())||(e.AddRow(d[i].DocumentName.toString()+"-Starting No",d[i].Prefix.toString()+d[i].MinNumber.toString(),!1,!1),e.AddRow(d[i].DocumentName.toString()+"-Ending No",d[i].Prefix.toString()+d[i].MAXNumber.toString(),!1,!1),""!=d[i].cnt.toString()&&(g+=parseInt(d[i].cnt.toString())));o.Amount=g;for(let i=0;i<l.length;i++){let n=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=n&&(o=e.AddRow(n.Header,t.Tables[0].length>0?t.Tables[0][0][i].toString():"FLOAT"==n.DataType?"0":"","FLOAT"==n.DataType,!1),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(o.SysColumnName=l[i],o.PostJV=1))}if(null!=h&&h.length>0){e.AddRow("","",!1,!0),g=0,o=e.AddRow("Orders(vouchers)","",!1,!0);for(let i=0;i<d.length;i++)h.Contains(d[i].costcenterid.toString())&&(e.AddRow(d[i].DocumentName.toString()+"-Starting No",d[i].Prefix.toString()+d[i].MinNumber.toString(),!1,!1),e.AddRow(d[i].DocumentName.toString()+"-Ending No",d[i].Prefix.toString()+d[i].MAXNumber.toString(),!1,!1),""!=d[i].cnt.toString()&&(g+=parseInt(d[i].cnt.toString())));if(o.Amount=g,t.Tables.length>8&&t.Tables[8].length>0)for(let i=0;i<l.length;i++){let n=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=n&&(o=e.AddRow(n.Header,t.Tables[8][0][i].toString(),"FLOAT"==n.DataType,!1))}}if(null!=u&&u.length>0){e.AddRow("","",!1,!0),g=0,o=e.AddRow("Gift (vouchers)","",!1,!0);for(let i=0;i<d.length;i++)u.Contains(d[i].costcenterid.toString())&&(e.AddRow(d[i].DocumentName.toString()+"-Starting No",d[i].Prefix.toString()+d[i].MinNumber.toString(),!1,!1),e.AddRow(d[i].DocumentName.toString()+"-Ending No",d[i].Prefix.toString()+d[i].MAXNumber.toString(),!1,!1),""!=d[i].cnt.toString()&&(g+=parseInt(d[i].cnt.toString())));if(o.Amount=g,t.Tables.length>9&&t.Tables[9].length>0)for(let i=0;i<l.length;i++){let n=e.Parent.ScreenObject.ColumnSource.filter(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=n&&(o=e.AddRow(n.Header,t.Tables[9][0][i].toString(),"FLOAT"==n.DataType,!1))}}e.AddRow("","",!1,!1),g=0,o=e.AddRow("Return(vouchers)","",!1,!0),d=t.Tables[1].filter(i=>39==i.documenttype);for(let i=0;i<d.length;i++)e.AddRow(d[i].DocumentName.toString()+"-Starting No",d[i].Prefix.toString()+d[i].MinNumber.toString(),!1,!1),e.AddRow(d[i].DocumentName.toString()+"-Ending No",d[i].Prefix.toString()+d[i].MAXNumber.toString(),!1,!1),""!=d[i].cnt.toString()&&(g+=parseInt(d[i].cnt.toString()));if(o.Amount=g,t.Tables.length>4&&t.Tables[4].length>0)for(let i=0;i<l.length;i++){let n=e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase());null!=n&&(o=e.AddRow(n.Header,t.Tables[4][0][i].toString(),"FLOAT"==n.DataType,!1))}if(e.AddRow("","",!1,!1),e.Parent.ScreenObject.Preferences.ContainsKey("POSFields")&&""!=e.Parent.ScreenObject.Preferences.POSFields)for(let i=0;i<l.length;i++)if(null==e.Parent.ScreenObject.ColumnSource.find(a=>a.DisplayMember.toLowerCase()==l[i].toLowerCase())){let a=e.DTPayModes.filter(D=>D.SysColumnName.toLowerCase()==l[i].toLowerCase());if(a.length>0){e.AddRow(a[0].Name.toString(),"",!1,!0),a[0].Name="  "+a[0].Name;let m,D=0;if("5"==a[0].Type.toString()){if(t.Tables.length>2&&t.Tables[2].length>0&&t.Columns[2].Contains("Amount"))for(let C=0;C<t.Tables[2].length;C++)o="300"==t.Tables[2][C].RefCCID.toString()?e.AddRow("  Opening "+a[0].Name.toString(),t.Tables[2][C].Amount.toString(),!0,!1):e.AddRow(a[0].Name.toString()+" IN",t.Tables[2][C].Amount.toString(),!0,!1),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString(),""!=t.Tables[2][C].Amount.toString()&&(!e.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")||""==e.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode||!(0,p.yG0)(e.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)||"300"!=t.Tables[2][C].RefCCID.toString())&&(D+=parseFloat(t.Tables[2][C].Amount.toString()));t.Tables.length>3&&t.Tables[3].length>0&&t.Columns[3].Contains("Amount")&&""!=t.Tables[3][0].Amount.toString()&&(o=e.AddRow(a[0].Name.toString()+" OUT",t.Tables[3][0].Amount.toString(),!0,!1),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString(),""!=t.Tables[3][0].Amount.toString()&&(D-=parseFloat(t.Tables[3][0].Amount.toString())))}if("5"==a[0].Type.toString()?(m=0,t.Tables[0].length>0&&""!=t.Tables[0][0][t.Columns[0][i]].toString()&&(m+=parseFloat(t.Tables[0][0][t.Columns[0][i]].toString())),t.Tables.length>5&&t.Tables[5].length>0&&""!=t.Tables[5][0][t.Columns[0][0]].toString()&&(m-=parseFloat(t.Tables[5][0][t.Columns[0][0]].toString())),D+=m,o=e.AddRow(a[0].Name.toString()+" Sales",m.toString(),!0,!1),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(o.SysColumnName=l[i],o.PostJV=1)):(o=e.AddRow(a[0].Name.toString(),t.Tables[0].length>0?t.Tables[0][0][t.Columns[0][i]].toString():"0",!0,!1),t.Tables[0].length>0&&""!=t.Tables[0][0][t.Columns[0][i]].toString()&&(D+=parseFloat(t.Tables[0][0][t.Columns[0][i]].toString())),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(o.SysColumnName=l[i],o.PostJV=1)),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString(),t.Tables.length>7&&t.Tables[7].length>0&&""!=t.Tables[7][0][t.Columns[0][i]].toString()&&(o=e.AddRow(a[0].Name.toString()+" Reciept",t.Tables[7][0][t.Columns[0][i]].toString(),!0,!1),D+=parseFloat(t.Tables[7][0][t.Columns[0][i]].toString())),t.Tables.length>8&&t.Tables[8].length>0&&""!=t.Tables[8][0][t.Columns[0][i]].toString()&&(o=e.AddRow(a[0].Name.toString()+" Orders",t.Tables[8][0][t.Columns[0][i]].toString(),!0,!1),D+=parseFloat(t.Tables[8][0][t.Columns[0][i]].toString())),t.Tables.length>9&&t.Tables[9].length>0&&""!=t.Tables[9][0][t.Columns[0][i]].toString()&&(o=e.AddRow(a[0].Name.toString()+" Gift vouchers",t.Tables[9][0][t.Columns[0][i]].toString(),!0,!1),D+=parseFloat(t.Tables[9][0][t.Columns[0][i]].toString())),t.Tables.length>4&&t.Tables[4].length>0&&""!=t.Tables[4][0][t.Columns[0][i]].toString()&&("5"==a[0].Type.toString()?(m=0,""!=t.Tables[4][0][i].toString()&&(m+=parseFloat(t.Tables[4][0][t.Columns[0][i]].toString())),t.Tables.length>6&&t.Tables[6].length>0&&""!=t.Tables[6][0][t.Columns[0][0]].toString()&&(m-=parseFloat(t.Tables[6][0][t.Columns[0][0]].toString())),D-=m,null!=o&&e.DtReportObj.TableColumns.Contains("PostJV")&&"1"==o.PostJV.toString()&&""!=o.AmountActual.toString()&&m>0&&(o.AmountActual=parseFloat(o.AmountActual.toString())-m),o=e.AddRow("  Sales Return",m.toString(),!0,!1)):(null!=o&&e.DtReportObj.TableColumns.Contains("PostJV")&&"1"==o.PostJV.toString()&&""!=o.AmountActual.toString()&&""!=t.Tables[4][0][t.Columns[0][i]].toString()&&(o.AmountActual=parseFloat(o.AmountActual.toString())-parseFloat(t.Tables[4][0][t.Columns[0][i]].toString())),o=e.AddRow("  Sales Return",t.Tables[4][0][t.Columns[0][i]].toString(),!0,!1),D-=parseFloat(t.Tables[4][0][i].toString())),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString()),o=e.AddRow(a[0].Name.toString()+" @Register",S.J0.IsEmpty(a[0].Amount)?"0":a[0].Amount.toString(),!0,!1),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString(),e.DtDiffPosting.Tables.length>0&&e.DtDiffPosting.Columns[0].Contains("Name")){var f=e.DtDiffPosting.Tables[0].filter(C=>C.Name==-o.Type.toString());e.DtReportObj.TableColumns.Contains("PostJV")&&f.length>0&&(o.SysColumnName="RegPOs",o.PostJV=1)}if(D=S.J0.IsEmpty(a[0].Amount)?-D:parseFloat(a[0].Amount.toString())-D,D=parseFloat(D.ToString("N"+s.d.SessionManager.Preferences.DecimalsinAmount)),0!=D&&!e.IsDiff&&(e.IsDiff=!0),o=e.AddRow(a[0].Name.toString()+" Diff",D.toString(),!0,!1),o.SysColumnName=a[0].SysColumnName.toString(),o.Type=a[0].Type.toString(),e.DtDiffPosting.Tables.length>0&&e.DtDiffPosting.Columns[0].Contains("Name")){let C=e.DtDiffPosting.Tables[0].filter(F=>F.Name==o.Type);e.DtReportObj.TableColumns.Contains("PostJV")&&C.length>0&&(o.SysColumnName="DiffPOs",o.PostJV=1)}}else{let D=e.Parent.ScreenObject.Data.Tables[0].filter(m=>m.SysColumnName.toLowerCase()==l[i].toLowerCase());D.length>0&&(t.Tables[0].length>0&&(o=e.AddRow(D[0].ResourceData.toString(),t.Tables[0][0][t.Columns[0][i]].toString(),!1,!1)),e.DtReportObj.TableColumns.Contains("PostJV")&&null!=r&&r.Contains(l[i])&&(o.SysColumnName=l[i],o.PostJV=1))}}if(null!=e.Denom&&null!=e.Denom.GrdDenomination&&null!=e.Denom.GrdDenomination.Table&&e.Denom.GrdDenomination.Table.length>0&&e.Denom.GrdDenomination.TableColumns.Contains("Notes")&&e.Denom.GrdDenomination.TableColumns.Contains("NotesTender")){o=e.AddRow("Denominations","",!1,!0);for(let i=0;i<e.Denom.GrdDenomination.Table.length;i++)!S.J0.IsEmpty(e.Denom.GrdDenomination.Table[i].Notes.toString())&&!S.J0.IsEmpty(e.Denom.GrdDenomination.Table[i].NotesTender.toString())&&(o=e.AddRow(e.Denom.GrdDenomination.Table[i].Notes.toString()+" X "+e.Denom.GrdDenomination.Table[i].NotesTender.toString(),(parseFloat(e.Denom.GrdDenomination.Table[i].Notes.toString())*parseFloat(e.Denom.GrdDenomination.Table[i].NotesTender.toString())).toString(),!1,!1));e.AddRow("Total",e.Denom.GetTotal().toString(),!1,!1)}}e.ExitGrid.Table=e.DtReport,e.ExitGrid.refreshDatawithIDs()})()}AddRow(t,e,f,l){let r=new x.Ji(this.oReport.ReportColumns.length);l&&(r.Cells[0].IsNormal=!1,r.Cells[0].CellAppearance=this.oReport.ReportColumns[0].DataAppearance.Clone(),r.Cells[0].CellAppearance.IsBold=!0,r.Cells[0].IsNormal=!1,r.Cells[1].CellAppearance=this.oReport.ReportColumns[1].DataAppearance.Clone(),r.Cells[1].CellAppearance.IsBold=!0),r.Cells[0].Text=t;let o=0;f?(o=S.J0.DoubleTryParse(e),this.oReport.SetCellValue(o,this.oReport.ReportColumns[1].DataFormat,"FLOAT",r.Cells[1])):r.Cells[1].Text=e,this.oReport.Data.push(r);let g=this.DtReportObj.NewRow();return g.NameWithKey=t,l&&(g.StyleIsBold="1"),f?(g.Amount=r.Cells[1].Text,g.AmountActual=o,t.Contains("Diff")&&(o>0&&(g.Row_Background="GREEN"),o<0&&(g.Row_Background="RED"))):g.Amount=e,this.DtReport.push(g),g}GetJVXML(t,e){if(e.IsValid=!0,!this.DtReportObj.TableColumns.Contains("PostJV"))return"";let l=this.Parent.ScreenObject.GenerateQueryfromList(this.Parent.ScreenObject._CCFields,!0,{message:""},!1,!1);s.d.SessionManager.RegisterCCID>0&&this.Parent.ScreenObject.RegisterNodeID>0&&!l.toString().Contains("dcCCNID"+(s.d.SessionManager.RegisterCCID-5e4).toString()+"=")&&(l+=" dcCCNID"+(s.d.SessionManager.RegisterCCID-5e4).toString()+"="+this.Parent.ScreenObject.RegisterNodeID.toString()+", "),this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn&&s.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(s.d.SessionManager.Preferences.PosShifts)>5e4&&this.Parent.ScreenObject.ShiftNodeID>0&&!l.toString().Contains("dcCCNID"+(parseInt(s.d.SessionManager.Preferences.PosShifts)-5e4).toString()+"=")&&(l+=" dcCCNID"+(parseInt(s.d.SessionManager.Preferences.PosShifts)-5e4).toString()+"="+this.Parent.ScreenObject.ShiftNodeID.toString()+", ");let r,o,h,g="";for(let n=0;n<this.DtReport.length;n++)if("1"==S.J0.StringValue(this.DtReport[n].PostJV)&&!S.J0.IsEmpty(this.DtReport[n].AmountActual)&&(h="DiffPOs"==this.DtReport[n].SysColumnName.toString()?this.DtDiffPosting.Tables[0].filter(a=>a.Name==this.DtReport[n].Type.toString()):"RegPOs"==this.DtReport[n].SysColumnName.toString()?this.DtDiffPosting.Tables[0].filter(a=>a.Name="-"+this.DtReport[n].Type.toString()):this.Parent.ScreenObject.Data.Tables[0].filter(a=>a.SysColumnName==this.DtReport[n].SysColumnName.toString()),h.length>0)){if(r=S.J0.IntTryParse(h[0].DebitAccount.toString()),o=S.J0.IntTryParse(h[0].CreditAccount.toString()),r<=0&&h[0].Table.Columns.Contains("DrRefColID")&&""!=h[0].DrRefColID.toString()&&parseInt(h[0].DrRefColID.toString())>0){let a=this.Parent.ScreenObject._CCFields.find(D=>D.DBColumnName.toLowerCase()==h[0].DRSysColumnName.toString().toLowerCase());null!=a&&a instanceof T.y$&&a.SelectedValue>0&&(r=this.Parent.ScreenObject.GetAccountByRef(parseInt(h[0].DrRefID.toString()),parseInt(h[0].DrRefColID.toString()),a.SelectedValue))}if(o<=0&&h[0].Table.Columns.Contains("CrRefColID")&&""!=h[0].CrRefColID.toString()&&parseInt(h[0].CrRefColID.toString())>0){let a=this.Parent.ScreenObject._CCFields.find(D=>D.DBColumnName.toLowerCase()==h[0].CRSysColumnName.toString().toLowerCase());null!=a&&a instanceof T.y$&&a.SelectedValue>0&&(o=this.Parent.ScreenObject.GetAccountByRef(parseInt(h[0].CrRefID.toString()),parseInt(h[0].CrRefColID.toString()),a.SelectedValue))}if(this.DtReportObj.TableColumns.Contains("DebitAccount")||this.DtReportObj.TableColumns.push("DebitAccount"),this.DtReportObj.TableColumns.Contains("CreditAccount")||this.DtReportObj.TableColumns.push("CreditAccount"),!(r>0))return e.IsValid=!1,this.DisplayMessage="DebitAccount not defined for "+this.DtReport[n].NameWithKey.toString(),this.MessageVisibility=!0,"";if(this.DtReport[n].DebitAccount=r,!(o>0))return e.IsValid=!1,this.DisplayMessage="Credit not defined for "+this.DtReport[n].NameWithKey.toString(),this.MessageVisibility=!0,"";this.DtReport[n].CreditAccount=o,g+=r+",",g+=o+","}g.length>1&&(g=g.Remove(0,g.length));let u=this.Parent.ScreenObject.CheckIsBillWise(g),d=1,i="";for(let n=0;n<this.DtReport.length;n++)"1"==S.J0.StringValue(this.DtReport[n].PostJV)&&S.J0.IsEmpty(this.DtReport[n].AmountActual)&&0!=parseFloat(this.DtReport[n].AmountActual.toString())&&(i+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+d+'" Amount="'+this.DtReport[n].AmountActual.toString().Replace("-","")+'" ',i+=' AmtFc="'+this.DtReport[n].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(this.DtReport[n].AmountActual.toString())>0?i+='DebitAccount="'+this.DtReport[n].DebitAccount.toString()+'" CreditAccount="-99" ></Transactions> ':i+='CreditAccount="'+this.DtReport[n].DebitAccount.toString()+'" DebitAccount="-99" ></Transactions> ',i+=' <Numeric /> <Alpha /> <CostCenters  Query="'+l+'"  /> <EXTRAXML>',null!=u&&u.Tables.length>0&&u.Columns[0].Contains("AccountId")&&(h=u.Tables[0].filter(a=>a.AccountId==this.DtReport[n].DebitAccount.toString()),h.length>0&&"true"==h[0].IsBillwise.toString().toLowerCase()&&(i+='<BillWise> <Row DocSeqNo="'+d+'" AccountID="'+this.DtReport[n].DebitAccount.toString(),i+='" AmountFC="'+this.DtReport[n].AmountActual.toString()+'" AdjAmount="'+this.DtReport[n].AmountActual.toString()+'"',i+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),i+="   </EXTRAXML>  </Row>",d++,i+='<Row><Transactions   DocDetailsID="0"  DocSeqNo="'+d+'" Amount="'+this.DtReport[n].AmountActual.toString().Replace("-","")+'" ',i+=' AmtFc="'+this.DtReport[n].AmountActual.toString().Replace("-","")+'"  CurrencyID="1"  ExchangeRate="1" ',parseFloat(this.DtReport[n].AmountActual.toString())>0?i+='DebitAccount="-99" CreditAccount="'+this.DtReport[n].CreditAccount.toString()+'" ></Transactions> ':i+='CreditAccount="-99" DebitAccount="'+this.DtReport[n].CreditAccount.toString()+'" ></Transactions> ',i+=' <Numeric /> <Alpha /> <CostCenters  Query="'+l+'"  /> <EXTRAXML>',null!=u&&u.Tables.length>0&&u.Columns[0].Contains("AccountId")&&(h=u.Tables[0].filter(a=>a.AccountId==this.DtReport[n].CreditAccount.toString()),h.length>0&&"true"==h[0].IsBillwise.toString().toLowerCase()&&(i+='<BillWise> <Row DocSeqNo="'+d+'" AccountID="'+this.DtReport[n].CreditAccount.toString(),i+='" AmountFC="-'+this.DtReport[n].AmountActual.toString()+'" AdjAmount="-'+this.DtReport[n].AmountActual.toString()+'"',i+=' AdjCurrID="1" AdjExchRT="1" Narration=""  IsDocPDC="0" IsNewReference="1" ></Row></BillWise>')),i+="   </EXTRAXML>  </Row>",d++);return i.length>0&&(i="<DocumentXML>"+i+"</DocumentXML>"),i.toString()}CloseSession(){let t,e,l="",r="";if(this.CloseType>0&&(r+="<XML>",this.DTPayModes.forEach(h=>{r+='<Row Type="'+S.J0.String(h.Type),r+='" SysColName="'+S.J0.String(h.SysColumnName),r+='" Name="'+S.J0.String(h.Name),r+='" Amount="'+S.J0.String(h.Amount)+'" />',"5"==h.Type.toString()&&0!=S.J0.String(h.DenomXML).length&&(this.DenomXML=h.DenomXML.toString())}),r+="</XML>"),1==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"1"==this.Parent.ScreenObject.Preferences.PosJVOn||2==this.CloseType&&this.Parent.ScreenObject.Preferences.ContainsKey("PosJVOn")&&"2"==this.Parent.ScreenObject.Preferences.PosJVOn){let h={IsValid:""};if(l=this.GetJVXML(!0,h),t=h.IsValid,!t)return this.Parent.DisplayMessage=this.DisplayMessage,this.Parent.MessageVisibility=!0,void s.d.page.HideDialog(this.PopUpGUID)}let o=this.Parent.ScreenObject.ShiftNodeID;5==this.CloseType&&this.Shift.Visible&&this.Shift.SelectedValue>0&&(o=this.Shift.SelectedValue),e=s.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,o,this.Parent.DocumentDate,this.CloseType,this.DenomXML,l,r.toString()).obj,(e>0||-100==e)&&(this.DayClose.IsChecked&&this.DayClose.Visible?e=s.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,o,this.Parent.DocumentDate,1,"","","").obj:-100==e&&(confirm("All shifts are closed.Closing the Day.")||s.d.admin.POSLogin(this.Parent.ScreenObject.RegisterNodeID,o,this.Parent.DocumentDate,1,"","","")),this.CloseType>0&&(this.Parent.ScreenObject.Preferences.ContainsKey("DonotConsiderOpeningInPaymode")&&""!=this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode&&(0,p.yG0)(this.Parent.ScreenObject.Preferences.DonotConsiderOpeningInPaymode)&&(this.ExitGrid.SelectedItem=null,this.Denom=new O.AddDenominationViewModel(this,null),this.Denom.Currency.Label="Closing Imprest",s.d.page.ShowDialog(this.Denom,R.AddDenominationComponent)),this.CallPrint(o)),s.d.page.HideDialog(this.PopUpGUID),s.d.page.removeActiveTab())}AddDenom(){this.ExitGrid.SelectedItem.DenomXML=this.Denom.GetXML(),this.ExitGrid.SelectedItem.Amount=this.Denom.GetTotal(),s.d.page.HideDialog(this.PopUpGUID)}CallPrint(t){this.NewPrintCode(t)}ExportFile(t,e,f){this.DisplayMessage="Print"==t?"Printing data please wait...":"Exporting data please wait...";let l={};e.InitPrintOrExport(l),l.Type=t;let r="";r=null!=e.FromDatePicker?e.FromDatePicker.Date.ToString("dd/MMM/yyyy"):this.Parent.DocumentDate.ToString("dd/MMM/yyyy"),l.PrintDataOnSeperatePageBy=s.d.SessionManager.Preferences.ContainsKey("PrintDataOnSeperatePageBy")?s.d.SessionManager.Preferences.PrintDataOnSeperatePageBy:"",l.DimensionFiltersKeys.Clear(),l.DimensionFiltersValues.Clear(),l.DimensionFiltersKeys.push(s.d.SessionManager.RegisterCCID),l.DimensionFiltersValues.push(this.Parent.ScreenObject.RegisterNodeID.toString()),s.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(s.d.SessionManager.Preferences.PosShifts)>5e4&&(l.DimensionFiltersKeys.push(s.d.SessionManager.Preferences.PosShifts),l.DimensionFiltersValues.push(f.toString())),s.d.SessionManager.DivisionID>0&&(l.DimensionFiltersKeys.push(50001),l.DimensionFiltersValues.push(s.d.SessionManager.DivisionID.toString())),s.d.SessionManager.LocationID>0&&(l.DimensionFiltersKeys.push(50002),l.DimensionFiltersValues.push(s.d.SessionManager.LocationID.toString())),"PDF"==t?l.lst=[]:"Print"==t?(l.lst=[],l.Type="PDF"):("Excel"==t||"OpenXML"==t)&&(l.lst=[]),l.al="al",s.d.report.ExportReport(e.Data,e.ReportColumns,l,"POSEXIT",[],[],r).subscribe(o=>{"Print"==t?s.d.SessionManager.printTab(o.FileName):(s.d.SessionManager.Download(o.FileName,o.FileName),S.J0.IsEmpty(o.Message)&&!S.J0.IsEmpty(o.FileName)&&(this.DisplayMessage="Exported Successfully"))},o=>{console.log(o)})}NewPrintCode(t){let e="<XML><Row ColID='FROMDATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>";e+="<Row ColID='TODATE' Value='"+this.Parent.DocumentDate.ToString("dd MMM yyyy")+"'/>",e+="<Row ColID='"+s.d.SessionManager.RegisterCCID+"' Value='"+this.Parent.ScreenObject.RegisterNodeID+"'/>",this.Parent.ScreenObject.LocationID>0&&(e+="<Row ColID='50002' Value='"+this.Parent.ScreenObject.LocationID+"'/>"),s.d.SessionManager.Preferences.PosShifts.length>0&&parseInt(s.d.SessionManager.Preferences.PosShifts)>5e4&&t>0&&(e+="<Row ColID='"+s.d.SessionManager.Preferences.PosShifts+"' Value='"+t+"'/>"),e+="</XML>";let f=new L.ReportViewModel;return f.RecordCount="",f.PostFilterData=[],f.ReportSummaryData=[],f.ReportSummaryDataColumns=[],f.ReportViewModel_Document(50,e,190,!0,this,null),this.ExportFile("Print",f,t),""}GetReportDataTable(){let e=[];return this.ExitGrid.Table.forEach(f=>{let l={};l.RegID=this.Parent.ScreenObject.RegisterNodeID,l.RegName=this.Parent.ScreenObject.RegisterNodeID.toString(),l.Name=f.NameWithKey,l.StyleIsBold=f.StyleIsBold,l.Value=l[this.Parent.DocumentDate.ToString("ddMMMyyyy")]=f.Amount.toString(),e.push(l)}),e.length>0&&(e[0].CloseType=3==this.CloseType?"UserClose":2==this.CloseType?"ShiftClose":"DAY CLOSE"),e}OnPreviewKeyDown(t){if(this.IsPayMode)if(112==t.keyCode)this.IsPayMode&&(null!=this.ExitGrid.SelectedItem&&"5"==this.ExitGrid.SelectedItem.Type.toString()?(this.Denom.Currency.Label="Cash Collection",this.Denom=new O.AddDenominationViewModel(this,this.ExitGrid.SelectedItem.DenomXML.toString()),s.d.page.ShowDialog(this.Denom,R.AddDenominationComponent)):this.ExitGrid.Table.forEach(e=>{"5"==e.Type.toString()&&(this.ExitGrid.SelectedItem=e,this.Denom.Currency.Label="Cash Collection",this.Denom=new O.AddDenominationViewModel(this,this.ExitGrid.SelectedItem.DenomXML.toString()),s.d.page.ShowDialog(this.Denom,R.AddDenominationComponent))}));else if(t.keyCode>=91&&t.keyCode<=101){let e=t.keyCode-91;e<this.ExitGrid.Table.length&&(this.ExitGrid.ColumnNo=1,this.ExitGrid.LineNo=e+1,this.ExitGrid.SetFocusongrid=!0)}}}}}]);