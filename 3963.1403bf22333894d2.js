"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3963],{3963:(L,S,l)=>{l.r(S),l.d(S,{AddCurrencyViewModel:()=>f,DeletedRecords:()=>y});var n=l(86739),s=l(8787),u=l(81669),h=l(18569),D=l(36466),p=l(98669),o=l(92701),C=l(23823),g=l(52886),x=l(49710),I=l(32026),m=l(24028);class d extends C.g{constructor(t){super(),this.SaveNote=new u.Yk,this.Enable=!1,this.NoteID=0,this.NoteText="",this.CurrencyTypes=[],this.Index=0,this.ClassName="AddExchViewModel",Logger.InfoLog("AddExchViewModel::Entering AddExchViewModel with Parent="+t),this.Parent=t,this.CurrencyTypes=[],this.SaveNote.Subscribe(this,"OnSaveExchRate","onCanSaveOnSaveExchRate"),this.ExchDate=new m.Lc(0),this.ExchDate.Date=Date.Today(),this.ExchDate.Label="Date",this.ExchDate.DBColumnName="ExchDate",Logger.InfoLog("AddExchViewModel::Exiting AddExchViewModel")}OnSaveExchRate(t){if(null==t||"Cancel"!=t.toString()){if(Logger.InfoLog("AddExchViewModel::Entering OnSaveExchRate"),null==this.SelectedItem)return void alert("Please set Daily exchange rate for this currency");if(0==this.ExchRate.Trim().length||null==this.SelectedItem.Name||""==this.SelectedItem.Name)return;if(!this.Parent.ViewExhangeRates.ExchList.Contains(this)){let e=0;for(let i=0;i<this.Parent.ViewExhangeRates.ExchList.length;i++)if(!s.J0.IsEmpty(this.Parent.ViewExhangeRates.ExchList[i].SelectedItem)&&!s.J0.IsEmpty(this.Parent.ViewExhangeRates.ExchList[i].ExchDate)&&this.Parent.ViewExhangeRates.ExchList[i].SelectedItem.Name==this.SelectedItem.Name&&this.Parent.ViewExhangeRates.ExchList[i].ExchDate.Date==this.ExchDate.Date&&(e++,this.Index=i,!confirm("Exchange rate already exists for this date, do you want to overwrite?")))return;if(0==e){this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let i=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Sno=i+1,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Text=this.ExchDate.Date,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].ExchDate=this.ExchDate.Date.ToString(n.d.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].ExchRate=this.ExchRate,this.Parent.ViewExhangeRates.ExchListDataTable.updateRow(this.Parent.ViewExhangeRates.ExchListDataTable.Table[i])}let a=this.Parent.Exch.SelectedCurrencyType;this.Parent.OnAddExchangeRate(),this.Parent.Exch.SelectedCurrencyType=a,Logger.InfoLog("AddExchViewModel::Exiting OnSaveExchRate")}}}onCanSaveOnSaveExchRate(t){return!0}OnDeleteCallBack(){this.Parent.ViewExhangeRates.ExchList.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.Table.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let t=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[t].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[t].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[t].Text=s.J0.ParseDate(this.ExchDate.Date),this.Parent.ViewExhangeRates.ExchListDataTable.Table[t].ExchDate=s.J0.ParseDate(this.ExchDate.Date).ToString(n.d.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[t].ExchRate=this.ExchRate}}var T=l(31820);class w extends C.g{get angularGrid(){return this.ExchListDataTable.angularGrid}constructor(t){let e;super(),this.ColumnSpan="4",this.SelectionChangedCommandAssign=new u.Yk,this.Currency=[],this.FromDate=new m.Lc(0),this.Todate=new m.Lc(0),this.contextVisible=!0,this.ShowNewExchange=new u.Yk,this.ButtonClick=new u.Yk,this.ExchListDataTable=new x.vv,this.TempExchListDataTable=[],this.ExchList=[],this.ColumnSource=new Array,this.DeletedNotes=[],this.ButtonAdd=new D.v,this.ButtonUpdate=new D.v,this.ButtonDelete=new D.v,this.Module="ACC",this.cmnItem_Click=new u.Yk,this.ClassName="ViewExchangeRateViewModel",Logger.InfoLog("ViewExchangeRateViewModel::Entering ViewExchangeRateViewModel with Parent="+t),this.Parent=t,this.FromDate.Label=n.d.GetResource("Calender_FromDate"),this.Todate.Label=n.d.GetResource("Calender_ToDate"),this.SelectionChangedCommandAssign.Subscribe(this,"onSelectionChangedAssign"),this.Currency=[],!this.ButtonUpdate.Visible&&!this.ButtonDelete.Visible&&(this.contextVisible=!1),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click","onCanCmnItem_Click"),this.ShowNewExchange.Subscribe(this,"OnShowNewExchange"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExchListDataTable.Table=[],this.ExchListDataTable.TableColumns.push("Sno"),this.ExchListDataTable.TableColumns.push("SelectedCurrencyType"),this.ExchListDataTable.TableColumns.push("Name"),this.ExchListDataTable.TableColumns.push("Text"),this.ExchListDataTable.DataTypes.Date.push("Text"),this.ExchListDataTable.TableColumns.push("ExchDate"),this.ExchListDataTable.TableColumns.push("ExchRate"),e=new h.O7,e.Header=n.d.GetResource("Currency_CurrencyName"),e.DisplayMember="Name",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=250,this.ColumnSource.push(e),e=new h.O7,e.Header=n.d.GetResource("Exch_Date"),e.DisplayMember="ExchDate",e.ReadOnly=!0,e.DataType="TextBlock",e.Width=250,this.ColumnSource.push(e),e=new h.O7,e.Header=n.d.GetResource("Currency_ExchangeRate"),e.DisplayMember="ExchRate",e.DataType="TextBlock",e.Width=250,e.ReadOnly=!0,this.ColumnSource.push(e),this.ExchListDataTable.Columns=this.ColumnSource,this.ExchListDataTable.ContextMenuClickSubject.subscribe(i=>{this.OnCmnItem_Click(i.item.Tag)}),this.ExchListDataTable.ContextMenu.Items=[];let a=new h.Dr;a.Header="EDIT",a.Tag="EDIT",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),a=new h.Dr,a.Header="DELETE",a.Tag="DELETE",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),Logger.InfoLog("ViewExchangeRateViewModel::Exiting ViewExchangeRateViewModel ")}onSelectionChangedAssign(t){for(let e=0;e<this.ExchList.length;e++)this.ExchListDataTable.addEmptyRow(),this.ExchListDataTable.Table[e].SelectedCurrencyType=this.ExchList[e].SelectedCurrencyType,this.ExchListDataTable.Table[e].Name=this.ExchList[e].SelectedItem.Name,this.ExchListDataTable.Table[e].Text=this.ExchList[e].ExchDate.Date,this.ExchListDataTable.Table[e].ExchDate=this.ExchList[e].ExchDate.Date.ToString(n.d.SessionManager.Preferences["Date Format"]),this.ExchListDataTable.Table[e].ExchRate=this.ExchList[e].ExchRate}OnCmnItem_Click(t){Logger.InfoLog("ViewExchangeRateViewModel::Entering OnCmnItem_Click with Command="+t),this.SelectedNote=null;let e=this.angularGrid.slickGrid.getSelectedRows();if(e.length>0){switch(this.SelectedNote=this.ExchListDataTable.Table[e[0]],t){case"EDIT":null!=this.SelectedNote&&(this.Parent.ExchangeVisibility=!0,this.Parent.Exch.SelectedCurrencyType=this.SelectedNote[this.ExchListDataTable.TableColumns[1]],s.J0.isValidDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])&&(this.Parent.Exch.ExchDate.Date=s.J0.ParseDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])),this.Parent.Exch.ExchRate=this.SelectedNote[this.ExchListDataTable.TableColumns[5]]);break;case"DELETE":null!=this.SelectedNote&&this.ExchListDataTable.removeRow(this.SelectedNote)}Logger.InfoLog("ViewExchangeRateViewModel::Exiting OnCmnItem_Click")}}onCanCmnItem_Click(t){return!0}GetXML(){Logger.InfoLog("ViewExchangeRateViewModel::Entering GetXML");let t="";for(let e=0;e<this.ExchList.length;e++)null!=this.ExchList[e].SelectedItem&&(t+='<Row Action="NEW"',t+=' CurrencyID="'+this.ExchList[e].SelectedCurrencyType+'"',t+=' Currency="'+T.Dw.GetValidXml(this.ExchList[e].SelectedItem.Name)+'"',t+=' ExchDate="'+s.J0.ParseDate(T.Dw.GetValidXml(this.ExchList[e].ExchDate.Date.toString())).ToString("dd/MMM/yyyy")+'"',t+=' ExchRate="'+T.Dw.GetValidXml(this.ExchList[e].ExchRate)+'"',t+="/>");for(let e=0;e<this.DeletedNotes.length;e++)t+='<Row Action="DELETE"',t+=' CurrencyID="'+this.DeletedNotes[e].SelectedCurrencyType+'"/>';return t.length>0&&(t="<ExchXML>"+t+"</ExchXML>"),Logger.InfoLog("ViewExchangeRateViewModel::Exiting GetXML which returns XML="+t),t.Replace("&","&amp;"),t.toString()}OnShowNewExchange(t){Logger.InfoLog("ViewExhangeRateViewModel::Entering OnShowNewExchange");try{this.ButtonAdd.Enable&&this.ButtonAdd.Visible&&(this.Parent.Exch=new d(this.Parent),this.Parent.ExchangeVisibility=!0,this.Parent.OnShowExchangeRate()),Logger.InfoLog("ViewExhangeRateViewModel::Exiting OnShowNewExchange")}catch(e){Logger.ErrorLog("AddProductViewModel:: OnShowNewExchange"+e.stack)}}OnButtonClick(t){"Refresh"==t&&(this.ExchListDataTable.Table=this.Parent.DataTable.length>this.Parent.SelectedNode?this.TempExchListDataTable.filter(e=>e.SelectedCurrencyType==this.Parent.DataTable[this.Parent.SelectedNode].CurrencyID.toString()&&e.Text>=this.FromDate.Date&&e.Text<=this.Todate.Date):this.TempExchListDataTable)}Animate(){}LoadExchRates(t){Logger.InfoLog("ViewExchangeRateViewModel::Entering LoadExchRates with TableData="+t),this.ExchListDataTable.Clear(),this.ExchList.Clear();for(let a=0;a<t.length;a++){if("0"==s.J0.StringValue(t[a].ED))continue;let i=new d(this.Parent);var e=this.Parent.Exch.CurrencyTypes.find(c=>c.Name==t[a].Name.toString());null!=e&&(i.SelectedItem=e),i.NoteID=a+1,i.SelectedCurrencyType=t[a].CurrencyID.toString(),i.ExchDate.Date=s.J0.ParseDate(t[a].ExchangeDate.toString().split(" ")[0]),i.ExchDate.Text=s.J0.ParseDate(t[a].ExchangeDate).ToString(n.d.SessionManager.Preferences["Date Format"]),i.ExchRate=t[a].ExchangeRate.toString(),this.ExchList.push(i);let r=this.ExchListDataTable.NewRow();r.Sno=a+1,r.SelectedCurrencyType=t[a].CurrencyID.toString(),r.Name=t[a].Name.toString(),r.Text=s.J0.ParseDate(t[a].ExchangeDate),r.ExchDate=s.J0.ParseDate(t[a].ExchangeDate).ToString(n.d.SessionManager.Preferences["Date Format"]),r.ExchRate=t[a].ExchangeRate.toString(),this.ExchListDataTable.addRow(r)}this.TempExchListDataTable=this.ExchListDataTable.Table.Copy(),Logger.InfoLog("ViewExchangeRateViewModel::Exiting LoadExchRates")}OnDeleteCallBack(){null!=this.SelectedNote&&null!=this.SelectedNote[0]&&""!=this.SelectedNote[0].toString()&&parseInt(this.SelectedNote[0].toString())>0&&(this.id=parseInt(this.SelectedNote[0].toString()),this.DeletedNotes.push(this.ExchList[this.id-1])),this.ExchList.length>=this.id&&(this.ExchList.RemoveAt(this.id-1),this.ExchListDataTable.Table.RemoveAt(this.id-1))}}var R=l(33547);class y{constructor(t){this.iSeqno=0,this.iSeqno=t}}class f extends C.g{OnCmnItem_Click(t){Logger.InfoLog("AddCurrencyViewModel::Entering OnCmnItem_Click"),this.DataTable.length<1&&(this.DisplayMessage=n.d.GetResource("Cur_NO"),this.MessageVisibility=!0);let e=null,a=this.angularGrid.slickGrid.getSelectedRows();a.length>0&&(e=this.DataTable[a[0]],this.SelectedNode<this.DataTable.length&&"DELETE"===t&&confirm(n.d.GetResource("DeleteMessage"))&&(this.lstDeletedRecords.push(new y(parseInt(e[Object.keys(e)[1]]))),this.DataTableObj.removeRow(e)),Logger.InfoLog("AddCurrencyViewModel::Exiting OnCmnItem_Click"))}onCanCmnItem_Click(t){return!0}get SelectedNode(){return this._SelectedNode}set SelectedNode(t){t!=this._SelectedNode&&(this._SelectedNode=t,this.ViewExhangeRates.SelectedCurrencyText=this._SelectedNode>=0&&this.DataTable.length>this._SelectedNode?this.DataTable[this._SelectedNode].Name.toString():"")}get CurrencyName(){return this._CurrencyName}set CurrencyName(t){t!=this._CurrencyName&&(this.CurrencyCombo.SelectedValue=t,this._CurrencyName=t)}get angularGrid(){return this.DataTableObj.angularGrid}get DataTable(){return this.DataTableObj.Table}get DataTableColumns(){return this.DataTableObj.TableColumns}get NumericColumnSource(){return this._NumericColumnSource}get NumericdDt(){return this._NumericdDt}constructor(){super(),this.CustomTab=new g.Z,this.TabIndex=new g.O,this.SelectedItem=new u.Yk,this.lstDeletedRecords=[],this.CurrencyTypes=[],this.Currency=[],this.CurrencyCombo=new o.y$,this.Dim=new p.y$(0),this._GUID="",this.DataTableObj=new x.vv,this.ButtonAdd=new D.v,this.ButtonUpdate=new D.v,this.ButtonDelete=new D.v,this._NumericColumnSource=[],this.DynamicCommand=new u.Yk,this.SaveCurrency=new u.Yk,this.RowDelete=new u.Yk,this.cmnItem_Click=new u.Yk,this.ExTable=[],this.CurrLookup=null,this.Module="ACC",this.selectedCurrencyID="",this.SNO=1,this.PACTControlData=[],this.ClassName="AddCurrencyViewModel",this.lblExchangeRate=n.d.GetResource("Currency_ExchangeRate"),this.lblDecimals=n.d.GetResource("Currency_Decimals"),this.lblIsBaseCurrency=n.d.GetResource("Currency_IsBaseCurrency"),this.lblTitle=n.d.GetResource("Currency_Title"),this.lblHeader=n.d.GetResource("Currency_GroupHeader"),Logger.InfoLog("AddCurrencyViewModel::Entering AddCurrencyViewModel"),this.DataTableObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.DataTableObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.DataTableObj.RowSelectionChange.Subscribe(this,"OnSelectedItem"),this.ViewExhangeRates=new w(this),this.Exch=new d(this),n.d.SessionManager.HideUnathorizedAccess?this.ButtonAdd.Visible=n.d.SessionManager.IsActionAssigned(12,"Create"):this.ButtonAdd.Enable=n.d.SessionManager.IsActionAssigned(12,"Create"),n.d.SessionManager.HideUnathorizedAccess?this.ButtonUpdate.Visible=n.d.SessionManager.IsActionAssigned(12,"Update"):this.ButtonUpdate.Enable=n.d.SessionManager.IsActionAssigned(12,"Update"),n.d.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=n.d.SessionManager.IsActionAssigned(12,"Delete"):this.ButtonDelete.Enable=n.d.SessionManager.IsActionAssigned(12,"Delete"),this._ScreenID="12",this.PactScreenID="12",this.worker_DoWork(null,null),this.worker_RunWorkerCompleted(null,null),this.BuildGridData(),this.BindCurrencies(1),this.MessageVisibility=!1,this.DisplayMessage="Currency",this._ScreenID="12",this.PactScreenID="12",this.DataTableObj.TableNewRow.Subscribe(this,"onAddRow"),this.DataTableObj.RowDeleted.Subscribe(this,"onDeleteRow"),this.DataTableObj.CanUserDeleteRows=!0,this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),this.SaveCurrency.Subscribe(this,"OnSaveCurrency, onCanSaveCurrency"),this.AddTabDetails(),this.CurrencyTypes=this.Exch.CurrencyTypes,this.Currency=this.ViewExhangeRates.Currency,this.ExchangeVisibility=!0,this.DataTable.length>0&&""!=this.DataTable[0].CurrencyID.toString()&&(this.SelectedNode=0,this.ViewExhangeRates.SelectedCurrencyText=this.DataTable[0].Name.toString(),this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(e=>e.SelectedCurrencyType==this.DataTable[0].CurrencyID.toString()&&e.Text>=this.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&e.Text<=this.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")));let t=0;t=s.J0.IntTryParse(n.d.SessionManager.Preferences.DimensionwiseCurrency),t>5e4?(this.Dim.Visible=!0,this.Dim.CCID=t,this.Dim.TypeID=1,this.Dim.OnPactListBoxValueChanged.Subscribe(this,"OnvalueChanged")):this.Dim.Visible=!1,this.CurrencyCombo.SelectionChangedCommand.Subscribe(this,"OnCurrencyComboChange"),Logger.InfoLog("AddCurrencyViewModel::Exiting AddCurrencyViewModel")}OnCurrencyComboChange(t){if(null!=this.CurrLookup)if(s.J0.IsEmpty(t))this.Symbol="",this.Change="";else{let e=this.CurrLookup.filter(a=>a.Name==t.SelectedValue);e.length>0?(this.Symbol=e[0].Code.toString(),this.Change=e[0].Change.toString()):(this.Symbol="",this.Change="")}}OnvalueChanged(t){this.DisplayMessage="",this.MessageVisibility=!1,this.Dim.SelectedValue>0?this.BindCurrencies(this.Dim.SelectedValue):(this.DataTableObj.Clear(),this._CurrencyID=0,this.BaseCurr=0,this.CurrencyName="",this.Symbol="",this.Change="",this.ExTable.Rows.Clear())}AddCurrencyDetails(){this.ViewExhangeRates.Currency.Clear(),this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2("All","-100")),this.Exch.CurrencyTypes.Clear();for(let t=0;t<this.DataTable.length;t++)null!=this.DataTable[t].IsDailyRates&&""!=this.DataTable[t].IsDailyRates.toString()&&"true"==this.DataTable[t].IsDailyRates.toString().toLowerCase()&&(this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(this.DataTable[t].Name.toString(),this.DataTable[t].CurrencyID.toString())),this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2(this.DataTable[t].Name.toString(),this.DataTable[t].CurrencyID.toString())))}OnSelectedItem(t){try{let a=t.Row;if(this.SelectedNode=t.RowIndex,"DataGridComboBoxColumn"==t.column.className)return;if(null!=a){this.Exch.SelectedCurrencyType=a.CurrencyID.toString(),this.selectedCurrencyID=this.Exch.SelectedCurrencyType;var e=this.Exch.CurrencyTypes.find(i=>i.Name==a.Name.toString());null!=e&&(this.Exch.SelectedItem=e),s.J0.IsEmpty(a.CurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(i=>i.SelectedCurrencyType==a.CurrencyID&&i.Text>=this.ViewExhangeRates.FromDate.Date&&i.Text<=this.ViewExhangeRates.Todate.Date))}}catch{}}OnCellEditEnding(t){let e=t.item;if(null!=e&&"StatusID"==t.column.field)null!=e.IsDailyRates&&""!=e.IsDailyRates.toString()&&"true"==e.IsDailyRates.toString().toLowerCase()&&(0==this.Exch.CurrencyTypes.filter(a=>a.Name==e.Name.toString()).length&&(""!=e.CurrencyID.toString()?(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString())),this.Exch.SelectedCurrencyType=e.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(a=>a.Value==e.CurrencyID)):(e.CurrencyID=0==this.Exch.CurrencyTypes.length?-1:parseInt(2)-1,this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString())),this.Exch.SelectedCurrencyType=e.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(a=>a.Value==e.CurrencyID))),0==this.ViewExhangeRates.Currency.filter(a=>a.Name==e.Name.toString()).length&&this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString())));else if(null!=e&&"Symbol"==t.column.field){let a=0;for(let i=0;i<this.DataTable.length;i++)s.J0.IsEmpty(this.DataTable[i].Name)||this.DataTable[i].Name.toString().toLowerCase()==e.Name.toString().toLowerCase()&&a++;if(a>1&&(this.DisplayMessage="Duplicate Currency Name",e.Name=""),""!=e.Name.toString()){e.StatusID="true";let i=this.DataTable.Compute("max","CurrencyID");null!=i&&null!=i&&(e.CurrencyID=parseInt(i)+1)}else e.IsDailyRates="",e.StatusID="";if(this.CurrencyCombo.Visible)if(""!=s.J0.String(e.Name)){let i=this.CurrLookup.filter(r=>r.Name==e.Name.toString());i.length>0?(e.Symbol=s.J0.String(i[0].Code),e.Change=s.J0.String(i[0].Change)):(e.Symbol="",e.Change="")}else e.Symbol="",e.Change="";this.DataTableObj.updateRow(e)}else if(null!=e&&"Change"==t.column.field){let a=0;for(let i=0;i<this.DataTable.length;i++)s.J0.IsEmpty(this.DataTable[i].Symbol)||this.DataTable[i].Symbol.toString().toLowerCase()==e.Symbol.toString().toLowerCase()&&a++;a>1&&(this.DisplayMessage="Duplicate Currency Symbol",e.Symbol="")}else if(null!=e&&"Decimals"==t.column.field){let a=0;a=s.J0.DoubleTryParse(e.ExchangeRate),a<=0&&(this.DisplayMessage="Invalid Exchange Rate")}else if(null!=e&&"IsDailyRates"==t.column.field){let a=0;a=s.J0.DoubleTryParse(e.Decimals),a<=0&&(this.DisplayMessage="Invalid Decimals"),s.J0.IsEmpty(e.CurrencyID)||(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(e.Name.toString(),e.CurrencyID.toString())),this.Exch.SelectedCurrencyType=e.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(i=>i.Value==e.CurrencyID))}}onBeginEdit(t){let i=this.DataTableObj.Table.indexOf(t.args.item);if(i=-1==i||1==this.DataTableObj.Table.length||0==this.DataTableObj.Table.length||this.DataTableObj.Table.length-i<=1?1:0,this.DataTableObj.CanUserAddRows)for(let r=0;r<i;r++){let c=this.DataTableObj.NewRow();this.DataTableObj.addRow(c)}}AddTabDetails(){let t;t=new g.O,t.Name="Exchange Rate",t.Header=n.d.GetResource("Currency_ExchangeRate"),this.CustomTab.Pages.push(t),this.CustomTab.SelectedTab=t,this.CustomTab.Pages[0].Fields.push(this.ViewExhangeRates),t=new g.O,t.Name="Denomination",t.Header=t.Header=n.d.GetResource("Denomination"),this.CustomTab.Pages.push(t);let a=new I.AddDenominationViewModel(this);this.CustomTab.Pages[1].Fields.push(a)}BuildGridData(){this._NumericColumnSource=[];let t=new h.O7;t.Header=n.d.GetResource("UOM_Sno"),t.DisplayMember="SNO",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=50,t.IsFrozen=!0,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Currency_GridName"),t.DisplayMember="Name",null==this.CurrLookup?t.DataType="TextBlock":(t.ValueBinding="Name",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Name",t.ComboData=this.CurrLookup),t.Width=200,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Currency_GridSymbol"),t.DisplayMember="Symbol",t.DataType="TextBlock",t.ReadOnly=null!=this.CurrLookup,t.Width=80,t.IsFrozen=!0,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Currency_GridChange"),t.DisplayMember="Change",t.DataType="TextBlock",t.ReadOnly=null!=this.CurrLookup,t.Width=150,t.IsFrozen=!0,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Currency_GridExchangeRate"),t.DisplayMember="ExchangeRate",t.DataType="FLOAT",t.Width=100,t.IsFrozen=!0,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Currency_GridDecimals"),t.DisplayMember="Decimals",t.DataType="TextBlock",t.Width=100,t.IsFrozen=!0,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Reports_LblDaily"),t.ValueBinding="IsDailyRates",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let e=[];e.push(o._p.ComboBoxItems_2(n.d.GetResource("Vehicle_Yes"),"true")),e.push(o._p.ComboBoxItems_2(n.d.GetResource("Vehicle_No"),"false")),t.ComboData=e,this.NumericColumnSource.push(t),t=new h.O7,t.Header=n.d.GetResource("Document_Status"),t.ValueBinding="StatusID",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let a=[];a.push(o._p.ComboBoxItems_2(n.d.GetResource("RevenUReport_Active"),"true")),a.push(o._p.ComboBoxItems_2(n.d.GetResource("Attributes_Inactive"),"false")),t.ComboData=a,this.NumericColumnSource.push(t),t=new h.O7,t.Header="IsDivide",t.ValueBinding="IsDivide",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100,a=[],a.push(o._p.ComboBoxItems_2("Yes","True")),a.push(o._p.ComboBoxItems_2("No","False")),t.ComboData=a,t.IsVisible=!(!n.d.SessionManager.Preferences.ContainsKey("DivideCurrency")||"true"!=n.d.SessionManager.Preferences.DivideCurrency.toLowerCase()),this.NumericColumnSource.push(t),this.DataTableObj.Table=[],this.DataTableObj.CanUserAddRows=!0,this.DataTableColumns.push("CurrencyID"),this.DataTableColumns.push("SNO"),this.DataTableColumns.push("Name"),this.DataTableColumns.push("Symbol"),this.DataTableColumns.push("Change"),this.DataTableColumns.push("ExchangeRate"),this.DataTableObj.DataTypes.Double.push("ExchangeRate"),this.DataTableColumns.push("Decimals"),this.DataTableColumns.push("IsDailyRates"),this.DataTableColumns.push("StatusID"),this.DataTableColumns.push("GUID"),this.DataTableColumns.push("IsDivide"),this.DataTableObj.Columns=this.NumericColumnSource,this.DataTableObj.ContextMenuClickSubject.subscribe(r=>{this.OnCmnItem_Click(r.item.Tag)}),this.DataTableObj.ContextMenu.Items=[];let i=new h.Dr;i.Header="DELETE",i.Tag="DELETE",i.Visibility=!0,this.DataTableObj.ContextMenu.Items.push(i)}onAddRow(t,e){this.UpdateSequence()}onDeleteRow(t,e){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.DataTableObj.Table.forEach(t=>{t.SNO=this.SNO++})}GetCurrencyXMl(){let t="";if(null!=this.DataTable&&this.DataTable.length>0){t+="<XML>";for(let e=0;e<this.DataTable.length;e++)!s.J0.IsEmpty(this.DataTable[e].Name)&&!s.J0.IsEmpty(this.DataTable[e].ExchangeRate)&&(s.J0.IsEmpty(this.DataTable[e][this.DataTableColumns[0]])?t+="<Row CurrencyID='0' Name='"+s.J0.String(this.DataTable[e][this.DataTableColumns[2]])+"' Symbol='"+s.J0.String(this.DataTable[e][this.DataTableColumns[3]])+"' Change='"+s.J0.String(this.DataTable[e][this.DataTableColumns[4]])+"' ExchangeRate='"+s.J0.String(this.DataTable[e][this.DataTableColumns[5]])+"' Decimals='"+s.J0.String(this.DataTable[e][this.DataTableColumns[6]])+"' Daily='"+s.J0.String(this.DataTable[e][this.DataTableColumns[7]])+"'  StatusID='"+s.J0.String(this.DataTable[e][this.DataTableColumns[8]])+"' IsDivide='"+s.J0.String(this.DataTable[e].IsDivide)+"' GUID='"+s.J0.String(this.DataTable[e].GUID)+"' Action='Insert'/>":parseInt(this.DataTable[e][this.DataTableColumns[0]])>0?parseInt(this.DataTable[e][this.DataTableColumns[0]])==this.BaseCurr?(t+="<Row CurrencyID='"+this.DataTable[e][this.DataTableColumns[0]].toString()+"' Name='"+s.J0.String(this.DataTable[e][this.DataTableColumns[2]])+"' Symbol='"+s.J0.String(this.DataTable[e][this.DataTableColumns[3]])+"' Change='"+s.J0.String(this.DataTable[e][this.DataTableColumns[4]])+"' ExchangeRate='"+s.J0.String(this.DataTable[e][this.DataTableColumns[5]])+"' Decimals='"+s.J0.String(this.DataTable[e][this.DataTableColumns[6]])+"' Daily='"+s.J0.String(this.DataTable[e][this.DataTableColumns[7]])+"'  StatusID='"+s.J0.String(this.DataTable[e][this.DataTableColumns[8]])+"' IsDivide='"+s.J0.String(this.DataTable[e].IsDivide)+"'  GUID='"+s.J0.String(this.DataTable[e].GUID)+"'   Action='Update'/>",t+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+Symbol+"' Change='"+this.Change+"' ExchangeRate='1'   Action='Update'/>"):t+="<Row CurrencyID='"+this.DataTable[e][this.DataTableColumns[0]].toString()+"' Name='"+s.J0.String(this.DataTable[e][this.DataTableColumns[2]])+"' Symbol='"+s.J0.String(this.DataTable[e][this.DataTableColumns[3]])+"' Change='"+s.J0.String(this.DataTable[e][this.DataTableColumns[4]])+"' ExchangeRate='"+s.J0.String(this.DataTable[e][this.DataTableColumns[5]])+"' Decimals='"+s.J0.String(this.DataTable[e][this.DataTableColumns[6]])+"' Daily='"+s.J0.String(this.DataTable[e][this.DataTableColumns[7]])+"'  StatusID='"+s.J0.String(this.DataTable[e][this.DataTableColumns[8]])+"'  IsDivide='"+s.J0.String(this.DataTable[e].IsDivide)+"' GUID='"+s.J0.String(this.DataTable[e].GUID)+"'   Action='Update'/>":parseInt(this.DataTable[e][0])<=0&&(t+="<Row CurrencyID='0' Name='"+s.J0.String(this.DataTable[e][this.DataTableColumns[2]])+"' Symbol='"+s.J0.String(this.DataTable[e][this.DataTableColumns[3]])+"' Change='"+s.J0.String(this.DataTable[e][this.DataTableColumns[4]])+"' ExchangeRate='"+s.J0.String(this.DataTable[e][this.DataTableColumns[5]])+"' Decimals='"+s.J0.String(this.DataTable[e][this.DataTableColumns[6]])+"' Daily='"+s.J0.String(this.DataTable[e][this.DataTableColumns[7]])+"'  StatusID='"+s.J0.String(this.DataTable[e][this.DataTableColumns[8]])+"' IsDivide='"+s.J0.String(this.DataTable[e].IsDivide)+"' GUID='"+s.J0.String(this.DataTable[e].GUID)+"' Action='Insert'/>"));this.BaseCurr==this._CurrencyID&&(t+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+this.Symbol+"' Change='"+this.Change+"' ExchangeRate='1'  GUID='"+this._GUID+"'   Action='Update'/>")}else t+="<XML>";for(let e=0;e<this.lstDeletedRecords.length;e++)t+='<Row Action="Delete"',t+=' CurrencyID="'+this.lstDeletedRecords[e].iSeqno+'"/>';return t+="</XML>",t=t.Replace("&","&amp;"),t.toString()}BindCurrencies(t){let e=[];e.push(0),e.push(t),e.push(n.d.SessionManager.UserID),e.push(n.d.SessionManager.LanguageID);let a=n.d.admin.GetCurrencies(e);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(this._CurrencyID=parseInt(a.Tables[0][0].CurrencyID),this.BaseCurr=this._CurrencyID,this.CurrencyName=a.Tables[0][0].Name.toString(),this.Symbol=s.J0.String(a.Tables[0][0].Symbol),this.Change=s.J0.String(a.Tables[0][0].Change),this._GUID=s.J0.String(a.Tables[0][0].GUID)),null!=a&&a.Tables.length>1){this.DataTableObj.Clear();for(let i=0;i<a.Tables[1].length;i++){let r=this.DataTableObj.NewRow();for(let c=0;c<a.Columns[1].length;c++){const b=a.Columns[1][c];r[b]=s.J0.String(a.Tables[1][i][b])}this.DataTableObj.addRow(r)}}if(a.Tables.length>2&&(this.ExTable=a.Tables[2]),a.Tables.length>3&&!a.Columns[3].Contains("NoDimCurrency")&&a.Tables[3].length>0){if(this.Dim.Label=a.Tables[3][0].Name.toString(),this.Dim.SelectedValue=t,""!=a.Tables[3][0].CurrencyID.toString()&&parseInt(a.Tables[3][0].CurrencyID.toString())!=this.BaseCurr){let i=this.DataTable.filter(r=>r.CurrencyID==a.Tables[3][0].CurrencyID.toString());i.length>0&&(this._CurrencyID=parseInt(i[0].CurrencyID.toString()),this.CurrencyName=i[0].Name.toString(),Symbol=i[0].Symbol.toString(),this.Change=i[0].Change.toString(),i[0].CurrencyID=this.BaseCurr,i[0].Change=a.Tables[0][0].Change.toString(),i[0].Name=a.Tables[0][0].Name.toString(),i[0].Symbol=a.Tables[0][0].Symbol.toString())}for(let i=0;i<this.DataTable.length;i++){let r=a.Tables[2].filter(c=>0==c.ED&&c.CurrencyID==this.DataTable[i].CurrencyID.toString());this.DataTable[i].ExchangeRate=r.length>0?r[0].ExchangeRate.toString():0,this.DataTableObj.updateRow(this.DataTable)}}this.AddCurrencyDetails(),this.ViewExhangeRates.LoadExchRates(this.ExTable),this.DataTableObj.addEmptyRow(),this.DataTable[a.Tables[1].length-1].SNO=a.Tables[1].length,s.J0.IsEmpty(this.selectedCurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(i=>i.SelectedCurrencyType==this.selectedCurrencyID&&i.Text>=this.ViewExhangeRates.FromDate.Date&&i.Text<=this.ViewExhangeRates.Todate.Date))}Validate(){if(this.Dim.Visible&&0==this.Dim.SelectedValue)return this.DisplayMessage=" select "+this.Dim.Label,this.MessageVisibility=!0,!1;if(null==this.CurrencyName.Trim()||""==this.CurrencyName.Trim())return this.DisplayMessage=" Please Enter Base Currency",this.MessageVisibility=!0,!1;if(null==this.Symbol.Trim()||""==this.Symbol.Trim())return this.DisplayMessage=" Please Enter Base Symbol",this.MessageVisibility=!0,!1;if(null==this.Change.Trim()||""==this.Change.Trim())return this.DisplayMessage=" Please Enter Base Currency Change",this.MessageVisibility=!0,!1;for(let t=0;t<this.DataTable.length;t++)if(!s.J0.IsEmpty(this.DataTable[t].Name)||!s.J0.IsEmpty(this.DataTable[t].Symbol)||!s.J0.IsEmpty(this.DataTable[t].ExchangeRate)){if(s.J0.IsEmpty(this.DataTable[t].Name))return this.DisplayMessage=n.d.GetResource("Curr_Name")+(t+1).toString(),this.MessageVisibility=!0,!1;if(s.J0.IsEmpty(this.DataTable[t].Symbol))return this.DisplayMessage=n.d.GetResource("Curr_Symbol")+(t+1).toString(),this.MessageVisibility=!0,!1;if(s.J0.IsEmpty(this.DataTable[t].Change))return this.DisplayMessage=n.d.GetResource("Curr_Change")+(t+1).toString(),this.MessageVisibility=!0,!1;if(s.J0.IsEmpty(this.DataTable[t].ExchangeRate)||parseFloat(this.DataTable[t].ExchangeRate)<=0)return this.DisplayMessage=n.d.GetResource("Curr_Exch")+(t+1).toString(),this.MessageVisibility=!0,!1;if(s.J0.IsEmpty(this.DataTable[t].Decimals)||parseFloat(this.DataTable[t].Decimals)<=0)return this.DisplayMessage=n.d.GetResource("Curr_Decimals")+(t+1).toString(),this.MessageVisibility=!0,!1}return!0}OnSaveCurrency(t){this.MessageVisibility=!1,Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency");try{if(this.Validate()){let e=[];if(this.BaseCurr!=this._CurrencyID){e.push(this.BaseCurr);let c=this.DataTable.filter(b=>b.CurrencyID==this.BaseCurr.toString());if(!(c.length>0))return this.DisplayMessage="Base currency deleted.please refresh data",void(this.MessageVisibility=!0);e.push(c[0].Name.toString()),e.push(c[0].Symbol.toString()),e.push(c[0].Change.toString())}else e.push(this._CurrencyID),e.push(this.CurrencyName),e.push(this.Symbol),e.push(this.Change);e.push(this.GetCurrencyXMl()),e.push(this.ViewExhangeRates.GetXML()),e.push(this.Dim.Visible?this.Dim.SelectedValue:1),e.push(n.d.SessionManager.CompanyGUID),e.push(this._GUID),e.push(n.d.SessionManager.UserName),e.push(n.d.SessionManager.RoleID),e.push(n.d.SessionManager.LanguageID);let a,i=n.d.admin.SetCurrencies(e);this.MessageVisibility=!0,a=i.Message;let r=i.ret;this.DisplayMessage=a,r>0&&this.BindCurrencies(this.Dim.Visible?this.Dim.SelectedValue:1),Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency")}}catch(e){Logger.ErrorLog("AddCurrencyViewModel:: OnSaveCurrency"+e.stack)}}onCanSaveCurrency(t){return!0}UpdateUIIndicators(t){this.PACTControlData=t,this.DisplayName="Currency"}CallBackBuildControls(t){}worker_DoWork(t,e){Logger.InfoLog("AddCurrencyViewModel::Entering worker_DoWork"),this._ScreenData=this.BuildControls(),Logger.InfoLog("AddCurrencyViewModel::BuildControls Success"),this.CurrencyNameEnabled=!0,this.SymbolEnabled=!0,this.ChangeEnabled=!0,this.ApplyResources(this._ScreenData.Tables[0]),this.CurrencyCombo.Visible=!1;for(let a=0;a<this._ScreenData.Tables.length;a++)if(this._ScreenData.Columns[a].Contains("CurrLookupID")){this.CurrLookup=this._ScreenData.Tables[a],this.CurrencyCombo.Visible=!0,this.CurrencyCombo.Label=n.d.GetResource("Currency_BaseCurrency"),this.CurrLookup.forEach(i=>{this.CurrencyCombo.Items.push(o._p.ComboBoxItems_2(i.Name,i.Name))});break}}worker_RunWorkerCompleted(t,e){this.DisplayName=n.d.GetResource("Currency_ScreenName")}BuildControls(){Logger.InfoLog("AddCurrencyViewModel::Entering BuildControls");try{return(new R.ControlGenerator).GetControls(this._ScreenID,n.d.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("AddCurrencyViewModel:: BuildControls"+t.stack),null}}ApplyFieldSecurity(t){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyFieldSecurity");let e=t;e=e.filter(a=>172==a.ColID),this.CurrencyNameEnabled=e.length>0,e=e.filter(a=>173==a.ColID),this.SymbolEnabled=e.length>0,e=e.filer(a=>174==a.ColID),this.ChangeEnabled=e.length>0,Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyFieldSecurity")}ApplyResources(t){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyResources");let e=t;e=e.filter(a=>172==a.CostCenterColID),this.lblCurrencyName=e.length>0?e[0].ResourceData.toString():"",e=e.filter(a=>173==a.CostCenterColID),this.lblSymbol=e.length>0?e[0].ResourceData.toString():"",e.RowFilter="CostCenterColID=174",this.lblChange=e.length>0?e[0].ResourceData.toString():"",Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyResources")}OnShowExchangeRate(){this.AddCurrencyDetails()}OnAddExchangeRate(){this.Exch=new d(this),this.AddCurrencyDetails()}OnDeleteCallBack(){let t=0;for(let e=0;e<this.DataTable.length;e++)if(t=parseInt(this.DataTable[e].SNO),this.SelectedNode==t-1&&!s.J0.IsEmpty(this.DataTable[e][0])){this.lstDeletedRecords.push(new y(parseInt(this.DataTable[e][0])));break}this.SelectedNode<this.DataTable.length&&this.DataTableObj.Table.RemoveAt(this.SelectedNode),this.UpdateSequence()}}}}]);