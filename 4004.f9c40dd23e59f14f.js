"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[4004],{54004:(ct,ae,E)=>{E.r(ae),E.d(ae,{FinalSettlementComponent:()=>gt});var he=E(10467),ge=E(89417),o=E(86739),B=E(31820),ue=E(98669),K=E(49710),ce=E(7601),z=E(32647),n=E(8787),ee=E(72099),j=E(38816),ie=E(75782),se=E(81669),ye=E(95005),me=E(33012),le=E(26983),A=E(18569),U=E(92701),oe=E(9309),De=E(54683),pe=E(47267),Te=E(27961),ne=E(50334),be=E(48875),ve=E(39560),Se=E(35063),fe=E(44904),te=E(95707),e=E(54438),Pe=E(60177),Ce=E(8495),re=E(94304),Ee=E(36688),de=E(13816),Fe=E(73955);function Me(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("Approve"))}),e.nrm(1,"i",39),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Approve")))}function Ae(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("Save"))}),e.nrm(1,"i",40),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Post")))}function Ge(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("SaveAndPrint"))}),e.nrm(1,"i",41),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"SaveAndPrint")))}function Le(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.btnPrint_Click("Print"))}),e.nrm(1,"i",42),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Print")))}function Oe(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.btnPrintPreview_Click("Preview"))}),e.nrm(1,"i",43),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Preview")))}function Re(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.btnExport_Click("Export"))}),e.nrm(1,"i",44),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Export")))}function _e(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("Attachments"))}),e.nrm(1,"i",45),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Attachments")))}function Ne(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("EMail"))}),e.nrm(1,"i",46),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"SMTP_Email")))}function xe(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("Delete"))}),e.nrm(1,"i",47),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Delete")))}function we(y,F){if(1&y){const t=e.RV6();e.j41(0,"span",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.obj.Button_Click("Report"))}),e.nrm(1,"i",48),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&y&&(e.R7$(2),e.JRh(e.bMT(3,1,"Report")))}function Ie(y,F){if(1&y){const t=e.RV6();e.j41(0,"div",22),e.EFF(1,"\n                "),e.j41(2,"div"),e.EFF(3,"\n                  "),e.j41(4,"div",49),e.EFF(5,"\n                    "),e.eu8(6,50),e.EFF(7,"\n                    "),e.j41(8,"div",51),e.EFF(9,"\n                      "),e.j41(10,"label",52),e.EFF(11),e.k0s(),e.EFF(12,"\n                      "),e.j41(13,"div",53),e.EFF(14,"\n                        "),e.j41(15,"span",54),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.Calculate_Click("Previous"))}),e.nrm(16,"i",55),e.k0s(),e.EFF(17,"\n                        "),e.j41(18,"span",54),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.Calculate_Click("Next"))}),e.nrm(19,"i",56),e.k0s(),e.EFF(20,"\n                      "),e.k0s(),e.EFF(21,"\n                    "),e.k0s(),e.EFF(22,"\n                  "),e.k0s(),e.EFF(23,"\n                  \n                  \n                "),e.k0s(),e.EFF(24,"\n              "),e.k0s()}if(2&y){const t=e.XpG();e.R7$(6),e.Y8G("obj",t.obj.DocPrefix)("group",t.form),e.R7$(5),e.JRh(t.obj.lblDocNo)}}function Ve(y,F){if(1&y&&(e.j41(0,"div",22),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.dtpDocDate)("group",t.form)}}function Be(y,F){if(1&y&&(e.j41(0,"div",57),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.EmployeeList)("group",t.form)}}function ke(y,F){if(1&y&&(e.j41(0,"div",22),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.cmbSettlementType)("group",t.form)}}function je(y,F){if(1&y&&(e.j41(0,"div",22),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.dtpDateOfJoining)("group",t.form)}}function Ue(y,F){if(1&y&&(e.j41(0,"div",22),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.dtpDateOfRelieving)("group",t.form)}}function Je(y,F){if(1&y&&(e.j41(0,"div",57),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.txtRemarks)("group",t.form)}}function Ye(y,F){if(1&y&&(e.j41(0,"div",22),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.obj.txtNetAmount)("group",t.form)}}function We(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.EFF(2,"\n              "),e.nrm(3,"app-PactGridView",59),e.EFF(4,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(3),e.Y8G("obj",t.dgvGratuity)("group",t.form)}}function $e(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.cmbResignType)("group",t.form)}}function Xe(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.cmbResignReason)("group",t.form)}}function Ke(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtGratuityAmount)("group",t.form)}}function He(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtAvailedGratuityAmount)("group",t.form)}}function qe(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtPartialGratuityAmount)("group",t.form)}}function Qe(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.dgvLeaveEncash)("group",t.form)}}function ze(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtCumLeaveSalBalAmt)("group",t.form)}}function Ze(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtLEAmount)("group",t.form)}}function et(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG(2);e.R7$(2),e.Y8G("obj",t.dgvUPS)("group",t.form)}}function tt(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG(2);e.R7$(2),e.Y8G("obj",t.txtUPSAmount)("group",t.form)}}function at(y,F){if(1&y){const t=e.RV6();e.j41(0,"tab",26),e.bIt("selectTab",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onSelectTab("dgvUPS"))}),e.EFF(1,"\n          "),e.j41(2,"div",36),e.EFF(3,"\n            "),e.DNE(4,et,4,2,"div",28),e.EFF(5,"\n            "),e.j41(6,"div",37),e.EFF(7,"\n              "),e.j41(8,"div",31),e.EFF(9,"\n                "),e.eu8(10,32),e.EFF(11,"\n              "),e.k0s(),e.EFF(12,"\n              "),e.DNE(13,tt,4,2,"div",30),e.EFF(14,"\n            "),e.k0s(),e.EFF(15,"\n          "),e.k0s(),e.EFF(16,"\n        "),e.k0s()}if(2&y){const t=e.XpG();e.FS9("heading",t.tpUnProcessedSalary),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",t.dgvUPS.Visible),e.R7$(6),e.Y8G("obj",t.UPSRemarks)("group",t.form),e.R7$(3),e.Y8G("ngIf",t.txtUPSAmount.Visible)}}function it(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.dgvNoticePay)("group",t.form)}}function st(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtNPAmount)("group",t.form)}}function lt(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.dgvOthAdd)("group",t.form)}}function ot(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtOthAddAmount)("group",t.form)}}function nt(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.dgvOthDed)("group",t.form)}}function rt(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtOthDedAmount)("group",t.form)}}function dt(y,F){if(1&y&&(e.j41(0,"div",58),e.EFF(1,"\n              "),e.nrm(2,"app-PactGridView",59),e.EFF(3,"\n            "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.dgvLoanBal)("group",t.form)}}function ht(y,F){if(1&y&&(e.j41(0,"div",31),e.EFF(1,"\n                "),e.eu8(2,32),e.EFF(3,"\n              "),e.k0s()),2&y){const t=e.XpG();e.R7$(2),e.Y8G("obj",t.txtLoanBalAmount)("group",t.form)}}let gt=(()=>{class y{constructor(){this.form=new ge.gE({}),this.IsAccordionOpen=!0,this.EmpSeqNo=0,this.GratuityGrade=0,this.EmpGrade=0,this.GratuityDocID=0,this.PrevEmpSeqNo=0,this.sDocNo="0",this.strFormula="",this.isLoaded=!1,this.dblAmount=0,this.drwRes=null,this.chkCalcBasedOnLastSal=new ee.c,this.chkCalcBasedOnActDays=new ee.c,this.chkLECalcBasedOnLastApprSerYearWise=new ee.c,this.GratuityRemarks=new B.Dw(0),this.LeaveRemarks=new B.Dw(0),this.UPSRemarks=new B.Dw(0),this.NoticePayRemarks=new B.Dw(0),this.OAddRemarks=new B.Dw(0),this.ODedRemarks=new B.Dw(0),this.LoanRemarks=new B.Dw(0),this.txtGratuityAmount=new B.Dw(0),this.txtAvailedGratuityAmount=new B.Dw(0),this.txtPartialGratuityAmount=new B.Dw(0),this.txtCumLeaveSalBalAmt=new B.Dw(0),this.txtLEAmount=new B.Dw(0),this.txtUPSAmount=new B.Dw(0),this.txtOthAddAmount=new B.Dw(0),this.txtOthDedAmount=new B.Dw(0),this.txtNPAmount=new B.Dw(0),this.txtLoanBalAmount=new B.Dw(0),this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="",this.lblActRelievingDate="",this.dgvGratuity=new K.vv,this.dgvLeaveEncash=new K.vv,this.dgvUPS=new K.vv,this.dgvOthAdd=new K.vv,this.dgvOthDed=new K.vv,this.dgvNoticePay=new K.vv,this.dgvLoanBal=new K.vv,this.lblDocNo="",this.tpGratuity="",this.tpLeaveEncashment="",this.tpUnProcessedSalary="",this.tpNoticePay="",this.tpOtherAdditions="",this.tpOtherDeductions="",this.tpLoanBalances="",this.btnCalcGratuity="",this.lbl1GratuityTotalDays="",this.lbl1GratuityServiceDays="",this.lbl1GratuityLOPDays="",this.lbl1GratuityBalDays="",this.lbl1GratuityTotalGrDays="",this.lblGratuityAmount="",this.lblAvailedGratuityAmount="",this.lblPartialGratuityAmount="",this.lbl1GratuityTaken="",this.lblCumLeaveSalBalAmt="",this.btnCalcLE="",this.lblLEAmount="",this.lblUPSAmount="",this.lblNPAmount="",this.lblOthAddAmount="",this.lblOthDedAmount="",this.lblLoanBalAmount="",this.dtEdit=null,this.iCurDocNo=0,this.CostCenterID=40095,this.DefProdID=0,this.dblBasic=0,this.EOS_ROff=0,this.dServiceDaysFormulaAmount=0,this.dblGratuityAmount=0,this.dActServiceDays=0,this.dServiceDaysAfterLOP=0,this.dLOPDays=0,this.EOS_ROffYear=0,this.isLast=!1,this.isConsdExpiredupto=!1,this.sVacTypeSeqNo="-1",this.EOS_GratuityFormula="",this.EOS_AvailedFormula="",this.sShowBasicAs="0",this.EOS_MaxDays=0,this.dEarnedGrDays=0,this.lst=new Array,this.dTotGratuityDays=0,this.dGratuityTaken=0,this.dShowBasicAs=0,this.dShowBasicAmount=0,this.isMaxDaysExceded=!1,this.oEvalPayFormulas=null,this.MoreThanOneLayout=!1,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null,this._Ddate=Date.Today(),this.IsRefLCTR=!1,this.guid=""}ngOnInit(){this.params&&(this.obj=this.params?.obj),this.FinalSettlement_DataContextChanged(),this.FinalSettlement_Loaded()}onSelectTab(t){o.d.page.RefreshSlickGridUI()}get txtDocNo(){return""!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox:this.ViewModel.txtDocNo}get txtRemarks(){return this.ViewModel.txtRemarks}get txtNetAmount(){return this.ViewModel.txtNetAmount}get EmployeeList(){return this.ViewModel.EmployeeList}get cmbResignType(){return this.ViewModel.cmbResignType}get cmbResignReason(){return this.ViewModel.cmbResignReason}get cmbSettlementType(){return this.ViewModel.cmbSettlementType}get dtpDocDate(){return this.ViewModel.dtpDocDate}get dtpDateOfJoining(){return this.ViewModel.dtpDateOfJoining}get dtpDateOfRelieving(){return this.ViewModel.dtpDateOfRelieving}FinalSettlement_DataContextChanged(){this.ViewModel=this.obj,this.ViewModel.CalculateClick.Subscribe(this,"Calculate_Click"),this.ViewModel.EmpSelectionChanged.Subscribe(this,"Employee_SelectionChanged"),this.ViewModel.txtDocNo.LostFocusCommand.Subscribe(this,"txtDocNo_LostFocus"),this.ViewModel.DocPrefixSelectionChanged.Subscribe(this,"OnDocPrefixChanged"),this.dgvOthAdd.CellEditEnding.Subscribe(this,"dgvOthAdd_CellEndEdit"),this.dgvOthDed.CellEditEnding.Subscribe(this,"dgvOthDed_CellEndEdit"),this.dtpDateOfRelieving.SelectedDateChanged.Subscribe(this,"dtpDateOfRelieving_SelectedDateChanged"),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1)}FinalSettlement_Loaded(){this.isLoaded||(this.LoadGrids(),this.Clear_Click(),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&""==this.ViewModel.sVNo&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.CheckDateInDocNumber(!0,!0),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),this.dsLookups=o.d.common.GetDataSet("CRM015",""),this.dgvOthAdd.Columns.find(s=>"dgColOthAddParticulars"==s.ValueBinding).ComboData=this.dsLookups.Tables[0],this.dgvOthDed.Columns.find(s=>"dgColOthDedParticulars"==s.ValueBinding).ComboData=this.dsLookups.Tables[1],this.dgvOthAdd.CanUserAddRows=!0,this.dgvOthAdd.CanUserDeleteRows=!0,this.dgvOthAdd.addEmptyRow(),this.dgvOthDed.CanUserAddRows=!0,this.dgvOthDed.CanUserDeleteRows=!0,this.dgvOthDed.addEmptyRow(),this.dgvOthAdd.refreshDataView(),this.lblDocNo=this.GetResource("VoucherNo",40095),this.tpGratuity=this.GetResource("Gratuity",40095),this.tpLeaveEncashment=this.GetResource("Leave Encashment",40095),this.tpUnProcessedSalary=this.GetResource("Un-Processed Salary",40095),this.tpNoticePay=this.GetResource("Notice Pay",40095),this.tpOtherAdditions=this.GetResource("Other Additions",40095),this.tpOtherDeductions=this.GetResource("Other Deductions",40095),this.tpLoanBalances=this.GetResource("Loan Balances",40095),this.chkCalcBasedOnLastSal.Label=this.GetResource("Calculate based on Last Salary",40095),this.chkCalcBasedOnActDays.Label=this.GetResource("Calculate Salary based on Actual Days",40095),this.btnCalcGratuity=this.GetResource("Calculate",40095),this.lbl1GratuityTotalDays=this.GetResource("Total Days",40095)+" : ",this.lbl1GratuityServiceDays=this.GetResource("Service Days",40095)+" : ",this.lbl1GratuityLOPDays=", "+this.GetResource("LOP",40095)+" : ",this.lbl1GratuityBalDays=", "+this.GetResource("Balance",40095)+" : ",this.lbl1GratuityTotalGrDays=this.GetResource("Total Gratuity Days",40095)+" : ",this.lbl1GratuityTaken=this.GetResource("Gratuity Taken",40095)+" : ",this.lblGratuityAmount=this.GetResource("Gratuity Amount",40095),this.lblAvailedGratuityAmount=this.GetResource("Availed Gratuity Amount",40095),this.lblPartialGratuityAmount=this.GetResource("Partial Gratuity Amount",40095),this.lblCumLeaveSalBalAmt=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.chkLECalcBasedOnLastApprSerYearWise.Label=this.GetResource("Calculate based on Last Appraisal - Service Year Wise",40095),this.btnCalcLE=this.GetResource("Calculate",40095),this.lblLEAmount=this.GetResource("Amount",40095),this.lblUPSAmount=this.GetResource("Amount",40095),this.lblNPAmount=this.GetResource("Amount",40095),this.lblOthAddAmount=this.GetResource("Amount",40095),this.lblOthDedAmount=this.GetResource("Amount",40095),this.lblLoanBalAmount=this.GetResource("Amount",40095),this.isLoaded=!0,""!=this.ViewModel.sVNo&&(this.ViewModel.DocPrefix.TextBox.Text=this.ViewModel.sVNo.ToString(),this.ViewModel.DocPrefix.ComboBox.SelectedValue=this.ViewModel.sPrefix.ToString(),this.OnDocPrefixChanged("lostFocus"),this.ViewModel.FillDocumentPrefix(!0),this.ViewModel.DocPrefix.ComboBox.SelectedValue=this.ViewModel.sPrefix.ToString(),this.ViewModel.DocPrefix.ComboBox.SelectedItem=this.ViewModel.DocPrefix.ComboBox.GetselectedItem(),this.LoadDocument(parseInt(this.ViewModel.sVNo.Replace("FST-","")),this.Prefix)))}txtDocNo_LostFocus(t){try{this.txtDocNo.Text.Trim().length>0&&this.LoadDocument(parseInt(this.txtDocNo.Text.Trim()),this.Prefix)}catch{this.ViewModel.DisplayMessage="Enter Valid DocNo."}}LoadDocument(t,s){let i;this.ViewModel.DisplayMessage="",this.ViewModel.MessageVisibility=!0,this.sDocNo=t.toString();let a=o.d.common.GetDataTable("CRM016",t.toString()+"~"+s);if(null!=a&&a.length>0){if(!n.J0.IsEmpty(o.d.SessionManager.sEmpFilteredEmpSeqNos)&&!o.d.SessionManager.sEmpFilteredEmpSeqNos.split(",").Contains(parseInt(a[0].EmpSeqNo).toString()))return this.ViewModel.DisplayMessage="You don't have permission to view this Document.",this.ViewModel.MessageVisibility=!0,this.Clear_Click(),this.txtDocNo.Text=t.toString(),void(this.EmployeeList.IsEnabled=!1);this.EmployeeList.IsEnabled=!0,this.ViewModel.PostVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ViewModel.SavePrintVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.EmployeeList.SelectedValue=parseInt(a[0].EmpSeqNo),this.EmployeeList.SelectedValue=parseInt(a[0].EmpSeqNo),this.ClearControlValues(),this.dtEdit=null,this.EmpSeqNo=parseInt(a[0].EmpSeqNo),this.dtEdit=o.d.common.GetDataTable("CRM018",this.EmpSeqNo.toString()+"~"+t+"~"+s),null!=this.dtEdit&&this.dtEdit.length>0&&(this.dtpDocDate.Date=n.J0.ParseDate(this.dtEdit[0].cDocDate));let l=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.iMonth(),1),d=[];if(d.push(this.EmpSeqNo),d.push(0),d.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),d.push(l.ToString("dd/MMM/yyyy")),d.push(t),d.push(s),d.push(1),d.push(o.d.SessionManager.UserID),d.push(o.d.SessionManager.RoleID),d.push(o.d.SessionManager.LanguageID),this.dsD=o.d.common.GetDataSet_SP(d,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0&&this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=n.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.cmbSettlementType.SelectedValue="Final",this.DOB=n.J0.ParseDate(this.dsD.Tables[0][0].DOB),9e3!=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+" : "+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=new Date,this.cmbResignType.SelectedValue=n.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==n.J0.String(this.dsD.Tables[0][0].ResignStatus)){let h=n.J0.ParseDate(this.dsD.Tables[0][0].DOResign),c=new Date(h.getFullYear(),h.getMonth(),1),g=new Date,r=c;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=o.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(o.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(g=c.AddMonths(parseInt(o.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=o.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(o.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(g=c.AddMonths(parseInt(o.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=o.d.SessionManager.Preferences.NPResignation&&parseInt(o.d.SessionManager.Preferences.NPResignation)>0&&(g=c.AddMonths(parseInt(o.d.SessionManager.Preferences.NPResignation)-1));let p=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfRelieving.Date.iMonth(),1);if(g<p)for(;g<p;)g=g.AddMonths(1);let v,P=new Date,T=new Date,w=new Date;for(;r<=g;){if(i=this.dsD.Tables[5].filter(_=>_.PayrollDate==r.ToString("dd/MMM/yyyy")),null==i||0==i.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=r.ToString("dd/MMM/yyyy"),"Actual Days"==o.d.SessionManager.Preferences.PayDays){let _={PayrollMonth:P,PayrollMonthStart:T,PayrollMonthEnd:w};if(n.J0.SetPayrollDate_1(r,_),P=_.PayrollMonth,T=_.PayrollMonthStart,w=_.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let V=0;V=n.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),P,T,w),V>0&&(n.J0.SetPayrollDate_1(r,_,this.EmpGrade),P=_.PayrollMonth,T=_.PayrollMonthStart,w=_.PayrollMonthEnd)}v=w.Subtract(T).Days+1}else v=parseInt(o.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=v,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(o.d.SessionManager.sPayrollDecimals)}r=r.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&o.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==o.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let h=0,c=0;for(let g=0;g<this.dsD.Columns[8].length;g++)n.J0.IsEmpty(this.dsD.Tables[8][0][g])||(h+=parseFloat(this.dsD.Tables[8][0][g]));for(let g=0;g<this.dsD.Tables[9].length;g++)n.J0.IsEmpty(this.dsD.Tables[9][g].Amount)||(c+=parseFloat(this.dsD.Tables[9][g].Amount));this.txtCumLeaveSalBalAmt.Text=(h-c).ToString(o.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(o.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let h;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let c=0;c<this.dsD.Tables[4].length;c++)h=n.J0.ParseDate(this.dsD.Tables[4][c].PayrollMonth),this.dgvUPS.Table[c].dgColUPSPayrollMonth=h.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[c].dgColUPSMonthDays=h.DaysInMonth(),this.dgvUPS.Table[c].dgColUPSDaysAtt=0,this.dgvUPS.Table[c].dgColUPSLOP=0,this.dgvUPS.Table[c].dgColUPSNetSal=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[c].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[c])}let u=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let h=0;h<this.dsD.Tables[10].length;h++)this.dgvLoanBal.Table[h].dgColLoanBalSNo=(h+1).toString(),this.dgvLoanBal.Table[h].dgColLoanBalDocNo=this.dsD.Tables[10][h].DocNo.toString(),this.dgvLoanBal.Table[h].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][h].DocID.toString(),this.dgvLoanBal.Table[h].dgColLoanBalLoanType=this.dsD.Tables[10][h].LoanType.toString(),this.dgvLoanBal.Table[h].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][h].LoanCompID.toString(),this.dgvLoanBal.Table[h].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][h].ApprovedAmt).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[h].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][h].Paid).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[h].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][h].Balance).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[h].dgColLoanBalCalc="Pay",u+=parseFloat(this.dsD.Tables[10][h].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[h])}this.txtLoanBalAmount.Text=u.ToString(o.d.SessionManager.sPayrollDecimals),this.ViewModel.ApproveVisibility=!1;let D=null;if(null!=this.dtEdit&&this.dtEdit.length>0){if(this.ViewModel.DocStatus="["+this.dtEdit[0].DocStatus.toString()+"]",this.ViewModel.DocID=parseInt(this.dtEdit[0].DocID),this.sDocNo=this.dtEdit[0].DocNumber.toString(),this.txtDocNo.Text=this.sDocNo,this.dtpDocDate.Date=n.J0.ParseDate(this.dtEdit[0].cDocDate),this.dtpDateOfRelieving.Date=n.J0.ParseDate(this.dtEdit[0].dcAlpha3),this.dtpDateOfRelieving_SelectedDateChanged(this,this.dtpDateOfRelieving),this.txtRemarks.Text=this.dtEdit[0].CommonNarration.toString(),this.ViewModel.StatusID=parseInt(this.dtEdit[0].StatusID),this.ViewModel.WID=parseInt(this.dtEdit[0].WorkflowID),this.cmbSettlementType.SelectedValue=n.J0.String(this.dtEdit[0].dcAlpha10),D=o.d.common.GetDataSet("CRM029",this.ViewModel.DocID.toString()),i=this.dtEdit.filter(r=>"1"==r.dcAlpha1),null!=i&&i.length>0&&(this.GratuityRemarks.Text=i[0].dcAlpha8.toString(),this.cmbResignType.Text=i[0].dcAlpha11.toString(),this.chkCalcBasedOnLastSal.IsChecked=(0,z.yG0)(i[0].dcAlpha12),this.chkCalcBasedOnActDays.IsChecked=(0,z.yG0)(i[0].dcAlpha13),this.cmbResignReason.SelectedValue=i[0].dcAlpha33.toString(),this.Calculate_Click("Gratuity"),this.txtPartialGratuityAmount.Text=parseFloat(i[0].dcCalcNum4).ToString(o.d.SessionManager.sPayrollDecimals)),i=this.dtEdit.filter(r=>"2"==r.dcAlpha1),null!=i&&i.length>0){this.LeaveRemarks.Text=i[0].dcAlpha8.toString(),this.chkLECalcBasedOnLastApprSerYearWise.IsChecked=!n.J0.IsEmpty(i[0].dcAlpha17)&&(0,z.yG0)(i[0].dcAlpha17);for(let r=0;r<i.length;r++)for(let p=0;p<this.dgvLeaveEncash.Table.length;p++)if(i[r].dcAlpha11.toString()==this.dgvLeaveEncash.Table[p+"_Tag"].toString()){this.dgvLeaveEncash.Table[p].dgColLEAvailable=i[r].dcAlpha13.toString(),this.dgvLeaveEncash.Table[p].dgColLEMaxEncash=i[r].dcAlpha14.toString(),this.dgvLeaveEncash.Table[p].dgColLEApplied=i[r].dcAlpha15.toString();break}this.Calculate_Click("LeaveEncash"),this.dgvLeaveEncash.Update()}if(i=this.dtEdit.filter(r=>"3"==r.dcAlpha1),null!=i&&i.length>0){this.UPSRemarks.Text=i[0].dcAlpha8.toString();for(let r=0;r<i.length;r++)for(let p=0;p<this.dgvUPS.Table.length;p++)if(n.J0.ParseDate(i[r].dcAlpha11).ToString("dd MMM yyyy")==n.J0.ParseDate(this.dgvUPS.Table[p].dgColUPSPayrollMonth).ToString("dd MMM yyyy")){this.dgvUPS.Table[p].dgColUPSDaysAtt=i[r].dcAlpha13.toString(),this.dgvUPS.Table[p].dgColUPSLOP=i[r].dcAlpha14.toString(),this.dgvUPS.Table[p].dgColUPSNetSal=i[r].dcAlpha15.toString();break}this.dgvUPS.Update(),this.txtUPSAmount.Text=parseFloat(i[0].dcCalcNum1).ToString(o.d.SessionManager.sPayrollDecimals)}if(i=this.dtEdit.filter(r=>"4"==r.dcAlpha1),null!=i&&i.length>0){this.NoticePayRemarks.Text=i[0].dcAlpha8.toString();for(let r=0;r<i.length;r++)for(let p=0;p<this.dgvNoticePay.Table.length;p++)if(n.J0.ParseDate(i[r].dcAlpha11).ToString("dd MMM yyyy")==n.J0.ParseDate(this.dgvNoticePay.Table[p].dgColNPPayrollMonth).ToString("dd MMM yyyy")){this.dgvNoticePay.Table[p].dgColNPDaysAtt=i[r].dcAlpha13.toString(),this.dgvNoticePay.Table[p].dgColNPLOP=i[r].dcAlpha14.toString(),this.dgvNoticePay.Table[p].dgColNPNetSal=i[r].dcAlpha15.toString(),this.dgvNoticePay.Table[p].dgColNPType=i[r].dcAlpha16.toString(),this.dgvNoticePay.Table[p].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[p]);break}this.txtNPAmount.Text=parseFloat(i[0].dcCalcNum1).ToString(o.d.SessionManager.sPayrollDecimals)}if(i=this.dtEdit.filter(r=>"5"==r.dcAlpha1),null!=i&&i.length>0){this.OAddRemarks.Text=i[0].dcAlpha8.toString(),this.dgvOthAdd.addEmptyRows(i.length);for(let r=0;r<i.length;r++)this.dgvOthAdd.Table[r].dgColOthAddParticulars=parseInt(i[r].dcAlpha11.toString()),this.dgvOthAdd.Table[r].dgColOthAddAmount=i[r].dcAlpha12.toString(),n.J0.IsEmpty(i[r].dcAlpha13)||(this.dgvOthAdd.Table[r].dgColOthAddRemarks=i[r].dcAlpha13.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[r]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2)}if(i=this.dtEdit.filter(r=>"6"==r.dcAlpha1),null!=i&&i.length>0){this.ODedRemarks.Text=i[0].dcAlpha8.toString(),this.dgvOthDed.addEmptyRows(i.length);for(let r=0;r<i.length;r++)this.dgvOthDed.Table[r].dgColOthDedParticulars=parseInt(i[r].dcAlpha11.toString()),this.dgvOthDed.Table[r].dgColOthDedAmount=i[r].dcAlpha12.toString(),n.J0.IsEmpty(i[r].dcAlpha13)||(this.dgvOthDed.Table[r].dgColOthDedRemarks=i[r].dcAlpha13.toString()),this.dgvOthDed.updateRow(this.dgvOthDed.Table[r]),this.dgvOthDed_CellEndEdit(this.dgvOthDed,2)}if(i=this.dtEdit.filter(r=>"7"==r.dcAlpha1),null!=i&&i.length>0){this.LoanRemarks.Text=i[0].dcAlpha8.toString();for(let r=0;r<i.length;r++)for(let p=0;p<this.dgvLoanBal.Table.length;p++)if(i[r].dcAlpha12.toString()==this.dgvLoanBal.Table[p].dgColLoanBalDocNo_Tag.toString()){this.dgvLoanBal.Table[p].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[p].dgColLoanBalSNo_Tag=i[r].dcAlpha17.toString(),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[p]);break}}if(null!=D&&D.Tables.length>0&&D.Tables[0].length>0){let r=D.Tables[0];if(null!=r&&r.length>0)for(let p=0;p<r.length;p++){let v=new De.AddAttachmentViewModel;v.AddAttachmentViewModel_2(this.ViewModel),v.AttachmentID=parseInt(r[p].FileID),v.ActualFileName=r[p].ActualFileName.toString(),v.FileExtension=r[p].FileExtension.toString(),v.FileDescription=r[p].FileDescription.toString(),v.FilePath=n.J0.GetPath(r[p].GUID+"."+r[p].FileExtension),v.RelativeFileName=r[p].RelativeFileName.toString(),v.IsProductImage=!1,this.ViewModel.ViewAttachments.AttachmentsList.push(v)}}if(this.ViewModel.WID>0){let r=o.d.common.GetDataTable("CRM020",this.dtEdit[0].InvDocDetailsID.toString()+",95,'"+o.d.SessionManager.UserName+"',40095,"+this.ViewModel.WID+","+this.dtEdit[0].WorkFlowLevel.toString()+","+this.dtEdit[0].StatusID.toString()+","+this.dtEdit[0].CreatedDate.toString()+","+o.d.SessionManager.UserID+","+o.d.SessionManager.RoleID);null!=r&&r.length>0&&(null!=r[0].CanApprove&&null!=r[0].CanApprove&&"TRUE"==r[0].CanApprove.toString().toUpperCase()?(this.ViewModel.ApproveVisibility=!0,this.ViewModel.PostVisiblility=!1):this.ViewModel.PostVisiblility=!(!o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))}let h=o.d.common.GetDataSet3("CRM021",this.CostCenterID.toString(),this.ViewModel.DocID.toString());this.ViewModel.WFDocLevelList.Clear();let c=null,g=null;if(c=h.Tables[1],g=h.Tables[0],null!=c&&c.length>0&&!o.d.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let p,r=parseInt(this.dtEdit[0].WorkFlowLevel);g.length>0&&(p=parseInt(g[g.length-1].StatusID));let v=g.length>0?parseInt(g[0].WORKFLOWLEVEL)-1:0;for(let P=0;P<c.length;P++){let T=new ce.O(parseInt(c[0].WID),parseInt(c[P].LEVELID),c[P].LEVELNAME.toString(),this.CostCenterID,this.ViewModel.DocID,n.J0.ParseDate(c[P].DocDate));P==v&&(T.IsPending=!0,T.Label="C"),0==P&&(T.LeftLineBrush="#FFFFFFFF"),P==c.length-1&&(T.RightLineBrush="#FFFFFFFF"),this.ViewModel.WFDocLevelList.push(T)}for(let P=g.length-1;P>=0;P--){let T=parseInt(g[P].WORKFLOWLEVEL);if(T<=r&&T<=this.ViewModel.WFDocLevelList.length&&!this.ViewModel.WFDocLevelList[T-1].IsSet){this.ViewModel.WFDocLevelList[T-1].IsSet=!0,this.ViewModel.WFDocLevelList[T-1].ModifiedBy=g[P].STATUS.toString()+" By "+g[P].CREATEDBY.toString(),g[P].FIRSTNAME.toString().length>0&&(this.ViewModel.WFDocLevelList[T-1].ModifiedBy+="("+g[P].FIRSTNAME.toString()+")");let w=n.J0.ParseDate(g[P].DATE);this.ViewModel.WFDocLevelList[T-1].ModifiedBy+=" On "+w.ToString(o.d.SessionManager.Preferences["Date Format"]);let _=parseInt(g[P].STATUSID);372==_?this.ViewModel.WFDocLevelList[T-1].IsRejected=!0:441==_?this.ViewModel.WFDocLevelList[T-1].IsApproved=!0:369==_&&(this.ViewModel.WFDocLevelList[T-1].IsPending=!0,this.ViewModel.WFDocLevelList[T-1].Label=" P")}}}}else this.ViewModel.DocStatus="[UnPosted]",this.ViewModel.DocID=0,this.sDocNo="0",this.ViewModel.StatusID=0,this.ViewModel.PostVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete");this.CalculateTotalAmount()}this.ViewModel.EmployeeList.Code.SelectedValue=parseInt(a[0].EmpSeqNo),this.ViewModel.EmployeeList.Name.SelectedValue=parseInt(a[0].EmpSeqNo),this.ViewModel.DocID=parseInt(a[0].DocID),this.ViewModel.sVoucherNo=a[0].VoucherNo.toString()}else this.Clear_Click(),this.txtDocNo.Text=t.toString(),this.dtpDocDate.SetFocus=!0}Clear_Click(){this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&0==this.ViewModel.DocPrefix.Prefixes.length&&""==this.ViewModel.sVNo&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=0,this.EmpSeqNo=0,this.PrevEmpSeqNo=0,this.ViewModel.DocID=0,this.ClearControlValues(),this.ViewModel.sCmdParameter="",this.ViewModel.SelectedEmpID=0,this.dTotGratuityDays=0,null!=this.ViewModel&&null!=this.ViewModel.WFDocLevelList&&this.ViewModel.WFDocLevelList.Clear(),this.ViewModel.ApproveVisibility=!1,this.ViewModel.PostVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=o.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new oe.ViewAttachmentViewModel(this.ViewModel,o.d.SessionManager,o.d.admin),this.ViewModel.OnAddAttachment()}ClearControlValues(){this.dtEdit=null,this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="0",this.chkCalcBasedOnLastSal.Label="Calculate based on Last Salary",this.chkCalcBasedOnActDays.Label="Calculate Salary based on Actual Days",this.txtRemarks.Label=o.d.GetResource("Remarks"),this.txtRemarks.Text="",this.GratuityRemarks.Label=o.d.GetResource("Remarks"),this.GratuityRemarks.Text="",this.LeaveRemarks.Label=o.d.GetResource("Remarks"),this.LeaveRemarks.Text="",this.UPSRemarks.Label=o.d.GetResource("Remarks"),this.UPSRemarks.Text="",this.NoticePayRemarks.Label=o.d.GetResource("Remarks"),this.NoticePayRemarks.Text="",this.OAddRemarks.Label=o.d.GetResource("Remarks"),this.OAddRemarks.Text="",this.ODedRemarks.Label=o.d.GetResource("Remarks"),this.ODedRemarks.Text="",this.cmbSettlementType.SelectedIndex=0,this.LoanRemarks.Label=o.d.GetResource("Remarks"),this.LoanRemarks.Text="",this.dtpDocDate.Date=(new Date).Date(),this.cmbResignType.Label=o.d.GetResource("Resign Type"),this.cmbResignType.SelectedValue="Resigned",this.cmbResignReason.SelectedValue="",this.cmbResignReason.Label="Resign Reason",this.dblBasic=0,this.sDocNo="0",this.ViewModel.DocStatus="[UnPosted]",this.dGratuityTaken=0,this.dgvGratuity.Clear(),this.dgvLeaveEncash.Clear(),this.dgvUPS.Clear(),this.dgvOthAdd.Clear(),this.dgvOthDed.Clear(),this.dgvNoticePay.Clear(),this.dgvLoanBal.Clear(),this.txtGratuityAmount.Label=this.GetResource("Gratuity Amount",40095),this.txtGratuityAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtGratuityAmount.Align="right",this.txtAvailedGratuityAmount.Label=this.GetResource("Availed Gratuity Amount",40095),this.txtAvailedGratuityAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Align="right",this.txtPartialGratuityAmount.Label=this.GetResource("Partial Gratuity Amount",40095),this.txtPartialGratuityAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtPartialGratuityAmount.Align="right",this.txtCumLeaveSalBalAmt.Label=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.txtCumLeaveSalBalAmt.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtCumLeaveSalBalAmt.Align="right",this.txtLEAmount.Label=this.GetResource("Amount",40095),this.txtLEAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtLEAmount.Align="right",this.txtUPSAmount.Label=this.GetResource("Amount",40095),this.txtUPSAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtUPSAmount.Align="right",this.txtOthAddAmount.Label=this.GetResource("Amount",40095),this.txtOthAddAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtOthAddAmount.Align="right",this.txtOthDedAmount.Label=this.GetResource("Amount",40095),this.txtOthDedAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtOthDedAmount.Align="right",this.txtNPAmount.Label=this.GetResource("Amount",40095),this.txtNPAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtNPAmount.Align="right",this.txtLoanBalAmount.Label=this.GetResource("Amount",40095),this.txtLoanBalAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtLoanBalAmount.Align="right",this.txtNetAmount.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtNetAmount.Align="right",this.lblActRelievingDate="",null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new oe.ViewAttachmentViewModel(this.ViewModel,o.d.SessionManager,o.d.admin),this.ViewModel.OnAddAttachment(),this.setDefaultRows()}setDefaultRows(){this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd"),this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")}GetNextDocNo(){let t=o.d.common.GetDataTable("CRM017","");null!=t&&(this.txtDocNo.Text=t.length>0?n.J0.IsEmpty(t[0].CurrentCodeNumber)?"1":parseInt(t[0].CurrentCodeNumber).toString():"1")}Employee_SelectionChanged(t){if(this.EmpSeqNo==t)return;this.EmpSeqNo=t,this.ClearControlValues();let s,i=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.getMonth(),1),a=[];if(a.push(this.EmpSeqNo),a.push(this.ViewModel.DocID),a.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),a.push(i.ToString("dd/MMM/yyyy")),a.push(0),a.push(""),a.push(0),a.push(o.d.SessionManager.UserID),a.push(o.d.SessionManager.RoleID),a.push(o.d.SessionManager.LanguageID),this.dsD=o.d.common.GetDataSet_SP(a,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0)if(this.dsD.Tables.length>14&&this.dsD.Tables[14].length>0)this.ViewModel.DisplayMessage="Employee FinalSettlement is Already done @VoucherNo - "+this.dsD.Tables[14][0].VoucherNo.ToString(),this.ViewModel.MessageVisibility=!0;else if(this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=n.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.DOB=n.J0.ParseDate(this.dsD.Tables[0][0].DOB),this.cmbSettlementType.SelectedValue="Final",9e3!=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=Date.Today(),this.cmbResignType.SelectedValue=n.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==this.dsD.Tables[0][0].ResignStatus.toString()){let d=n.J0.ParseDate(this.dsD.Tables[0][0].DOResign),u=new Date,D=new Date,h=new Date,c={PayrollMonth:u,PayrollMonthStart:D,PayrollMonthEnd:h};n.J0.SetPayrollDate_1(d,c),u=c.PayrollMonth,D=c.PayrollMonthStart,h=c.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(d,c,this.EmpGrade),u=c.PayrollMonth,D=c.PayrollMonthStart,h=c.PayrollMonthEnd);let g=new Date(u.getFullYear(),u.getMonth(),1),r=new Date,p=g;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=o.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(o.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(r=g.AddMonths(parseInt(o.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=o.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(o.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(r=g.AddMonths(parseInt(o.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=o.d.SessionManager.Preferences.NPResignation&&parseInt(o.d.SessionManager.Preferences.NPResignation)>0&&(r=g.AddMonths(parseInt(o.d.SessionManager.Preferences.NPResignation)-1)),u=new Date,D=new Date,h=new Date,c={PayrollMonth:u,PayrollMonthStart:D,PayrollMonthEnd:h},n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,c),u=c.PayrollMonth,D=c.PayrollMonthStart,h=c.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,c,this.EmpGrade),u=c.PayrollMonth,D=c.PayrollMonthStart,h=c.PayrollMonthEnd);let v=new Date(u.getFullYear(),u.iMonth(),1);if(r<v)for(;r<v;)r=r.AddMonths(1);let P=0;for(u=new Date,D=new Date,h=new Date;p<=r;){if(s=this.dsD.Tables[5].filter(T=>T.PayrollDate==p.ToString("dd/MMM/yyyy")),null==s||0==s.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=p.ToString("dd/MMM/yyyy"),"Actual Days"==o.d.SessionManager.Preferences.PayDays){let T={PayrollMonth:u,PayrollMonthStart:D,PayrollMonthEnd:h};if(n.J0.SetPayrollDate_1(p,T),u=T.PayrollMonth,D=T.PayrollMonthStart,h=T.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let w=0;w=n.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),u,D,h),w>0&&(n.J0.SetPayrollDate_1(p,T,w),u=T.PayrollMonth,D=T.PayrollMonthStart,h=T.PayrollMonthEnd)}P=h.Subtract(D).Days+1}else P=parseInt(o.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=P,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1])}p=p.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&o.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==o.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let d=0,u=0;for(let D=0;D<this.dsD.Columns[8].length;D++)n.J0.IsEmpty(this.dsD.Tables[8][0][this.dsD.Columns[8][D]])||(d+=parseFloat(this.dsD.Tables[8][0][this.dsD.Columns[8][D]]));for(let D=0;D<this.dsD.Tables[9].length;D++)n.J0.IsEmpty(this.dsD.Tables[9][D].Amount)||(u+=parseFloat(this.dsD.Tables[9][D].Amount));this.txtCumLeaveSalBalAmt.Text=(d-u).ToString(o.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(o.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(o.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let d;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let u=0;u<this.dsD.Tables[4].length;u++)d=n.J0.ParseDate(this.dsD.Tables[4][u].PayrollMonth),this.dgvUPS.Table[u].dgColUPSPayrollMonth=d.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[u].dgColUPSMonthDays=d.DaysInMonth(),this.dgvUPS.Table[u].dgColUPSDaysAtt=0,this.dgvUPS.Table[u].dgColUPSLOP=0,this.dgvUPS.Table[u].dgColUPSNetSal=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[u].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[u])}let l=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let d=0;d<this.dsD.Tables[10].length;d++)this.dgvLoanBal.Table[d].dgColLoanBalSNo=(d+1).toString(),this.dgvLoanBal.Table[d].dgColLoanBalDocNo=this.dsD.Tables[10][d].DocNo.toString(),this.dgvLoanBal.Table[d].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][d].DocID.toString(),this.dgvLoanBal.Table[d].dgColLoanBalLoanType=this.dsD.Tables[10][d].LoanType.toString(),this.dgvLoanBal.Table[d].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][d].LoanCompID.toString(),this.dgvLoanBal.Table[d].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][d].ApprovedAmt).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[d].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][d].Paid).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[d].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][d].Balance).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[d].dgColLoanBalCalc="Pay",l+=parseFloat(this.dsD.Tables[10][d].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[d])}this.CalculateTotalAmount()}}AutoCalculateLeaveEncashment(){o.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==o.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&this.btnCalcLeaveEncash_Click()}RefreshLeaveEncashDetails(){if(this.EmpSeqNo>0&&(this.dgvLeaveEncash.Clear(),this.dsD.Tables[1].length>0)){this.dgvLeaveEncash.addEmptyRows(this.dsD.Tables[1].length);for(let t=0;t<this.dsD.Tables[1].length;t++){this.dgvLeaveEncash.Table[t+"_Tag"]=this.dsD.Tables[1][t].SNo.toString(),this.dgvLeaveEncash.Table[t].dgColLELeaveType=this.dsD.Tables[1][t].ComponentName.toString(),this.dgvLeaveEncash.Table[t].dgColLELeaveType_Tag=this.dsD.Tables[1][t].ComponentID.toString();let s=0,i=0;if(this.dsD.Tables[1][t].ComponentID.toString()==this.sVacTypeSeqNo)this.dgvLeaveEncash.Table[t].dgColLEAvailable=this.GetVacationAvailability(this.dtpDateOfRelieving.Date,parseInt(this.sVacTypeSeqNo));else{let a={dTaken:0,dAvail:0},l={dAvail:0};this.GetLeavesTaken1(this.dtpDateOfRelieving.Date,this.dtpDateOfJoining.Date,this.dsD.Tables[1][t].ComponentID.toString(),l),s=a.dTaken,i=a.dAvail,this.dgvLeaveEncash.Table[t].dgColLEAvailable=i}this.dgvLeaveEncash.Table[t].dgColLEMaxEncash=parseFloat(this.dgvLeaveEncash.Table[t].dgColLEAvailable)>parseFloat(this.dsD.Tables[1][t].MaxEncashDays)?this.dsD.Tables[1][t].MaxEncashDays.toString():this.dgvLeaveEncash.Table[t].dgColLEAvailable.toString(),this.dgvLeaveEncash.Table[t].dgColLEApplied=0,this.dgvLeaveEncash.Table[t].dgColLEAmount=(0).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.Table[t].dgColLEAmount_Tag=this.dsD.Tables[1][t].EncashFormula.toString(),o.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==o.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&(this.dgvLeaveEncash.Table[t].dgColLEApplied=this.dgvLeaveEncash.Table[t].dgColLEMaxEncash)}this.dgvLeaveEncash.Update()}}GetAvailableLeavesToEncash(t){t.SNo.toString();let a=t.ComponentID.toString();if(this.sVacTypeSeqNo!=a){let l=o.d.common.GetDataSet3("CRM022",this.dtpDocDate.Date.ToString("dd MMM yyyy"),new Date(this.dtpDocDate.Date.getFullYear(),parseInt(o.d.SessionManager.Preferences.LeaveYear.toString()),1).ToString("dd MMM yyyy"),this.EmpSeqNo+"~"+a);if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0){let d=0,u=0,D=0;return l.Tables[1].length>0&&(u=parseFloat(l.Tables[1][0].NoOfDays.toString())),l.Tables[2].length>0&&(D=parseFloat(l.Tables[2][0].NoOfDays.toString())),d-u-D}return 0}try{return 0}catch(l){return this.ViewModel.DisplayMessage="Exception when Calculating Available leaves of Vacation Type",console.log(l),0}}GetVacationAvailability(t,s){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");let i=0,a=[];a.push(t.ToString("dd/MMM/yyyy")),a.push(this.EmpSeqNo),a.push(2),a.push(o.d.SessionManager.UserID),a.push(o.d.SessionManager.LanguageID);let l=o.d.common.GetDataSet_SP(a,"spPAY_GetRemainingVacationDays");if(null!=l&&l.Tables.length>0&&l.Tables[0].length>0){let d=l.Tables[0].filter(u=>u.LeaveType==s);null!=d&&d.length>0&&(i=parseFloat(d[0].AvlblDays))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),i.toString()}GetLeavesTaken(t,s,i,a){a.dTaken=a.dAvail=0;let l=[];l.push(t.ToString("dd/MMM/yyyy")),l.push(s.ToString("dd/MMM/yyyy")),l.push(this.EmpSeqNo),l.push(i),l.push("Both"),l.push(o.d.SessionManager.UserID),l.push(o.d.SessionManager.LanguageID);let d=o.d.common.GetDataSet_SP(l,"spPAY_ExtGetAvlblNoofDays");null!=d&&d.Tables.length>0&&d.Tables[0].length>0&&(n.J0.IsEmpty(d.Tables[0][0].LeavesTaken)||(a.dTaken=parseFloat(d.Tables[0][0].LeavesTaken)),n.J0.IsEmpty(d.Tables[0][0].AvailableLeaves)||(a.dAvail=parseFloat(d.Tables[0][0].AvailableLeaves)))}GetLeavesTaken1(t,s,i,a){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken1()"),a.dAvail=0;let l=[];l.push(this.EmpSeqNo),l.push(i),l.push(t.ToString("dd/MMM/yyyy")),l.push(0),l.push(o.d.SessionManager.UserID),l.push(o.d.SessionManager.LanguageID),l.push(0);let d=o.d.common.GetDataSet_SP(l,"spPAY_ExtGetAssignedLeaves");null!=d&&d.Tables.length>0&&d.Tables[0].length>0&&(n.J0.IsEmpty(null!=d.Tables[0][0].AvailableLeaves)||(a.dAvail=n.J0.DoubleTryParse(d.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}CalculateTotalAmount(){let t=0;t+="Partial"==this.cmbSettlementType.SelectedValue?parseFloat(this.txtPartialGratuityAmount.Text):parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken,t+=parseFloat(this.txtLEAmount.Text),t+=parseFloat(this.txtUPSAmount.Text),t+=parseFloat(this.txtOthAddAmount.Text),t-=parseFloat(this.txtOthDedAmount.Text),t+=parseFloat(this.txtNPAmount.Text),t-=parseFloat(this.txtLoanBalAmount.Text),this.txtNetAmount.Text=t.ToString(o.d.SessionManager.sPayrollDecimals)}GenerateSerialNos(t,s=""){for(let i=0;i<t.Table.length;i++)"dgvOthAdd"==s?t.Table[i].dgColOthAddSNo=i+1:t.Table[i].dgColOthDedSNo=i+1;t.invalidate()}LoadGrids(){let t;this.SetGridProperties(this.dgvLeaveEncash),t=new A.O7,t.DisplayMember="dgColLELeaveType",t.Header=this.GetResource("Leave Type",40095),t.ReadOnly=!0,this.dgvLeaveEncash.Columns.push(t),this.dgvLeaveEncash.TableColumns.push("dgColLELeaveType"),t=new A.O7,t.DisplayMember="dgColLEAvailable",t.Header=this.GetResource("Available Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvLeaveEncash.Columns.push(t),this.dgvLeaveEncash.TableColumns.push("dgColLEAvailable"),t=new A.O7,t.DisplayMember="dgColLEMaxEncash",t.Header=this.GetResource("Max Encash Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvLeaveEncash.Columns.push(t),this.dgvLeaveEncash.TableColumns.push("dgColLEMaxEncash"),t=new A.O7,t.DisplayMember="dgColLEApplied",t.Header=this.GetResource("Applied Days",40095),t.TextAlign="Center",this.dgvLeaveEncash.Columns.push(t),this.dgvLeaveEncash.TableColumns.push("dgColLEApplied"),t=new A.O7,t.DisplayMember="dgColLEAmount",t.Header=this.GetResource("Encash Amount",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvLeaveEncash.Columns.push(t),this.dgvLeaveEncash.TableColumns.push("dgColLEAmount"),this.SetGridProperties(this.dgvUPS),t=new A.O7,t.DisplayMember="dgColUPSPayrollMonth",t.Header=this.GetResource("Payroll Month",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSPayrollMonth"),t=new A.O7,t.DisplayMember="dgColUPSMonthDays",t.Header=this.GetResource("Month Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSMonthDays"),t=new A.O7,t.DisplayMember="dgColUPSDaysAtt",t.Header=this.GetResource("Days Attended",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSDaysAtt"),t=new A.O7,t.DisplayMember="dgColUPSLOP",t.Header=this.GetResource("LOP Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSLOP"),t=new A.O7,t.DisplayMember="dgColUPSNetSal",t.Header=this.GetResource("Net Salary",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSNetSal"),t=new A.O7,t.DataType="LINK",t.DisplayMember="dgColUPSCalc",t.Header=this.GetResource("Calculate",40095),t.TextAlign="Center",t.Click.Subscribe(this,"dgvUPS_CellClick"),this.dgvUPS.Columns.push(t),this.dgvUPS.TableColumns.push("dgColUPSCalc"),this.SetGridProperties(this.dgvNoticePay),t=new A.O7,t.DataType="ComboBox",t.ValueBinding="dgColNPType",t.DisplayMember="Name",t.ValueMember="Value",t.Header=this.GetResource("Type",40095);let s=new Array;s.push(U._p.ComboBoxItems_2("Add","Add")),s.push(U._p.ComboBoxItems_2("Subtract","Subtract")),s.push(U._p.ComboBoxItems_2("None","None")),t.ComboData=s,this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPType"),t=new A.O7,t.DisplayMember="dgColNPPayrollMonth",t.Header=this.GetResource("Payroll Month",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPPayrollMonth"),t=new A.O7,t.DisplayMember="dgColNPMonthDays",t.Header=this.GetResource("Month Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPMonthDays"),t=new A.O7,t.DisplayMember="dgColNPDaysAtt",t.Header=this.GetResource("Days Attended",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPDaysAtt"),t=new A.O7,t.DisplayMember="dgColNPLOP",t.Header=this.GetResource("LOP Days",40095),t.ReadOnly=!0,t.TextAlign="Center",this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPLOP"),t=new A.O7,t.DisplayMember="dgColNPNetSal",t.Header=this.GetResource("Net Salary",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPNetSal"),t=new A.O7,t.DataType="LINK",t.DisplayMember="dgColNPCalc",t.Header=this.GetResource("Calculate",40095),t.TextAlign="Center",t.Click.Subscribe(this,"dgvNoticePay_CellClick"),this.dgvNoticePay.Columns.push(t),this.dgvNoticePay.TableColumns.push("dgColNPCalc"),this.SetGridProperties(this.dgvOthAdd),t=new A.O7,t.DisplayMember="dgColOthAddSNo",t.Header="#",t.ReadOnly=!0,t.TextAlign="Center",this.dgvOthAdd.Columns.push(t),this.dgvOthAdd.TableColumns.push("dgColOthAddSNo"),t=new A.O7,t.DataType="ComboBox",t.ValueBinding="dgColOthAddParticulars",t.DisplayMember="Name",t.ValueMember="NodeID",t.Header=this.GetResource("Particulars",40095),this.dgvOthAdd.Columns.push(t),this.dgvOthAdd.TableColumns.push("dgColOthAddParticulars"),t=new A.O7,t.DisplayMember="dgColOthAddAmount",t.Header=this.GetResource("Amount",40095),t.TextAlign="Right",this.dgvOthAdd.Columns.push(t),this.dgvOthAdd.TableColumns.push("dgColOthAddAmount"),t=new A.O7,t.DisplayMember="dgColOthAddRemarks",t.Header=this.GetResource("LineNarration",40095),this.dgvOthAdd.Columns.push(t),this.dgvOthAdd.TableColumns.push("dgColOthAddRemarks"),this.SetGridProperties(this.dgvOthDed),t=new A.O7,t.DisplayMember="dgColOthDedSNo",t.Header="#",t.ReadOnly=!0,t.TextAlign="Center",this.dgvOthDed.Columns.push(t),this.dgvOthDed.TableColumns.push("dgColOthDedSNo"),t=new A.O7,t.DataType="ComboBox",t.ValueBinding="dgColOthDedParticulars",t.DisplayMember="Name",t.ValueMember="NodeID",t.Header=this.GetResource("Particulars",40095),this.dgvOthDed.Columns.push(t),this.dgvOthDed.TableColumns.push("dgColOthDedParticulars"),t=new A.O7,t.DisplayMember="dgColOthDedAmount",t.Header=this.GetResource("Amount",40095),t.TextAlign="Right",this.dgvOthDed.Columns.push(t),this.dgvOthDed.TableColumns.push("dgColOthDedAmount"),t=new A.O7,t.DisplayMember="dgColOthDedRemarks",t.Header=this.GetResource("LineNarration",40095),this.dgvOthDed.Columns.push(t),this.dgvOthDed.TableColumns.push("dgColOthDedRemarks"),this.SetGridProperties(this.dgvLoanBal),t=new A.O7,t.DisplayMember="dgColLoanBalSNo",t.Header="#",t.ReadOnly=!0,t.TextAlign="Center",this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalSNo"),t=new A.O7,t.DisplayMember="dgColLoanBalDocNo",t.Header=this.GetResource("Loan Doc. No.",40095),t.ReadOnly=!0,this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalDocNo"),t=new A.O7,t.DisplayMember="dgColLoanBalLoanType",t.Header=this.GetResource("Loan Type",40095),t.ReadOnly=!0,this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalLoanType"),t=new A.O7,t.DisplayMember="dgColLoanBalApprAmount",t.Header=this.GetResource("Approved Amount",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalApprAmount"),t=new A.O7,t.DisplayMember="dgColLoanBalAmountPaid",t.Header=this.GetResource("Amount Paid",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalAmountPaid"),t=new A.O7,t.DisplayMember="dgColLoanBalBalAmount",t.Header=this.GetResource("Balance Amount",40095),t.ReadOnly=!0,t.TextAlign="Right",this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalBalAmount"),t=new A.O7,t.DisplayMember="dgColLoanBalRemarks",t.Header=this.GetResource("LineNarration",40095),this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalRemarks"),t=new A.O7,t.DataType="LINK",t.DisplayMember="dgColLoanBalCalc",t.Header=this.GetResource("Pay",40095),t.TextAlign="Center",t.Click.Subscribe(this,"dgvLoanBal_CellClick"),this.dgvLoanBal.Columns.push(t),this.dgvLoanBal.TableColumns.push("dgColLoanBalCalc")}SetGridProperties(t){t.Table=[],t.Columns=[]}Calculate_Click(t){switch(t){case"Gratuity":this.btnCalcGratuity_Click();break;case"LeaveEncash":this.btnCalcLeaveEncash_Click();break;case"Clear":this.Clear_Click();break;case"Save":this.Save_Click();break;case"Delete":this.Delete_Click();break;case"Previous":this.Previous_Click();break;case"Next":this.Next_Click();break;case"Approve":this.Approve_Click()}return""}Approve_Click(){let t=new pe.a(this.CostCenterID,this.ViewModel.DocID,null,this.ViewModel);o.d.page.ShowDialog(t,Te.H,{ShowCenter:!0,Title:o.d.GetResource("ApproveReject")})}Next_Click(){if(""!=this.ViewModel.DocPrefix.TextBox.Text){let t=0;null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&""!=this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname&&(t=parseInt(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname));let s=(parseInt(this.ViewModel.DocPrefix.TextBox.Text)+1).ToString();for(;s.length<t;)s="0"+s;this.ViewModel.DocPrefix.TextBox.Text=s,this.LoadDocument(parseInt(s),this.Prefix)}}Previous_Click(){""!=this.ViewModel.DocPrefix.TextBox.Text&&(this.iCurDocNo=parseInt(this.ViewModel.DocPrefix.TextBox.Text.Trim()),this.iCurDocNo>1&&this.LoadDocument(this.iCurDocNo-1,this.Prefix))}Delete_Click(){if(""!=this.sDocNo&&parseInt(this.sDocNo)>0){if(confirm("Are you sure want to Delete.?")){let t=0,s=[];s.push(40095),s.push(this.ViewModel.DocID),s.push(1);let i=o.d.document.DeleteSelectedRows(s,t);this.ViewModel.DisplayMessage=i.Message,t=i.RetValue,this.ViewModel.MessageVisibility=!0,this.Clear_Click()}}else this.ViewModel.DisplayMessage="Select any saved Document to Delete",this.ViewModel.MessageVisibility=!0}Save_Click(){if(this.dgvOthAdd.angularGrid&&this.dgvOthAdd.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.dgvOthDed.angularGrid&&this.dgvOthDed.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.ValidateSave()){let t=[];t.push(this.CostCenterID),t.push(this.ViewModel.DocID),t.push(null!=this.Prefix?this.Prefix:""),t.push(null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:""),t.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),t.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),t.push(""),t.push(this.GetDocumentXML()),t.push(""),t.push(""),t.push(this.ViewModel.ViewAttachments.GetXML()),t.push(this.GetActivityXML()),t.push("false"),o.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==o.d.SessionManager.Preferences.EnableLocationWise.toString()?t.push(o.d.SessionManager.LocationID>0?o.d.SessionManager.LocationID:1):t.push(0),o.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==o.d.SessionManager.Preferences.EnableDivisionWise.toString()?t.push(o.d.SessionManager.DivisionID>0?o.d.SessionManager.DivisionID:1):t.push(0),t.push(this.ViewModel.WID),t.push(o.d.SessionManager.RoleID),t.push(""),t.push(0),t.push(0),t.push(o.d.SessionManager.CompanyGUID),t.push(o.d.SessionManager.UserName),t.push(o.d.SessionManager.UserID),t.push(o.d.SessionManager.LanguageID),t.push(o.d.SessionManager.IsOffline);let s=0,i="";o.d.document.SetTempInvDocument(t).subscribe(a=>{s=a.obj;let l=a;if(i=null!=l&&l.Tables.length>0&&l.Tables[l.Tables.length-1].length>0&&l.Columns[l.Tables.length-1].Contains("ErrorMessage")?l.Tables[l.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",s>0){let d=[];d.push(s),d.push(o.d.SessionManager.UserID),d.push(o.d.SessionManager.LanguageID);let u=this.ViewModel.PostApplyLeaves(parseInt(o.d.SessionManager.CompanyIndex),d,"spPAY_PostApplyLeaves");null!=u&&u.Tables.length>0&&(i="Problem in processing your request,Please contact administrator."),this.ViewModel.SelectedEmpID=this.EmpSeqNo,this.Clear_Click()}else null!=l&&l.Tables.length>0&&l.Tables[l.Tables.length-1].length>0&&l.Columns[l.Tables.length-1].Contains("ServerMessage")&&(s="-407"==l.Tables[l.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.ViewModel.DisplayMessage=i,this.ViewModel.MessageVisibility=!0})}}GetActivityXML(){let t='<XML  SysInfo="'+o.d.SessionManager.GetSysInfo()+'" AP="Desktop" ';return"Approve"==this.ViewModel.sCmdParameter&&(t+=' AppRejDate="'+Date.Today().ToString("dd/MMM/yyyy")+'"'),t+=" >",t+=" </XML> ",t}GetDocumentXML(){let h,s="",i="",a="",l="",d="",u="";if(new Array,null!=o.d.SessionManager.dtDocDefAccs&&(h=o.d.SessionManager.dtDocDefAccs.filter(c=>40095==c.CostCenterID&&"CreditAccount"==c.SysColumnName),null!=h&&h.length>0&&null!=h[0].UserDefaultValue&&""!=h[0].UserDefaultValue.toString().Trim()&&(d=h[0].UserDefaultValue.toString()),h=o.d.SessionManager.dtDocDefAccs.filter(c=>40095==c.CostCenterID&&"DebitAccount"==c.SysColumnName),null!=h&&h.length>0&&null!=h[0].UserDefaultValue&&""!=h[0].UserDefaultValue.toString().Trim()&&(u=h[0].UserDefaultValue.toString())),i+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="'+parseFloat(this.txtNetAmount.Text)+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+o.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+u+'" CreditAccount="'+d+'" CommonNarration="'+n.J0.EncodeXML(this.txtRemarks.Text),null!=this.dgvGratuity&&this.dgvGratuity.Table.length>0){let c=1;for(let g=0;g<this.dgvGratuity.Table.length;g++)s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Gratuity',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",a+=" dcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='1',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha4='"+this.lblGratuityServiceDays+"',",a+=" dcAlpha5='"+this.lblGratuityLOPDays+"',",a+=" dcAlpha6='"+this.lblGratuityBalDays+"',",a+=" dcAlpha7='"+this.lblGratuityTotalGrDays+"',",a+=" dcAlpha8='"+this.GratuityRemarks.Text+"',",a+=" dcAlpha9='"+this.GratuityGrade+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.cmbResignType.SelectedValue+"',",a+=" dcAlpha12='"+this.chkCalcBasedOnLastSal.IsChecked+"',",a+=" dcAlpha13='"+this.chkCalcBasedOnActDays.IsChecked+"',",a+=" dcAlpha14='"+this.lblGratuityTotalDays+"',",a+=" dcAlpha15='"+this.dgvGratuity.Table[g][this.dgvGratuity.TableColumns[1]]+"',",a+=" dcAlpha16='"+this.dgvGratuity.Table[g+1][this.dgvGratuity.TableColumns[2]]+"',",a+=" dcAlpha17='"+this.dgvGratuity.Table[g+1][this.dgvGratuity.TableColumns[4]]+"',",a+=" dcAlpha18='"+this.dgvGratuity.Table[g+2][this.dgvGratuity.TableColumns[1]]+"',",a+=" dcAlpha19='"+this.dgvGratuity.Table[g+3][this.dgvGratuity.TableColumns[1]]+"',",a+=" dcAlpha20='"+this.dgvGratuity.Table[g+3][this.dgvGratuity.TableColumns[4]]+"',",a+=" dcAlpha21='"+this.dgvGratuity.Table[g+5][this.dgvGratuity.TableColumns[1]]+"',",a+=" dcAlpha22='"+this.dgvGratuity.Table[g+5][this.dgvGratuity.TableColumns[2]]+"',",a+=" dcAlpha23='"+this.dgvGratuity.Table[g+5][this.dgvGratuity.TableColumns[3]]+"',",a+=" dcAlpha24='"+this.dgvGratuity.Table[g+6][this.dgvGratuity.TableColumns[1]]+"',",a+=" dcAlpha25='"+this.dgvGratuity.Table[g+6][this.dgvGratuity.TableColumns[2]]+"',",a+=" dcAlpha26='"+this.dgvGratuity.Table[g+6][this.dgvGratuity.TableColumns[3]]+"',",a+=" dcAlpha27='"+this.dgvGratuity.Table[g+6][this.dgvGratuity.TableColumns[5]]+"',",a+=" dcAlpha28='"+this.dgvGratuity.Table[g+6][this.dgvGratuity.TableColumns[7]]+"',",a+=" dcAlpha29='"+this.dgvGratuity.Table[g+7][this.dgvGratuity.TableColumns[5]]+"',",a+=" dcAlpha30='"+this.dgvGratuity.Table[g+3][this.dgvGratuity.TableColumns[6]]+"',",a+=" dcAlpha31='"+this.GratuityDocID+"',",a+=" dcAlpha32='"+this.lblGratuityTaken+"',",a+=" dcAlpha33='"+this.cmbResignReason.SelectedValue+"',",a+=" dcAlpha34='"+this.dgvGratuity.Table[g+1][this.dgvGratuity.TableColumns[6]]+"',",a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",g+=8,c++}if(null!=this.dgvLeaveEncash&&this.dgvLeaveEncash.Table.length>0){let c=1;for(let g=0;g<this.dgvLeaveEncash.Table.length;g++)0!=n.J0.Double(this.dgvLeaveEncash.Table[g].dgColLEAmount)&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leave Encashment',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",a+=" dcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",a+=" dcCalcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='2',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.LeaveRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvLeaveEncash.Table[g+"_Tag"].toString()+"',",a+=" dcAlpha12='"+this.dgvLeaveEncash.Table[g].dgColLELeaveType+"',",a+=" dcAlpha13='"+this.dgvLeaveEncash.Table[g].dgColLEAvailable+"',",a+=" dcAlpha14='"+this.dgvLeaveEncash.Table[g].dgColLEMaxEncash+"',",a+=" dcAlpha15='"+this.dgvLeaveEncash.Table[g].dgColLEApplied+"',",a+=" dcAlpha16='"+this.dgvLeaveEncash.Table[g].dgColLEAmount.toString().Replace(",","")+"',",a+=" dcAlpha17='"+this.chkLECalcBasedOnLastApprSerYearWise.IsChecked+"',",a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}if(null!=this.dgvUPS&&this.dgvUPS.Table.length>0){let c=1;for(let g=0;g<this.dgvUPS.Table.length;g++)n.J0.Double(this.dgvUPS.Table[g].dgColUPSNetSal)>0&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Un-Processed Salary',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='3',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.UPSRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvUPS.Table[g].dgColUPSPayrollMonth+"',",a+=" dcAlpha12='"+this.dgvUPS.Table[g].dgColUPSMonthDays+"',",a+=" dcAlpha13='"+this.dgvUPS.Table[g].dgColUPSDaysAtt+"',",a+=" dcAlpha14='"+this.dgvUPS.Table[g].dgColUPSLOP+"',",a+=" dcAlpha15='"+this.dgvUPS.Table[g].dgColUPSNetSal.toString().Replace(",","")+"',",a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}if(null!=this.dgvNoticePay&&this.dgvNoticePay.Table.length>0){let c=1;for(let g=0;g<this.dgvNoticePay.Table.length;g++)n.J0.Double(this.dgvNoticePay.Table[g].dgColNPNetSal)>0&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Notice Pay',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='4',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.NoticePayRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvNoticePay.Table[g].dgColNPPayrollMonth+"',",a+=" dcAlpha12='"+this.dgvNoticePay.Table[g].dgColNPMonthDays+"',",a+=" dcAlpha13='"+this.dgvNoticePay.Table[g].dgColNPDaysAtt+"',",a+=" dcAlpha14='"+this.dgvNoticePay.Table[g].dgColNPLOP+"',",a+=" dcAlpha15='"+this.dgvNoticePay.Table[g].dgColNPNetSal.toString().Replace(",","")+"',",a+=" dcAlpha16='"+this.dgvNoticePay.Table[g].dgColNPType+"',",a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}if(null!=this.dgvOthAdd&&this.dgvOthAdd.Table.length>0){let c=1;for(let g=0;g<this.dgvOthAdd.Table.length;g++)!n.J0.IsEmpty(this.dgvOthAdd.Table[g].dgColOthAddParticulars)&&n.J0.Double(this.dgvOthAdd.Table[g].dgColOthAddAmount)>0&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Additions',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='5',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.OAddRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvOthAdd.Table[g].dgColOthAddParticulars+"',",a+=" dcAlpha12='"+this.dgvOthAdd.Table[g].dgColOthAddAmount.toString().Replace(",","")+"',",n.J0.IsEmpty(this.dgvOthAdd.Table[g].dgColOthAddRemarks)||(a+=" dcAlpha13='"+this.dgvOthAdd.Table[g].dgColOthAddRemarks+"',"),a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}if(null!=this.dgvOthDed&&this.dgvOthDed.Table.length>0){let c=1;for(let g=0;g<this.dgvOthDed.Table.length;g++)!n.J0.IsEmpty(this.dgvOthDed.Table[g].dgColOthDedParticulars)&&n.J0.Double(this.dgvOthDed.Table[g].dgColOthDedAmount)>0&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Deductions',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='6',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.ODedRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvOthDed.Table[g].dgColOthDedParticulars+"',",a+=" dcAlpha12='"+this.dgvOthDed.Table[g].dgColOthDedAmount.toString().Replace(",","")+"',",null!=this.dgvOthDed.Table[g].dgColOthDedRemarks&&""!=this.dgvOthDed.Table[g].dgColOthDedRemarks.toString().Trim()&&(a+=" dcAlpha13='"+this.dgvOthDed.Table[g].dgColOthDedRemarks+"',"),a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}if(null!=this.dgvLoanBal&&this.dgvLoanBal.Table.length>0){let c=1;for(let g=0;g<this.dgvLoanBal.Table.length;g++)!n.J0.IsEmpty(this.dgvLoanBal.Table[g].dgColLoanBalDocNo_Tag)&&null!=this.dgvLoanBal.Table[g].dgColLoanBalCalc_Tag&&(s+="\x11",s+="<Row>",s+="<AccountsXML></AccountsXML>",s+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan Balances',l="",s+=l.length>0?'" DocDetailsID="'+l:'" DocDetailsID="',s+=i.toString()+'" ></Transactions>',a='<Numeric Query="',a+=" dcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",a+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",a+='" ></Numeric>',s+=a,a='<Alpha Query="',a+=" dcAlpha1='7',",a+=" dcAlpha2='"+c+"',",a+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",a+=" dcAlpha8='"+this.LoanRemarks.Text+"',",a+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",a+=" dcAlpha11='"+this.dgvLoanBal.Table[g].dgColLoanBalDocNo+"',",a+=" dcAlpha12='"+this.dgvLoanBal.Table[g].dgColLoanBalDocNo_Tag+"',",a+=" dcAlpha13='"+this.dgvLoanBal.Table[g].dgColLoanBalLoanType_Tag+"',",a+=" dcAlpha14='"+this.dgvLoanBal.Table[g].dgColLoanBalApprAmount.toString().Replace(",","")+"',",a+=" dcAlpha15='"+this.dgvLoanBal.Table[g].dgColLoanBalAmountPaid.toString().Replace(",","")+"',",a+=" dcAlpha16='"+this.dgvLoanBal.Table[g].dgColLoanBalBalAmount.toString().Replace(",","")+"',",a+=" dcAlpha17='"+this.dgvLoanBal.Table[g].dgColLoanBalSNo_Tag+"',",a+='" ></Alpha>',s+=a,a='<CostCenters Query="',a+=" dcCCNID51="+this.EmpSeqNo+",",a+=" dcCCNID53="+this.EmpGrade+",",a+='" ></CostCenters>',s+=a,s+="<EXTRAXML></EXTRAXML>",s+="</Row>",c++)}return s.toString()}GetCalcXML(){let t="";if(t+="<Rows>",this.dgvGratuity.Table.length>0){let s=1;for(let i=0;i<this.dgvGratuity.Table.length;i++)t+='<Row DType="1" SubDType="'+s+'" Field1="'+this.cmbResignType.SelectedValue+'" Field2="'+this.chkCalcBasedOnLastSal.IsChecked+'" Field3="'+this.chkCalcBasedOnActDays.IsChecked+'" Field4="'+this.lblGratuityTotalDays+'" Field5="'+this.dgvGratuity.Table[i][this.dgvGratuity.TableColumns[1]]+'" Field6="'+this.dgvGratuity.Table[i+1][this.dgvGratuity.TableColumns[2]]+'" Field7="'+this.dgvGratuity.Table[i+1][this.dgvGratuity.TableColumns[4]]+'" Field8="'+this.dgvGratuity.Table[i+2][this.dgvGratuity.TableColumns[1]]+'" Field9="'+this.dgvGratuity.Table[i+3][this.dgvGratuity.TableColumns[1]]+'" Field10="'+this.dgvGratuity.Table[i+3][this.dgvGratuity.TableColumns[4]]+'" Field11="'+this.dgvGratuity.Table[i+5][this.dgvGratuity.TableColumns[1]]+'" Field12="'+this.dgvGratuity.Table[i+5][this.dgvGratuity.TableColumns[2]]+'" Field13="'+this.dgvGratuity.Table[i+5][this.dgvGratuity.TableColumns[3]]+'" Field14="'+this.dgvGratuity.Table[i+6][this.dgvGratuity.TableColumns[1]]+'" Field15="'+this.dgvGratuity.Table[i+6][this.dgvGratuity.TableColumns[2]]+'" Field16="'+this.dgvGratuity.Table[i+6][this.dgvGratuity.TableColumns[3]]+'" Field17="'+this.dgvGratuity.Table[i+6][this.dgvGratuity.TableColumns[5]]+'" Field18="'+this.dgvGratuity.Table[i+6][this.dgvGratuity.TableColumns[7]]+'" Field19="'+this.dgvGratuity.Table[i+7][this.dgvGratuity.TableColumns[5]]+'" Field20="'+this.dgvGratuity.Table[i+3][this.dgvGratuity.TableColumns[6]],t+='" />',i+=8,s++}if(this.dgvLeaveEncash.Table.length>0)for(let s=0;s<this.dgvLeaveEncash.Table.length;s++)0!=n.J0.Double(this.dgvLeaveEncash.Table[s].dgColLEAmount)&&(t+='<Row DType="2" SubDType="'+s+'1" Field1="'+this.dgvLeaveEncash.Table[s+"_Tag"].toString()+'" Field2="'+this.dgvLeaveEncash.Table[s].dgColLELeaveType+'" Field3="'+this.dgvLeaveEncash.Table[s].dgColLEAvailable+'" Field4="'+this.dgvLeaveEncash.Table[s].dgColLEMaxEncash+'" Field5="'+this.dgvLeaveEncash.Table[s].dgColLEApplied+'" Field6="'+this.dgvLeaveEncash.Table[s].dgColLEAmount,t+='" />');if(this.dgvUPS.Table.length>0)for(let s=0;s<this.dgvUPS.Table.length;s++)n.J0.Double(this.dgvUPS.Table[s].dgColUPSNetSal)>0&&(t+='<Row DType="3" SubDType="'+s+'1" Field1="'+this.dgvUPS.Table[s].dgColUPSPayrollMonth+'" Field2="'+this.dgvUPS.Table[s].dgColUPSMonthDays+'" Field3="'+this.dgvUPS.Table[s].dgColUPSDaysAtt+'" Field4="'+this.dgvUPS.Table[s].dgColUPSLOP+'" Field5="'+this.dgvUPS.Table[s].dgColUPSNetSal,t+='" />');if(this.dgvNoticePay.Table.length>0)for(let s=0;s<this.dgvNoticePay.Table.length;s++)n.J0.Double(this.dgvNoticePay.Table[s].dgColNPNetSal)>0&&(t+='<Row DType="4" SubDType="'+s+'1" Field1="'+this.dgvNoticePay.Table[s].dgColNPPayrollMonth+'" Field2="'+this.dgvNoticePay.Table[s].dgColNPMonthDays+'" Field3="'+this.dgvNoticePay.Table[s].dgColNPDaysAtt+'" Field4="'+this.dgvNoticePay.Table[s].dgColNPLOP+'" Field5="'+this.dgvNoticePay.Table[s].dgColNPNetSal+'" Field6="'+this.dgvNoticePay.Table[s].dgColNPType,t+='" />');if(this.dgvOthAdd.Table.length>0)for(let s=0;s<this.dgvOthAdd.Table.length;s++)!n.J0.IsEmpty(this.dgvOthAdd.Table[s].dgColOthAddParticulars)&&n.J0.Double(this.dgvOthAdd.Table[s].dgColOthAddAmount)>0&&(t+='<Row DType="5" SubDType="'+s+'1" Field1="'+this.dgvOthAdd.Table[s].dgColOthAddParticulars+'" Field2="'+this.dgvOthAdd.Table[s].dgColOthAddAmount,n.J0.IsEmpty(this.dgvOthAdd.Table[s].dgColOthAddRemarks)||(t+='" Field3="'+this.dgvOthAdd.Table[s].dgColOthAddRemarks),t+='" />');if(this.dgvOthDed.Table.length>0)for(let s=0;s<this.dgvOthDed.Table.length;s++)!n.J0.IsEmpty(this.dgvOthDed.Table[s].dgColOthDedParticulars)&&n.J0.Double(this.dgvOthDed.Table[s].dgColOthDedAmount)>0&&(t+='<Row DType="6" SubDType="'+s+'1" Field1="'+this.dgvOthDed.Table[s].dgColOthDedParticulars+'" Field2="'+this.dgvOthDed.Table[s].dgColOthDedAmount,n.J0.IsEmpty(this.dgvOthDed.Table[s].dgColOthDedRemarks)||(t+='" Field3="'+this.dgvOthDed.Table[s].dgColOthDedRemarks),t+='" />');if(this.dgvLoanBal.Table.length>0)for(let s=0;s<this.dgvLoanBal.Table.length;s++)n.J0.IsEmpty(this.dgvLoanBal.Table[s].dgColLoanBalDocNo_Tag)||(t+='<Row DType="7" SubDType="'+s+'1" Field1="'+this.dgvLoanBal.Table[s].dgColLoanBalDocNo+'" Field2="'+this.dgvLoanBal.Table[s].dgColLoanBalDocNo_Tag+'" Field3="'+this.dgvLoanBal.Table[s].dgColLoanBalLoanType_Tag+'" Field4="'+this.dgvLoanBal.Table[s].dgColLoanBalApprAmount+'" Field5="'+this.dgvLoanBal.Table[s].dgColLoanBalAmountPaid+'" Field6="'+this.dgvLoanBal.Table[s].dgColLoanBalBalAmount+'" Field7="'+this.dgvLoanBal.Table[s].dgColLoanBalSNo_Tag,t+='" />');return t+="</Rows>",t.toString()}ValidateSave(){if(0==this.EmpSeqNo)return this.ViewModel.DisplayMessage="Please Select Employee.",this.EmployeeList.SetFocus=!0,!1;if(null!=this.dsD&&this.dsD.Tables[0].length>0&&"Final"==this.cmbSettlementType.SelectedValue&&(9e3==n.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()||null==this.dsD.Tables[0][0].DORelieve.toString()||""==this.dsD.Tables[0][0].DORelieve.toString()||null==this.dsD.Tables[0][0].DORelieve||""==n.J0.String(this.dsD.Tables[0][0].ResignStatus)||"Posted"!=n.J0.String(this.dsD.Tables[0][0].ResignStatus)))return this.ViewModel.DisplayMessage="Selected Employee not yet Resigned, Please check",!1;let t=o.d.report.GetDataTable("FS001",this.EmpSeqNo.toString(),this.ViewModel.DocID.toString());if(null!=t&&t.length>0)return this.ViewModel.DisplayMessage="Cannot save the record, Employee FinalSettlement is Already done",this.ViewModel.MessageVisibility=!0,!1;if(("Final"==this.cmbSettlementType.SelectedValue||"Partial"==this.cmbSettlementType.SelectedValue&&o.d.SessionManager.Preferences.ContainsKey("PartialFinalSettlementMandatoryRepaymentofloan")&&"True"==o.d.SessionManager.Preferences.PartialFinalSettlementMandatoryRepaymentofloan.toString())&&this.dgvLoanBal.Table.length>0)for(let s=0;s<this.dgvLoanBal.Table.length;s++)if(n.J0.IsEmpty(this.dgvLoanBal.Table[s].dgColLoanBalCalc_Tag))return this.ViewModel.DisplayMessage="Please pay pending Loan Balance amounts.",!1;return null!=o.d.SessionManager.Preferences.PayrollProduct&&""!=o.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(o.d.SessionManager.Preferences.PayrollProduct)),0!=this.DefProdID||(this.ViewModel.DisplayMessage="Select any Default Payroll Product at Global Preferences",!1)}btnCalcGratuity_Click(){this.dgvGratuity.Columns.Clear(),this.dgvGratuity.TableColumns.Clear(),this.dgvGratuity.Clear();let t={dTotGratuitySal:0};if(this.dEarnedGrDays=0,this.isMaxDaysExceded=!1,this.dTotGratuityDays=0,!(this.EmpSeqNo>0))return this.ViewModel.DisplayMessage="Select any Employee",void(this.EmployeeList.SetFocus=!0);{let l=o.d.common.GetDataSet3("CRM023",this.EmpSeqNo.toString(),this.dtpDateOfRelieving.Date.Date().ToString("dd MMM yyyy"));if(null!=l&&l.Tables.length>0){if(this.isConsdExpiredupto=!1,4==this.cmbResignType.SelectedIndex&&l.Tables[0].length>0){let d=0;d=n.J0.IntTryParse(l.Tables[0][0].ConsdExpiredupto),d>0&&(this.dtpDateOfRelieving.Date=this.DOB.AddYears(d),this.isConsdExpiredupto=!0)}if(this.dLOPDays=0,this.dLOPDays=parseFloat(this.dsD.Tables[0][0].OPLOPDays),this.dShowBasicAs=0,null!=this.dsD&&this.dsD.Tables.length>15&&this.dsD.Tables[15].length>0){let d=this.dsD.Tables[15].filter(u=>"ShowBasicAs"==u.PrefName);if(null!=d&&d.length>0&&null!=d[0].PrefValue&&null!=d[0].PrefValue&&""!=d[0].PrefValue.toString()&&(this.dShowBasicAs=parseInt(d[0].PrefValue.toString())),null!=this.dShowBasicAs&&this.dShowBasicAs>0&&this.dsD.Tables.length>7&&this.dsD.Tables[7].length>0){let u=this.dsD.Tables[7].filter(D=>D.ComponentID==this.dShowBasicAs);null!=u&&u.length>0&&(this.sShowBasicAs="Earning"+u[0].SNo.toString())}}if(l.Tables[2].length>0)if(null!=this.dtEdit&&this.dtEdit.length>0){let d=this.dtEdit.filter(u=>"1"==u.dcAlpha1&&"1"==u.dcAlpha2);null!=d&&d.length>0&&(this.dGratuityTaken=parseFloat(""==n.J0.String(d[0].dcAlpha32)?"0":d[0].dcAlpha32))}else this.dGratuityTaken=parseFloat(l.Tables[2][0].GratuityTaken);if(!(l.Tables[0].length>0))return void(this.ViewModel.DisplayMessage="Gratuity settings not found for this Grade.");{this.EOS_ROffYear=n.J0.DoubleTryParse(l.Tables[0][0].ROffYear);let D,d=this.dtpDateOfJoining.Date.Date(),u=this.dtpDateOfRelieving.Date.Date();if(this.EOS_ROffYear>0){let S=0,C=0;if(n.J0.GetYearsMonthsDays(d,u,{iY22:0,iM22:S,iD22:C}),S>=this.EOS_ROffYear){let b=0;C>0?(b=12-S,u=u.AddMonths(b).AddDays(-C)):u=u.AddMonths(-S).AddDays(-C)}else u=u.AddMonths(-S).AddDays(-C)}if(this.LoadExperinceDaysData(this.lst,l.Tables[0],"Resigned"==this.cmbResignType.SelectedValue?0:"Expired"==this.cmbResignType.SelectedValue?2:1),this.GratuityDocID=parseInt(l.Tables[0][0].DocID),this.GratuityGrade=parseInt(l.Tables[0][0].GradeID),this.EOS_MaxDays=n.J0.Double(l.Tables[0][0].MaxDays),this.EOS_ExcludeLOP=l.Tables[0][0].ExcludeLOP.toString(),this.LopBasedOnLopLeave=l.Tables[0][0].LopBasedOnLopLeave.toString(),this.EOS_ROff=n.J0.Double(l.Tables[0][0].ROff),this.EOS_CalcBasedOn=l.Tables[0][0].CalcBasedOn.toString(),this.EOS_GratuityFormula=l.Tables[0][0].Formula.toString(),this.EOS_AvailedFormula=null!=l.Tables[0][0].AvailedFormula&&null!=l.Tables[0][0].AvailedFormula&&""!=l.Tables[0][0].AvailedFormula.toString().Trim()?l.Tables[0][0].AvailedFormula.toString():"GratuityAmount","Exclude at Last"==this.EOS_ExcludeLOP){this.EOS_ExcludeLOP="No";let m={PayrollMonth:s=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:a=new Date};n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,m),s=m.PayrollMonth,a=m.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,m,this.EmpGrade),s=m.PayrollMonth,a=m.PayrollMonthEnd);let S=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),C=s,f=0;if("LOP Leave"==this.LopBasedOnLopLeave)f=this.GetLOPDaysFromDoc(S,a),this.dLOPDays+=f;else{f=this.GetPreviousLOPDays(S,C),this.dLOPDays+=f;let b=o.d.common.GetDataSet3("CRM024",this.EmpSeqNo.toString(),S.ToString("dd/MMM/yyyy"),C.ToString("dd/MMM/yyyy"));null!=b&&b.Tables.length>0&&(b.Tables[0].length>0&&(this.dLOPDays+=parseFloat(b.Tables[0][0].LOP.toString())),b.Tables[1].length>0&&(this.dLOPDays-=parseFloat(b.Tables[1][0].LOP.toString())))}u=u.AddDays(-this.dLOPDays)}for(let m=0;m<8;m++)D=new A.O7,D.DisplayMember="Column"+m,D.ReadOnly=!0,D.Header="",D.Width=0==m?150:80,this.dgvGratuity.Columns.push(D),this.dgvGratuity.TableColumns.push(D.DisplayMember);if(this.dgvGratuity.RefreshColumns(),this.dActServiceDays=u.Subtract(d).Days+1,"Service Days"==this.EOS_CalcBasedOn){if(this.dServiceDaysAfterLOP=0,"No"!=this.EOS_ExcludeLOP){var s,a;let f={PayrollMonth:s=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:a=new Date};n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,f),s=f.PayrollMonth,a=f.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,f,this.EmpGrade),s=f.PayrollMonth,a=f.PayrollMonthEnd);let b=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),M=s,x=0;if("LOP Leave"==this.LopBasedOnLopLeave)x=this.GetLOPDaysFromDoc(b,a),this.dLOPDays+=x;else{x=this.GetPreviousLOPDays(b,M),this.dLOPDays+=x;let Q=o.d.common.GetDataSet3("CRM025",this.EmpSeqNo.toString(),b.ToString("dd/MMM/yyyy"),M.ToString("dd/MMM/yyyy"));null!=Q&&Q.Tables.length>0&&Q.Tables[0].length>0&&(this.dLOPDays+=parseFloat(Q.Tables[0][0].LOP.toString()))}}this.dServiceDaysAfterLOP=this.dActServiceDays-this.dLOPDays,this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("ServiceDays",this.dActServiceDays.toString()),this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("LOPDays",this.dLOPDays.toString()),this.EOS_AvailedFormula=this.EOS_AvailedFormula.Replace("ServiceDays",this.dActServiceDays.toString())}this.dblGratuityAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.dShowBasicAs>0&&(this.dShowBasicAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1][this.sShowBasicAs]));let h=this.dtpDateOfJoining.Date.Date(),c=this.dtpDateOfRelieving.Date.Date(),g=0,r=0,p=0,v={iY:g,iM:r,iD:p};if(n.J0.GetYearsMonthsDays(h,c,v),g=v.iY,r=v.iM,p=v.iD,"Service Days"==this.EOS_CalcBasedOn){this.CalcGratuityBasedOnServiceDays(this.dblGratuityAmount,d,u,t,this.dShowBasicAmount);let m=0,S=0,C=0,f={iY:m,iM:S,iD:C};n.J0.GetYearsMonthsDays(d,u,f),m=f.iY,S=f.iM,C=f.iD,this.lblGratuityTotalDays=m+" : "+this.GetResource("Years",40095)+", "+S+" : "+this.GetResource("Months",40095)+", "+C+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=t.dTotGratuitySal.ToString(o.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount(),this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let b={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),b),this.oEvalPayFormulas.PayrollMonth=b.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=b.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=b.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),f,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=b.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=b.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=b.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new j.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),l.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(l.Tables[1].length);for(let M=0;M<l.Tables[1].length;M++)this.oCPF=new j.ph,this.oCPF.ComponentName="Lookup"+l.Tables[1][M].NodeID.toString(),this.oCPF.SNo=M+1,null!=l.Tables[0][0][l.Tables[1][M].SysColumnName.toString()]&&null!=l.Tables[0][0][l.Tables[1][M].SysColumnName.toString()]&&(this.oCPF.Formula=l.Tables[0][0][l.Tables[1][M].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[M].dgColOthAddParticulars=parseInt(l.Tables[1][M].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[M])}this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=g,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let M=0;M<this.oEvalPayFormulas.arrLstCPFields[6].length;M++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][M].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(o.d.SessionManager.sPayrollDecimals):(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][M].dEarned).ToString(o.d.SessionManager.sPayrollDecimals);else for(let x=0;x<this.dgvOthAdd.Table.length;x++)if(this.oEvalPayFormulas.arrLstCPFields[6][M].ComponentName=="Lookup"+n.J0.String(this.dgvOthAdd.Table[x].dgColOthAddParticulars)){this.dgvOthAdd.Table[x].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][M].dEarned).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[x]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}return}let T,P=d,V=0,k=0,I=0,O={iY:V,iM:k,iD:I};n.J0.GetYearsMonthsDays(d,u,O),V=O.iY,k=O.iM,I=O.iD;let R=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked,Y=this.dblGratuityAmount,N=new Array,L=new Array,G=new Array;N.push(P);for(let m=0;m<this.lst.length;m++){if(V<parseInt(this.lst[m].Year.Replace("=",""))){L.push(u),G.push(G.length>0?G[G.length-1]:0);break}if(this.lst[m].Days>0){if(this.lst[m].IsApplyToPrevYrs)for(let S=0;S<G.length;S++)G[S]=this.lst[m].Days;if(T=P.AddYears(parseInt(this.lst[m].Year.Replace("=",""))).AddDays(-1),T>=u){T=u,L.push(T),G.push(this.lst[m].Days);break}G.Contains(this.lst[m].Days)?(L[L.length-1]=T,N[N.length-1]=T.AddDays(1)):(G.push(this.lst[m].Days),L.push(T),N.push(T.AddDays(1)))}}if(this.isLast=!1,N.length>0)for(let m=0;m<N.length;m++)if(m==N.length-1&&(this.isLast=!0),R){if(N.length>m+1)if(G[m]!=G[m+1]){if(this.CalcGratuityDays(G[m],Y,N[m],L[m],this.dShowBasicAmount,t),this.isMaxDaysExceded)break}else L[m]=L[m+1],N.RemoveAt(m+1),L.RemoveAt(m+1),G.RemoveAt(m+1),m--;else if(this.isConsdExpiredupto){if(this.CalcGratuityDays(G[m],Y,N[m],this.dtActRelievingDate,this.dShowBasicAmount,t),this.isMaxDaysExceded||(this.CalcGratuityDays(G[m],Y,this.dtActRelievingDate.AddDays(1),L[m],this.dShowBasicAmount,t),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(G[m],Y,N[m],L[m],this.dShowBasicAmount,t),this.isMaxDaysExceded)break}else{let S=0;if(N.length>m+1)if(G[m]!=G[m+1]){let C=this.dsD.Tables[3].filter(b=>n.J0.ParseDate(b.dtEffectFrom)>=N[m].AddDays(1)&&n.J0.ParseDate(b.dtEffectFrom)<=L[m]),f=this.dsD.Tables[3].filter(b=>n.J0.ParseDate(b.dtEffectFrom)<=N[m]);if(f.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=C&&C.length>0){let M,b=0;for(b=0;b<C.length;b++)if(0==b){if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(f[0][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(f[0].BasicMonthly),N[m],n.J0.ParseDate(C[b].dtEffectFrom).AddDays(-1),S,t),this.isMaxDaysExceded){M=!0;break}}else if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(C[b-1][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(C[b-1].BasicMonthly),n.J0.ParseDate(C[b-1].dtEffectFrom),n.J0.ParseDate(C[b].dtEffectFrom).AddDays(-1),S,t),this.isMaxDaysExceded){M=!0;break}if(M||(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(C[b-1][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(C[b-1].BasicMonthly),n.J0.ParseDate(C[b-1].dtEffectFrom),L[m],S,t),this.isMaxDaysExceded))break}else if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(f[0][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(f[0].BasicMonthly),N[m],L[m],S,t),this.isMaxDaysExceded)break}else L[m]=L[m+1],N.RemoveAt(m+1),L.RemoveAt(m+1),G.RemoveAt(m+1),m--;else{let C=this.dsD.Tables[3].filter(b=>n.J0.ParseDate(b.dtEffectFrom)>=N[m].AddDays(1)&&n.J0.ParseDate(b.dtEffectFrom)<=L[m]),f=this.dsD.Tables[3].filter(b=>n.J0.ParseDate(b.dtEffectFrom)<=N[m]);if(f.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=C&&C.length>0){let M,b=0;for(b=0;b<C.length;b++)if(0==b){if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(f[0][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(f[0].BasicMonthly),N[m],n.J0.ParseDate(C[b].dtEffectFrom).AddDays(-1),S,t),this.isMaxDaysExceded){M=!0;break}}else if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(C[b-1][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(C[b-1].BasicMonthly),n.J0.ParseDate(C[b-1].dtEffectFrom),n.J0.ParseDate(C[b].dtEffectFrom).AddDays(-1),S,t),this.isMaxDaysExceded){M=!0;break}if(M||(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(C[b-1][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(C[b-1].BasicMonthly),n.J0.ParseDate(C[b-1].dtEffectFrom),L[m],S,t),this.isMaxDaysExceded))break}else if(S=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(S=parseFloat(f[0][this.sShowBasicAs])),this.CalcGratuityDays(G[m],parseFloat(f[0].BasicMonthly),N[m],L[m],S,t),this.isMaxDaysExceded)break}}let H=0,W=0,$=0,q={iY:H,iM:W,iD:$};n.J0.GetYearsMonthsDays(d,u,q),H=q.iY,W=q.iM,$=q.iD,this.lblGratuityTotalDays=H+" : "+this.GetResource("Years",40095)+", "+W+" : "+this.GetResource("Months",40095)+", "+$+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=t.dTotGratuitySal.ToString(o.d.SessionManager.sPayrollDecimals);let X=this.dtpDateOfRelieving.Date.Date().Subtract(d.Date()).Days+1;if(this.lblGratuityServiceDays=X.toString(),this.lblGratuityLOPDays=this.dLOPDays.toString(),this.lblGratuityBalDays=(X-this.dLOPDays).toString(),this.lblGratuityTotalGrDays=this.dTotGratuityDays.toString(),this.lblGratuityTaken=this.dGratuityTaken.toString(),this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),v={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),v),this.oEvalPayFormulas.PayrollMonth=v.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=v.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=v.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),v,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=v.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=v.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=v.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new j.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),l.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(l.Tables[1].length);for(let m=0;m<l.Tables[1].length;m++)this.oCPF=new j.ph,this.oCPF.ComponentName="Lookup"+l.Tables[1][m].NodeID.toString(),this.oCPF.SNo=m+1,n.J0.IsEmpty(l.Tables[0][0][l.Tables[1][m].SysColumnName.toString()])||(this.oCPF.Formula=l.Tables[0][0][l.Tables[1][m].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[m].dgColOthAddParticulars=parseInt(l.Tables[1][m].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[m])}this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=g,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let m=0;m<this.oEvalPayFormulas.arrLstCPFields[6].length;m++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][m].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(o.d.SessionManager.sPayrollDecimals):(0).ToString(o.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][m].dEarned).ToString(o.d.SessionManager.sPayrollDecimals);else for(let S=0;S<this.dgvOthAdd.Table.length;S++)if(this.oEvalPayFormulas.arrLstCPFields[6][m].ComponentName=="Lookup"+n.J0.String(this.dgvOthAdd.Table[S].dgColOthAddParticulars)){this.dgvOthAdd.Table[S].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][m].dEarned).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[S]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}}}}this.CalculateTotalAmount()}LoadExperinceDaysData(t,s,i){t.Clear();let a="Res";1==i?a="Term":2==i&&(a="Expired");for(let l=0;l<s.length;l++)t.push(new ut),t[l].Year=s[l][a+"Exp"].toString().Contains("+")?s[l][a+"Exp"].toString().Replace("[+]",""):"="+s[l][a+"Exp"].toString(),t[l].Days=parseFloat(s[l][a+"GrDays"]),t[l].IsApplyToPrevYrs="Yes"==s[l][a+"ApplyPrevYrs"].toString()}CalcGratuityDays(t,s,i,a,l,d){this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity/Year",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=t;let u=t,D="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),D=this.GetResource("Start Date",40095)+i.ToString("dd/MMM/yyyy")+"          ",D+=this.GetResource("End Date",40095)+a.ToString("dd/MMM/yyyy");let c=0,g=0,r=0,p=this.dtpDateOfJoining.Date.Date(),v=this.dtpDateOfRelieving.Date.Date(),P=0,T=0,w=0,_={iY:P,iM:T,iD:w};n.J0.GetYearsMonthsDays(p,a,_),P=_.iY,T=_.iM,w=_.iD;let V=0,k=0,I=0,O={iY:V,iM:k,iD:I};n.J0.GetYearsMonthsDays(i,a,O),V=O.iY,k=O.iM,I=O.iD;let R=0;if("No"!=this.EOS_ExcludeLOP){var J=new Date,Y=new Date,N=new Date,L={PayrollMonth:J,PayrollMonthStart:Y,PayrollMonthEnd:N};if(n.J0.SetPayrollDate_1(a,L),J=L.PayrollMonth,Y=L.PayrollMonthStart,N=L.PayrollMonthEnd,o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(n.J0.SetPayrollDate_1(a,L,this.EmpGrade),J=L.PayrollMonth,Y=L.PayrollMonthStart,N=L.PayrollMonthEnd),"LOP Leave"==this.LopBasedOnLopLeave)R=this.GetLOPDaysFromDoc(i,a);else{R=this.GetPreviousLOPDays(i,J);let f=o.d.common.GetDataSet3("CRM026",this.EmpSeqNo.toString(),i.ToString("dd/MMM/yyyy"),J.ToString("dd/MMM/yyyy"));null!=f&&f.Tables.length>0&&f.Tables[0].length>0&&(R+=parseFloat(f.Tables[0][0].LOP.toString()))}let S=a;S=i==this.dtpDateOfJoining.Date.Date()?S.AddDays(-(this.dLOPDays+R)):S.AddDays(-R);let C={iY:V,iM:k,iD:I};n.J0.GetYearsMonthsDays(i,S,C),V=C.iY,k=C.iM,I=C.iD,this.dLOPDays+=R}c=V*u,g=k/12*u,r=I/365*u,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=i.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=a.ToString("dd/MMM/yyyy"),"Exclude at Last"==this.ActEOS_ExcludeLOP&&a.ToString("dd MMM yyyy")==v.AddDays(-this.dLOPDays).ToString("dd MMM yyyy")&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Actual End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=v.ToString("dd/MMM/yyyy"));let G=!!this.chkCalcBasedOnActDays.IsChecked&&this.chkCalcBasedOnActDays.IsChecked,H=0,W=0,$=0;if(G){let f,S=i,C=a,b=0,M=0;for(;S<=C;){if(f=new Date(S.getFullYear(),S.getMonth(),S.DaysInMonth()),!(f<=C)){b=C.Subtract(S).Days+1,W+=b,M=s*b/f.getDate(),$+=M;break}b=f.Subtract(S).Days+1,W+=b,M=s*b/f.getDate(),$+=M,S=f.AddDays(1)}H=$/W}let q=a.Subtract(i).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let X=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dShowBasicAs>0?l:s,X=s,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=V+" : "+this.GetResource("Years",40095)+", "+k+" : "+this.GetResource("Months",40095)+", "+I+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=q,"Exclude at Last"==this.ActEOS_ExcludeLOP?this.isLast&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Total LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=this.dLOPDays):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=R),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("Months",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=V,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=k,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=I,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Available Gratuity",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=c,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=g,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=r;let m=c+g+r;if(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=m,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",m=y.RoundOffValue(m,this.EOS_ROff),this.EOS_MaxDays>0&&this.dEarnedGrDays+m>=this.EOS_MaxDays?(m=this.EOS_MaxDays-this.dEarnedGrDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=m,this.isMaxDaysExceded=!0):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=m,this.dEarnedGrDays+=m),this.dTotGratuityDays+=m,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity",40095),G)this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=$+" / "+W,X=H*m;else{let S=this.dtpDateOfJoining.Date.Date(),C=this.dtpDateOfRelieving.Date.Date(),f=0,b=0,M=0,x={iY:f,iM:b,iD:M};n.J0.GetYearsMonthsDays(S,C,x),f=x.iY,b=x.iM,M=x.iD;let Q=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked;this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),x={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},Q?(n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),x),o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),x,this.EmpGrade)):(n.J0.SetPayrollDate_1(i.Date(),x),o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&n.J0.SetPayrollDate_1(i.Date(),x,this.EmpGrade)),this.oEvalPayFormulas.PayrollMonth=x.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=x.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=x.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new j.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula.Replace("GratuityDays",m.toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=s,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=f,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let Z=0;Z<this.oEvalPayFormulas.arrLstCPFields[6].length;Z++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][Z].ComponentName){X=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][Z].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=X,d.dTotGratuitySal+=X,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.refreshDataView()}GetPreviousLOPDays(t,s){let i=0,a=o.d.common.GetDataSet3("CRM027",this.EmpSeqNo.toString(),t.ToString("dd/MMM/yyyy"),s.ToString("dd/MMM/yyyy")).Tables[0];return null!=a&&a.length>0&&(i=parseFloat(a[0].LOPDays)),i}GetLOPDaysFromDoc(t,s){let i=0;if(o.d.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=o.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){let a=[];a.push(this.EmpSeqNo),a.push(t.ToString("dd/MMM/yyyy")),a.push(t.ToString("dd/MMM/yyyy")),a.push(s.ToString("dd/MMM/yyyy")),a.push(2),a.push(o.d.SessionManager.UserID),a.push(o.d.SessionManager.RoleID),a.push(o.d.SessionManager.LanguageID);let l=o.d.common.GetDataSet_SP(a,"spPAY_GetEmpAdjDetailsMultiple"),d=[];d.push(t.ToString("dd MMM yyyy")),d.push(""),d.push(0),d.push(o.d.SessionManager.RoleID),d.push(o.d.SessionManager.UserID),d.push(o.d.SessionManager.LanguageID);let u=o.d.common.GetDataSet_SP(d,"spPAY_GetEmpMasterCCDetails");null!=l&&l.Tables.length>0&&l.Tables[0].length>0&&l.Columns[0].Contains("EmpSeqNo")&&(i=this.AggregateLeaves(this.EmpSeqNo.toString(),l,t,s,u,this.dsD.Tables[0],this.EmpGrade))}return i}static RoundOffValue(t,s){if(s>0&&t>0){let i=0,a=!1;i=t%s,i>0&&(s/i<=2&&(a=!0),t-=i,a&&(t+=s))}return t}CalcGratuityBasedOnServiceDays(t,s,i,a,l){this.dgvGratuity.addEmptyRow();let d="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),d=this.GetResource("Start Date",40095)+s.ToString("dd/MMM/yyyy")+"          ",d+=this.GetResource("End Date",40095)+i.ToString("dd/MMM/yyyy");let u=0,D=0,h=0,c={iY:u,iM:D,iD:h};n.J0.GetYearsMonthsDays(s,i,c),u=c.iY,D=c.iM,h=c.iD,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=s.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=i.ToString("dd/MMM/yyyy");let g=i.Subtract(s).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let r=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dShowBasicAs>0?l:t,r=t,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=u+" : "+this.GetResource("Years",40095)+", "+D+" : "+this.GetResource("Months",40095)+", "+h+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=g,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Total Duration Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Service Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dActServiceDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.dLOPDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.dServiceDaysAfterLOP,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dServiceDaysAfterLOP,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]="/",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]="365";let p=this.dServiceDaysAfterLOP/365;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=p,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=p,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity Amount",40095);{this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let v={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),v),o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),v,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=v.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=v.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=v.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new j.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=t,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=u,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let P=0;P<this.oEvalPayFormulas.arrLstCPFields[6].length;P++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][P].ComponentName){this.dServiceDaysFormulaAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][P].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.dServiceDaysFormulaAmount,a.dTotGratuitySal+=this.dServiceDaysFormulaAmount,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]="* * * * *"}dgvLeaveEncash_CellValidating(t,s){}btnCalcLeaveEncash_Click(){let t=this.chkLECalcBasedOnLastApprSerYearWise.IsChecked;this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let s={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),s),o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&n.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),s,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=s.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=s.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=s.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear();let i=0;if(this.dgvLeaveEncash.Table.length>0){for(let l=0;l<this.dgvLeaveEncash.Table.length;l++)t&&this.dgvLeaveEncash.Table[l].dgColLELeaveType_Tag==this.sVacTypeSeqNo||n.J0.IsEmpty(this.dgvLeaveEncash.Table[l].dgColLEApplied)||(n.J0.IsEmpty(this.dgvLeaveEncash.Table[l].dgColLEAmount_Tag)||(this.strFormula=this.dgvLeaveEncash.Table[l].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays",this.dgvLeaveEncash.Table[l].dgColLELeaveType_Tag==this.sVacTypeSeqNo?"("+this.dgvLeaveEncash.Table[l].dgColLEApplied.toString()+")":"("+this.dgvLeaveEncash.Table[l].dgColLEApplied.toString().Replace("-","!")+")"),this.oCPF=new j.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[l+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[l+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF));this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas();for(let l=0;l<this.dgvLeaveEncash.Table.length;l++)if((!t||this.dgvLeaveEncash.Table[l].dgColLELeaveType_Tag!=this.sVacTypeSeqNo)&&0!=n.J0.Double(this.dgvLeaveEncash.Table[l].dgColLEApplied))for(let d=0;d<this.oEvalPayFormulas.arrLstCPFields[6].length;d++)if(this.oEvalPayFormulas.arrLstCPFields[6][d].ComponentName=="LEFormula"+this.dgvLeaveEncash.Table[l+"_Tag"].toString()){this.dgvLeaveEncash.Table[l].dgColLEAmount=this.oEvalPayFormulas.arrLstCPFields[6][d].dEarned,i+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][d].dEarned);break}}let a=0;if(t&&this.dgvLeaveEncash.Table.length>0)for(let l=0;l<this.dgvLeaveEncash.Table.length;l++)if(this.dgvLeaveEncash.Table[l].dgColLELeaveType_Tag.toString()==this.sVacTypeSeqNo){if(!n.J0.IsEmpty(this.dgvLeaveEncash.Table[l].dgColLEApplied)&&parseFloat(this.dgvLeaveEncash.Table[l].dgColLEApplied)>0){let c,g,u=parseFloat(this.dgvLeaveEncash.Table[l].dgColLEApplied),D=0,h=null;try{c=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate())}catch{c=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate()-1)}for(c>this.dtpDateOfRelieving.Date&&(c=c.AddYears(-1)),g=this.dtpDateOfRelieving.Date;u>0;){h=this.ViewModel.GetVacationDays(c,g,this.EmpSeqNo),D=parseFloat(h.Tables[1][0].CreditedDays),D>u&&(D=u),this.oEvalPayFormulas=new j.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let r={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};n.J0.SetPayrollDate_1(g,r),o.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==o.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&n.J0.SetPayrollDate_1(g,r,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=r.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=r.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=r.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),null!=this.dgvLeaveEncash.Table[l].dgColLEAmount_Tag&&""!=this.dgvLeaveEncash.Table[l].dgColLEAmount_Tag.toString().Trim()&&(this.strFormula=this.dgvLeaveEncash.Table[l].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+D.toString().Replace("-","!")+")"),this.oCPF=new j.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[l+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[l+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.oEvalPayFormulas.dsAllEmpsData.Tables[2][this.dsD.Tables[2].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),a+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned),u=parseFloat((u-D).ToString("0.00")),g=c.AddDays(-1),c=c.AddYears(-1)}this.dgvLeaveEncash.Table[l].dgColLEAmount=a}break}this.txtLEAmount.Text=(parseFloat(this.txtCumLeaveSalBalAmt.Text)+i+a).ToString(o.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.invalidate(),this.CalculateTotalAmount()}dgvUPS_CellClick(t,s){if("dgColUPSCalc"==this.dgvUPS.Columns[t.cell].DisplayMember){n.J0.SetPayrollMonth(n.J0.ParseDate(this.dgvUPS.Table[t.row].dgColUPSPayrollMonth));let i=new ie.MonthlyPayrollViewModel("Monthly Payroll","UnProcessed");i.sProcessType="UnProcessed",i.SelectedEmpID=this.EmpSeqNo,i.EmployeeList.Code.SelectedValue=i.EmployeeList.Name.SelectedValue=this.EmpSeqNo,i.EmployeeList.Code.Text=i.EmployeeList.Name.Text=this.EmployeeList.Text,i.InitSelectedEmployee(),o.d.page.ShowDialog(i,ne.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{i.DialogResult&&(this.dgvUPS.Table[t.row].dgColUPSDaysAtt=i.dFS_DaysAttended,this.dgvUPS.Table[t.row].dgColUPSLOP=i.dFS_LOPDays,this.dgvUPS.Table[t.row].dgColUPSNetSal=i.dFS_NetSal,this.dgvUPS.updateRow(this.dgvUPS[t.row]));let a=0;if(this.dgvUPS.Table.length>0)for(let l=0;l<this.dgvUPS.Table.length;l++)a+=parseFloat(this.dgvUPS.Table[l].dgColUPSNetSal);this.txtUPSAmount.Text=a.ToString(o.d.SessionManager.sPayrollDecimals),this.dgvUPS.invalidate(),this.CalculateTotalAmount()})}}dgvNoticePay_CellClick(t,s){if("dgColNPCalc"==this.dgvNoticePay.Columns[t.cell].DisplayMember){n.J0.SetPayrollMonth(n.J0.ParseDate(this.dgvNoticePay.Table[t.row].dgColNPPayrollMonth));let i=new ie.MonthlyPayrollViewModel("Monthly Payroll","NoticePay");i.sProcessType="NoticePay",i.SelectedEmpID=this.EmpSeqNo,i.EmployeeList.Code.SelectedValue=i.EmployeeList.Name.SelectedValue=this.EmpSeqNo,i.EmployeeList.Code.Text=i.EmployeeList.Name.Text=this.EmployeeList.Text,i.InitSelectedEmployee(),o.d.page.ShowDialog(i,ne.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{i.DialogResult&&(this.dgvNoticePay.Table[t.row].dgColNPDaysAtt=i.dFS_DaysAttended,this.dgvNoticePay.Table[t.row].dgColNPLOP=i.dFS_LOPDays,this.dgvNoticePay.Table[t.row].dgColNPNetSal=i.dFS_NetSal,this.dgvNoticePay.updateRow(this.dgvNoticePay[t.row])),this.dgvNoticePay.Update(),this.CalculateNoticePayAmount()})}}CalculateNoticePayAmount(){let t=0;if(this.dgvNoticePay.Table.length>0)for(let s=0;s<this.dgvNoticePay.Table.length;s++)"Add"==n.J0.String(this.dgvNoticePay.Table[s].dgColNPType)?t+=parseFloat(this.dgvNoticePay.Table[s].dgColNPNetSal):"Subtract"==n.J0.String(this.dgvNoticePay.Table[s].dgColNPType)&&(t-=parseFloat(this.dgvNoticePay.Table[s].dgColNPNetSal));this.txtNPAmount.Text=t.ToString(o.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthAdd_CellEndEdit(t,s){null==s&&(s=t.cell),"dgColOthAddAmount"==this.dgvOthAdd.Columns[s].DisplayMember&&(this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd")),"dgColOthAddAmount"==this.dgvOthAdd.Columns[s].DisplayMember&&this.CalculateOthAddAmount()}dgvOthAdd_RowsAdded(t,s){this.GenerateSerialNos(this.dgvOthAdd)}CalculateOthAddAmount(){let t=0;for(let s=0;s<this.dgvOthAdd.Table.length;s++)n.J0.IsEmpty(this.dgvOthAdd.Table[s].dgColOthAddAmount)||(t+=parseFloat(this.dgvOthAdd.Table[s].dgColOthAddAmount));this.txtOthAddAmount.Text=t.ToString(o.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthDed_CellEndEdit(t,s){null==s&&(s=t.cell),"dgColOthDedAmount"==this.dgvOthDed.Columns[s].DisplayMember&&(this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")),"dgColOthDedAmount"==this.dgvOthDed.Columns[s].DisplayMember&&this.CalculateOthDedAmount()}dgvOthDed_RowsAdded(t,s){this.GenerateSerialNos(this.dgvOthDed)}CalculateOthDedAmount(){let t=0;for(let s=0;s<this.dgvOthDed.Table.length;s++)n.J0.IsEmpty(this.dgvOthDed.Table[s].dgColOthDedAmount)||(t+=parseFloat(this.dgvOthDed.Table[s].dgColOthDedAmount));this.txtOthDedAmount.Text=t.ToString(o.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dtpDateOfRelieving_SelectedDateChanged(t,s){this.PrevEmpSeqNo==this.EmpSeqNo&&0==n.J0.GetDateDifference(this.dtpDateOfRelieving.Date,this.dtPrevDateOfRelieving)||(this.PrevEmpSeqNo=this.EmpSeqNo,this.dtPrevDateOfRelieving=this.dtpDateOfRelieving.Date,this.RefreshLeaveEncashDetails())}btnSaveAndPrint_Click(t){this.ViewModel.SelectedEmpID>0?(this.Save_Click(),this.ViewModel.IsSaved&&this.ViewModel.DocID>0&&(this.PrintFS("SaveAndPrint"),this.ViewModel.IsSaved=!1,this.ViewModel.SelectedEmpID=0)):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrint_Click(t){return this.ViewModel.DocID>0?(this.PrintFS("Print"),""):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0,"")}PrintFS(t){this.MoreThanOneLayout=!1;let i=this.ViewModel.DocID;this.IsExportPrint=!1;let a=null,l=ve.VoucherExportExcel.GetLocationPrintLayouts(50051,0,i);if(this.IsExportPrint)a=null;else{if(null==l||0==l.Tables[0].length)return o.d.GetResource("Err_PrintLayoutNotDefined");if(l.Tables[0].length>1){this.MoreThanOneLayout=!0;let d=new Se.VPTDialogViewModel(l.Tables[0]);o.d.page.ShowDialog(d,fe.VPTDialogComponent,{ShowCenter:!0},()=>{if(d.IsOkClicked&&(a=d.SelectedRow),null!=a){let D=new te.bT;D.push("IsFSDoc","1"),o.d.report.ExportPDF_Masters(50051,i.toString(),parseInt(a.DocPrintLayoutID),"PDF","",D).subscribe(h=>{"Export"==t?o.d.SessionManager.Download(h.FileName,h.FileName):(o.d.SessionManager.printTab(h.FileName),n.J0.IsEmpty(h.Message)&&!n.J0.IsEmpty(h.FileName)&&(this.ViewModel.DisplayMessage="Printed Sucessfully"))},h=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(h)})}})}else a=l.Tables[0][0]}if(this.dsTotLayouts=l,this.drSelPrintLayout=a,null!=a&&!this.MoreThanOneLayout){let d=new te.bT;d.push("IsFSDoc","1"),o.d.report.ExportPDF_Masters(50051,i.toString(),parseInt(a.DocPrintLayoutID),"PDF","",d).subscribe(u=>{console.log(u),o.d.SessionManager.Download(u.FileName,u.FileName),o.d.SessionManager.printTab(u.FileName),n.J0.IsEmpty(u.Message)&&!n.J0.IsEmpty(u.FileName)&&(this.ViewModel.DisplayMessage="printed Successfully")},u=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(u)})}return""}btnPrintPreview_Click(t){this.ViewModel.DocID>0?this.PrintFS("Preview"):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnExport_Click(t){if(!(this.ViewModel.DocID>0))return this.ViewModel.DisplayMessage="Load document in Edit Mode",void(this.ViewModel.MessageVisibility=!0);this.PrintFS("Export")}dgvLoanBal_CellClick(t,s){var i=this;return(0,he.A)(function*(){if("dgColLoanBalCalc"==i.dgvLoanBal.Columns[t.cell].DisplayMember){let d=o.d.common.GetDataTable("CRM028","");if(null!=d&&d.length>0){let u,D=Date.Today(),h=i.dsD.Tables[11].filter(c=>c.RefNo==i.dgvLoanBal.Table[t.row].dgColLoanBalDocNo);if(h.length>0){u=new le.AddEditDocumentViewModel(40057,"Loan Repayment",!0,"IsFrmFS_LoanBal"),u.ScreenObject.Link.LinkCombo.Enable=!1,u.ScreenObject.Link.DocumentList.Enable=!1,u.ScreenObject.Preferences.Selective="false";let c={value:D};u.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(h[0].DocID),c,!1),D=c.value}else{u=new le.AddEditDocumentViewModel(40057,"Loan Repayment",!1,"IsFrmFS_LoanBal"),u.ScreenObject.Link.LinkCombo.SelectedValue=d[0].DocumentLinkDefID.toString(),u.ScreenObject.Link.LinkCombo.Enable=!1,u.ScreenObject.Link.DocumentList.Enable=!1,u.ScreenObject.Preferences.Selective="false";let c=u.ScreenObject._CCFields.find(g=>"dcCCNID51"==g.DBColumnName);null!=c&&(c instanceof ue.y$||c instanceof be.G)&&(c.SelectedValue=i.EmpSeqNo),u.OLinkSelectionChanged(null)}u.IsFrmFS_LoanBal=!0;var a=u.ScreenObject.HeaderFields.find(c=>c instanceof se.MI&&"DocDate"==c.DBColumnName.toString());a&&(a.Enable=!1),(a=u.ScreenObject.HeaderFields.find(c=>c instanceof se.MI&&"VoucherNo"==c.DBColumnName.toString()))instanceof ye.e3&&(a.Enable=!1,a.LoadVisibility=!1,a.PreviousVisibility=!1,a.NextVisibility=!1);var l=u.ScreenObject.Link.DocumentList.Items.find(c=>c.Value==i.dgvLoanBal.Table[t.row].dgColLoanBalDocNo_Tag.toString());l&&(l.IsChecked=!0,u.OnLinkDocumentCheckedChanged(l)),(a=u.ScreenObject._CCFields.find(c=>"dcCCNID51"==c.DBColumnName))&&(a.Enable=!1),(a=u.ScreenObject._TextFields.find(c=>"dcAlpha6"==c.DBColumnName))instanceof B.Dw&&(a.Text="FFS_LoanBalances");for(let c=0;c<u.ScreenObject.GridData.length;c++)n.J0.IsEmpty(u.ScreenObject.GridData[c].ProductID_Key)||(u.ScreenObject.GridData[c].dcAlpha5=i.dtpDocDate.Date.ToString(o.d.SessionManager.Preferences["Date Format"]),u.ScreenObject.GridData[c].dcAlpha5_Key=i.dtpDocDate.Date.toString());yield o.d.page.openDialog(u,me.AddEditDocumentComponent),u.DialogResult&&(i.txtLoanBalAmount.Text=(parseFloat(i.txtLoanBalAmount.Text)+u.dFS_LoanAmt).ToString(o.d.SessionManager.sPayrollDecimals),i.dgvLoanBal.Table[t.row].dgColLoanBalCalc_Tag="Paid",i.dgvLoanBal.Table[t.row].dgColLoanBalSNo_Tag=u.RetValue,i.dgvLoanBal.updateRow(i.dgvLoanBal.Table[t.row])),i.CalculateTotalAmount()}}})()}NumberValidationTextBox(t,s){}GetResource(t,s){let i=t;return null!=this.ViewModel.dsRes1&&this.ViewModel.dsRes1.Tables.length>0&&this.ViewModel.dsRes1.Tables[0].length>0&&(this.drwRes=this.ViewModel.dsRes1.Tables[0].filter(a=>a.CCID==s&&a.Code=="'"+t+"'")),null!=this.drwRes&&this.drwRes.length>0?this.drwRes[0].AliasName.toString():i}cmbSettlementType_SelectionChanged(t,s){this.txtPartialGratuityAmount.IsReadOnly="Partial"!=this.cmbSettlementType.SelectedValue}AggregateLeaves(t,s,i,a,l,d,u){let r,p,w,D=0,h=0,g=0,v=o.d.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),P=" 1=1 ",T="";if(w=s.Tables[2],null!=v&&null!=v&&v.length>0)for(let O=0;O<v.length;O++)n.J0.IsEmpty(v[O])||(T="CCNID"+(parseInt(v[O])-5e4),r=l.Tables[0].filter(R=>R.EmpSeqNo==t),null!=r&&r.length>0&&(T.Contains("CCNID51")?(P+=" AND ( "+T+"="+r[0].EmpSeqNo+" OR "+T+"= 1)",w=w.filter(R=>R[T]==r[0].EmpSeqNo||1==R[T])):(P+=" AND ( "+T+"="+r[0][T]+" OR "+T+"= 1)",w=w.filter(R=>R[T]==r[0][T]||1==R[T]))));" 1=1 "!=P&&(this.drcWOffAdjDef=w);let V,k,I,_=s.Tables[3];if(v=o.d.SessionManager.Preferences.HolidaysBasedOn.split(","),P=" 1=1 ",T="",null!=v&&null!=v&&v.length>0)for(let O=0;O<v.length;O++)n.J0.IsEmpty(v[O])||(T="CCNID"+(parseInt(v[O])-5e4),r=l.Tables[0].filter(R=>R.EmpSeqNo==t),null!=r&&r.length>0&&(T.Contains("CCNID51")?(P+=" AND ( "+T+"="+r[0].EmpSeqNo+" OR "+T+"= 1)",_=_.filter(R=>R[T]==r[0].EmpSeqNo||1==R[T])):(P+=" AND ( "+T+"="+r[0][T]+" OR "+T+"= 1)",_=_.filter(R=>R[T]==r[0][T]||1==R[T]))));if(" 1=1 "!=P&&(p=_),null!=p&&p.length>0&&(this.dtHolidayAdjDef=p),I=s.Tables[0].filter(O=>O.EmpSeqNo==t),!n.J0.IsEmpty(I)&&null!=I&&I.length>0)for(let O=0;O<I.length;O++){V=n.J0.ParseDate(I[O].FromDate),k=n.J0.ParseDate(I[O].ToDate),g=parseInt(I[O].ComponentID);let R=o.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),J=null;R.length>0&&(J=R.split(",")),V>=i?k<=a?(h=parseFloat(I[O].NoOfDays),D+=h):V<=a&&(h=this.GetNoOfDays(V,a,g,s,d,u),D+=h):k<=a?k>=i&&(h=this.GetNoOfDays(i,k,g,s,d,u),D+=h):(h=this.GetNoOfDays(i,a,g,s,d,u),D+=h)}return D}GetNoOfDays(t,s,i,a,l,d){let u=0,D=0,h=0,c=null,g=a.Tables[1].filter(r=>r.GradeID==d&&4==r.Type&&r.ComponentID==i);if(null!=g&&g.length>0){let r=t,p=g[0].IncludeRExclude.toString();if(u=n.J0.GetDateDifference(s,t)+1,"IncludeBoth"==p||""==p)return u;if("IncludeWeeklyOffs"==p)for(;r<=s;)n.J0.IsEmpty(this.dtHolidayAdjDef)||(c=this.dtHolidayAdjDef.filter(v=>v.HolidayDate==r.ToString("dd/MMM/yyyy"))),null!=c&&c.length>0&&h++,r=r.AddDays(1);else if("IncludeHolidays"==p)for(;r<=s;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(r,a,t,s,l)&&D++:("NONE"!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff1.toString()&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff1&&D++,"NONE"!=l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff2.toString()&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff2&&D++),r=r.AddDays(1);else if("ExcludeBoth"==p)for(;r<=s;){let v=!1;n.J0.IsEmpty(this.dtHolidayAdjDef)||(c=this.dtHolidayAdjDef.filter(P=>P.HolidayDate==r.ToString("dd/MMM/yyyy"))),null!=c&&c.length>0&&(h++,v=!0),null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(r,a,t,s,l)&&!v&&D++:("NONE"!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff1.toString()&&!v&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff1&&!v&&D++,"NONE"!=l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff2.toString()&&!v&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff2&&!v&&D++),r=r.AddDays(1)}else if("ExcludeWeeklyOffs"==p)for(;r<=s;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(r,a,t,s,l)&&D++:("NONE"!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff1.toString()&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff1&&D++,"NONE"!=l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?l.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=l.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&r.getDay().toString()==l.drcAllEmpsData[0].WeeklyOff2.toString()&&D++:r.getDay().toString()==o.d.SessionManager.Preferences.WeeklyOff2&&D++),r=r.AddDays(1);else if("ExcludeHolidays"==p)for(;r<=s;)n.J0.IsEmpty(this.dtHolidayAdjDef)||(c=this.dtHolidayAdjDef.filter(v=>v.HolidayDate==r.ToString("dd/MMM/yyyy"))),null!=c&&c.length>0&&h++,r=r.AddDays(1)}return u-(D+h)}CheckIsWeeklyOffFromDef(t,s,i,a,l){if(null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0){let c,d=1,D=l.DateOfRelieve<a?l.DateOfRelieve:a,h=l.DateOfJoining>i?l.DateOfJoining:i;for(;h<=D;){for(c=h.AddDays(6);h<=c&&h<=D;){if(s.Columns[2].Contains("Week"+d.toString()+"_W1")&&!n.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+d.toString()+"_W1"].toString())&&h.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+d.toString()+"_W1"].toString().toLowerCase()){if(h.ToString("dd MMM yyyy")==t.ToString("dd MMM yyyy"))return!0}else if(s.Columns[2].Contains("Week"+d.toString()+"_W2")&&!n.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+d.toString()+"_W2"].toString())&&h.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+d.toString()+"_W2"].toString().toLowerCase()&&h.ToString("dd MMM yyyy")==t.ToString("dd MMM yyyy"))return!0;h=h.AddDays(1)}d++}}return!1}get Prefix(){let t="";return null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.ComboBox.SelectedValue&&(t=this.ViewModel.DocPrefix.ComboBox.SelectedValue),t}OnDocPrefixChanged(t){this.OnDocPrefixChanged_2(t,!1),null!=t&&"lostFocus"==t.toString()||this.Clear_Click()}OnDocPrefixChanged_2(t,s=!1){if(Logger.InfoLog("FinalSettlement::Entering OnDocPrefixChanged"),null!=t)try{let i={value:this._Ddate};this.OnDocPrefixChanged_3(t,0,0,i,s),this._Ddate=i.value}catch(i){this.ViewModel.DisplayMessage="Error Loading document try again",Logger.ErrorLog("FinalSettlement","OnDocPrefixChanged",i.stack)}Logger.InfoLog("FinalSettlement::Exiting OnDocPrefixChanged")}OnDocPrefixChanged_3(t,s,i,a,l){let d=0;if(null!=t&&"lostFocus"==t.toString()){this.IsRefLCTR=!1,Logger.InfoLog("FinalSettlement:: Inside GetDocument");let h=null;n.J0.IsValidID(i)?(h=o.d.document.GetEditData(this.CostCenterID,"","","0",this.ViewModel.DocID,"",!0),null!=h&&h.Tables.length>0&&h.Columns[0].Contains("DocPrefix")&&h.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(c=>c instanceof U._p&&c.Value==h.Tables[0][0].DocPrefix.toString())||this.ViewModel.DocPrefix.ComboBox.Items.push(U._p.ComboBoxItems_2(h.Tables[0][0].DocPrefix.toString(),h.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=h.Tables[0][0].DocPrefix.toString(),this.ViewModel.DocPrefix.TextBox.Text=h.Tables[0][0].DocNumber.toString())):(h=o.d.document.GetEditData(this.CostCenterID,this.Prefix,null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:"",s,"0","",!0),null!=h&&h.Tables.length>0&&h.Columns[0].Contains("DocPrefix")&&h.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(g=>g instanceof U._p&&g.Value==h.Tables[0][0].DocPrefix.toString())||(this.ViewModel.DocPrefix.ComboBox.Items.push(U._p.ComboBoxItems_2(h.Tables[0][0].DocPrefix.toString(),h.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=h.Tables[0][0].DocPrefix.toString()))),h.Tables.length>1&&h.Tables[0].length>0&&!h.Columns[0].Contains("ErrorMessage")?(this.guid=n.J0.String(h.Tables[0][0].GUID),d=parseInt(h.Tables[0][0].StatusID),this.LoadDocument(parseInt(this.ViewModel.DocPrefix.TextBox.Text),this.Prefix),n.J0.IsEmpty(h.Tables[0][0].DocDate)||(a.value=n.J0.ParseDate(h.Tables[0][0].DocDate))):this.Clear_Click(),Logger.InfoLog("VoucherGenerator:: Exiting GetDocument")}else if(null!=t){this.IsRefLCTR=!1;let h=o.d.document.getcurrentcode(this.CostCenterID,this.Prefix);null!=h&&h.Tables.length>0&&h.Tables[0].length>0&&!h.Columns[0].Contains("ErrorMessage")&&h.Columns[0].Contains("CurrentCodeNumber")&&!n.J0.IsNullOrWhiteSpace(h.Tables[0][0].CurrentCodeNumber)?(this.ViewModel.DocPrefix.TextBox.Text=h.Tables[0][0].CurrentCodeNumber.toString(),null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&(n.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)||"1"==this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)&&h.Columns[0].Contains("Codelength")&&!n.J0.IsEmpty(h.Tables[0][0].Codelength)&&parseInt(h.Tables[0][0].Codelength)>1&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname=h.Tables[0][0].Codelength.toString())):this.ViewModel.DocPrefix.TextBox.Text="1"}}fillPrefixes(t){let s="",i=0;for(let l=0;l<t.length;l++)if(0==l&&(i=parseInt(t[l].SeriesNo.toString())),""!=t[l].SeriesNo.toString()&&parseInt(t[l].SeriesNo.toString())!=i&&(null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(s)&&this.ViewModel.DocPrefix.Prefixes.push(s,(0,z.yG0)(t[l-1].Isdefault.toString())),i=parseInt(t[l].SeriesNo.toString()),s=""),51==parseInt(t[l].CCID.toString())||52==parseInt(t[l].CCID.toString())||53==parseInt(t[l].CCID.toString()))s+="'"+t[l].Length.toString()+"'"+t[l].Delimiter.toString();else if(54==parseInt(t[l].CCID.toString()))s+=t[l].Length.toString()+t[l].Delimiter.toString();else if(parseInt(t[l].CCID.toString())>5e4){var a=this.ViewModel.oEmpFilter.CostCenterFilters.find(d=>d.CostCenterID==parseInt(t[l].CCID.toString()));null!=a&&a.SelectedNodes.length>0&&(s+=this.GetTrimString(this.ViewModel.GetDocNumberString(t[l].SysColumnName.toString(),a.CostCenterID,a.SelectedNodes[0].Id),parseInt(t[l].Length.toString()))+t[l].Delimiter.toString())}t.length>0&&null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(s)&&this.ViewModel.DocPrefix.Prefixes.push(s,(0,z.yG0)(t[t.length-1].Isdefault.toString())),this.ViewModel.FillDocumentPrefix(!1)}CheckDateInDocNumber(t,s=!0){let i=!1,a="";if(null==this.ViewModel.DocPrefix)return;let l=new te.bT;if(this.ViewModel.DocPrefix.Prefixes.keys.forEach(d=>{null!=d&&(a=d);let u=this.ViewModel.DocPrefix.Prefixes[d];a.Contains("'DD'")?(i=!0,a=this.dtpDocDate.Date.getDate()>9?a.replace("'DD'",this.dtpDocDate.Date.getDate().toString()):a.replace("'DD'","0"+this.dtpDocDate.Date.getDate().toString())):a.Contains("'D'")&&(i=!0,a=a.replace("'D'",this.dtpDocDate.Date.getDate().toString())),a.Contains("'MMM'")?(i=!0,a=a.replace("'MMM'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!1))):a.Contains("'MM'")?(i=!0,a=this.dtpDocDate.Date.iMonth()>9?a.replace("'MM'",this.dtpDocDate.Date.iMonth().toString()):a.replace("'MM'","0"+this.dtpDocDate.Date.iMonth().toString())):a.Contains("'M'")?(i=!0,a=a.replace("'M'",this.dtpDocDate.Date.iMonth().toString())):a.Contains("'Name'")&&(i=!0,a=a.replace("'Name'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!0))),a.Contains("'YYYY'")?(i=!0,a=a.replace("'YYYY'",this.dtpDocDate.Date.getFullYear().toString())):a.Contains("'YY'")?(i=!0,a=a.replace("'YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2))):a.Contains("'YY-YY'")&&(i=!0,a=this.dtpDocDate.Date.iMonth()<o.d.SessionManager.AccountingFromMonth?a.replace("'YY-YY'",(this.dtpDocDate.Date.getFullYear()-1).toString().substr(2)+"-"+this.dtpDocDate.Date.getFullYear().toString().substr(2)):a.replace("'YY-YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2)+"-"+(this.dtpDocDate.Date.getFullYear()+1).toString().substr(2))),i||u?this.ViewModel.DocPrefix.ComboBox.Items.find(h=>h.Value==a)?l.ContainsKey(a)||l.push(a,u):(this.ViewModel.DocPrefix.ComboBox.Items.push(U._p.ComboBoxItems_4(a,a,"","1")),l.ContainsKey(a)||l.push(a,u),s&&(u||1==this.ViewModel.DocPrefix.Prefixes.length)&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem=this.ViewModel.DocPrefix.ComboBox.Items[this.ViewModel.DocPrefix.ComboBox.Items.length-1],this.ViewModel.DocPrefix.ComboBox.SelectedValue=a)):(null==this.ViewModel.DocPrefix.ComboBox.Items.find(h=>h.Value==a)&&this.ViewModel.DocPrefix.ComboBox.Items.push(U._p.ComboBoxItems_4(a,a,"","1")),l.ContainsKey(a)||l.push(a,u))}),i&&l.length>0&&!t&&s&&!n.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)&&!l.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue)){let d=l.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==d&&l.length>0?l.keys[0]:d.Key}else if(i&&l.length>0&&t&&s&&(n.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)||!l.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue))){let d=l.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==d&&l.length>0?l.keys[0]:d.Key}else if(!i&&t){let d=this.ViewModel.DocPrefix.Prefixes.values.indexOf(!0);if(a=-1==d&&this.ViewModel.DocPrefix.Prefixes.length>0?this.ViewModel.DocPrefix.Prefixes.keys[0]:this.ViewModel.DocPrefix.Prefixes.keys[d],null!=a){let u=this.ViewModel.DocPrefix.ComboBox.Items.find(D=>D.Value==a);n.J0.IsEmpty(u)&&this.ViewModel.DocPrefix.ComboBox.Items.push(U._p.ComboBoxItems_4(a,a,"","1")),this.ViewModel.DocPrefix.ComboBox.SelectedValue=a}}t||s&&(this.ViewModel.DisplayMessage="")}GetTrimString(t,s){return null!=t&&s>=0&&t.length>s?t.substr(0,s):t}GetMonthName(t,s){t>12&&(t-=12);let i="";switch(t){case 1:i=s?"January":"Jan";break;case 2:i=s?"February":"Feb";break;case 3:i=s?"March":"Mar";break;case 4:i=s?"April":"Apr";break;case 5:i="May";break;case 6:i=s?"June":"Jun";break;case 7:i=s?"July":"Jul";break;case 8:i=s?"August":"Aug";break;case 9:i=s?"September":"Sep";break;case 10:i=s?"October":"Oct";break;case 11:i=s?"November":"Nov";break;case 12:i=s?"December":"Dec"}return i}static#e=this.\u0275fac=function(s){return new(s||y)};static#t=this.\u0275cmp=e.VBU({type:y,selectors:[["app-final-settlement"]],decls:300,vars:93,consts:[["acoordionHeader",""],["btnCollapseheader",""],["TabHeaderField",""],["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnpill"],[1,"btnMetroDiv","secondary-btn-group"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"document-screen","main_div"],[1,"section"],["panelClass","row form-row",3,"isOpen"],["accordion-heading","",1,"collapse_tabfields"],[1,"btn","btn-link"],[1,"fa","pull-right","btn-tab-icon",2,"line-height","36px","color","white","position","relative","left","-10px","float","right","background","none","border","none"],[1,"PACTHeaderFields"],[2,"display","flex","width","100%"],["class","form-group col-xl-3  col-md-3 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl"],[2,"margin-top","auto"],[1,"PACTTabFields","section","tab_content","tab-exrafields","custom_accordion",2,"display","flex"],[1,"master-tab-container",2,"width","100%"],[3,"selectTab","heading","removable"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"height","250px","border","1px solid #ccc","overflow","scroll"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","flex-direction","row","padding","0px 30px 8px 0px !important","width","100%"],[2,"font-weight","bold"],[1,"form-row","row"],[1,"form-group","col-3"],[3,"heading","removable","selectTab",4,"ngIf"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fas","fa-print"],[1,"fa-light","fa-print"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-paperclip"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-file-chart-line"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","/* flex-direction","row","*/padding","0px 0px 0px 0px !important","width","100%"],["FieldDirective","",2,"width","100%",3,"obj","group"],[2,"display","flex"],[1,"input_cntrl_label",2,"flex-direction","column"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-left","auto","margin-bottom","2px"],[1,"secondary-btn","prevnextbtn",3,"click"],[1,"far","fa-angle-left"],[1,"far","fa-angle-right"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(s,i){if(1&s){const a=e.RV6();e.j41(0,"div",3),e.EFF(1,"\n  "),e.j41(2,"div",4),e.EFF(3,"\n    "),e.j41(4,"div",5),e.EFF(5,"\n      "),e.j41(6,"span",6),e.EFF(7),e.j41(8,"span",7),e.EFF(9),e.k0s(),e.EFF(10,"\n      "),e.k0s(),e.EFF(11,"\n    "),e.k0s(),e.EFF(12,"\n    "),e.j41(13,"div",8),e.EFF(14,"\n      "),e.EFF(15,"\n      "),e.DNE(16,Me,4,3,"span",9),e.EFF(17,"\n      "),e.DNE(18,Ae,4,3,"span",9),e.EFF(19,"\n      "),e.DNE(20,Ge,4,3,"span",9),e.EFF(21,"\n      "),e.DNE(22,Le,4,3,"span",9),e.EFF(23,"\n      "),e.DNE(24,Oe,4,3,"span",9),e.EFF(25,"\n      "),e.DNE(26,Re,4,3,"span",9),e.EFF(27,"\n      "),e.DNE(28,_e,4,3,"span",9),e.EFF(29,"\n      "),e.DNE(30,Ne,4,3,"span",9),e.EFF(31,"\n      "),e.j41(32,"span",10),e.bIt("click",function(){return e.eBV(a),e.Njj(i.obj.Button_Click("Clear"))}),e.nrm(33,"i",11),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.EFF(36,"\n      "),e.DNE(37,xe,4,3,"span",9),e.EFF(38,"\n          "),e.DNE(39,we,4,3,"span",9),e.EFF(40,"           \n    "),e.k0s(),e.EFF(41,"\n  "),e.k0s(),e.EFF(42,"\n  "),e.j41(43,"div",12),e.EFF(44,"\n    "),e.j41(45,"accordion",13,0),e.EFF(47,"\n      "),e.j41(48,"accordion-group",14),e.EFF(49,"\n        "),e.j41(50,"div",15),e.EFF(51,"\n          "),e.j41(52,"span",16),e.EFF(53," Primary Information"),e.k0s(),e.EFF(54,"\n          "),e.nrm(55,"span",17,1),e.EFF(57,"\n        "),e.k0s(),e.EFF(58,"\n        "),e.j41(59,"div"),e.EFF(60,"\n          "),e.j41(61,"div",18),e.EFF(62,"\n            "),e.j41(63,"div",19),e.EFF(64,"\n              "),e.DNE(65,Ie,25,3,"div",20),e.EFF(66,"\n              "),e.DNE(67,Ve,4,2,"div",20),e.EFF(68,"\n            "),e.k0s(),e.EFF(69,"\n            "),e.j41(70,"div",19),e.EFF(71,"\n              "),e.DNE(72,Be,4,2,"div",21),e.EFF(73,"\n              "),e.DNE(74,ke,4,2,"div",20),e.EFF(75,"\n            "),e.k0s(),e.EFF(76,"\n            "),e.j41(77,"div",19),e.EFF(78,"\n              "),e.DNE(79,je,4,2,"div",20),e.EFF(80,"\n              "),e.DNE(81,Ue,4,2,"div",20),e.EFF(82,"\n              "),e.j41(83,"div",22),e.EFF(84,"\n                "),e.j41(85,"label",23),e.EFF(86),e.k0s(),e.EFF(87,"\n              "),e.k0s(),e.EFF(88,"\n            "),e.k0s(),e.EFF(89,"\n            "),e.j41(90,"div",19),e.EFF(91,"\n              "),e.DNE(92,Je,4,2,"div",21),e.EFF(93,"\n              "),e.DNE(94,Ye,4,2,"div",20),e.EFF(95,"\n            "),e.k0s(),e.EFF(96,"\n          "),e.k0s(),e.EFF(97,"\n        "),e.k0s(),e.EFF(98,"\n      "),e.k0s(),e.EFF(99,"\n    "),e.k0s(),e.EFF(100,"\n\n    "),e.j41(101,"div",24,2),e.EFF(103,"\n      "),e.j41(104,"tabset",25),e.EFF(105,"\n        "),e.j41(106,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvGratuity"))}),e.EFF(107,"\n          "),e.EFF(108,"\n            "),e.j41(109,"div",27),e.EFF(110,"\n            "),e.DNE(111,We,5,2,"div",28),e.EFF(112,"\n            \n            "),e.j41(113,"div",29),e.EFF(114,"\n              "),e.EFF(115," \n              "),e.DNE(116,$e,4,2,"div",30),e.EFF(117,"\n              "),e.DNE(118,Xe,4,2,"div",30),e.EFF(119,"\n              "),e.j41(120,"div",31),e.EFF(121,"\n                "),e.eu8(122,32),e.EFF(123,"\n              "),e.k0s(),e.EFF(124,"\n              "),e.j41(125,"div",31),e.EFF(126,"\n                "),e.eu8(127,32),e.EFF(128,"\n              "),e.k0s(),e.EFF(129,"\n              "),e.j41(130,"div",31),e.EFF(131,"\n                "),e.eu8(132,32),e.EFF(133,"\n              "),e.k0s(),e.EFF(134,"\n              "),e.j41(135,"div",31),e.EFF(136,"\n                "),e.j41(137,"button",33),e.bIt("click",function(){return e.eBV(a),e.Njj(i.obj.Button_Click("Gratuity"))}),e.EFF(138),e.k0s(),e.EFF(139,"\n              "),e.k0s(),e.EFF(140,"\n              "),e.j41(141,"div",34),e.EFF(142,"\n                "),e.j41(143,"label"),e.EFF(144),e.k0s(),e.j41(145,"label",35),e.EFF(146),e.k0s(),e.EFF(147,"\n              "),e.k0s(),e.EFF(148,"\n              "),e.j41(149,"div",34),e.EFF(150,"\n                "),e.j41(151,"label"),e.EFF(152),e.k0s(),e.j41(153,"label",35),e.EFF(154),e.k0s(),e.EFF(155," "),e.j41(156,"label"),e.EFF(157),e.k0s(),e.j41(158,"label",35),e.EFF(159),e.k0s(),e.EFF(160," "),e.j41(161,"label"),e.EFF(162),e.k0s(),e.j41(163,"label",35),e.EFF(164),e.k0s(),e.EFF(165,"\n              "),e.k0s(),e.EFF(166,"\n              "),e.j41(167,"div",34),e.EFF(168,"\n                "),e.j41(169,"label"),e.EFF(170),e.k0s(),e.j41(171,"label",35),e.EFF(172),e.k0s(),e.EFF(173,"\n              "),e.k0s(),e.EFF(174,"\n              "),e.j41(175,"div",34),e.EFF(176,"\n                "),e.j41(177,"label"),e.EFF(178),e.k0s(),e.j41(179,"label",35),e.EFF(180),e.k0s(),e.EFF(181,"\n              "),e.k0s(),e.EFF(182,"\n              "),e.DNE(183,Ke,4,2,"div",30),e.EFF(184,"\n              "),e.DNE(185,He,4,2,"div",30),e.EFF(186,"\n              "),e.DNE(187,qe,4,2,"div",30),e.EFF(188,"\n            "),e.k0s(),e.EFF(189,"\n          "),e.k0s(),e.EFF(190,"\n        "),e.k0s(),e.EFF(191,"\n        "),e.j41(192,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvLeaveEncash"))}),e.EFF(193,"\n          "),e.j41(194,"div",36),e.EFF(195,"\n            "),e.DNE(196,Qe,4,2,"div",28),e.EFF(197,"\n            "),e.j41(198,"div",37),e.EFF(199,"\n              "),e.DNE(200,ze,4,2,"div",30),e.EFF(201,"\n              "),e.j41(202,"div",31),e.EFF(203,"\n                "),e.eu8(204,32),e.EFF(205,"\n              "),e.k0s(),e.EFF(206,"\n              "),e.j41(207,"div",31),e.EFF(208,"\n                "),e.eu8(209,32),e.EFF(210,"\n              "),e.k0s(),e.EFF(211,"\n              "),e.j41(212,"div",31),e.EFF(213,"\n                "),e.j41(214,"button",33),e.bIt("click",function(){return e.eBV(a),e.Njj(i.obj.Button_Click("LeaveEncash"))}),e.EFF(215),e.k0s(),e.EFF(216,"\n              "),e.k0s(),e.EFF(217,"\n              "),e.DNE(218,Ze,4,2,"div",30),e.EFF(219,"\n            "),e.k0s(),e.EFF(220,"\n          "),e.k0s(),e.EFF(221,"\n        "),e.k0s(),e.EFF(222,"\n        "),e.DNE(223,at,17,6,"tab",38),e.EFF(224,"\n        "),e.j41(225,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvNoticePay"))}),e.EFF(226,"\n          "),e.j41(227,"div",36),e.EFF(228,"\n            "),e.DNE(229,it,4,2,"div",28),e.EFF(230,"\n            "),e.j41(231,"div",37),e.EFF(232,"\n              "),e.j41(233,"div",31),e.EFF(234,"\n                "),e.eu8(235,32),e.EFF(236,"\n              "),e.k0s(),e.EFF(237,"\n              "),e.DNE(238,st,4,2,"div",30),e.EFF(239,"\n            "),e.k0s(),e.EFF(240,"\n          "),e.k0s(),e.EFF(241,"\n        "),e.k0s(),e.EFF(242,"\n        "),e.j41(243,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvOthAdd"))}),e.EFF(244,"\n          "),e.j41(245,"div",36),e.EFF(246,"\n            "),e.DNE(247,lt,4,2,"div",28),e.EFF(248,"\n            "),e.j41(249,"div",37),e.EFF(250,"\n              "),e.j41(251,"div",31),e.EFF(252,"\n                "),e.eu8(253,32),e.EFF(254,"\n              "),e.k0s(),e.EFF(255,"\n              "),e.DNE(256,ot,4,2,"div",30),e.EFF(257,"\n            "),e.k0s(),e.EFF(258,"\n          "),e.k0s(),e.EFF(259,"\n        "),e.k0s(),e.EFF(260,"\n        "),e.j41(261,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvOthDed"))}),e.EFF(262,"\n          "),e.j41(263,"div",36),e.EFF(264,"\n            "),e.DNE(265,nt,4,2,"div",28),e.EFF(266,"\n            "),e.j41(267,"div",37),e.EFF(268,"\n              "),e.j41(269,"div",31),e.EFF(270,"\n                "),e.eu8(271,32),e.EFF(272,"\n              "),e.k0s(),e.EFF(273,"\n              "),e.DNE(274,rt,4,2,"div",30),e.EFF(275,"\n            "),e.k0s(),e.EFF(276,"\n          "),e.k0s(),e.EFF(277,"\n        "),e.k0s(),e.EFF(278,"\n        "),e.j41(279,"tab",26),e.bIt("selectTab",function(){return e.eBV(a),e.Njj(i.onSelectTab("dgvLoanBal"))}),e.EFF(280,"\n          "),e.j41(281,"div",36),e.EFF(282,"\n            "),e.DNE(283,dt,4,2,"div",28),e.EFF(284,"\n            "),e.j41(285,"div",37),e.EFF(286,"\n              "),e.j41(287,"div",31),e.EFF(288,"\n                "),e.eu8(289,32),e.EFF(290,"\n              "),e.k0s(),e.EFF(291,"\n              "),e.DNE(292,ht,4,2,"div",30),e.EFF(293,"\n            "),e.k0s(),e.EFF(294,"\n          "),e.k0s(),e.EFF(295,"\n        "),e.k0s(),e.EFF(296,"\n      "),e.k0s(),e.EFF(297,"\n\n    "),e.k0s(),e.EFF(298,"\n\n  "),e.k0s(),e.EFF(299,"\n"),e.k0s()}2&s&&(e.R7$(7),e.SpI("\n        ",i.obj.Title," "),e.R7$(),e.xc7("background-color",i.obj.StatusColor),e.R7$(),e.JRh(i.obj.DocStatus),e.R7$(7),e.Y8G("ngIf",i.ViewModel.ApproveVisibility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.PostVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.SavePrintVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.PrintVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.PreviewVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.ExportVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.AttachVisiblility),e.R7$(2),e.Y8G("ngIf",i.ViewModel.EMailVisiblility),e.R7$(4),e.JRh(e.bMT(35,91,"Clear")),e.R7$(3),e.Y8G("ngIf",i.obj.UnPostVisiblility),e.R7$(2),e.Y8G("ngIf",i.obj.ReportInfoVisibility),e.R7$(9),e.Y8G("isOpen",i.IsAccordionOpen),e.R7$(7),e.AVh("fa-chevron-down",i.IsAccordionOpen)("fa-chevron-up",!i.IsAccordionOpen),e.R7$(10),e.Y8G("ngIf",i.obj.txtDocNo.Visible),e.R7$(2),e.Y8G("ngIf",i.obj.dtpDocDate.Visible),e.R7$(5),e.Y8G("ngIf",i.obj.EmployeeList.Visible),e.R7$(2),e.Y8G("ngIf",i.obj.cmbSettlementType.Visible),e.R7$(5),e.Y8G("ngIf",i.obj.dtpDateOfJoining.Visible),e.R7$(2),e.Y8G("ngIf",i.obj.dtpDateOfRelieving.Visible),e.R7$(5),e.JRh(i.lblActRelievingDate),e.R7$(6),e.Y8G("ngIf",i.obj.txtRemarks.Visible),e.R7$(2),e.Y8G("ngIf",i.obj.txtNetAmount.Visible),e.R7$(12),e.FS9("heading",i.tpGratuity),e.Y8G("removable",!1),e.R7$(5),e.Y8G("ngIf",i.dgvGratuity.Visible),e.R7$(5),e.Y8G("ngIf",i.cmbResignType.Visible),e.R7$(2),e.Y8G("ngIf",i.cmbResignReason.Visible),e.R7$(4),e.Y8G("obj",i.chkCalcBasedOnLastSal)("group",i.form),e.R7$(5),e.Y8G("obj",i.chkCalcBasedOnActDays)("group",i.form),e.R7$(5),e.Y8G("obj",i.GratuityRemarks)("group",i.form),e.R7$(6),e.JRh(i.btnCalcGratuity),e.R7$(6),e.JRh(i.lbl1GratuityTotalDays),e.R7$(2),e.JRh(i.lblGratuityTotalDays),e.R7$(6),e.JRh(i.lbl1GratuityServiceDays),e.R7$(2),e.JRh(i.lblGratuityServiceDays),e.R7$(3),e.JRh(i.lbl1GratuityLOPDays),e.R7$(2),e.JRh(i.lblGratuityLOPDays),e.R7$(3),e.JRh(i.lbl1GratuityBalDays),e.R7$(2),e.JRh(i.lblGratuityBalDays),e.R7$(6),e.JRh(i.lbl1GratuityTotalGrDays),e.R7$(2),e.JRh(i.lblGratuityTotalGrDays),e.R7$(6),e.JRh(i.lbl1GratuityTaken),e.R7$(2),e.JRh(i.lblGratuityTaken),e.R7$(3),e.Y8G("ngIf",i.txtGratuityAmount.Visible),e.R7$(2),e.Y8G("ngIf",i.txtAvailedGratuityAmount.Visible),e.R7$(2),e.Y8G("ngIf",i.txtPartialGratuityAmount.Visible),e.R7$(5),e.FS9("heading",i.tpLeaveEncashment),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",i.dgvLeaveEncash.Visible),e.R7$(4),e.Y8G("ngIf",i.txtCumLeaveSalBalAmt.Visible),e.R7$(4),e.Y8G("obj",i.chkLECalcBasedOnLastApprSerYearWise)("group",i.form),e.R7$(5),e.Y8G("obj",i.LeaveRemarks)("group",i.form),e.R7$(6),e.JRh(i.btnCalcLE),e.R7$(3),e.Y8G("ngIf",i.txtLEAmount.Visible),e.R7$(5),e.Y8G("ngIf",i.ViewModel.UnProcessedVisible),e.R7$(2),e.FS9("heading",i.tpNoticePay),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",i.dgvNoticePay.Visible),e.R7$(6),e.Y8G("obj",i.NoticePayRemarks)("group",i.form),e.R7$(3),e.Y8G("ngIf",i.txtNPAmount.Visible),e.R7$(5),e.FS9("heading",i.tpOtherAdditions),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",i.dgvOthAdd.Visible),e.R7$(6),e.Y8G("obj",i.OAddRemarks)("group",i.form),e.R7$(3),e.Y8G("ngIf",i.txtOthAddAmount.Visible),e.R7$(5),e.FS9("heading",i.tpOtherDeductions),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",i.dgvOthDed.Visible),e.R7$(6),e.Y8G("obj",i.ODedRemarks)("group",i.form),e.R7$(3),e.Y8G("ngIf",i.txtOthDedAmount.Visible),e.R7$(5),e.FS9("heading",i.tpLoanBalances),e.Y8G("removable",!1),e.R7$(4),e.Y8G("ngIf",i.dgvLoanBal.Visible),e.R7$(6),e.Y8G("obj",i.LoanRemarks)("group",i.form),e.R7$(3),e.Y8G("ngIf",i.txtLoanBalAmount.Visible))},dependencies:[Pe.bT,Ce._,re.Mj,re.kt,Ee.X,de.V6,de.fw,Fe.D9],encapsulation:2})}return y})();class ut{constructor(){this.Days=0}}}}]);