"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5784],{45784:(st,Q,E)=>{E.r(Q),E.d(Q,{ACC_TradingReports:()=>q,eTradingReportFormat:()=>R});var T=E(86739),o=E(8787),F=E(32647),X=E(7023),w=E(38859),H=E(95707),Z=E(35725),K=E(89747);class ${constructor(){this.Lft=0,this.Rgt=0}}var R=function(B){return B[B.Vertical=0]="Vertical",B[B.Horizontal=1]="Horizontal",B[B.Plain=2]="Plain",B}(R||{}),n=function(B){return B[B.None=0]="None",B[B.MonthWise=1]="MonthWise",B[B.QtrWise=4]="QtrWise",B[B.HalfYearWise=5]="HalfYearWise",B[B.YearWise=3]="YearWise",B[B.TagWise=2]="TagWise",B[B.CurrWise=6]="CurrWise",B[B.CompWise=7]="CompWise",B[B.DayWise=8]="DayWise",B}(n||{});class j{}class q extends X.A{constructor(e){super(e),this.Show=n.None,this.subShow=n.None,this.k=0,this.BalIndex=0,this.LevelNo=0,this.ReportTotalIndex=0,this.CountMonths=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.CellStartPos=0,this.GroupTotalIndex=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.BAL_CLIndex=0,this.TotalBudgetIndex=1,this.StockLevelNo=0,this.VariancePercentIndex=1,this.SalesPercentIndex=1,this.NegNumber=4,this.ColumnSize=0,this.AccNameIndex=0,this.FirstTypeEndIndex=0,this.GrossCellIndex=0,this.ReportRowStartIndex=0,this.TagID=0,this.CADimension=0,this.Olddbl=0,this.dbl=0,this.dblTemp=0,this.dblCLTemp=0,this.exchRate=0,this.dblTotalSales=0,this.OldReportTotalMonthWise=null,this.lstTotal=null,this.lstParents=new Array,this.STACKROWS=new Array,this.lstParentCell=new Array,this.IsIncome=!1,this.IsIncomeNegative=!1,this.IncludeOpeningStock=!1,this.IncludeClosingStock=!1,this.ShowPrevMonthData=!1,this.ShowPrevMonthDiffData=!1,this.ShowPrevMonthVarPer=!1,this.ShowdetailsofControlGroups=!1,this.GroupTotalsAtEnd=!1,this.GroupTotalsSeperate=!1,this.DontShowSummaryGroupTotals=!1,this.ShowCarryForward=!1,this.ShowForecast=!1,this.ShowNetProfitBeforeAndAfter=!1,this.ClubIncomeExpenseInPlainReport=!1,this.ShowTotalBudget=!1,this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.ShowBudgetVariancePercent=!1,this.HideZeroBudgetAccounts=!1,this.ShowGrossInIncome=!1,this.ShowIncomeFirst=!1,this.IsFirstCall=!1,this.ShowAllAccounts=!1,this.IsAccountWise=!1,this.AddGrossToVariance=!1,this.IgnoreGrossRowsForBS=!1,this.ShowSalesPercentage=!1,this.ShowSalesPerMonthly=!1,this.GrossAtEnd=!1,this.NetAtEnd=!1,this.ShowCorporateLaw=!1,this.SubShowPerc=!1,this.lstTagSalesTotal=new H.bT,this.dvYTD=null,this.dvBAL_LY=null,this.dvYTD_LY=null,this.dvYTDTable=null,this.dvBAL_LYTable=null,this.dvYTD_LYTable=null,this.sbSpaces="",this.GrossRows=new Array(2),this.ReportFormat=R.Vertical,this.IncomeExpenseHeader=new w.bA,this.GroupRowAppearance=new w.bA,this.AccountID=0,this.RetainedEarningAccount=0,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.LastAccountID=0,this.FirstAccountID=0,this.LocationWhere="",this.TagTableName=null,this.dsNew=null,this.dsOpenCompany=null,this.dsOpeningStock=null,this.dsClosingStock=null,this.dsOpenStock=null,this.dsCloseStock=null,this.dsList=new Array,this.dv1=null,this.dv2=null,this.dvCurrentBudget=null,this.dvPrevBudget=null,this.dv1Table=null,this.dv2Table=null,this.dvCurrentBudgetTable=null,this.dvPrevBudgetTable=null,this.dv1Columns=null,this.dv2Columns=null,this.IncomeAccounts=new Array,this.lstTags=new Array,this.lstPMTags=new Array,this.dblMonBal=0,this.dblActBudget=0,this.dblClosingStock=0,this.dblOpeningStock=0,this.YearSlots=new H.bT,this.QtrSlot=new H.bT,this.HideTagWiseBudget=!1,this.HideEmptyDimensions=!1,this.lstTagColumns=new Array,this.lstTagVisibleColumns=new Array,this.TextFields=new H.bT,this.TempData=new Array,this.strM1="",this.strM2="",this.strM3="",this.strM4="",this.strM5="",this.strBSM2="",this.IsAddRow=0,this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0,this.dblDrOpBalDiff=0,this.dblCrOpBalDiff=0,this.dblOpeningBalanceDifference=0,this.lstTagsOpeningBalance=new H.bT,this.IncomeExpenseHeader.IsBold=!0,this.IncomeExpenseHeader.FontSize=14,this.IncomeExpenseHeader.ForeColor="#FF00465A",this.IncomeExpenseHeader.BackColor="White",this.GroupRowAppearance.IsBold=!1,this.GroupRowAppearance.FontSize=12,this.GroupRowAppearance.ForeColor="#FF00465A",this.GroupRowAppearance.BackColor="White"}LoadReport(){if("True"==T.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==T.d.SessionManager.Preferences["LW Reports"]&&"True"==T.d.SessionManager.Preferences.LWAccPeriod&&(this.CheckLWAccountingDate(),!o.J0.IsEmpty(this.ViewModel.DisplayMessage)))return;if(this.GrdRow=-1,this.CountMonths=0,this.Show=n.None,this.subShow=n.None,this.SubShowPerc=!1,this.ReportTotal=new Array(2).fill(0),this.lstTotal=new Array,this.LevelNo=o.J0.Int(this.ViewModel.Preferences.Level),this.ShowIncomeFirst="Income"==this.ViewModel.Preferences.ShowFirst,this.ViewModel.IsReportCollapsable=!0,"Vertical"==this.ViewModel.Preferences.ReportFormat?this.ReportFormat=R.Vertical:"Horizontal"==this.ViewModel.Preferences.ReportFormat?(this.ViewModel.IsReportCollapsable=!1,this.ReportFormat=R.Horizontal):this.ReportFormat=R.Plain,this.ViewModel.Preferences.ContainsKey("IncludeStock")&&(this.IncludeOpeningStock=this.ViewModel.Preferences.IncludeStock.Contains("<OpeningStock/>"),this.IncludeClosingStock=this.ViewModel.Preferences.IncludeStock.Contains("<ClosingStock/>"),this.ViewModel.Preferences.ContainsKey("StockLevel")&&(this.StockLevelNo=o.J0.Int(this.ViewModel.Preferences.StockLevel))),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeUnApprovedPDC=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnApprovedPDC")||"1"!=this.ViewModel.Preferences.IncludeUnApprovedPDC),this.IncludeTerminatedPDC=!(this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")&&"0"==this.ViewModel.Preferences.IncludeTerminatedPDC),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.ShowdetailsofControlGroups=!(!this.ViewModel.Preferences.ContainsKey("ShowdetailsofControlGroups")||"1"!=this.ViewModel.Preferences.ShowdetailsofControlGroups),5==this.ViewModel.StaticReportType&&(this.ShowdetailsofControlGroups=!0),this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let r=new o.VB;r.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let l=o.VB.SelectSingleNode(r.DocumentElement,"IsChecked");null!=l&&"1"==l.innerHTML&&(l=o.VB.SelectSingleNode(r.DocumentElement,"Value"),this.ForeignCurrencyID=o.J0.Int(l.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let r=new o.VB;r.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=o.J0.Int(o.VB.SelectSingleNode(r.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(o.J0.IsEmpty(T.d.SessionManager.Preferences.DimensionwiseCurrency)||0==o.J0.Int(T.d.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=o.J0.Int(o.VB.SelectSingleNode(r.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.ClubIncomeExpenseInPlainReport=!(!this.ViewModel.Preferences.ContainsKey("ClubIncomeExpenseInPlainReport")||"1"!=this.ViewModel.Preferences.ClubIncomeExpenseInPlainReport),this.ShowCarryForward=!(!this.ViewModel.Preferences.ContainsKey("ShowCarryForward")||"1"!=this.ViewModel.Preferences.ShowCarryForward),this.ShowNetProfitBeforeAndAfter=!(!this.ViewModel.Preferences.ContainsKey("ShowNetProfit")||"BeforeAndAfter"!=this.ViewModel.Preferences.ShowNetProfit),this.ShowAllAccounts=!(!this.ViewModel.Preferences.ContainsKey("ShowAllAccounts")||"1"!=this.ViewModel.Preferences.ShowAllAccounts),this.HideZeroBudgetAccounts=!(!this.ViewModel.Preferences.ContainsKey("HideZeroBudgetAccounts")||"1"!=this.ViewModel.Preferences.HideZeroBudgetAccounts),this.IsAccountWise=!(!this.ViewModel.Preferences.ContainsKey("AccountWise")||"1"!=this.ViewModel.Preferences.AccountWise),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.RetainedEarningAccount=this.ViewModel.Preferences.ContainsKey("RetainedEarningAccount")?o.J0.Int(this.ViewModel.Preferences.RetainedEarningAccount):0,this.ClosingStockAccount=this.ViewModel.Preferences.ContainsKey("ClosingStockAccount")?o.J0.Int(this.ViewModel.Preferences.ClosingStockAccount):0,this.AddGrossToVariance=!(!this.ViewModel.Preferences.ContainsKey("AddGrossToVariance")||"1"!=this.ViewModel.Preferences.AddGrossToVariance),this.NegNumber=this.ViewModel.Preferences.ContainsKey("NegNumber")?o.J0.Int(this.ViewModel.Preferences.NegNumber):4,this.GrossAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GrossAtEnd")||"1"!=this.ViewModel.Preferences.GrossAtEnd),this.NetAtEnd=!(!this.ViewModel.Preferences.ContainsKey("NetAtEnd")||"1"!=this.ViewModel.Preferences.NetAtEnd),this.ShowCorporateLaw=!(!this.ViewModel.Preferences.ContainsKey("ShowCorporateLaw")||"1"!=this.ViewModel.Preferences.ShowCorporateLaw),this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.CurrentBudgetWhere="",this.PreviousBudgetWhere="",this.ReportFormat==R.Vertical){let r="0",l="0";if(this.ViewModel.Preferences.ContainsKey("ShowSalesPercentage")){let d=new o.VB;d.LoadXml("<XML>"+this.ViewModel.Preferences.ShowSalesPercentage+"</XML>"),"1"==o.VB.SelectSingleNode(d.DocumentElement,"IsChecked").innerHTML&&(this.ShowSalesPercentage=!0,"Repeat Tag Wise"==o.VB.SelectSingleNode(d.DocumentElement,"Value").innerHTML&&(this.ShowSalesPerMonthly=!0))}this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(r=this.ViewModel.Preferences.FinalReportsShow),this.ViewModel.Preferences.ContainsKey("FinalReportsSubShow")&&(l=this.ViewModel.Preferences.FinalReportsSubShow),this.ViewModel.Preferences.ContainsKey("HideTagWiseBudget")&&"1"==this.ViewModel.Preferences.HideTagWiseBudget&&(this.HideTagWiseBudget=!0),"1"==r?(this.Show=n.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.iMonth()==this.ViewModel.oReportDialog.ToDate.Date.iMonth()&&this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=n.None))):"8"==r?this.Show=n.DayWise:"4"==r?this.Show=n.QtrWise:"5"==r?this.Show=n.HalfYearWise:"3"==r?(this.Show=n.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=n.None))):"2"==r?(this.Show=n.TagWise,this.TagID=o.J0.Int(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")),this.ViewModel.Preferences.ContainsKey("FinalReportsSubShowPerc")&&(this.SubShowPerc=!0),"1"==l?this.subShow=n.MonthWise:"8"==l?this.subShow=n.DayWise:"4"==l?this.subShow=n.QtrWise:"5"==l?this.subShow=n.HalfYearWise:"3"==l&&(this.subShow=n.YearWise)):"6"==r?(this.Show=n.CurrWise,this.ViewModel.Preferences.ContainsKey("FinalReportsShowCurrHideColumns")&&(this.HideEmptyDimensions=!0)):"7"==r&&(this.Show=n.CompWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowComp),this.TagTableName=this.ViewModel.Preferences.FinalReportsShowCompWhere,this.TagID>0&&!this.TagTableName.split(",").Contains(this.TagID.toString())&&(this.TagTableName=this.TagTableName.length>0?this.TagID+","+this.TagTableName:this.TagID.toString()),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowCompColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowCompColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowCompColumn&&(this.TagColumnName="Code+'-'+Name"))),8==this.ViewModel.StaticReportType&&(this.ViewModel.Preferences.ContainsKey("CurrentBudget")&&(this.CurrentBudgetID=o.J0.Int(this.ViewModel.Preferences.CurrentBudget)),this.ViewModel.Preferences.ContainsKey("PreviousBudget")&&(this.PreviousBudgetID=o.J0.Int(this.ViewModel.Preferences.PreviousBudget)),this.CurrentBudgetWhere=this.ViewModel.Preferences.ContainsKey("CurrentBudgetWhere")&&!o.J0.IsEmpty(this.ViewModel.Preferences.CurrentBudgetWhere)?this.ViewModel.Preferences.CurrentBudgetWhere:"",this.PreviousBudgetWhere=this.ViewModel.Preferences.ContainsKey("PreviousBudgetWhere")&&!o.J0.IsEmpty(this.ViewModel.Preferences.PreviousBudgetWhere)?this.ViewModel.Preferences.PreviousBudgetWhere:"",this.ViewModel.Preferences.ContainsKey("ShowActualBudget")&&"1"==this.ViewModel.Preferences.ShowActualBudget&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowBudget=!0),this.ViewModel.Preferences.ContainsKey("ShowVariance")&&"1"==this.ViewModel.Preferences.ShowVariance&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariance=!0),this.ViewModel.Preferences.ContainsKey("ShowVariancePercent")&&"1"==this.ViewModel.Preferences.ShowVariancePercent&&(this.VariancePercentIndex=1==this.ShowBudgetVariance?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowBudgetVariancePercent=!0)),this.ViewModel.Preferences.ContainsKey("ShowTotalBudget")&&"1"==this.ViewModel.Preferences.ShowTotalBudget&&(this.TotalBudgetIndex=1==this.ShowBudget?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowTotalBudget=!0))),(this.Show==n.DayWise||this.Show==n.MonthWise||this.Show==n.QtrWise||this.Show==n.HalfYearWise||this.Show==n.YearWise)&&this.ViewModel.oReportDialog.ToDate.Date.Subtract(this.ViewModel.oReportDialog.FromDate.Date).TotalDays<=366&&(this.ShowPrevMonthData=this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn"),this.ShowPrevMonthDiffData=this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference"),this.ShowPrevMonthVarPer=this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer"))}this.CellStartPos=0,this.dtYearStartMonth=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),this.dtYearStartMonth>this.ViewModel.oReportDialog.FromDate.Date&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1)),this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=this.BAL_CLIndex=-1;let e=null,h=null,t=null,i=null;for(let r=0;r<this.ViewModel.ColumnSourceALL.length;r++)"Bud_Budget"==this.ViewModel.ColumnSourceALL[r].ID?(t=this.ViewModel.ColumnSourceALL[r].Clone(),t.HeaderAppearance.IsVisible=t.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[r].HeaderAppearance.IsVisible=!1):"Bud_TotalBudget"==this.ViewModel.ColumnSourceALL[r].ID?(i=this.ViewModel.ColumnSourceALL[r].Clone(),i.HeaderAppearance.IsVisible=i.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[r].HeaderAppearance.IsVisible=!1):"Bud_Variance"==this.ViewModel.ColumnSourceALL[r].ID?(e=this.ViewModel.ColumnSourceALL[r].Clone(),e.HeaderAppearance.IsVisible=e.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[r].HeaderAppearance.IsVisible=!1):"Bud_VariancePerc"==this.ViewModel.ColumnSourceALL[r].ID&&(h=this.ViewModel.ColumnSourceALL[r].Clone(),h.HeaderAppearance.IsVisible=h.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[r].HeaderAppearance.IsVisible=!1);let a=new Array;for(let r=0;r<this.ViewModel.ColumnSource.length;r++)if((33==this.ViewModel.ColumnSource[r].ID.length||"AccountCode"==this.ViewModel.ColumnSource[r].ID||"AccountName"==this.ViewModel.ColumnSource[r].ID)&&this.TextFields.push(this.ViewModel.ColumnSource[r].ID,r),a.push(this.ViewModel.ColumnSource[r].Clone()),"Balance"==this.ViewModel.ColumnSource[r].ID){if(a[a.length-1].DataFormat.NegativeNumber=4!=this.NegNumber?this.NegNumber:0,this.ShowTotalBudget){let l=null!=i?i.Clone():a[a.length-1].Clone();l.HeaderText=null!=i?l.HeaderText:"Total Budget",l.ID="TotalBudget",l.DataFormat.NegativeNumber=0,a.InsertAt(l,a.length-1),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(l.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(l.ID,this.BalIndex-1),this.BalIndex=this.BalIndex+1}if(this.ShowBudget){let l=null!=t?t.Clone():a[a.length-1].Clone();l.HeaderText=null!=t?l.HeaderText:"Budget",l.ID="BudgetBalance",l.DataFormat.NegativeNumber=0,a.InsertAt(l,a.length-1),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(l.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(l.ID,this.BalIndex-1)}if(this.BalIndex=a.length-1,this.ShowBudgetVariance){let l=null!=e?e.Clone():a[this.BalIndex].Clone();l.HeaderText=null!=e?l.HeaderText:"Variance",l.ID="VarianceBalance",l.DataFormat.NegativeNumber=0,a.push(l)}if(this.ShowBudgetVariancePercent){let l=null!=h?h.Clone():a[this.BalIndex].Clone();l.HeaderText=null!=h?l.HeaderText:"Variance %",l.DataFormat.PercentageOn="BudgetBalance",l.ID="PercentVarianceBalance",l.DataFormat.NegativeNumber=0,a.push(l)}if(this.ShowSalesPercentage){let l=a[this.BalIndex].Clone();l.HeaderText="Percentage",l.width>85&&(l.width=85),l.DataFormat.PercentageOn="Balance",l.ID="SalesPercentage",l.DataFormat.NegativeNumber=0,this.SalesPercentIndex=a.length-this.BalIndex,a.push(l)}if(this.ShowCorporateLaw){let l=a[this.BalIndex].Clone();l.HeaderText=l.HeaderText+" CT",l.ID="BalanceCL",a.Insert(this.BalIndex+1,l),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(l.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(l.ID,a.length-1),this.BAL_CLIndex=a.length-1}}else if("YTD"==this.ViewModel.ColumnSource[r].ID){if(4!=this.NegNumber&&(a[a.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let l=null!=t?t.Clone():a[a.length-1].Clone();l.HeaderText=null!=t?"YTD "+l.HeaderText:"YTD Budget",l.ID="BudgetYTD",l.DataFormat.NegativeNumber=0,a.InsertAt(l,a.length-1)}if(this.YTDIndex=a.length-1,this.ShowBudgetVariance){let l=null!=e?e.Clone():a[this.YTDIndex].Clone();l.HeaderText=null!=e?"YTD "+l.HeaderText:"YTD Variance",l.ID="VarianceYTD",l.DataFormat.NegativeNumber=0,a.push(l)}if(this.ShowBudgetVariancePercent){let l=null!=h?h.Clone():a[this.YTDIndex].Clone();l.HeaderText=null!=h?"YTD "+l.HeaderText:"YTD Variance %",l.DataFormat.PercentageOn="BudgetYTD",l.ID="PercentVarianceYTD",l.DataFormat.NegativeNumber=0,a.push(l)}}else if("LastYearBalance"==this.ViewModel.ColumnSource[r].ID){if(4!=this.NegNumber&&(a[a.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let l=null!=t?t.Clone():a[a.length-1].Clone();l.HeaderText=null!=t?"LastYear "+l.HeaderText:"LastYear Budget",l.ID="BudgetLastYearBalance",l.DataFormat.NegativeNumber=0,a.InsertAt(l,a.length-1)}if(this.BAL_LYIndex=a.length-1,this.ShowBudgetVariance){let l=null!=e?e.Clone():a[this.BAL_LYIndex].Clone();l.HeaderText=null!=e?"LastYear "+l.HeaderText:"LastYear Variance",l.ID="VarianceLastYearBalance",l.DataFormat.NegativeNumber=0,a.push(l)}if(this.ShowBudgetVariancePercent){let l=null!=h?h.Clone():a[this.BAL_LYIndex].Clone();l.HeaderText=null!=h?"LastYear "+l.HeaderText:"LastYear Variance %",l.DataFormat.PercentageOn="BudgetLastYearBalance",l.ID="PercentVarianceLastYearBalance",l.DataFormat.NegativeNumber=0,a.push(l)}}else if("LastYearYTD"==this.ViewModel.ColumnSource[r].ID){if(4!=this.NegNumber&&(a[a.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let l=null!=t?t.Clone():a[a.length-1].Clone();l.HeaderText=null!=t?"LastYear YTD "+l.HeaderText:"LastYear YTD Budget",l.ID="BudgetLastYearYTD",l.DataFormat.NegativeNumber=0,a.InsertAt(l,a.length-1)}if(this.YTD_LYIndex=a.length-1,this.ShowBudgetVariance){let l=null!=e?e.Clone():a[this.YTD_LYIndex].Clone();l.HeaderText=null!=e?"LastYear YTD "+l.HeaderText:"LastYear YTD Variance",l.ID="VarianceLastYearYTD",l.DataFormat.NegativeNumber=0,a.push(l)}if(this.ShowBudgetVariancePercent){let l=null!=h?h.Clone():a[this.YTD_LYIndex].Clone();l.HeaderText=null!=h?"LastYear YTD "+l.HeaderText:"LastYear YTD Variance %",l.DataFormat.PercentageOn="BudgetLastYearYTD",l.ID="PercentVarianceLastYearYTD",l.DataFormat.NegativeNumber=0,a.push(l)}}if(this.frmBalance=a[this.BalIndex].DataFormat.Clone(),this.frmBalance.NegativeNumber=0,this.frmBudget=a[this.BalIndex].DataFormat.Clone(),this.frmBalance.NegativeNumber=0,this.AccNameIndex=this.BalIndex-1,this.ShowBudget&&this.AccNameIndex--,this.ShowTotalBudget&&this.AccNameIndex--,this.ReportFormat==R.Plain&&(this.ClubIncomeExpenseInPlainReport?this.GroupTotalIndex=this.ViewModel.ColumnSource.length:(this.GroupTotalIndex=this.ViewModel.ColumnSource.length+1,a.push(this.ViewModel.ColumnSource[this.BalIndex].Clone()))),this.GroupTotalsSeperate){let r=this.ViewModel.ColumnSource[this.BalIndex].Clone();r.HeaderText="TOTAL",a.InsertAt(r,this.BalIndex+1),-1!=this.BAL_CLIndex&&this.BAL_CLIndex++,-1!=this.YTDIndex&&this.YTDIndex++,-1!=this.BAL_LYIndex&&this.BAL_LYIndex++,-1!=this.YTD_LYIndex&&this.YTD_LYIndex++}if(this.ColumnSize=a.length,this.ReportFormat==R.Horizontal){let r=a.length;for(let l=0;l<r;l++)a.push(a[l].Clone())}if(this.ReportFormat==R.Plain&&!this.ClubIncomeExpenseInPlainReport){let r=a[this.BalIndex],l=a[this.BalIndex+1];this.ShowIncomeFirst?7==this.ViewModel.StaticReportType?(r.HeaderText=T.d.GetResource("Reports_LblAssets").toUpperCase(),l.HeaderText=T.d.GetResource("Reports_LblLiabilities").toUpperCase()):(r.HeaderText=T.d.GetResource("Reports_LblIncome").toUpperCase(),l.HeaderText=T.d.GetResource("Reports_LblExpneses").toUpperCase()):7==this.ViewModel.StaticReportType?(r.HeaderText=T.d.GetResource("Reports_LblLiabilities").toUpperCase(),l.HeaderText=T.d.GetResource("Reports_LblAssets").toUpperCase()):(r.HeaderText=T.d.GetResource("Reports_LblExpneses").toUpperCase(),l.HeaderText=T.d.GetResource("Reports_LblIncome").toUpperCase())}if((this.Show==n.YearWise||this.subShow==n.YearWise)&&(this.HideTagWiseBudget=!0),this.Show==n.DayWise||this.Show==n.MonthWise||this.Show==n.YearWise||this.Show==n.QtrWise||this.Show==n.HalfYearWise)this.RenderColums(this.Show,a,e,h,t,i,"","");else if(this.Show==n.TagWise||this.Show==n.CompWise||this.Show==n.CurrWise){let r=a[a.length-1];-1!=this.BalIndex&&(r=a[this.BalIndex]);let l="";l=this.Show==n.CompWise?"USE PACT2C SELECT DBIndex NodeID,Name FROM ADM_Company WITH(NOLOCK) WHERE DBIndex="+T.d.SessionManager.CompanyIndex+" OR DBIndex IN ("+this.TagTableName+") ORDER BY DBIndex":this.Show==n.CurrWise?"SELECT CurrencyID NodeID,Name FROM COM_Currency WITH(NOLOCK) ORDER BY CurrencyID":this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name");let d=T.d.report.DataSet("RPT022",l);(this.subShow==n.DayWise||this.subShow==n.MonthWise||this.subShow==n.YearWise||this.subShow==n.QtrWise||this.subShow==n.HalfYearWise)&&this.RenderColums(this.subShow,a,e,h,t,i,"",""),d.Tables[0].forEach(s=>{if(this.subShow==n.DayWise||this.subShow==n.MonthWise||this.subShow==n.YearWise||this.subShow==n.QtrWise||this.subShow==n.HalfYearWise)this.RenderColums(this.subShow,a,e,h,t,i,o.J0.String(s.Name),"T"+o.J0.String(s.NodeID));else{let u=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),f=r.Clone();if(f.HeaderText=s.Name.toString(),f.ID=s.NodeID.toString(),this.lstTagColumns.push(f.ID),a.push(f),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let I=null!=t?t.Clone():r.Clone();I.HeaderText="Budget-"+f.HeaderText,I.ID="Budget"+f.ID,this.ShowForecast&&u<=this.ViewModel.oReportDialog.ToDate.Date&&(I.HeaderAppearance.IsVisible=!1),a.Insert(a.length-1,I),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let I=null!=e?e.Clone():r.Clone();I.HeaderText="Variance-"+f.HeaderText,I.ID="Variance"+f.ID,a.push(I),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let I=null!=h?h.Clone():r.Clone();I.DataFormat.PercentageOn=f.ID,I.HeaderText="Variance %-"+f.HeaderText,I.ID="PercentVariance"+f.ID,a.push(I),++this.CountMonths}if(this.ShowSalesPerMonthly){let I=f.Clone();I.HeaderText="Percentage-"+f.HeaderText,I.DataFormat.PercentageOn="Balance",I.width>85&&(I.width=85),I.ID="SalesPercentage_"+f.ID,I.DataFormat.NegativeNumber=0,a.push(I),++this.CountMonths}f.HeaderText=r.HeaderText+"-"+f.HeaderText,this.lstTags.push(f.ID)}})}if(this.ViewModel.ReportColumns=a,this.oColumns=this.ViewModel.ReportColumns,this.IsIncomeNegative=7!=this.ViewModel.StaticReportType,this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=o.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1 ":"True"==T.d.SessionManager.Preferences.EnableLocationWise&&this.ViewModel.ShowLocationFilter&&this.ViewModel.oReportDialog.Locations.Items.length>0&&"all"==this.ViewModel.oReportDialog.Locations.Items[0].Value.toLowerCase()&&(0,F.yG0)(this.ViewModel.oReportDialog.Locations.Items[0].IsChecked)?"":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+") "),this.dsList.Clear(),this.dsBudget=null,7!=this.ViewModel.StaticReportType||!(0,F.yG0)(T.d.SessionManager.Preferences.OpenCompany))if(this.Show==n.TagWise&&(this.IncludeOpeningStock||this.IncludeClosingStock))this.IncludeOpeningStock&&this.SetStockBalance(!0),this.IncludeClosingStock&&this.SetStockBalance(!1);else{let r={Balance:0};this.IncludeOpeningStock&&(this.dsOpenStock=T.d.report.GetStockBalance_Async(1,this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID"),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,r)),this.dblOpeningStock=r.Balance,this.IncludeClosingStock&&(this.dsCloseStock=T.d.report.GetStockBalance_Async(0,this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID"),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,r),this.dblClosingStock=r.Balance)}8!=this.ViewModel.StaticReportType?(this.ReportRowStartIndex=-1,this.SetDataSet(this.ViewModel.StaticReportType).then(r=>{this.ReportFormat==R.Plain?this.LoadPlainReport():this.LoadHorizontalVerticalReports(),this.LoadReportComplete()})):(this.ReportRowStartIndex=-1,this.SetDataSet(5).then(r=>{this.LoadHorizontalVerticalReports(),this.Olddbl=this.dbl,this.OldReportTotalMonthWise=this.ReportTotalMonthWise,this.CellStartPos=0,this.ReportRowStartIndex=this.GrdRow,this.ReportTotal[0]=this.ReportTotal[1]=0,this.GrossRows[0]=null,this.GrossRows[1]=null,this.ShowIncomeFirst=!(!this.ViewModel.Preferences.ContainsKey("ShowFirst2")||"Income"!=this.ViewModel.Preferences.ShowFirst2),this.SetDataSet(8).then(l=>{this.LoadHorizontalVerticalReports(),this.LoadReportComplete()})}))}LoadReportComplete(){for(let e=0;e<this.TempData.length;e++){let h=this.TempData[e];h.Visible&&(this.ReportFormat==R.Horizontal&&(h.Parent=null),this.ViewModel.addRow(h))}this.ViewModel.process_RunWorkerCompleted(null,null)}SetColumns(e,h){e==n.DayWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",Day(ACC.DocDate) DocDate",this.strM3+=7==this.ViewModel.StaticReportType?",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+(case when Month(DocDate)<10 then '0' else '' end)+ CONVERT(NVARCHAR,Month(DocDate))+'D'+ CONVERT(NVARCHAR,Day(DocDate)) Mn":",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate))+'D'+ CONVERT(NVARCHAR,Day(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate), Day(DocDate)",this.strM5+=",DocDate"):e==n.MonthWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=7==this.ViewModel.StaticReportType?",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+(case when Month(DocDate)<10 then '0' else '' end)+ CONVERT(NVARCHAR,Month(DocDate)) Mn":",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate)",this.strM5+=",DocDate"):e==n.QtrWise||e==n.HalfYearWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=",CONVERT(NVARCHAR,YEAR(DocDate))+'-'+ CONVERT(NVARCHAR,Month(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate)",this.strM5+=",DocDate"):e==n.YearWise&&(1==this.AccountingFromMonth?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=",'Y'+CONVERT(NVARCHAR,YEAR(DocDate)) Mn",this.strM4+=",YEAR(DocDate)",this.strM5+=",DocDate"):(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=7==h?",case when MONTH(DocDate)<4 and YEAR(DocDate)!=1900 then YEAR(DocDate)-1 else YEAR(DocDate) end Mn":",case when MONTH(DocDate)<4 then YEAR(DocDate)-1 else YEAR(DocDate) end Mn",this.strM4+=",YEAR(DocDate),MONTH(DocDate)",this.strM5+=",DocDate")),this.strM1=this.strM1.Replace("TagID Mn,","Mn TagMn,TagID+Mn "),this.strM3=this.strM3.Replace(",TagID",",'T'+CONVERT(NVARCHAR,TagID) TagID")}SetDataSet(e){let i,a,h="",t="",r="",l="",d="",s="",u="",I=new Array;if(5==e?(l="4,8",d="5,9",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),I.push(5),I.push(9)):6==e?(l="4,8,11",d="5,9,12",h=",A.PL IsSummary",t=",A.PL",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),this.IncomeAccounts.push(11),I.push(5),I.push(9),I.push(12)):7==e?(l="1,2,7,10,13,15",d="3,6,14,16",h=",A.BS IsSummary",t=",A.BS",this.IncomeAccounts.push(15),this.IncomeAccounts.push(13),this.IncomeAccounts.push(1),this.IncomeAccounts.push(2),this.IncomeAccounts.push(7),I.push(3),I.push(6),I.push(14),I.push(16)):8==e&&(l="11",d="12",this.IncomeAccounts.push(11),I.push(12)),this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&this.ViewModel.Preferences.AccountTypesFilter.length>0){let x=this.ViewModel.Preferences.AccountTypesFilter.split(",");for(let b=this.IncomeAccounts.length-1;b>=0;b--)x.Contains(this.IncomeAccounts[b].toString())||this.IncomeAccounts.RemoveAt(b);for(let b=I.length-1;b>=0;b--)x.Contains(I[b].toString())||I.RemoveAt(b);this.IncomeAccounts.forEach(b=>{r.length>0&&(r+=","),r+=b.toString()}),I.forEach(b=>{r.length>0&&(r+=","),r+=b.toString()})}else r=l+","+d;if(8==this.ViewModel.StaticReportType&&(h=",A.PLT IsSummary",t=",A.PLT"),this.exchRate=0,this.ForeignCurrencyID>0)i="AmountFC",a=" AND ACC.CurrencyID="+this.ForeignCurrencyID;else if(i=1==this.CurrencyType?"AmountBC":"Amount",a="",this.ViewModel.Preferences.ContainsKey("FCWithExchRate")){let x=new o.VB;x.LoadXml("<XML>"+this.ViewModel.Preferences.FCWithExchRate+"</XML>");let b=o.VB.SelectSingleNode(x.DocumentElement,"IsChecked");null!=b&&"1"==b.innerHTML&&(this.exchRate=o.J0.Double(o.VB.SelectSingleNodeText(x.DocumentElement,"TextValue")),this.exchRate<=0&&(this.exchRate=1),i="Amount/"+this.exchRate.toString())}let g=!1,N="",P="",W=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();!this.ViewModel.oReportDialog.IsZeroSelected&&!this.ViewModel.oReportDialog.IsOneSelected&&(this.ViewModel.oReportDialog.IsGroupExists?(P="A.AccountID=GTP.GTID",N=W.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+W+") group by T.AccountID\nunion select T.AccountID GTID from ACC_Accounts T with(nolock) where T.IsGroup=1) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+W+" group by T.AccountID\nunion select T.AccountID GTID from ACC_Accounts T with(nolock) where T.IsGroup=1) AS GTP ",g=!0):P=W.Contains(",")?"A.AccountID IN ("+W+")":"A.AccountID="+W),7==e&&T.d.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&T.d.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==T.d.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(this.CADimension=o.J0.Int(T.d.SessionManager.Preferences.ControlAccDimension));let S="",m="",p="",V="",Y="",k="",J="",G=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||this.Show==n.TagWise||G.length>0||this.CADimension>0)&&(m=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+this.LocationWhere+G,p=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+this.LocationWhere+G),this.ShowCorporateLaw&&(k=J=" LEFT JOIN ACC_CorporateDetails CL WITH(NOLOCK) ON CL.AccDocDetailsID=ACC.AccDocDetailsID AND CL.AccountID=ACC.",k+="DebitAccount ",J+="CreditAccount"),this.Show==n.DayWise||this.Show==n.MonthWise||this.Show==n.QtrWise||this.Show==n.HalfYearWise||this.Show==n.YearWise?this.SetColumns(this.Show,e):(this.Show==n.TagWise||this.Show==n.CurrWise)&&(this.strM1=",TagID Mn",this.strM2=this.Show==n.CurrWise?",ACC.CurrencyID TagID":",DCC.dcCCNID"+(this.TagID-5e4)+" TagID",this.strBSM2=this.strM2,this.strM3=",TagID",this.strM4=",TagID",this.strM5=",TagID"),(this.subShow==n.DayWise||this.subShow==n.MonthWise||this.subShow==n.QtrWise||this.subShow==n.HalfYearWise||this.subShow==n.YearWise)&&this.SetColumns(this.subShow,e),this.CADimension>0&&(this.strM1+=",CADID,A1CC.CCNID"+(this.CADimension-5e4)+" CAD",this.strM2+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",this.strBSM2+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",this.strM3+=",CADID",this.strM4+=",CADID",this.strM5+=",CADID"),u="";let _="";0==this.UnPostedDocsList.length?_=" AND (ACC.StatusID=369 or ACC.StatusID=429)":_+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")";let U="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")";if(this.PDCInclude?(s=" AND ACC.DocumentType<>16 AND ("+U+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_+"))",u+=" AND ("+U+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_+"))"):(s=" AND ACC.DocumentType NOT IN (16,14,19)"+_,u+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+_),7==e)S+="\nSELECT A.AccountCode,A.AccountName,ACC.Balance"+this.strM1+",ACC.OpDocBalance"+(this.Show==n.CurrWise?",ACC.BalanceFC,ACC.OpDocBalanceFC":"")+",A.AccountID,A.IsGroup,A.lft,A.rgt,A.AccountTypeID,A.Depth,A.BS IsSummary"+this.ViewModel.SelectTag,this.IsAccountWise&&(S+=",A.ParentID"),S+="\nFROM (",this.Show==n.YearWise&&1!=this.AccountingFromMonth&&(S+="select AccountID,'Y'+convert(nvarchar,Mn) Mn"+(this.CADimension>0?",CADID":"")+",sum(Balance) Balance,sum(OpDocBalance) OpDocBalance from ("),S+="\nSELECT T1.AccountID"+this.strM3.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end CADID")+",SUM(OP_Dr)+SUM(TR_Dr)-(SUM(OP_Cr)+SUM(TR_Cr)) Balance,SUM(OpDocDr)-SUM(OpDocCr) OpDocBalance"+(this.Show==n.CurrWise?",SUM(FCOP_Dr)+SUM(FCTR_Dr)-(SUM(FCOP_Cr)+SUM(FCTR_Cr)) BalanceFC,SUM(FCOpDocDr)-SUM(FCOpDocCr) OpDocBalanceFC":"")+"\n\nFROM (",this.RoundOff.length>0&&(S+="SELECT T2.AccountID"+this.strM5+",round(convert(decimal(18,5),SUM(OP_Dr)),"+this.RoundOff+") OP_Dr,\nround(convert(decimal(18,5),SUM(TR_Dr)),"+this.RoundOff+") TR_Dr,\nround(convert(decimal(18,5),SUM(OP_Cr)),"+this.RoundOff+") OP_Cr,\nround(convert(decimal(18,5),SUM(TR_Cr)),"+this.RoundOff+") TR_Cr,\nround(convert(decimal(18,5),SUM(OpDocDr)),"+this.RoundOff+") OpDocDr,\nround(convert(decimal(18,5),SUM(OpDocCr)),"+this.RoundOff+") OpDocCr"+(this.Show==n.CurrWise?",round(convert(decimal(18,5),SUM(FCOP_Dr)),"+this.RoundOff+") FCOP_Dr,\nround(convert(decimal(18,5),SUM(FCTR_Dr)),"+this.RoundOff+") FCTR_Dr,\nround(convert(decimal(18,5),SUM(FCOP_Cr)),"+this.RoundOff+") FCOP_Cr,\nround(convert(decimal(18,5),SUM(FCTR_Cr)),"+this.RoundOff+") FCTR_Cr,\nround(convert(decimal(18,5),SUM(FCOpDocDr)),"+this.RoundOff+") FCOpDocDr,\nround(convert(decimal(18,5),SUM(FCOpDocCr)),"+this.RoundOff+") FCOpDocCr":"")+"\nFROM ("),S+="\n--Opening Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strBSM2+",ACC."+i+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr,case when ACC.DocumentType=16 then ACC."+i+" else 0 end OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",ACC.AmountFC FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,case when ACC.DocumentType=16 then ACC.AmountFC else 0 end FCOpDocDr,0 FCOpDocCr":"")+"\n\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE (ACC.DocDate<@From OR (ACC.DocumentType=16"+_+")) "+u+a+"\nUNION ALL--Opening Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strBSM2+",0 OP_Dr,ACC."+i+" OP_Cr,0 TR_Dr, 0 TR_Cr,0 OpDocDr,case when ACC.DocumentType=16 then ACC."+i+" else 0 end OpDocCr "+(this.Show==n.CurrWise?",0 FCOP_Dr,ACC.AmountFC FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,case when ACC.DocumentType=16 then ACC.AmountFC else 0 end FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE (ACC.DocDate<@From OR (ACC.DocumentType=16"+_+"))  "+u+a+"\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,ACC."+i+" TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,ACC.AmountFC FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+s+a+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,0 TR_Dr,ACC."+i+" TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,ACC.AmountFC FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+m+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+s+a,p.length>0&&(S+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strBSM2+",ACC."+i+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",ACC.AmountFC FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (DocDate<@From OR (ACC.DocumentType=16"+_+")) "+u+a+"\nUNION ALL--Opening Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strBSM2+",0 OP_Dr,ACC."+i+" OP_Cr,0 TR_Dr, 0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",0 FCOP_Dr,ACC.AmountFC FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (DocDate<@From OR (ACC.DocumentType=16"+_+")) "+u+a+"\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,"+i+" TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,ACC.AmountFC FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+a+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,0 TR_Dr,"+i+" TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==n.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,ACC.AmountFC FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+p+"\nWHERE (DocDate BETWEEN @From AND @To)"+s+a);else{let x="";this.PDCInclude&&(x=" OR (ACC.DocDate<=@To AND (ACC.DocumentType=14 OR ACC.DocumentType=19) AND "+U+")",s=" AND ACC.DocumentType NOT IN (16,14,19) "+_),S+="\n            SELECT distinct A.AccountCode,A.AccountName,ACC.Balance"+this.strM1,this.Show==n.CurrWise&&(S+=",ACC.BalanceFC"),this.ShowCorporateLaw&&(S+=",ACC.BalanceCL"),S+=",A.AccountID,A.IsGroup,A.lft,A.rgt,A.AccountTypeID,A.Depth"+h+this.ViewModel.SelectTag,this.IsAccountWise&&(S+=",A.ParentID"),S+="\nFROM (",(this.Show==n.YearWise||this.subShow==n.YearWise)&&1!=this.AccountingFromMonth&&(S+="select AccountID,'Y'+convert(nvarchar,Mn) Mn"+(this.CADimension>0?",CADID":"")+",sum(Balance) Balance",this.Show==n.TagWise&&(S+=",TagID"),S+=" from ("),S+="SELECT AccountID"+this.strM3+",SUM(TR_Dr)-SUM(TR_Cr) Balance",this.Show==n.CurrWise&&(S+=",SUM(FCTR_Dr)-SUM(FCTR_Cr) BalanceFC",V=",ACC.AmountFC FCTR_Dr,0 FCTR_Cr",Y=",0 FCTR_Dr,ACC.AmountFC FCTR_Cr"),this.ShowCorporateLaw&&(S+=",SUM(CLTR_Dr)-SUM(CLTR_Cr) BalanceCL",V=V+",ISNULL(CL."+i+",ACC."+i+") CLTR_Dr,0 CLTR_Cr",Y=Y+",0 CLTR_Dr,ISNULL(CL."+i+",ACC."+i+") CLTR_Cr"),S+=" FROM (",this.RoundOff.length>0&&(S+="SELECT T2.AccountID"+this.strM5+",round(convert(decimal(18,5),SUM(TR_Dr)),"+this.RoundOff+") TR_Dr,\nround(convert(decimal(18,5),SUM(TR_Cr)),"+this.RoundOff+") TR_Cr",this.Show==n.CurrWise&&(S+=",round(convert(decimal(18,5),SUM(FCTR_Dr)),"+this.RoundOff+") FCTR_Dr,\nround(convert(decimal(18,5),SUM(FCTR_Cr)),"+this.RoundOff+") FCTR_Cr"),this.ShowCorporateLaw&&(S+=",round(convert(decimal(18,5),SUM(CLTR_Dr)),"+this.RoundOff+") CLTR_Dr,\nround(convert(decimal(18,5),SUM(CLTR_Cr)),"+this.RoundOff+") CLTR_Cr"),S+="\nFROM ("),S+="\n--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",ACC."+i+" TR_Dr,0 TR_Cr"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+k+"\nWHERE (((ACC.DocDate BETWEEN @From AND @To)"+s+")"+x+")"+a+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 TR_Dr,ACC."+i+" TR_Cr"+Y+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+m+J+"\nWHERE (((ACC.DocDate BETWEEN @From AND @To)"+s+")"+x+")"+a,p.length>0&&(S+="\n--INEVENTORY DATA\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",ACC."+i+" TR_Dr,0 TR_Cr"+V+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+k+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+s+a+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 TR_Dr,ACC."+i+" TR_Cr"+Y+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+p+J+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+s+a)}this.RoundOff.length>0&&(S+=") AS T2  GROUP BY T2.AccountID,T2.VoucherNo"+this.strM5),S+=") AS T1 ",this.CADimension>0&&(S+=" JOIN ACC_Accounts CA WITH(NOLOCK) ON CA.AccountID=T1.AccountID "),S+=" GROUP BY T1.AccountID"+this.strM4.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end"),this.CADimension>0&&(S+=",CA.AccountTypeID"),(this.Show==n.YearWise||this.subShow==n.YearWise)&&1!=this.AccountingFromMonth&&(S+=") AS T3 GROUP BY T3.AccountID,T3.Mn"+(this.CADimension>0?",T3.CADID":""),this.Show==n.TagWise&&(S+=",T3.TagID")),S+="\n) AS ACC RIGHT JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=ACC.AccountID",this.HideZeroBudgetAccounts&&(this.CurrentBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere))&&(this.ShowBudget||this.ShowBudgetVariance)&&(S+=" inner join (SELECT AccountID FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+") GROUP BY AccountID) as T on T.AccountID=A.AccountID"),S+=this.ViewModel.FromTag,S+=N,this.CADimension>0&&(S+=" left JOIN COM_CCCCDATA A1CC WITH(NOLOCK) ON A1CC.CostCenterID=2 and A1CC.NodeID=A.AccountID"),S+="\nWHERE A.AccountID>1",S+=this.GetAccountWiseLocationWhere("A"),S+=this.ViewModel.HideCostCenterTree?" AND A.AccountTypeID IN ("+r+")":P.length>0?this.IsAccountWise||g?" AND ("+P+(this.CADimension>0?" or A1CC.CCNID"+(this.CADimension-5e4)+">1":"")+")":" AND (A.IsGroup=1 or ("+P+")"+(this.CADimension>0?" or A1CC.CCNID"+(this.CADimension-5e4)+">1":"")+")":" AND A.AccountTypeID IN ("+r+")",this.IsAccountWise?(S+=" AND A.IsGroup=0",S+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By lft":" Order By AccountName"):S+=" Order By lft",(7==this.ViewModel.StaticReportType&&(this.Show==n.YearWise||this.Show==n.MonthWise)||this.subShow!=n.None)&&(S+=",Mn");let z="";z+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",z+=S,this.IsAccountWise&&(z+=" select AccountID,AccountCode,AccountName,AccountTypeID"+h+",lft,Depth,ParentID from acc_accounts A with(nolock) where IsGroup=1 Order By Depth");let O=new H.bT,tt=T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,z);if(O.push("dsNew",tt),(this.ShowPrevMonthData||this.ShowPrevMonthDiffData||this.ShowPrevMonthVarPer)&&O.push("dtPrevMonth",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+S)),-1!=this.YTDIndex&&O.push("dvYTDTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n"+S)),-1!=this.BAL_LYIndex&&O.push("dvBAL_LYTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+S)),-1!=this.YTD_LYIndex&&O.push("dvYTD_LYTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+S)),this.dsOpenCompany=null,this.dblDrOpBalDiff=0,7==e&&(0,F.yG0)(T.d.SessionManager.Preferences.OpenCompany)){let x="";this.YearSlots.length>0&&(x+="<XML>",this.YearSlots.keys.forEach(b=>{x+='<Row ID="'+b+'" EndDate="'+this.YearSlots[b].ToString("dd MMM yyyy")+'" />'}),x+="</XML>"),O.push("dsOpenCompany",T.d.report.GetOpenCompanyData(7,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.TagID,this.LocationWhere+G,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,x.toString(),this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB))}return Promise.all(O.values).then(x=>{let b;if(this.dsNew=x[0],this.dsList.push(this.dsNew),this.dv=this.dsNew.Tables[0],this.dvTable=this.dsNew.Tables[0],this.dvColumns=this.dsNew.Columns[0],this.CADimension>0&&this.RefreshCAD(this.dsNew.Tables[0]),this.ShowSalesPercentage&&(5==e||6==e)){let A,C;C=this.dsNew.Tables[0].filter(5==e?c=>4==c.AccountTypeID||8==c.AccountTypeID:c=>4==c.AccountTypeID||8==c.AccountTypeID||11==c.AccountTypeID),A=C.Compute("sum","Balance"),null!=A&&(this.dblTotalSales=-o.J0.Double(A)),this.ShowSalesPerMonthly&&this.lstTags.forEach(c=>{if(this.Show==n.QtrWise){let D=new Date(o.J0.Int(c.substr(1,4)),o.J0.Int(c.substr(6))-1,1),M=[D.ToString("yyyy-M"),D.AddMonths(1).ToString("yyyy-M"),D.AddMonths(2).ToString("yyyy-M")];A=C.filter(L=>M.Contains(L.Mn)).Compute("sum","Balance")}else if(this.Show==n.HalfYearWise){let D=new Date(o.J0.Int(c.substr(1,4)),o.J0.Int(c.substr(6))-1,1),M=[D.ToString("yyyy-M"),D.AddMonths(1).ToString("yyyy-M"),D.AddMonths(2).ToString("yyyy-M"),D.AddMonths(3).ToString("yyyy-M"),D.AddMonths(4).ToString("yyyy-M"),D.AddMonths(5).ToString("yyyy-M")];A=C.filter(L=>M.Contains(L.Mn)).Compute("sum","Balance")}else A=C.filter(D=>D.Mn==c).Compute("sum","Balance");if(null!=A){let D=-o.J0.Double(A);D>0&&this.lstTagSalesTotal.push(c,D)}})}if(O.ContainsKey("dtPrevMonth")){b=O.keys.indexOf("dtPrevMonth");let A=x[b].Tables[0];for(let C=0;C<A.length;C++){let c=A[C];if(null==c.Mn)continue;let D={};for(let L=0;L<x[b].Columns[0].length;L++)D[x[b].Columns[0][L]]=c[x[b].Columns[0][L]];let M=this.dsNew.Tables[0].filter(L=>L.AccountID==c.AccountID);M.length>0?this.dsNew.Tables[0].InsertAt(D,this.dsNew.Tables[0].indexOf(M[0])):(this.dsNew.Tables[0].push(D),A.Columns.Contains("lft"))}}if(O.ContainsKey("dvYTDTable")&&(b=O.keys.indexOf("dvYTDTable"),this.dvYTDTable=x[b].Tables[0],this.dsNew.Columns[0].push("YTD")),O.ContainsKey("dvBAL_LYTable")&&(b=O.keys.indexOf("dvBAL_LYTable"),this.dvBAL_LYTable=x[b].Tables[0],this.dsNew.Columns[0].push("LastYearBalance")),O.ContainsKey("dvYTD_LYTable")&&(b=O.keys.indexOf("dvYTD_LYTable"),this.dvYTD_LYTable=x[b].Tables[0],this.dsNew.Columns[0].push("LastYearYTD")),this.SetBudgetDataSet(N,P),7==this.ViewModel.StaticReportType){this.dblOpeningBalanceDifference=0;let C=this.dsNew.Tables[0].Compute("sum","OpDocBalance");null!=C&&(this.dblOpeningBalanceDifference=-o.J0.Double(C)),this.lstTagsOpeningBalance.Clear(),(this.Show==n.TagWise||this.Show==n.CurrWise)&&this.lstTagColumns.forEach(c=>{this.dblTemp=0,C=this.Show==n.CurrWise&&this.dsNew.Columns[0].Contains("OpDocBalanceFC")?this.dsNew.Tables[0].filter(D=>D.Mn==c).Compute("sum","OpDocBalanceFC"):this.dsNew.Tables[0].filter(D=>D.Mn==c).Compute("sum","OpDocBalance"),null!=C&&(this.dblTemp=-o.J0.Double(C)),0!=this.dblTemp&&this.lstTagsOpeningBalance.push(c,this.dblTemp)})}if(O.ContainsKey("dsOpenCompany")){if(b=O.keys.indexOf("dsOpenCompany"),this.dsOpenCompany=x[b],this.dsOpenCompany.Tables[0].forEach(C=>{C.Dr=-o.J0.Double(C.Dr),C.Cr=-o.J0.Double(C.Cr)}),this.dsOpenCompany.Tables[1].length>0&&(this.FirstAccountID=null!=this.dsOpenCompany.Tables[1][0].FirstAccount?o.J0.Int(this.dsOpenCompany.Tables[1][0].FirstAccount):0,null!=this.dsOpenCompany.Tables[1][0].PreviousYearEndDate&&o.J0.ParseDate(this.dsOpenCompany.Tables[1][0].PreviousYearEndDate)>=this.ViewModel.oReportDialog.ToDate.Date&&(this.LastAccountID=o.J0.Int(this.dsOpenCompany.Tables[1][0].LastAccount))),this.IncludeOpeningStock||this.IncludeClosingStock){let C={Balance:0};if(this.Show==n.TagWise)this.IncludeOpeningStock&&this.SetStockBalance(!0),this.IncludeClosingStock&&this.SetStockBalance(!1);else if(o.J0.IsEmpty(this.dsOpenCompany)||0!=this.dsOpenCompany.Tables[2].length){this.dblTemp=0,this.dsOpenCompany.Tables[2].Columns.push("OpStock"),this.dsOpenCompany.Tables[2].Columns.push("ClStock"),this.dsOpenCompany.Tables[2].Columns.push("DiffStock");for(let c=0;c<this.dsOpenCompany.Tables[2].length;c++)0==c?((this.IncludeOpeningStock||"3"==T.d.SessionManager.Preferences.StockBasedON)&&(T.d.report.GetStockBalance_Async(1,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,C),this.dblOpeningStock=C.Balance),this.dsOpenCompany.Tables[2][c].OpStock=this.dblOpeningStock,this.dblTemp=this.dblOpeningStock,T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,C),this.dsOpenCompany.Tables[2][c].ClStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].DiffStock=this.dblClosingStock-this.dblOpeningStock):(this.dblOpeningStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].OpStock=this.dblOpeningStock,T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,C),this.dblClosingStock=C.Balance,this.dsOpenCompany.Tables[2][c].ClStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].DiffStock=this.dblClosingStock-this.dblOpeningStock);this.dblOpeningStock=this.dblTemp,"3"==T.d.SessionManager.Preferences.StockBasedON&&(this.dblOpeningBalanceDifference-=this.dblOpeningStock),this.IncludeClosingStock&&o.J0.ParseDate(this.dsOpenCompany.Tables[2][this.dsOpenCompany.Tables[2].length-1].ToDate)<this.ViewModel.oReportDialog.ToDate.Date&&(T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][this.dsOpenCompany.Tables[2].length-1].ToDate).AddDays(1),this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,C),this.dblClosingStock=C.Balance)}else this.IncludeOpeningStock&&(T.d.report.GetStockBalance_Async(1,this.LocationWhere+G,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,C),this.dblOpeningStock=C.Balance),"3"==T.d.SessionManager.Preferences.StockBasedON&&(this.dblOpeningBalanceDifference-=this.dblOpeningStock),this.IncludeClosingStock&&(T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,C),this.dblClosingStock=C.Balance)}this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0;let A=new Array;if(this.YearSlots.length>0){for(let C=this.dsOpenCompany.Tables[0].length-1;C>0;C--)this.dsOpenCompany.Tables[0][C].Dr=o.J0.Double(this.dsOpenCompany.Tables[0][C].Dr)-o.J0.Double(this.dsOpenCompany.Tables[0][C-1].Dr),this.dsOpenCompany.Tables[0][C].Cr=o.J0.Double(this.dsOpenCompany.Tables[0][C].Cr)-o.J0.Double(this.dsOpenCompany.Tables[0][C-1].Cr);for(let C=0;C<this.dsOpenCompany.Tables[0].length;C++){let c=this.dsOpenCompany.Tables[0][C];if(this.dv=this.dvTable.filter(D=>D.AccountID==c.AccountID),this.dv.length>0){let D=0,M=null;for(D=0;D<this.dv.length;D++){if(null==this.dv[D].Mn||o.J0.String(c.Mn)==o.J0.String(this.dv[D].Mn)){M=this.dv[D];break}if(this.Show==n.MonthWise){let L=o.J0.String(c.Mn).split("M"),v=new Date(o.J0.Int(L[0].substr(1,4)),o.J0.Int(L[1])-1,1);if(L=o.J0.String(this.dv[D].Mn).split("M"),v<new Date(o.J0.Int(L[0].substr(1,4)),o.J0.Int(L[1])-1,1)){M=this.dv[D];break}}else if(this.Show==n.YearWise&&o.J0.Double(c.Mn.toString().substr(1,4))<o.J0.Double(this.dv[D].Mn.toString().substr(1,4))){M=this.dv[D];break}}if(null==M||o.J0.String(c.Mn)!=o.J0.String(M.Mn)){let L={};for(let v=0;v<this.dvColumns.length;v++)L[this.dvColumns[v]]=this.dv[0][this.dvColumns[v]];if(L.Mn=o.J0.String(c.Mn),L.Balance=0,null!=M){let v=this.dvTable.indexOf(M);this.dvTable.InsertAt(L,v),null==M.Mn&&this.dvTable.Remove(M)}else{let v=this.dvTable.indexOf(this.dv[this.dv.length-1]);this.dvTable.InsertAt(L,v+1)}M=L}this.dbl=o.J0.Double(M.Balance),o.J0.String(c.Mn)==this.oColumns[this.CellStartPos+this.ColumnSize].ID&&(this.dblAccountsDrOpBalDiff=o.J0.Double(c.Dr),this.dblAccountsCrOpBalDiff=o.J0.Double(c.Cr)),this.dbl=this.dbl+o.J0.Double(c.Dr)-o.J0.Double(c.Cr),M.Balance=this.dbl,A.Contains(M)||A.push(M)}}}else this.dsOpenCompany.Tables[0].forEach(C=>{if(this.Show==n.TagWise){if(this.dv=this.dvTable.filter(c=>c.AccountID==C.AccountID&&c.Mn==C.TagID),0==this.dv.length){if(this.dv=this.dvTable.filter(c=>c.AccountID==C.AccountID&&o.J0.IsEmpty(c.Mn)),this.dv.length>0)this.dv[0].Mn=C.TagID;else if(this.dv=this.dvTable.filter(c=>c.AccountID==C.AccountID),this.dv.length>0){let c={};for(let D=0;D<this.dvColumns.length;D++)c[this.dvColumns[D]]=this.dv[0][this.dvColumns[D]];c.Mn=C.TagID,c.Balance=null,this.dvTable.InsertAt(c,this.dvTable.indexOf(this.dv[0]))}this.dv=this.dvTable.filter(c=>c.AccountID==C.AccountID&&c.Mn==C.TagID)}}else this.dv=this.dvTable.filter(c=>c.AccountID==C.AccountID);if(this.dv.length>0){if(this.dbl=o.J0.Double(this.dv[0].Balance),this.dblAccountsDrOpBalDiff+=o.J0.Double(C.Dr),this.dblAccountsCrOpBalDiff+=o.J0.Double(C.Cr),this.dbl=this.dbl+o.J0.Double(C.Dr)-o.J0.Double(C.Cr),this.IncludeClosingStock||this.IncludeOpeningStock){let c=this.dsOpenCompany.Tables[2].filter(D=>D.AccountID==C.AccountID).Compute("sum","DiffStock");null!=c&&(this.dbl-=o.J0.Double(c))}this.dv[0].Balance=this.dbl}});this.dblDrOpBalDiff>0&&(this.dblDrOpBalDiff=Math.abs(this.dblDrOpBalDiff-this.dblAccountsDrOpBalDiff)),this.dblCrOpBalDiff>0&&(this.dblCrOpBalDiff=Math.abs(this.dblCrOpBalDiff-this.dblAccountsCrOpBalDiff)),this.dblDrOpBalDiff=this.dblDrOpBalDiff-this.dblCrOpBalDiff,this.dv=this.dvTable,0!=this.LastAccountID&&(this.IgnoreGrossRowsForBS=!0)}for(let A=0;A<this.CountMonths;A++)this.dsNew.Columns[0].push(this.oColumns[this.ColumnSize+A].ID);this.ReportFormat!=R.Plain&&(this.dv1=this.dv1Table=this.dsNew.Tables[0],this.dv2=this.dv2Table=this.dsNew.Tables[0],this.dv1=this.dv1Table,this.dv2=this.dv2Table,this.dv1Columns=this.dsNew.Columns[0],this.dv2Columns=this.dsNew.Columns[0],this.dv1=this.dv1.filter(A=>l.split(",").Contains(o.J0.String(A.AccountTypeID))),this.dv2=this.dv2.filter(A=>d.split(",").Contains(o.J0.String(A.AccountTypeID))));let y=this.dsNew.Tables[0].filter(A=>A.AccountID==this.RetainedEarningAccount);if(y.length>0){let c,A=0,C=0;for(let D=0;D<this.CountMonths;D++)y=this.dsNew.Tables[0].filter(M=>M.AccountID==this.RetainedEarningAccount&&M.Mn==this.oColumns[this.ColumnSize+D].ID),A=C=0,c=this.dsNew.Tables[0].filter(M=>l.split(",").Contains(M.AccountTypeID.toString())&&M.Mn==this.oColumns[this.ColumnSize+D].ID).Compute("sum","Balance"),null!=c&&(C=o.J0.Double(c.toString()),A=C),c=this.dsNew.Tables[0].filter(M=>d.split(",").Contains(M.AccountTypeID.toString())&&M.Mn==this.oColumns[this.ColumnSize+D].ID).Compute("sum","Balance"),null!=c&&(C=o.J0.Double(c.toString()),A+=C),y.length>0?(C=o.J0.Double(y[0].Balance.toString()),A=C-A,y.Table.Remove(y[0])):A=-A,y=this.dsNew.Tables[0].filter(M=>M.AccountID==this.RetainedEarningAccount),y.length>0&&(C=o.J0.Double(y[0].Balance.toString()),C+=A,y[0][this.oColumns[this.ColumnSize+D].ID]=C)}if(y=this.dsNew.Tables[0].filter(A=>A.AccountID==this.RetainedEarningAccount),y.length>0){let C,A=0,c=this.dsNew.Tables[0].filter(D=>l.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance");null!=c&&(C=o.J0.Double(c),A=C),c=this.dsNew.Tables[0].filter(D=>d.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(C=o.J0.Double(c),A+=C),A+=this.dblOpeningBalanceDifference,this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(y[0].AccountTypeID)),C=o.J0.Double(y[0].Balance),C-=A,C-=this.dblClosingStock-this.dblOpeningStock,this.dblDrOpBalDiff>0?C-=this.dblDrOpBalDiff:C+=this.dblDrOpBalDiff,y[0].Balance=C,this.CountMonths>0&&(y[0][this.oColumns[this.ColumnSize+this.CountMonths-1].ID]=C),-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter(D=>D.AccountID==this.RetainedEarningAccount),this.dvYTD.length>0&&(c=this.dvYTD.filter(D=>l.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(C=o.J0.Double(c),this.dblTemp=C),c=this.dvYTD.filter(D=>d.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(C=o.J0.Double(c),this.dblTemp=this.dblTemp+C),C=o.J0.Double(this.dvYTD[0].Balance),this.dvYTD[0].Balance=C-this.dblTemp)),7==this.ViewModel.StaticReportType&&(0,F.yG0)(T.d.SessionManager.Preferences.OpenCompany)&&(this.IgnoreGrossRowsForBS=!0)}if(this.IsAccountWise&&this.UpdateDataTableWithGroups(),(this.Show==n.TagWise||this.Show==n.CurrWise)&&this.HideEmptyDimensions){let A=!1;if(this.lstTagColumns.forEach(C=>{var c=this.oColumns.find(D=>D.ID==C);c&&(0==this.dsNew.Tables[0].filter(D=>D.Mn==c.ID).length?this.lstTagVisibleColumns.Contains(C)||(c.HeaderAppearance.IsVisible=!1,null!=(c=this.oColumns.find(D=>D.ID=="Budget"+C))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Variance"+C))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="PercentVariance"+C))&&(c.HeaderAppearance.IsVisible=!1),A=!0):(c.HeaderAppearance.IsVisible=!0,this.lstTagVisibleColumns.push(C)))}),this.subShow!=n.None&&this.lstTags.forEach(C=>{if(C.startsWith("T")){var c=this.oColumns.find(D=>D.ID==C);null!=c&&(0==this.dsNew.Tables[0].filter(D=>D.Mn==c.ID).length?this.lstTagVisibleColumns.Contains(C)||(c.HeaderAppearance.IsVisible=!1,null!=(c=this.oColumns.find(D=>D.Index==c.Index+1&&D.ID.startsWith("Perc_")))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Budget"+C))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Variance"+C))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="PercentVariance"+C))&&(c.HeaderAppearance.IsVisible=!1),A=!0):(c.HeaderAppearance.IsVisible=!0,this.lstTagVisibleColumns.push(C)))}}),A){let C=new Array;this.oColumns.forEach(c=>{C.push(c)}),this.ViewModel.ReportColumns=C}}this.Show==n.CompWise&&this.SetConsolidateData(this.dsNew,z.toString())})}SetBudgetDataSet(e,h){if(this.dvPrevBudget=null,this.dvCurrentBudget=null,this.dvCurrentBudgetTable=null,this.ShowBudget||this.ShowBudgetVariance||this.ShowBudgetVariancePercent||this.ShowTotalBudget){if(null==this.dsBudget){let t,i="",a="",r="",l=this.ViewModel.oReportDialog.CostCenterFilters.filter(u=>u.CostCenterID>5e4&&u.SelectedNodes.length>0);if(!o.J0.IsEmpty(l)&&l.length>0||this.LocationWhere.length>0){let u="SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+") and CostCenterID>50000";(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)&&(u+=" SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.PreviousBudgetWhere)?this.PreviousBudgetID.toString():this.PreviousBudgetWhere)+") and CostCenterID>50000");let f=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,u);f.Tables[0].forEach(I=>{if(l.length>0&&l.find(g=>g.CostCenterID==o.J0.Int(I.CostCenterID))){let g=this.GetFilterByDimension_1(o.J0.Int(I.CostCenterID));g.length>0&&(a+=" AND CCNID"+(o.J0.Int(I.CostCenterID)-5e4)+" IN ("+g+")")}50002==o.J0.Int(I.CostCenterID)&&this.LocationWhere.length>0&&(a+=this.LocationWhere.Replace("DCC.dc",""))}),f.Tables.length>1&&f.Tables[1].forEach(I=>{if(l.length>0&&l.find(g=>g.CostCenterID==o.J0.Int(I.CostCenterID))){let g=this.GetFilterByDimension_1(o.J0.Int(I.CostCenterID));g.length>0&&(r+=" AND CCNID"+(o.J0.Int(I.CostCenterID)-5e4)+" IN ("+g+")")}50002==o.J0.Int(I.CostCenterID)&&this.LocationWhere.length>0&&(r+=this.LocationWhere.Replace("DCC.dc",""))})}let d=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),s=0;t=this.dtYearStartMonth,i+="SELECT BA.AccountID",this.Show==n.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4)+" TagID"),i+=",SUM(BA.AnnualAmount) AnnualAmount";for(let u=1;u<=12;u++)i+=",SUM(CASE WHEN BD.FinYearStartDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(s).ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+t.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"')) THEN BA.Month"+u+"Amount ELSE 0 END) "+t.ToString("MMMyyyy"),t<d&&12==u&&(s++,u=0),t=t.AddMonths(1);if(i+=" FROM COM_BudgetAlloc BA with(nolock) \n                JOIN COM_BudgetDef BD with(nolock) ON BD.BudgetDefID=BA.BudgetDefID\n                WHERE BA.BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID:this.CurrentBudgetWhere)+")",i+=a.toString(),i+=" GROUP BY BA.AccountID",this.Show==n.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4)),(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){let u=0;t=this.dtYearStartMonth,i+=" SELECT BA.AccountID",this.Show==n.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4)+" TagID"),i+=",SUM(BA.AnnualAmount) AnnualAmount";for(let f=1;f<=12;f++)i+=",SUM(CASE WHEN BD.FinYearStartDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(u).ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+t.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"')) THEN BA.Month"+f+"Amount ELSE 0 END) "+t.ToString("MMMyyyy"),t<d&&12==f&&(u++,f=0),t=t.AddMonths(1);if(i+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+")",i+=a.toString(),i+=" GROUP BY AccountID",(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){i+=" SELECT AccountID,SUM(AnnualAmount) AnnualAmount",t=this.dtYearStartMonth;for(let f=1;f<=12;f++)i+=",SUM(Month"+f+"Amount) "+t.ToString("MMMyyyy"),t=t.AddMonths(1);i+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.PreviousBudgetWhere)?this.PreviousBudgetID.toString():this.PreviousBudgetWhere)+")",i+=r.toString(),i+=" GROUP BY AccountID",this.Show==n.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4))}}this.dsBudget=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,i)}this.dvCurrentBudget=this.dvCurrentBudgetTable=this.dsBudget.Tables[0],this.dsBudget.Tables.length>1&&(this.dvPrevBudget=this.dvPrevBudgetTable=this.dsBudget.Tables[1]),this.dsNew.Columns[0].push("BudgetBalance"),this.dsNew.Columns[0].push("VarianceBalance"),this.dsNew.Columns[0].push("PercentVarianceBalance"),-1!=this.YTDIndex&&(this.dsNew.Columns[0].push("BudgetYTD"),this.dsNew.Columns[0].push("VarianceYTD"),this.dsNew.Columns[0].push("PercentVarianceYTD")),-1!=this.BAL_LYIndex&&(this.dsNew.Columns[0].push("BudgetLastYearBalance"),this.dsNew.Columns[0].push("VarianceLastYearBalance"),this.dsNew.Columns[0].push("PercentVarianceLastYearBalance")),-1!=this.YTD_LYIndex&&(this.dsNew.Columns[0].push("BudgetLastYearYTD"),this.dsNew.Columns[0].push("VarianceLastYearYTD"),this.dsNew.Columns[0].push("PercentVarianceLastYearYTD"))}}SetDataSetForPostFilters(e,h){let i="",a="",r="",l="";5==e?(r="4,8",l="5,9",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8)):6==e?(r="4,8,11",l="5,9,12",i=",A.PL IsSummary",a=",A.PL",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),this.IncomeAccounts.push(11)):7==e?(r="13,15,1,2,7",l="14,16,6,3",i=",A.BS IsSummary",a=",A.BS",this.IncomeAccounts.push(15),this.IncomeAccounts.push(13),this.IncomeAccounts.push(1),this.IncomeAccounts.push(2),this.IncomeAccounts.push(7)):8==e&&(r="11",l="12",this.IncomeAccounts.push(11)),this.dv=this.dvTable=this.dsNew.Tables[0],this.dvColumns=this.dsNew.Columns[0],this.dsOpenCompany=null,this.dblDrOpBalDiff=0,7==e&&(0,F.yG0)(T.d.SessionManager.Preferences.OpenCompany)&&(this.dsOpenCompany=T.d.report.GetOpenCompanyData(7,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,0,this.LocationWhere,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB),this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0,this.dsOpenCompany.Tables[0].forEach(I=>{this.dv=this.dvTable.filter(g=>g.AccountID==I.AccountID),this.dv.length>0&&(this.dbl=o.J0.Double(this.dv[0].Balance),this.dblAccountsDrOpBalDiff+=o.J0.Double(I.Dr),this.dblAccountsCrOpBalDiff+=o.J0.Double(I.Cr),this.dbl=this.dbl+o.J0.Double(I.Dr)-o.J0.Double(I.Cr),this.dv[0].Balance=this.dbl)}),this.dblDrOpBalDiff>0&&(this.dblDrOpBalDiff=Math.abs(this.dblDrOpBalDiff-this.dblAccountsDrOpBalDiff)),this.dblCrOpBalDiff>0&&(this.dblCrOpBalDiff=Math.abs(this.dblCrOpBalDiff-this.dblAccountsCrOpBalDiff)),this.dblDrOpBalDiff=this.dblDrOpBalDiff-this.dblCrOpBalDiff,this.dv=this.dvTable),r="AccountTypeID IN ("+r+")",l="AccountTypeID IN ("+l+")",this.ReportFormat!=R.Plain?(this.dv1=this.dv1Table=this.dsNew.Tables[0],this.dv2=this.dv2Table=this.dsNew.Tables[0],this.dv1=this.dv1.filter(I=>r.split(",").Contains(I.AccountTypeID.toString())),this.dv2=this.dv2.filter(I=>l.split(",").Contains(I.AccountTypeID.toString())),this.dv1=K.d.FilterData(this.dv1,this.ViewModel.PostDataFetchFilterFields),this.dv2=K.d.FilterData(this.dv2,this.ViewModel.PostDataFetchFilterFields)):h.length>0&&(this.dv=K.d.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields));let f=this.dsNew.Tables[0].filter(I=>I.AccountID==this.RetainedEarningAccount);if(f.length>0){let I=0,g=0,N=this.dv1Table.filter(P=>r.split(",").Contains(P.AccountTypeID.toString())).Compute("sum","Balance");null!=N&&(g=o.J0.Double(N),I=g),N=this.dv1Table.filter(P=>l.split(",").Contains(P.AccountTypeID.toString())).Compute("sum","Balance"),null!=N&&(g=o.J0.Double(N),I+=g),this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(f[0].AccountTypeID)),g=o.J0.Double(f[0].Balance),g-=I,this.dblDrOpBalDiff>0?g-=this.dblDrOpBalDiff:g+=this.dblDrOpBalDiff,f[0].Balance=g}}RefreshCAD(e){let h=new H.G9;for(let t=e.length-1;t>=0;t--)if(null!=e[t].CADID&&o.J0.Int(e[t].CADID)>1){let i=o.J0.Int(e[t].CADID);if(!h.ContainsKey(i)){let a=e.filter(r=>r.CAD==i);a.length>0&&h.push(i,a[0])}h.ContainsKey(i)&&(null!=e[t].Balance&&(h[i].Balance=null==h[i].Balance?e[t].Balance:o.J0.Double(h[i].Balance)+o.J0.Double(e[t].Balance)),null!=e[t].OpDocBalance&&(h[i].OpDocBalance=null==h[i].OpDocBalance?e[t].OpDocBalance:o.J0.Double(h[i].OpDocBalance)+o.J0.Double(e[t].OpDocBalance)),h.values.Contains(e[t])||e.RemoveAt(t))}}LoadReportWithPostFilters(e){this.GrdRow=-1,this.CellStartPos=0,this.ReportRowStartIndex=-1,this.FirstTypeEndIndex=0,this.ReportTotal=new Array(2).fill(0),this.lstTotal=new Array,this.GrossRows[0]=null,this.GrossRows[1]=null,this.ShowIncomeFirst="Income"==this.ViewModel.Preferences.ShowFirst,this.ViewModel.ClearRows(),this.TempData.Clear(),8!=this.ViewModel.StaticReportType?(this.dsNew=this.dsList[0],this.SetDataSetForPostFilters(this.ViewModel.StaticReportType,e),this.ReportFormat==R.Plain?this.LoadPlainReport():this.LoadHorizontalVerticalReports()):(this.OldReportTotalMonthWise=null,this.dsNew=this.dsList[0],this.SetDataSetForPostFilters(5,e),this.LoadHorizontalVerticalReports(),this.Olddbl=this.dbl,this.CellStartPos=0,this.ReportRowStartIndex=this.GrdRow,this.ReportTotal[0]=this.ReportTotal[1]=0,this.ShowIncomeFirst=!(!this.ViewModel.Preferences.ContainsKey("ShowFirst2")||"Income"!=this.ViewModel.Preferences.ShowFirst2),this.dsNew=this.dsList[1],this.SetDataSetForPostFilters(8,e),this.LoadHorizontalVerticalReports()),this.LoadReportComplete()}GetQuarterID(e){for(let h=0;h<this.QtrSlot.keys.length;h++)if(this.QtrSlot.values[h].dtStart<=e&&this.QtrSlot.values[h].dtEnd>=e)return this.QtrSlot.keys[h];return""}LoadHorizontalVerticalReports(){this.ReportTotalMonthWise=o.J0.NumArray(2,this.CountMonths+4),this.ReportTotalYTD=o.J0.NumArray(2,3),this.ReportTotalALL=o.J0.NumArray(2,this.oColumns.length),this.strIncomeLabel=7==this.ViewModel.StaticReportType?T.d.GetResource("Reports_LblAssets").toUpperCase():T.d.GetResource("Reports_LblIncome").toUpperCase(),this.strExpenseLabel=7==this.ViewModel.StaticReportType?T.d.GetResource("Reports_LblLiabilities").toUpperCase():T.d.GetResource("Reports_LblExpneses").toUpperCase(),8!=this.ViewModel.StaticReportType?(this.ViewModel.Preferences.ContainsKey("Income1Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income1Label),this.ViewModel.Preferences.ContainsKey("Expneses1Label")&&(this.strExpenseLabel=this.ViewModel.Preferences.Expneses1Label)):-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Income1Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income1Label,this.strExpenseLabel=this.ViewModel.Preferences.Expneses1Label):this.ViewModel.Preferences.ContainsKey("Income2Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income2Label,this.strExpenseLabel=this.ViewModel.Preferences.Expneses2Label),this.AddSection(this.ShowIncomeFirst,!0),this.AddSection(!this.ShowIncomeFirst,!1),this.AddOpenBalanceDifference(),7==this.ViewModel.StaticReportType?(this.AddOpenBalanceDifferenceForBS(),this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=!(this.dbl>=0),Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?this.ReportTotal[1]=this.ReportTotal[1]-this.dbl:this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.dbl<0&&(this.dbl=-this.dbl)):(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=this.dbl>=0,this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex||(Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?(this.ReportTotal[1]=this.ReportTotal[1]-this.dbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[1][this.BalIndex+1]=this.ReportTotalALL[1][this.BalIndex+1]+this.dbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]=this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]+this.dbl))):Math.abs(this.ReportTotal[0])>0&&(this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[0][this.BalIndex+1]=this.ReportTotalALL[0][this.BalIndex+1]+this.dbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]=this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]+this.dbl)))),this.dbl<0&&(this.dbl=-this.dbl)),this.AddReportTotal(this.ShowIncomeFirst,!0),this.AddReportTotal(!this.ShowIncomeFirst,!1)}AddSection(e,h){this.IsIncome=e,this.IsFirstCall=h,this.lstParents.Clear(),this.lstTotal.Clear(),h||(this.FirstTypeEndIndex=this.GrdRow,this.ReportFormat==R.Horizontal&&(this.GrdRow=this.ReportRowStartIndex,this.CellStartPos=this.CellStartPos+this.ColumnSize)),e?(this.dv=this.dv1,this.dvTable=this.dv1Table,this.dvColumns=this.dv1Columns,this.ReportTotalIndex=0,this.AddGroup(this.strIncomeLabel)):(this.dv=this.dv2,this.dvTable=this.dv2Table,this.dvColumns=this.dv2Columns,this.ReportTotalIndex=1,this.AddGroup(this.strExpenseLabel)),-1!=this.ReportRowStartIndex?this.AddRow_BF():e||this.AddOpeningStock();let t,i,a,r=0,l=0;for(let d=0;d<this.dv.length;d++)if(this.drAccount=this.dv[d],e=this.IncomeAccounts.Contains(o.J0.Int(this.drAccount.AccountTypeID)),this.strAccountID=this.drAccount.AccountID.toString(),i=!1,(0,F.yG0)(this.drAccount.IsGroup))this.dbl=0,this.AddRow();else{if(this.Show!=n.None){if(this.dblTemp=0,this.dblCLTemp=0,this.AccountID=o.J0.Int(this.drAccount.AccountID),this.strTemp=o.J0.String(this.drAccount.Mn),this.strTemp2=this.strTagMn="",7!=this.ViewModel.StaticReportType||this.Show!=n.MonthWise&&this.Show!=n.YearWise||this.AccountID==this.RetainedEarningAccount){if(this.strTemp.length>0&&((this.Show==n.QtrWise||this.Show==n.HalfYearWise)&&(this.strTemp=this.GetQuarterID(new Date(o.J0.Int(this.strTemp.split("-")[0]),o.J0.Int(this.strTemp.split("-")[1])-1,1))),o.J0.IsEmpty(this.strTemp)||(this.lstPMTags.Contains(this.strTemp)||o.J0.IsEmpty(this.drAccount.Balance)?this.dblTemp=0:(this.dblTemp=o.J0.Double(this.drAccount.Balance),this.ShowCorporateLaw&&(this.dblCLTemp=parseFloat(this.drAccount.BalanceCL))),this.dblCLTemp=0,i=this.Show!=n.TagWise||Math.abs(this.dblTemp)>1e-4,this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.Show==n.CurrWise&&this.dvColumns.Contains("BalanceFC")?this.drAccount.BalanceFC:this.drAccount.Balance),this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp])),this.strTemp2=this.strTemp,this.dvColumns.Contains("TagMn")&&(this.strTagMn=this.drAccount.TagMn.toString(),this.strTagMn.length>0&&this.dvColumns.Contains(this.strTagMn)&&null==this.drAccount[this.strTagMn]))){let s=this.dsNew.Tables[0].Compute("sum(Balance)","AccountID='"+this.AccountID+"' AND TagMn='"+this.strTagMn+"'");null!=s&&(this.drAccount[this.strTagMn]=parseFloat(s))}for(;d+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[d+1].AccountID);){if(this.strTemp=o.J0.String(this.dv[d+1].Mn),this.strTemp.length>0&&(this.Show==n.QtrWise||this.Show==n.HalfYearWise?(this.strTemp=this.GetQuarterID(new Date(o.J0.Int(this.strTemp.split("-")[0]),o.J0.Int(this.strTemp.split("-")[1])-1,1)),!this.lstPMTags.Contains(this.strTemp)&&!o.J0.IsEmpty(this.dv[d+1].Balance)&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[d+1].Balance),this.ShowCorporateLaw&&(this.dblCLTemp=this.dblCLTemp+parseFloat(this.dv[d+1].BalanceCL))),this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=null==this.drAccount[this.strTemp]?this.dv[d+1].Balance:o.J0.Double(this.drAccount[this.strTemp])+o.J0.Double(this.dv[d+1].Balance),this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&null!=this.drAccount[this.strTemp]&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp]))):(!this.lstPMTags.Contains(this.strTemp)&&!o.J0.IsEmpty(this.dv[d+1].Balance)&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[d+1].Balance),this.ShowCorporateLaw&&(this.dblCLTemp=this.dblCLTemp+parseFloat(this.dv[d+1].BalanceCL)),!i&&this.Show==n.TagWise&&(i=Math.abs(o.J0.Double(this.dv[d+1].Balance))>1e-4)),this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.Show==n.CurrWise&&this.drAccount.Contains("BalanceFC")?this.dv[d+1].BalanceFC:this.dv[d+1].Balance,this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&null!=this.drAccount[this.strTemp]&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp]))),this.subShow!=n.None&&this.dvColumns.Contains("Perc_"+this.strTemp)&&this.dvColumns.Contains(this.strTemp2)&&this.dvColumns.Contains(this.strTemp)&&(this.drAccount["Perc_"+this.strTemp]=(o.J0.Double(this.drAccount[this.strTemp2])-o.J0.Double(this.drAccount[this.strTemp]))/o.J0.Double(this.drAccount[this.strTemp])*100),this.strTemp2=this.strTemp,this.dvColumns.Contains("TagMn")&&this.strTagMn!=this.dv[d+1].TagMn.toString()&&(this.strTagMn=this.dv[d+1].TagMn.toString(),this.strTagMn.length>0&&this.dvColumns.Contains(this.strTagMn)&&null==this.drAccount[this.strTagMn]))){let s=this.dsNew.Tables[0].Compute("sum(Balance)","AccountID='"+this.AccountID+"' AND TagMn='"+this.strTagMn+"'");null!=s&&(this.drAccount[this.strTagMn]=parseFloat(s))}this.dv.Remove(this.dv[d+1])}if(this.subShow!=n.None&&this.SubShowPerc)for(let s=1;s<this.lstTags.length;s++)this.dvColumns.Contains("Perc_"+this.lstTags[s])&&this.dvColumns.Contains(this.lstTags[s])&&this.dvColumns.Contains(this.lstTags[s-1])&&(r=l=0,r=null==this.drAccount[this.lstTags[s]]?0:o.J0.Double(this.drAccount[this.lstTags[s]]),l=null==this.drAccount[this.lstTags[s-1]]?0:o.J0.Double(this.drAccount[this.lstTags[s-1]]),0!=l&&(this.drAccount["Perc_"+this.lstTags[s]]=(r-l)/l*100));if(this.ShowPrevMonthDiffData)for(let s=0;s<this.lstTags.length;s++)this.dvColumns.Contains(this.lstTags[s])&&this.dvColumns.Contains(this.lstPMTags[s])&&(this.drAccount["DIFF_"+this.lstTags[s]]=(null==this.drAccount[this.lstTags[s]]?0:o.J0.Double(this.drAccount[this.lstTags[s]]))-(null==this.drAccount[this.lstPMTags[s]]?0:o.J0.Double(this.drAccount[this.lstPMTags[s]])));if(this.ShowPrevMonthVarPer)for(let s=0;s<this.lstTags.length;s++)this.dvColumns.Contains(this.lstTags[s])&&this.dvColumns.Contains(this.lstPMTags[s])&&(r=l=0,r=(""==o.J0.String(this.drAccount[this.lstTags[s]])?0:o.J0.Double(this.drAccount[this.lstTags[s]]))-(""==o.J0.String(this.drAccount[this.lstTags[s]])?0:o.J0.Double(this.drAccount[this.lstPMTags[s]])),l=""==o.J0.String(this.drAccount[this.lstTags[s]])?0:o.J0.Double(this.drAccount[this.lstPMTags[s]]),0!=l&&(r=100*r/l),this.drAccount["VARPER_"+this.lstTags[s]]=r)}else if(this.strTemp.length>0)if(i=!0,this.dblTemp=o.J0.Double(this.drAccount.Balance),this.dvColumns.Contains(this.strTemp)){let s=!1;for(let u=0;u<this.CountMonths;u++)s?(d+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[d+1].AccountID)&&(this.strTemp=o.J0.String(this.dv[d+1].Mn),this.strTemp.length>0&&this.oColumns[this.CellStartPos+this.ColumnSize+u].ID==this.strTemp&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[d+1].Balance),this.dvTable.Remove(this.dv[d+1]),this.dv.Remove(this.dv[d+1]))),this.drAccount[this.oColumns[this.CellStartPos+this.ColumnSize+u].ID]=this.dblTemp):this.oColumns[this.CellStartPos+this.ColumnSize+u].ID==this.strTemp&&(s=!0,this.drAccount[this.strTemp]=this.dblTemp)}else for(let s=0;s<this.CountMonths;s++)d+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[d+1].AccountID)&&(this.strTemp=o.J0.String(this.dv[d+1].Mn),this.strTemp.length>0&&this.oColumns[this.CellStartPos+this.ColumnSize+s].ID==this.strTemp&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[d+1].Balance),this.dvTable.Remove(this.dv[d+1]),this.dv.Remove(this.dv[d+1]))),this.drAccount[this.oColumns[this.CellStartPos+this.ColumnSize+s].ID]=this.dblTemp;this.drAccount.Balance=this.dblTemp,this.ShowCorporateLaw&&(this.drAccount.BalanceCL=this.dblCLTemp)}if(this.dbl=o.J0.Double(this.drAccount.Balance),t=!1,null!=this.dvCurrentBudget&&(this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(s=>s.AccountID==this.strAccountID),this.dvCurrentBudget.length>0&&(t=!0)),a=!1,(Math.abs(this.dbl)>.01||this.ShowAllAccounts||t||i)&&(a=!0),!a&&null!=this.dvYTD){let s=this.dvYTD.filter(u=>u.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(a=!0)}if(!a&&null!=this.dvYTD_LY){let s=this.dvYTD_LY.filter(u=>u.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(a=!0)}if(!a&&null!=this.dvBAL_LY){let s=this.dvBAL_LY.filter(u=>u.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(a=!0)}if(a){if(this.Show==n.DayWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;s<=this.ViewModel.ToDatePicker.Date;)this.strTemp=s.ToString("ddMMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dblActBudget=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate()]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate()]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),s=s.AddDays(1)}}else if(this.Show==n.MonthWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;s<=this.ViewModel.ToDatePicker.Date;)this.strTemp=s.ToString("MMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dblActBudget=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),s=s.AddMonths(1)}}else if(this.Show==n.QtrWise||this.Show==n.HalfYearWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=null,u=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;u<=this.ViewModel.ToDatePicker.Date;)this.strTemp=u.ToString("MMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dbl=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.strTemp=this.GetQuarterID(u),s!=this.strTemp?this.dblActBudget=this.dbl:this.dblActBudget+=this.dbl,s=this.strTemp,this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount[this.strTemp]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount[this.strTemp]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),u=u.AddMonths(1)}}else this.Show!=n.TagWise||null==this.dvCurrentBudget||this.HideTagWiseBudget||this.lstTags.forEach(u=>{this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(f=>f.AccountID==this.strAccountID&&f.TagID==u),this.dblActBudget=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount["Budget"+u]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount[u]),this.drAccount["Variance"+u]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount[u]),this.drAccount["PercentVariance"+u]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)});this.AddRow()}}!h&&this.GrdRow+1<this.TempData.length&&(this.TempData[this.GrdRow+1].Cells[this.CellStartPos].Text="",this.TempData[this.GrdRow+1].Cells[this.CellStartPos+1].Text="",this.ViewModel.ColumnSource.length>2&&(this.TempData[this.GrdRow+1].Cells[this.CellStartPos+2].Text="")),this.UpdateTreeTotals(0),-1==this.ReportRowStartIndex&&e&&this.AddClosingStock(),this.AddNetProfitBeforeOtherIncome()}AddRow(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=o.J0.Int(this.drAccount.Depth)-1,this.IsAccountWise||this.UpdateTreeTotals(this.oRow.LevelNo),this.oRow.NodeID=o.J0.Int(this.drAccount.AccountID),this.oRow.DataRow=this.drAccount,this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.ReportFormat==R.Horizontal?this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.TempData[this.GrdRow]):this.IsAddRow=1),this.ReportFormat==R.Horizontal&&!this.IsFirstCall&&(this.oRow.Tag=o.J0.Int(this.drAccount.AccountID)),this.oRow.IsGroup=(0,F.yG0)(this.drAccount.IsGroup),this.IsAccountWise||(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].level=o.J0.Int(this.drAccount.Depth)-1),(0,F.yG0)(this.drAccount.IsGroup)){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment;this.oRow.Type=w.QS.BalanceBF}else{this.ReportTotal[this.ReportTotalIndex]+=this.dbl;for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!0,this.oRow.Cells[e].CellAppearance=null}if(this.TextFields.keys.forEach(e=>{let h={Key:e,Value:this.TextFields[e]};this.dvColumns.Contains(h.Key)&&(this.oRow.Cells[this.CellStartPos+h.Value].Text=o.J0.String(this.drAccount[h.Key]),this.oRow.Cells[this.CellStartPos+h.Value].Value=this.oRow.Cells[this.CellStartPos+h.Value].Text)}),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,!this.oRow.IsGroup){let e=0,h=0;if(this.FormatData(this.oRow.Cells[this.CellStartPos+this.BalIndex],this.dbl,this.oColumns[this.BalIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl),-1!=this.BAL_CLIndex&&(this.dblTemp=o.J0.Double(this.drAccount.BalanceCL),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_CLIndex]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.BAL_CLIndex],this.dblTemp,this.oColumns[this.BAL_CLIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_CLIndex]+=this.dblTemp)),-1!=this.YTDIndex&&(h=0,this.dvYTD=this.dvYTDTable.filter(t=>t.AccountID==this.strAccountID),this.dvYTD.length>0&&(this.dblTemp=o.J0.Double(this.dvYTD[0].Balance),h=this.dblTemp,this.drAccount.YTD=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][0]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.YTDIndex],this.dblTemp,this.oColumns[this.YTDIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex]+=this.dblTemp))),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter(t=>t.AccountID==this.strAccountID),this.dvBAL_LY.length>0&&(this.dblTemp=o.J0.Double(this.dvBAL_LY[0].Balance),this.drAccount.LastYearBalance=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][1]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.BAL_LYIndex],this.dblTemp,this.oColumns[this.BAL_LYIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex]+=this.dblTemp),null!=this.dvPrevBudgetTable&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(t=>t.AccountID==this.strAccountID),this.dblActBudget=this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(this.dblActBudget,this.oColumns[this.BAL_LYIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]+=this.dblActBudget,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex-1]+=this.dblActBudget)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dblTemp-this.dblActBudget:this.dblActBudget-this.dblTemp,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.BAL_LYIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=this.dblActBudget?100*e/this.dblActBudget:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex+this.VariancePercentIndex]+=e)))))),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter(t=>t.AccountID==this.strAccountID),this.dvYTD_LY.length>0&&(this.dblTemp=o.J0.Double(this.dvYTD_LY[0].Balance),this.drAccount.LastYearYTD=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][2]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.YTD_LYIndex],this.dblTemp,this.oColumns[this.YTD_LYIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex]+=this.dblTemp),null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(t=>t.AccountID==this.strAccountID),this.dblActBudget=this.GetBudgetAmount(this.dvPrevBudget,this.dtYearStartMonth,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(this.dblActBudget,this.oColumns[this.YTD_LYIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]+=this.dblActBudget,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex-1]+=this.dblActBudget)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dblTemp-this.dblActBudget:this.dblActBudget-this.dblTemp,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.YTD_LYIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=this.dblActBudget?100*e/this.dblActBudget:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex+this.VariancePercentIndex]+=e)))))),null!=this.dvCurrentBudget){this.dvCurrentBudget=this.dvCurrentBudget.filter(i=>i.AccountID==this.strAccountID);let t=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date);this.ShowBudget&&(this.ViewModel.SetCellValue(t,this.oColumns[this.BalIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]+=t,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex-1]+=t)),this.ShowTotalBudget&&(this.dblTemp=this.GetBudgetAmount(this.dvCurrentBudget),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex-this.TotalBudgetIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex-this.TotalBudgetIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-this.TotalBudgetIndex]+=this.dblTemp,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex-this.TotalBudgetIndex]+=this.dblTemp)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dbl-t:t-this.dbl,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=t?100*e/t:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+this.VariancePercentIndex]+=e))),-1!=this.YTDIndex&&(t=this.GetBudgetAmount(this.dvCurrentBudget,this.dtYearStartMonth,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(t,this.oColumns[this.YTDIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]+=t,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex-1]+=t)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-h-t:t-h,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.YTDIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=t?100*e/t:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.YTDIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex+this.VariancePercentIndex]+=e))))}this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=this.IsIncome?100*-this.dbl/this.dblTotalSales:100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.SalesPercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.SalesPercentIndex]+=this.dblTemp,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+this.SalesPercentIndex]+=this.dblTemp));for(let t=0;t<this.CountMonths;t++)this.dblTemp=o.J0.Double(this.drAccount[this.oColumns[this.ColumnSize+t].ID]),this.ReportTotalMonthWise[this.ReportTotalIndex][t]+=this.dblTemp,this.oColumns[this.ColumnSize+t].ID.startsWith("Budget")||this.oColumns[this.ColumnSize+t].ID.startsWith("Variance")||this.oColumns[this.ColumnSize+t].ID.startsWith("VARPER_")?this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.ColumnSize+t].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+t]):this.FormatData(this.oRow.Cells[this.CellStartPos+this.ColumnSize+t],this.dblTemp,this.oColumns[this.ColumnSize+t]),this.lstTotal.length>0&&!this.oColumns[this.ColumnSize+t].ID.startsWith("VARPER_")&&(this.lstTotal[this.lstTotal.length-1][this.CellStartPos+this.ColumnSize+t]+=this.dblTemp);this.ViewModel.ApplyKPI(this.oRow)}if(1==this.IsAddRow){if(!(this.ShowdetailsofControlGroups||(this.oRow.IsExpanded=!(0,F.yG0)(this.drAccount.IsSummary),(0,F.yG0)(this.drAccount.IsSummary)&&(this.oRow.Type=w.QS.Detail),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.Visible=!1,this.ReportFormat!=R.Horizontal))))return void this.GrdRow--;if(this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Columns.length>1&&this.dsOpenStock.Columns.length>2)for(let e=0;e<this.dsOpenStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(2==this.IsAddRow){if(!this.ShowdetailsofControlGroups){this.oRow.IsExpanded=!(0,F.yG0)(this.drAccount.IsSummary),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]);for(let e=0;e<this.lstParents.length;e++){let h=this.lstParents[e];if(null!=h&&!h.IsExpanded&&h!=this.oRow)return void this.GrdRow--}}this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow)}}AddReportTotal(e,h){let t=null,i=null;this.IsIncome=e;let a=-1,r=!1;if(r=6==this.ViewModel.StaticReportType?this.NetAtEnd:this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex,this.ReportTotalIndex=e?0:1,this.ReportFormat==R.Vertical){let d;this.GrdRow++,d=h?this.FirstTypeEndIndex+1:this.GrdRow,a=d,t=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.ViewModel.GrpReportTotal.Height>0&&(t.Height=this.ViewModel.GrpReportTotal.Height),t.LevelNo=0;for(let s=0;s<this.CountMonths;s++)this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("VARPER_")||this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("SalesPercentage_")||this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("Perc_")||(t.Cells[this.CellStartPos+this.ColumnSize+s].IsNormal=!1,this.FormatData(t.Cells[this.CellStartPos+this.ColumnSize+s],this.ReportTotalMonthWise[this.ReportTotalIndex][s],this.oColumns[this.ColumnSize+s]));this.GrdRow++,i=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),i.Height=i.Height+2,i.LevelNo=0,this.GrossRows[this.ReportTotalIndex]=i,this.GrossCellIndex=this.CellStartPos}else this.ReportFormat==R.Horizontal&&(h?(this.FirstTypeEndIndex<this.GrdRow?this.FirstTypeEndIndex=this.GrdRow:this.GrdRow=this.FirstTypeEndIndex,this.GrdRow+=2,this.CellStartPos=0,a=this.FirstTypeEndIndex+1,i=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),i.Height=i.Height+2,i.LevelNo=0,t=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.ViewModel.GrpReportTotal.Height>0&&(t.Height=this.ViewModel.GrpReportTotal.Height),t.LevelNo=0):(this.CellStartPos+=this.ColumnSize,r?(i=this.TempData[this.GrdRow],t=this.TempData[this.GrdRow-1]):(i=this.TempData[this.GrdRow-1],t=this.TempData[this.GrdRow])),this.GrossRows[this.ReportTotalIndex]=i);if(!h){let s,d="";if(1==this.ShowGrossInIncome){if(s=this.GrossRows[0],this.ReportFormat==R.Horizontal&&(this.GrossCellIndex=this.ShowIncomeFirst?0:this.ColumnSize),this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex){let u=this.TempData.indexOf(this.GrossRows[0]);this.TempData.indexOf(this.GrossRows[1]),s=-1==u?this.GrossRows[0]:this.GrossRows[1]}r&&(s=i),this.dbl>=0?(d=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetLossAfter":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex+1])):(d=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetProfitAfter":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex]),s.Cells[this.GrossCellIndex+this.BalIndex].Text+="Dr",this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex+1])),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",s.Cells[this.BalIndex+this.SalesPercentIndex]))}else{if(s=this.GrossRows[1],this.ReportFormat==R.Horizontal&&(this.GrossCellIndex=this.ShowIncomeFirst?this.ColumnSize:0,this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex&&(this.GrossCellIndex=this.ShowIncomeFirst?0:this.ColumnSize)),this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex){let u=this.TempData.indexOf(this.GrossRows[0]);this.TempData.indexOf(this.GrossRows[1]),s=-1==u?this.GrossRows[0]:this.GrossRows[1]}r&&(s=i),this.dbl>=0?(d=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetProfitAfter":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex+1])):(d=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetLossAfter":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex]),s.Cells[this.GrossCellIndex+this.BalIndex].Text+="Cr",this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",s.Cells[this.GrossCellIndex+this.BalIndex+1])),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",s.Cells[this.BalIndex+this.SalesPercentIndex]))}this.SetPLText(s.Cells[this.GrossCellIndex+this.AccNameIndex],d),this.SetPLTextColor(s.Cells[this.GrossCellIndex+this.BalIndex],d),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.SetPLTextColor(s.Cells[this.GrossCellIndex+this.BalIndex+1],d),this.ShowSalesPercentage&&this.dblTotalSales>0&&this.SetPLTextColor(s.Cells[this.BalIndex+this.SalesPercentIndex],d),this.Show==n.None&&(this.ReportFormat==R.Vertical?s==this.GrossRows[0]?(this.GrossRows[1].Visible=!1,(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(this.GrossRows[0].Visible=!0)):(this.GrossRows[0].Visible=!1,(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(this.GrossRows[1].Visible=!0)):this.ReportFormat==R.Horizontal&&(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(s.Visible=!1))}8!=this.ViewModel.StaticReportType&&r&&!this.ShowCarryForward&&(this.ReportFormat==R.Vertical?this.ShowGrossInIncome&&!e&&1==this.ReportTotalIndex?this.ReportTotal[1]-=this.Olddbl:!this.ShowGrossInIncome&&e&&0==this.ReportTotalIndex&&(this.ReportTotal[0]+=this.Olddbl):this.ShowGrossInIncome||0!=this.ReportTotalIndex?1==this.ReportTotalIndex&&(this.ReportTotal[1]-=this.Olddbl):this.ReportTotal[0]+=this.Olddbl);let l=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==l&&(l=this.k),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[this.ReportTotalIndex]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",t.Cells[this.CellStartPos+this.BalIndex]));if(t.Cells[this.CellStartPos].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance,t.Cells[this.CellStartPos].Text=T.d.GetResource("Reports_ReportTotal"),8==this.ViewModel.StaticReportType&&(this.GrossAtEnd||this.NetAtEnd)){let d;e?(d=T.d.GetResource("Reports_LblIncome"),-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Income1Label")&&(d=this.ViewModel.Preferences.Income1Label):this.ViewModel.Preferences.ContainsKey("Income2Label")&&(d=this.ViewModel.Preferences.Income2Label)):(d=T.d.GetResource("Reports_LblExpneses"),-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Expneses1Label")&&(d=this.ViewModel.Preferences.Expneses1Label):this.ViewModel.Preferences.ContainsKey("Expneses2Label")&&(d=this.ViewModel.Preferences.Expneses2Label)),t.Cells[this.CellStartPos].Text=d+" Total"}if(l>0&&(t.Cells[this.CellStartPos].ColSpan=l),-1!=this.BAL_CLIndex&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_CLIndex],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_CLIndex],this.oColumns[this.BAL_CLIndex]),-1!=this.YTDIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex],this.ReportTotalYTD[this.ReportTotalIndex][0],this.oColumns[this.YTDIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1],this.oColumns[this.YTDIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+1],this.oColumns[this.YTDIndex+1]),this.ShowBudgetVariancePercent)){let d=0;this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]>0&&(d=100*this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex+this.VariancePercentIndex],d,this.oColumns[this.YTDIndex+this.VariancePercentIndex])}if(-1!=this.BAL_LYIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex],this.ReportTotalYTD[this.ReportTotalIndex][1],this.oColumns[this.BAL_LYIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1],this.oColumns[this.BAL_LYIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+1],this.oColumns[this.BAL_LYIndex+1]),this.ShowBudgetVariancePercent)){let d=0;this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]>0&&(d=100*this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex+this.VariancePercentIndex],d,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex])}if(-1!=this.YTD_LYIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex],this.ReportTotalYTD[this.ReportTotalIndex][2],this.oColumns[this.YTD_LYIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1],this.oColumns[this.YTD_LYIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+1],this.oColumns[this.YTD_LYIndex+1]),this.ShowBudgetVariancePercent)){let d=0;this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]>0&&(d=100*this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex+this.VariancePercentIndex],d,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex])}if(-1!=this.BalIndex&&(this.ShowTotalBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1],this.oColumns[this.BalIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+1],this.oColumns[this.BalIndex+1]),this.ShowBudgetVariancePercent)){let d=0;this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]>0&&(d=100*this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],d,this.oColumns[this.BalIndex+this.VariancePercentIndex])}r?-1==a?(a=this.TempData.indexOf(i),this.TempData.RemoveAt(a),this.TempData.InsertAt(i,a),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),a=this.TempData.indexOf(t),this.TempData.RemoveAt(a),this.TempData.InsertAt(t,a)):(this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),this.TempData.InsertAt(t,a),this.TempData.InsertAt(i,a+1)):-1==a?(a=this.TempData.indexOf(i),this.TempData.RemoveAt(a),this.TempData.InsertAt(i,a),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),a=this.TempData.indexOf(t),this.TempData.RemoveAt(a),this.TempData.InsertAt(t,a)):(this.TempData.InsertAt(i,a),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),this.TempData.InsertAt(t,a+1)),h||(this.ShowCorporateLaw&&this.ShowProfitAndLoss(this.BAL_CLIndex),this.Show!=n.None&&this.ShowMonthWiseProfitAndLoss()),t.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=i.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment="Right",h||(this.IgnoreGrossRowsForBS?(a=this.TempData.indexOf(this.GrossRows[0]),-1!=a&&this.TempData.RemoveAt(a),a=this.TempData.indexOf(this.GrossRows[1]),-1!=a&&this.TempData.RemoveAt(a)):(a=this.TempData.indexOf(this.GrossRows[0]),this.TempData.RemoveAt(a),this.TempData.InsertAt(this.GrossRows[0],a),a=this.TempData.indexOf(this.GrossRows[1]),this.TempData.RemoveAt(a),this.TempData.InsertAt(this.GrossRows[1],a)))}ShowProfitAndLoss(e){let t,h=!1,i=0,a=0;i=this.TempData.indexOf(this.GrossRows[0]),a=this.TempData.indexOf(this.GrossRows[1]);let r=this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex;this.dblTemp=this.ReportTotal[0]+this.ReportTotal[1],this.dblTemp=8==this.ViewModel.StaticReportType?this.ReportTotal[0]+this.ReportTotal[1]:this.ReportTotalALL[0][e]+this.ReportTotalALL[1][e],this.dblTemp>=0?(r||(this.TempData[i].Cells[this.CellStartPos+e].Value=this.TempData[a].Cells[this.CellStartPos+e].Value,this.TempData[i].Cells[this.CellStartPos+e].Text=this.TempData[a].Cells[this.CellStartPos+e].Text),h=!0):(r||(this.TempData[a].Cells[this.CellStartPos+e].Value=this.TempData[i].Cells[this.CellStartPos+e].Value,this.TempData[a].Cells[this.CellStartPos+e].Text=this.TempData[i].Cells[this.CellStartPos+e].Text),h=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp);let l=null;r?(t=i>a?this.TempData[i].Cells[this.CellStartPos+e]:this.TempData[a].Cells[this.CellStartPos+e],this.ViewModel.SetCellValue(7!=this.ViewModel.StaticReportType&&h?-this.dblTemp:this.dblTemp,this.oColumns[this.CellStartPos+e].DataFormat,"FLOAT",t)):(h?(t=this.GrossRows[0].Cells[this.CellStartPos+e],l=this.dblTemp>=0?8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod":8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod"):(t=this.GrossRows[1].Cells[this.CellStartPos+e],l=this.dblTemp>=0?8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod":8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod"),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+e].DataFormat,"FLOAT",t)),null!=l&&this.SetPLTextColor(t,l);let d=this.TempData[i],s=this.TempData[a];this.TempData.RemoveAt(i),this.TempData.Insert(i,d),this.TempData.RemoveAt(a),this.TempData.InsertAt(s,a)}ShowMonthWiseProfitAndLoss(){let h,t,i,a,e=!1;i=this.TempData.indexOf(this.GrossRows[0]),a=this.TempData.indexOf(this.GrossRows[1]);let r=!1;r=6==this.ViewModel.StaticReportType?this.NetAtEnd:this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex;for(let s=0;s<this.CountMonths;s++){if(this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("DIFF_")||this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("VARPER_")||this.oColumns[this.CellStartPos+this.ColumnSize+s].ID.startsWith("Perc_")||(7==this.ViewModel.StaticReportType?(this.dblTemp=this.ReportTotalMonthWise[0][s]+this.ReportTotalMonthWise[1][s],this.dblTemp>=0?(this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text,e=!1):(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text,e=!0),this.dblTemp<0&&(this.dblTemp=-this.dblTemp)):null!=this.OldReportTotalMonthWise?(this.dblTemp=this.OldReportTotalMonthWise[0][s]+this.OldReportTotalMonthWise[1][s]+this.ReportTotalMonthWise[0][s]+this.ReportTotalMonthWise[1][s],this.ShowNetProfitBeforeAndAfter?(r||(this.dblTemp>=0?(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text):(this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text)),this.dblTemp=-this.dblTemp,e=!0):(this.dblTemp>=0?(r||(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text),e=!0):(r||(this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text),e=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp))):(this.dblTemp=this.ReportTotalMonthWise[0][s]+this.ReportTotalMonthWise[1][s],this.dblTemp>=0?(r||(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text),e=!0):(r||(this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Value,this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s].Text),e=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp)),0==this.dblTemp))continue;if(r){h=i>a?this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+s]:this.TempData[a].Cells[this.CellStartPos+this.ColumnSize+s],this.ViewModel.SetCellValue(7!=this.ViewModel.StaticReportType&&e?-this.dblTemp:this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+s].DataFormat,"FLOAT",h);continue}let u=null;e?(h=this.GrossRows[0].Cells[this.CellStartPos+this.ColumnSize+s],t=this.GrossRows[0].Cells[this.GrossCellIndex+this.AccNameIndex],this.dblTemp>=0?(u=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+s].DataFormat,"FLOAT",h)):(u=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+s].DataFormat,"FLOAT",h))):(h=this.GrossRows[1].Cells[this.CellStartPos+this.ColumnSize+s],t=this.GrossRows[1].Cells[this.GrossCellIndex+this.AccNameIndex],this.dblTemp>=0?(u=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+s].DataFormat,"FLOAT",h)):(u=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+s].DataFormat,"FLOAT",h))),null!=u&&(this.SetPLText(t,u),this.SetPLTextColor(h,u))}let l=this.TempData[i],d=this.TempData[a];this.TempData.RemoveAt(i),this.TempData.InsertAt(l,i),this.TempData.RemoveAt(a),this.TempData.InsertAt(d,a)}UpdateTreeTotals(e){if(e>this.lstTotal.length)for(let t=0;t<e-this.lstTotal.length;t++)this.lstParents.push(null),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(let i=0;i<this.lstTotal[t].length;i++)this.lstTotal[t-1][i]+=this.lstTotal[t][i];if(0!=this.lstParents.length){if(null==this.lstParents[t]){this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t);continue}if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded){if(this.GroupTotalsSeperate)this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex]);else{if(this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex]),this.ShowBudget&&(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex-1],this.oColumns[this.BalIndex-1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex-1]),-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex-1],this.lstTotal[t][this.YTDIndex-1],this.oColumns[this.YTDIndex-1]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex-1],this.lstTotal[t][this.BAL_LYIndex-1],this.oColumns[this.BAL_LYIndex-1]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex-1],this.lstTotal[t][this.YTD_LYIndex-1],this.oColumns[this.YTD_LYIndex-1])),this.ShowTotalBudget&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex]),this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1]),-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex+1],this.lstTotal[t][this.YTDIndex+1],this.oColumns[this.YTDIndex+1]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex+1],this.lstTotal[t][this.BAL_LYIndex+1],this.oColumns[this.BAL_LYIndex+1]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex+1],this.lstTotal[t][this.YTD_LYIndex+1],this.oColumns[this.YTD_LYIndex+1])),this.ShowBudgetVariancePercent){let i=0;this.lstTotal[t][this.BalIndex-1]>0&&(i=100*this.lstTotal[t][this.BalIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BalIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],i,this.oColumns[this.BalIndex+this.VariancePercentIndex]),-1!=this.YTDIndex&&(i=0,this.lstTotal[t][this.YTDIndex-1]>0&&(i=100*this.lstTotal[t][this.YTDIndex+this.VariancePercentIndex]/this.lstTotal[t][this.YTDIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex+this.VariancePercentIndex],i,this.oColumns[this.YTDIndex+this.VariancePercentIndex])),-1!=this.BAL_LYIndex&&(i=0,this.lstTotal[t][this.BAL_LYIndex-1]>0&&(i=100*this.lstTotal[t][this.BAL_LYIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BAL_LYIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex+this.VariancePercentIndex],i,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex])),-1!=this.YTD_LYIndex&&(i=0,this.lstTotal[t][this.YTD_LYIndex-1]>0&&(i=100*this.lstTotal[t][this.YTD_LYIndex+this.VariancePercentIndex]/this.lstTotal[t][this.YTD_LYIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex+this.VariancePercentIndex],i,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex]))}this.ShowSalesPercentage&&this.dblTotalSales>0&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+this.SalesPercentIndex],this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex])}-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex],this.lstTotal[t][this.YTDIndex],this.oColumns[this.YTDIndex]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex],this.lstTotal[t][this.BAL_LYIndex],this.oColumns[this.BAL_LYIndex]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex],this.lstTotal[t][this.YTD_LYIndex],this.oColumns[this.YTD_LYIndex]);for(let i=0;i<this.CountMonths;i++)this.oColumns[this.ColumnSize+i].ID.startsWith("Perc_")?(this.dbl=0,0!=this.lstTotal[t][this.ColumnSize+i-1]&&0!=this.lstTotal[t][this.ColumnSize+i+1]&&(this.dbl=(this.lstTotal[t][this.ColumnSize+i-1]-this.lstTotal[t][this.ColumnSize+i+1])/this.lstTotal[t][this.ColumnSize+i+1]*100),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.ColumnSize+i],this.dbl,this.oColumns[this.ColumnSize+i])):this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.ColumnSize+i],this.lstTotal[t][this.ColumnSize+i],this.oColumns[this.ColumnSize+i])}if(e<=this.LevelNo){let i=this.TempData.indexOf(this.lstParents[t]);if(i>=0){var h=this.TempData.find(a=>a.Parent==this.TempData[i]);if(this.TempData.RemoveAt(i),!this.IsValueExists(this.lstTotal[t])&&null==h)if(this.ReportFormat==R.Horizontal)if(0==this.CellStartPos)i=-1;else if(this.FirstTypeEndIndex<i)i=-1;else{for(let a=this.CellStartPos;a<this.oRow.Cells.length;a++)this.lstParents[t].Cells[a].Text="",this.lstParents[t].Cells[a].Value="";this.GrdRow--}else i=-1;if(-1!=i){if(this.TempData.InsertAt(this.lstParents[t],i),this.IsValueExists(this.lstTotal[t])&&this.GroupTotalsAtEnd&&(!this.DontShowSummaryGroupTotals||this.lstParents[t].IsExpanded)){if(this.GrdRow++,this.oSubTotal=this.TempData.length<=this.GrdRow?this.NewReportRow():this.TempData[this.GrdRow],this.oSubTotal.Type=w.QS.BalanceBF,this.oSubTotal.Parent=this.lstParents[t].Parent,this.oSubTotal.LevelNo=this.lstParents[t].LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[t].Visible,this.oSubTotal.Cells[this.CellStartPos].Text="",this.cell=this.oSubTotal.Cells[this.CellStartPos+this.AccNameIndex],this.cell.IsNormal=!1,this.cell.level=this.lstParents[t].LevelNo,this.cell.Text=this.lstParents[t].Cells[this.CellStartPos+this.AccNameIndex].Text+" - TOTAL",this.cell.CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.cell.CellAppearance.Alignment=this.oColumns[this.AccNameIndex].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex])):(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex])),this.ShowBudget&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1],this.lstTotal[t][this.BalIndex-1],this.oColumns[this.BalIndex-1])),this.ShowTotalBudget&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex],this.lstTotal[t][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex])),this.ShowBudgetVariance&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex+1])),this.ShowBudgetVariancePercent){let a=0;this.lstTotal[t][this.BalIndex-1]>0&&(a=100*this.lstTotal[t][this.BalIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BalIndex-1]),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],a,this.oColumns[this.BalIndex+this.VariancePercentIndex])}this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex],this.lstTotal[t][this.BalIndex+this.SalesPercentIndex],this.oColumns[this.BalIndex+this.SalesPercentIndex])),-1!=this.YTDIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].CellAppearance.Alignment=this.oColumns[this.YTDIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex],this.lstTotal[t][this.YTDIndex],this.oColumns[this.YTDIndex])),-1!=this.BAL_LYIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].CellAppearance.Alignment=this.oColumns[this.BAL_LYIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex],this.lstTotal[t][this.BAL_LYIndex],this.oColumns[this.BAL_LYIndex])),-1!=this.YTD_LYIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].CellAppearance.Alignment=this.oColumns[this.YTD_LYIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex],this.lstTotal[t][this.YTD_LYIndex],this.oColumns[this.YTD_LYIndex]));for(let a=0;a<this.CountMonths;a++)this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+a].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+a].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+a].CellAppearance.Alignment=this.oColumns[this.ColumnSize+a].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+a],this.lstTotal[t][this.ColumnSize+a],this.oColumns[this.ColumnSize+a]);this.TempData.length<=this.GrdRow?this.TempData.push(this.oSubTotal):(this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.oSubTotal,this.GrdRow))}}else this.GrdRow--}}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}}GetBudgetAmount(e,h=null,t=null){let i=0;if(null!=h){let a,r=h;e.forEach(l=>{for(r=h;r<=t;)a=r.ToString("MMMyyyy"),i+=o.J0.Double(l[a]),r=r.AddMonths(1)})}else e.forEach(a=>{i+=o.J0.Double(a.AnnualAmount)});return i}IsValueExists(e){return!!e.find(h=>0!=h)}LoadPlainReport(){this.STACKROWS.Clear(),this.lstTotal.Clear(),this.AddOpeningStock();for(let e=0;e<this.dv.length;e++)this.drAccount=this.dv[e],this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(this.drAccount.AccountTypeID)),this.ReportTotalIndex=this.IsIncome?0:1,(0,F.yG0)(this.drAccount.IsGroup)?(this.dbl=0,this.AddRow_Plain()):(this.dbl=o.J0.Double(this.drAccount.Balance),(Math.abs(this.dbl)>.01||this.ShowAllAccounts)&&this.AddRow_Plain());this.AddClosingStock(),this.UpdateTreeTotals_Plain(999999999999,0),this.AddOpenBalanceDifference(),this.AddOpenBalanceDifferenceForBS(),7==this.ViewModel.StaticReportType?(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=!(this.dbl>=0),Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?this.ReportTotal[1]=this.ReportTotal[1]-this.dbl:this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.dbl<0&&(this.dbl=-this.dbl)):(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ReportTotal[0]=-this.ReportTotal[0],this.ReportTotal[0]>this.ReportTotal[1]?this.ReportTotal[1]=this.ReportTotal[0]>0?this.ReportTotal[0]:this.ReportTotal[0]=0:this.ReportTotal[0]=this.ReportTotal[1]>0?this.ReportTotal[1]:this.ReportTotal[1]=0,this.ShowGrossInIncome=!(Math.abs(this.ReportTotal[0])>=Math.abs(this.ReportTotal[1])&&this.dbl<0),this.dbl<0&&(this.dbl=-this.dbl)),this.AddReportTotal_Plain()}AddRow_Plain(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.IsGroup=(0,F.yG0)(this.drAccount.IsGroup),this.oRow.NodeID=o.J0.Int(this.drAccount.AccountID),this.oRow.LevelNo=o.J0.Int(this.drAccount.Depth)-1,this.oRow.DataRow=this.drAccount,this.IsAccountWise||(this.oRow.Cells[this.CellStartPos+this.BalIndex-1].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex-1].level=this.oRow.LevelNo,this.UpdateTreeTotals_Plain(o.J0.Int(this.drAccount.lft),this.oRow.LevelNo)),(0,F.yG0)(this.drAccount.IsGroup)){this.oRow.Type=w.QS.BalanceBF;for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment}if(this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsAddRow=1),(0,F.yG0)(this.drAccount.IsGroup)){let e=new $;e.Row=this.oRow,e.Lft=o.J0.Int(this.drAccount.lft),e.Rgt=o.J0.Int(this.drAccount.rgt),this.STACKROWS.push(e),this.lstTotal.push(new Array(this.oColumns.length+1).fill(0))}else this.ReportTotal[this.ReportTotalIndex]+=this.dbl;this.TextFields.keys.forEach(e=>{let h_Value=this.TextFields[e];this.oRow.Cells[this.CellStartPos+h_Value].Text=this.drAccount[e].toString(),this.oRow.Cells[this.CellStartPos+h_Value].Value=this.oRow.Cells[this.CellStartPos+h_Value].Text}),this.oRow.IsGroup||(this.FormatData(this.ClubIncomeExpenseInPlainReport?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.IsIncome&&!this.ShowIncomeFirst||!this.IsIncome&&this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex],this.dbl,this.oColumns[this.BalIndex]),this.ViewModel.ApplyKPI(this.oRow)),this.lstTotal.length>0&&(this.IsIncome?this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl:this.lstTotal[this.lstTotal.length-1][this.BalIndex+1]+=this.dbl),1==this.IsAddRow&&(this.ShowdetailsofControlGroups||(this.oRow.IsExpanded=!(0,F.yG0)(this.drAccount.IsSummary),(0,F.yG0)(this.drAccount.IsSummary)&&(this.oRow.Type=w.QS.Detail),this.oRow.IsGroup?this.STACKROWS.length>1&&(this.oRow.Parent=this.STACKROWS[this.STACKROWS.length-2].Row):this.STACKROWS.length>0&&(this.oRow.Parent=this.STACKROWS[this.STACKROWS.length-1].Row),null!=this.oRow.Parent&&(!this.oRow.Parent.IsExpanded||!this.oRow.Parent.Visible)&&(this.oRow.Visible=!1)),this.TempData.push(this.oRow))}UpdateTreeTotals_Plain(e,h){for(let t=this.lstTotal.length-1;t>=0&&e>this.STACKROWS[t].Rgt;t--){if(t>0)for(let i=0;i<this.lstTotal[t].length;i++)this.lstTotal[t-1][i]+=this.lstTotal[t][i];if(h<=this.LevelNo){let i=this.TempData.indexOf(this.STACKROWS[t].Row);if(i>=0)if(0==this.lstTotal[t][this.BalIndex]&&0==this.lstTotal[t][this.BalIndex+1])this.TempData.RemoveAt(i);else{if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.STACKROWS[t].Row.IsExpanded?this.oTempRow=this.STACKROWS[t].Row:(this.oSubTotal=this.NewReportRow(),this.oTempRow=this.oSubTotal,this.oSubTotal.Type=w.QS.BalanceBF,this.oSubTotal.Parent=this.STACKROWS[t].Row.Parent,this.oSubTotal.LevelNo=this.STACKROWS[t].Row.LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.STACKROWS[t].Row.Visible,this.cell=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1],this.cell.IsNormal=!1,this.cell.level=this.STACKROWS[t].Row.LevelNo,this.cell.Text=this.STACKROWS[t].Row.Cells[this.BalIndex-1].Text+" - TOTAL",this.cell.CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.cell.CellAppearance.Alignment=this.oColumns[this.BalIndex-1].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.GroupTotalIndex].IsNormal=!1,this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment):(this.oSubTotal.Cells[this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ClubIncomeExpenseInPlainReport||(this.oSubTotal.Cells[this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex+1].DataAppearance.Alignment))),this.GroupTotalsSeperate)7!=this.ViewModel.StaticReportType?(this.dblTemp=-(this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1]),this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.GroupTotalIndex])):(this.dblTemp=this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1],this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.GroupTotalIndex]));else if(this.ClubIncomeExpenseInPlainReport)7!=this.ViewModel.StaticReportType?(this.dblTemp=-(this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1]),this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.CellStartPos+this.BalIndex])):(this.dblTemp=this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1],this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.CellStartPos+this.BalIndex]));else{let a,r;this.ShowIncomeFirst?(a=this.oTempRow.Cells[this.CellStartPos+this.BalIndex],r=this.oTempRow.Cells[this.CellStartPos+this.BalIndex+1]):(a=this.oTempRow.Cells[this.CellStartPos+this.BalIndex+1],r=this.oTempRow.Cells[this.CellStartPos+this.BalIndex]),7!=this.ViewModel.StaticReportType?(this.lstTotal[t][this.BalIndex]<=0?this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",a):(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",a),a.Text+="Dr"),this.lstTotal[t][this.BalIndex+1]>=0?this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",r):(this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",r),r.Text+="Cr")):(this.lstTotal[t][this.BalIndex]>=0?this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",a):(this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",a),a.Text+="Cr"),this.lstTotal[t][this.BalIndex+1]<=0?this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",r):(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",r),r.Text+="Dr"))}!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.STACKROWS[t].Row.IsExpanded?(this.TempData.RemoveAt(i),this.TempData.InsertAt(this.STACKROWS[t].Row,i)):(this.GrdRow++,this.TempData.push(this.oSubTotal))}}this.STACKROWS.RemoveAt(t),this.lstTotal.RemoveAt(t)}}AddReportTotal_Plain(){let e=null,h=null;if(this.GrdRow++,h=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),h.LevelNo=0,this.GrdRow++,e=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(e.Height=this.ViewModel.GrpReportTotal.Height),e.Cells[this.CellStartPos].Text=T.d.GetResource("Reports_ReportTotal"),e.LevelNo=0,this.GrossCellIndex=this.CellStartPos+this.BalIndex,h.Cells[this.CellStartPos+this.BalIndex-1].CellAppearance=this.GrossTotalAppearance,1==this.ShowGrossInIncome?(!this.ClubIncomeExpenseInPlainReport&&!this.ShowIncomeFirst&&this.GrossCellIndex++,this.dbl>=0?this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",h.Cells[this.GrossCellIndex]):(this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",h.Cells[this.GrossCellIndex]),h.Cells[this.GrossCellIndex].Text+="Dr"),this.SetPLText(h.Cells[this.CellStartPos+this.BalIndex-1],"Reports_LblNetLossForPeriod"),this.SetPLTextColor(h.Cells[this.GrossCellIndex],"Reports_LblNetLossForPeriod")):(!this.ClubIncomeExpenseInPlainReport&&this.ShowIncomeFirst&&this.GrossCellIndex++,this.dbl>=0?this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",h.Cells[this.GrossCellIndex]):(this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",h.Cells[this.GrossCellIndex]),h.Cells[this.GrossCellIndex].Text+="Cr"),this.SetPLText(h.Cells[this.CellStartPos+this.BalIndex-1],"Reports_LblNetProfitForPeriod"),this.SetPLTextColor(h.Cells[this.GrossCellIndex],"Reports_LblNetProfitForPeriod")),this.ClubIncomeExpenseInPlainReport)this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[0])-Math.abs(this.ReportTotal[1]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",e.Cells[this.CellStartPos+this.BalIndex]),e.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment="Right";else{let t=e.Cells[this.CellStartPos+this.BalIndex],i=e.Cells[this.CellStartPos+this.BalIndex+1];this.ShowIncomeFirst||(t=e.Cells[this.CellStartPos+this.BalIndex+1],i=e.Cells[this.CellStartPos+this.BalIndex]),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[0]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",t),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[1]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",i),t.CellAppearance.Alignment=i.CellAppearance.Alignment="Right"}e.Cells[this.CellStartPos].ColSpan=this.CellStartPos+this.BalIndex,this.IgnoreGrossRowsForBS||(0==this.RetainedEarningAccount||Math.abs(this.dbl)>.01)&&this.TempData.push(h),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible&&this.TempData.push(e)}AddNetProfitBeforeOtherIncome(){if(-1!=this.ReportRowStartIndex&&this.ShowNetProfitBeforeAndAfter&&(this.oRow=null,this.ReportFormat==R.Vertical?this.IsFirstCall&&(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.TempData.push(this.oRow)):this.ReportFormat==R.Horizontal&&(this.IsFirstCall&&(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.TempData.InsertAt(this.oRow,this.GrdRow)),this.IsIncome&&(this.oRow=null)),null!=this.oRow)){let e=this.Olddbl-this.ReportTotal[1];this.ShowGrossInIncome&&!this.IsIncome&&(e=-this.ReportTotal[1]),e>0?(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblNetProfitBefore").toUpperCase(),this.ViewModel.Preferences.ContainsKey("Reports_LblNetProfitForPeriodClr")&&(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr)):(e=-e,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblNetLossBefore").toUpperCase(),this.ViewModel.Preferences.ContainsKey("Reports_LblNetLossForPeriodClr")&&(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr)),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.Alignment="Left",this.ViewModel.SetCellValue(e,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*e/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.SalesPercentIndex]));for(let h=0;h<this.CountMonths;h++)this.dblTemp=this.OldReportTotalMonthWise[0][h]+this.OldReportTotalMonthWise[1][h]+(this.ReportTotalMonthWise[0][h]+this.ReportTotalMonthWise[1][h]),e>0&&(this.dblTemp=-this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+h].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+h]);this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.oRow,this.GrdRow)}}AddRow_BF(){this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.ReportFormat==R.Vertical?this.ShowGrossInIncome&&!this.IsIncome?(this.ReportTotal[1]=this.Olddbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[1][this.BalIndex+1]=-this.Olddbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]=-this.Olddbl)),this.ShowCarryForward&&(this.GrdRow++,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.ReportTotalALL[1][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.TempData.push(this.oRow))):!this.ShowGrossInIncome&&this.IsIncome&&(this.ReportTotal[0]=-this.Olddbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[0][this.BalIndex+1]=this.Olddbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]=this.Olddbl)),this.ShowCarryForward&&(this.GrdRow++,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.ReportTotalALL[0][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.TempData.push(this.oRow))):(this.ShowCarryForward&&this.GrdRow++,this.IsFirstCall&&(this.ShowCarryForward&&(this.ShowIncomeFirst&&!this.ShowGrossInIncome||!this.ShowIncomeFirst&&this.ShowGrossInIncome?(this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow.Cells[this.ColumnSize+this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.ColumnSize+this.BalIndex]),this.TempData.push(this.oRow))),this.ShowGrossInIncome?this.ReportTotal[1]=this.Olddbl:this.ReportTotal[0]=-this.Olddbl))}AddOpeningStock(){if(!this.IncludeOpeningStock&&0==this.ClosingStockAccount)return;let e;if(0!=this.ClosingStockAccount?(this.dblOpeningStock=0,e=this.dsNew.Tables[0].filter(h=>h.AccountID==this.ClosingStockAccount),e.forEach(h=>{this.dblOpeningStock+=o.J0.Double(h.Balance)})):e=[],this.ReportFormat==R.Plain){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let h=0;h<this.dsOpenStock.Tables[1].length;h++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][h].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][h].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==R.Vertical){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),null!=this.dsOpeningStock){let h;for(let t=0;t<this.CountMonths;t++)if(o.J0.IsNum(this.oColumns[this.CellStartPos+this.ColumnSize+t].ID)){h=o.J0.Int(this.oColumns[this.CellStartPos+this.ColumnSize+t].ID),this.dblTemp=0;let i=[];this.dsOpeningStock.Tables.length>0&&(i=this.dsOpeningStock.Tables[0].filter(a=>a.TagID==h)),i.length>0&&(this.dblTemp=o.J0.Double(i[0].BalValue)),this.ReportTotalMonthWise[1][t]=this.IsIncomeNegative?this.dblTemp:-this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+t].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+t])}}if(this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let h=0;h<this.dsOpenStock.Tables[1].length;h++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][h].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][h].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==R.Horizontal)if(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex){if(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let h=0;h<this.dsOpenStock.Tables[1].length;h++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][h].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][h].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let h=0;h<this.dsOpenStock.Tables[1].length;h++)this.GrdRow++,this.GrdRow>this.FirstTypeEndIndex?(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][h].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][h].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][h].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][h].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.Insert(this.GrdRow,this.oRow));this.ReportTotal[1]=this.IsIncomeNegative?this.dblOpeningStock:-this.dblOpeningStock}AddClosingStock(){if(this.IncludeClosingStock){if(this.ReportFormat==R.Plain){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.oRow.Cells[this.CellStartPos+this.BalIndex+1]),this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.oRow.Cells[this.CellStartPos+this.BalIndex+1]),this.TempData.push(this.oRow)}else if(this.ReportFormat==R.Vertical){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),null!=this.dsClosingStock){let e;for(let h=0;h<this.CountMonths;h++)if(o.J0.IsNum(this.oColumns[this.CellStartPos+this.ColumnSize+h].ID)){e=o.J0.Int(this.oColumns[this.CellStartPos+this.ColumnSize+h].ID),this.dblTemp=0;let t=[];this.dsClosingStock.Tables.length>0&&(t=this.dsClosingStock.Tables[0].filter(i=>i.TagID==e)),t.length>0&&(this.dblTemp=o.J0.Double(t[0].BalValue)),this.ReportTotalMonthWise[0][h]=this.IsIncomeNegative?this.ReportTotalMonthWise[0][h]-this.dblTemp:this.ReportTotalMonthWise[0][h]+this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+h].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+h])}}if(this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==R.Horizontal)if(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex){if(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.GrdRow>this.FirstTypeEndIndex?(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.dbl=this.dsCloseStock.Tables[1][e].Balance.toString(),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.Insert(this.GrdRow,this.oRow));this.ReportTotal[0]=this.IsIncomeNegative?this.ReportTotal[0]-this.dblClosingStock:this.ReportTotal[0]+this.dblClosingStock}}AddGroup(e){this.ReportFormat==R.Vertical?(this.GrdRow++,this.row=this.NewReportRow_2(w.QS.Header,this.IncomeExpenseHeader),this.row.Height=this.row.Height+3,this.row.LevelNo=0):this.ReportFormat==R.Horizontal&&(this.GrdRow++,this.IsFirstCall?(this.row=this.NewReportRow_2(w.QS.Header,this.IncomeExpenseHeader),this.row.Height=this.row.Height+2,this.row.LevelNo=0):this.row=this.TempData[this.GrdRow]),this.row.Cells[this.CellStartPos].Text=e,null!=this.row.Cells[this.CellStartPos].CellAppearance&&(this.row.Cells[this.CellStartPos].CellAppearance.Alignment="Center"),this.row.Cells[this.CellStartPos].ColSpan=this.ColumnSize,o.J0.IsEmpty(e)&&(this.row.Visible=!1),-1==this.TempData.indexOf(this.row)?this.TempData.push(this.row):(this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.row,this.GrdRow))}FormatData(e,h,t){if(4==this.NegNumber)this.IsIncomeNegative&&this.IsIncome||!this.IsIncomeNegative&&!this.IsIncome?h<=0&&!t.ID.startsWith("Perc_")?this.ViewModel.SetCellValue(-h,t.DataFormat,"FLOAT",e):(this.ViewModel.SetCellValue(h,t.DataFormat,"FLOAT",e),t.DataFormat.NumberFormat.length>0&&(e.Text+=" "),!t.ID.startsWith("Budget")&&!t.ID.startsWith("Perc_")&&(e.Text+="Dr")):h>=0?this.ViewModel.SetCellValue(h,t.DataFormat,"FLOAT",e):(this.ViewModel.SetCellValue(-h,t.DataFormat,"FLOAT",e),t.DataFormat.NumberFormat.length>0&&(e.Text+=" "),!t.ID.startsWith("Budget")&&!t.ID.startsWith("Perc_")&&(e.Text+="Cr"));else{let a="",r="";if(this.IsIncomeNegative&&this.IsIncome||!this.IsIncomeNegative&&!this.IsIncome){if(h<=0)this.SetCellValue(-h,t.DataFormat,a,r,e);else if(0==t.DataFormat.NegativeNumber?a="-":r="Dr",this.SetCellValue(h,t.DataFormat,a,r,e),0==t.DataFormat.NegativeNumber&&(e.Value=-h),9==this.ViewModel.ReportID&&parseFloat(e.Value)<0){let l=parseFloat(e.Value);if(null!=(i=this.ViewModel.ColumnSource.find(d=>d.ID==t.ID))){let d="",s="";switch(s=i.DataFormat.DecimalsPoints>0?"N"+i.DataFormat.DecimalsPoints.toString():"N0",i.DataFormat.NegativeNumber){case 1:e.IsNegativeRed=!0,d=l.Commas(s,i.DataFormat.Commas).Replace("-","");break;case 2:d="("+l.Commas(s,i.DataFormat.Commas).Replace("-","")+")";break;case 3:e.IsNegativeRed=!0,d="("+l.Commas(s,i.DataFormat.Commas).Replace("-","")+")";break;case 4:case 7:d=(-l).Commas(s,i.DataFormat.Commas)+"Cr";break;case 5:d=(-l).Commas(s,i.DataFormat.Commas)+"Dr";break;case 8:d="+"+(-l).Commas(s,i.DataFormat.Commas);break;case 12:d=(-l).Commas(s,i.DataFormat.Commas)}o.J0.IsEmpty(d)&&(d=l.Commas(s,i.DataFormat.Commas)),e.Text=d}}}else if(h>=0)this.SetCellValue(h,t.DataFormat,a,r,e);else if(0==t.DataFormat.NegativeNumber?a="-":r="Cr",this.SetCellValue(-h,t.DataFormat,a,r,e),0==t.DataFormat.NegativeNumber&&(e.Value=h),9==this.ViewModel.ReportID&&parseFloat(e.Value)<0){let l=parseFloat(e.Value);var i;if(null!=(i=this.ViewModel.ColumnSource.find(s=>s.ID==t.ID))){let s="",u="";switch(u=i.DataFormat.DecimalsPoints>0?"N"+i.DataFormat.DecimalsPoints.toString():"N0",i.DataFormat.NegativeNumber){case 1:e.IsNegativeRed=!0,s=l.Commas(u,i.DataFormat.Commas).Replace("-","");break;case 2:s="("+l.Commas(u,i.DataFormat.Commas).Replace("-","")+")";break;case 3:e.IsNegativeRed=!0,s="("+l.Commas(u,i.DataFormat.Commas).Replace("-","")+")";break;case 4:case 7:s=(-l).Commas(u,i.DataFormat.Commas)+"Cr";break;case 5:s=(-l).Commas(u,i.DataFormat.Commas)+"Dr";break;case 8:s="+"+(-l).Commas(u,i.DataFormat.Commas);break;case 12:s=(-l).Commas(u,i.DataFormat.Commas)}o.J0.IsEmpty(s)&&(s=l.Commas(u,i.DataFormat.Commas)),e.Text=s}}}}SetCellValue(e,h,t,i,a){a.IsNegativeRed=!1;let l,r="";if(r=h.DecimalsPoints>0?"N"+h.DecimalsPoints.toString():"N0",h.RoundOff>0){let d=e%h.RoundOff;d<h.RoundOff/2?e-=d:e=e+h.RoundOff-d}a.Value=e,l=h.NumberFormat.length>0?Z.ReportViewModel.NumbetFormatted(e,h):e.Commas(r,h.Commas),t.length>0&&(l=t+l),i.length>0&&(l+=i),o.J0.IsEmpty(h.PercentageOn)||(l+="%"),a.Text=l}AddOpenBalanceDifference(){}AddOpenBalanceDifferenceForBS(){if(7==this.ViewModel.StaticReportType&&(this.dblTemp=this.dblOpeningBalanceDifference,o.J0.Double(Math.abs(this.dblTemp).ToString("N1"))>.1))if(this.row=this.NewReportRow_2(w.QS.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.ReportFormat==R.Plain)this.row.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference"),this.dblTemp>0?(this.ReportTotalIndex=this.ShowIncomeFirst?0:1,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[0]+=this.dblTemp):(this.ReportTotalIndex=this.ShowIncomeFirst?1:0,this.ViewModel.SetCellValue(-this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[1]+=this.dblTemp),this.GrdRow++,this.TempData.push(this.row);else if(this.ReportFormat==R.Horizontal)this.dblTemp>0?(this.ReportTotalIndex=this.ShowIncomeFirst?0:this.ColumnSize,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[0]+=this.dblTemp):(this.ReportTotalIndex=this.ShowIncomeFirst?this.ColumnSize:0,this.ViewModel.SetCellValue(-this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[1]+=this.dblTemp),this.row.Cells[this.ReportTotalIndex+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.ReportTotalIndex+this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference"),this.FirstTypeEndIndex<this.GrdRow?this.GrdRow++:this.FirstTypeEndIndex++,this.TempData.push(this.row);else if(this.ReportFormat==R.Vertical){this.GrdRow++,this.row.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference");let e=0;if(this.dblTemp<0&&(e=1),this.ViewModel.SetCellValue(Math.abs(this.dblTemp),this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex]),this.ReportTotal[e]+=this.dblTemp,this.Show==n.TagWise)for(let h=0;h<this.CountMonths;h++)this.lstTagsOpeningBalance.ContainsKey(this.oColumns[this.CellStartPos+this.ColumnSize+h].ID)&&(this.dblTemp=this.lstTagsOpeningBalance[this.oColumns[this.CellStartPos+this.ColumnSize+h].ID],e=0,this.dblTemp<0&&(e=1),this.ReportTotalMonthWise[e][h]+=this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+h].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.ColumnSize+h]));else if(this.Show!=n.TagWise)for(let h=0;h<this.CountMonths;h++)this.ReportTotalMonthWise[e][h]+=this.dblTemp,this.ViewModel.SetCellValue(Math.abs(this.dblTemp),this.oColumns[this.CellStartPos+this.ColumnSize+h].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.ColumnSize+h]);this.dblTemp>0?this.ShowIncomeFirst?(this.FirstTypeEndIndex++,this.TempData.InsertAt(this.row,this.FirstTypeEndIndex)):this.TempData.push(this.row):this.ShowIncomeFirst?this.TempData.push(this.row):(this.FirstTypeEndIndex++,this.TempData.InsertAt(this.row,this.FirstTypeEndIndex))}}UpdateDataTableWithGroups(){}SetStockBalance(e){let h,t="";this.lstTagColumns.forEach(l=>{t.length>0&&(t+=","),t+=l});let i=[];i.push(e?1:0),i.push(""),i.push(this.TagID),i.push(" inner join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID");let a="";var r=this.ViewModel.oReportDialog.CostCenterFilters.find(l=>l.CostCenterID==this.TagID);if(null!=r){let l="";r.SelectedNodes.forEach(d=>{l+=d.Id+","}),l.length>0&&(l=l.Remove(l.length-1,1),a+=" AND DCC.DCCCNID"+(r.CostCenterID-5e4)+" IN ("+l+")")}if(a+=this.LocationWhere,i.push(a),i.push(this.ViewModel.oReportDialog.FromDate.Date),i.push(this.ViewModel.oReportDialog.ToDate.Date),i.push(this.UnPostedDocsInclude),i.push(T.d.SessionManager.UserName),h=T.d.report.SetAvgRateTempTable(i,this.ViewModel.IsReportDB),0!=h.length)try{let l=o.J0.Int(T.d.SessionManager.Preferences["Maintain Dimensionwise stock"]);if(i=[],i.push(h),i.push(this.TagID),i.push(t),i.push(l),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?o.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?i.push(-1):"True"==T.d.SessionManager.Preferences.EnableLocationWise&&this.ViewModel.ShowLocationFilter&&this.ViewModel.oReportDialog.Locations.Items.length>0&&"all"==this.ViewModel.oReportDialog.Locations.Items[0].Value.toLowerCase()&&(0,F.yG0)(this.ViewModel.oReportDialog.Locations.Items[0].IsChecked)?i.push(null):i.push(this.ViewModel.oReportDialog.LocationWhere):i.push(null),i.push(this.ViewModel.oReportDialog.ToDate.Date),i.push(0),i.push(T.d.SessionManager.LanguageID),e){if(this.dsOpeningStock=T.d.report.GetStockBalancesTagWise(i,this.ViewModel.IsReportDB),this.dsOpeningStock.Tables[0].length>0){let d=this.dsOpeningStock.Tables[0].Compute("sum","BalValue");null!=d&&(this.dblOpeningStock=o.J0.Double(d))}}else if(this.dsClosingStock=T.d.report.GetStockBalancesTagWise(i,this.ViewModel.IsReportDB),this.dsClosingStock.Tables[0].length>0){let d=this.dsClosingStock.Tables[0].Compute("sum","BalValue");null!=d&&(this.dblClosingStock=o.J0.Double(d))}}catch{}finally{h.length>0&&T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C\n                IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].["+h+"]') AND type in (N'U'))\nDROP TABLE "+h+"\nDELETE FROM RPT_TempTables WHERE TempTableName='"+h+"'")}else this.ViewModel.DisplayMessage="Setting Temporary Table Error."}SetPLText(e,h){this.SetPLTextColor(e,h),h=this.ViewModel.Preferences.ContainsKey(h)?this.ViewModel.Preferences[h]:T.d.GetResource(h).toUpperCase(),e.Text=h}SetPLTextColor(e,h){this.ViewModel.Preferences.ContainsKey(h+"Clr")?e.CellAppearance.ForeColor=this.ViewModel.Preferences[h+"Clr"]:"Reports_LblNetLossAfter"==h&&this.ViewModel.Preferences.ContainsKey("Reports_LblNetLossForPeriodClr")?e.CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr:"Reports_LblNetProfitAfter"==h&&this.ViewModel.Preferences.ContainsKey("Reports_LblNetProfitForPeriodClr")&&(e.CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr)}RenderColums(e,h,t,i,a,r,l,d){let s,u=this.dtYearStartMonth;s=e==n.YearWise?u:e==n.DayWise?this.ViewModel.oReportDialog.FromDate.Date:new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);let f=0,I=1,g=1,N=e==n.HalfYearWise?6:3,P="",W=!0,S=h[h.length-1];for(-1!=this.BalIndex&&(S=h[this.BalIndex]);s<=this.ViewModel.oReportDialog.ToDate.Date;){let m=S.Clone();if(this.SubShowPerc&&!o.J0.IsEmpty(l)&&(f>0&&(e==n.DayWise?(m.HeaderText=l+"\r\n"+u.AddDays(-1).ToString("dd MMM yy")+"-"+s.ToString("dd MMM yy"),m.ID=7==this.ViewModel.StaticReportType?"Perc_"+d+"Y"+s.getFullYear()+"M"+s.iMonth().ToString("00")+"D"+s.getDate():"Perc_"+d+"Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate()):e==n.MonthWise?(m.HeaderText=l+"\r\n"+u.AddMonths(-1).ToString("MMM yy")+"-"+u.ToString("MMM yy"),m.ID=7==this.ViewModel.StaticReportType?"Perc_"+d+"Y"+s.getFullYear()+"M"+s.iMonth().ToString("00"):"Perc_"+d+"Y"+s.getFullYear()+"M"+s.iMonth()):e==n.QtrWise||e==n.HalfYearWise?(g=I,g++,(e==n.QtrWise&&5==g||e==n.HalfYearWise&&3==g)&&(g=1),P=1==this.AccountingFromMonth?s.getFullYear().toString():s.iMonth()>=this.AccountingFromMonth?s.getFullYear().toString()+"-"+((s.getFullYear()+1)%100).toString():(s.getFullYear()-1).toString()+"-"+(s.getFullYear()%100).toString(),m.HeaderText=l+"\r\n"+(e==n.HalfYearWise?"H":"Q")+g+" "+P,m.ID="Perc_"+d+"Y"+s.getFullYear()+"M"+s.iMonth()):(m.HeaderText=l+"\r\n"+u.AddYears(-1).getFullYear().toString()+"-"+u.getFullYear().toString(),m.ID="Perc_"+d+"Y"+s.getFullYear()),m.HeaderText=m.HeaderText+" %",m.DataFormat.PercentageOn="-",m.DataFormat.ShowDefaultSign=0,m.DataFormat.NegativeNumber=1,h.push(m),++this.CountMonths),f++),m=S.Clone(),e==n.DayWise)m.HeaderText=m.HeaderText+"-"+(o.J0.IsEmpty(l)?"":l+"\r\n")+s.ToString("dd MMM yy"),m.ID=7==this.ViewModel.StaticReportType?d+"Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2)+"D"+s.getDate():d+"Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate(),this.YearSlots.push(m.ID,s);else if(e==n.MonthWise)m.HeaderText=m.HeaderText+"-"+(o.J0.IsEmpty(l)?"":l+"\r\n")+s.ToString("MMM yy"),m.ID=7==this.ViewModel.StaticReportType?d+"Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2):d+"Y"+s.getFullYear()+"M"+s.iMonth(),this.YearSlots.push(m.ID,s);else if(e==n.QtrWise||e==n.HalfYearWise){if(W){for(s=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.AccountingFromMonth-1,1),s>this.ViewModel.FromDatePicker.Date&&(s=s.AddYears(-1)),I=1;s.AddMonths(N)<=this.ViewModel.FromDatePicker.Date;)I++,s=s.AddMonths(N);P=1==this.AccountingFromMonth?s.getFullYear().toString():s.iMonth()>=this.AccountingFromMonth?s.getFullYear().toString()+"-"+((s.getFullYear()+1)%100).toString():(s.getFullYear()-1).toString()+"-"+(s.getFullYear()%100).toString()}else I++,(e==n.QtrWise&&5==I||e==n.HalfYearWise&&3==I)&&(I=1),P=1==this.AccountingFromMonth?s.getFullYear().toString():s.iMonth()>=this.AccountingFromMonth?s.getFullYear().toString()+"-"+((s.getFullYear()+1)%100).toString():(s.getFullYear()-1).toString()+"-"+(s.getFullYear()%100).toString();m.HeaderText=m.HeaderText+"-"+(o.J0.IsEmpty(l)?"":l+"\r\n")+(e==n.HalfYearWise?"H":"Q")+I+" "+P,m.ID=d+"Y"+s.getFullYear()+"M"+s.iMonth(),this.YearSlots.push(m.ID,s),W=!1;let p=new j;p.dtStart=s,p.dtEnd=s.AddMonths(N).AddDays(-1),this.QtrSlot.push(m.ID,p)}else m.HeaderText=1!=u.iMonth()?m.HeaderText+"-"+(o.J0.IsEmpty(l)?"":l+"\r\n")+u.getFullYear().toString()+"-"+(u.getFullYear()+1).toString():m.HeaderText+"-"+(o.J0.IsEmpty(l)?"":l+"\r\n")+u.getFullYear().toString(),m.ID=d+"Y"+s.getFullYear(),this.YearSlots.push(m.ID,u),u=u.AddYears(1);if(this.lstTags.push(m.ID),h.push(m),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let p=null!=a?a.Clone():m.Clone();p.HeaderText=(null!=a?p.HeaderText:"Budget")+"-"+m.HeaderText,p.ID=e==n.DayWise?"Budget"+s.ToString("ddMMMyyyy"):e==n.MonthWise?"Budget"+s.ToString("MMMyyyy"):e==n.QtrWise||e==n.HalfYearWise?"Budget"+m.ID:"Budget"+s.ToString("yyyy"),p.DataFormat.NegativeNumber=0,h.Insert(h.length-1,p),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let p=null!=t?t.Clone():m.Clone();p.HeaderText=(null!=t?p.HeaderText:"Variance")+"-"+m.HeaderText,p.ID=e==n.DayWise?"Variance"+s.ToString("ddMMMyyyy"):e==n.MonthWise?"Variance"+s.ToString("MMMyyyy"):e==n.QtrWise||e==n.HalfYearWise?"Variance"+m.ID:"Variance"+s.ToString("yyyy"),p.DataFormat.NegativeNumber=0,h.push(p),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let p=null!=i?i.Clone():m.Clone();p.HeaderText=(null!=i?p.HeaderText:"Variance %")+"-"+m.HeaderText,p.ID=e==n.DayWise?"PercentVariance"+s.ToString("ddMMMyyyy"):e==n.MonthWise?"PercentVariance"+s.ToString("MMMyyyy"):e==n.QtrWise||e==n.HalfYearWise?"PercentVariance"+m.ID:"PercentVariance"+s.ToString("yyyy"),p.DataFormat.NegativeNumber=0,h.push(p),++this.CountMonths}if(this.ShowPrevMonthData||this.ShowPrevMonthDiffData||this.ShowPrevMonthVarPer){let p=m.Clone(),V=new Date(s.AddYears(-1));if(e==n.DayWise)p.HeaderText=V.ToString("MMM yy"),p.ID=7==this.ViewModel.StaticReportType?"Y"+V.getFullYear()+"M"+V.iMonth().PrefixZero(2)+"D"+V.getDate():"Y"+V.getFullYear()+"M"+V.iMonth()+"D"+V.getDate();else if(e==n.MonthWise)p.HeaderText=V.ToString("MMM yy"),p.ID=7==this.ViewModel.StaticReportType?"Y"+V.getFullYear()+"M"+V.iMonth().PrefixZero(2):"Y"+V.getFullYear()+"M"+V.iMonth();else if(e==n.QtrWise||e==n.HalfYearWise){let Y=s.AddYears(-1);P=1==this.AccountingFromMonth?Y.getFullYear().toString():Y.iMonth()>=this.AccountingFromMonth?Y.getFullYear().toString()+"-"+((Y.getFullYear()+1)%100).toString():(Y.getFullYear()-1).toString()+"-"+(Y.getFullYear()%100).toString(),p.HeaderText=(e==n.HalfYearWise?"H":"Q")+I+" "+P,p.ID="Y"+Y.getFullYear()+"M"+Y.iMonth();let k=new j;k.dtStart=s,k.dtEnd=s.AddMonths(N).AddDays(-1),this.QtrSlot.push(m.ID,k)}else e==n.YearWise&&(p.HeaderText=V.ToString("yyyy"),p.ID="Y"+V.getFullYear());this.lstPMTags.push(p.ID),p.HeaderAppearance.IsVisible=this.ShowPrevMonthData,h.push(p),++this.CountMonths}if(this.ShowPrevMonthDiffData){let p=m.Clone();s.AddYears(-1),p.HeaderText="Diff",e==n.DayWise?p.ID=7==this.ViewModel.StaticReportType?"DIFF_Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2)+"D"+s.getDate():"DIFF_Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.Day:e==n.MonthWise?p.ID=7==this.ViewModel.StaticReportType?"DIFF_Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2):"DIFF_Y"+s.getFullYear()+"M"+s.iMonth():e==n.QtrWise||e==n.HalfYearWise?p.ID="DIFF_Y"+s.getFullYear()+"M"+s.iMonth():e==n.YearWise&&(p.ID="DIFF_Y"+s.getFullYear()),h.push(p),++this.CountMonths}if(this.ShowPrevMonthVarPer){let p=m.Clone();s.AddYears(-1),p.HeaderText="Variance %",p.DataFormat.PercentageOn="DIFF",e==n.DayWise?p.ID=7==this.ViewModel.StaticReportType?"VARPER_Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2)+"D"+s.getDate():"VARPER_Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate():e==n.MonthWise?p.ID=7==this.ViewModel.StaticReportType?"VARPER_Y"+s.getFullYear()+"M"+s.iMonth().PrefixZero(2):"VARPER_Y"+s.getFullYear()+"M"+s.iMonth():e==n.QtrWise||e==n.HalfYearWise?p.ID="VARPER_Y"+s.getFullYear()+"M"+s.iMonth():e==n.YearWise&&(p.ID="VARPER_Y"+s.getFullYear()),h.push(p),++this.CountMonths}if(this.ShowSalesPerMonthly){let p=m.Clone();p.HeaderText="Percentage",p.DataFormat.PercentageOn="Balance",p.width>85&&(p.width=85),p.ID=e==n.DayWise?"SalesPercentage_Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDate():e==n.MonthWise?"SalesPercentage_Y"+s.getFullYear()+"M"+s.iMonth():e==n.QtrWise||e==n.HalfYearWise?"SalesPercentage_"+m.ID:"SalesPercentage_Y"+s.ToString("yyyy"),p.DataFormat.NegativeNumber=0,h.push(p),++this.CountMonths}s=e==n.DayWise?s.AddDays(1):e==n.MonthWise?s.AddMonths(1):e==n.QtrWise||e==n.HalfYearWise?s.AddMonths(N):s.AddYears(1)}!o.J0.IsEmpty(l)&&h[0].HeaderHeight<40&&h[0].HeaderHeight<40&&h.forEach(m=>m.HeaderHeight=45)}SetConsolidateData(e,h){let t=null;e.Columns[0].Contains("Mn")||e.Columns.push("Mn"),e.Columns[0].Contains("ActualAccountID")||e.Columns.push("ActualAccountID");for(let l=0;l<e.Tables[0].length;l++)e.Tables[0][l].Mn=T.d.SessionManager.CompanyIndex,e.Tables[0][l].ActualAccountID=e.Tables[0][l].AccountID;let a=this.TagTableName.split(","),r=parseInt(e.Tables[0].Compute("max","AccountID"));for(let l=0;l<a.length;l++)if(t=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C"+a[l]+" "+h),!t.Columns[0].Contains("ErrorMessage")){t.Columns[0].Contains("Mn")||t.Columns.push("Mn"),t.Columns[0].Contains("ActualAccountID")||t.Columns.push("ActualAccountID");for(let s=0;s<t.Tables[0].length;s++){let u;t.Tables[0][s].Mn=a[l],t.Tables[0][s].ActualAccountID=t.Tables[0][s].AccountID,u=t.Tables[0].filter("Code+'-'+Name"==this.TagColumnName?f=>f.AccountCode==o.J0.String(t.Tables[0][s].AccountCode)&&f.AccountName==o.J0.String(t.Tables[0][s].AccountName)&&f.IsGroup==t.Tables[0][s].IsGroup&&f.AccountTypeID==t.Tables[0][s].AccountTypeID:f=>f[f.Account+this.TagColumnName]==o.J0.String(t.Tables[0][s]["Account"+this.TagColumnName])&&f.IsGroup==t.Tables[0][s].IsGroup&&f.AccountTypeID==t.Tables[0][s].AccountTypeID),u.length>0?(t.Tables[0][s].AccountID=u[0].AccountID,t.Tables[0][s].AccountCode=u[0].AccountCode,t.Tables[0][s].AccountName=u[0].AccountName,t.Tables[0][s].lft=u[0].lft,t.Tables[0][s].rgt=u[0].rgt,t.Tables[0][s].Depth=u[0].Depth,t.Columns[0].Contains("ParentID")&&(t.Tables[0][s].ParentID=u[0].ParentID)):(r++,t.Tables[0][s].AccountID=r),t.Columns[0].Contains("ParentID")&&(u=t.Tables[0].filter(f=>f.ParentID==t.Tables[0][s].ActualAccountID),u.forEach(f=>{f.ParentID=t.Tables[0][s].AccountID}))}e.Tables[0].AddRange(t.Tables[0])}}}}}]);