"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6240],{46240:(S,b,h)=>{h.r(b),h.d(b,{PayrollCommonPopUpViewModel:()=>m});var n=h(86739),d=h(8787),c=h(23823),p=h(49710),o=h(18569),D=h(24028);class m extends c.g{get Table(){return this.TableObj.Table}get ColSource(){return this.TableObj.Columns}set ColSource(t){this.TableObj.Columns=t}constructor(t){if(super(),this.DialogResult=!1,this.DocHistoryVisibility=!1,this.HistoryVisibility=!1,this.ShiftGetPreviousVisibility=!1,this.DailyAttendanceValidateVisibility=!1,this.dtpStartDate=new D.P6(0),this.dtpEndDate=new D.P6(0),this.TableObj=new p.vv,this.iFlag=0,this.DisplayMessage="",this.Parent=t[0],"MonthlyPayrollViewModel"==this.Parent.className&&(this.Parent.Opacity=.3),this.iFlag=parseInt(t[1]),"100"==t[1].toString()){this.DocHistoryVisibility=!0,this.Title="Document History";let e=t[2].toString(),i=t[3].toString();this.LoadGrid(100);let s=this.GetDocumentHistory(parseInt(e),parseInt(i));if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("ModifiedBy")){let a=0;for(let r=0;r<s.Tables[0].length;r++){let l=this.dgv.NewRow();l.ModifiedBy=s.Tables[0][r].ModifiedBy.toString(),d.J0.IsEmpty(s.Tables[0][r].ModifiedDate)||(l.ModifiedDate=d.J0.ParseDate(s.Tables[0][r].ModifiedDate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]+" hh:mm:ss tt")),d.J0.IsEmpty(s.Tables[0][r].maxid)||(a<parseInt(s.Tables[0][r].maxid.toString())&&(a=parseInt(s.Tables[0][r].maxid.toString())),l.maxid=s.Tables[0][r].maxid.toString()),this.dgv.addRow(l)}let u=this.dgv.Table.filter(r=>r.maxid==a.toString());u.length>0&&(u[0].IsCurrent="YES")}}else if("101"==t[1].toString()){let e;this.HistoryVisibility=!0,this.Title="History",this.ColSource=[],e=new o.O7,e.DataType="TextBlock",e.Header="User",e.DisplayMember="CreatedBy",e.Width=90,this.ColSource.push(e),e=new o.O7,e.DataType="TextBlock",e.Header="FirstName",e.DisplayMember="FirstName",e.Width=90,this.ColSource.push(e),e=new o.O7,e.DataType="TextBlock",e.Header="LastName",e.DisplayMember="LastName",e.Width=90,this.ColSource.push(e),e=new o.O7,e.DataType="TextBlock",e.Header=n.d.GetResource("Date"),e.DisplayMember="AppDate",e.Width=128,this.ColSource.push(e),e=new o.O7,e.DataType="LINK",e.Header="Level",e.DisplayMember="LevelName",e.Width=93,this.ColSource.push(e),e=new o.O7,e.DataType="TextBlock",e.Header="Status",e.DisplayMember="Status",e.Width=80,this.ColSource.push(e),e=new o.O7,e.DataType="Format",e.Header="Remarks",e.DisplayMember="Remarks",e.Width=190,this.ColSource.push(e);let i=t[2].toString(),s=t[3].toString(),a=this.GetDocStatusHistory(parseInt(i),parseInt(s),!0);if(null!=a&&a.Tables.length>0){this.TableObj.Table=a.Tables[0],this.TableObj.TableColumns.push("AppDate");for(let l=0;l<this.Table.length;l++)d.J0.IsEmpty(this.Table[l].Date)||(this.Table[l].AppDate=d.J0.ParseDate(this.Table[l].Date.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]+" hh:mm a"));let u=0,r=0;this.Table.length>0&&(u=d.J0.Int(this.Table[this.Table.length-1].WorkFlowLevel),r=d.J0.Int(this.Table[this.Table.length-1].StatusID)),369!=r&&(a.Tables[1]=a.Tables[1].filter(l=>l.levelID>u),a.Tables[1].forEach(l=>{let g=this.TableObj.NewRow();g.LevelName=l.LevelName,g.Status="Pending",g.WorkFlowLevel=l.LevelID,this.TableObj.addRow(g)}));for(let l=this.Table.length;l<7;l++)this.TableObj.addEmptyRow()}}else if("102"==t[1].toString()){let e,i;this.ShiftGetPreviousVisibility=!0,this.Title="Get Previous",this.dtpStartDate.Label="Previous From Date",this.dtpStartDate.LblWidth="140",this.dtpEndDate.Label="Previous To Date",this.dtpEndDate.LblWidth="140",e=this.Parent.ScreenObject.CustomTab.Pages[0].Fields.find(s=>s instanceof D.P6&&"dcAlpha1"==s.DBColumnName),i=this.Parent.ScreenObject.CustomTab.Pages[0].Fields.find(s=>s instanceof D.P6&&"dcAlpha2"==s.DBColumnName),this.Parent.ScreenObject.Preferences.ContainsKey("PickDataBasedOn")&&!d.J0.IsEmpty(this.Parent.ScreenObject.Preferences.PickDataBasedOn)&&("day"==this.Parent.ScreenObject.Preferences.PickDataBasedOn.toString().toLowerCase()?(this.dtpStartDate.Date=e.Date.AddDays(-1),this.dtpEndDate.Date=i.Date.AddDays(-1)):"week"==this.Parent.ScreenObject.Preferences.PickDataBasedOn.toString().toLowerCase()?(this.dtpStartDate.Date=e.Date.AddDays(-7),this.dtpEndDate.Date=i.Date.AddDays(-7)):"month"==this.Parent.ScreenObject.Preferences.PickDataBasedOn.toString().toLowerCase()&&(this.dtpStartDate.Date=e.Date.AddMonths(-1),this.dtpEndDate.Date=i.Date.AddMonths(-1)))}else if("103"==t[1].toString()){this.DailyAttendanceValidateVisibility=!0,this.Title="Validate";let e=t[3];this.LoadGrid(103),null!=e&&e.length>0&&(this.dgv.Table=e)}}LoadGrid(t){if(Logger.InfoLog("PayrollCommonPopUpViewModel::Entering LoadGrid()"),100==t){let e;this.dgv=new p.vv,this.dgv.Columns=[],this.dgv.Width="",e=new o.O7,e.Header="User",e.DisplayMember="ModifiedBy",e.ID="ModifiedBy",e.Width=120,e.ReadOnly=!0,this.dgv.Columns.push(e),e=new o.O7,e.Header="Date",e.DisplayMember="ModifiedDate",e.ID="ModifiedDate",e.Width=150,e.ReadOnly=!0,this.dgv.Columns.push(e),e=new o.O7,e.Header="Version",e.DisplayMember="VersionNo",e.ID="VersionNo",e.Width=100,e.IsVisible=!1,this.dgv.Columns.push(e),e=new o.O7,e.Header="Reason",e.DisplayMember="ReviseReason",e.ID="ReviseReason",e.Width=100,e.IsVisible=!1,this.dgv.Columns.push(e),this.dgv.Clear(),this.dgv.TableColumns.push("ModifiedBy"),this.dgv.TableColumns.push("ModifiedDate"),this.dgv.TableColumns.push("MaxID"),this.dgv.TableColumns.push("IsCurrent"),this.dgv.TableColumns.push("VersionNo"),this.dgv.TableColumns.push("ReviseReason")}else if(103==t){let e;this.dgv=new p.vv,this.dgv.Columns=[],this.dgv.Width="",e=new o.O7,e.Header="DocSeq. No.",e.DisplayMember="DocSeqNo",e.ID="DocSeqNo",e.Width=80,e.ReadOnly=!0,this.dgv.Columns.push(e),e=new o.O7,e.Header="Code",e.DisplayMember="Code",e.ID="Code",e.Width=120,e.ReadOnly=!0,this.dgv.Columns.push(e),e=new o.O7,e.Header="Name",e.DisplayMember="Name",e.ID="Name",e.Width=120,e.ReadOnly=!0,this.dgv.Columns.push(e),e=new o.O7,e.Header="Message",e.DisplayMember="Message",e.ID="Message",e.Width=300,e.ReadOnly=!0,this.dgv.Columns.push(e),this.dgv.TableColumns.push("DocSeqNo"),this.dgv.TableColumns.push("Code"),this.dgv.TableColumns.push("Name"),this.dgv.TableColumns.push("Message")}Logger.InfoLog("PayrollCommonPopUpViewModel::Exiting LoadGrid()")}GetDocumentHistory(t,e){let i=[];return i.push(t),i.push(e),i.push(n.d.SessionManager.UserID),i.push(n.d.SessionManager.RoleID),i.push(n.d.SessionManager.UserName),i.push(n.d.SessionManager.LanguageID),n.d.document.GetDocumentHistory(i)}GetDocStatusHistory(t,e,i){Logger.InfoLog("PayrollCommonPopUpViewModel:: Inside GetDocStatusHistory");let s=[];s.push(t),s.push(e),s.push(i),s.push(n.d.SessionManager.UserID),s.push(n.d.SessionManager.LanguageID);let a=n.d.document.GetDocStatusHistory(s);return Logger.InfoLog("PayrollCommonPopUpViewModel:: Exiting GetDocStatusHistory"),a}Button_Click(t){if("OK"==t.toString()){if(!this.ValidateScreen())return;this.DialogResult=!0}else if("Cancel"==t.toString())null!=this.Parent&&"MonthlyPayrollViewModel"==this.Parent.className&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1;else if("ExcludeAndPost"==t.ToString()){if(null!=this.Parent.ScreenObject.GridData&&this.Parent.ScreenObject.GridData.length>0&&null!=this.dgv.Table&&this.dgv.Table.length>0){for(let e=this.dgv.Table.length-1;e>=0;e--)for(let i=this.Parent.ScreenObject.GridData.length-1;i>=0;i--)if(this.Parent.ScreenObject.GridData[i].DocSeqNo.ToString()==this.dgv.Table[e].DocSeqNo.ToString()){this.Parent.ScreenObject.GridData.RemoveAt(i);break}this.Parent.ScreenObject.GridDataObj.refreshDataView()}this.DialogResult=!0}else"Export"==t.ToString()&&this.btnExport_Click();n.d.page.HideDialog(this.PopUpGUID)}ValidateScreen(){if(102==this.iFlag){if(null==this.dtpStartDate.Date||!this.dtpStartDate.Date)return this.DisplayMessage="Select Start Date",this.dtpStartDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpEndDate.Date||!this.dtpEndDate.Date)return this.DisplayMessage="Select End Date",this.dtpEndDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(this.dtpEndDate.Date<this.dtpStartDate.Date)return this.DisplayMessage="EndDate Should be greater than or equal to StartDate",this.dtpEndDate.SetFocus=!0,this.MessageVisibility=!0,!1;let t,e;if(t=this.Parent.ScreenObject.CustomTab.Pages[0].Fields.find(a=>a instanceof D.P6&&"dcAlpha1"==a.DBColumnName),e=this.Parent.ScreenObject.CustomTab.Pages[0].Fields.find(a=>a instanceof D.P6&&"dcAlpha2"==a.DBColumnName),this.dtpStartDate.Date>=t.Date&&this.dtpStartDate.Date<=e.Date)return this.DisplayMessage="Previous From Date should not be between from and to date",this.dtpStartDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(this.dtpEndDate.Date>=t.Date&&this.dtpEndDate.Date<=e.Date)return this.DisplayMessage="Previous To Date should not be between from and to date",this.dtpEndDate.SetFocus=!0,this.MessageVisibility=!0,!1;let i=0,s=0;if(i=d.J0.GetDateDifference(this.dtpEndDate.Date,this.dtpStartDate.Date)+1,s=d.J0.GetDateDifference(e.Date,t.Date)+1,i>s)return this.DisplayMessage="Previous Dates cannot be more than from and to date",this.MessageVisibility=!0,!1}return!0}btnExport_Click(){this.dgv.Excelexportdelegate.Call()}}}}]);