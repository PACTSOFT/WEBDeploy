"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[824],{39559:(Xt,tt,W)=>{W.d(tt,{h:()=>le});class le{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}},54004:(Xt,tt,W)=>{W.r(tt),W.d(tt,{FinalSettlementComponent:()=>da});var le=W(10467),We=W(89417),b=W(86739),r=W(31820),qe=W(98669),He=W(49710),Dt=W(7601),ye=W(32647),e=W(8787),_e=W(72099),Ae=W(38816),Qe=W(75782),Ue=W(81669),Tt=W(95005),xe=W(33012),ue=W(10287),Z=W(18569),Fe=W(92701),pe=W(9309),$e=W(54683),C=W(47267),ve=W(27961),se=W(50334),Ye=W(48875),at=W(39560),At=W(35063),X=W(44904),ge=W(95707),o=W(54438),ht=W(60177),ze=W(60440),Ke=W(94304),xt=W(36688),Ft=W(13816),Kt=W(73955);function gt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("Approve"))}),o.nrm(1,"i",39),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Approve")))}function yt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("Save"))}),o.nrm(1,"i",40),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Post")))}function mt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("SaveAndPrint"))}),o.nrm(1,"i",41),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"SaveAndPrint")))}function je(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.btnPrint_Click("Print"))}),o.nrm(1,"i",42),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Print")))}function Nt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.btnPrintPreview_Click("Preview"))}),o.nrm(1,"i",43),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Preview")))}function ct(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.btnExport_Click("Export"))}),o.nrm(1,"i",44),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Export")))}function Ct(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("Attachments"))}),o.nrm(1,"i",45),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Attachments")))}function rt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("EMail"))}),o.nrm(1,"i",46),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"SMTP_Email")))}function qt(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("Delete"))}),o.nrm(1,"i",47),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Delete")))}function $t(U,he){if(1&U){const m=o.RV6();o.j41(0,"span",10),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.obj.Button_Click("Report"))}),o.nrm(1,"i",48),o.EFF(2),o.nI1(3,"translate"),o.k0s()}2&U&&(o.R7$(2),o.JRh(o.bMT(3,1,"Report")))}function Qt(U,he){if(1&U){const m=o.RV6();o.j41(0,"div",22),o.EFF(1,"\n                "),o.j41(2,"div"),o.EFF(3,"\n                  "),o.j41(4,"div",49),o.EFF(5,"\n                    "),o.eu8(6,50),o.EFF(7,"\n                    "),o.j41(8,"div",51),o.EFF(9,"\n                      "),o.j41(10,"label",52),o.EFF(11),o.k0s(),o.EFF(12,"\n                      "),o.j41(13,"div",53),o.EFF(14,"\n                        "),o.j41(15,"span",54),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.Calculate_Click("Previous"))}),o.nrm(16,"i",55),o.k0s(),o.EFF(17,"\n                        "),o.j41(18,"span",54),o.bIt("click",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.Calculate_Click("Next"))}),o.nrm(19,"i",56),o.k0s(),o.EFF(20,"\n                      "),o.k0s(),o.EFF(21,"\n                    "),o.k0s(),o.EFF(22,"\n                  "),o.k0s(),o.EFF(23,"\n                  \n                  \n                "),o.k0s(),o.EFF(24,"\n              "),o.k0s()}if(2&U){const m=o.XpG();o.R7$(6),o.Y8G("obj",m.obj.DocPrefix)("group",m.form),o.R7$(5),o.JRh(m.obj.lblDocNo)}}function zt(U,he){if(1&U&&(o.j41(0,"div",22),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.dtpDocDate)("group",m.form)}}function Pt(U,he){if(1&U&&(o.j41(0,"div",57),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.EmployeeList)("group",m.form)}}function Zt(U,he){if(1&U&&(o.j41(0,"div",22),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.cmbSettlementType)("group",m.form)}}function ea(U,he){if(1&U&&(o.j41(0,"div",22),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.dtpDateOfJoining)("group",m.form)}}function vt(U,he){if(1&U&&(o.j41(0,"div",22),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.dtpDateOfRelieving)("group",m.form)}}function Lt(U,he){if(1&U&&(o.j41(0,"div",57),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.txtRemarks)("group",m.form)}}function ta(U,he){if(1&U&&(o.j41(0,"div",22),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.obj.txtNetAmount)("group",m.form)}}function aa(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.EFF(2,"\n              "),o.nrm(3,"app-PactGridView",59),o.EFF(4,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(3),o.Y8G("obj",m.dgvGratuity)("group",m.form)}}function pt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.cmbResignType)("group",m.form)}}function lt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.cmbResignReason)("group",m.form)}}function Rt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtGratuityAmount)("group",m.form)}}function Ot(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtAvailedGratuityAmount)("group",m.form)}}function Vt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtPartialGratuityAmount)("group",m.form)}}function sa(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.dgvLeaveEncash)("group",m.form)}}function la(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtCumLeaveSalBalAmt)("group",m.form)}}function ia(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtLEAmount)("group",m.form)}}function It(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG(2);o.R7$(2),o.Y8G("obj",m.dgvUPS)("group",m.form)}}function wt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG(2);o.R7$(2),o.Y8G("obj",m.txtUPSAmount)("group",m.form)}}function St(U,he){if(1&U){const m=o.RV6();o.j41(0,"tab",26),o.bIt("selectTab",function(){o.eBV(m);const y=o.XpG();return o.Njj(y.onSelectTab("dgvUPS"))}),o.EFF(1,"\n          "),o.j41(2,"div",36),o.EFF(3,"\n            "),o.DNE(4,It,4,2,"div",28),o.EFF(5,"\n            "),o.j41(6,"div",37),o.EFF(7,"\n              "),o.j41(8,"div",31),o.EFF(9,"\n                "),o.eu8(10,32),o.EFF(11,"\n              "),o.k0s(),o.EFF(12,"\n              "),o.DNE(13,wt,4,2,"div",30),o.EFF(14,"\n            "),o.k0s(),o.EFF(15,"\n          "),o.k0s(),o.EFF(16,"\n        "),o.k0s()}if(2&U){const m=o.XpG();o.FS9("heading",m.tpUnProcessedSalary),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",m.dgvUPS.Visible),o.R7$(6),o.Y8G("obj",m.UPSRemarks)("group",m.form),o.R7$(3),o.Y8G("ngIf",m.txtUPSAmount.Visible)}}function Gt(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.dgvNoticePay)("group",m.form)}}function Se(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtNPAmount)("group",m.form)}}function dt(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.dgvOthAdd)("group",m.form)}}function na(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtOthAddAmount)("group",m.form)}}function oa(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.dgvOthDed)("group",m.form)}}function kt(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtOthDedAmount)("group",m.form)}}function _t(U,he){if(1&U&&(o.j41(0,"div",58),o.EFF(1,"\n              "),o.nrm(2,"app-PactGridView",59),o.EFF(3,"\n            "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.dgvLoanBal)("group",m.form)}}function ra(U,he){if(1&U&&(o.j41(0,"div",31),o.EFF(1,"\n                "),o.eu8(2,32),o.EFF(3,"\n              "),o.k0s()),2&U){const m=o.XpG();o.R7$(2),o.Y8G("obj",m.txtLoanBalAmount)("group",m.form)}}let da=(()=>{class U{constructor(){this.form=new We.gE({}),this.IsAccordionOpen=!0,this.EmpSeqNo=0,this.GratuityGrade=0,this.EmpGrade=0,this.GratuityDocID=0,this.PrevEmpSeqNo=0,this.sDocNo="0",this.strFormula="",this.isLoaded=!1,this.dblAmount=0,this.drwRes=null,this.chkCalcBasedOnLastSal=new _e.c,this.chkCalcBasedOnActDays=new _e.c,this.chkLECalcBasedOnLastApprSerYearWise=new _e.c,this.GratuityRemarks=new r.Dw(0),this.LeaveRemarks=new r.Dw(0),this.UPSRemarks=new r.Dw(0),this.NoticePayRemarks=new r.Dw(0),this.OAddRemarks=new r.Dw(0),this.ODedRemarks=new r.Dw(0),this.LoanRemarks=new r.Dw(0),this.txtGratuityAmount=new r.Dw(0),this.txtAvailedGratuityAmount=new r.Dw(0),this.txtPartialGratuityAmount=new r.Dw(0),this.txtCumLeaveSalBalAmt=new r.Dw(0),this.txtLEAmount=new r.Dw(0),this.txtUPSAmount=new r.Dw(0),this.txtOthAddAmount=new r.Dw(0),this.txtOthDedAmount=new r.Dw(0),this.txtNPAmount=new r.Dw(0),this.txtLoanBalAmount=new r.Dw(0),this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="",this.lblActRelievingDate="",this.dgvGratuity=new He.vv,this.dgvLeaveEncash=new He.vv,this.dgvUPS=new He.vv,this.dgvOthAdd=new He.vv,this.dgvOthDed=new He.vv,this.dgvNoticePay=new He.vv,this.dgvLoanBal=new He.vv,this.lblDocNo="",this.tpGratuity="",this.tpLeaveEncashment="",this.tpUnProcessedSalary="",this.tpNoticePay="",this.tpOtherAdditions="",this.tpOtherDeductions="",this.tpLoanBalances="",this.btnCalcGratuity="",this.lbl1GratuityTotalDays="",this.lbl1GratuityServiceDays="",this.lbl1GratuityLOPDays="",this.lbl1GratuityBalDays="",this.lbl1GratuityTotalGrDays="",this.lblGratuityAmount="",this.lblAvailedGratuityAmount="",this.lblPartialGratuityAmount="",this.lbl1GratuityTaken="",this.lblCumLeaveSalBalAmt="",this.btnCalcLE="",this.lblLEAmount="",this.lblUPSAmount="",this.lblNPAmount="",this.lblOthAddAmount="",this.lblOthDedAmount="",this.lblLoanBalAmount="",this.dtEdit=null,this.iCurDocNo=0,this.CostCenterID=40095,this.DefProdID=0,this.dblBasic=0,this.EOS_ROff=0,this.dServiceDaysFormulaAmount=0,this.dblGratuityAmount=0,this.dActServiceDays=0,this.dServiceDaysAfterLOP=0,this.dLOPDays=0,this.EOS_ROffYear=0,this.isLast=!1,this.isConsdExpiredupto=!1,this.sVacTypeSeqNo="-1",this.EOS_GratuityFormula="",this.EOS_AvailedFormula="",this.sShowBasicAs="0",this.EOS_MaxDays=0,this.dEarnedGrDays=0,this.lst=new Array,this.dTotGratuityDays=0,this.dGratuityTaken=0,this.dShowBasicAs=0,this.dShowBasicAmount=0,this.isMaxDaysExceded=!1,this.oEvalPayFormulas=null,this.MoreThanOneLayout=!1,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null,this._Ddate=Date.Today(),this.IsRefLCTR=!1,this.guid=""}ngOnInit(){this.obj=this.params?.obj,this.FinalSettlement_DataContextChanged(),this.FinalSettlement_Loaded(),console.log(this)}onSelectTab(m){b.d.page.RefreshSlickGridUI()}get txtDocNo(){return""!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox:this.ViewModel.txtDocNo}get txtRemarks(){return this.ViewModel.txtRemarks}get txtNetAmount(){return this.ViewModel.txtNetAmount}get EmployeeList(){return this.ViewModel.EmployeeList}get cmbResignType(){return this.ViewModel.cmbResignType}get cmbResignReason(){return this.ViewModel.cmbResignReason}get cmbSettlementType(){return this.ViewModel.cmbSettlementType}get dtpDocDate(){return this.ViewModel.dtpDocDate}get dtpDateOfJoining(){return this.ViewModel.dtpDateOfJoining}get dtpDateOfRelieving(){return this.ViewModel.dtpDateOfRelieving}FinalSettlement_DataContextChanged(){this.ViewModel=this.params?.obj,this.ViewModel.CalculateClick.Subscribe(this,"Calculate_Click"),this.ViewModel.EmpSelectionChanged.Subscribe(this,"Employee_SelectionChanged"),this.ViewModel.txtDocNo.LostFocusCommand.Subscribe(this,"txtDocNo_LostFocus"),this.ViewModel.DocPrefixSelectionChanged.Subscribe(this,"OnDocPrefixChanged"),this.dgvOthAdd.CellEditEnding.Subscribe(this,"dgvOthAdd_CellEndEdit"),this.dgvOthDed.CellEditEnding.Subscribe(this,"dgvOthDed_CellEndEdit"),this.dtpDateOfRelieving.SelectedDateChanged.Subscribe(this,"dtpDateOfRelieving_SelectedDateChanged"),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1)}FinalSettlement_Loaded(){this.isLoaded||(this.LoadGrids(),this.Clear_Click(),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.CheckDateInDocNumber(!0,!0),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),this.dsLookups=b.d.common.GetDataSet("CRM015",""),this.dgvOthAdd.Columns.find(I=>"dgColOthAddParticulars"==I.ValueBinding).ComboData=this.dsLookups.Tables[0],this.dgvOthDed.Columns.find(I=>"dgColOthDedParticulars"==I.ValueBinding).ComboData=this.dsLookups.Tables[1],this.dgvOthAdd.CanUserAddRows=!0,this.dgvOthAdd.CanUserDeleteRows=!0,this.dgvOthAdd.addEmptyRow(),this.dgvOthDed.CanUserAddRows=!0,this.dgvOthDed.CanUserDeleteRows=!0,this.dgvOthDed.addEmptyRow(),this.dgvOthAdd.refreshDataView(),this.lblDocNo=this.GetResource("VoucherNo",40095),this.tpGratuity=this.GetResource("Gratuity",40095),this.tpLeaveEncashment=this.GetResource("Leave Encashment",40095),this.tpUnProcessedSalary=this.GetResource("Un-Processed Salary",40095),this.tpNoticePay=this.GetResource("Notice Pay",40095),this.tpOtherAdditions=this.GetResource("Other Additions",40095),this.tpOtherDeductions=this.GetResource("Other Deductions",40095),this.tpLoanBalances=this.GetResource("Loan Balances",40095),this.chkCalcBasedOnLastSal.Label=this.GetResource("Calculate based on Last Salary",40095),this.chkCalcBasedOnActDays.Label=this.GetResource("Calculate Salary based on Actual Days",40095),this.btnCalcGratuity=this.GetResource("Calculate",40095),this.lbl1GratuityTotalDays=this.GetResource("Total Days",40095)+" : ",this.lbl1GratuityServiceDays=this.GetResource("Service Days",40095)+" : ",this.lbl1GratuityLOPDays=", "+this.GetResource("LOP",40095)+" : ",this.lbl1GratuityBalDays=", "+this.GetResource("Balance",40095)+" : ",this.lbl1GratuityTotalGrDays=this.GetResource("Total Gratuity Days",40095)+" : ",this.lbl1GratuityTaken=this.GetResource("Gratuity Taken",40095)+" : ",this.lblGratuityAmount=this.GetResource("Gratuity Amount",40095),this.lblAvailedGratuityAmount=this.GetResource("Availed Gratuity Amount",40095),this.lblPartialGratuityAmount=this.GetResource("Partial Gratuity Amount",40095),this.lblCumLeaveSalBalAmt=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.chkLECalcBasedOnLastApprSerYearWise.Label=this.GetResource("Calculate based on Last Appraisal - Service Year Wise",40095),this.btnCalcLE=this.GetResource("Calculate",40095),this.lblLEAmount=this.GetResource("Amount",40095),this.lblUPSAmount=this.GetResource("Amount",40095),this.lblNPAmount=this.GetResource("Amount",40095),this.lblOthAddAmount=this.GetResource("Amount",40095),this.lblOthDedAmount=this.GetResource("Amount",40095),this.lblLoanBalAmount=this.GetResource("Amount",40095),this.isLoaded=!0,""!=this.ViewModel.sVNo&&this.LoadDocument(parseInt(this.ViewModel.sVNo.Replace("FST-","")),this.Prefix))}txtDocNo_LostFocus(m){try{this.txtDocNo.Text.Trim().length>0&&this.LoadDocument(parseInt(this.txtDocNo.Text.Trim()),this.Prefix)}catch{this.ViewModel.DisplayMessage="Enter Valid DocNo."}}LoadDocument(m,I){let y;this.ViewModel.DisplayMessage="",this.ViewModel.MessageVisibility=!0,this.sDocNo=m.toString();let u=b.d.common.GetDataTable("CRM016",m.toString()+"~"+I);if(null!=u&&u.length>0){if(!e.J0.IsEmpty(b.d.SessionManager.sEmpFilteredEmpSeqNos)&&!b.d.SessionManager.sEmpFilteredEmpSeqNos.split(",").Contains(parseInt(u[0].EmpSeqNo).toString()))return this.ViewModel.DisplayMessage="You don't have permission to view this Document.",this.ViewModel.MessageVisibility=!0,this.Clear_Click(),this.txtDocNo.Text=m.toString(),void(this.EmployeeList.IsEnabled=!1);this.EmployeeList.IsEnabled=!0,this.ViewModel.PostVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ViewModel.SavePrintVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.EmployeeList.SelectedValue=parseInt(u[0].EmpSeqNo),this.EmployeeList.SelectedValue=parseInt(u[0].EmpSeqNo),this.ClearControlValues(),this.dtEdit=null,this.EmpSeqNo=parseInt(u[0].EmpSeqNo),this.dtEdit=b.d.common.GetDataTable("CRM018",this.EmpSeqNo.toString()+"~"+m+"~"+I),null!=this.dtEdit&&this.dtEdit.length>0&&(this.dtpDocDate.Date=e.J0.ParseDate(this.dtEdit[0].cDocDate));let M=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.iMonth(),1),w=[];if(w.push(this.EmpSeqNo),w.push(0),w.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),w.push(M.ToString("dd/MMM/yyyy")),w.push(m),w.push(I),w.push(1),w.push(b.d.SessionManager.UserID),w.push(b.d.SessionManager.RoleID),w.push(b.d.SessionManager.LanguageID),this.dsD=b.d.common.GetDataSet_SP(w,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0&&this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=e.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.cmbSettlementType.SelectedValue="Final",this.DOB=e.J0.ParseDate(this.dsD.Tables[0][0].DOB),9e3!=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+" : "+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=new Date,this.cmbResignType.SelectedValue=e.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==e.J0.String(this.dsD.Tables[0][0].ResignStatus)){let R=e.J0.ParseDate(this.dsD.Tables[0][0].DOResign),B=new Date(R.getFullYear(),R.getMonth(),1),O=new Date,L=B;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=b.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(b.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(O=B.AddMonths(parseInt(b.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=b.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(b.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(O=B.AddMonths(parseInt(b.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=b.d.SessionManager.Preferences.NPResignation&&parseInt(b.d.SessionManager.Preferences.NPResignation)>0&&(O=B.AddMonths(parseInt(b.d.SessionManager.Preferences.NPResignation)-1));let $=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfRelieving.Date.iMonth(),1);if(O<$)for(;O<$;)O=O.AddMonths(1);let z,oe=new Date,Q=new Date,Le=new Date;for(;L<=O;){if(y=this.dsD.Tables[5].filter(Me=>Me.PayrollDate==L.ToString("dd/MMM/yyyy")),null==y||0==y.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=L.ToString("dd/MMM/yyyy"),"Actual Days"==b.d.SessionManager.Preferences.PayDays){let Me={PayrollMonth:oe,PayrollMonthStart:Q,PayrollMonthEnd:Le};if(e.J0.SetPayrollDate_1(L,Me),oe=Me.PayrollMonth,Q=Me.PayrollMonthStart,Le=Me.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Oe=0;Oe=e.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),oe,Q,Le),Oe>0&&(e.J0.SetPayrollDate_1(L,Me,this.EmpGrade),oe=Me.PayrollMonth,Q=Me.PayrollMonthStart,Le=Me.PayrollMonthEnd)}z=Le.Subtract(Q).Days+1}else z=parseInt(b.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=z,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(b.d.SessionManager.sPayrollDecimals)}L=L.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&b.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==b.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let R=0,B=0;for(let O=0;O<this.dsD.Columns[8].length;O++)e.J0.IsEmpty(this.dsD.Tables[8][0][O])||(R+=parseFloat(this.dsD.Tables[8][0][O]));for(let O=0;O<this.dsD.Tables[9].length;O++)e.J0.IsEmpty(this.dsD.Tables[9][O].Amount)||(B+=parseFloat(this.dsD.Tables[9][O].Amount));this.txtCumLeaveSalBalAmt.Text=(R-B).ToString(b.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(b.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let R;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let B=0;B<this.dsD.Tables[4].length;B++)R=e.J0.ParseDate(this.dsD.Tables[4][B].PayrollMonth),this.dgvUPS.Table[B].dgColUPSPayrollMonth=R.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[B].dgColUPSMonthDays=R.DaysInMonth(),this.dgvUPS.Table[B].dgColUPSDaysAtt=0,this.dgvUPS.Table[B].dgColUPSLOP=0,this.dgvUPS.Table[B].dgColUPSNetSal=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[B].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[B])}let k=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let R=0;R<this.dsD.Tables[10].length;R++)this.dgvLoanBal.Table[R].dgColLoanBalSNo=(R+1).toString(),this.dgvLoanBal.Table[R].dgColLoanBalDocNo=this.dsD.Tables[10][R].DocNo.toString(),this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][R].DocID.toString(),this.dgvLoanBal.Table[R].dgColLoanBalLoanType=this.dsD.Tables[10][R].LoanType.toString(),this.dgvLoanBal.Table[R].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][R].LoanCompID.toString(),this.dgvLoanBal.Table[R].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][R].ApprovedAmt).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][R].Paid).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][R].Balance).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalCalc="Pay",k+=parseFloat(this.dsD.Tables[10][R].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[R])}this.txtLoanBalAmount.Text=k.ToString(b.d.SessionManager.sPayrollDecimals),this.ViewModel.ApproveVisibility=!1;let K=null;if(null!=this.dtEdit&&this.dtEdit.length>0){if(this.ViewModel.DocStatus="["+this.dtEdit[0].DocStatus.toString()+"]",this.ViewModel.DocID=parseInt(this.dtEdit[0].DocID),this.sDocNo=this.dtEdit[0].DocNumber.toString(),this.txtDocNo.Text=this.sDocNo,this.dtpDocDate.Date=e.J0.ParseDate(this.dtEdit[0].cDocDate),this.dtpDateOfRelieving.Date=e.J0.ParseDate(this.dtEdit[0].dcAlpha3),this.dtpDateOfRelieving_SelectedDateChanged(this,this.dtpDateOfRelieving),this.txtRemarks.Text=this.dtEdit[0].CommonNarration.toString(),this.ViewModel.StatusID=parseInt(this.dtEdit[0].StatusID),this.ViewModel.WID=parseInt(this.dtEdit[0].WorkflowID),this.cmbSettlementType.SelectedValue=e.J0.String(this.dtEdit[0].dcAlpha10),K=b.d.common.GetDataSet("CRM029",this.ViewModel.DocID.toString()),y=this.dtEdit.filter(L=>"1"==L.dcAlpha1),null!=y&&y.length>0&&(this.GratuityRemarks.Text=y[0].dcAlpha8.toString(),this.cmbResignType.Text=y[0].dcAlpha11.toString(),this.chkCalcBasedOnLastSal.IsChecked=(0,ye.yG0)(y[0].dcAlpha12),this.chkCalcBasedOnActDays.IsChecked=(0,ye.yG0)(y[0].dcAlpha13),this.cmbResignReason.SelectedValue=y[0].dcAlpha33.toString(),this.Calculate_Click("Gratuity"),this.txtPartialGratuityAmount.Text=parseFloat(y[0].dcCalcNum4).ToString(b.d.SessionManager.sPayrollDecimals)),y=this.dtEdit.filter(L=>"2"==L.dcAlpha1),null!=y&&y.length>0){this.LeaveRemarks.Text=y[0].dcAlpha8.toString(),this.chkLECalcBasedOnLastApprSerYearWise.IsChecked=!e.J0.IsEmpty(y[0].dcAlpha17)&&(0,ye.yG0)(y[0].dcAlpha17);for(let L=0;L<y.length;L++)for(let $=0;$<this.dgvLeaveEncash.Table.length;$++)if(y[L].dcAlpha11.toString()==this.dgvLeaveEncash.Table[$+"_Tag"].toString()){this.dgvLeaveEncash.Table[$].dgColLEAvailable=y[L].dcAlpha13.toString(),this.dgvLeaveEncash.Table[$].dgColLEMaxEncash=y[L].dcAlpha14.toString(),this.dgvLeaveEncash.Table[$].dgColLEApplied=y[L].dcAlpha15.toString();break}this.Calculate_Click("LeaveEncash"),this.dgvLeaveEncash.Update()}if(y=this.dtEdit.filter(L=>"3"==L.dcAlpha1),null!=y&&y.length>0){this.UPSRemarks.Text=y[0].dcAlpha8.toString();for(let L=0;L<y.length;L++)for(let $=0;$<this.dgvUPS.Table.length;$++)if(e.J0.ParseDate(y[L].dcAlpha11).ToString("dd MMM yyyy")==e.J0.ParseDate(this.dgvUPS.Table[$].dgColUPSPayrollMonth).ToString("dd MMM yyyy")){this.dgvUPS.Table[$].dgColUPSDaysAtt=y[L].dcAlpha13.toString(),this.dgvUPS.Table[$].dgColUPSLOP=y[L].dcAlpha14.toString(),this.dgvUPS.Table[$].dgColUPSNetSal=y[L].dcAlpha15.toString();break}this.dgvUPS.Update(),this.txtUPSAmount.Text=parseFloat(y[0].dcCalcNum1).ToString(b.d.SessionManager.sPayrollDecimals)}if(y=this.dtEdit.filter(L=>"4"==L.dcAlpha1),null!=y&&y.length>0){this.NoticePayRemarks.Text=y[0].dcAlpha8.toString();for(let L=0;L<y.length;L++)for(let $=0;$<this.dgvNoticePay.Table.length;$++)if(e.J0.ParseDate(y[L].dcAlpha11).ToString("dd MMM yyyy")==e.J0.ParseDate(this.dgvNoticePay.Table[$].dgColNPPayrollMonth).ToString("dd MMM yyyy")){this.dgvNoticePay.Table[$].dgColNPDaysAtt=y[L].dcAlpha13.toString(),this.dgvNoticePay.Table[$].dgColNPLOP=y[L].dcAlpha14.toString(),this.dgvNoticePay.Table[$].dgColNPNetSal=y[L].dcAlpha15.toString(),this.dgvNoticePay.Table[$].dgColNPType=y[L].dcAlpha16.toString(),this.dgvNoticePay.Table[$].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[$]);break}this.txtNPAmount.Text=parseFloat(y[0].dcCalcNum1).ToString(b.d.SessionManager.sPayrollDecimals)}if(y=this.dtEdit.filter(L=>"5"==L.dcAlpha1),null!=y&&y.length>0){this.OAddRemarks.Text=y[0].dcAlpha8.toString(),this.dgvOthAdd.addEmptyRows(y.length);for(let L=0;L<y.length;L++)this.dgvOthAdd.Table[L].dgColOthAddParticulars=parseInt(y[L].dcAlpha11.toString()),this.dgvOthAdd.Table[L].dgColOthAddAmount=y[L].dcAlpha12.toString(),e.J0.IsEmpty(y[L].dcAlpha13)||(this.dgvOthAdd.Table[L].dgColOthAddRemarks=y[L].dcAlpha13.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[L]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2)}if(y=this.dtEdit.filter(L=>"6"==L.dcAlpha1),null!=y&&y.length>0){this.ODedRemarks.Text=y[0].dcAlpha8.toString(),this.dgvOthDed.addEmptyRows(y.length);for(let L=0;L<y.length;L++)this.dgvOthDed.Table[L].dgColOthDedParticulars=parseInt(y[L].dcAlpha11.toString()),this.dgvOthDed.Table[L].dgColOthDedAmount=y[L].dcAlpha12.toString(),e.J0.IsEmpty(y[L].dcAlpha13)||(this.dgvOthDed.Table[L].dgColOthDedRemarks=y[L].dcAlpha13.toString()),this.dgvOthDed.updateRow(this.dgvOthDed.Table[L]),this.dgvOthDed_CellEndEdit(this.dgvOthDed,2)}if(y=this.dtEdit.filter(L=>"7"==L.dcAlpha1),null!=y&&y.length>0){this.LoanRemarks.Text=y[0].dcAlpha8.toString();for(let L=0;L<y.length;L++)for(let $=0;$<this.dgvLoanBal.Table.length;$++)if(y[L].dcAlpha12.toString()==this.dgvLoanBal.Table[$].dgColLoanBalDocNo_Tag.toString()){this.dgvLoanBal.Table[$].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[$].dgColLoanBalSNo_Tag=y[L].dcAlpha17.toString(),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[$]);break}}if(null!=K&&K.Tables.length>0&&K.Tables[0].length>0){let L=K.Tables[0];if(null!=L&&L.length>0)for(let $=0;$<L.length;$++){let z=new $e.AddAttachmentViewModel;z.AddAttachmentViewModel_2(this.ViewModel),z.AttachmentID=parseInt(L[$].FileID),z.ActualFileName=L[$].ActualFileName.toString(),z.FileExtension=L[$].FileExtension.toString(),z.FileDescription=L[$].FileDescription.toString(),z.FilePath=e.J0.GetPath(L[$].GUID+"."+L[$].FileExtension),z.RelativeFileName=L[$].RelativeFileName.toString(),z.IsProductImage=!1,this.ViewModel.ViewAttachments.AttachmentsList.push(z)}}if(this.ViewModel.WID>0){let L=b.d.common.GetDataTable("CRM020",this.dtEdit[0].InvDocDetailsID.toString()+",95,'"+b.d.SessionManager.UserName+"',40095,"+this.ViewModel.WID+","+this.dtEdit[0].WorkFlowLevel.toString()+","+this.dtEdit[0].StatusID.toString()+","+this.dtEdit[0].CreatedDate.toString()+","+b.d.SessionManager.UserID+","+b.d.SessionManager.RoleID);null!=L&&L.length>0&&(null!=L[0].CanApprove&&null!=L[0].CanApprove&&"TRUE"==L[0].CanApprove.toString().toUpperCase()?(this.ViewModel.ApproveVisibility=!0,this.ViewModel.PostVisiblility=!1):this.ViewModel.PostVisiblility=!(!b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))}let R=b.d.common.GetDataSet3("CRM021",this.CostCenterID.toString(),this.ViewModel.DocID.toString());this.ViewModel.WFDocLevelList.Clear();let B=null,O=null;if(B=R.Tables[1],O=R.Tables[0],null!=B&&B.length>0&&!b.d.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let $,L=parseInt(this.dtEdit[0].WorkFlowLevel);O.length>0&&($=parseInt(O[O.length-1].StatusID));let z=O.length>0?parseInt(O[0].WORKFLOWLEVEL)-1:0;for(let oe=0;oe<B.length;oe++){let Q=new Dt.O(parseInt(B[0].WID),parseInt(B[oe].LEVELID),B[oe].LEVELNAME.toString(),this.CostCenterID,this.ViewModel.DocID,e.J0.ParseDate(B[oe].DocDate));oe==z&&(Q.IsPending=!0,Q.Label="C"),0==oe&&(Q.LeftLineBrush="#FFFFFFFF"),oe==B.length-1&&(Q.RightLineBrush="#FFFFFFFF"),this.ViewModel.WFDocLevelList.push(Q)}for(let oe=O.length-1;oe>=0;oe--){let Q=parseInt(O[oe].WORKFLOWLEVEL);if(Q<=L&&Q<=this.ViewModel.WFDocLevelList.length&&!this.ViewModel.WFDocLevelList[Q-1].IsSet){this.ViewModel.WFDocLevelList[Q-1].IsSet=!0,this.ViewModel.WFDocLevelList[Q-1].ModifiedBy=O[oe].STATUS.toString()+" By "+O[oe].CREATEDBY.toString(),O[oe].FIRSTNAME.toString().length>0&&(this.ViewModel.WFDocLevelList[Q-1].ModifiedBy+="("+O[oe].FIRSTNAME.toString()+")");let Le=e.J0.ParseDate(O[oe].DATE);this.ViewModel.WFDocLevelList[Q-1].ModifiedBy+=" On "+Le.ToString(b.d.SessionManager.Preferences["Date Format"]);let Me=parseInt(O[oe].STATUSID);372==Me?this.ViewModel.WFDocLevelList[Q-1].IsRejected=!0:441==Me?this.ViewModel.WFDocLevelList[Q-1].IsApproved=!0:369==Me&&(this.ViewModel.WFDocLevelList[Q-1].IsPending=!0,this.ViewModel.WFDocLevelList[Q-1].Label=" P")}}}}else this.ViewModel.DocStatus="[UnPosted]",this.ViewModel.DocID=0,this.sDocNo="0",this.ViewModel.StatusID=0,this.ViewModel.PostVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete");this.CalculateTotalAmount()}this.ViewModel.EmployeeList.Code.SelectedValue=parseInt(u[0].EmpSeqNo),this.ViewModel.EmployeeList.Name.SelectedValue=parseInt(u[0].EmpSeqNo),this.ViewModel.DocID=parseInt(u[0].DocID),this.ViewModel.sVoucherNo=u[0].VoucherNo.toString()}else this.Clear_Click(),this.txtDocNo.Text=m.toString(),this.dtpDocDate.SetFocus=!0}Clear_Click(){this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&0==this.ViewModel.DocPrefix.Prefixes.length&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=0,this.EmpSeqNo=0,this.PrevEmpSeqNo=0,this.ViewModel.DocID=0,this.ClearControlValues(),this.ViewModel.sCmdParameter="",this.ViewModel.SelectedEmpID=0,this.dTotGratuityDays=0,null!=this.ViewModel&&null!=this.ViewModel.WFDocLevelList&&this.ViewModel.WFDocLevelList.Clear(),this.ViewModel.ApproveVisibility=!1,this.ViewModel.PostVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=b.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new pe.ViewAttachmentViewModel(this.ViewModel,b.d.SessionManager,b.d.admin),this.ViewModel.OnAddAttachment()}ClearControlValues(){this.dtEdit=null,this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="0",this.chkCalcBasedOnLastSal.Label="Calculate based on Last Salary",this.chkCalcBasedOnActDays.Label="Calculate Salary based on Actual Days",this.txtRemarks.Label=b.d.GetResource("Remarks"),this.txtRemarks.Text="",this.GratuityRemarks.Label=b.d.GetResource("Remarks"),this.GratuityRemarks.Text="",this.LeaveRemarks.Label=b.d.GetResource("Remarks"),this.LeaveRemarks.Text="",this.UPSRemarks.Label=b.d.GetResource("Remarks"),this.UPSRemarks.Text="",this.NoticePayRemarks.Label=b.d.GetResource("Remarks"),this.NoticePayRemarks.Text="",this.OAddRemarks.Label=b.d.GetResource("Remarks"),this.OAddRemarks.Text="",this.ODedRemarks.Label=b.d.GetResource("Remarks"),this.ODedRemarks.Text="",this.cmbSettlementType.SelectedIndex=0,this.LoanRemarks.Label=b.d.GetResource("Remarks"),this.LoanRemarks.Text="",this.dtpDocDate.Date=(new Date).Date(),this.cmbResignType.Label=b.d.GetResource("Resign Type"),this.cmbResignType.SelectedValue="Resigned",this.cmbResignReason.SelectedValue="",this.cmbResignReason.Label="Resign Reason",this.dblBasic=0,this.sDocNo="0",this.ViewModel.DocStatus="[UnPosted]",this.dGratuityTaken=0,this.dgvGratuity.Clear(),this.dgvLeaveEncash.Clear(),this.dgvUPS.Clear(),this.dgvOthAdd.Clear(),this.dgvOthDed.Clear(),this.dgvNoticePay.Clear(),this.dgvLoanBal.Clear(),this.txtGratuityAmount.Label=this.GetResource("Gratuity Amount",40095),this.txtGratuityAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtGratuityAmount.Align="right",this.txtAvailedGratuityAmount.Label=this.GetResource("Availed Gratuity Amount",40095),this.txtAvailedGratuityAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Align="right",this.txtPartialGratuityAmount.Label=this.GetResource("Partial Gratuity Amount",40095),this.txtPartialGratuityAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtPartialGratuityAmount.Align="right",this.txtCumLeaveSalBalAmt.Label=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.txtCumLeaveSalBalAmt.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtCumLeaveSalBalAmt.Align="right",this.txtLEAmount.Label=this.GetResource("Amount",40095),this.txtLEAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtLEAmount.Align="right",this.txtUPSAmount.Label=this.GetResource("Amount",40095),this.txtUPSAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtUPSAmount.Align="right",this.txtOthAddAmount.Label=this.GetResource("Amount",40095),this.txtOthAddAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtOthAddAmount.Align="right",this.txtOthDedAmount.Label=this.GetResource("Amount",40095),this.txtOthDedAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtOthDedAmount.Align="right",this.txtNPAmount.Label=this.GetResource("Amount",40095),this.txtNPAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtNPAmount.Align="right",this.txtLoanBalAmount.Label=this.GetResource("Amount",40095),this.txtLoanBalAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtLoanBalAmount.Align="right",this.txtNetAmount.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtNetAmount.Align="right",this.lblActRelievingDate="",null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new pe.ViewAttachmentViewModel(this.ViewModel,b.d.SessionManager,b.d.admin),this.ViewModel.OnAddAttachment(),this.setDefaultRows()}setDefaultRows(){this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd"),this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")}GetNextDocNo(){let m=b.d.common.GetDataTable("CRM017","");null!=m&&(this.txtDocNo.Text=m.length>0?e.J0.IsEmpty(m[0].CurrentCodeNumber)?"1":parseInt(m[0].CurrentCodeNumber).toString():"1")}Employee_SelectionChanged(m){if(this.EmpSeqNo==m)return;this.EmpSeqNo=m,this.ClearControlValues();let I,y=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.getMonth(),1),u=[];if(u.push(this.EmpSeqNo),u.push(this.ViewModel.DocID),u.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),u.push(y.ToString("dd/MMM/yyyy")),u.push(0),u.push(""),u.push(0),u.push(b.d.SessionManager.UserID),u.push(b.d.SessionManager.RoleID),u.push(b.d.SessionManager.LanguageID),this.dsD=b.d.common.GetDataSet_SP(u,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0)if(this.dsD.Tables.length>14&&this.dsD.Tables[14].length>0)this.ViewModel.DisplayMessage="Employee FinalSettlement is Already done @VoucherNo - "+this.dsD.Tables[14][0].VoucherNo.ToString(),this.ViewModel.MessageVisibility=!0;else if(this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=e.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.DOB=e.J0.ParseDate(this.dsD.Tables[0][0].DOB),this.cmbSettlementType.SelectedValue="Final",9e3!=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=Date.Today(),this.cmbResignType.SelectedValue=e.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==this.dsD.Tables[0][0].ResignStatus.toString()){let w=e.J0.ParseDate(this.dsD.Tables[0][0].DOResign),k=new Date,K=new Date,R=new Date,B={PayrollMonth:k,PayrollMonthStart:K,PayrollMonthEnd:R};e.J0.SetPayrollDate_1(w,B),k=B.PayrollMonth,K=B.PayrollMonthStart,R=B.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(w,B,this.EmpGrade),k=B.PayrollMonth,K=B.PayrollMonthStart,R=B.PayrollMonthEnd);let O=new Date(k.getFullYear(),k.getMonth(),1),L=new Date,$=O;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=b.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(b.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(L=O.AddMonths(parseInt(b.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=b.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(b.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(L=O.AddMonths(parseInt(b.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=b.d.SessionManager.Preferences.NPResignation&&parseInt(b.d.SessionManager.Preferences.NPResignation)>0&&(L=O.AddMonths(parseInt(b.d.SessionManager.Preferences.NPResignation)-1)),k=new Date,K=new Date,R=new Date,B={PayrollMonth:k,PayrollMonthStart:K,PayrollMonthEnd:R},e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,B),k=B.PayrollMonth,K=B.PayrollMonthStart,R=B.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,B,this.EmpGrade),k=B.PayrollMonth,K=B.PayrollMonthStart,R=B.PayrollMonthEnd);let z=new Date(k.getFullYear(),k.iMonth(),1);if(L<z)for(;L<z;)L=L.AddMonths(1);let oe=0;for(k=new Date,K=new Date,R=new Date;$<=L;){if(I=this.dsD.Tables[5].filter(Q=>Q.PayrollDate==$.ToString("dd/MMM/yyyy")),null==I||0==I.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=$.ToString("dd/MMM/yyyy"),"Actual Days"==b.d.SessionManager.Preferences.PayDays){let Q={PayrollMonth:k,PayrollMonthStart:K,PayrollMonthEnd:R};if(e.J0.SetPayrollDate_1($,Q),k=Q.PayrollMonth,K=Q.PayrollMonthStart,R=Q.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Le=0;Le=e.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),k,K,R),Le>0&&(e.J0.SetPayrollDate_1($,Q,Le),k=Q.PayrollMonth,K=Q.PayrollMonthStart,R=Q.PayrollMonthEnd)}oe=R.Subtract(K).Days+1}else oe=parseInt(b.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=oe,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1])}$=$.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&b.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==b.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let w=0,k=0;for(let K=0;K<this.dsD.Columns[8].length;K++)e.J0.IsEmpty(this.dsD.Tables[8][0][this.dsD.Columns[8][K]])||(w+=parseFloat(this.dsD.Tables[8][0][this.dsD.Columns[8][K]]));for(let K=0;K<this.dsD.Tables[9].length;K++)e.J0.IsEmpty(this.dsD.Tables[9][K].Amount)||(k+=parseFloat(this.dsD.Tables[9][K].Amount));this.txtCumLeaveSalBalAmt.Text=(w-k).ToString(b.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(b.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(b.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let w;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let k=0;k<this.dsD.Tables[4].length;k++)w=e.J0.ParseDate(this.dsD.Tables[4][k].PayrollMonth),this.dgvUPS.Table[k].dgColUPSPayrollMonth=w.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[k].dgColUPSMonthDays=w.DaysInMonth(),this.dgvUPS.Table[k].dgColUPSDaysAtt=0,this.dgvUPS.Table[k].dgColUPSLOP=0,this.dgvUPS.Table[k].dgColUPSNetSal=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[k].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[k])}let M=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let w=0;w<this.dsD.Tables[10].length;w++)this.dgvLoanBal.Table[w].dgColLoanBalSNo=(w+1).toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo=this.dsD.Tables[10][w].DocNo.toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][w].DocID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType=this.dsD.Tables[10][w].LoanType.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][w].LoanCompID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][w].ApprovedAmt).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][w].Paid).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][w].Balance).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalCalc="Pay",M+=parseFloat(this.dsD.Tables[10][w].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[w])}this.CalculateTotalAmount()}}AutoCalculateLeaveEncashment(){b.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==b.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&this.btnCalcLeaveEncash_Click()}RefreshLeaveEncashDetails(){if(this.EmpSeqNo>0&&(this.dgvLeaveEncash.Clear(),this.dsD.Tables[1].length>0)){this.dgvLeaveEncash.addEmptyRows(this.dsD.Tables[1].length);for(let m=0;m<this.dsD.Tables[1].length;m++){this.dgvLeaveEncash.Table[m+"_Tag"]=this.dsD.Tables[1][m].SNo.toString(),this.dgvLeaveEncash.Table[m].dgColLELeaveType=this.dsD.Tables[1][m].ComponentName.toString(),this.dgvLeaveEncash.Table[m].dgColLELeaveType_Tag=this.dsD.Tables[1][m].ComponentID.toString();let I=0,y=0;if(this.dsD.Tables[1][m].ComponentID.toString()==this.sVacTypeSeqNo)this.dgvLeaveEncash.Table[m].dgColLEAvailable=this.GetVacationAvailability(this.dtpDateOfRelieving.Date,parseInt(this.sVacTypeSeqNo));else{let u={dTaken:0,dAvail:0},M={dAvail:0};this.GetLeavesTaken1(this.dtpDateOfRelieving.Date,this.dtpDateOfJoining.Date,this.dsD.Tables[1][m].ComponentID.toString(),M),I=u.dTaken,y=u.dAvail,this.dgvLeaveEncash.Table[m].dgColLEAvailable=y}this.dgvLeaveEncash.Table[m].dgColLEMaxEncash=parseFloat(this.dgvLeaveEncash.Table[m].dgColLEAvailable)>parseFloat(this.dsD.Tables[1][m].MaxEncashDays)?this.dsD.Tables[1][m].MaxEncashDays.toString():this.dgvLeaveEncash.Table[m].dgColLEAvailable.toString(),this.dgvLeaveEncash.Table[m].dgColLEApplied=0,this.dgvLeaveEncash.Table[m].dgColLEAmount=(0).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.Table[m].dgColLEAmount_Tag=this.dsD.Tables[1][m].EncashFormula.toString(),b.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==b.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&(this.dgvLeaveEncash.Table[m].dgColLEApplied=this.dgvLeaveEncash.Table[m].dgColLEMaxEncash)}this.dgvLeaveEncash.Update()}}GetAvailableLeavesToEncash(m){m.SNo.toString();let u=m.ComponentID.toString();if(this.sVacTypeSeqNo!=u){let M=b.d.common.GetDataSet3("CRM022",this.dtpDocDate.Date.ToString("dd MMM yyyy"),new Date(this.dtpDocDate.Date.getFullYear(),parseInt(b.d.SessionManager.Preferences.LeaveYear.toString()),1).ToString("dd MMM yyyy"),this.EmpSeqNo+"~"+u);if(null!=M&&M.Tables.length>0&&M.Tables[0].length>0){let w=0,k=0,K=0;return M.Tables[1].length>0&&(k=parseFloat(M.Tables[1][0].NoOfDays.toString())),M.Tables[2].length>0&&(K=parseFloat(M.Tables[2][0].NoOfDays.toString())),w-k-K}return 0}try{return 0}catch(M){return this.ViewModel.DisplayMessage="Exception when Calculating Available leaves of Vacation Type",console.log(M),0}}GetVacationAvailability(m,I){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");let y=0,u=[];u.push(m.ToString("dd/MMM/yyyy")),u.push(this.EmpSeqNo),u.push(2),u.push(b.d.SessionManager.UserID),u.push(b.d.SessionManager.LanguageID);let M=b.d.common.GetDataSet_SP(u,"spPAY_GetRemainingVacationDays");if(null!=M&&M.Tables.length>0&&M.Tables[0].length>0){let w=M.Tables[0].filter(k=>k.LeaveType==I);null!=w&&w.length>0&&(y=parseFloat(w[0].AvlblDays))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),y.toString()}GetLeavesTaken(m,I,y,u){u.dTaken=u.dAvail=0;let M=[];M.push(m.ToString("dd/MMM/yyyy")),M.push(I.ToString("dd/MMM/yyyy")),M.push(this.EmpSeqNo),M.push(y),M.push("Both"),M.push(b.d.SessionManager.UserID),M.push(b.d.SessionManager.LanguageID);let w=b.d.common.GetDataSet_SP(M,"spPAY_ExtGetAvlblNoofDays");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(e.J0.IsEmpty(w.Tables[0][0].LeavesTaken)||(u.dTaken=parseFloat(w.Tables[0][0].LeavesTaken)),e.J0.IsEmpty(w.Tables[0][0].AvailableLeaves)||(u.dAvail=parseFloat(w.Tables[0][0].AvailableLeaves)))}GetLeavesTaken1(m,I,y,u){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken1()"),u.dAvail=0;let M=[];M.push(this.EmpSeqNo),M.push(y),M.push(m.ToString("dd/MMM/yyyy")),M.push(0),M.push(b.d.SessionManager.UserID),M.push(b.d.SessionManager.LanguageID),M.push(0);let w=b.d.common.GetDataSet_SP(M,"spPAY_ExtGetAssignedLeaves");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(e.J0.IsEmpty(null!=w.Tables[0][0].AvailableLeaves)||(u.dAvail=e.J0.DoubleTryParse(w.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}CalculateTotalAmount(){let m=0;m+="Partial"==this.cmbSettlementType.SelectedValue?parseFloat(this.txtPartialGratuityAmount.Text):parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken,m+=parseFloat(this.txtLEAmount.Text),m+=parseFloat(this.txtUPSAmount.Text),m+=parseFloat(this.txtOthAddAmount.Text),m-=parseFloat(this.txtOthDedAmount.Text),m+=parseFloat(this.txtNPAmount.Text),m-=parseFloat(this.txtLoanBalAmount.Text),this.txtNetAmount.Text=m.ToString(b.d.SessionManager.sPayrollDecimals)}GenerateSerialNos(m,I=""){for(let y=0;y<m.Table.length;y++)"dgvOthAdd"==I?m.Table[y].dgColOthAddSNo=y+1:m.Table[y].dgColOthDedSNo=y+1;m.invalidate()}LoadGrids(){let m;this.SetGridProperties(this.dgvLeaveEncash),m=new Z.O7,m.DisplayMember="dgColLELeaveType",m.Header=this.GetResource("Leave Type",40095),m.ReadOnly=!0,this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLELeaveType"),m=new Z.O7,m.DisplayMember="dgColLEAvailable",m.Header=this.GetResource("Available Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEAvailable"),m=new Z.O7,m.DisplayMember="dgColLEMaxEncash",m.Header=this.GetResource("Max Encash Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEMaxEncash"),m=new Z.O7,m.DisplayMember="dgColLEApplied",m.Header=this.GetResource("Applied Days",40095),m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEApplied"),m=new Z.O7,m.DisplayMember="dgColLEAmount",m.Header=this.GetResource("Encash Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEAmount"),this.SetGridProperties(this.dgvUPS),m=new Z.O7,m.DisplayMember="dgColUPSPayrollMonth",m.Header=this.GetResource("Payroll Month",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSPayrollMonth"),m=new Z.O7,m.DisplayMember="dgColUPSMonthDays",m.Header=this.GetResource("Month Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSMonthDays"),m=new Z.O7,m.DisplayMember="dgColUPSDaysAtt",m.Header=this.GetResource("Days Attended",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSDaysAtt"),m=new Z.O7,m.DisplayMember="dgColUPSLOP",m.Header=this.GetResource("LOP Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSLOP"),m=new Z.O7,m.DisplayMember="dgColUPSNetSal",m.Header=this.GetResource("Net Salary",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSNetSal"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColUPSCalc",m.Header=this.GetResource("Calculate",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvUPS_CellClick"),this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSCalc"),this.SetGridProperties(this.dgvNoticePay),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColNPType",m.DisplayMember="Name",m.ValueMember="Value",m.Header=this.GetResource("Type",40095);let I=new Array;I.push(Fe._p.ComboBoxItems_2("Add","Add")),I.push(Fe._p.ComboBoxItems_2("Subtract","Subtract")),I.push(Fe._p.ComboBoxItems_2("None","None")),m.ComboData=I,this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPType"),m=new Z.O7,m.DisplayMember="dgColNPPayrollMonth",m.Header=this.GetResource("Payroll Month",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPPayrollMonth"),m=new Z.O7,m.DisplayMember="dgColNPMonthDays",m.Header=this.GetResource("Month Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPMonthDays"),m=new Z.O7,m.DisplayMember="dgColNPDaysAtt",m.Header=this.GetResource("Days Attended",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPDaysAtt"),m=new Z.O7,m.DisplayMember="dgColNPLOP",m.Header=this.GetResource("LOP Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPLOP"),m=new Z.O7,m.DisplayMember="dgColNPNetSal",m.Header=this.GetResource("Net Salary",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPNetSal"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColNPCalc",m.Header=this.GetResource("Calculate",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvNoticePay_CellClick"),this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPCalc"),this.SetGridProperties(this.dgvOthAdd),m=new Z.O7,m.DisplayMember="dgColOthAddSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddSNo"),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColOthAddParticulars",m.DisplayMember="Name",m.ValueMember="NodeID",m.Header=this.GetResource("Particulars",40095),this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddParticulars"),m=new Z.O7,m.DisplayMember="dgColOthAddAmount",m.Header=this.GetResource("Amount",40095),m.TextAlign="Right",this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddAmount"),m=new Z.O7,m.DisplayMember="dgColOthAddRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddRemarks"),this.SetGridProperties(this.dgvOthDed),m=new Z.O7,m.DisplayMember="dgColOthDedSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedSNo"),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColOthDedParticulars",m.DisplayMember="Name",m.ValueMember="NodeID",m.Header=this.GetResource("Particulars",40095),this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedParticulars"),m=new Z.O7,m.DisplayMember="dgColOthDedAmount",m.Header=this.GetResource("Amount",40095),m.TextAlign="Right",this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedAmount"),m=new Z.O7,m.DisplayMember="dgColOthDedRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedRemarks"),this.SetGridProperties(this.dgvLoanBal),m=new Z.O7,m.DisplayMember="dgColLoanBalSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalSNo"),m=new Z.O7,m.DisplayMember="dgColLoanBalDocNo",m.Header=this.GetResource("Loan Doc. No.",40095),m.ReadOnly=!0,this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalDocNo"),m=new Z.O7,m.DisplayMember="dgColLoanBalLoanType",m.Header=this.GetResource("Loan Type",40095),m.ReadOnly=!0,this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalLoanType"),m=new Z.O7,m.DisplayMember="dgColLoanBalApprAmount",m.Header=this.GetResource("Approved Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalApprAmount"),m=new Z.O7,m.DisplayMember="dgColLoanBalAmountPaid",m.Header=this.GetResource("Amount Paid",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalAmountPaid"),m=new Z.O7,m.DisplayMember="dgColLoanBalBalAmount",m.Header=this.GetResource("Balance Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalBalAmount"),m=new Z.O7,m.DisplayMember="dgColLoanBalRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalRemarks"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColLoanBalCalc",m.Header=this.GetResource("Pay",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvLoanBal_CellClick"),this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalCalc")}SetGridProperties(m){m.Table=[],m.Columns=[]}Calculate_Click(m){switch(m){case"Gratuity":this.btnCalcGratuity_Click();break;case"LeaveEncash":this.btnCalcLeaveEncash_Click();break;case"Clear":this.Clear_Click();break;case"Save":this.Save_Click();break;case"Delete":this.Delete_Click();break;case"Previous":this.Previous_Click();break;case"Next":this.Next_Click();break;case"Approve":this.Approve_Click()}return""}Approve_Click(){let m=new C.a(this.CostCenterID,this.ViewModel.DocID,null,this.ViewModel);b.d.page.ShowDialog(m,ve.H,{ShowCenter:!0,Title:b.d.GetResource("ApproveReject")})}Next_Click(){if(""!=this.ViewModel.DocPrefix.TextBox.Text){let m=0;null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&""!=this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname&&(m=parseInt(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname));let I=(parseInt(this.ViewModel.DocPrefix.TextBox.Text)+1).ToString();for(;I.length<m;)I="0"+I;this.ViewModel.DocPrefix.TextBox.Text=I,this.LoadDocument(parseInt(I),this.Prefix)}}Previous_Click(){""!=this.ViewModel.DocPrefix.TextBox.Text&&(this.iCurDocNo=parseInt(this.ViewModel.DocPrefix.TextBox.Text.Trim()),this.iCurDocNo>1&&this.LoadDocument(this.iCurDocNo-1,this.Prefix))}Delete_Click(){if(""!=this.sDocNo&&parseInt(this.sDocNo)>0){if(confirm("Are you sure want to Delete.?")){let m=0,I=[];I.push(40095),I.push(this.ViewModel.DocID),I.push(1);let y=b.d.document.DeleteSelectedRows(I,m);this.ViewModel.DisplayMessage=y.Message,m=y.RetValue,this.ViewModel.MessageVisibility=!0,this.Clear_Click()}}else this.ViewModel.DisplayMessage="Select any saved Document to Delete",this.ViewModel.MessageVisibility=!0}Save_Click(){if(this.dgvOthAdd.angularGrid&&this.dgvOthAdd.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.dgvOthDed.angularGrid&&this.dgvOthDed.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.ValidateSave()){let m=[];m.push(this.CostCenterID),m.push(this.ViewModel.DocID),m.push(null!=this.Prefix?this.Prefix:""),m.push(null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:""),m.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),m.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),m.push(""),m.push(this.GetDocumentXML()),m.push(""),m.push(""),m.push(this.ViewModel.ViewAttachments.GetXML()),m.push(this.GetActivityXML()),m.push("false"),b.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==b.d.SessionManager.Preferences.EnableLocationWise.toString()?m.push(b.d.SessionManager.LocationID>0?b.d.SessionManager.LocationID:1):m.push(0),b.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==b.d.SessionManager.Preferences.EnableDivisionWise.toString()?m.push(b.d.SessionManager.DivisionID>0?b.d.SessionManager.DivisionID:1):m.push(0),m.push(this.ViewModel.WID),m.push(b.d.SessionManager.RoleID),m.push(""),m.push(0),m.push(0),m.push(b.d.SessionManager.CompanyGUID),m.push(b.d.SessionManager.UserName),m.push(b.d.SessionManager.UserID),m.push(b.d.SessionManager.LanguageID),m.push(b.d.SessionManager.IsOffline);let I=0,y="";b.d.document.SetTempInvDocument(m).subscribe(u=>{I=u.obj;let M=u;if(y=null!=M&&M.Tables.length>0&&M.Tables[M.Tables.length-1].length>0&&M.Columns[M.Tables.length-1].Contains("ErrorMessage")?M.Tables[M.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",I>0){let w=[];w.push(I),w.push(b.d.SessionManager.UserID),w.push(b.d.SessionManager.LanguageID);let k=this.ViewModel.PostApplyLeaves(parseInt(b.d.SessionManager.CompanyIndex),w,"spPAY_PostApplyLeaves");null!=k&&k.Tables.length>0&&(y="Problem in processing your request,Please contact administrator."),this.ViewModel.SelectedEmpID=this.EmpSeqNo,this.Clear_Click()}else null!=M&&M.Tables.length>0&&M.Tables[M.Tables.length-1].length>0&&M.Columns[M.Tables.length-1].Contains("ServerMessage")&&(I="-407"==M.Tables[M.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.ViewModel.DisplayMessage=y,this.ViewModel.MessageVisibility=!0})}}GetActivityXML(){let m='<XML  SysInfo="'+b.d.SessionManager.GetSysInfo()+'" AP="Desktop" ';return"Approve"==this.ViewModel.sCmdParameter&&(m+=' AppRejDate="'+Date.Today().ToString("dd/MMM/yyyy")+'"'),m+=" >",m+=" </XML> ",m}GetDocumentXML(){let R,I="",y="",u="",M="",w="",k="";if(new Array,null!=b.d.SessionManager.dtDocDefAccs&&(R=b.d.SessionManager.dtDocDefAccs.filter(B=>40095==B.CostCenterID&&"CreditAccount"==B.SysColumnName),null!=R&&R.length>0&&null!=R[0].UserDefaultValue&&""!=R[0].UserDefaultValue.toString().Trim()&&(w=R[0].UserDefaultValue.toString()),R=b.d.SessionManager.dtDocDefAccs.filter(B=>40095==B.CostCenterID&&"DebitAccount"==B.SysColumnName),null!=R&&R.length>0&&null!=R[0].UserDefaultValue&&""!=R[0].UserDefaultValue.toString().Trim()&&(k=R[0].UserDefaultValue.toString())),y+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="'+parseFloat(this.txtNetAmount.Text)+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+b.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+k+'" CreditAccount="'+w+'" CommonNarration="'+e.J0.EncodeXML(this.txtRemarks.Text),null!=this.dgvGratuity&&this.dgvGratuity.Table.length>0){let B=1;for(let O=0;O<this.dgvGratuity.Table.length;O++)I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Gratuity',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='1',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha4='"+this.lblGratuityServiceDays+"',",u+=" dcAlpha5='"+this.lblGratuityLOPDays+"',",u+=" dcAlpha6='"+this.lblGratuityBalDays+"',",u+=" dcAlpha7='"+this.lblGratuityTotalGrDays+"',",u+=" dcAlpha8='"+this.GratuityRemarks.Text+"',",u+=" dcAlpha9='"+this.GratuityGrade+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.cmbResignType.SelectedValue+"',",u+=" dcAlpha12='"+this.chkCalcBasedOnLastSal.IsChecked+"',",u+=" dcAlpha13='"+this.chkCalcBasedOnActDays.IsChecked+"',",u+=" dcAlpha14='"+this.lblGratuityTotalDays+"',",u+=" dcAlpha15='"+this.dgvGratuity.Table[O][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha16='"+this.dgvGratuity.Table[O+1][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha17='"+this.dgvGratuity.Table[O+1][this.dgvGratuity.TableColumns[4]]+"',",u+=" dcAlpha18='"+this.dgvGratuity.Table[O+2][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha19='"+this.dgvGratuity.Table[O+3][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha20='"+this.dgvGratuity.Table[O+3][this.dgvGratuity.TableColumns[4]]+"',",u+=" dcAlpha21='"+this.dgvGratuity.Table[O+5][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha22='"+this.dgvGratuity.Table[O+5][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha23='"+this.dgvGratuity.Table[O+5][this.dgvGratuity.TableColumns[3]]+"',",u+=" dcAlpha24='"+this.dgvGratuity.Table[O+6][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha25='"+this.dgvGratuity.Table[O+6][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha26='"+this.dgvGratuity.Table[O+6][this.dgvGratuity.TableColumns[3]]+"',",u+=" dcAlpha27='"+this.dgvGratuity.Table[O+6][this.dgvGratuity.TableColumns[5]]+"',",u+=" dcAlpha28='"+this.dgvGratuity.Table[O+6][this.dgvGratuity.TableColumns[7]]+"',",u+=" dcAlpha29='"+this.dgvGratuity.Table[O+7][this.dgvGratuity.TableColumns[5]]+"',",u+=" dcAlpha30='"+this.dgvGratuity.Table[O+3][this.dgvGratuity.TableColumns[6]]+"',",u+=" dcAlpha31='"+this.GratuityDocID+"',",u+=" dcAlpha32='"+this.lblGratuityTaken+"',",u+=" dcAlpha33='"+this.cmbResignReason.SelectedValue+"',",u+=" dcAlpha34='"+this.dgvGratuity.Table[O+1][this.dgvGratuity.TableColumns[6]]+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",O+=8,B++}if(null!=this.dgvLeaveEncash&&this.dgvLeaveEncash.Table.length>0){let B=1;for(let O=0;O<this.dgvLeaveEncash.Table.length;O++)0!=e.J0.Double(this.dgvLeaveEncash.Table[O].dgColLEAmount)&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leave Encashment',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",u+=" dcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",u+=" dcCalcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='2',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.LeaveRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvLeaveEncash.Table[O+"_Tag"].toString()+"',",u+=" dcAlpha12='"+this.dgvLeaveEncash.Table[O].dgColLELeaveType+"',",u+=" dcAlpha13='"+this.dgvLeaveEncash.Table[O].dgColLEAvailable+"',",u+=" dcAlpha14='"+this.dgvLeaveEncash.Table[O].dgColLEMaxEncash+"',",u+=" dcAlpha15='"+this.dgvLeaveEncash.Table[O].dgColLEApplied+"',",u+=" dcAlpha16='"+this.dgvLeaveEncash.Table[O].dgColLEAmount.toString().Replace(",","")+"',",u+=" dcAlpha17='"+this.chkLECalcBasedOnLastApprSerYearWise.IsChecked+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}if(null!=this.dgvUPS&&this.dgvUPS.Table.length>0){let B=1;for(let O=0;O<this.dgvUPS.Table.length;O++)e.J0.Double(this.dgvUPS.Table[O].dgColUPSNetSal)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Un-Processed Salary',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='3',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.UPSRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvUPS.Table[O].dgColUPSPayrollMonth+"',",u+=" dcAlpha12='"+this.dgvUPS.Table[O].dgColUPSMonthDays+"',",u+=" dcAlpha13='"+this.dgvUPS.Table[O].dgColUPSDaysAtt+"',",u+=" dcAlpha14='"+this.dgvUPS.Table[O].dgColUPSLOP+"',",u+=" dcAlpha15='"+this.dgvUPS.Table[O].dgColUPSNetSal.toString().Replace(",","")+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}if(null!=this.dgvNoticePay&&this.dgvNoticePay.Table.length>0){let B=1;for(let O=0;O<this.dgvNoticePay.Table.length;O++)e.J0.Double(this.dgvNoticePay.Table[O].dgColNPNetSal)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Notice Pay',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='4',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.NoticePayRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvNoticePay.Table[O].dgColNPPayrollMonth+"',",u+=" dcAlpha12='"+this.dgvNoticePay.Table[O].dgColNPMonthDays+"',",u+=" dcAlpha13='"+this.dgvNoticePay.Table[O].dgColNPDaysAtt+"',",u+=" dcAlpha14='"+this.dgvNoticePay.Table[O].dgColNPLOP+"',",u+=" dcAlpha15='"+this.dgvNoticePay.Table[O].dgColNPNetSal.toString().Replace(",","")+"',",u+=" dcAlpha16='"+this.dgvNoticePay.Table[O].dgColNPType+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}if(null!=this.dgvOthAdd&&this.dgvOthAdd.Table.length>0){let B=1;for(let O=0;O<this.dgvOthAdd.Table.length;O++)!e.J0.IsEmpty(this.dgvOthAdd.Table[O].dgColOthAddParticulars)&&e.J0.Double(this.dgvOthAdd.Table[O].dgColOthAddAmount)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Additions',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='5',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.OAddRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvOthAdd.Table[O].dgColOthAddParticulars+"',",u+=" dcAlpha12='"+this.dgvOthAdd.Table[O].dgColOthAddAmount.toString().Replace(",","")+"',",e.J0.IsEmpty(this.dgvOthAdd.Table[O].dgColOthAddRemarks)||(u+=" dcAlpha13='"+this.dgvOthAdd.Table[O].dgColOthAddRemarks+"',"),u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}if(null!=this.dgvOthDed&&this.dgvOthDed.Table.length>0){let B=1;for(let O=0;O<this.dgvOthDed.Table.length;O++)!e.J0.IsEmpty(this.dgvOthDed.Table[O].dgColOthDedParticulars)&&e.J0.Double(this.dgvOthDed.Table[O].dgColOthDedAmount)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Deductions',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='6',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.ODedRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvOthDed.Table[O].dgColOthDedParticulars+"',",u+=" dcAlpha12='"+this.dgvOthDed.Table[O].dgColOthDedAmount.toString().Replace(",","")+"',",null!=this.dgvOthDed.Table[O].dgColOthDedRemarks&&""!=this.dgvOthDed.Table[O].dgColOthDedRemarks.toString().Trim()&&(u+=" dcAlpha13='"+this.dgvOthDed.Table[O].dgColOthDedRemarks+"',"),u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}if(null!=this.dgvLoanBal&&this.dgvLoanBal.Table.length>0){let B=1;for(let O=0;O<this.dgvLoanBal.Table.length;O++)!e.J0.IsEmpty(this.dgvLoanBal.Table[O].dgColLoanBalDocNo_Tag)&&null!=this.dgvLoanBal.Table[O].dgColLoanBalCalc_Tag&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan Balances',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='7',",u+=" dcAlpha2='"+B+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.LoanRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvLoanBal.Table[O].dgColLoanBalDocNo+"',",u+=" dcAlpha12='"+this.dgvLoanBal.Table[O].dgColLoanBalDocNo_Tag+"',",u+=" dcAlpha13='"+this.dgvLoanBal.Table[O].dgColLoanBalLoanType_Tag+"',",u+=" dcAlpha14='"+this.dgvLoanBal.Table[O].dgColLoanBalApprAmount.toString().Replace(",","")+"',",u+=" dcAlpha15='"+this.dgvLoanBal.Table[O].dgColLoanBalAmountPaid.toString().Replace(",","")+"',",u+=" dcAlpha16='"+this.dgvLoanBal.Table[O].dgColLoanBalBalAmount.toString().Replace(",","")+"',",u+=" dcAlpha17='"+this.dgvLoanBal.Table[O].dgColLoanBalSNo_Tag+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",B++)}return I.toString()}GetCalcXML(){let m="";if(m+="<Rows>",this.dgvGratuity.Table.length>0){let I=1;for(let y=0;y<this.dgvGratuity.Table.length;y++)m+='<Row DType="1" SubDType="'+I+'" Field1="'+this.cmbResignType.SelectedValue+'" Field2="'+this.chkCalcBasedOnLastSal.IsChecked+'" Field3="'+this.chkCalcBasedOnActDays.IsChecked+'" Field4="'+this.lblGratuityTotalDays+'" Field5="'+this.dgvGratuity.Table[y][this.dgvGratuity.TableColumns[1]]+'" Field6="'+this.dgvGratuity.Table[y+1][this.dgvGratuity.TableColumns[2]]+'" Field7="'+this.dgvGratuity.Table[y+1][this.dgvGratuity.TableColumns[4]]+'" Field8="'+this.dgvGratuity.Table[y+2][this.dgvGratuity.TableColumns[1]]+'" Field9="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[1]]+'" Field10="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[4]]+'" Field11="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[1]]+'" Field12="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[2]]+'" Field13="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[3]]+'" Field14="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[1]]+'" Field15="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[2]]+'" Field16="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[3]]+'" Field17="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[5]]+'" Field18="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[7]]+'" Field19="'+this.dgvGratuity.Table[y+7][this.dgvGratuity.TableColumns[5]]+'" Field20="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[6]],m+='" />',y+=8,I++}if(this.dgvLeaveEncash.Table.length>0)for(let I=0;I<this.dgvLeaveEncash.Table.length;I++)0!=e.J0.Double(this.dgvLeaveEncash.Table[I].dgColLEAmount)&&(m+='<Row DType="2" SubDType="'+I+'1" Field1="'+this.dgvLeaveEncash.Table[I+"_Tag"].toString()+'" Field2="'+this.dgvLeaveEncash.Table[I].dgColLELeaveType+'" Field3="'+this.dgvLeaveEncash.Table[I].dgColLEAvailable+'" Field4="'+this.dgvLeaveEncash.Table[I].dgColLEMaxEncash+'" Field5="'+this.dgvLeaveEncash.Table[I].dgColLEApplied+'" Field6="'+this.dgvLeaveEncash.Table[I].dgColLEAmount,m+='" />');if(this.dgvUPS.Table.length>0)for(let I=0;I<this.dgvUPS.Table.length;I++)e.J0.Double(this.dgvUPS.Table[I].dgColUPSNetSal)>0&&(m+='<Row DType="3" SubDType="'+I+'1" Field1="'+this.dgvUPS.Table[I].dgColUPSPayrollMonth+'" Field2="'+this.dgvUPS.Table[I].dgColUPSMonthDays+'" Field3="'+this.dgvUPS.Table[I].dgColUPSDaysAtt+'" Field4="'+this.dgvUPS.Table[I].dgColUPSLOP+'" Field5="'+this.dgvUPS.Table[I].dgColUPSNetSal,m+='" />');if(this.dgvNoticePay.Table.length>0)for(let I=0;I<this.dgvNoticePay.Table.length;I++)e.J0.Double(this.dgvNoticePay.Table[I].dgColNPNetSal)>0&&(m+='<Row DType="4" SubDType="'+I+'1" Field1="'+this.dgvNoticePay.Table[I].dgColNPPayrollMonth+'" Field2="'+this.dgvNoticePay.Table[I].dgColNPMonthDays+'" Field3="'+this.dgvNoticePay.Table[I].dgColNPDaysAtt+'" Field4="'+this.dgvNoticePay.Table[I].dgColNPLOP+'" Field5="'+this.dgvNoticePay.Table[I].dgColNPNetSal+'" Field6="'+this.dgvNoticePay.Table[I].dgColNPType,m+='" />');if(this.dgvOthAdd.Table.length>0)for(let I=0;I<this.dgvOthAdd.Table.length;I++)!e.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddParticulars)&&e.J0.Double(this.dgvOthAdd.Table[I].dgColOthAddAmount)>0&&(m+='<Row DType="5" SubDType="'+I+'1" Field1="'+this.dgvOthAdd.Table[I].dgColOthAddParticulars+'" Field2="'+this.dgvOthAdd.Table[I].dgColOthAddAmount,e.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddRemarks)||(m+='" Field3="'+this.dgvOthAdd.Table[I].dgColOthAddRemarks),m+='" />');if(this.dgvOthDed.Table.length>0)for(let I=0;I<this.dgvOthDed.Table.length;I++)!e.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedParticulars)&&e.J0.Double(this.dgvOthDed.Table[I].dgColOthDedAmount)>0&&(m+='<Row DType="6" SubDType="'+I+'1" Field1="'+this.dgvOthDed.Table[I].dgColOthDedParticulars+'" Field2="'+this.dgvOthDed.Table[I].dgColOthDedAmount,e.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedRemarks)||(m+='" Field3="'+this.dgvOthDed.Table[I].dgColOthDedRemarks),m+='" />');if(this.dgvLoanBal.Table.length>0)for(let I=0;I<this.dgvLoanBal.Table.length;I++)e.J0.IsEmpty(this.dgvLoanBal.Table[I].dgColLoanBalDocNo_Tag)||(m+='<Row DType="7" SubDType="'+I+'1" Field1="'+this.dgvLoanBal.Table[I].dgColLoanBalDocNo+'" Field2="'+this.dgvLoanBal.Table[I].dgColLoanBalDocNo_Tag+'" Field3="'+this.dgvLoanBal.Table[I].dgColLoanBalLoanType_Tag+'" Field4="'+this.dgvLoanBal.Table[I].dgColLoanBalApprAmount+'" Field5="'+this.dgvLoanBal.Table[I].dgColLoanBalAmountPaid+'" Field6="'+this.dgvLoanBal.Table[I].dgColLoanBalBalAmount+'" Field7="'+this.dgvLoanBal.Table[I].dgColLoanBalSNo_Tag,m+='" />');return m+="</Rows>",m.toString()}ValidateSave(){if(0==this.EmpSeqNo)return this.ViewModel.DisplayMessage="Please Select Employee.",this.EmployeeList.SetFocus=!0,!1;if(null!=this.dsD&&this.dsD.Tables[0].length>0&&"Final"==this.cmbSettlementType.SelectedValue&&(9e3==e.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()||null==this.dsD.Tables[0][0].DORelieve.toString()||""==this.dsD.Tables[0][0].DORelieve.toString()||null==this.dsD.Tables[0][0].DORelieve||""==e.J0.String(this.dsD.Tables[0][0].ResignStatus)||"Posted"!=e.J0.String(this.dsD.Tables[0][0].ResignStatus)))return this.ViewModel.DisplayMessage="Selected Employee not yet Resigned, Please check",!1;let m=b.d.report.GetDataTable("FS001",this.EmpSeqNo.toString(),this.ViewModel.DocID.toString());if(null!=m&&m.length>0)return this.ViewModel.DisplayMessage="Cannot save the record, Employee FinalSettlement is Already done",this.ViewModel.MessageVisibility=!0,!1;if(("Final"==this.cmbSettlementType.SelectedValue||"Partial"==this.cmbSettlementType.SelectedValue&&b.d.SessionManager.Preferences.ContainsKey("PartialFinalSettlementMandatoryRepaymentofloan")&&"True"==b.d.SessionManager.Preferences.PartialFinalSettlementMandatoryRepaymentofloan.toString())&&this.dgvLoanBal.Table.length>0)for(let I=0;I<this.dgvLoanBal.Table.length;I++)if(e.J0.IsEmpty(this.dgvLoanBal.Table[I].dgColLoanBalCalc_Tag))return this.ViewModel.DisplayMessage="Please pay pending Loan Balance amounts.",!1;return null!=b.d.SessionManager.Preferences.PayrollProduct&&""!=b.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(b.d.SessionManager.Preferences.PayrollProduct)),0!=this.DefProdID||(this.ViewModel.DisplayMessage="Select any Default Payroll Product at Global Preferences",!1)}btnCalcGratuity_Click(){this.dgvGratuity.Columns.Clear(),this.dgvGratuity.TableColumns.Clear(),this.dgvGratuity.Clear();let m={dTotGratuitySal:0};if(this.dEarnedGrDays=0,this.isMaxDaysExceded=!1,this.dTotGratuityDays=0,!(this.EmpSeqNo>0))return this.ViewModel.DisplayMessage="Select any Employee",void(this.EmployeeList.SetFocus=!0);{let M=b.d.common.GetDataSet3("CRM023",this.EmpSeqNo.toString(),this.dtpDateOfRelieving.Date.Date().ToString("dd MMM yyyy"));if(null!=M&&M.Tables.length>0){if(this.isConsdExpiredupto=!1,4==this.cmbResignType.SelectedIndex&&M.Tables[0].length>0){let w=0;w=e.J0.IntTryParse(M.Tables[0][0].ConsdExpiredupto),w>0&&(this.dtpDateOfRelieving.Date=this.DOB.AddYears(w),this.isConsdExpiredupto=!0)}if(this.dLOPDays=0,this.dLOPDays=parseFloat(this.dsD.Tables[0][0].OPLOPDays),this.dShowBasicAs=0,null!=this.dsD&&this.dsD.Tables.length>15&&this.dsD.Tables[15].length>0){let w=this.dsD.Tables[15].filter(k=>"ShowBasicAs"==k.PrefName);if(null!=w&&w.length>0&&null!=w[0].PrefValue&&null!=w[0].PrefValue&&""!=w[0].PrefValue.toString()&&(this.dShowBasicAs=parseInt(w[0].PrefValue.toString())),null!=this.dShowBasicAs&&this.dShowBasicAs>0&&this.dsD.Tables.length>7&&this.dsD.Tables[7].length>0){let k=this.dsD.Tables[7].filter(K=>K.ComponentID==this.dShowBasicAs);null!=k&&k.length>0&&(this.sShowBasicAs="Earning"+k[0].SNo.toString())}}if(M.Tables[2].length>0)if(null!=this.dtEdit&&this.dtEdit.length>0){let w=this.dtEdit.filter(k=>"1"==k.dcAlpha1&&"1"==k.dcAlpha2);null!=w&&w.length>0&&(this.dGratuityTaken=parseFloat(""==e.J0.String(w[0].dcAlpha32)?"0":w[0].dcAlpha32))}else this.dGratuityTaken=parseFloat(M.Tables[2][0].GratuityTaken);if(!(M.Tables[0].length>0))return void(this.ViewModel.DisplayMessage="Gratuity settings not found for this Grade.");{this.EOS_ROffYear=e.J0.DoubleTryParse(M.Tables[0][0].ROffYear);let K,w=this.dtpDateOfJoining.Date.Date(),k=this.dtpDateOfRelieving.Date.Date();if(this.EOS_ROffYear>0){let c=0,g=0;if(e.J0.GetYearsMonthsDays(w,k,{iY22:0,iM22:c,iD22:g}),c>=this.EOS_ROffYear){let p=0;g>0?(p=12-c,k=k.AddMonths(p).AddDays(-g)):k=k.AddMonths(-c).AddDays(-g)}else k=k.AddMonths(-c).AddDays(-g)}if(this.LoadExperinceDaysData(this.lst,M.Tables[0],"Resigned"==this.cmbResignType.SelectedValue?0:"Expired"==this.cmbResignType.SelectedValue?2:1),this.GratuityDocID=parseInt(M.Tables[0][0].DocID),this.GratuityGrade=parseInt(M.Tables[0][0].GradeID),this.EOS_MaxDays=e.J0.Double(M.Tables[0][0].MaxDays),this.EOS_ExcludeLOP=M.Tables[0][0].ExcludeLOP.toString(),this.LopBasedOnLopLeave=M.Tables[0][0].LopBasedOnLopLeave.toString(),this.EOS_ROff=e.J0.Double(M.Tables[0][0].ROff),this.EOS_CalcBasedOn=M.Tables[0][0].CalcBasedOn.toString(),this.EOS_GratuityFormula=M.Tables[0][0].Formula.toString(),this.EOS_AvailedFormula=null!=M.Tables[0][0].AvailedFormula&&null!=M.Tables[0][0].AvailedFormula&&""!=M.Tables[0][0].AvailedFormula.toString().Trim()?M.Tables[0][0].AvailedFormula.toString():"GratuityAmount","Exclude at Last"==this.EOS_ExcludeLOP){this.EOS_ExcludeLOP="No";let h={PayrollMonth:I=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:u=new Date};e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,h),I=h.PayrollMonth,u=h.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,h,this.EmpGrade),I=h.PayrollMonth,u=h.PayrollMonthEnd);let c=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),g=I,D=0;if("LOP Leave"==this.LopBasedOnLopLeave)D=this.GetLOPDaysFromDoc(c,u),this.dLOPDays+=D;else{D=this.GetPreviousLOPDays(c,g),this.dLOPDays+=D;let p=b.d.common.GetDataSet3("CRM024",this.EmpSeqNo.toString(),c.ToString("dd/MMM/yyyy"),g.ToString("dd/MMM/yyyy"));null!=p&&p.Tables.length>0&&(p.Tables[0].length>0&&(this.dLOPDays+=parseFloat(p.Tables[0][0].LOP.toString())),p.Tables[1].length>0&&(this.dLOPDays-=parseFloat(p.Tables[1][0].LOP.toString())))}k=k.AddDays(-this.dLOPDays)}for(let h=0;h<8;h++)K=new Z.O7,K.DisplayMember="Column"+h,K.ReadOnly=!0,K.Header="",K.Width=0==h?150:80,this.dgvGratuity.Columns.push(K),this.dgvGratuity.TableColumns.push(K.DisplayMember);if(this.dgvGratuity.RefreshColumns(),this.dActServiceDays=k.Subtract(w).Days+1,"Service Days"==this.EOS_CalcBasedOn){if(this.dServiceDaysAfterLOP=0,"No"!=this.EOS_ExcludeLOP){var I,u;let D={PayrollMonth:I=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:u=new Date};e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,D),I=D.PayrollMonth,u=D.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,D,this.EmpGrade),I=D.PayrollMonth,u=D.PayrollMonthEnd);let p=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),t=I,T=0;if("LOP Leave"==this.LopBasedOnLopLeave)T=this.GetLOPDaysFromDoc(p,u),this.dLOPDays+=T;else{T=this.GetPreviousLOPDays(p,t),this.dLOPDays+=T;let P=b.d.common.GetDataSet3("CRM025",this.EmpSeqNo.toString(),p.ToString("dd/MMM/yyyy"),t.ToString("dd/MMM/yyyy"));null!=P&&P.Tables.length>0&&P.Tables[0].length>0&&(this.dLOPDays+=parseFloat(P.Tables[0][0].LOP.toString()))}}this.dServiceDaysAfterLOP=this.dActServiceDays-this.dLOPDays,this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("ServiceDays",this.dActServiceDays.toString()),this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("LOPDays",this.dLOPDays.toString()),this.EOS_AvailedFormula=this.EOS_AvailedFormula.Replace("ServiceDays",this.dActServiceDays.toString())}this.dblGratuityAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.dShowBasicAs>0&&(this.dShowBasicAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1][this.sShowBasicAs]));let R=this.dtpDateOfJoining.Date.Date(),B=this.dtpDateOfRelieving.Date.Date(),O=0,L=0,$=0,z={iY:O,iM:L,iD:$};if(e.J0.GetYearsMonthsDays(R,B,z),O=z.iY,L=z.iM,$=z.iD,"Service Days"==this.EOS_CalcBasedOn){this.CalcGratuityBasedOnServiceDays(this.dblGratuityAmount,w,k,m,this.dShowBasicAmount);let h=0,c=0,g=0,D={iY:h,iM:c,iD:g};e.J0.GetYearsMonthsDays(w,k,D),h=D.iY,c=D.iM,g=D.iD,this.lblGratuityTotalDays=h+" : "+this.GetResource("Years",40095)+", "+c+" : "+this.GetResource("Months",40095)+", "+g+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=m.dTotGratuitySal.ToString(b.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount(),this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let p={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),p),this.oEvalPayFormulas.PayrollMonth=p.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=p.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=p.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),D,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=p.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=p.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=p.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new Ae.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),M.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(M.Tables[1].length);for(let t=0;t<M.Tables[1].length;t++)this.oCPF=new Ae.ph,this.oCPF.ComponentName="Lookup"+M.Tables[1][t].NodeID.toString(),this.oCPF.SNo=t+1,null!=M.Tables[0][0][M.Tables[1][t].SysColumnName.toString()]&&null!=M.Tables[0][0][M.Tables[1][t].SysColumnName.toString()]&&(this.oCPF.Formula=M.Tables[0][0][M.Tables[1][t].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[t].dgColOthAddParticulars=parseInt(M.Tables[1][t].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[t])}this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=O,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let t=0;t<this.oEvalPayFormulas.arrLstCPFields[6].length;t++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][t].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(b.d.SessionManager.sPayrollDecimals):(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][t].dEarned).ToString(b.d.SessionManager.sPayrollDecimals);else for(let T=0;T<this.dgvOthAdd.Table.length;T++)if(this.oEvalPayFormulas.arrLstCPFields[6][t].ComponentName=="Lookup"+e.J0.String(this.dgvOthAdd.Table[T].dgColOthAddParticulars)){this.dgvOthAdd.Table[T].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][t].dEarned).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[T]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}return}let Q,oe=w,Oe=0,Ge=0,Re=0,Te={iY:Oe,iM:Ge,iD:Re};e.J0.GetYearsMonthsDays(w,k,Te),Oe=Te.iY,Ge=Te.iM,Re=Te.iD;let Pe=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked,et=this.dblGratuityAmount,fe=new Array,G=new Array,a=new Array;fe.push(oe);for(let h=0;h<this.lst.length;h++){if(Oe<parseInt(this.lst[h].Year.Replace("=",""))){G.push(k),a.push(a.length>0?a[a.length-1]:0);break}if(this.lst[h].Days>0){if(this.lst[h].IsApplyToPrevYrs)for(let c=0;c<a.length;c++)a[c]=this.lst[h].Days;if(Q=oe.AddYears(parseInt(this.lst[h].Year.Replace("=",""))).AddDays(-1),Q>=k){Q=k,G.push(Q),a.push(this.lst[h].Days);break}a.Contains(this.lst[h].Days)?(G[G.length-1]=Q,fe[fe.length-1]=Q.AddDays(1)):(a.push(this.lst[h].Days),G.push(Q),fe.push(Q.AddDays(1)))}}if(this.isLast=!1,fe.length>0)for(let h=0;h<fe.length;h++)if(h==fe.length-1&&(this.isLast=!0),Pe){if(fe.length>h+1)if(a[h]!=a[h+1]){if(this.CalcGratuityDays(a[h],et,fe[h],G[h],this.dShowBasicAmount,m),this.isMaxDaysExceded)break}else G[h]=G[h+1],fe.RemoveAt(h+1),G.RemoveAt(h+1),a.RemoveAt(h+1),h--;else if(this.isConsdExpiredupto){if(this.CalcGratuityDays(a[h],et,fe[h],this.dtActRelievingDate,this.dShowBasicAmount,m),this.isMaxDaysExceded||(this.CalcGratuityDays(a[h],et,this.dtActRelievingDate.AddDays(1),G[h],this.dShowBasicAmount,m),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(a[h],et,fe[h],G[h],this.dShowBasicAmount,m),this.isMaxDaysExceded)break}else{let c=0;if(fe.length>h+1)if(a[h]!=a[h+1]){let g=this.dsD.Tables[3].filter(p=>e.J0.ParseDate(p.dtEffectFrom)>=fe[h].AddDays(1)&&e.J0.ParseDate(p.dtEffectFrom)<=G[h]),D=this.dsD.Tables[3].filter(p=>e.J0.ParseDate(p.dtEffectFrom)<=fe[h]);if(D.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=g&&g.length>0){let t,p=0;for(p=0;p<g.length;p++)if(0==p){if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(D[0][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(D[0].BasicMonthly),fe[h],e.J0.ParseDate(g[p].dtEffectFrom).AddDays(-1),c,m),this.isMaxDaysExceded){t=!0;break}}else if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(g[p-1][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(g[p-1].BasicMonthly),e.J0.ParseDate(g[p-1].dtEffectFrom),e.J0.ParseDate(g[p].dtEffectFrom).AddDays(-1),c,m),this.isMaxDaysExceded){t=!0;break}if(t||(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(g[p-1][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(g[p-1].BasicMonthly),e.J0.ParseDate(g[p-1].dtEffectFrom),G[h],c,m),this.isMaxDaysExceded))break}else if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(D[0][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(D[0].BasicMonthly),fe[h],G[h],c,m),this.isMaxDaysExceded)break}else G[h]=G[h+1],fe.RemoveAt(h+1),G.RemoveAt(h+1),a.RemoveAt(h+1),h--;else{let g=this.dsD.Tables[3].filter(p=>e.J0.ParseDate(p.dtEffectFrom)>=fe[h].AddDays(1)&&e.J0.ParseDate(p.dtEffectFrom)<=G[h]),D=this.dsD.Tables[3].filter(p=>e.J0.ParseDate(p.dtEffectFrom)<=fe[h]);if(D.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=g&&g.length>0){let t,p=0;for(p=0;p<g.length;p++)if(0==p){if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(D[0][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(D[0].BasicMonthly),fe[h],e.J0.ParseDate(g[p].dtEffectFrom).AddDays(-1),c,m),this.isMaxDaysExceded){t=!0;break}}else if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(g[p-1][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(g[p-1].BasicMonthly),e.J0.ParseDate(g[p-1].dtEffectFrom),e.J0.ParseDate(g[p].dtEffectFrom).AddDays(-1),c,m),this.isMaxDaysExceded){t=!0;break}if(t||(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(g[p-1][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(g[p-1].BasicMonthly),e.J0.ParseDate(g[p-1].dtEffectFrom),G[h],c,m),this.isMaxDaysExceded))break}else if(c=0,this.dShowBasicAs>0&&this.dsD.Columns[3].Contains(this.sShowBasicAs)&&(c=parseFloat(D[0][this.sShowBasicAs])),this.CalcGratuityDays(a[h],parseFloat(D[0].BasicMonthly),fe[h],G[h],c,m),this.isMaxDaysExceded)break}}let l=0,s=0,i=0,n={iY:l,iM:s,iD:i};e.J0.GetYearsMonthsDays(w,k,n),l=n.iY,s=n.iM,i=n.iD,this.lblGratuityTotalDays=l+" : "+this.GetResource("Years",40095)+", "+s+" : "+this.GetResource("Months",40095)+", "+i+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=m.dTotGratuitySal.ToString(b.d.SessionManager.sPayrollDecimals);let d=this.dtpDateOfRelieving.Date.Date().Subtract(w.Date()).Days+1;if(this.lblGratuityServiceDays=d.toString(),this.lblGratuityLOPDays=this.dLOPDays.toString(),this.lblGratuityBalDays=(d-this.dLOPDays).toString(),this.lblGratuityTotalGrDays=this.dTotGratuityDays.toString(),this.lblGratuityTaken=this.dGratuityTaken.toString(),this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),z={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z),this.oEvalPayFormulas.PayrollMonth=z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=z.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=z.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new Ae.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),M.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(M.Tables[1].length);for(let h=0;h<M.Tables[1].length;h++)this.oCPF=new Ae.ph,this.oCPF.ComponentName="Lookup"+M.Tables[1][h].NodeID.toString(),this.oCPF.SNo=h+1,e.J0.IsEmpty(M.Tables[0][0][M.Tables[1][h].SysColumnName.toString()])||(this.oCPF.Formula=M.Tables[0][0][M.Tables[1][h].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[h].dgColOthAddParticulars=parseInt(M.Tables[1][h].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[h])}this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=O,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let h=0;h<this.oEvalPayFormulas.arrLstCPFields[6].length;h++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][h].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(b.d.SessionManager.sPayrollDecimals):(0).ToString(b.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][h].dEarned).ToString(b.d.SessionManager.sPayrollDecimals);else for(let c=0;c<this.dgvOthAdd.Table.length;c++)if(this.oEvalPayFormulas.arrLstCPFields[6][h].ComponentName=="Lookup"+e.J0.String(this.dgvOthAdd.Table[c].dgColOthAddParticulars)){this.dgvOthAdd.Table[c].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][h].dEarned).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[c]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}}}}this.CalculateTotalAmount()}LoadExperinceDaysData(m,I,y){m.Clear();let u="Res";1==y?u="Term":2==y&&(u="Expired");for(let M=0;M<I.length;M++)m.push(new ha),m[M].Year=I[M][u+"Exp"].toString().Contains("+")?I[M][u+"Exp"].toString().Replace("[+]",""):"="+I[M][u+"Exp"].toString(),m[M].Days=parseFloat(I[M][u+"GrDays"]),m[M].IsApplyToPrevYrs="Yes"==I[M][u+"ApplyPrevYrs"].toString()}CalcGratuityDays(m,I,y,u,M,w){this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity/Year",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=m;let k=m,K="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),K=this.GetResource("Start Date",40095)+y.ToString("dd/MMM/yyyy")+"          ",K+=this.GetResource("End Date",40095)+u.ToString("dd/MMM/yyyy");let B=0,O=0,L=0,$=this.dtpDateOfJoining.Date.Date(),z=this.dtpDateOfRelieving.Date.Date(),oe=0,Q=0,Le=0,Me={iY:oe,iM:Q,iD:Le};e.J0.GetYearsMonthsDays($,u,Me),oe=Me.iY,Q=Me.iM,Le=Me.iD;let Oe=0,Ge=0,Re=0,Te={iY:Oe,iM:Ge,iD:Re};e.J0.GetYearsMonthsDays(y,u,Te),Oe=Te.iY,Ge=Te.iM,Re=Te.iD;let Pe=0;if("No"!=this.EOS_ExcludeLOP){var Ze=new Date,et=new Date,fe=new Date,G={PayrollMonth:Ze,PayrollMonthStart:et,PayrollMonthEnd:fe};if(e.J0.SetPayrollDate_1(u,G),Ze=G.PayrollMonth,et=G.PayrollMonthStart,fe=G.PayrollMonthEnd,b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(e.J0.SetPayrollDate_1(u,G,this.EmpGrade),Ze=G.PayrollMonth,et=G.PayrollMonthStart,fe=G.PayrollMonthEnd),"LOP Leave"==this.LopBasedOnLopLeave)Pe=this.GetLOPDaysFromDoc(y,u);else{Pe=this.GetPreviousLOPDays(y,Ze);let D=b.d.common.GetDataSet3("CRM026",this.EmpSeqNo.toString(),y.ToString("dd/MMM/yyyy"),Ze.ToString("dd/MMM/yyyy"));null!=D&&D.Tables.length>0&&D.Tables[0].length>0&&(Pe+=parseFloat(D.Tables[0][0].LOP.toString()))}let c=u;c=y==this.dtpDateOfJoining.Date.Date()?c.AddDays(-(this.dLOPDays+Pe)):c.AddDays(-Pe);let g={iY:Oe,iM:Ge,iD:Re};e.J0.GetYearsMonthsDays(y,c,g),Oe=g.iY,Ge=g.iM,Re=g.iD,this.dLOPDays+=Pe}B=Oe*k,O=Ge/12*k,L=Re/365*k,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=y.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=u.ToString("dd/MMM/yyyy"),"Exclude at Last"==this.ActEOS_ExcludeLOP&&u.ToString("dd MMM yyyy")==z.AddDays(-this.dLOPDays).ToString("dd MMM yyyy")&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Actual End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=z.ToString("dd/MMM/yyyy"));let a=!!this.chkCalcBasedOnActDays.IsChecked&&this.chkCalcBasedOnActDays.IsChecked,l=0,s=0,i=0;if(a){let D,c=y,g=u,p=0,t=0;for(;c<=g;){if(D=new Date(c.getFullYear(),c.getMonth(),c.DaysInMonth()),!(D<=g)){p=g.Subtract(c).Days+1,s+=p,t=I*p/D.getDate(),i+=t;break}p=D.Subtract(c).Days+1,s+=p,t=I*p/D.getDate(),i+=t,c=D.AddDays(1)}l=i/s}let n=u.Subtract(y).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let d=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dShowBasicAs>0?M:I,d=I,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=Oe+" : "+this.GetResource("Years",40095)+", "+Ge+" : "+this.GetResource("Months",40095)+", "+Re+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=n,"Exclude at Last"==this.ActEOS_ExcludeLOP?this.isLast&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Total LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=this.dLOPDays):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=Pe),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("Months",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=Oe,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=Ge,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=Re,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Available Gratuity",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=B,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=O,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=L;let h=B+O+L;if(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=h,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",h=U.RoundOffValue(h,this.EOS_ROff),this.EOS_MaxDays>0&&this.dEarnedGrDays+h>=this.EOS_MaxDays?(h=this.EOS_MaxDays-this.dEarnedGrDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=h,this.isMaxDaysExceded=!0):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=h,this.dEarnedGrDays+=h),this.dTotGratuityDays+=h,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity",40095),a)this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=i+" / "+s,d=l*h;else{let c=this.dtpDateOfJoining.Date.Date(),g=this.dtpDateOfRelieving.Date.Date(),D=0,p=0,t=0,T={iY:D,iM:p,iD:t};e.J0.GetYearsMonthsDays(c,g,T),D=T.iY,p=T.iM,t=T.iD;let P=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked;this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),T={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},P?(e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),T),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),T,this.EmpGrade)):(e.J0.SetPayrollDate_1(y.Date(),T),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&e.J0.SetPayrollDate_1(y.Date(),T,this.EmpGrade)),this.oEvalPayFormulas.PayrollMonth=T.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=T.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=T.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new Ae.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula.Replace("GratuityDays",h.toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=I,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=D,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let A=0;A<this.oEvalPayFormulas.arrLstCPFields[6].length;A++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][A].ComponentName){d=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][A].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=d,w.dTotGratuitySal+=d,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.refreshDataView()}GetPreviousLOPDays(m,I){let y=0,u=b.d.common.GetDataSet3("CRM027",this.EmpSeqNo.toString(),m.ToString("dd/MMM/yyyy"),I.ToString("dd/MMM/yyyy")).Tables[0];return null!=u&&u.length>0&&(y=parseFloat(u[0].LOPDays)),y}GetLOPDaysFromDoc(m,I){let y=0;if(b.d.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=b.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){let u=[];u.push(this.EmpSeqNo),u.push(m.ToString("dd/MMM/yyyy")),u.push(m.ToString("dd/MMM/yyyy")),u.push(I.ToString("dd/MMM/yyyy")),u.push(2),u.push(b.d.SessionManager.UserID),u.push(b.d.SessionManager.RoleID),u.push(b.d.SessionManager.LanguageID);let M=b.d.common.GetDataSet_SP(u,"spPAY_GetEmpAdjDetailsMultiple"),w=[];w.push(m.ToString("dd MMM yyyy")),w.push(""),w.push(0),w.push(b.d.SessionManager.RoleID),w.push(b.d.SessionManager.UserID),w.push(b.d.SessionManager.LanguageID);let k=b.d.common.GetDataSet_SP(w,"spPAY_GetEmpMasterCCDetails");null!=M&&M.Tables.length>0&&M.Tables[0].length>0&&M.Columns[0].Contains("EmpSeqNo")&&(y=this.AggregateLeaves(this.EmpSeqNo.toString(),M,m,I,k,this.dsD.Tables[0],this.EmpGrade))}return y}static RoundOffValue(m,I){if(I>0&&m>0){let y=0,u=!1;y=m%I,y>0&&(I/y<=2&&(u=!0),m-=y,u&&(m+=I))}return m}CalcGratuityBasedOnServiceDays(m,I,y,u,M){this.dgvGratuity.addEmptyRow();let w="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),w=this.GetResource("Start Date",40095)+I.ToString("dd/MMM/yyyy")+"          ",w+=this.GetResource("End Date",40095)+y.ToString("dd/MMM/yyyy");let k=0,K=0,R=0,B={iY:k,iM:K,iD:R};e.J0.GetYearsMonthsDays(I,y,B),k=B.iY,K=B.iM,R=B.iD,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=I.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=y.ToString("dd/MMM/yyyy");let O=y.Subtract(I).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let L=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dShowBasicAs>0?M:m,L=m,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=k+" : "+this.GetResource("Years",40095)+", "+K+" : "+this.GetResource("Months",40095)+", "+R+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=O,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Total Duration Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Service Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dActServiceDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.dLOPDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.dServiceDaysAfterLOP,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dServiceDaysAfterLOP,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]="/",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]="365";let $=this.dServiceDaysAfterLOP/365;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=$,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=$,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity Amount",40095);{this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let z={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=z.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new Ae.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=m,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=k,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let oe=0;oe<this.oEvalPayFormulas.arrLstCPFields[6].length;oe++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][oe].ComponentName){this.dServiceDaysFormulaAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][oe].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.dServiceDaysFormulaAmount,u.dTotGratuitySal+=this.dServiceDaysFormulaAmount,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]="* * * * *"}dgvLeaveEncash_CellValidating(m,I){}btnCalcLeaveEncash_Click(){let m=this.chkLECalcBasedOnLastApprSerYearWise.IsChecked;this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let I={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),I),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&e.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),I,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=I.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=I.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=I.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear();let y=0;if(this.dgvLeaveEncash.Table.length>0){for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)m&&this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag==this.sVacTypeSeqNo||e.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEApplied)||(e.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag)||(this.strFormula=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays",this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag==this.sVacTypeSeqNo?"("+this.dgvLeaveEncash.Table[M].dgColLEApplied.toString()+")":"("+this.dgvLeaveEncash.Table[M].dgColLEApplied.toString().Replace("-","!")+")"),this.oCPF=new Ae.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[M+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF));this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas();for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)if((!m||this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag!=this.sVacTypeSeqNo)&&0!=e.J0.Double(this.dgvLeaveEncash.Table[M].dgColLEApplied))for(let w=0;w<this.oEvalPayFormulas.arrLstCPFields[6].length;w++)if(this.oEvalPayFormulas.arrLstCPFields[6][w].ComponentName=="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString()){this.dgvLeaveEncash.Table[M].dgColLEAmount=this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned,y+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned);break}}let u=0;if(m&&this.dgvLeaveEncash.Table.length>0)for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)if(this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag.toString()==this.sVacTypeSeqNo){if(!e.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEApplied)&&parseFloat(this.dgvLeaveEncash.Table[M].dgColLEApplied)>0){let B,O,k=parseFloat(this.dgvLeaveEncash.Table[M].dgColLEApplied),K=0,R=null;try{B=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate())}catch{B=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate()-1)}for(B>this.dtpDateOfRelieving.Date&&(B=B.AddYears(-1)),O=this.dtpDateOfRelieving.Date;k>0;){R=this.ViewModel.GetVacationDays(B,O,this.EmpSeqNo),K=parseFloat(R.Tables[1][0].CreditedDays),K>k&&(K=k),this.oEvalPayFormulas=new Ae.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let L={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};e.J0.SetPayrollDate_1(O,L),b.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==b.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&e.J0.SetPayrollDate_1(O,L,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=L.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=L.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=L.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),null!=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag&&""!=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString().Trim()&&(this.strFormula=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+K.toString().Replace("-","!")+")"),this.oCPF=new Ae.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[M+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.oEvalPayFormulas.dsAllEmpsData.Tables[2][this.dsD.Tables[2].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),u+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned),k=parseFloat((k-K).ToString("0.00")),O=B.AddDays(-1),B=B.AddYears(-1)}this.dgvLeaveEncash.Table[M].dgColLEAmount=u}break}this.txtLEAmount.Text=(parseFloat(this.txtCumLeaveSalBalAmt.Text)+y+u).ToString(b.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.invalidate(),this.CalculateTotalAmount()}dgvUPS_CellClick(m,I){if("dgColUPSCalc"==this.dgvUPS.Columns[m.cell].DisplayMember){e.J0.SetPayrollMonth(e.J0.ParseDate(this.dgvUPS.Table[m.row].dgColUPSPayrollMonth));let y=new Qe.MonthlyPayrollViewModel("Monthly Payroll","UnProcessed");y.sProcessType="UnProcessed",y.SelectedEmpID=this.EmpSeqNo,y.EmployeeList.Code.SelectedValue=y.EmployeeList.Name.SelectedValue=this.EmpSeqNo,y.EmployeeList.Code.Text=y.EmployeeList.Name.Text=this.EmployeeList.Text,y.InitSelectedEmployee(),b.d.page.ShowDialog(y,se.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{y.DialogResult&&(this.dgvUPS.Table[m.row].dgColUPSDaysAtt=y.dFS_DaysAttended,this.dgvUPS.Table[m.row].dgColUPSLOP=y.dFS_LOPDays,this.dgvUPS.Table[m.row].dgColUPSNetSal=y.dFS_NetSal,this.dgvUPS.updateRow(this.dgvUPS[m.row]));let u=0;if(this.dgvUPS.Table.length>0)for(let M=0;M<this.dgvUPS.Table.length;M++)u+=parseFloat(this.dgvUPS.Table[M].dgColUPSNetSal);this.txtUPSAmount.Text=u.ToString(b.d.SessionManager.sPayrollDecimals),this.dgvUPS.invalidate(),this.CalculateTotalAmount()})}}dgvNoticePay_CellClick(m,I){if("dgColNPCalc"==this.dgvNoticePay.Columns[m.cell].DisplayMember){e.J0.SetPayrollMonth(e.J0.ParseDate(this.dgvNoticePay.Table[m.row].dgColNPPayrollMonth));let y=new Qe.MonthlyPayrollViewModel("Monthly Payroll","NoticePay");y.sProcessType="NoticePay",y.SelectedEmpID=this.EmpSeqNo,y.EmployeeList.Code.SelectedValue=y.EmployeeList.Name.SelectedValue=this.EmpSeqNo,y.EmployeeList.Code.Text=y.EmployeeList.Name.Text=this.EmployeeList.Text,y.InitSelectedEmployee(),b.d.page.ShowDialog(y,se.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{y.DialogResult&&(this.dgvNoticePay.Table[m.row].dgColNPDaysAtt=y.dFS_DaysAttended,this.dgvNoticePay.Table[m.row].dgColNPLOP=y.dFS_LOPDays,this.dgvNoticePay.Table[m.row].dgColNPNetSal=y.dFS_NetSal,this.dgvNoticePay.updateRow(this.dgvNoticePay[m.row])),this.dgvNoticePay.Update(),this.CalculateNoticePayAmount()})}}CalculateNoticePayAmount(){let m=0;if(this.dgvNoticePay.Table.length>0)for(let I=0;I<this.dgvNoticePay.Table.length;I++)"Add"==e.J0.String(this.dgvNoticePay.Table[I].dgColNPType)?m+=parseFloat(this.dgvNoticePay.Table[I].dgColNPNetSal):"Subtract"==e.J0.String(this.dgvNoticePay.Table[I].dgColNPType)&&(m-=parseFloat(this.dgvNoticePay.Table[I].dgColNPNetSal));this.txtNPAmount.Text=m.ToString(b.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthAdd_CellEndEdit(m,I){null==I&&(I=m.cell),"dgColOthAddAmount"==this.dgvOthAdd.Columns[I].DisplayMember&&(this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd")),"dgColOthAddAmount"==this.dgvOthAdd.Columns[I].DisplayMember&&this.CalculateOthAddAmount()}dgvOthAdd_RowsAdded(m,I){this.GenerateSerialNos(this.dgvOthAdd)}CalculateOthAddAmount(){let m=0;for(let I=0;I<this.dgvOthAdd.Table.length;I++)e.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddAmount)||(m+=parseFloat(this.dgvOthAdd.Table[I].dgColOthAddAmount));this.txtOthAddAmount.Text=m.ToString(b.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthDed_CellEndEdit(m,I){null==I&&(I=m.cell),"dgColOthDedAmount"==this.dgvOthDed.Columns[I].DisplayMember&&(this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")),"dgColOthDedAmount"==this.dgvOthDed.Columns[I].DisplayMember&&this.CalculateOthDedAmount()}dgvOthDed_RowsAdded(m,I){this.GenerateSerialNos(this.dgvOthDed)}CalculateOthDedAmount(){let m=0;for(let I=0;I<this.dgvOthDed.Table.length;I++)e.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedAmount)||(m+=parseFloat(this.dgvOthDed.Table[I].dgColOthDedAmount));this.txtOthDedAmount.Text=m.ToString(b.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dtpDateOfRelieving_SelectedDateChanged(m,I){this.PrevEmpSeqNo==this.EmpSeqNo&&0==e.J0.GetDateDifference(this.dtpDateOfRelieving.Date,this.dtPrevDateOfRelieving)||(this.PrevEmpSeqNo=this.EmpSeqNo,this.dtPrevDateOfRelieving=this.dtpDateOfRelieving.Date,this.RefreshLeaveEncashDetails())}btnSaveAndPrint_Click(m){this.ViewModel.SelectedEmpID>0?(this.Save_Click(),this.ViewModel.IsSaved&&this.ViewModel.DocID>0&&(this.PrintFS("SaveAndPrint"),this.ViewModel.IsSaved=!1,this.ViewModel.SelectedEmpID=0)):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrint_Click(m){return this.ViewModel.DocID>0?(this.PrintFS("Print"),""):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0,"")}PrintFS(m){this.MoreThanOneLayout=!1;let y=this.ViewModel.DocID;this.IsExportPrint=!1;let u=null,M=at.VoucherExportExcel.GetLocationPrintLayouts(50051,0,y);if(this.IsExportPrint)u=null;else{if(null==M||0==M.Tables[0].length)return b.d.GetResource("Err_PrintLayoutNotDefined");if(M.Tables[0].length>1){this.MoreThanOneLayout=!0;let w=new At.VPTDialogViewModel(M.Tables[0]);b.d.page.ShowDialog(w,X.VPTDialogComponent,{ShowCenter:!0},()=>{if(w.IsOkClicked&&(u=w.SelectedRow),null!=u){let K=new ge.bT;K.push("IsFSDoc","1"),b.d.report.ExportPDF_Masters(50051,y.toString(),parseInt(u.DocPrintLayoutID),"PDF","",K).subscribe(R=>{"Export"==m?b.d.SessionManager.Download(R.FileName,R.FileName):(b.d.SessionManager.printTab(R.FileName),e.J0.IsEmpty(R.Message)&&!e.J0.IsEmpty(R.FileName)&&(this.ViewModel.DisplayMessage="Printed Sucessfully"))},R=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(R)})}})}else u=M.Tables[0][0]}if(this.dsTotLayouts=M,this.drSelPrintLayout=u,null!=u&&!this.MoreThanOneLayout){let w=new ge.bT;w.push("IsFSDoc","1"),b.d.report.ExportPDF_Masters(50051,y.toString(),parseInt(u.DocPrintLayoutID),"PDF","",w).subscribe(k=>{console.log(k),b.d.SessionManager.Download(k.FileName,k.FileName),b.d.SessionManager.printTab(k.FileName),e.J0.IsEmpty(k.Message)&&!e.J0.IsEmpty(k.FileName)&&(this.ViewModel.DisplayMessage="printed Successfully")},k=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(k)})}return""}btnPrintPreview_Click(m){this.ViewModel.DocID>0?this.PrintFS("Preview"):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnExport_Click(m){if(!(this.ViewModel.DocID>0))return this.ViewModel.DisplayMessage="Load document in Edit Mode",void(this.ViewModel.MessageVisibility=!0);this.PrintFS("Export")}dgvLoanBal_CellClick(m,I){var y=this;return(0,le.A)(function*(){if("dgColLoanBalCalc"==y.dgvLoanBal.Columns[m.cell].DisplayMember){let w=b.d.common.GetDataTable("CRM028","");if(null!=w&&w.length>0){let k,K=Date.Today(),R=y.dsD.Tables[11].filter(B=>B.RefNo==y.dgvLoanBal.Table[m.row].dgColLoanBalDocNo);if(R.length>0){k=new ue.AddEditDocumentViewModel(40057,"Loan Repayment",!0,"IsFrmFS_LoanBal"),k.ScreenObject.Link.LinkCombo.Enable=!1,k.ScreenObject.Link.DocumentList.Enable=!1,k.ScreenObject.Preferences.Selective="false";let B={value:K};k.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(R[0].DocID),B,!1),K=B.value}else{k=new ue.AddEditDocumentViewModel(40057,"Loan Repayment",!1,"IsFrmFS_LoanBal"),k.ScreenObject.Link.LinkCombo.SelectedValue=w[0].DocumentLinkDefID.toString(),k.ScreenObject.Link.LinkCombo.Enable=!1,k.ScreenObject.Link.DocumentList.Enable=!1,k.ScreenObject.Preferences.Selective="false";let B=k.ScreenObject._CCFields.find(O=>"dcCCNID51"==O.DBColumnName);null!=B&&(B instanceof qe.y$||B instanceof Ye.G)&&(B.SelectedValue=y.EmpSeqNo),k.OLinkSelectionChanged(null)}k.IsFrmFS_LoanBal=!0;var u=k.ScreenObject.HeaderFields.find(B=>B instanceof Ue.MI&&"DocDate"==B.DBColumnName.toString());u&&(u.Enable=!1),(u=k.ScreenObject.HeaderFields.find(B=>B instanceof Ue.MI&&"VoucherNo"==B.DBColumnName.toString()))instanceof Tt.e3&&(u.Enable=!1,u.LoadVisibility=!1,u.PreviousVisibility=!1,u.NextVisibility=!1);var M=k.ScreenObject.Link.DocumentList.Items.find(B=>B.Value==y.dgvLoanBal.Table[m.row].dgColLoanBalDocNo_Tag.toString());M&&(M.IsChecked=!0,k.OnLinkDocumentCheckedChanged(M)),(u=k.ScreenObject._CCFields.find(B=>"dcCCNID51"==B.DBColumnName))&&(u.Enable=!1),(u=k.ScreenObject._TextFields.find(B=>"dcAlpha6"==B.DBColumnName))instanceof r.Dw&&(u.Text="FFS_LoanBalances");for(let B=0;B<k.ScreenObject.GridData.length;B++)e.J0.IsEmpty(k.ScreenObject.GridData[B].ProductID_Key)||(k.ScreenObject.GridData[B].dcAlpha5=y.dtpDocDate.Date.ToString(b.d.SessionManager.Preferences["Date Format"]),k.ScreenObject.GridData[B].dcAlpha5_Key=y.dtpDocDate.Date.toString());yield b.d.page.openDialog(k,xe.AddEditDocumentComponent),k.DialogResult&&(y.txtLoanBalAmount.Text=(parseFloat(y.txtLoanBalAmount.Text)+k.dFS_LoanAmt).ToString(b.d.SessionManager.sPayrollDecimals),y.dgvLoanBal.Table[m.row].dgColLoanBalCalc_Tag="Paid",y.dgvLoanBal.Table[m.row].dgColLoanBalSNo_Tag=k.RetValue,y.dgvLoanBal.updateRow(y.dgvLoanBal.Table[m.row])),y.CalculateTotalAmount()}}})()}NumberValidationTextBox(m,I){}GetResource(m,I){let y=m;return null!=this.ViewModel.dsRes1&&this.ViewModel.dsRes1.Tables.length>0&&this.ViewModel.dsRes1.Tables[0].length>0&&(this.drwRes=this.ViewModel.dsRes1.Tables[0].filter(u=>u.CCID==I&&u.Code=="'"+m+"'")),null!=this.drwRes&&this.drwRes.length>0?this.drwRes[0].AliasName.toString():y}cmbSettlementType_SelectionChanged(m,I){this.txtPartialGratuityAmount.IsReadOnly="Partial"!=this.cmbSettlementType.SelectedValue}AggregateLeaves(m,I,y,u,M,w,k){let L,$,Le,K=0,R=0,O=0,z=b.d.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),oe=" 1=1 ",Q="";if(Le=I.Tables[2],null!=z&&null!=z&&z.length>0)for(let Te=0;Te<z.length;Te++)e.J0.IsEmpty(z[Te])||(Q="CCNID"+(parseInt(z[Te])-5e4),L=M.Tables[0].filter(Pe=>Pe.EmpSeqNo==m),null!=L&&L.length>0&&(Q.Contains("CCNID51")?(oe+=" AND ( "+Q+"="+L[0].EmpSeqNo+" OR "+Q+"= 1)",Le=Le.filter(Pe=>Pe[Q]==L[0].EmpSeqNo||1==Pe[Q])):(oe+=" AND ( "+Q+"="+L[0][Q]+" OR "+Q+"= 1)",Le=Le.filter(Pe=>Pe[Q]==L[0][Q]||1==Pe[Q]))));" 1=1 "!=oe&&(this.drcWOffAdjDef=Le);let Oe,Ge,Re,Me=I.Tables[3];if(z=b.d.SessionManager.Preferences.HolidaysBasedOn.split(","),oe=" 1=1 ",Q="",null!=z&&null!=z&&z.length>0)for(let Te=0;Te<z.length;Te++)e.J0.IsEmpty(z[Te])||(Q="CCNID"+(parseInt(z[Te])-5e4),L=M.Tables[0].filter(Pe=>Pe.EmpSeqNo==m),null!=L&&L.length>0&&(Q.Contains("CCNID51")?(oe+=" AND ( "+Q+"="+L[0].EmpSeqNo+" OR "+Q+"= 1)",Me=Me.filter(Pe=>Pe[Q]==L[0].EmpSeqNo||1==Pe[Q])):(oe+=" AND ( "+Q+"="+L[0][Q]+" OR "+Q+"= 1)",Me=Me.filter(Pe=>Pe[Q]==L[0][Q]||1==Pe[Q]))));if(" 1=1 "!=oe&&($=Me),null!=$&&$.length>0&&(this.dtHolidayAdjDef=$),Re=I.Tables[0].filter(Te=>Te.EmpSeqNo==m),!e.J0.IsEmpty(Re)&&null!=Re&&Re.length>0)for(let Te=0;Te<Re.length;Te++){Oe=e.J0.ParseDate(Re[Te].FromDate),Ge=e.J0.ParseDate(Re[Te].ToDate),O=parseInt(Re[Te].ComponentID);let Pe=b.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),Ze=null;Pe.length>0&&(Ze=Pe.split(",")),Oe>=y?Ge<=u?(R=parseFloat(Re[Te].NoOfDays),K+=R):Oe<=u&&(R=this.GetNoOfDays(Oe,u,O,I,w,k),K+=R):Ge<=u?Ge>=y&&(R=this.GetNoOfDays(y,Ge,O,I,w,k),K+=R):(R=this.GetNoOfDays(y,u,O,I,w,k),K+=R)}return K}GetNoOfDays(m,I,y,u,M,w){let k=0,K=0,R=0,B=null,O=u.Tables[1].filter(L=>L.GradeID==w&&4==L.Type&&L.ComponentID==y);if(null!=O&&O.length>0){let L=m,$=O[0].IncludeRExclude.toString();if(k=e.J0.GetDateDifference(I,m)+1,"IncludeBoth"==$||""==$)return k;if("IncludeWeeklyOffs"==$)for(;L<=I;)e.J0.IsEmpty(this.dtHolidayAdjDef)||(B=this.dtHolidayAdjDef.filter(z=>z.HolidayDate==L.ToString("dd/MMM/yyyy"))),null!=B&&B.length>0&&R++,L=L.AddDays(1);else if("IncludeHolidays"==$)for(;L<=I;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(L,u,m,I,M)&&K++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff1&&K++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff2&&K++),L=L.AddDays(1);else if("ExcludeBoth"==$)for(;L<=I;){let z=!1;e.J0.IsEmpty(this.dtHolidayAdjDef)||(B=this.dtHolidayAdjDef.filter(oe=>oe.HolidayDate==L.ToString("dd/MMM/yyyy"))),null!=B&&B.length>0&&(R++,z=!0),null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(L,u,m,I,M)&&!z&&K++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&!z&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff1&&!z&&K++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&!z&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff2&&!z&&K++),L=L.AddDays(1)}else if("ExcludeWeeklyOffs"==$)for(;L<=I;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(L,u,m,I,M)&&K++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff1&&K++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&L.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&K++:L.getDay().toString()==b.d.SessionManager.Preferences.WeeklyOff2&&K++),L=L.AddDays(1);else if("ExcludeHolidays"==$)for(;L<=I;)e.J0.IsEmpty(this.dtHolidayAdjDef)||(B=this.dtHolidayAdjDef.filter(z=>z.HolidayDate==L.ToString("dd/MMM/yyyy"))),null!=B&&B.length>0&&R++,L=L.AddDays(1)}return k-(K+R)}CheckIsWeeklyOffFromDef(m,I,y,u,M){if(null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0){let B,w=1,K=M.DateOfRelieve<u?M.DateOfRelieve:u,R=M.DateOfJoining>y?M.DateOfJoining:y;for(;R<=K;){for(B=R.AddDays(6);R<=B&&R<=K;){if(I.Columns[2].Contains("Week"+w.toString()+"_W1")&&!e.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString())&&R.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString().toLowerCase()){if(R.ToString("dd MMM yyyy")==m.ToString("dd MMM yyyy"))return!0}else if(I.Columns[2].Contains("Week"+w.toString()+"_W2")&&!e.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString())&&R.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString().toLowerCase()&&R.ToString("dd MMM yyyy")==m.ToString("dd MMM yyyy"))return!0;R=R.AddDays(1)}w++}}return!1}get Prefix(){let m="";return null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.ComboBox.SelectedValue&&(m=this.ViewModel.DocPrefix.ComboBox.SelectedValue),m}OnDocPrefixChanged(m){this.OnDocPrefixChanged_2(m,!1),null!=m&&"lostFocus"==m.toString()||this.Clear_Click()}OnDocPrefixChanged_2(m,I=!1){if(Logger.InfoLog("FinalSettlement::Entering OnDocPrefixChanged"),null!=m)try{let y={value:this._Ddate};this.OnDocPrefixChanged_3(m,0,0,y,I),this._Ddate=y.value}catch(y){this.ViewModel.DisplayMessage="Error Loading document try again",Logger.ErrorLog("FinalSettlement","OnDocPrefixChanged",y.stack)}Logger.InfoLog("FinalSettlement::Exiting OnDocPrefixChanged")}OnDocPrefixChanged_3(m,I,y,u,M){let w=0;if(null!=m&&"lostFocus"==m.toString()){this.IsRefLCTR=!1,Logger.InfoLog("FinalSettlement:: Inside GetDocument");let R=null;e.J0.IsValidID(y)?(R=b.d.document.GetEditData(this.CostCenterID,"","","0",this.ViewModel.DocID,"",!0),null!=R&&R.Tables.length>0&&R.Columns[0].Contains("DocPrefix")&&R.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(B=>B instanceof Fe._p&&B.Value==R.Tables[0][0].DocPrefix.toString())||this.ViewModel.DocPrefix.ComboBox.Items.push(Fe._p.ComboBoxItems_2(R.Tables[0][0].DocPrefix.toString(),R.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=R.Tables[0][0].DocPrefix.toString(),this.ViewModel.DocPrefix.TextBox.Text=R.Tables[0][0].DocNumber.toString())):(R=b.d.document.GetEditData(this.CostCenterID,this.Prefix,null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:"",I,"0","",!0),null!=R&&R.Tables.length>0&&R.Columns[0].Contains("DocPrefix")&&R.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(O=>O instanceof Fe._p&&O.Value==R.Tables[0][0].DocPrefix.toString())||(this.ViewModel.DocPrefix.ComboBox.Items.push(Fe._p.ComboBoxItems_2(R.Tables[0][0].DocPrefix.toString(),R.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=R.Tables[0][0].DocPrefix.toString()))),R.Tables.length>1&&R.Tables[0].length>0&&!R.Columns[0].Contains("ErrorMessage")?(this.guid=e.J0.String(R.Tables[0][0].GUID),w=parseInt(R.Tables[0][0].StatusID),this.LoadDocument(parseInt(this.ViewModel.DocPrefix.TextBox.Text),this.Prefix),e.J0.IsEmpty(R.Tables[0][0].DocDate)||(u.value=e.J0.ParseDate(R.Tables[0][0].DocDate))):this.Clear_Click(),Logger.InfoLog("VoucherGenerator:: Exiting GetDocument")}else if(null!=m){this.IsRefLCTR=!1;let R=b.d.document.getcurrentcode(this.CostCenterID,this.Prefix);null!=R&&R.Tables.length>0&&R.Tables[0].length>0&&!R.Columns[0].Contains("ErrorMessage")&&R.Columns[0].Contains("CurrentCodeNumber")&&!e.J0.IsNullOrWhiteSpace(R.Tables[0][0].CurrentCodeNumber)?(this.ViewModel.DocPrefix.TextBox.Text=R.Tables[0][0].CurrentCodeNumber.toString(),null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&(e.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)||"1"==this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)&&R.Columns[0].Contains("Codelength")&&!e.J0.IsEmpty(R.Tables[0][0].Codelength)&&parseInt(R.Tables[0][0].Codelength)>1&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname=R.Tables[0][0].Codelength.toString())):this.ViewModel.DocPrefix.TextBox.Text="1"}}fillPrefixes(m){let I="",y=0;for(let M=0;M<m.length;M++)if(0==M&&(y=parseInt(m[M].SeriesNo.toString())),""!=m[M].SeriesNo.toString()&&parseInt(m[M].SeriesNo.toString())!=y&&(null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(I)&&this.ViewModel.DocPrefix.Prefixes.push(I,(0,ye.yG0)(m[M-1].Isdefault.toString())),y=parseInt(m[M].SeriesNo.toString()),I=""),51==parseInt(m[M].CCID.toString())||52==parseInt(m[M].CCID.toString())||53==parseInt(m[M].CCID.toString()))I+="'"+m[M].Length.toString()+"'"+m[M].Delimiter.toString();else if(54==parseInt(m[M].CCID.toString()))I+=m[M].Length.toString()+m[M].Delimiter.toString();else if(parseInt(m[M].CCID.toString())>5e4){var u=this.ViewModel.oEmpFilter.CostCenterFilters.find(w=>w.CostCenterID==parseInt(m[M].CCID.toString()));null!=u&&u.SelectedNodes.length>0&&(I+=this.GetTrimString(this.ViewModel.GetDocNumberString(m[M].SysColumnName.toString(),u.CostCenterID,u.SelectedNodes[0].Id),parseInt(m[M].Length.toString()))+m[M].Delimiter.toString())}m.length>0&&null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(I)&&this.ViewModel.DocPrefix.Prefixes.push(I,(0,ye.yG0)(m[m.length-1].Isdefault.toString())),this.ViewModel.FillDocumentPrefix(!1)}CheckDateInDocNumber(m,I=!0){let y=!1,u="";if(null==this.ViewModel.DocPrefix)return;let M=new ge.bT;if(this.ViewModel.DocPrefix.Prefixes.keys.forEach(w=>{null!=w&&(u=w);let k=this.ViewModel.DocPrefix.Prefixes[w];u.Contains("'DD'")?(y=!0,u=this.dtpDocDate.Date.getDate()>9?u.replace("'DD'",this.dtpDocDate.Date.getDate().toString()):u.replace("'DD'","0"+this.dtpDocDate.Date.getDate().toString())):u.Contains("'D'")&&(y=!0,u=u.replace("'D'",this.dtpDocDate.Date.getDate().toString())),u.Contains("'MMM'")?(y=!0,u=u.replace("'MMM'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!1))):u.Contains("'MM'")?(y=!0,u=this.dtpDocDate.Date.iMonth()>9?u.replace("'MM'",this.dtpDocDate.Date.iMonth().toString()):u.replace("'MM'","0"+this.dtpDocDate.Date.iMonth().toString())):u.Contains("'M'")?(y=!0,u=u.replace("'M'",this.dtpDocDate.Date.iMonth().toString())):u.Contains("'Name'")&&(y=!0,u=u.replace("'Name'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!0))),u.Contains("'YYYY'")?(y=!0,u=u.replace("'YYYY'",this.dtpDocDate.Date.getFullYear().toString())):u.Contains("'YY'")?(y=!0,u=u.replace("'YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2))):u.Contains("'YY-YY'")&&(y=!0,u=this.dtpDocDate.Date.iMonth()<b.d.SessionManager.AccountingFromMonth?u.replace("'YY-YY'",(this.dtpDocDate.Date.getFullYear()-1).toString().substr(2)+"-"+this.dtpDocDate.Date.getFullYear().toString().substr(2)):u.replace("'YY-YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2)+"-"+(this.dtpDocDate.Date.getFullYear()+1).toString().substr(2))),y||k?this.ViewModel.DocPrefix.ComboBox.Items.find(R=>R.Value==u)?M.ContainsKey(u)||M.push(u,k):(this.ViewModel.DocPrefix.ComboBox.Items.push(Fe._p.ComboBoxItems_4(u,u,"","1")),M.ContainsKey(u)||M.push(u,k),I&&(k||1==this.ViewModel.DocPrefix.Prefixes.length)&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem=this.ViewModel.DocPrefix.ComboBox.Items[this.ViewModel.DocPrefix.ComboBox.Items.length-1],this.ViewModel.DocPrefix.ComboBox.SelectedValue=u)):(null==this.ViewModel.DocPrefix.ComboBox.Items.find(R=>R.Value==u)&&this.ViewModel.DocPrefix.ComboBox.Items.push(Fe._p.ComboBoxItems_4(u,u,"","1")),M.ContainsKey(u)||M.push(u,k))}),y&&M.length>0&&!m&&I&&!e.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)&&!M.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue)){let w=M.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==w&&M.length>0?M.keys[0]:w.Key}else if(y&&M.length>0&&m&&I&&(e.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)||!M.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue))){let w=M.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==w&&M.length>0?M.keys[0]:w.Key}else if(!y&&m){let w=this.ViewModel.DocPrefix.Prefixes.values.indexOf(!0);if(u=-1==w&&this.ViewModel.DocPrefix.Prefixes.length>0?this.ViewModel.DocPrefix.Prefixes.keys[0]:this.ViewModel.DocPrefix.Prefixes.keys[w],null!=u){let k=this.ViewModel.DocPrefix.ComboBox.Items.find(K=>K.Value==u);e.J0.IsEmpty(k)&&this.ViewModel.DocPrefix.ComboBox.Items.push(Fe._p.ComboBoxItems_4(u,u,"","1")),this.ViewModel.DocPrefix.ComboBox.SelectedValue=u}}m||I&&(this.ViewModel.DisplayMessage="")}GetTrimString(m,I){return null!=m&&I>=0&&m.length>I?m.substr(0,I):m}GetMonthName(m,I){m>12&&(m-=12);let y="";switch(m){case 1:y=I?"January":"Jan";break;case 2:y=I?"February":"Feb";break;case 3:y=I?"March":"Mar";break;case 4:y=I?"April":"Apr";break;case 5:y="May";break;case 6:y=I?"June":"Jun";break;case 7:y=I?"July":"Jul";break;case 8:y=I?"August":"Aug";break;case 9:y=I?"September":"Sep";break;case 10:y=I?"October":"Oct";break;case 11:y=I?"November":"Nov";break;case 12:y=I?"December":"Dec"}return y}static#e=this.\u0275fac=function(I){return new(I||U)};static#t=this.\u0275cmp=o.VBU({type:U,selectors:[["app-final-settlement"]],decls:300,vars:93,consts:[["acoordionHeader",""],["btnCollapseheader",""],["TabHeaderField",""],["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnpill"],[1,"btnMetroDiv","secondary-btn-group"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"document-screen","main_div"],[1,"section"],["panelClass","row form-row",3,"isOpen"],["accordion-heading","",1,"collapse_tabfields"],[1,"btn","btn-link"],[1,"fa","pull-right","btn-tab-icon",2,"line-height","36px","color","white","position","relative","left","-10px","float","right","background","none","border","none"],[1,"PACTHeaderFields"],[2,"display","flex","width","100%"],["class","form-group col-xl-3  col-md-3 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl"],[2,"margin-top","auto"],[1,"PACTTabFields","section","tab_content","tab-exrafields","custom_accordion",2,"display","flex"],[1,"master-tab-container",2,"width","100%"],[3,"selectTab","heading","removable"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"height","250px","border","1px solid #ccc","overflow","scroll"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","flex-direction","row","padding","0px 30px 8px 0px !important","width","100%"],[2,"font-weight","bold"],[1,"form-row","row"],[1,"form-group","col-3"],[3,"heading","removable","selectTab",4,"ngIf"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fas","fa-print"],[1,"fa-light","fa-print"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-paperclip"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-file-chart-line"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","/* flex-direction","row","*/padding","0px 0px 0px 0px !important","width","100%"],["FieldDirective","",2,"width","100%",3,"obj","group"],[2,"display","flex"],[1,"input_cntrl_label",2,"flex-direction","column"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-left","auto","margin-bottom","2px"],[1,"secondary-btn","prevnextbtn",3,"click"],[1,"far","fa-angle-left"],[1,"far","fa-angle-right"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(I,y){if(1&I){const u=o.RV6();o.j41(0,"div",3),o.EFF(1,"\n  "),o.j41(2,"div",4),o.EFF(3,"\n    "),o.j41(4,"div",5),o.EFF(5,"\n      "),o.j41(6,"span",6),o.EFF(7),o.j41(8,"span",7),o.EFF(9),o.k0s(),o.EFF(10,"\n      "),o.k0s(),o.EFF(11,"\n    "),o.k0s(),o.EFF(12,"\n    "),o.j41(13,"div",8),o.EFF(14,"\n      "),o.EFF(15,"\n      "),o.DNE(16,gt,4,3,"span",9),o.EFF(17,"\n      "),o.DNE(18,yt,4,3,"span",9),o.EFF(19,"\n      "),o.DNE(20,mt,4,3,"span",9),o.EFF(21,"\n      "),o.DNE(22,je,4,3,"span",9),o.EFF(23,"\n      "),o.DNE(24,Nt,4,3,"span",9),o.EFF(25,"\n      "),o.DNE(26,ct,4,3,"span",9),o.EFF(27,"\n      "),o.DNE(28,Ct,4,3,"span",9),o.EFF(29,"\n      "),o.DNE(30,rt,4,3,"span",9),o.EFF(31,"\n      "),o.j41(32,"span",10),o.bIt("click",function(){return o.eBV(u),o.Njj(y.obj.Button_Click("Clear"))}),o.nrm(33,"i",11),o.EFF(34),o.nI1(35,"translate"),o.k0s(),o.EFF(36,"\n      "),o.DNE(37,qt,4,3,"span",9),o.EFF(38,"\n          "),o.DNE(39,$t,4,3,"span",9),o.EFF(40,"           \n    "),o.k0s(),o.EFF(41,"\n  "),o.k0s(),o.EFF(42,"\n  "),o.j41(43,"div",12),o.EFF(44,"\n    "),o.j41(45,"accordion",13,0),o.EFF(47,"\n      "),o.j41(48,"accordion-group",14),o.EFF(49,"\n        "),o.j41(50,"div",15),o.EFF(51,"\n          "),o.j41(52,"span",16),o.EFF(53," Primary Information"),o.k0s(),o.EFF(54,"\n          "),o.nrm(55,"span",17,1),o.EFF(57,"\n        "),o.k0s(),o.EFF(58,"\n        "),o.j41(59,"div"),o.EFF(60,"\n          "),o.j41(61,"div",18),o.EFF(62,"\n            "),o.j41(63,"div",19),o.EFF(64,"\n              "),o.DNE(65,Qt,25,3,"div",20),o.EFF(66,"\n              "),o.DNE(67,zt,4,2,"div",20),o.EFF(68,"\n            "),o.k0s(),o.EFF(69,"\n            "),o.j41(70,"div",19),o.EFF(71,"\n              "),o.DNE(72,Pt,4,2,"div",21),o.EFF(73,"\n              "),o.DNE(74,Zt,4,2,"div",20),o.EFF(75,"\n            "),o.k0s(),o.EFF(76,"\n            "),o.j41(77,"div",19),o.EFF(78,"\n              "),o.DNE(79,ea,4,2,"div",20),o.EFF(80,"\n              "),o.DNE(81,vt,4,2,"div",20),o.EFF(82,"\n              "),o.j41(83,"div",22),o.EFF(84,"\n                "),o.j41(85,"label",23),o.EFF(86),o.k0s(),o.EFF(87,"\n              "),o.k0s(),o.EFF(88,"\n            "),o.k0s(),o.EFF(89,"\n            "),o.j41(90,"div",19),o.EFF(91,"\n              "),o.DNE(92,Lt,4,2,"div",21),o.EFF(93,"\n              "),o.DNE(94,ta,4,2,"div",20),o.EFF(95,"\n            "),o.k0s(),o.EFF(96,"\n          "),o.k0s(),o.EFF(97,"\n        "),o.k0s(),o.EFF(98,"\n      "),o.k0s(),o.EFF(99,"\n    "),o.k0s(),o.EFF(100,"\n\n    "),o.j41(101,"div",24,2),o.EFF(103,"\n      "),o.j41(104,"tabset",25),o.EFF(105,"\n        "),o.j41(106,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvGratuity"))}),o.EFF(107,"\n          "),o.EFF(108,"\n            "),o.j41(109,"div",27),o.EFF(110,"\n            "),o.DNE(111,aa,5,2,"div",28),o.EFF(112,"\n            \n            "),o.j41(113,"div",29),o.EFF(114,"\n              "),o.EFF(115," \n              "),o.DNE(116,pt,4,2,"div",30),o.EFF(117,"\n              "),o.DNE(118,lt,4,2,"div",30),o.EFF(119,"\n              "),o.j41(120,"div",31),o.EFF(121,"\n                "),o.eu8(122,32),o.EFF(123,"\n              "),o.k0s(),o.EFF(124,"\n              "),o.j41(125,"div",31),o.EFF(126,"\n                "),o.eu8(127,32),o.EFF(128,"\n              "),o.k0s(),o.EFF(129,"\n              "),o.j41(130,"div",31),o.EFF(131,"\n                "),o.eu8(132,32),o.EFF(133,"\n              "),o.k0s(),o.EFF(134,"\n              "),o.j41(135,"div",31),o.EFF(136,"\n                "),o.j41(137,"button",33),o.bIt("click",function(){return o.eBV(u),o.Njj(y.obj.Button_Click("Gratuity"))}),o.EFF(138),o.k0s(),o.EFF(139,"\n              "),o.k0s(),o.EFF(140,"\n              "),o.j41(141,"div",34),o.EFF(142,"\n                "),o.j41(143,"label"),o.EFF(144),o.k0s(),o.j41(145,"label",35),o.EFF(146),o.k0s(),o.EFF(147,"\n              "),o.k0s(),o.EFF(148,"\n              "),o.j41(149,"div",34),o.EFF(150,"\n                "),o.j41(151,"label"),o.EFF(152),o.k0s(),o.j41(153,"label",35),o.EFF(154),o.k0s(),o.EFF(155," "),o.j41(156,"label"),o.EFF(157),o.k0s(),o.j41(158,"label",35),o.EFF(159),o.k0s(),o.EFF(160," "),o.j41(161,"label"),o.EFF(162),o.k0s(),o.j41(163,"label",35),o.EFF(164),o.k0s(),o.EFF(165,"\n              "),o.k0s(),o.EFF(166,"\n              "),o.j41(167,"div",34),o.EFF(168,"\n                "),o.j41(169,"label"),o.EFF(170),o.k0s(),o.j41(171,"label",35),o.EFF(172),o.k0s(),o.EFF(173,"\n              "),o.k0s(),o.EFF(174,"\n              "),o.j41(175,"div",34),o.EFF(176,"\n                "),o.j41(177,"label"),o.EFF(178),o.k0s(),o.j41(179,"label",35),o.EFF(180),o.k0s(),o.EFF(181,"\n              "),o.k0s(),o.EFF(182,"\n              "),o.DNE(183,Rt,4,2,"div",30),o.EFF(184,"\n              "),o.DNE(185,Ot,4,2,"div",30),o.EFF(186,"\n              "),o.DNE(187,Vt,4,2,"div",30),o.EFF(188,"\n            "),o.k0s(),o.EFF(189,"\n          "),o.k0s(),o.EFF(190,"\n        "),o.k0s(),o.EFF(191,"\n        "),o.j41(192,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvLeaveEncash"))}),o.EFF(193,"\n          "),o.j41(194,"div",36),o.EFF(195,"\n            "),o.DNE(196,sa,4,2,"div",28),o.EFF(197,"\n            "),o.j41(198,"div",37),o.EFF(199,"\n              "),o.DNE(200,la,4,2,"div",30),o.EFF(201,"\n              "),o.j41(202,"div",31),o.EFF(203,"\n                "),o.eu8(204,32),o.EFF(205,"\n              "),o.k0s(),o.EFF(206,"\n              "),o.j41(207,"div",31),o.EFF(208,"\n                "),o.eu8(209,32),o.EFF(210,"\n              "),o.k0s(),o.EFF(211,"\n              "),o.j41(212,"div",31),o.EFF(213,"\n                "),o.j41(214,"button",33),o.bIt("click",function(){return o.eBV(u),o.Njj(y.obj.Button_Click("LeaveEncash"))}),o.EFF(215),o.k0s(),o.EFF(216,"\n              "),o.k0s(),o.EFF(217,"\n              "),o.DNE(218,ia,4,2,"div",30),o.EFF(219,"\n            "),o.k0s(),o.EFF(220,"\n          "),o.k0s(),o.EFF(221,"\n        "),o.k0s(),o.EFF(222,"\n        "),o.DNE(223,St,17,6,"tab",38),o.EFF(224,"\n        "),o.j41(225,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvNoticePay"))}),o.EFF(226,"\n          "),o.j41(227,"div",36),o.EFF(228,"\n            "),o.DNE(229,Gt,4,2,"div",28),o.EFF(230,"\n            "),o.j41(231,"div",37),o.EFF(232,"\n              "),o.j41(233,"div",31),o.EFF(234,"\n                "),o.eu8(235,32),o.EFF(236,"\n              "),o.k0s(),o.EFF(237,"\n              "),o.DNE(238,Se,4,2,"div",30),o.EFF(239,"\n            "),o.k0s(),o.EFF(240,"\n          "),o.k0s(),o.EFF(241,"\n        "),o.k0s(),o.EFF(242,"\n        "),o.j41(243,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvOthAdd"))}),o.EFF(244,"\n          "),o.j41(245,"div",36),o.EFF(246,"\n            "),o.DNE(247,dt,4,2,"div",28),o.EFF(248,"\n            "),o.j41(249,"div",37),o.EFF(250,"\n              "),o.j41(251,"div",31),o.EFF(252,"\n                "),o.eu8(253,32),o.EFF(254,"\n              "),o.k0s(),o.EFF(255,"\n              "),o.DNE(256,na,4,2,"div",30),o.EFF(257,"\n            "),o.k0s(),o.EFF(258,"\n          "),o.k0s(),o.EFF(259,"\n        "),o.k0s(),o.EFF(260,"\n        "),o.j41(261,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvOthDed"))}),o.EFF(262,"\n          "),o.j41(263,"div",36),o.EFF(264,"\n            "),o.DNE(265,oa,4,2,"div",28),o.EFF(266,"\n            "),o.j41(267,"div",37),o.EFF(268,"\n              "),o.j41(269,"div",31),o.EFF(270,"\n                "),o.eu8(271,32),o.EFF(272,"\n              "),o.k0s(),o.EFF(273,"\n              "),o.DNE(274,kt,4,2,"div",30),o.EFF(275,"\n            "),o.k0s(),o.EFF(276,"\n          "),o.k0s(),o.EFF(277,"\n        "),o.k0s(),o.EFF(278,"\n        "),o.j41(279,"tab",26),o.bIt("selectTab",function(){return o.eBV(u),o.Njj(y.onSelectTab("dgvLoanBal"))}),o.EFF(280,"\n          "),o.j41(281,"div",36),o.EFF(282,"\n            "),o.DNE(283,_t,4,2,"div",28),o.EFF(284,"\n            "),o.j41(285,"div",37),o.EFF(286,"\n              "),o.j41(287,"div",31),o.EFF(288,"\n                "),o.eu8(289,32),o.EFF(290,"\n              "),o.k0s(),o.EFF(291,"\n              "),o.DNE(292,ra,4,2,"div",30),o.EFF(293,"\n            "),o.k0s(),o.EFF(294,"\n          "),o.k0s(),o.EFF(295,"\n        "),o.k0s(),o.EFF(296,"\n      "),o.k0s(),o.EFF(297,"\n\n    "),o.k0s(),o.EFF(298,"\n\n  "),o.k0s(),o.EFF(299,"\n"),o.k0s()}2&I&&(o.R7$(7),o.SpI("\n        ",y.obj.Title," "),o.R7$(),o.xc7("background-color",y.obj.StatusColor),o.R7$(),o.JRh(y.obj.DocStatus),o.R7$(7),o.Y8G("ngIf",y.ViewModel.ApproveVisibility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.PostVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.SavePrintVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.PrintVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.PreviewVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.ExportVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.AttachVisiblility),o.R7$(2),o.Y8G("ngIf",y.ViewModel.EMailVisiblility),o.R7$(4),o.JRh(o.bMT(35,91,"Clear")),o.R7$(3),o.Y8G("ngIf",y.obj.UnPostVisiblility),o.R7$(2),o.Y8G("ngIf",y.obj.ReportInfoVisibility),o.R7$(9),o.Y8G("isOpen",y.IsAccordionOpen),o.R7$(7),o.AVh("fa-chevron-down",y.IsAccordionOpen)("fa-chevron-up",!y.IsAccordionOpen),o.R7$(10),o.Y8G("ngIf",y.obj.txtDocNo.Visible),o.R7$(2),o.Y8G("ngIf",y.obj.dtpDocDate.Visible),o.R7$(5),o.Y8G("ngIf",y.obj.EmployeeList.Visible),o.R7$(2),o.Y8G("ngIf",y.obj.cmbSettlementType.Visible),o.R7$(5),o.Y8G("ngIf",y.obj.dtpDateOfJoining.Visible),o.R7$(2),o.Y8G("ngIf",y.obj.dtpDateOfRelieving.Visible),o.R7$(5),o.JRh(y.lblActRelievingDate),o.R7$(6),o.Y8G("ngIf",y.obj.txtRemarks.Visible),o.R7$(2),o.Y8G("ngIf",y.obj.txtNetAmount.Visible),o.R7$(12),o.FS9("heading",y.tpGratuity),o.Y8G("removable",!1),o.R7$(5),o.Y8G("ngIf",y.dgvGratuity.Visible),o.R7$(5),o.Y8G("ngIf",y.cmbResignType.Visible),o.R7$(2),o.Y8G("ngIf",y.cmbResignReason.Visible),o.R7$(4),o.Y8G("obj",y.chkCalcBasedOnLastSal)("group",y.form),o.R7$(5),o.Y8G("obj",y.chkCalcBasedOnActDays)("group",y.form),o.R7$(5),o.Y8G("obj",y.GratuityRemarks)("group",y.form),o.R7$(6),o.JRh(y.btnCalcGratuity),o.R7$(6),o.JRh(y.lbl1GratuityTotalDays),o.R7$(2),o.JRh(y.lblGratuityTotalDays),o.R7$(6),o.JRh(y.lbl1GratuityServiceDays),o.R7$(2),o.JRh(y.lblGratuityServiceDays),o.R7$(3),o.JRh(y.lbl1GratuityLOPDays),o.R7$(2),o.JRh(y.lblGratuityLOPDays),o.R7$(3),o.JRh(y.lbl1GratuityBalDays),o.R7$(2),o.JRh(y.lblGratuityBalDays),o.R7$(6),o.JRh(y.lbl1GratuityTotalGrDays),o.R7$(2),o.JRh(y.lblGratuityTotalGrDays),o.R7$(6),o.JRh(y.lbl1GratuityTaken),o.R7$(2),o.JRh(y.lblGratuityTaken),o.R7$(3),o.Y8G("ngIf",y.txtGratuityAmount.Visible),o.R7$(2),o.Y8G("ngIf",y.txtAvailedGratuityAmount.Visible),o.R7$(2),o.Y8G("ngIf",y.txtPartialGratuityAmount.Visible),o.R7$(5),o.FS9("heading",y.tpLeaveEncashment),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",y.dgvLeaveEncash.Visible),o.R7$(4),o.Y8G("ngIf",y.txtCumLeaveSalBalAmt.Visible),o.R7$(4),o.Y8G("obj",y.chkLECalcBasedOnLastApprSerYearWise)("group",y.form),o.R7$(5),o.Y8G("obj",y.LeaveRemarks)("group",y.form),o.R7$(6),o.JRh(y.btnCalcLE),o.R7$(3),o.Y8G("ngIf",y.txtLEAmount.Visible),o.R7$(5),o.Y8G("ngIf",y.ViewModel.UnProcessedVisible),o.R7$(2),o.FS9("heading",y.tpNoticePay),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",y.dgvNoticePay.Visible),o.R7$(6),o.Y8G("obj",y.NoticePayRemarks)("group",y.form),o.R7$(3),o.Y8G("ngIf",y.txtNPAmount.Visible),o.R7$(5),o.FS9("heading",y.tpOtherAdditions),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",y.dgvOthAdd.Visible),o.R7$(6),o.Y8G("obj",y.OAddRemarks)("group",y.form),o.R7$(3),o.Y8G("ngIf",y.txtOthAddAmount.Visible),o.R7$(5),o.FS9("heading",y.tpOtherDeductions),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",y.dgvOthDed.Visible),o.R7$(6),o.Y8G("obj",y.ODedRemarks)("group",y.form),o.R7$(3),o.Y8G("ngIf",y.txtOthDedAmount.Visible),o.R7$(5),o.FS9("heading",y.tpLoanBalances),o.Y8G("removable",!1),o.R7$(4),o.Y8G("ngIf",y.dgvLoanBal.Visible),o.R7$(6),o.Y8G("obj",y.LoanRemarks)("group",y.form),o.R7$(3),o.Y8G("ngIf",y.txtLoanBalAmount.Visible))},dependencies:[ht.bT,ze._,Ke.Mj,Ke.kt,xt.X,Ft.V6,Ft.fw,Kt.D9],encapsulation:2})}return U})();class ha{constructor(){this.Days=0}}},5661:(Xt,tt,W)=>{W.d(tt,{N:()=>Ue});var le=W(86739),We=W(8787),b=W(23823),r=W(24028),qe=W(92701),He=W(72743),Dt=W(35275),ye=W(7023),e=W(26531),_e=W(29788),Ae=W(81669),Qe=W(61994);class Ue extends b.g{constructor(xe){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.dtpPayrollMonth=new r.Lc(0),this.cmbPayslipLayout=new qe.y$(0),this.cmbSortOn=new qe.y$(0),this.PrintCallBack=new Ae.Yk,this.dtPrintLayouts=null,this.sFilter="",this.drSelectedPrintLayout=null,this.sDocIDs="",this.IsPDFExport=!1,this.iCostCenterID=40054,this.ExportSeperate=!1;try{if(this.DisplayName=le.d.GetResource(xe),this.Title=le.d.GetResource(xe),this.DisplayMessage="",this.dtpPayrollMonth.CustomFormat="MMM/yyyy",this.dtpPayrollMonth.Date=le.d.SessionManager.PayrollMonth,this.dtPrintLayouts=le.d.common.GetDataTable("PAY064",this.iCostCenterID.toString()+"~"+le.d.SessionManager.RoleID+"~"+le.d.SessionManager.UserID+"~"+le.d.SessionManager.LocationID),null!=this.dtPrintLayouts&&this.dtPrintLayouts.length>0){let ue="-1";for(let Z=0;Z<this.dtPrintLayouts.length;Z++)this.cmbPayslipLayout.Items.push(qe._p.ComboBoxItems_2(this.dtPrintLayouts[Z].Name.toString(),this.dtPrintLayouts[Z].DocPrintLayoutID.toString())),"true"==this.dtPrintLayouts[Z].IsDefault.toString().toLowerCase()&&(ue=this.dtPrintLayouts[Z].DocPrintLayoutID.toString());this.cmbPayslipLayout.SelectedValue=ue,"-1"==ue&&!We.J0.IsEmpty(this.dtPrintLayouts[0].DocPrintLayoutID)&&(ue=this.dtPrintLayouts[0].DocPrintLayoutID.toString(),this.cmbPayslipLayout.SelectedValue=ue)}if(this.cmbSortOn.Items.Clear(),this.cmbSortOn.Items.push(qe._p.ComboBoxItems_2("EmpCode","1")),this.cmbSortOn.Items.push(qe._p.ComboBoxItems_2("EmpName","2")),this.cmbSortOn.Items.push(qe._p.ComboBoxItems_2("TreeView","3")),this.cmbSortOn.SelectedValue="1",this.dtpPayrollMonth.Label=le.d.GetResource("Payroll_Month"),this.cmbPayslipLayout.Label=le.d.GetResource("PayslipLayout"),this.cmbSortOn.Label=le.d.GetResource("SortOn"),le.d.SessionManager.IsEmpUser&&!le.d.SessionManager.IsRptManagerUser){let ue="";We.J0.IsEmpty(le.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(ue="  AND EmpSeqNo IN ("+le.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let Z=[];Z.push(le.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),Z.push(ue),Z.push(1),Z.push(le.d.SessionManager.RoleID),Z.push(le.d.SessionManager.UserID),Z.push(le.d.SessionManager.LanguageID),this.dsEmps=le.d.empService.GetData(Z,"spPAY_GetEmpMasterCCDetails")}else this.btnFilter_Click();this.PrintCallBack.Subscribe(this,"PrintVoucher")}catch(ue){Logger.ErrorLog("PayslipViewModel::EXCEPTION PayslipViewModel()",ue)}}Button_Click(xe){this.IsPDFExport=!1,"Preview"==xe.toString()?this.btnPreview_Click(0):"Print"==xe.toString()?this.btnPreview_Click(1):"Export"==xe.toString()?(this.IsPDFExport=!0,this.btnPreview_Click(3)):"EMail"==xe.toString()?this.btnPreview_Click(2):"Filter"==xe.toString()&&this.btnFilter_Click(),Logger.InfoLog("PayslipViewModel::Exiting Button_Click()")}btnPreview_Click(xe){if(null!=this.dsEmps&&0!=this.dsEmps.Tables.length)try{let ue=this.dsEmps.Tables[0],Z=0,Fe=0;if(null!=ue&&ue.length>0){let pe="",$e="";for(let C=0;C<ue.length;C++)pe+=ue[C].EmpSeqNo.toString()+",",Fe++;if(pe.length>0&&Fe>0){pe=pe.substr(0,pe.length-1),$e="TreeView"==this.cmbSortOn.GetselectedItem().Name?" ORDER BY e.lft":" ORDER BY e."+this.cmbSortOn.GetselectedItem().Name.Replace("Emp","");let C=le.d.common.GetDataSet3("PAY065",this.iCostCenterID.toString(),this.dtpPayrollMonth.Date.ToString("01/MMM/yyyy"),pe+"~"+$e);if(null!=C&&C.Tables[0].length>0&&We.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)>0){Z=C.Tables[0].length,this.sDocIDs="";let ve=this.dtPrintLayouts.filter(se=>se.DocPrintLayoutID==this.cmbPayslipLayout.SelectedValue);for(let se=0;se<C.Tables[0].length;se++)this.sDocIDs+=C.Tables[0][se].DocID.toString()+",";if(this.sDocIDs.length>0)if(this.drSelectedPrintLayout=ve[0],this.sDocIDs=this.sDocIDs.substr(0,this.sDocIDs.length-1),0==xe)this.PrintCallBack.Call(!0);else if(1==xe)this.PrintCallBack.Call(!1);else if(3==xe)if(this.ExportSeperate)for(let se=0;se<C.Tables[0].length;se++)this.sDocIDs=C.Tables[0][se].DocID.toString(),this.PrintCallBack.Call(!1);else this.PrintCallBack.Call(!1);else 2==xe&&this.SendPaySlipsToEMail()}else 0==C.Tables[0].length?this.DisplayMessage="Payroll Not Processed For Selected Employees On This Payroll Month":-1==We.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)&&(this.DisplayMessage="Please select Payslip Layout")}}else this.DisplayMessage="No Employees found to generate preview.";Logger.InfoLog("PayslipViewModel::Exiting btnPreview_Click()")}catch(ue){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnPreview_Click()"+ue.stack)}else this.DisplayMessage="First filter the Employees, then Preview"}SendPaySlipsToEMail(){try{Logger.InfoLog("PayslipViewModel::Entering SendPaySlipsToEMail()"),null!=this.sDocIDs&&this.sDocIDs.length>0?le.d.page.ShowDialog(new e.SendEmailSMSViewModel(!0,this.iCostCenterID,0,this),_e.SendEmailSMSComponent):this.DisplayMessage="No Employees found to Send Email.",Logger.InfoLog("PayslipViewModel::Exiting SendPaySlipsToEMail()")}catch(xe){Logger.ErrorLog("PayslipViewModel::EXCEPTION SendPaySlipsToEMail()"+xe.stack)}}btnFilter_Click(){try{this.sFilter="",le.d.SessionManager.Preferences.ContainsKey("PayslipFilter")&&parseInt(le.d.SessionManager.Preferences.PayslipFilter)>0&&"Widget"!=this.DisplayName?null==this.objEmpFilter?this.objEmpFilter=new He.t("",0,4):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=4,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new He.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?le.d.page.ShowDialog(this.objEmpFilter,Qe.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}catch(xe){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnFilter_Click()",xe)}}btnFilter_Click_CallBack(){if(this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let ue=1,Z="",Fe="",pe="";for(let $e=0;$e<this.objEmpFilter.CostCenterFilters.length;$e++){let C=this.objEmpFilter.CostCenterFilters[$e];if(C.CostCenterID>5e4&&(ue=2,Z="NodeID",Fe=50051==C.CostCenterID?"EmpSeqNo":"CCNID"+(C.CostCenterID-5e4)),C.SelectedNodes.length>0){if(1==C.SelectedNodes.length)pe+=" AND ",pe+=Fe+"="+C.SelectedNodes[0].Id;else if(!C.SelectedNodes.find(ve=>ve.Id==ue&&ve.IsGroup))if(pe+=" AND ",Dt.IPrefetchFilter.IsGroupTree(C)){let ve="";for(let se=0;se<C.SelectedNodes.length;se++)(null==C.SelectedNodes[se].Parent||!C.SelectedNodes[se].Parent.IsSelected)&&(ve.length>0&&(ve+=","),ve+=C.SelectedNodes[se].Id);0==ve.length&&(ve+=-12912),pe+=Fe+" IN ",pe+=" (select T."+Z+" GTID from "+ye.A.GetTagTableName(C.CostCenterID)+" T with(nolock),",ye.A.GetTagTableName(C.CostCenterID),pe+=ve.toString()+")  group by T."+Z+")"}else{pe+=Fe+" IN (";for(let ve=0;ve<C.SelectedNodes.length;ve++)ve>0&&(pe+=","),pe+=C.SelectedNodes[ve].Id;pe+=")"}}else C.DeleteButtonVisibility||(pe+=" AND ",pe+=Fe+"=-12912")}this.sFilter=pe.toString()}if(this.objEmpFilter.Filter>0){le.d.SessionManager.LocationID>0&&le.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&le.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+le.d.SessionManager.LocationID+")"),We.J0.IsEmpty(le.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+le.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),4==this.objEmpFilter.Filter&&"All"!=this.objEmpFilter.PaymentModes.SelectedValue&&(this.sFilter+=" AND EMP.PaymentMode ='"+this.objEmpFilter.PaymentModes.SelectedValue+"' ");let ue=[];ue.push(le.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),ue.push(this.sFilter),ue.push(1),ue.push(le.d.SessionManager.RoleID),ue.push(le.d.SessionManager.UserID),ue.push(le.d.SessionManager.LanguageID),this.dsEmps=le.d.empService.GetData(ue,"spPAY_GetEmpMasterCCDetails")}}}PrintVoucher(xe){let Z=this;if(Z.DisplayMessage="",!We.J0.IsEmpty(Z.sDocIDs)){let Fe=null;Fe=Z.drSelectedPrintLayout,null!=Fe&&le.d.report.VoucherExport_PDF(40054,Z.IsPDFExport,Z.sDocIDs,"",Z.IsPDFExport,We.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)).subscribe(pe=>{console.log(pe),Z.IsPDFExport?xe?le.d.SessionManager.printTab(pe.FileName):le.d.SessionManager.Download(pe.FileName,pe.FileName):setTimeout(()=>{le.d.SessionManager.printTab(pe.FileName)},500),We.J0.IsEmpty(pe.Message)&&!We.J0.IsEmpty(pe.FileName)&&(this.DisplayMessage="Exported Successfully")},pe=>{console.log(pe)})}return""}}},70824:(Xt,tt,W)=>{W.r(tt),W.d(tt,{RibbonExtPay:()=>fe});var le=W(10467),We=W(62846),b=W(15091),r=W(86739),qe=W(72974),He=W(75782),Dt=W(50334),ye=W(89417),e=W(54438),_e=W(60177),Ae=W(60440),Qe=W(36688),Ue=W(73955);const Tt=()=>({standalone:!0});function xe(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",7),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Process"))}),e.nrm(1,"i",22),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Process")))}function ue(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",7),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Post"))}),e.nrm(1,"i",23),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Post")))}function Z(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",7),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("UnPost"))}),e.nrm(1,"i",24),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"UnPost")))}function Fe(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",7),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Export"))}),e.nrm(1,"i",25),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Export")))}function pe(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",7),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Report"))}),e.nrm(1,"i",26),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Report")))}let $e=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-consolidated-monthly-payroll"]],decls:89,vars:32,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"page-Subtitle",3,"dblclick"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-search"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"row",2,"height","30px"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"padding-left","inherit"],["FieldDirective","",3,"obj"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"padding-left","inherit"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-gears"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-file-chart-line"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n      "),e.j41(2,"div",1),e.EFF(3,"\n        "),e.j41(4,"div",2),e.EFF(5,"\n          "),e.j41(6,"span",3),e.EFF(7),e.j41(8,"span",4),e.bIt("dblclick",function(d){return i.obj.sPayrollMonth_MouseDoubleClick(d)}),e.EFF(9),e.k0s(),e.EFF(10,"\n          "),e.k0s(),e.EFF(11,"\n        "),e.k0s(),e.EFF(12,"\n\n        "),e.j41(13,"div",5),e.EFF(14,"\n          "),e.DNE(15,xe,4,3,"span",6),e.EFF(16,"\n          "),e.DNE(17,ue,4,3,"span",6),e.EFF(18,"\n          "),e.j41(19,"span",7),e.bIt("click",function(){return i.obj.Button_Click("Clear")}),e.nrm(20,"i",8),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.EFF(23,"\n          "),e.DNE(24,Z,4,3,"span",6),e.EFF(25,"\n          "),e.j41(26,"span",7),e.bIt("click",function(){return i.obj.Button_Click("Filter")}),e.nrm(27,"i",9),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.EFF(30,"\n          "),e.j41(31,"span",7),e.bIt("click",function(){return i.obj.Button_Click("Load")}),e.nrm(32,"i",10),e.EFF(33),e.nI1(34,"translate"),e.k0s(),e.EFF(35,"\n          "),e.DNE(36,Fe,4,3,"span",6),e.EFF(37,"\n          "),e.DNE(38,pe,4,3,"span",6),e.EFF(39,"           \n        "),e.k0s(),e.EFF(40,"\n      "),e.k0s(),e.EFF(41,"\n    "),e.j41(42,"div",11),e.EFF(43,"\n      "),e.j41(44,"div",12),e.EFF(45,"\n        "),e.j41(46,"div",13),e.EFF(47,"\n          "),e.eu8(48,14),e.EFF(49,"\n        "),e.k0s(),e.EFF(50,"\n        "),e.j41(51,"div",15),e.EFF(52,"\n          "),e.eu8(53,14),e.EFF(54,"\n        "),e.k0s(),e.EFF(55,"\n        "),e.j41(56,"div",15),e.EFF(57,"\n          "),e.eu8(58,14),e.EFF(59,"\n        "),e.k0s(),e.EFF(60,"\n      "),e.k0s(),e.EFF(61,"\n      "),e.j41(62,"div",12),e.EFF(63,"\n        "),e.j41(64,"div",16),e.EFF(65,"\n          "),e.j41(66,"input",17),e.mxI("ngModelChange",function(d){return e.DH7(i.obj.IsProcessWithArrears,d)||(i.obj.IsProcessWithArrears=d),d}),e.k0s(),e.EFF(67,"\n          "),e.j41(68,"label",18),e.bIt("click",function(){return i.obj.IsProcessWithArrears=!i.obj.IsProcessWithArrears}),e.EFF(69),e.nI1(70,"translate"),e.k0s(),e.EFF(71,"\n        "),e.k0s(),e.EFF(72,"\n        "),e.j41(73,"div",19),e.EFF(74,"\n          "),e.j41(75,"input",17),e.mxI("ngModelChange",function(d){return e.DH7(i.obj.IsProcessWithAdjustments,d)||(i.obj.IsProcessWithAdjustments=d),d}),e.k0s(),e.EFF(76,"\n          "),e.j41(77,"label",18),e.bIt("click",function(){return i.obj.IsProcessWithAdjustments=!i.obj.IsProcessWithAdjustments}),e.EFF(78),e.nI1(79,"translate"),e.k0s(),e.EFF(80,"\n        "),e.k0s(),e.EFF(81,"\n      "),e.k0s(),e.EFF(82,"\n        \n        "),e.j41(83,"div",20),e.EFF(84,"\n          "),e.nrm(85,"app-PactGridView",21),e.EFF(86,"  \n        "),e.k0s(),e.EFF(87,"\n    "),e.k0s(),e.EFF(88,"\n"),e.k0s()),2&s&&(e.R7$(7),e.SpI("\n            ",i.obj.Title,"\n            "),e.R7$(2),e.SpI("\n              ",i.obj.sPayrollMonth,"\n            "),e.R7$(6),e.Y8G("ngIf",i.obj.PostVisiblility),e.R7$(2),e.Y8G("ngIf",i.obj.PostVisiblility),e.R7$(4),e.JRh(e.bMT(22,20,"Clear")),e.R7$(3),e.Y8G("ngIf",i.obj.UnPostVisiblility),e.R7$(4),e.JRh(e.bMT(29,22,"Filter")),e.R7$(5),e.JRh(e.bMT(34,24,"Load")),e.R7$(3),e.Y8G("ngIf",i.obj.ExportVisiblility),e.R7$(2),e.Y8G("ngIf",i.obj.ReportInfoVisibility),e.R7$(10),e.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),e.R7$(5),e.Y8G("obj",i.obj.chkIncludeOTHours),e.R7$(5),e.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),e.R7$(8),e.R50("ngModel",i.obj.IsProcessWithArrears),e.Y8G("ngModelOptions",e.lJ4(30,Tt)),e.R7$(3),e.JRh(e.bMT(70,26,"ProcesswithArrears")),e.R7$(6),e.R50("ngModel",i.obj.IsProcessWithAdjustments),e.Y8G("ngModelOptions",e.lJ4(31,Tt)),e.R7$(3),e.JRh(e.bMT(79,28,"ProcesswithAdjustments")),e.R7$(7),e.Y8G("obj",i.obj.dgvEmployees))},dependencies:[_e.bT,Ae._,ye.Zm,ye.BC,Qe.X,ye.vS,Ue.D9],encapsulation:2})}return G})();var C=W(8787),ve=W(95707),se=W(32647),Ye=W(49710),at=W(23823),At=W(33547),X=W(18569),ge=W(92701),o=W(72743),ht=W(35275),ze=W(7023),Ke=W(5464),xt=W(62288);class Ft extends at.g{constructor(a){super(),this.DialogResult=!1,this.dtData=null,this.dtDataColumns=null,this.ExcelData=[],this.DisplayMessage="",this.Parent=a[0],this.Parent.Opacity=.3,this.dgv=new Ye.vv,this.dgv.Columns=new Array,this.dgv.Width="450",this.dgv.Table=[]}Button_Click(a){if("Load"==a.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{let s;this.dtData=[],this.dtDataColumns=[];for(let i=0;i<this.dgv.Columns.length;i++)this.dtDataColumns.push(this.dgv.TableColumns[i]);for(let i=0;i<this.dgv.Table.length;i++){s={};for(let n=0;n<this.dgv.Columns.length;n++)null!=this.dgv.Table[i][n]&&null!=this.dgv.Table[i][n]&&(s[n]=this.dgv.Table[i][n].toString());this.dtData.push(s)}this.dtData=this.dgv.Table}catch{}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,r.d.page.HideDialog(this.PopUpGUID)}else if("View"==a.toString()){let s;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var l=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(let n=0;n<this.ExcelTableColumns.length;n++)s=new X.O7,s.Header=this.ExcelTableColumns[n],s.DisplayMember=this.ExcelTableColumns[n],s.ID=this.ExcelTableColumns[n],s.Width=100,s.ReadOnly=!0,l.push(s),this.dgv.TableColumns.push(this.ExcelTableColumns[n]);let i;this.dgv.Columns=l;for(let n=1;n<this.ExcelTable.length;n++){i=this.dgv.NewRow();for(let d=0;d<this.ExcelTableColumns.length;d++)i[this.ExcelTableColumns[d]]=this.ExcelTable[n][d];this.dgv.Table.push(i),this.dgv.updateRow(i)}this.dgv.RefreshGrid=!0,this.dgv.refreshDataView()}}else"Browse"==a.toString()||"Cancel"==a.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,r.d.page.HideDialog(this.PopUpGUID));Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}OpenFile(a){if(1!==a.target.files.length)throw new Error("Cannot use multiple files");const l=new FileReader,s=a.target.files[0];this.fileExt=s.name.split(".").pop(),this.fileName=s.name,l.onload=i=>{const h=xt.LF(l.result,{type:"binary"});if(this.ExcelData=xt.Wp.sheet_to_json(h.Sheets[h.SheetNames[0]],{header:1}),!C.J0.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.ExcelTable=this.ExcelData,this.ExcelTableColumns=this.ExcelData[0],this.ActualFileName=this.fileName}catch(D){return void(this.DisplayMessage=D.Message)}},l.readAsBinaryString(s)}}let Kt=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-cons-mpload"]],decls:52,vars:18,consts:[["fileUpload",""],[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row",2,"margin-bottom","10px","flex-direction","row","display","flex","align-items","center"],[1,"col-md-auto","col-sm-12","col-xs-12"],[1,"input_cntrl_label",2,"margin-right","10px"],["type","text","readonly","",3,"ngModelChange","ngModel"],[1,"col-xl-2","col-md-2","col-sm-12","col-xs-12",2,"display","flex !important"],["type","file","accept",".xlsx,.xls,.csv","name","upload",2,"display","none",3,"change"],[1,"secondary-btn-wicon",2,"border","0px !important",3,"click"],[1,"fa-light","fa-search"],[1,"form-group","row","form-row","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(s,i){if(1&s){const n=e.RV6();e.j41(0,"div",1),e.EFF(1,"\n    "),e.j41(2,"div",2),e.EFF(3,"\n        "),e.j41(4,"div",3),e.EFF(5,"\n            "),e.j41(6,"div",4),e.EFF(7,"\n                "),e.j41(8,"label",5),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.EFF(11,"\n                "),e.j41(12,"input",6),e.mxI("ngModelChange",function(h){return e.eBV(n),e.DH7(i.obj.ActualFileName,h)||(i.obj.ActualFileName=h),e.Njj(h)}),e.k0s(),e.EFF(13,"\n            "),e.k0s(),e.EFF(14,"\n            "),e.j41(15,"div",7),e.EFF(16,"\n                "),e.j41(17,"input",8,0),e.bIt("change",function(h){return e.eBV(n),e.Njj(i.obj.OpenFile(h))}),e.k0s(),e.EFF(19,"               \n                "),e.j41(20,"span",9),e.bIt("click",function(){e.eBV(n);const h=e.sdS(18);return e.Njj(h.click())}),e.nrm(21,"i",10),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.EFF(24,"\n             \n            "),e.k0s(),e.EFF(25,"\n        "),e.k0s(),e.EFF(26,"  \n            \n        "),e.j41(27,"div",11),e.EFF(28,"\n            "),e.eu8(29,12),e.EFF(30,"\n        "),e.k0s(),e.EFF(31,"\n    "),e.k0s(),e.EFF(32,"\n    "),e.j41(33,"div",13),e.EFF(34,"\n        "),e.j41(35,"div"),e.EFF(36,"\n            "),e.j41(37,"button",14),e.bIt("click",function(){return e.eBV(n),e.Njj(i.obj.Button_Click("Load"))}),e.EFF(38),e.nI1(39,"translate"),e.k0s(),e.EFF(40,"\n            "),e.j41(41,"button",15),e.bIt("click",function(){return e.eBV(n),e.Njj(i.obj.Button_Click("View"))}),e.EFF(42),e.nI1(43,"translate"),e.k0s(),e.EFF(44,"\n            "),e.j41(45,"button",15),e.bIt("click",function(){return e.eBV(n),e.Njj(i.obj.Button_Click("Cancel"))}),e.nrm(46,"i",16),e.EFF(47),e.nI1(48,"translate"),e.k0s(),e.EFF(49,"\n           \n        "),e.k0s(),e.EFF(50,"\n    "),e.k0s(),e.EFF(51,"\n"),e.k0s()}2&s&&(e.R7$(9),e.JRh(e.bMT(10,8,"Com_Attachments_FileName")),e.R7$(3),e.R50("ngModel",i.obj.ActualFileName),e.R7$(10),e.JRh(e.bMT(23,10,"Browse")),e.R7$(7),e.Y8G("obj",i.obj.dgv)("group",i.form),e.R7$(9),e.JRh(e.bMT(39,12,"Load")),e.R7$(4),e.JRh(e.bMT(43,14,"View")),e.R7$(5),e.JRh(e.bMT(48,16,"Cancel")))},dependencies:[Ae._,ye.me,ye.BC,ye.vS,Ue.D9],encapsulation:2})}return G})();var gt=W(61994),yt=W(2578),mt=W(38816),je=W(72099),Nt=W(39032),ct=W(98669),Ct=W(36466);class rt extends at.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}SerializeGridColumnType(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(let a=0;a<this.dgvEmployees.TableColumns.length;a++);}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.Opacity=1,this.DialogResult=!1,this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this._SelectAll=!1,this.IsProcessWithArrears=!1,this.IsProcessWithAdjustments=!1,this.chkPostBasedOnDailyAttendance=new je.c,this.chkPostBasedOnAttDimWise=new je.c,this.chkIncludeOTHours=new je.c,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.ExportVisiblility=!0,this.GridColumnType=new ve.bT,this.dsDailyAttendanceData=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Ct.v,this.CostCenterID=0,this.sCrAccount="0",this.sDrAccount="0",this.dtRes=null,this.drwRes=null,this.dtCust=null,this.SelectUnCheck=0,this.objCMPLData=null,this.IsProcessed=!1,this.sFilter="",this.iColId=0,this.sBGWorkType="",this.dtArrData=null,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),this.ClassName="ConsolidatedMonthlyPayrollViewModel",this.CostCenterID=40054,this.dtRes=r.d.common.GetDataTable("PAY073",r.d.SessionManager.LangID),this.DisplayName=r.d.GetResource(a.Replace(" ","")),this.Title=r.d.GetResource(a.Replace(" ","")),this.DisplayMessage="",this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ExportVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.chkPostBasedOnDailyAttendance.Label=r.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=r.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=r.d.GetResource("PostbasedonAttendanceDimensionwise"),this.LoadGrid(),this.btnFilter_Click(),r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView()}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",l)}}sPayrollMonth_MouseDoubleClick(a){let l=new b.SetPayrollDateViewModel;r.d.page.ShowDialog(l,qe.SetPayrollDateComponent,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")}).subscribe(()=>{l.DialogResult&&this.btnClear_Click()})}dgvEmployees_EndEdit(a,l,s){let i=this.dgvEmployees.Table.indexOf(a);if(this.iEmpIndex=this.lstSelectedEmps.indexOf(i),!(this.iEmpIndex<0)){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let n=0;n<this.oCMP.GradeMPFls.length;n++)this.oCMP.GradeMPFls[n].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[n].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[n].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[n].GradePayrollMonthEnd);"DaysAttended"==l?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(a[l])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=r.d.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",a.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==l?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(a[l])):l.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(l.Replace("EarningOTHrs","")),a[l].toString()):l.startsWith("Earning")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(l.Replace("Earning","")),a[l].toString()):l.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(l.Replace("DeductionOTHrs","")),a[l].toString()):l.startsWith("Deduction")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(l.Replace("Deduction","")),a[l].toString()):l.startsWith("dcAlpha")?l.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l.Replace("_Key",""),C.J0.ParseDate(a[l]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString()):l.startsWith("dcCCNID")&&(Object.keys(a).Contains(l+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString())),this.dgvEmployees.updateRow(a),this.FillProcessedData(i)}}GetResource(a,l){let s=a;return this.drwRes=this.dtRes.filter(i=>i.CCID==l&&i.Code==a),null!=this.drwRes&&this.drwRes.length>0?1==r.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():s}LoadGrid(){let l,a=new At.ControlGenerator;this.dsDocDesig=a.GetScreenInfo(this.CostCenterID),l=this.dsDocDesig.Tables[0].filter(n=>"CreditAccount"==n.SysColumnName),null!=l&&l.length>0&&!C.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sCrAccount=l[0].UserDefaultValue.toString()),l=this.dsDocDesig.Tables[0].filter(n=>"DebitAccount"==n.SysColumnName),null!=l&&l.length>0&&!C.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sDrAccount=l[0].UserDefaultValue.toString()),this.dgvEmployees=new Ye.vv,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();let s=new X.O7;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],s=new X.O7,s.Header=this.GetResource("Select",40054),s.DisplayMember="Select",s.ID="Select",s.DataType="CheckBox",s.Width=50,s.IsFrozen=!0,s.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),s=new X.O7,s.Header=this.GetResource("S No",40054),s.DisplayMember="SNo",s.ID="SNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("SNo"),s=new X.O7,s.Header="EmpSeqNo",s.DisplayMember="EmpSeqNo",s.ID="EmpSeqNo",s.DataType="TextBlock",s.Width=50,s.ReadOnly=!0,s.IsFrozen=!0,s.IsVisible=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpSeqNo"),s=new X.O7,s.Header=this.GetResource("Employee Code",40054),s.DisplayMember="EmpCode",s.ID="EmpCode",s.CrRefColName="dcCCNID51",s.DataType="TextBlock",s.Width=150,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpCode"),s=new X.O7,s.Header=this.GetResource("Employee Name",40054),s.DisplayMember="EmpName",s.ID="EmpName",s.CrRefColName="dcCCNID51",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,s.IsFrozen=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("EmpName"),s=new X.O7,s.Header="GradeID",s.DisplayMember="GradeID",s.ID="GradeID",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,s.IsFrozen=!0,s.IsVisible=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("GradeID"),s=new X.O7,s.Header=this.GetResource("dcAlpha3",40054),s.DisplayMember="NetSalary",s.ID="NetSalary",s.CrRefColName="dcAlpha3",s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=90,s.ReadOnly=!0,s.IsFontBold=!0,s.IsFrozen=!0,s.ShowTotal=!0,s.IsCalculated=1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),s=new X.O7,s.Header=this.GetResource("Month Days",40054),s.DisplayMember="MonthDays",s.ID="MonthDays",s.CrRefColName="dcAlpha4",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),s=new X.O7,s.Header=this.GetResource("dcAlpha5",40054),s.DisplayMember="DaysAttended",s.ID="DaysAttended",s.CrRefColName="dcAlpha5",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),s=new X.O7,s.Header=this.GetResource("dcAlpha24",40054),s.DisplayMember="PaidLeaves",s.ID="PaidLeaves",s.CrRefColName="dcAlpha24",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),s=new X.O7,s.Header=this.GetResource("dcAlpha6",40054),s.DisplayMember="TotalLeaves",s.ID="TotalLeaves",s.CrRefColName="dcAlpha6",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),s=new X.O7,s.Header=this.GetResource("dcAlpha7",40054),s.DisplayMember="WeeklyOffs",s.ID="WeeklyOffs",s.CrRefColName="dcAlpha7",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),s=new X.O7,s.Header=this.GetResource("dcAlpha8",40054),s.DisplayMember="Holidays",s.ID="Holidays",s.CrRefColName="dcAlpha8",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),s=new X.O7,s.Header=this.GetResource("dcAlpha9",40054),s.DisplayMember="LOPDays",s.ID="LOPDays",s.CrRefColName="dcAlpha9",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!1,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),s=new X.O7,s.Header=this.GetResource("dcAlpha10",40054),s.DisplayMember="UnpaidDays",s.ID="UnpaidDays",s.CrRefColName="dcAlpha10",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),s=new X.O7,s.Header=this.GetResource("dcAlpha4",40054),s.DisplayMember="TotalDays",s.ID="TotalDays",s.CrRefColName="dcAlpha4",s.DataType="FLOAT",s.DecimalPoints="1",s.Width=60,s.ReadOnly=!0,s.ForeColor="Gray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=r.d.common.GetDataSet("PAY058",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if(l=this.dsStructure.Tables[0].filter(n=>1==n.Type&&"Yes"==n.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let n=0;n<l.length;n++)!C.J0.IsEmpty(l[n].Behaviour)&&("Accruals"==l[n].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[n].Behaviour.toString())||(s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052),s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="Earning"+l[n].SNo.toString(),s.ID="Earning"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightBlue",s.Width=80,"OverTime"==l[n].FieldType.toString()?(s.DisplayMember="EarningOTHrs"+l[n].SNo.toString(),s.ID="EarningOTHrs"+l[n].SNo.toString(),s.DecimalPoints="2",s.Width=60,s.ReadOnly=!1):"Monthly"==l[n].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),"OverTime"==l[n].FieldType.toString()&&(s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052)+"_Amount",s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="EarningOTAmt"+l[n].SNo.toString(),s.ID="EarningOTAmt"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=80,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightBlue","-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember)));if(s=new X.O7,s.Header=this.GetResource("dcAlpha11",40054),s.DisplayMember="TotalEarnings",s.ID="TotalEarnings",s.CrRefColName="dcAlpha11",s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightBlue",s.Width=90,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),null!=l&&l.length>0)for(let n=0;n<l.length;n++)!C.J0.IsEmpty(l[n].Behaviour)&&("Accruals"==l[n].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[n].Behaviour.toString())&&(s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052),s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="Earning"+l[n].SNo.toString(),s.ID="Earning"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="GreenYellow",s.Width=80,"Monthly"==l[n].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember));if(l=this.dsStructure.Tables[0].filter(n=>2==n.Type&&"Yes"==n.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let n=0;n<l.length;n++)s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052),s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="Deduction"+l[n].SNo.toString(),s.ID="Deduction"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightCoral",s.Width=80,"OverTime"==l[n].FieldType.toString()?(s.DisplayMember="DeductionOTHrs"+l[n].SNo.toString(),s.ID="DeductionOTHrs"+l[n].SNo.toString(),s.DecimalPoints="2",s.Width=60,s.ReadOnly=!1):"Monthly"==l[n].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),"OverTime"==l[n].FieldType.toString()&&(s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052)+"_Amount",s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="DeductionOTAmt"+l[n].SNo.toString(),s.ID="DeductionOTAmt"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=80,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightCoral","-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember));if(l=this.dsStructure.Tables[0].filter(n=>3==n.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let n=0;n<l.length;n++)s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052),s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="Loan"+l[n].SNo.toString(),s.ID="Loan"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightGoldenrodYellow",s.Width=80,"-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember);if(s=new X.O7,s.Header=this.GetResource("dcAlpha12",40054),s.DisplayMember="TotalDeductions",s.ID="TotalDeductions",s.CrRefColName="dcAlpha12",s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="LightCoral",s.Width=90,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember),l=this.dsStructure.Tables[0].filter(n=>4==n.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let n=0;n<l.length;n++)s=new X.O7,s.Header=this.GetResource(l[n].ComponentCode.toString(),50052),s.CrRefColID=parseInt(l[n].ComponentID),s.DisplayMember="Leave"+l[n].SNo.toString(),s.ID="Leave"+l[n].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints="1",s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightGreen",s.Width=60,"-1"!=l[n].Visible.toString()&&(s.IsVisible="1"==l[n].Visible.toString()),"-1"!=l[n].Width.toString()&&(s.Width=parseInt(l[n].Width)),"-1"!=l[n].IndexValue.toString()&&(s.DisplayIndex=parseInt(l[n].IndexValue)),"-1"!=l[n].ReadOnly.toString()&&(s.ReadOnly="1"==l[n].ReadOnly.toString()),"-1"!=l[n].Mandatory.toString()&&(s.Mandatory="1"==l[n].Mandatory.toString()),this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push(s.DisplayMember),this.dgvEmployees.DataTypes.Double.push(s.DisplayMember)}let i=this.dsDocDesig.Tables[0].filter(n=>1==n.IsColumnUserDefined&&(2==n.SectionID&&"H"==n.SectionName||3==n.SectionID));if(null!=i&&i.length>0)for(let n=0;n<i.length;n++){switch(s=new X.O7,s.Header=this.GetResource(i[n].SysColumnName.toString(),40054),s.DisplayMember=i[n].SysColumnName.toString(),s.ID=i[n].SysColumnName.toString(),s.CrRefColName=i[n].SysColumnName.toString(),s.DataType=i[n].ColumnDataType.toString(),s.IsColumnUserDefined=(0,se.yG0)(i[n].IsColumnUserDefined),s.Mandatory=(0,se.yG0)(i[n].IsMandatory),s.DataType.toUpperCase()){case"LISTBOX":s.ValueMember=s.ID+"_Key",this.dgvEmployees.TableColumns.push(s.ID),this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(s.ID+"_Key"),s.CostCenterID=parseInt(i[n].ColumnCostCenterID.toString()),s.TypeID=parseInt(i[n].ColumnCCListViewTypeID.toString()),C.J0.IsEmpty(i[n].FetchMaxRows)?C.J0.IsEmpty(i[n].UserProbableValues)||(s.FilterColumn=i[n].UserProbableValues.toString()):s.GridViewID=parseInt(i[n].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(s.ID),s.IsColumnUserDefined)if("Date"==i[n].UserColumnType.toString()&&(s.DataType="DATE",this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(s.ID+"_Key")),"DateTime"==i[n].UserColumnType.toString())s.DataType="DATETIME",this.dgvEmployees.TableColumns.push(s.ID+"_Key");else if("Time"==i[n].UserColumnType.toString())s.DataType="TIME",this.dgvEmployees.TableColumns.push(s.ID+"_Key");else if("Numeric"==i[n].UserColumnType.toString())s.DataType="FLOAT";else if("SELECTIONBOX"==i[n].UserColumnType.toString()||"editablecombobox"==i[n].UserColumnType.toString().toLowerCase())s.DataType="SELECTIONBOX",s.CostCenterID=this.CostCenterID;else if("combobox"==i[n].UserColumnType.toString().toLowerCase()){if(s.ValueBinding=s.ID,!C.J0.IsEmpty(i[n].linkData)&&22803==parseInt(i[n].linkData.toString())||"@YEAR"==s.DefaultValue){s.DataType="PactComboBox";let d=[];for(let h=1980;h<2100;h++){let c={};c.Year=h.toString(),d.push(c)}s.DisplayMember="Year",s.ValueMember="Year",s.ComboData=d,"@YEAR"==s.DefaultValue&&(s.DefaultValue="")}else{s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let d=[],h=i[n].UserProbableValues.toString().Trim();if(h.length>0){let c=h.split(";");for(let g=0;g<c.length;g++)d.push(ge._p.ComboBoxItems_2(c[g],c[g]))}s.ComboData=d}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}else if("LISTBOX"==i[n].UserColumnType.toString())if(44==parseInt(i[n].ColumnCostCenterID.toString())){s.ValueBinding=s.ID,s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let d=rt.GetLookupData(parseInt(i[n].ColumnCCListViewTypeID));if(null!=d){let h=[];for(let c=0;c<d.length;c++)h.push(ge._p.ComboBoxItems_2(d[c].Name.toString(),d[c].NodeID.toString()));s.ComboData=h}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}else s.DataType="LISTBOX",s.ValueMember=s.ID+"_Key",this.dgvEmployees.TableColumns.push(s.ID+"_Key"),s.CostCenterID=parseInt(i[n].ColumnCostCenterID.toString()),s.TypeID=parseInt(i[n].ColumnCCListViewTypeID.toString());else if("Attachment"==i[n].UserColumnType.toString())s.DataType="LINK",s.ReadOnly=!0,s.FilterCondition=i[n].BasedOnXml.toString(),s.Dependantinuse=!1;else if("Image"==i[n].UserColumnType.toString())s.DataType="LINK",s.ReadOnly=!0,s.Dependantinuse=!0;else if("LOOKUP"==i[n].UserColumnType.toString()){s.ValueBinding=s.ID,s.DataType="ComboBox",s.DisplayMember="Name",s.ValueMember="Value";let d=rt.GetLookupData(parseInt(i[n].ColumnCCListViewTypeID));if(null!=d){let h=[];for(let c=0;c<d.length;c++)h.push(ge._p.ComboBoxItems_2(d[c].Name.toString(),d[c].NodeID.toString()));s.ComboData=h}this.dgvEmployees.TableColumns.push(s.ID+"_Key")}break;case"DATE":s.DataType="DATE",this.dgvEmployees.TableColumns.push(s.ID),this.dgvEmployees.TableColumns.push(s.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(s.ID+"_Key")}s.Width=100,s.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.Contains(i[n].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(i[n].SysColumnName.toString())}if(this.dtCust=r.d.common.GetDataTable("PAY059",r.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let n=new C.VB;if(n.ReadXml(this.dtCust[0].ValueXml.toString()),null!=n&&n.Tables.length>0&&n.Tables[0].length>0){let d,h=3;for(let c=0;c<this.dgvEmployees.Columns.length;c++)d=n.Tables[0].filter(g=>g.SysColumnName==this.dgvEmployees.Columns[c].CrRefColName),d.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(d[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):(d=n.Tables[0].filter(g=>g.ID==this.dgvEmployees.Columns[c].CrRefColID),null!=d&&d.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(d[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):(d=n.Tables[0].filter(g=>g.ID==-this.dgvEmployees.Columns[c].CrRefColID),null!=d&&d.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(d[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):this.dgvEmployees.Columns[c].DisplayIndex=c))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}s=new X.O7,s.Header=this.GetResource("Result",40054),s.DisplayMember="Result",s.ID="Result",s.DataType="TextBlock",s.Width=250,s.ReadOnly=!0,this.dgvEmployees.Columns.push(s),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}OnPreviewKeyDown(a,l,s){if("F5"==l.key){var i=this.dgvEmployees.Columns.find(n=>n.DisplayMember==s);if(null!=i){if(i.ReadOnly||"sno"==s.toLowerCase()||!confirm("Do you want to override all.?"))return!0;for(let n=0;n<this.dgvEmployees.Table.length;n++)this.dgvEmployees.Table[n][s]=a[s].toString(),this.dgvEmployees.TableColumns.Contains(s+"_Key")&&(this.dgvEmployees.Table[n][s+"_Key"]=a[s+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[n]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[n],s,-1)}}else if(l.ctrlKey)if("F"==l.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),l.Handled=!0;else if("E"==l.key){let n=this.GetRawExportHTML().toString();const d=new Blob([n],{type:"text/plain;charser=utf-8"});yt.saveAs(d,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),l.Handled=!0}return!1}static GetLookupData(a){let l=r.d.common.GetDataSet("PAY060",a.toString());return null!=l&&l.Tables.length>0&&l.Columns[0].Contains("NodeID")?l.Tables[0]:null}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgvEmployees.Table.length;l++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Process"==a.toString()?this.btnProcess_Click():"Load"==a.toString()?this.btnLoad_Click():"Export"==a.toString()?this.btnExport_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,r.d.page.ShowDialog(this,Nt.L,{Title:"Reports"}));Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}btnExport_Click(){this.dgvEmployees.Excelexportdelegate.Call()}btnLoad_Click(){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;let a=[];a.push(this);let l=new Ft(a);r.d.page.ShowDialog(l,Kt,{Title:"Load Data"}).subscribe(()=>{if(l.DialogResult){if(!l.dtDataColumns.Contains("Employee Code"))return this.DisplayMessage="'Employee Code' Column not found.",void(this.MessageVisibility=!0);this.objCMPLData=l.dtData,this.sBGWorkType="LOAD",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")})}catch(a){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",a)}}LoadXLData(a){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";let l=0;if(null!=a&&a.length>0){l=a.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=l,this.ProgressMessage="Loading Excel Data, please wait ...";let s,i="",n=-1;for(let d=0;d<this.dgvEmployees.Table.length;d++)if(!C.J0.IsEmpty(this.dgvEmployees.Table[d].EmpCode)&&(i="",s=a.filter(h=>h["Employee Code"].toLowerCase()==this.dgvEmployees.Table[d].EmpCode.toString().toLowerCase()),s.length>0)){for(let h=1;h<Object.keys(a[0]).length;h++){let c=Object.keys(a[0])[h];for(let g=0;g<this.dgvEmployees.TableColumns.length;g++)if(this.dgvEmployees.Columns[g].Header==c&&this.dgvEmployees.TableColumns.Contains(this.dgvEmployees.Columns[g].ID)){this.dgvEmployees.Table[d][this.dgvEmployees.Columns[g].ID]=s[0][Object.keys(s[0])[h]].toString();{let D=this.dgvEmployees.Table.indexOf(this.dgvEmployees.Table[d]);this.iEmpIndex=this.lstSelectedEmps.indexOf(D);let p=0,t=-1;this.dgvEmployees.Columns[g].ID.startsWith("EarningOTHrs")?(p=1,t=parseInt(this.dgvEmployees.Columns[g].ID.Replace("EarningOTHrs","")),i=this.dgvEmployees.Columns[g].ID,n=g):this.dgvEmployees.Columns[g].ID.startsWith("Earning")?(p=0,t=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Earning","")),i=this.dgvEmployees.Columns[g].ID,n=g):this.dgvEmployees.Columns[g].ID.startsWith("DeductionOTHrs")?(p=3,t=parseInt(this.dgvEmployees.Columns[g].ID.Replace("DeductionOTHrs","")),i=this.dgvEmployees.Columns[g].ID,n=g):this.dgvEmployees.Columns[g].ID.startsWith("Deduction")&&(p=2,t=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Deduction","")),i=this.dgvEmployees.Columns[g].ID,n=g);let T=this.oCMP.arrLstCPFields[this.iEmpIndex][p].find(P=>P.SNo==t);null!=T&&(T.dActual=parseFloat(s[0][Object.keys(s[0])[h]].toString()).ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],("DaysAttended"==this.dgvEmployees.Columns[g].ID||"LOPDays"==this.dgvEmployees.Columns[g].ID)&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[d],this.dgvEmployees.Columns[g].ID,g)}break}}n>=0&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[d],i,n),this.ProgressValue=d+1,this.InProgress=d+1+" of "+l}this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}btnProcess_Click(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}AddArrearColumns(){if(this.IsProcessWithArrears||this.IsProcessWithAdjustments){let s=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);s.sort((i,n)=>i.SNo-n.SNo),this.AddEarDedArrearColumns(s,"Earning"),s=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),s.sort((i,n)=>i.SNo-n.SNo),this.AddEarDedArrearColumns(s,"Deduction")}else{let s=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);if(s.sort((i,n)=>i.SNo-n.SNo),null!=s&&s.length>0)for(let i=0;i<s.length;i++)this.dgvEmployees.TableColumns.Contains("Earning"+s[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Earning"+s[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(n=>n.DisplayMember=="Earning"+s[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Earning"+s[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Earning"+s[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Earning"+s[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a));if(s=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),null!=s&&s.length>0)for(let i=0;i<s.length;i++){var a;this.dgvEmployees.TableColumns.Contains("Deduction"+s[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+s[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Deduction"+s[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Deduction"+s[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+s[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Deduction"+s[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a))}}let l=[];for(let s=0;s<this.dgvEmployees.Columns.length;s++)l.push(this.dgvEmployees.Columns[s]);this.dgvEmployees.Columns=l}AddEarDedArrearColumns(a,l){if(null!=a&&a.length>0){let s;if(this.IsProcessWithArrears)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Arr"))break;if(!C.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;s=new X.O7,s.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Arr",s.DisplayMember=l+a[i].SNo.toString()+"_Arr",s.ID=l+a[i].SNo.toString()+"_Arr",s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",s.Width=80,"-1"!=C.J0.String(a[i].Visible)&&(s.IsVisible="1"==C.J0.String(a[i].Visible)),"-1"!=C.J0.String(a[i].Width)&&(s.Width=parseInt(a[i].Width)),"-1"!=C.J0.String(a[i].IndexValue)&&(s.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=C.J0.String(a[i].Mandatory)&&(s.Mandatory="1"==C.J0.String(a[i].Mandatory));let n=this.dgvEmployees.Columns.find(d=>d.DisplayMember==l+a[i].SNo.toString());null!=n&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(n)+1,s),this.dgvEmployees.TableColumns.push(s.DisplayMember))}if(this.IsProcessWithAdjustments)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Adj"))break;if(!C.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;s=new X.O7,s.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Adj",s.DisplayMember=l+a[i].SNo.toString()+"_Adj",s.ID=l+a[i].SNo.toString()+"_Adj",s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",s.Width=80,"-1"!=C.J0.String(a[i].Visible)&&(s.IsVisible="1"==C.J0.String(a[i].Visible)),"-1"!=C.J0.String(a[i].Width)&&(s.Width=parseInt(a[i].Width)),"-1"!=C.J0.String(a[i].IndexValue)&&(s.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=C.J0.String(a[i].Mandatory)&&(s.Mandatory="1"==C.J0.String(a[i].Mandatory));let n=this.dgvEmployees.Columns.find(d=>d.DisplayMember==l+a[i].SNo.toString());null!=n&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(n)+1,s),this.dgvEmployees.TableColumns.push(s.DisplayMember))}}}btnUnPost_Click(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1,r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnFilter_Click(){this.sFilter="",r.d.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(r.d.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new o.t("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new o.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),r.d.page.ShowDialog(this.objEmpFilter,gt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,s="",i="",n="";for(let d=0;d<this.objEmpFilter.CostCenterFilters.length;d++){let h=this.objEmpFilter.CostCenterFilters[d];if(h.CostCenterID>5e4&&(l=2,s="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)n+=" AND ",n+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(c=>c.Id==l&&c.IsGroup))if(n+=" AND ",ht.IPrefetchFilter.IsGroupTree(h)){let c="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(c.length>0&&(c+=","),c+=h.SelectedNodes[g].Id);0==c.length&&(c+=-12912),n+=i+" IN ",n+=" (select T."+s+" GTID from "+ze.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+ze.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",n+=c.toString()+")  group by T."+s+")"}else{n+=i+" IN (";for(let c=0;c<h.SelectedNodes.length;c++)c>0&&(n+=","),n+=h.SelectedNodes[c].Id;n+=")"}}else h.DeleteButtonVisibility||(n+=" AND ",n+=i+"=-12912")}this.sFilter=n.toString()}if(this.objEmpFilter.Filter>0){this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let l=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=l.Trim()&&"None"!=l&&(this.sFilter+="TreeView"==l?" ORDER BY EMP.lft ":" ORDER BY EMP."+l);let s=[];s.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),s.push(this.sFilter),s.push(0),s.push(r.d.SessionManager.RoleID),s.push(r.d.SessionManager.UserID),s.push(r.d.SessionManager.LanguageID);let n,i=r.d.empService.GetData(s,"spPAY_GetEmpMasterCCDetails");if(this.btnClear_Click(),null!=i&&i.Tables.length>0&&i.Tables[0].length>0){if(n=i.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let d=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayroll"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53);if(null!=d&&d.length>0&&null!=d[0].Value&&null!=d[0].Value&&""!=d[0].Value.toString()&&"True"==d[0].Value.toString()&&(d=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayrollDays"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53),null!=d&&d.length>0&&null!=d[0].Value&&null!=d[0].Value&&""!=d[0].Value.toString())){let h=0;if(h=parseInt(d[0].Value),h>0){let c=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),h),g=i.Tables[0].filter(D=>new Date(D.DOJ)<=c);null!=g&&g.length>0&&(i=[],i=g)}}i.sort((h,c)=>c.CCNID53-h.CCNID53),n=i}this.AddGradeApplicableColumns(n);for(let d=0;d<n.length;d++){let h=this.dgvEmployees.NewRow();h.EmpSeqNo=n[d].EmpSeqNo,h.EmpCode=n[d].EmpCode,h.EmpName=n[d].EmpName,h.GradeID=n[d].CCNID53,h.SNo=(d+1).toString(),h.Select=!1;let c,g="";for(let D=0;D<this.dgvEmployees.TableColumns.length;D++)g=this.dgvEmployees.TableColumns[D],(g.startsWith("dcAlpha")||g.startsWith("dcCCNID"))&&(c=this.dsDocDesig.Tables[0].filter(p=>p.SysColumnName==g),null!=c&&c.length>0&&(C.J0.IsEmpty(c[0].UserColumnType)||("LISTBOX"==c[0].UserColumnType.toString().toUpperCase()?C.J0.IsEmpty(c[0].UserDefaultValue)||(h[g+"_Key"]=c[0].UserDefaultValue.toString()):"TEXT"==c[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==c[0].UserColumnType.toString().toUpperCase()?C.J0.IsEmpty(c[0].UserDefaultValue)||(h[g]=c[0].UserDefaultValue.toString()):"DATE"==c[0].UserColumnType.toString().toUpperCase()&&(C.J0.IsEmpty(c[0].UserDefaultValue)||"TODAY"==c[0].UserDefaultValue.toString().toUpperCase()&&(h[g]=(new Date).ToString(r.d.SessionManager.Preferences["Date Format"]),this.dgvEmployees.TableColumns.Contains(g+"_Key")&&(h[g+"_Key"]=new Date))))));this.dgvEmployees.addRow(h),this.dgvEmployees.RefreshGrid=!0}}}}}),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}AddGradeApplicableColumns(a){let l,s="";if(null!=(a=a.ToTable(!0,["CCNID53"]))&&a.length>0)for(let n=0;n<a.length;n++)!C.J0.IsEmpty(s)&&s.length>0&&(s+=","),s+=a[n].CCNID53.toString();if(!C.J0.IsEmpty(s)&&s.length>0&&(l=r.d.common.GetDataSet3("PAY125",s,r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"")),null!=l&&l.Tables.length>0){let n=this.dsStructure.Tables[0].filter(c=>1==c.Type);if(n.sort((c,g)=>c.SNo-g.SNo),null!=n&&n.length>0)for(let c=0;c<n.length;c++)this.dgvEmployees.TableColumns.Contains("Earning"+n[c].SNo)?(this.dgvEmployees.TableColumns.Remove("Earning"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(g=>g.DisplayMember=="Earning"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i)):this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+n[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTHrs"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="EarningOTHrs"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+n[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTAmt"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="EarningOTAmt"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i)));if(n=this.dsStructure.Tables[0].filter(c=>2==c.Type),null!=n&&n.length>0)for(let c=0;c<n.length;c++)if(this.dgvEmployees.TableColumns.Contains("Deduction"+n[c].SNo))this.dgvEmployees.TableColumns.Remove("Deduction"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="Deduction"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i);else if(this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+n[c].SNo)){var i;this.dgvEmployees.TableColumns.Remove("DeductionOTHrs"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="DeductionOTHrs"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+n[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("DeductionOTAmt"+n[c].SNo),null!=(i=this.dgvEmployees.Columns.find(p=>p.DisplayMember=="DeductionOTAmt"+n[c].SNo))&&this.dgvEmployees.Columns.Remove(i))}let d=this.dgvEmployees.Columns.find(c=>"TotalDays"==c.DisplayMember);null!=d&&(this.iColId=this.dgvEmployees.Columns.indexOf(d)),n=l.Tables[0].filter(c=>1==c.Type),n.sort((c,g)=>c.SNo-g.SNo),this.AddEarDedColumns(n,"Earning"),d=this.dgvEmployees.Columns.find(c=>"TotalEarnings"==c.DisplayMember),null!=d&&(this.iColId=this.dgvEmployees.Columns.indexOf(d)),n=l.Tables[0].filter(c=>2==c.Type),n.sort((c,g)=>c.SNo-g.SNo),this.AddEarDedColumns(n,"Deduction");let h=[];for(let c=0;c<this.dgvEmployees.Columns.length;c++)h.push(this.dgvEmployees.Columns[c]);if(this.dgvEmployees.Columns=h,this.dtCust=r.d.common.GetDataTable("PAY059",r.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let c=new C.VB;if(c.ReadXml(this.dtCust[0].ValueXml.toString()),null!=c&&c.Tables.length>0&&c.Tables[0].length>0){let g,D=3;for(let p=0;p<this.dgvEmployees.Columns.length;p++)g=c.Tables[0].filter(t=>t.SysColumnName==this.dgvEmployees.Columns[p].CrRefColName),g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=c.Tables[0].filter(t=>t.ID==this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=c.Tables[0].filter(t=>t.ID==-this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):this.dgvEmployees.Columns[p].DisplayIndex=p))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}}}AddEarDedColumns(a,l){if(null!=a&&a.length>0){let s;for(let i=0;i<a.length;i++)C.J0.IsEmpty(a[i].Behaviour)||"Accruals"!=a[i].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=a[i].Behaviour.toString()?(s=new X.O7,s.Header=this.GetResource(a[i].ComponentCode.toString(),50052),s.DisplayMember=l+a[i].SNo.toString(),s.ID=l+a[i].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",s.Width=80,"OverTime"==a[i].FieldType.toString()?(s.DisplayMember="EarningOTHrs"+a[i].SNo.toString(),s.ID="EarningOTHrs"+a[i].SNo.toString(),s.DecimalPoints="2",s.Width=60,s.ReadOnly=!1):"Monthly"==a[i].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=C.J0.String(a[i].Visible)&&(s.IsVisible="1"==C.J0.String(a[i].Visible)),"-1"!=C.J0.String(a[i].Width)&&(s.Width=parseInt(a[i].Width)),"-1"!=C.J0.String(a[i].IndexValue)&&(s.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(s.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=C.J0.String(a[i].Mandatory)&&(s.Mandatory="1"==C.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,s),this.dgvEmployees.TableColumns.push(s.DisplayMember),"OverTime"==a[i].FieldType.toString()&&(s=new X.O7,s.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Amount",s.CrRefColID=parseInt(a[i].ComponentID),s.DisplayMember=l+"OTAmt"+a[i].SNo.toString(),s.ID=l+"OTAmt"+a[i].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.Width=80,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.ForeColor="Gray",s.HeaderBackColor="LightBlue","-1"!=a[i].Visible.toString()&&(s.IsVisible="1"==a[i].Visible.toString()),"-1"!=a[i].Width.toString()&&(s.Width=parseInt(a[i].Width)),"-1"!=a[i].IndexValue.toString()&&(s.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(s.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=a[i].Mandatory.toString()&&(s.Mandatory="1"==a[i].Mandatory.toString()),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,s),this.dgvEmployees.TableColumns.push(s.DisplayMember))):(s=new X.O7,s.Header=this.GetResource(a[i].ComponentCode.toString(),50052),s.DisplayMember=l+a[i].SNo.toString(),s.ID=l+a[i].SNo.toString(),s.DataType="FLOAT",s.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,s.ReadOnly=!0,s.ShowTotal=!0,s.IsCalculated=1,s.HeaderBackColor="GreenYellow",s.Width=80,"Monthly"==a[i].FieldType.toString()?s.ReadOnly=!1:s.ForeColor="Gray","-1"!=C.J0.String(a[i].Visible)&&(s.IsVisible="1"==C.J0.String(a[i].Visible)),"-1"!=C.J0.String(a[i].Width)&&(s.Width=parseInt(a[i].Width)),"-1"!=C.J0.String(a[i].IndexValue)&&(s.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(s.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=C.J0.String(a[i].Mandatory)&&(s.Mandatory="1"==C.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,s),this.dgvEmployees.TableColumns.push(s.DisplayMember))}}bgworker_DoWork(a,l){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}ProcessPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let d,s="",i="",n=new Array,h=!1,c=0;for(let g=0;g<this.dgvEmployees.Table.length;g++)if((0,se.yG0)(this.dgvEmployees.Table[g].Select)&&(s+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,c=0,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let D=0;D<n.length;D++)if(n[D].GradeID==parseInt(this.dgvEmployees.Table[g].GradeID)){c=D,h=!0;break}h?(i=n[c].sEmpIds,i+=","+this.dgvEmployees.Table[g].EmpSeqNo.toString(),n[c].sEmpIds=i,n[c].lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo))):(d=new mt.ii,d.GradeID=parseInt(this.dgvEmployees.Table[g].GradeID),d.sEmpIds=this.dgvEmployees.Table[g].EmpSeqNo.toString(),d.lstGradeEmps=new Array,d.lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo)),n.push(d))}if(s.length>0&&l>0){if(s=s.substr(0,s.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let g=[];g.push(s),g.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(C.J0.IntTryParse(r.d.SessionManager.UserID)),g.push(r.d.SessionManager.LanguageID),this.dsDailyAttendanceData=r.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new Ke.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=s,r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()&&(this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0)),this.oCMP.PayrollMonth=r.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=n,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let D=0;D<n.length;D++)n[D].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=n[D].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=n[D].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=n[D].GradePayrollMonthEnd);this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);let g=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(g=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(D=>D.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==D.VoucherType)),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(C.J0.IsEmpty(g[0].dcAlpha21)||""==C.J0.String(g[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=g[0].dcAlpha21.toString()),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=g[0].dcAlpha22.toString());let D=r.d.common.GetDataTable("PAY099",C.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=D&&D.length>0){let p=r.d.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let t=0;t<D.length;t++){let T=C.J0.ParseDate(D[t].ArrearsCalcMonths);if(null!=p&&p.length>0){let P=p.filter(A=>A.ArrAdjMonth==T);if(null!=P&&P.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].ArrData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].ArrData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][D].dArrear="0";for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][D].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}if(this.IsProcessWithAdjustments){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(C.J0.IsEmpty(g[0].dcAlpha32)||""==C.J0.String(g[0].dcAlpha32).Trim())this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=g[0].dcAlpha32.toString()),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=g[0].dcAlpha33.toString());let D=r.d.common.GetDataTable("PAY113",C.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy")+"~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);if(null!=D&&D.length>0){let p=r.d.common.GetDataTable("PAY114",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let t=0;t<D.length;t++){let T=C.J0.ParseDate(D[t].AdjMonth);if(null!=p&&p.length>0){let P=p.filter(A=>A.ArrAdjMonth==T);if(null!=P&&P.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].AdjData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].AdjData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][D].dAdjusted="0";for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][D].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=""),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.IsProcessWithAdjustments&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(D=>(0,se.yG0)(D.Select)).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}CalculateArrears(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];let l=new Array,s=r.d.empService.GetQueryData(a,"ARE001",r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"","");if(null!=s&&s.Tables[0].length>0){let i=C.J0.ParseDate(s.Tables[0][0].DtApplyFrom.toString()),n=C.J0.ParseDate(s.Tables[0][0].DtEffectFrom.toString()),d=s.Tables[1][0].ArrCalcMonths.toString().Replace("/"," ");if(n>i&&r.d.SessionManager.PayrollMonth>=n){let h=i;for(;h<n;)d.Contains(h.ToString("dd MMM yyyy"))||l.push(h.ToString("dd MMM yyyy")),h=h.AddMonths(1)}}if(l.length>0){let n,d,i="";for(let D=0;D<l.length;D++)i.length>0&&(i+=";"),i+=l[D],n={},n.PayrollMonth=l[D],this.dtArrData.push(n);let h="'"+i.Replace(";","','")+"'",c=r.d.common.GetDataSet3("PAY079",a.toString(),h).Tables[0];if(null!=c&&c.length>0){d=c.filter(D=>11==D.VoucherType);for(let D=0;D<d.length;D++)this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.length>0&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+=";"),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+C.J0.String(d[D].PaidDays)}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=i;let g=i.split(";");if(g.length>0){for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][F].dArrear="0";for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][F].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0;let t,T,D=r.d.common.GetDataTable("PAY098",""),p=r.d.common.GetDataSet3("PAY101",a.toString(),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),A=0;for(let F=0;F<g.length;F++)if(null!=g[F]&&""!=g[F]&&(d=c.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")),d.length>0)){let j=D.filter(N=>N.GradeID==d[0].dcCCNID53&&new Date(N.CPayrollDate)<=new Date(g[F])).Compute("max","CPayrollDate"),f=D.filter(N=>N.GradeID==d[0].dcCCNID53&&new Date(N.CPayrollDate)==new Date(j.ToString())),E=new Ke.O;if(E.oParent=this,E.sSelectedEmpSeqNos=a.toString(),E.PayrollMonth=r.d.SessionManager.PayrollMonth,E.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,E.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,E.drcArrStructure=f,E.IsArrearclick=!0,E.ArrGradeID=parseInt(d[0].dcCCNID53),E.ProcessPayroll(),E.IsCompleted){E.arrLstOthMPFields[0].TotalDays=parseFloat(d[0].TotalDays),E.arrLstOthMPFields[0].MonthDays=parseFloat(d[0].TotalDays),E.arrLstOthMPFields[0].PaidLeaves=parseFloat(d[0].dcAlpha24),E.arrLstOthMPFields[0].TotalLeaves=parseFloat(d[0].LeavesTaken),E.arrLstOthMPFields[0].WeeklyOffs=parseFloat(d[0].WOffs),E.arrLstOthMPFields[0].Holidays=parseFloat(d[0].Holidays);let N=parseFloat(d[0].TotalDays.toString())-parseFloat(d[0].LOPDays.toString())-parseFloat(d[0].LeavesTaken.toString())-parseFloat(d[0].UnpaidDays.toString());t=p.Tables[0].filter(V=>V.AdjMonth==C.J0.ParseDate(g[F])),null!=t&&t.length>0&&(N+=parseFloat(t[0].Days)),T=p.Tables[1].filter(V=>2==V.DType&&V.ArrAdjMonth==C.J0.ParseDate(g[F])),E.SetDaysAttended(0,"Days Attended",N);let ee=0,q=-1,H=0;d=c.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears)for(let ie=0;ie<E.arrLstCPFields[0][0].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==E.arrLstCPFields[0][0][ie].SNo){H=0,A=0,q=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,C.J0.IsEmpty(d[0]["dcCalcNum"+q])||(H=parseFloat(d[0]["dcCalcNum"+q])),null!=T&&T.length>0&&(C.J0.IsEmpty(T[0]["Earning"+q])||(A=parseFloat(T[0]["Earning"+q]))),ee=parseFloat(E.arrLstCPFields[0][0][ie].dEarned)-H-A,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData+=g[F]+","+ee+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dArrear)+ee).ToString(r.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+=ee);break}d=c.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears)for(let ie=0;ie<E.arrLstCPFields[0][2].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==E.arrLstCPFields[0][2][ie].SNo){H=0,A=0,q=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=d[0]["dcCalcNum"+q]&&null!=d[0]["dcCalcNum"+q]&&""!=d[0]["dcCalcNum"+q].toString()&&(H=parseFloat(d[0]["dcCalcNum"+q])),null!=T&&T.length>0&&null!=T[0]["Deduction"+q]&&null!=T[0]["Deduction"+q]&&""!=T[0]["Deduction"+q].toString()&&(A=parseFloat(T[0]["Deduction"+q])),ee=parseFloat(E.arrLstCPFields[0][2][ie].dEarned)-H-A,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData+=g[F]+","+ee+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dArrear)+ee).ToString(r.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+=ee);break}}E.IsArrearclick=!1}let _="",x="";_=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays,x=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=_,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=x,this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+l.Message+"\r\n"+l.stack)}}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,c,l=[],s=r.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,n=r.d.SessionManager.PayrollMonth.AddMonths(-1),d=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;n>=d;){if(c=s.filter(D=>D.PayrollMonth&&C.J0.ParseDate(D.PayrollMonth).ToString("dd/MMM/yyyy")==n.ToString("dd/MMM/yyyy")),null!=c&&c.length>0){if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy");let D,p,t,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t};if(C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=C.J0.GetEmployeeGrade(a.toString(),D,p,t),_>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t},C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T,_),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd)}let P=[];P.push(a),P.push(D.ToString("dd/MMM/yyyy")),P.push(p.ToString("dd/MMM/yyyy")),P.push(t.ToString("dd/MMM/yyyy")),P.push(0),P.push(r.d.SessionManager.UserID),P.push(r.d.SessionManager.RoleID),P.push(r.d.SessionManager.LanguageID);let A=r.d.empService.ExecuteQuery_SP(P,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(t.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(r.d.SessionManager.RoleID),_.push(r.d.SessionManager.UserID),_.push(r.d.SessionManager.LanguageID);let x=r.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),F=new mt.mr,j=F.AggregateLeaves(a.toString(),A,p,t,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);j>0&&(h.Days=-j),g=F.lstPrevAdj}l.push(h)}if(null!=g&&g.length>0&&r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let D=0;D<g.length;D++)g[D].PrevMonth.ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy"),h.Days=g[D].dDays,l.push(h))}else if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy");let D,p,t,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t};C.J0.SetPayrollDate_1(i,T),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd;let P=r.d.SessionManager.PayrollMonth,A=0;r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=C.J0.GetEmployeeGrade(a.toString(),D,p,t),A>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t},C.J0.SetPayrollDate(i,T,A),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd),C.J0.SetPayrollMonth(D,r.d.SessionManager,A)),C.J0.SetPayrollMonth(D,r.d.SessionManager,A);let _=new Ke.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=r.d.SessionManager.PayrollMonth,_.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),C.J0.SetPayrollMonth(P),l.push(h)}n=n.AddMonths(-1)}if(null!=l&&l.length>0)for(let D=0;D<l.length;D++)null!=l[D].Days&&null!=l[D].Days&&""!=l[D].Days.toString().Trim()&&(h={},h.PayrollMonth=r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[D].PayrollMonth.toString(),h.Days=l[D].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let D=0;D<this.dtAdjData.length;D++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[D].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[D].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=r.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),C.J0.SetPayrollMonth(a,r.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let s,i,n,l="";for(let t=0;t<this.dtAdjData.length;t++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[t].AdjMonth).ToString("dd MMM yyyy")+"'";let d=r.d.empService.GetQueryData(a,"MPL010",l,"","");for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dAdjusted="0";for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=r.d.empService.GetQueryData(0,"MPL014","","",""),c=r.d.empService.GetQueryData(a,"MPL005","","",""),g=r.d.empService.GetQueryData(a,"MPL011",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),D="";for(let t=0;t<this.dtAdjData.length;t++){let T=new Date(this.dtAdjData[t].AdjMonth),P=T;s=d.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==j.VoucherType);let A=null;if(null!=s&&s.length>0){let j=h.filter(f=>f.GradeID==s[0].dcCCNID53&&f.CPayrollDate<=P.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(f=>f.GradeID==s[0].dcCCNID53&&f.CPayrollDate==C.J0.String(j))}if(D="'"+T.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+T.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=c.filter(j=>T.ToString("dd/MMM/yyyy")>=j.ApplyFrom&&T.ToString("dd/MMM/yyyy")<=j.EffectFrom),p=p.sort((j,f)=>j.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(j=>j.ArrearsCalcMonths==C.J0.ParseDate(T)),n=g.Tables[1].filter(j=>1==j.DType&&j.ArrAdjMonth==C.J0.ParseDate(T)),null!=p&&p.length>0){let j=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let E=0;E<f.length;E++)C.J0.ParseDate(f[E]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(j=!0)}null!=i&&i.length>0||j?(T=C.J0.ParseDate(p[0].EffectFrom),r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T)):r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T)}else r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T);let _=parseFloat(this.dtAdjData[t].Days),x=0;x="Actual Days"!=r.d.SessionManager.Preferences.PayDays?parseInt(r.d.SessionManager.Preferences.PayDays):T.DaysInMonth();let F=new Ke.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=r.d.SessionManager.PayrollMonth,F.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=s&&s.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=C.J0.Int(s[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let j=0;null!=s&&s.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(s[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(s[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(s[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(s[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(s[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(s[0].Holidays),j=parseFloat(s[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",j)):C.J0.ParseDate(this.dtAdjData[t].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&C.J0.ParseDate(this.dtAdjData[t].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let H,f=0,E=-1,N=0,ee=0,q=0;s=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)for(let ie=0;ie<F.arrLstCPFields[0][0].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==F.arrLstCPFields[0][0][ie].SNo){if(N=0,ee=0,q=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,!C.J0.IsEmpty(s)&&s.length>0&&!C.J0.IsEmpty(s[0]["dcCalcNum"+E])&&(N=parseFloat(s[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.split(";"),null!=H&&H.length>0))for(let me=0;me<H.length;me+=2)new Date(H[me]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(ee=parseFloat(H[me+1]));null!=n&&n.length>0&&null!=n[0]["Earning"+E]&&null!=n[0]["Earning"+E]&&""!=n[0]["Earning"+E]&&(q=parseFloat(n[0]["Earning"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,se.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][ie].ComponentName?parseFloat(F.arrLstCPFields[0][0][ie].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][ie].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData=C.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData+=P.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}s=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments)for(let ie=0;ie<F.arrLstCPFields[0][2].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==F.arrLstCPFields[0][2][ie].SNo){if(N=0,ee=0,q=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=s&&s.length>0&&null!=s[0]["dcCalcNum"+E]&&null!=s[0]["dcCalcNum"+E]&&""!=s[0]["dcCalcNum"+E].toString()&&(N=parseFloat(s[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.split(";"),null!=H&&H.length>0))for(let me=0;me<H.length;me+=2)new Date(H[me]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(ee=parseFloat(H[me+1]));null!=n&&n.length>0&&null!=n[0]["Deduction"+E]&&null!=n[0]["Deduction"+E]&&""!=n[0]["Deduction"+E]&&(q=parseFloat(n[0]["Deduction"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,se.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][ie].ComponentName?parseFloat(F.arrLstCPFields[0][2][ie].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][ie].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData=C.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData+=P.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(s=>s.EmpSeqNo==a),l.length>0&&C.J0.ParseDate(l[0].cEffectFrom).getFullYear()==r.d.SessionManager.PayrollMonth.getFullYear()&&C.J0.ParseDate(l[0].cEffectFrom).iMonth()==r.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let s="",i=0,n=0,d=0,h=0,c=0,g=0,D=0,p=0,t=0,T=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)s.length>0&&(s+=","),s+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let P=r.d.empService.GetQueryData(a,"CONS002",JSON.stringify(s),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=r.d.empService.GetQueryData(0,"CONS003","","","");if(null!=P&&P.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(n=0,d=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<P.length;F++)c=parseFloat(P[F].TotalDays),h=parseFloat(P[F].DaysAttended)+parseFloat(P[F].PaidLeaves)+parseFloat(P[F].LOPDays),g=parseFloat(P[F]["dcCalcNum"+T]),D=parseFloat(P[F]["dcCalcNumFC"+T]),p=parseFloat((h/c*i).ToString(r.d.SessionManager.sPayrollDecimals)),t=parseFloat((p-g).ToString(r.d.SessionManager.sPayrollDecimals)),n+=parseFloat(t.ToString(r.d.SessionManager.sPayrollDecimals)),d+=D;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(n-d).ToString(r.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<P.length;x++){let F=A.filter(E=>E.GradeID==parseInt(P[x].GradeID)&&E.CPayrollDate==C.J0.ParseDate(P[x].PayrollDate)).Compute("max","CPayrollDate"),j=A.filter(E=>E.GradeID==parseInt(P[x].GradeID)&&E.CPayrollDate==F),f=new Ke.O;if(f.oParent=this,f.sSelectedEmpSeqNos=a.toString(),f.PayrollMonth=r.d.SessionManager.PayrollMonth,f.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,f.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,f.drcArrStructure=j,f.IsCalculateAccruals=!0,f.ArrGradeID=parseInt(P[x].GradeID),f.ProcessPayroll(),f.IsCompleted){f.arrLstOthMPFields[0].TotalDays=parseFloat(P[x].TotalDays),f.arrLstOthMPFields[0].MonthDays=parseFloat(P[x].TotalDays),f.arrLstOthMPFields[0].PaidLeaves=parseFloat(P[x].PaidLeaves),f.arrLstOthMPFields[0].TotalLeaves=parseFloat(P[x].LeavesTaken),f.arrLstOthMPFields[0].WeeklyOffs=parseFloat(P[x].WOffs),f.arrLstOthMPFields[0].Holidays=parseFloat(P[x].Holidays),h=parseFloat(P[x].TotalDays.toString())-parseFloat(P[x].LOPDays.toString())-parseFloat(P[x].LeavesTaken.toString())-parseFloat(P[x].UnpaidDays.toString()),f.SetDaysAttended(0,"Days Attended",h);let E=0,N=-1,ee=0,q=0;for(let H=0;H<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].Behaviour)for(let V=0;V<f.arrLstCPFields[0][0].length;V++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].SNo==f.arrLstCPFields[0][0][V].SNo){ee=0,q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].SNo,null!=P[x]["dcCalcNum"+N]&&null!=P[x]["dcCalcNum"+N]&&""!=P[x]["dcCalcNum"+N].toString()&&(ee=parseFloat(P[x]["dcCalcNum"+N])),null!=P[x]["dcCalcNumFC"+N]&&null!=P[x]["dcCalcNumFC"+N]&&""!=P[x]["dcCalcNumFC"+N].toString()&&(q=parseFloat(P[x]["dcCalcNumFC"+N])),E=parseFloat(f.arrLstCPFields[0][0][V].dEarned)-ee,this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].dPrevAccEar+=parseFloat(E.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].dPrevAccAdj+=q;break}for(let H=0;H<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].Behaviour)for(let V=0;V<f.arrLstCPFields[0][2].length;V++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].SNo==f.arrLstCPFields[0][2][V].SNo){ee=0,q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].SNo,null!=P[x]["dcCalcNum"+N]&&null!=P[x]["dcCalcNum"+N]&&""!=P[x]["dcCalcNum"+N].toString()&&(ee=parseFloat(P[x]["dcCalcNum"+N])),null!=P[x]["dcCalcNumFC"+N]&&null!=P[x]["dcCalcNumFC"+N]&&""!=P[x]["dcCalcNumFC"+N].toString()&&(q=parseFloat(P[x]["dcCalcNumFC"+N])),E=parseFloat(f.arrLstCPFields[0][2][V].dEarned)-ee,this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].dPrevAccEar+=parseFloat(E.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].dPrevAccAdj+=q;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals))}}}}FillProcessedData(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;l++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo)&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dArrear).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dAdjusted).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;l++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dActual).ToString(r.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;l++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo)&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dArrear).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dAdjusted).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;l++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dActual).ToString(r.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;l++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt&&(this.dgvEmployees.Table[a]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo]=C.J0.Double(this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;l++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo)&&(this.dgvEmployees.Table[a]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].LeaveTaken).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;l++)if(this.dgvEmployees.TableColumns.Contains(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName))if("LISTBOX"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldDataType){if("EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue){let s=r.d.SessionManager.dtFeatures.filter(i=>i.FeatureID==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName.Replace("dcCCNID",""))+5e4);if(null!=s&&s.length>0){let i=r.d.empService.GetQueryData(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,"CONS001",s[0].TableName.toString(),"","");null!=i&&i.length>0&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=i[0].Name.toString(),this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)}}}else"DATE"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldUserColumnType?"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=C.J0.ParseDate(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)))):"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[a].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[a].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[a].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[a].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[a].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[a].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[a].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[a].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[a].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[a].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[a].TotalEarnings=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[a].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[a].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[a]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}CheckViewForUser(a){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(let l=0;l<this.dgvEmployees.Columns.length;l++)this.SetView(this.dgvEmployees.Columns[l])}SetView(a){let l=this.dsDocDesig.Tables[6],s=this.dsDocDesig.Tables[0];l=l.filter(i=>1==i.Mode||2==i.Mode||3==i.Mode||4==i.Mode),a instanceof X.O7&&(l=a.CrRefColID>0?l.filter(i=>i.CostCenterColID==1e6+a.CrRefColID):null!=a.CrRefColName&&""!=a.CrRefColName&&a.CrRefColName.startsWith("dcAlpha")?l.filter(i=>i.SysColumnName==a.CrRefColName):[]),l.length>0?(a instanceof X.O7&&(a.IsVisible=(0,se.yG0)(l[0].IsVisible.toString())),C.J0.IsEmpty(l[0].IsMandatory)||a instanceof X.O7&&(a.Mandatory=(0,se.yG0)(l[0].IsMandatory)),a instanceof X.O7&&(a.ReadOnly=!(0,se.yG0)(l[0].IsEditable)),a instanceof X.O7&&(a.Expression=C.J0.String(l[0].Expression)),a instanceof X.O7&&(a.Message=C.J0.String(l[0].FailureMessage)),C.J0.IsEmpty(l[0].ActionOptionID)?a instanceof X.O7&&(a.Action=0):a instanceof X.O7&&(a.Action=parseInt(l[0].ActionOptionID)),C.J0.IsEmpty(l[0].NumFieldEditOptionID)?a instanceof X.O7&&(a.EditOption=0):a instanceof X.O7&&(a.EditOption=parseInt(l[0].NumFieldEditOptionID.toString()))):(a instanceof X.O7&&(s="combobox"==a.DataType.toLowerCase()?s.filter(i=>i.SysColumnName==a.ValueBinding):s.filter(3==a.CostCenterID||2==a.CostCenterID?i=>i.CostcenterColid==a.ID:i=>i.SysColumnName==a.DisplayMember)),s.length>0&&(a instanceof X.O7&&(r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==a.CostCenterID||r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()&&50002==a.CostCenterID||(a.ReadOnly=!(0,se.yG0)(s[0].IsEditable.toString()))),C.J0.IsEmpty(s[0].IsMandatory)||a instanceof X.O7&&(a.Mandatory=(0,se.yG0)(s[0].IsMandatory)),a instanceof X.O7&&(a.IsVisible=(0,se.yG0)(s[0].IsVisible.toString()))),a instanceof X.O7&&(a.EditOption=0),a instanceof X.O7&&(a.Expression=""),a instanceof X.O7&&(a.Message=""),a instanceof X.O7&&(a.Action=0))}UnPostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let s="";for(let i=0;i<this.dgvEmployees.Table.length;i++)(0,se.yG0)(this.dgvEmployees.Table[i].Select)&&(s+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(s.length>0&&l>0){s=s.substr(0,s.length-1);let n,i=s.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...";let d=r.d.common.GetDataSet3("PAY061",s,r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0];for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(n=d.filter(c=>c.EmpSeqNo==i[h]),null!=n&&n.length>0){let c=0,g=[];g.push(this.CostCenterID),g.push(parseInt(n[0].DocID)),g.push(1);let D=r.d.document.DeleteSelectedRows(g,c);this.strResult=D.Message,c=D.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.dgvEmployees.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.dgvEmployees.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(c=>(0,se.yG0)(c.Select)).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}PostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(let s=0;s<this.dgvEmployees.Table.length;s++)(0,se.yG0)(this.dgvEmployees.Table[s].Select)&&l++;if(l>0){a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Posting data, please wait...";for(let s=0;s<this.dgvEmployees.Table.length;s++)if((0,se.yG0)(this.dgvEmployees.Table[s].Select)){let i=this.oCMP.arrLstOthMPFields.find(n=>n.EmpSeqNo==this.dgvEmployees.Table[s].EmpSeqNo.toString());if(this.iEmpIndex=this.oCMP.arrLstOthMPFields.indexOf(i),this.iEmpIndex>=0){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let n=0;n<this.oCMP.GradeMPFls.length;n++)this.oCMP.GradeMPFls[n].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[n].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[n].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[n].GradePayrollMonthEnd);if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let n=r.d.common.GetDataTable("PAY087",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+r.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+r.d.SessionManager.UserID+","+r.d.SessionManager.RoleID);null!=n&&n.length>0&&(!C.J0.IsEmpty(n[0].CanApprove)&&"TRUE"==n[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0?(this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[s].Result=this.strResult):(this.strResult="",this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a)}this.IsProcessed=!1}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(i=>(0,se.yG0)(i.Select)).length>0&&(this.DisplayMessage="Posted Successfully",r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}ValidatePosting(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=r.d.SessionManager.Preferences.PayrollProduct&&""!=r.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(r.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(let a=0;a<this.dgvEmployees.Columns.length;a++)if(this.dgvEmployees.Columns[a].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[a].ID.endsWith("_Key")&&this.dgvEmployees.Columns[a].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[a].DataType&&""==C.J0.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[a].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[a].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(r.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",a),!1}}SaveVoucher(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(r.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(r.d.SessionManager.LocationID>0?r.d.SessionManager.LocationID:1):l.push(0),r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(r.d.SessionManager.DivisionID>0?r.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(r.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(r.d.SessionManager.CompanyGUID),l.push(r.d.SessionManager.UserName),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),l.push(r.d.SessionManager.IsOffline);let s="",i="",n=r.d.document.SetTempInvDocumentPostPayroll(l);a=n.obj;let d=n;s=null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("ErrorMessage")?d.Tables[d.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a=n.obj,a>0?null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("VoucherNo")&&(i=d.Tables[d.Tables.length-1][0].VoucherNo.toString()):null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==d.Tables[d.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=s,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+a.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}GetDocumentXML(){let a,l="",s="",i="",n="",d="",h="",c=new Array,g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended.toString()+"'",i+='<Alpha Query="',i+=g;for(let t=0;t<this.dgvEmployees.TableColumns.length;t++)this.dgvEmployees.TableColumns[t].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[t].endsWith("_Key")&&(d+=" "+this.dgvEmployees.TableColumns[t]+"='"+C.J0.EncodeXML(C.J0.StringValue(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[t]]))+"',");d+=" ",d.length>0&&(i+=","+d),i+='" ></Alpha>',d="",n+='<CostCenters Query="',d+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",d+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?d+=" dcCCNID68=1,":d+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",c.push("dcCCNID51"),c.push("dcCCNID53"),c.push("dcCCNID68");let D="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let t=0;t<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0]).length;t++)D=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0])[t].toString(),p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][D].toString(),D.Contains("CCNID")&&"CCNID51"!=D&&"CCNID53"!=D&&"CCNID68"!=D&&(d+=" dc"+D+"="+p+",",c.Contains("dc"+D)||c.push("dc"+D));for(let t=0;t<this.dgvEmployees.TableColumns.length;t++)this.dgvEmployees.TableColumns[t].startsWith("dcCCNID")&&(c.Contains(this.dgvEmployees.TableColumns[t])||this.dgvEmployees.TableColumns[t].endsWith("_Key")||(d+=" "+this.dgvEmployees.TableColumns[t]+"="+C.J0.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[t]+"_Key"].toString())+","));if(d.length>0&&(n+=d),n+='" ></CostCenters>',s+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+C.J0.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo&&!C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo)&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;t++)C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dEarned.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dAdjusted.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;t++)!C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].IsVisible&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanActInstAmt.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanInstAmt.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanBalAmt.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanPayStatus+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;t++)C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveTotOPBal.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].EncashLeavetaken.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveMonOPBal.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveNetBal.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",s="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let d=0;d<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;d++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[d].InvDocDetailsID.toString();let n="";if(n+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?a.length>0?'<XML DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML DetailIds="'+a+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let d,h,c,g,D,t,p="0";if(l=s="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),n+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let T=0;null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"CreditAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"DebitAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(s=i[0].UserDefaultValue.toString()));for(let P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;P++)if(!C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].IsVisible&&!C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt)){d=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanDocNo,c=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstNo,D=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.Replace(",","");let A=parseInt(c);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==d&&j.dcAlpha5==r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),null!=t&&t.length>0&&(A=parseInt(t[0].dcNum1))):(r.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==r.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==d&&j.InstallmentNo==A),t.SortBy(["InstallmentNo"])):(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==d&&j.InstBalance>0&&j.InstallmentNo<A),t.SortBy(["InstallmentNo"])),null!=t&&t.length>0&&(A=parseInt(t[0].InstallmentNo)));let _=parseFloat(D),x=0,F=0;do{if(T++,t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==d&&j.InstallmentNo==A),h=t[0].InvDocDetailsID.toString(),g=t[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(t[0].InstBalance)?parseFloat(t[0].InstBalance):_,n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+T+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+d+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+s+'"  CreditAccount="'+l+'"  ></Transactions>',n+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanBalAmt)-F)+"', dcAlpha3=N'"+D+"', dcAlpha4=N'"+C.J0.ParseDate(t[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].ComponentID+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",F+=x,_-=x,t[0].Flag=1,r.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==r.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==d&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=j&&null!=j&&(A=parseInt(j))}else A++}while(_>0)}}n+="</DOCXML>",n+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let D,d="",h="",c="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let T=0;T<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;T++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[T].InvDocDetailsID.toString()}D=p="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(D=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),n+='<AttendanceDimensionwiseXML DocID="'+c+'" DocDetIDs="'+g+'" WorkFlowID="0" >',n+="<DOCXML>";let t=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(t=this.dsDailyAttendanceData.Tables[0].filter(T=>T.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=t&&t.length>0){let A,_,x,F,T=[],P=[];P.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)P.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());P.push("OT1"),P.push("OT2"),P.push("OT3"),P.push("OT4"),P.push("OT5"),P.push("DAYSATTENDED"),P.push("ABSENTDAYS"),P.push("Leaves"),P.push("TOTALOTAMOUNT");for(let f=0;f<t.length;f++)if(_=this.ApplyFilter(T,t[f]),null!=_&&_.length>0)for(let E=0;E<P.length;E++)P[E].startsWith("OT")&&(_[0][P[E]]=C.J0.SUMHoursAndMinutes(_[0][P[E]].toString(),t[f][P[E]].toString()));else{A={},A.EMPNODE=t[f].EMPNODE;for(let E=1;E<P.length;E++)A[P[E]]=t[f][P[E]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],t[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],t[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let E=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],t[f]),N=0;if(null!=E&&E.length>0){let ee,q;N=0;for(let H=0;H<E.length;H++)ee=C.J0.ParseDate(E[H].FromDate),q=C.J0.ParseDate(E[H].ToDate),ee>=r.d.SessionManager.PayrollMonthStart?q<=r.d.SessionManager.PayrollMonthEnd?N+=parseFloat(E[H].Leaves):ee<=r.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ee,r.d.SessionManager.PayrollMonthEnd,parseInt(E[H].ComponentID))):q<=r.d.SessionManager.PayrollMonthEnd?q>=r.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,q,parseInt(E[H].ComponentID))):N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,r.d.SessionManager.PayrollMonthEnd,parseInt(E[H].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}T.push(A)}let j="0";for(let f=0;f<T.length;f++){if(j="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),d="",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+j+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',n+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+D+'"  ></Transactions>',n+='<Numeric Query="dcNum1='+C.J0.Double(T[f].TOTALOTAMOUNT)+", dcCalcNum1="+C.J0.Double(T[f].TOTALOTAMOUNT)+", ",n+="dcNum5="+C.J0.Double(T[f].OT1)+", dcCalcNum5="+C.J0.Double(T[f].OT1)+", ",n+="dcNum7="+C.J0.Double(T[f].OT2)+", dcCalcNum7="+C.J0.Double(T[f].OT2)+", ",n+="dcNum9="+C.J0.Double(T[f].OT3)+", dcCalcNum9="+C.J0.Double(T[f].OT3)+", ",n+="dcNum11="+C.J0.Double(T[f].OT4)+", dcCalcNum11="+C.J0.Double(T[f].OT4)+", ",n+="dcNum13="+C.J0.Double(T[f].OT5)+", dcCalcNum13="+C.J0.Double(T[f].OT5)+", ",n+='" ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+C.J0.Double(T[f].DAYSATTENDED)+"', dcAlpha3=N'"+C.J0.Double(T[f].ABSENTDAYS)+"', dcAlpha4=N'"+C.J0.Double(T[f].Leaves)+"', \" ></Alpha>",n+='<CostCenters Query="',d+=" dcCCNID51="+C.J0.Int(T[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)h=this.dsDailyAttendanceData.Tables[3][E].Data.toString(),d+=" "+h+"="+C.J0.Int(T[f][h])+","}d.length>0&&(n+=d),n+='" ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>"}}n+="</DOCXML>",n+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(d.length>0){n+="<ArrearsXML>",n+="<Rows>";for(let c=0;c<d.length;c++)n+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),n+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,n+='" ArrearsCalcMonths="'+C.J0.ParseDate(d[c]).ToString("dd/MMM/yyyy"),n+='" ArrCalcMonthPayDays="'+h[c].toString(),n+='" ArrearsCalcDays="',n+='" />';n+="</Rows>",n+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(d.length>0){n+="<AdjustmentsXML>",n+="<Rows>";for(let c=0;c<d.length;c++)n+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),n+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,n+='" AdjMonth="'+C.J0.ParseDate(d[c]).ToString("dd/MMM/yyyy"),n+='" Days="'+h[c].toString(),n+='" Remarks="',n+='" />';n+="</Rows>",n+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(n+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(r.d.SessionManager.Preferences.CreateLoanType)>0&&(l=s="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"CreditAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"DebitAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(s=i[0].UserDefaultValue.toString())),n+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+s+'"  CreditAccount="'+l+'"  ></Transactions>',n+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha6=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+r.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",n+="</DOCXML>",n+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(d.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<d.length;c++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[c].toString()+"',1";for(let p=0;p<this.oCMP.arrLstCPFields[0][0].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.split(";"),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=t&&""!=t?","+t:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.split(";"),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=t&&""!=t?","+t:",0"}h+=D+")",h+=g+")"}n+='<ArrearsDetailXML Query="'+h+'"></ArrearsDetailXML>'}}if(this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(d.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<d.length;c++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[c].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=t&&""!=t?","+t:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=t&&""!=t?","+t:",0"}h+=D+")",h+=g+")"}n+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return n+="</XML>",n.toString()}GetRawExportHTML(){let a="",l="";a+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",l+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",l+=".null{background-color:#ECF9C;}",a+="<style>"+l.toString()+"</style>";let s=this.dgvEmployees.Table;a+="<table>",a+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",a+="<COLGROUP>";let i=null;for(let d=0;d<this.dgvEmployees.TableColumns.length;d++){var n=this.dgvEmployees.TableColumns[d];i=this.dgvEmployees.Columns.find(h=>h.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[d][n].toUpperCase()),null!=i&&i.IsVisible&&(a+="<COL>")}a+="</COLGROUP>",a+="<tr style=''>";for(let d=0;d<this.dgvEmployees.Table.length;d++)n=this.dgvEmployees.Table[d],i=this.dgvEmployees.Columns.find(c=>c.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[d][n].toUpperCase()),null!=i&&i.IsVisible&&(a+="<th class='hdr'>",a+=i.Header,a+="</th>");a+="</tr>";for(let d=0;d<s.length;d++){if(a+="<tr",d%2==1&&(a+=" class=alt"),a+=">",0==this.dgvEmployees.TableColumns.length)a+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(let h=0;h<this.dgvEmployees.TableColumns.length;h++)n=this.dgvEmployees.TableColumns[d],i=this.dgvEmployees.Columns.find(g=>g.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[h][n].toUpperCase()),null!=i&&i.IsVisible&&(null==s[d][h]?a+="<td class='null'>":(a+="<td>",a+=s[d][h].toString()),a+="</td>");a+="</tr>"}return a+="</table>",a+="</td></tr></table>",a+="</body><html>",a.toString()}ApplyFilter(a,l){let s=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let n=this.dsDailyAttendanceData.Tables[3][i].Data.toString();s=s.filter(d=>d[n]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return s}ReportView(){this.ReportDimension=new ct.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=r.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+r.d.SessionManager.UserID+" set @RoleID="+r.d.SessionManager.RoleID+"    \n                    SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                    FROM ADM_RevenUReports R  with(nolock)\n                    inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                    left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                    left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                    where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                    GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                    order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(s=>{let i=new Ct.v;i.DBColumnID=parseInt(s.ReportID),i.Label=s.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=s.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=s.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==s.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=s.Width.toString()&&(i.Width=s.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=s.Height.toString()&&(i.Length=s.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=s.DocumentField.toString()&&(i.Formula=s.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=s.mapxml.toString()&&(i.ToolTipDescription=s.mapxml.toString()),a.Contains(parseInt(s.ReportID))||(a.push(parseInt(s.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,le.A)(function*(){const{ReportViewModel:s}=yield Promise.resolve().then(W.bind(W,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(W.bind(W,73540));let h,n={strXML:""},d=new s;if(l.DisplayMessage=l.GetReportFilterXML(a,n),h=n.strXML,0==l.DisplayMessage.length){var c=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=c&&c.Dependantinuse)d.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!C.J0.IsEmpty(c.Width)&&C.J0.Double(c.Width)>0&&(d.RptWidth=C.J0.Double(c.Width)),!C.J0.IsEmpty(c.length)&&C.J0.Double(c.length)>0&&(d.RptHeight=C.J0.Double(c.length)),d.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.ShowDialog(d,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new s;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let s="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let d,n=!1;i.forEach(h=>{(0,se.yG0)(h.GroupLevel)&&(n=!0)}),s+="<XML",n&&(s+=' GroupLevel="1"'),s+=" >";for(let h=0;h<i.length;h++){if(d=i[h].ReportField.toString(),s+="<Row ",s+='ColID ="'+d+'" ',!C.J0.IsEmpty(i[h].SysColumnName))if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let c="";for(let g=0;g<this.dgvEmployees.Table.length;g++)(0,se.yG0)(this.dgvEmployees.Table[g].Select)&&(c+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",");if(C.J0.IsEmpty(c)||!(c.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";c=c.substr(0,c.length-1),s+='Value ="'+c+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?s+='Value ="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?s+='Value ="'+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(s+='Value ="'+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');s+=" />"}return s+="</XML>",l.strXML=s.toString(),""}}function qt(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",5),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Post"))}),e.nrm(1,"i",19),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Post")))}function $t(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",5),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("UnPost"))}),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"UnPost")))}function Qt(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",5),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Report"))}),e.nrm(1,"i",21),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Report")))}let zt=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-post-payroll"]],decls:100,vars:27,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"masterscreen",2,"height","120px"],[1,"row",2,"height","30px"],[1,"col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row","margin-bottom","9px"],[1,"input_cntrl_label",2,"font-size","13px"],[1,"input_cntrl_label",2,"font-weight","bold","font-size","12px !important"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],["FieldDirective","",3,"obj"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-chart-line"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n      "),e.j41(2,"div",1),e.EFF(3,"\n        "),e.j41(4,"span",2),e.EFF(5),e.k0s(),e.EFF(6,"\n        "),e.j41(7,"div",3),e.EFF(8,"\n          "),e.DNE(9,qt,4,3,"span",4),e.EFF(10,"\n          "),e.j41(11,"span",5),e.bIt("click",function(){return i.obj.Button_Click("Clear")}),e.nrm(12,"i",6),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.EFF(15,"\n          "),e.DNE(16,$t,4,3,"span",4),e.EFF(17,"\n          "),e.j41(18,"span",5),e.bIt("click",function(){return i.obj.Button_Click("Filter")}),e.nrm(19,"i",7),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.EFF(22,"\n          "),e.DNE(23,Qt,4,3,"span",4),e.EFF(24,"           \n        "),e.k0s(),e.EFF(25,"\n      "),e.k0s(),e.EFF(26,"\n      "),e.j41(27,"div",8),e.EFF(28," \n        "),e.j41(29,"div",9),e.EFF(30,"\n          "),e.j41(31,"div",10),e.EFF(32," \n            "),e.j41(33,"div",11),e.EFF(34,"\n                  "),e.j41(35,"label",12),e.EFF(36),e.nI1(37,"translate"),e.k0s(),e.EFF(38,"\n                  "),e.j41(39,"label",13),e.EFF(40),e.k0s(),e.EFF(41,"\n              "),e.k0s(),e.EFF(42,"\n            "),e.k0s(),e.EFF(43,"\n          "),e.j41(44,"div",10),e.EFF(45,"\n                "),e.j41(46,"div",14),e.EFF(47,"\n                "),e.j41(48,"label",12),e.EFF(49),e.nI1(50,"translate"),e.k0s(),e.EFF(51,"\n                "),e.j41(52,"label",13),e.EFF(53),e.k0s(),e.EFF(54,"\n              "),e.k0s(),e.EFF(55,"\n              "),e.j41(56,"div",14),e.EFF(57,"\n                "),e.j41(58,"label",12),e.EFF(59),e.nI1(60,"translate"),e.k0s(),e.EFF(61,"\n                "),e.j41(62,"label",13),e.EFF(63),e.k0s(),e.EFF(64,"              \n            "),e.k0s(),e.EFF(65,"\n          "),e.k0s(),e.EFF(66,"\n          "),e.j41(67,"div",10),e.EFF(68,"\n            "),e.j41(69,"div",15),e.EFF(70,"\n              "),e.eu8(71,16),e.EFF(72,"\n          "),e.k0s(),e.EFF(73,"\n  \n          "),e.j41(74,"div",15),e.EFF(75,"\n            "),e.eu8(76,16),e.EFF(77,"\n        "),e.k0s(),e.EFF(78,"                  \n           "),e.k0s(),e.EFF(79,"\n           "),e.j41(80,"div",10),e.EFF(81,"\n        "),e.j41(82,"div",15),e.EFF(83,"\n          "),e.eu8(84,16),e.EFF(85,"\n      "),e.k0s(),e.EFF(86,"\n      "),e.j41(87,"div",15),e.EFF(88,"\n        "),e.eu8(89,16),e.EFF(90,"\n    "),e.k0s(),e.EFF(91,"\n          "),e.k0s(),e.EFF(92,"\n        "),e.k0s(),e.EFF(93,"\n        "),e.j41(94,"div",17),e.EFF(95,"\n          "),e.nrm(96,"app-PactGridView",18),e.EFF(97,"  \n        "),e.k0s(),e.EFF(98,"\n      "),e.k0s(),e.EFF(99,"\n "),e.k0s()),2&s&&(e.R7$(5),e.JRh(i.obj.Title),e.R7$(4),e.Y8G("ngIf",i.obj.PostVisiblility),e.R7$(4),e.JRh(e.bMT(14,17,"Clear")),e.R7$(3),e.Y8G("ngIf",i.obj.UnPostVisiblility),e.R7$(4),e.JRh(e.bMT(21,19,"Filter")),e.R7$(3),e.Y8G("ngIf",i.obj.ReportInfoVisibility),e.R7$(13),e.SpI("",e.bMT(37,21,"Payroll_PayMonth"),"        :"),e.R7$(4),e.JRh(i.obj.lblPayrollMonth),e.R7$(9),e.SpI("",e.bMT(50,23,"Payroll_StartDate"),"   :"),e.R7$(4),e.JRh(i.obj.lblPayrollMonthStart),e.R7$(6),e.SpI("",e.bMT(60,25,"Payroll_EndDate"),"   :"),e.R7$(4),e.JRh(i.obj.lblPayrollMonthEnd),e.R7$(8),e.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),e.R7$(5),e.Y8G("obj",i.obj.chkIncludeOTHours),e.R7$(8),e.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),e.R7$(5),e.Y8G("obj",i.obj.IsProcessWithAdjustments),e.R7$(7),e.Y8G("obj",i.obj.EmployeesList))},dependencies:[_e.bT,Ae._,Qe.X,Ue.D9],encapsulation:2})}return G})();var Pt=W(81669),Zt=W(73631);const ea=G=>({width:G});let vt=(()=>{class G extends Zt.P{constructor(){super()}ngOnInit(){C.J0.IsEmpty(this.obj.ProgressMessage)||(this.ProgressMessage=this.obj.ProgressMessage),this.obj.progress||(this.obj.progress=0),0===this.obj.total?this.obj.total=this.obj.progress:this.obj.total||(this.obj.total=100),this.obj.progress>this.obj.total&&(this.obj.progress=100,this.obj.total=100),this.obj.progress=this.obj.progress/this.obj.total*100,this.color=this.obj.progress<55?"red":this.obj.progress<75?"yellow":"green",setTimeout(()=>{r.d.page.HideDialog(this.obj.PopUpGUID)},2e3)}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-progress-bar"]],inputs:{progress:"progress",total:"total"},features:[e.Vt3],decls:7,vars:7,consts:[[1,"progress-bar-container"],[3,"ngStyle"]],template:function(s,i){1&s&&(e.EFF(0,"\n  "),e.j41(1,"div",0),e.EFF(2,"\n     "),e.j41(3,"div",1),e.EFF(4),e.k0s(),e.EFF(5,"\n  "),e.k0s(),e.EFF(6,"\n  ")),2&s&&(e.R7$(3),e.ZvI("progress-bar ",i.color,""),e.Y8G("ngStyle",e.eq3(5,ea,i.progress+"%")),e.R7$(),e.SpI("\n      ",i.ProgressMessage,"\n     "))},dependencies:[_e.B3],encapsulation:2})}return G})();class Lt extends at.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.ButtonClick=new Pt.Yk,this.ProgressVisibility=!1,this.chkPostBasedOnDailyAttendance=new je.c,this.chkPostBasedOnAttDimWise=new je.c,this.chkIncludeOTHours=new je.c,this.IsProcessWithAdjustments=new je.c,this.EmployeesList=new Ye.vv,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.dsDailyAttendanceData=null,this.sPayrollMonthMouseDoubleClickCommand=new Pt.Yk,this.btnCancelFlag=!1,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Ct.v,this.sCrAccount="0",this.sDrAccount="0",this.SelectUnCheck=0,this.sFilter="",this.IsPosting=!1,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),this.ClassName="PostPayrollViewModel",this.CostCenterID=40054,this.DisplayName=r.d.GetResource(a),this.Title=r.d.GetResource(a),this.DisplayMessage="",this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.ButtonClick.Subscribe(this,"Button_Click"),this.sPayrollMonthMouseDoubleClickCommand.Subscribe(this,"sPayrollMonth_MouseDoubleClick"),this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.btnCancelFlag=!1,this.chkPostBasedOnDailyAttendance.Label=r.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=r.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=r.d.GetResource("PostbasedonAttendanceDimensionwise"),this.IsProcessWithAdjustments.Label=r.d.GetResource("IsProcessWithAdjustments"),this.LoadGrid(),this.btnFilter_Click(),r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView(),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(l){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+l.stack)}}sPayrollMonth_MouseDoubleClick(a){var l=this;return(0,le.A)(function*(){const{SetPayrollDateViewModel:s}=yield Promise.resolve().then(W.bind(W,15091)),{SetPayrollDateComponent:i}=yield Promise.resolve().then(W.bind(W,72974));let n=new s;r.d.page.ShowDialog(n,i,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")}),n.DialogResult&&l.btnClear_Click()})()}LoadGrid(){let s,l=(new At.ControlGenerator).GetScreenInfo(this.CostCenterID);s=l.Tables[0].filter(n=>"CreditAccount"==n.SysColumnName),null!=s&&s.length>0&&!C.J0.IsEmpty(s[0].UserDefaultValue)&&(this.sCrAccount=s[0].UserDefaultValue.toString()),s=l.Tables[0].filter(n=>"DebitAccount"==n.SysColumnName),null!=s&&s.length>0&&null!=s[0].UserDefaultValue&&""!=s[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=s[0].UserDefaultValue.toString()),this.EmployeesList=new Ye.vv,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("GradeID"),this.EmployeesList.TableColumns.push("Result");let i=new X.O7;this.EmployeesList.Columns=[],i=new X.O7,i.Header=r.d.GetResource("Pay_Select"),i.DisplayMember="Select",i.DataType="CheckBox",i.Width=50,i.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(i),i=new X.O7,i.Header=r.d.GetResource("Payroll_EmpSNo"),i.DisplayMember="SNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new X.O7,i.Header=r.d.GetResource("EmployeeCode"),i.DisplayMember="EmpCode",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new X.O7,i.Header=r.d.GetResource("EmployeeName"),i.DisplayMember="EmpName",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new X.O7,i.Header=r.d.GetResource("Result"),i.DisplayMember="Result",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.EmployeesList.Table.length;l++)0==this.SelectUnCheck&&(this.EmployeesList.Table[l].Select=a);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}Button_Click(a){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,r.d.page.ShowDialog(this,Nt.L,{Title:"Reports"})),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}btnUnPost_Click(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}btnFilter_Click(){Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),r.d.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(r.d.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new o.t("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new o.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&r.d.page.ShowDialog(this.objEmpFilter,gt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted)if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,s="",i="",n="";for(let D=0;D<this.objEmpFilter.CostCenterFilters.length;D++){let p=this.objEmpFilter.CostCenterFilters[D];if(p.CostCenterID>5e4&&(l=2,s="NodeID",i=50051==p.CostCenterID?"EmpSeqNo":"CCNID"+(p.CostCenterID-5e4)),p.SelectedNodes.length>0){if(1==p.SelectedNodes.length)n+=" AND ",n+=i+"="+p.SelectedNodes[0].Id;else if(!p.SelectedNodes.find(t=>t.Id==l&&t.IsGroup))if(n+=" AND ",ht.IPrefetchFilter.IsGroupTree(p)){let t="";for(let T=0;T<p.SelectedNodes.length;T++)(null==p.SelectedNodes[T].Parent||!p.SelectedNodes[T].Parent.IsSelected)&&(t.length>0&&(t+=","),t+=p.SelectedNodes[T].Id);0==t.length&&(t+=-12912),n+=i+" IN ",n+=" (select T."+s+" GTID from "+ze.A.GetTagTableName(p.CostCenterID)+" T with(nolock),"+ze.A.GetTagTableName(p.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",n+=t.toString()+")  group by T."+s+")"}else{n+=i+" IN (";for(let t=0;t<p.SelectedNodes.length;t++)t>0&&(n+=","),n+=p.SelectedNodes[t].Id;n+=")"}}else p.DeleteButtonVisibility||(n+=" AND ",n+=i+"=-12912")}this.sFilter=n.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let d=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=d.Trim()&&"None"!=d&&(this.sFilter+="TreeView"==d?" ORDER BY EMP.lft ":" ORDER BY EMP."+d);let h=[];h.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),h.push(this.sFilter),h.push(0),h.push(r.d.SessionManager.RoleID),h.push(r.d.SessionManager.UserID),h.push(r.d.SessionManager.LanguageID);let g,c=r.d.empService.GetData(h,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=c&&c.Tables.length>0&&c.Tables[0].length>0){if(g=c.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let D=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayroll"==p.Name&&p.GradeID==c.Tables[0][0].CCNID53);if(null!=D&&D.length>0&&null!=D[0].Value&&null!=D[0].Value&&""!=D[0].Value.toString()&&"True"==D[0].Value.toString()&&(D=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayrollDays"==p.Name&&p.GradeID==c.Tables[0][0].CCNID53),null!=D&&D.length>0&&null!=D[0].Value&&null!=D[0].Value&&""!=D[0].Value.toString())){let p=0;if(p=parseInt(D[0].Value),p>0){let t=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),p),T=c.Tables[0].filter(P=>P.DOJ<=t);null!=T&&T.length>0&&(c=[],c=T)}}c.Tables[0].DefaultView.Sort="CCNID53",g=c.Tables[0].DefaultView.ToTable()}for(let D=0;D<g.length;D++){let p=this.EmployeesList.NewRow();p.EmpSeqNo=g[D].EmpSeqNo,p.EmpCode=g[D].EmpCode,p.EmpName=g[D].EmpName,p.GradeID=g[D].CCNID53,p.SNo=(D+1).toString(),p.Select=!1,this.EmployeesList.addRow(p)}}}else this.objEmpFilter.Filter>0&&this.FilterEmployees()}),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}FilterEmployees(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let a=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=a.Trim()&&"None"!=a&&(this.sFilter+="TreeView"==a?" ORDER BY EMP.lft ":" ORDER BY EMP."+a);let l=[];l.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID);let i,s=r.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0){if(i=s.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let n=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(d=>"DontConsiderEmpsForPayroll"==d.Name&&d.GradeID==s.Tables[0][0].CCNID53);if(null!=n&&n.length>0&&null!=n[0].Value&&null!=n[0].Value&&""!=n[0].Value.toString()&&"True"==n[0].Value.toString()&&(n=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(d=>"DontConsiderEmpsForPayrollDays"==d.Name&&d.GradeID==s.Tables[0][0].CCNID53),null!=n&&n.length>0&&null!=n[0].Value&&null!=n[0].Value&&""!=n[0].Value.toString())){let d=0;if(d=parseInt(n[0].Value),d>0){let h=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),d),c=s.Tables[0].filter(g=>new Date(g.DOJ)<=h);null!=c&&c.length>0&&(s=[],s=c)}}s.sort((d,h)=>h.CCNID53-d.CCNID53),i=s}for(let n=0;n<i.length;n++){let d=this.EmployeesList.NewRow();d.EmpSeqNo=i[n].EmpSeqNo,d.EmpCode=i[n].EmpCode,d.EmpName=i[n].EmpName,d.GradeID=i[n].CCNID53,d.SNo=(n+1).toString(),d.Select=!1,this.EmployeesList.addRow(d)}}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+a.stack)}}bgworker_DoWork(a,l){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}UnPostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let s="";for(let i=0;i<this.EmployeesList.Table.length;i++)(0,se.yG0)(this.EmployeesList.Table[i].Select)&&(s+=this.EmployeesList.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(s.length>0&&l>0){s=s.substr(0,s.length-1);let n,i=s.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...",r.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},vt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});let d=r.d.report.GetDataTable("PPVM01",s,r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"));for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(n=d.filter(c=>c.EmpSeqNo==i[h]),null!=n&&n.length>0){let c=0,g=[];g.push(this.CostCenterID),g.push(parseInt(n[0].DocID)),g.push(1);let D=r.d.document.DeleteSelectedRows(g,c);this.strResult=D.Message,c=D.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.EmployeesList.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.EmployeesList.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(c=>1==c.Select).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}PostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let d,s="",i="",n=new Array,h=!1,c=0;for(let g=0;g<this.EmployeesList.Table.length;g++)if((0,se.yG0)(this.EmployeesList.Table[g].Select)&&(s+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,c=0,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let D=0;D<n.length;D++)if(n[D].GradeID==parseInt(this.EmployeesList.Table[g].GradeID)){c=D,h=!0;break}h?(i=n[c].sEmpIds,i+=","+this.EmployeesList.Table[g].EmpSeqNo.toString(),n[c].sEmpIds=i,n[c].lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo))):(d=new mt.ii,d.GradeID=parseInt(this.EmployeesList.Table[g].GradeID),d.sEmpIds=this.EmployeesList.Table[g].EmpSeqNo.toString(),d.lstGradeEmps=new Array,d.lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo)),n.push(d))}if(s.length>0&&l>0){if(s=s.substr(0,s.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",r.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},vt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString())if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<n.length;g++){C.J0.SetPayrollMonth(r.d.SessionManager.PayrollMonth,r.d.SessionManager,n[g].GradeID);let p=[];p.push(s),p.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),p.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),p.push(this.chkIncludeOTHours.IsChecked?1:0),p.push(C.J0.IntTryParse(r.d.SessionManager.UserID)),p.push(r.d.SessionManager.LanguageID);let t=r.d.empService.GetData(p,"spPAY_PostDailyAttendancetoPayroll");n[g].dsDailyAttendanceDataCollection=t}else{let g=[];g.push(s),g.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(C.J0.IntTryParse(r.d.SessionManager.UserID)),g.push(r.d.SessionManager.LanguageID),this.dsDailyAttendanceData=r.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new Ke.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=s,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=r.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=n,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<n.length;g++)n[g].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=n[g].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=n[g].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=n[g].GradePayrollMonthEnd,this.dsDailyAttendanceData=n[g].dsDailyAttendanceDataCollection);if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let g=r.d.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+r.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+r.d.SessionManager.UserID+","+r.d.SessionManager.RoleID);null!=g&&g.length>0&&(!C.J0.IsEmpty(g[0].CanApprove)&&"TRUE"==g[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.IsProcessWithAdjustments.IsChecked&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(D=>1==D.Select).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,c,l=[],s=r.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,n=r.d.SessionManager.PayrollMonth.AddMonths(-1),d=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;n>=d;){if(c=s.filter(D=>D.PayrollMonth&&C.J0.ParseDate(D.PayrollMonth).ToString("dd/MMM/yyyy")==n.ToString("dd/MMM/yyyy")),null!=c&&c.length>0){if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy");let D,p,t,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t};if(C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=C.J0.GetEmployeeGrade(a.toString(),D,p,t),_>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t},C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T,_),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd)}let P=[];P.push(a),P.push(D.ToString("dd/MMM/yyyy")),P.push(p.ToString("dd/MMM/yyyy")),P.push(t.ToString("dd/MMM/yyyy")),P.push(0),P.push(r.d.SessionManager.UserID),P.push(r.d.SessionManager.RoleID),P.push(r.d.SessionManager.LanguageID);let A=r.d.empService.ExecuteQuery_SP(P,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(t.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(r.d.SessionManager.RoleID),_.push(r.d.SessionManager.UserID),_.push(r.d.SessionManager.LanguageID);let x=r.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),j=(new mt.mr).AggregateLeaves(a.toString(),A,p,t,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);j>0&&(h.Days=-j)}l.push(h)}if(null!=g&&g.length>0&&r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let D=0;D<g.length;D++)g[D].PrevMonth.ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy"),h.Days=g[D].dDays,l.push(h))}else if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==n.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=n.ToString("dd/MMM/yyyy");let D,p,t,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t};C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd;let P=r.d.SessionManager.PayrollMonth,A=0;r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=C.J0.GetEmployeeGrade(a.toString(),D,p,t),A>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:t},C.J0.SetPayrollDate_1(C.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),T,A),D=T.PayrollMonth,p=T.PayrollMonthStart,t=T.PayrollMonthEnd)),C.J0.SetPayrollMonth(D);let _=new Ke.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=r.d.SessionManager.PayrollMonth,_.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),C.J0.SetPayrollMonth(P),l.push(h)}n=n.AddMonths(-1)}if(null!=l&&l.length>0)for(let D=0;D<l.length;D++)null!=l[D].Days&&null!=l[D].Days&&""!=l[D].Days.toString().Trim()&&(h={},h.PayrollMonth=r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[D].PayrollMonth.toString(),h.Days=l[D].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let D=0;D<this.dtAdjData.length;D++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[D].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[D].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=r.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),C.J0.SetPayrollMonth(a,r.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let s,i,n,l="";for(let t=0;t<this.dtAdjData.length;t++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[t].AdjMonth).ToString("dd MMM yyyy")+"'";let d=r.d.empService.GetQueryData(a,"MPL010",l,"","");for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dAdjusted="0";for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=r.d.empService.GetQueryData(0,"MPL014","","",""),c=r.d.empService.GetQueryData(a,"MPL005","","",""),g=r.d.empService.GetQueryData(a,"MPL011",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),D="";for(let t=0;t<this.dtAdjData.length;t++){let T=new Date(this.dtAdjData[t].AdjMonth),P=T;s=d.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==j.VoucherType);let A=null;if(null!=s&&s.length>0){let j=h.filter(f=>f.GradeID==s[0].dcCCNID53&&f.CPayrollDate<=P.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(f=>f.GradeID==s[0].dcCCNID53&&f.CPayrollDate==C.J0.String(j))}if(D="'"+T.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+T.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=c.filter(j=>T.ToString("dd/MMM/yyyy")>=j.ApplyFrom&&T.ToString("dd/MMM/yyyy")<=j.EffectFrom),p=p.sort((j,f)=>j.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(j=>j.ArrearsCalcMonths==C.J0.ParseDate(T)),n=g.Tables[1].filter(j=>1==j.DType&&j.ArrAdjMonth==C.J0.ParseDate(T)),null!=p&&p.length>0){let j=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let E=0;E<f.length;E++)C.J0.ParseDate(f[E]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(j=!0)}null!=i&&i.length>0||j?(T=C.J0.ParseDate(p[0].EffectFrom),r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T)):r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T)}else r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?C.J0.SetPayrollMonth(T,r.d.SessionManager,null!=s&&s.length>0?parseInt(s[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):C.J0.SetPayrollMonth(T);let _=parseFloat(this.dtAdjData[t].Days),x=0;x="Actual Days"!=r.d.SessionManager.Preferences.PayDays?parseInt(r.d.SessionManager.Preferences.PayDays):T.DaysInMonth();let F=new Ke.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=r.d.SessionManager.PayrollMonth,F.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=s&&s.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=C.J0.Int(s[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let j=0;null!=s&&s.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(s[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(s[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(s[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(s[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(s[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(s[0].Holidays),j=parseFloat(s[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",j)):C.J0.ParseDate(this.dtAdjData[t].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&C.J0.ParseDate(this.dtAdjData[t].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let H,f=0,E=-1,N=0,ee=0,q=0;s=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(C.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)for(let ie=0;ie<F.arrLstCPFields[0][0].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==F.arrLstCPFields[0][0][ie].SNo){if(N=0,ee=0,q=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,!C.J0.IsEmpty(s)&&s.length>0&&!C.J0.IsEmpty(s[0]["dcCalcNum"+E])&&(N=parseFloat(s[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.split(";"),null!=H&&H.length>0))for(let me=0;me<H.length;me+=2)new Date(H[me]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(ee=parseFloat(H[me+1]));null!=n&&n.length>0&&null!=n[0]["Earning"+E]&&null!=n[0]["Earning"+E]&&""!=n[0]["Earning"+E]&&(q=parseFloat(n[0]["Earning"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,se.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][ie].ComponentName?parseFloat(F.arrLstCPFields[0][0][ie].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][ie].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData=C.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData+=P.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}s=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments)for(let ie=0;ie<F.arrLstCPFields[0][2].length;ie++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==F.arrLstCPFields[0][2][ie].SNo){if(N=0,ee=0,q=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=s&&s.length>0&&null!=s[0]["dcCalcNum"+E]&&null!=s[0]["dcCalcNum"+E]&&""!=s[0]["dcCalcNum"+E].toString()&&(N=parseFloat(s[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.split(";"),null!=H&&H.length>0))for(let me=0;me<H.length;me+=2)new Date(H[me]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(ee=parseFloat(H[me+1]));null!=n&&n.length>0&&null!=n[0]["Deduction"+E]&&null!=n[0]["Deduction"+E]&&""!=n[0]["Deduction"+E]&&(q=parseFloat(n[0]["Deduction"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,se.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][ie].ComponentName?parseFloat(F.arrLstCPFields[0][2][ie].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][ie].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData=C.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData+=P.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet()}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(s=>s.EmpSeqNo==a),l.length>0&&C.J0.ParseDate(l[0].cEffectFrom).getFullYear()==r.d.SessionManager.PayrollMonth.getFullYear()&&C.J0.ParseDate(l[0].cEffectFrom).iMonth()==r.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let s="",i=0,n=0,d=0,h=0,c=0,g=0,D=0,p=0,t=0,T=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)s.length>0&&(s+=","),s+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let P=r.d.empService.GetQueryData(a,"PostCalculateAccural",JSON.stringify(s),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=r.d.report.GetDataTable("PPVM02","");if(null!=P&&P.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(n=0,d=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<P.length;F++)c=parseFloat(P[F].TotalDays),h=parseFloat(P[F].DaysAttended)+parseFloat(P[F].PaidLeaves)+parseFloat(P[F].LOPDays),g=parseFloat(P[F]["dcCalcNum"+T]),D=parseFloat(P[F]["dcCalcNumFC"+T]),p=parseFloat((h/c*i).ToString(r.d.SessionManager.sPayrollDecimals)),t=parseFloat((p-g).ToString(r.d.SessionManager.sPayrollDecimals)),n+=parseFloat(t.ToString(r.d.SessionManager.sPayrollDecimals)),d+=D;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(n-d).ToString(r.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<P.length;x++){let F=A.filter(f=>f.GradeID==parseInt(P[x].GradeID)&&f.CPayrollDate==C.J0.ParseDate(P[x].PayrollDate)).Compute("max","MaxSchemeID"),j=new Ke.O;if(j.oParent=this,j.sSelectedEmpSeqNos=a.toString(),j.PayrollMonth=r.d.SessionManager.PayrollMonth,j.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,j.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,j.drcArrStructure=F,j.IsCalculateAccruals=!0,j.ArrGradeID=parseInt(P[x].GradeID),j.ProcessPayroll(),j.IsCompleted){j.arrLstOthMPFields[0].TotalDays=parseFloat(P[x].TotalDays),j.arrLstOthMPFields[0].MonthDays=parseFloat(P[x].TotalDays),j.arrLstOthMPFields[0].PaidLeaves=parseFloat(P[x].PaidLeaves),j.arrLstOthMPFields[0].TotalLeaves=parseFloat(P[x].LeavesTaken),j.arrLstOthMPFields[0].WeeklyOffs=parseFloat(P[x].WOffs),j.arrLstOthMPFields[0].Holidays=parseFloat(P[x].Holidays),h=parseFloat(P[x].TotalDays.toString())-parseFloat(P[x].LOPDays.toString())-parseFloat(P[x].LeavesTaken.toString())-parseFloat(P[x].UnpaidDays.toString()),j.SetDaysAttended(0,"Days Attended",h);let f=0,E=-1,N=0,ee=0;for(let q=0;q<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].Behaviour)for(let H=0;H<j.arrLstCPFields[0][0].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].SNo==j.arrLstCPFields[0][0][H].SNo){N=0,ee=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].SNo,null!=P[x]["dcCalcNum"+E]&&null!=P[x]["dcCalcNum"+E]&&""!=P[x]["dcCalcNum"+E].toString()&&(N=parseFloat(P[x]["dcCalcNum"+E])),null!=P[x]["dcCalcNumFC"+E]&&null!=P[x]["dcCalcNumFC"+E]&&""!=P[x]["dcCalcNumFC"+E].toString()&&(ee=parseFloat(P[x]["dcCalcNumFC"+E])),f=parseFloat(j.arrLstCPFields[0][0][H].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].dPrevAccEar+=parseFloat(f.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].dPrevAccAdj+=ee;break}for(let q=0;q<this.oCMP.arrLstCPFields[2].length;q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].Behaviour)for(let H=0;H<j.arrLstCPFields[0][2].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].SNo==j.arrLstCPFields[0][2][H].SNo){N=0,ee=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].SNo,null!=P[x]["dcCalcNum"+E]&&null!=P[x]["dcCalcNum"+E]&&""!=P[x]["dcCalcNum"+E].toString()&&(N=parseFloat(P[x]["dcCalcNum"+E])),null!=P[x]["dcCalcNumFC"+E]&&null!=P[x]["dcCalcNumFC"+E]&&""!=P[x]["dcCalcNumFC"+E].toString()&&(ee=parseFloat(P[x]["dcCalcNumFC"+E])),f=parseFloat(j.arrLstCPFields[0][2][H].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].dPrevAccEar+=parseFloat(f.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].dPrevAccAdj+=ee;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals))}}}}ValidatePosting(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=r.d.SessionManager.Preferences.PayrollProduct&&""!=r.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(r.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(r.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+a.stack),!1}}SaveVoucher(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(r.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(r.d.SessionManager.LocationID>0?r.d.SessionManager.LocationID:1):l.push(0),r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(r.d.SessionManager.DivisionID>0?r.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(r.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(r.d.SessionManager.CompanyGUID),l.push(r.d.SessionManager.UserName),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),l.push(r.d.SessionManager.IsOffline);let s="",i="",n=r.d.document.SetTempInvDocumentPostPayroll(l);a=n.obj;let d=n;s=null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(h=>h.hasOwnProperty("ErrorMessage"))?d.Tables[d.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a>0?null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(h=>h.hasOwnProperty("VoucherNo"))&&(i=d.Tables[d.Tables.length-1][0].VoucherNo.toString()):null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(h=>h.hasOwnProperty("ServerMessage"))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==d.Tables[d.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=s,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",a)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}GetDocumentXML(){let a,l="",s="",i="",n="",d="",h="",c=[],g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?g+=",dcAlpha15='"+C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended+"'",i+='<Alpha Query="',i+=g,d+=" ",d.length>0&&(i+=","+d),i+='" ></Alpha>',d="",n+='<CostCenters Query="',d+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",d+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?d+=" dcCCNID68=1,":d+=" dcCCNID68="+C.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",c.push("dcCCNID51"),c.push("dcCCNID53"),c.push("dcCCNID68");let D="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let t=0;t<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;t++)D=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[t],p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][D],D.Contains("CCNID")&&"CCNID51"!=D&&"CCNID53"!=D&&"CCNID68"!=D&&(d+=" dc"+D+"="+p+",",c.Contains("dc"+D)||c.push("dc"+D));if(d.length>0&&(n+=d),n+='" ></CostCenters>',s+='" ProductID="'+this.DefProdID+'" Quantity="0',s+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',s+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',s+='" StockValue="0" StockValueFC="0" RefNO="',s+='" BillDate="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),s+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',s+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,s+='" CommonNarration="'+C.J0.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][t].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][t].dEarned.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][t].dAdjusted.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].IsVisible&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanActInstAmt.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanInstAmt.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanBalAmt.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][t].LoanPayStatus+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Leave',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(t=>t.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==t.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=s.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let t=0;t<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;t++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveTotOPBal.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].EncashLeavetaken.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveMonOPBal.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][t].LeaveNetBal.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=n.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",s="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let d=0;d<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;d++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[d].InvDocDetailsID.toString();let n="";if(n+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?a.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" >':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" >',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let d,h,c,g,D,t,p="0";if(l=s="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),n+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let T=0;null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"CreditAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"DebitAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(s=i[0].UserDefaultValue.toString()));for(let P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;P++)if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].IsVisible&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.toString()){d=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanDocNo,c=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstNo,D=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.Replace(",","");let A=parseInt(c);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==d&&C.J0.ParseDate(j.dcAlpha5)==r.d.SessionManager.PayrollMonth),null!=t&&t.length>0&&(A=parseInt(t[0].dcNum1))):(r.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==r.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==d&&j.InstallmentNo==A),t.SortBy([{name:"InstallmentNo",parser:parseInt}])):(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==d&&j.InstBalance>0&&j.InstallmentNo<A),t.SortBy([{name:"InstallmentNo",parser:parseInt}])),null!=t&&t.length>0&&(A=parseInt(t[0].InstallmentNo)));let _=parseFloat(D),x=0,F=0;do{if(T++,t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==d&&j.InstallmentNo==A),t.length>0)if(h=t[0].InvDocDetailsID.toString(),g=t[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(t[0].InstBalance)?parseFloat(t[0].InstBalance):_,n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+T+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="',n+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="'+d+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+s+'"  CreditAccount="'+l+'"  ></Transactions>',n+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanBalAmt)-F)+"', dcAlpha3=N'"+D+"', dcAlpha4=N'"+C.J0.ParseDate(t[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].ComponentID+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",F+=x,_-=x,t[0].Flag=1,r.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==r.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==d&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=j&&null!=j&&(A=parseInt(j))}else A++;else _=0}while(_>0)}}n+="</DOCXML>",n+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let D,d="",h="",c="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let T=0;T<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;T++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[T].InvDocDetailsID.toString()}D=p="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(D=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),n+='<AttendanceDimensionwiseXML DocID="'+c+'" DocDetIDs="'+g+'" WorkFlowID="0" >',n+="<DOCXML>";let t=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(t=this.dsDailyAttendanceData.Tables[0].filter(T=>T.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=t&&t.length>0){let A,_,x,F,T=[],P=[];P.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)P.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());P.push("OT1"),P.push("OT2"),P.push("OT3"),P.push("OT4"),P.push("OT5"),P.push("DAYSATTENDED"),P.push("ABSENTDAYS"),P.push("Leaves"),P.push("TOTALOTAMOUNT");for(let f=0;f<t.length;f++)if(_=this.ApplyFilter(T,t[f]),null!=_&&_.length>0)for(let E=0;E<P.length;E++)P[E].startsWith("OT")&&(_[0][P[E]]=C.J0.SUMHoursAndMinutes(_[0][P[E]].toString(),t[f][P[E]].toString()));else{A={},A.EMPNODE=t[f].EMPNODE;for(let E=1;E<P.length;E++)A[P[E]]=t[f][P[E]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],t[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],t[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let E=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],t[f]),N=0;if(null!=E&&E.length>0){let ee,q;N=0;for(let H=0;H<E.length;H++)ee=C.J0.ParseDate(E[H].FromDate),q=C.J0.ParseDate(E[H].ToDate),ee>=r.d.SessionManager.PayrollMonthStart?q<=r.d.SessionManager.PayrollMonthEnd?N+=parseFloat(E[H].Leaves):ee<=r.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ee,r.d.SessionManager.PayrollMonthEnd,parseInt(E[H].ComponentID))):q<=r.d.SessionManager.PayrollMonthEnd?q>=r.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,q,parseInt(E[H].ComponentID))):N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,r.d.SessionManager.PayrollMonthEnd,parseInt(E[H].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}T.push(A)}let j="0";for(let f=0;f<T.length;f++){if(j="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),d="",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+j+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',n+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+D+'"  ></Transactions>',n+='<Numeric Query="dcNum1='+C.J0.Double(T[f].TOTALOTAMOUNT)+", dcCalcNum1="+C.J0.Double(T[f].TOTALOTAMOUNT)+", ",n+="dcNum5="+C.J0.Double(T[f].OT1)+", dcCalcNum5="+C.J0.Double(T[f].OT1)+", ",n+="dcNum7="+C.J0.Double(T[f].OT2)+", dcCalcNum7="+C.J0.Double(T[f].OT2)+", ",n+="dcNum9="+C.J0.Double(T[f].OT3)+", dcCalcNum9="+C.J0.Double(T[f].OT3)+", ",n+="dcNum11="+C.J0.Double(T[f].OT4)+", dcCalcNum11="+C.J0.Double(T[f].OT4)+", ",n+="dcNum13="+C.J0.Double(T[f].OT5)+", dcCalcNum13="+C.J0.Double(T[f].OT5)+", ",n+='" ></Numeric>',n+="<Alpha Query=\"dcAlpha1=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+C.J0.Double(T[f].DAYSATTENDED)+"', dcAlpha3=N'"+C.J0.Double(T[f].ABSENTDAYS)+"', dcAlpha4=N'"+C.J0.Double(T[f].Leaves)+"', \" ></Alpha>",n+='<CostCenters Query="',d+=" dcCCNID51="+C.J0.Int(T[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)h=this.dsDailyAttendanceData.Tables[3][E].Data.toString(),d+=" "+h+"="+C.J0.Int(T[f][h])+","}d.length>0&&(n+=d),n+='" ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>"}}n+="</DOCXML>",n+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(d.length>0){n+="<AdjustmentsXML>",n+="<Rows>";for(let c=0;c<d.length;c++)n+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),n+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,n+='" AdjMonth="'+C.J0.ParseDate(d[c]).ToString("dd/MMM/yyyy"),n+='" Days="'+h[c].toString(),n+='" Remarks="',n+='" />';n+="</Rows>",n+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(n+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),l=s="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(r.d.SessionManager.Preferences.CreateLoanType)>0&&(null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"CreditAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"DebitAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(s=i[0].UserDefaultValue.toString())),n+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',n+="<DOCXML>",n+="<RowHead/>",n+="<Row>",n+="<AccountsXML></AccountsXML>",n+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',n+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',n+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',n+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+s+'"  CreditAccount="'+l+'"  ></Transactions>',n+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',n+="<Alpha Query=\"dcAlpha6=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",n+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+r.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',n+="<EXTRAXML></EXTRAXML>",n+="</Row>",n+="</DOCXML>",n+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(d.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<d.length;c++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[c].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=t&&""!=t?","+t:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let t="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)C.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==C.J0.ParseDate(d[c]).ToString("dd MMM yyyy")&&(t=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=t&&""!=t?","+t:",0"}h+=D+")",h+=g+")"}n+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return n+="</XML>",n.toString()}ApplyFilter(a,l){let s=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let n=this.dsDailyAttendanceData.Tables[3][i].Data.toString();s=s.filter(d=>d[n]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return s}ReportView(){this.ReportDimension=new ct.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=r.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+r.d.SessionManager.UserID+" set @RoleID="+r.d.SessionManager.RoleID+"    \n                     SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                     FROM ADM_RevenUReports R  with(nolock)\n                     inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                     left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                     left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                     where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                     GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                     order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(s=>{let i=new Ct.v;i.DBColumnID=parseInt(s.ReportID),i.Label=s.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=s.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=s.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==s.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=s.Width.toString()&&(i.Width=s.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=s.Height.toString()&&(i.Length=s.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=s.DocumentField.toString()&&(i.Formula=s.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=s.mapxml.toString()&&(i.ToolTipDescription=s.mapxml.toString()),a.Contains(parseInt(s.ReportID))||(a.push(parseInt(s.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,le.A)(function*(){const{ReportViewModel:s}=yield Promise.resolve().then(W.bind(W,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(W.bind(W,73540));let h,n={strXML:""},d=new s;if(l.DisplayMessage=l.GetReportFilterXML(a,n),h=n.strXML,0==l.DisplayMessage.length){var c=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=c&&c.Dependantinuse)d.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!C.J0.IsEmpty(c.Width)&&C.J0.Double(c.Width)>0&&(d.RptWidth=C.J0.Double(c.Width)),!C.J0.IsEmpty(c.length)&&C.J0.Double(c.length)>0&&(d.RptHeight=C.J0.Double(c.length)),d.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.ShowDialog(d,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new s;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let s="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let d,n=!1;i.forEach(h=>{(0,se.yG0)(h.GroupLevel)&&(n=!0)}),s+="<XML",n&&(s+=' GroupLevel="1"'),s+=" >";for(let h=0;h<i.length;h++)if(d=i[h].ReportField.toString(),s+="<Row ",s+='ColID ="'+d+'" ',!C.J0.IsEmpty(i[h].SysColumnName)){if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let c="";for(let g=0;g<this.EmployeesList.Table.length;g++)(0,se.yG0)(this.EmployeesList.Table[g].Select)&&(c+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",");if(C.J0.IsEmpty(c)||!(c.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";c=c.substr(0,c.length-1),s+='Value ="'+c+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?s+='Value ="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?s+='Value ="'+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(s+='Value ="'+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');s+=" />"}return s+="</XML>",l.strXML=s.toString(),""}}function ta(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",6),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.Button_Click("Post"))}),e.nrm(1,"i",12),e.EFF(2,"Post"),e.k0s()}}let aa=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-post-att-time-sheet-to-daily-att"]],decls:36,vars:12,consts:[[2,"display","flex","position","relative","height","100%"],[2,"width","100%"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-file-export"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n    "),e.j41(2,"div",1),e.EFF(3,"\n        "),e.j41(4,"div",2),e.EFF(5,"\n            "),e.j41(6,"label",3),e.EFF(7),e.k0s(),e.EFF(8,"\n            "),e.j41(9,"div",4),e.EFF(10,"\n            "),e.DNE(11,ta,3,0,"span",5),e.EFF(12,"\n            "),e.j41(13,"span",6),e.bIt("click",function(){return i.obj.Button_Click("Clear")}),e.nrm(14,"i",7),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.EFF(17,"\n            "),e.j41(18,"span",6),e.bIt("click",function(){return i.obj.Button_Click("Filter")}),e.nrm(19,"i",8),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.EFF(22,"\n            "),e.j41(23,"span",6),e.bIt("click",function(){return i.obj.Button_Click("Export")}),e.nrm(24,"i",9),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.EFF(27,"\n            "),e.k0s(),e.EFF(28,"\n        "),e.k0s(),e.EFF(29,"\n        "),e.j41(30,"div",10),e.EFF(31,"\n            "),e.nrm(32,"app-PactGridView",11),e.EFF(33,"  \n        "),e.k0s(),e.EFF(34,"\n   "),e.k0s(),e.EFF(35,"\n "),e.k0s()),2&s&&(e.R7$(7),e.JRh(i.obj.Title),e.R7$(4),e.Y8G("ngIf",i.obj.PostVisiblility),e.R7$(4),e.JRh(e.bMT(16,6,"Clear")),e.R7$(5),e.JRh(e.bMT(21,8,"Filter")),e.R7$(5),e.JRh(e.bMT(26,10,"lbl_Export")),e.R7$(7),e.Y8G("obj",i.obj.dgv))},dependencies:[_e.bT,Qe.X,Ue.D9],encapsulation:2})}return G})();var pt=W(48875),lt=W(95050),Rt=W(33012);class Ot extends at.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}set RefreshGrid(a){}constructor(a){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.DialogResult=!1,this.PostVisiblility=!0,this._SelectAll=!1,this.ChkBtnPostOnlyFirstAndLastTrans=new je.c,this.PostOnlyFirstInLastOut=!1,this.PostOnlyFirstInLastOutVisibility=!0,this.btnCancelFlag=!1,this.SelectUnCheck=0,this.dsEmps=null,this.sEmpSeqNosOnGrid="",this.sFilter="",this.iPostDocType=0,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.btnCancelFlag=!1,this.LoadGrid(),this.btnFilter_Click()}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",l)}}LoadGrid(){this.dgv=new Ye.vv,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");let l,a=new X.O7;if(this.dgv.Columns=new Array,a=new X.O7,a.Header="Select",a.DisplayMember="Select",a.DataType="CheckBox",a.Width=50,a.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(a),a=new X.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new X.O7,a.Header="Employee Code",a.DisplayMember="EmpCode",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new X.O7,a.Header="Employee Name",a.DisplayMember="EmpName",a.DataType="TextBlock",a.Width=220,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new X.O7,a.Header="Voucher No.",a.DisplayMember="VoucherNo",a.DataType="LINK_VOUCHER",a.Width=180,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new X.O7,a.Header="Check-in Date",a.DisplayMember="CheckInDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Check-in Time",a.DisplayMember="CheckInTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Check-out Date",a.DisplayMember="CheckOutDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Check-out Time",a.DisplayMember="CheckOutTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Total Time",a.DisplayMember="TotalTime",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Result",a.DisplayMember="Result",a.DataType="TextBlock",a.Width=200,a.ReadOnly=!0,this.dgv.Columns.push(a),this.dsCols=r.d.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(l=this.dsCols.Tables[0].filter(s=>1==s.IsColumnInUse),null!=l&&l.length>0))for(let s=0;s<l.length;s++)a=new X.O7,a.Header=l[s].USERCOLUMNNAME.toString(),a.DisplayMember=l[s].SysColumnName.toString(),a.ID=l[s].SysColumnName.toString(),a.DataType="LISTBOX",a.CostCenterID=parseInt(l[s].ColumnCostCenterID),a.TypeID=parseInt(l[s].ColumnCCListViewTypeID),a.ReadOnly=!0,a.Width=120,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember),a=new X.O7,a.DisplayMember=l[s].SysColumnName.toString()+"_Key",a.IsVisible=!1,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgv.Table.length;l++)0==this.SelectUnCheck&&(this.dgv.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"Filter"==a.toString()?this.btnFilter_Click():"Export"==a.toString()&&this.Export_Click()}Export_Click(){this.dgv.Excelexportdelegate.Call()}btnClear_Click(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}btnPost_Click(){if(this.ValidatePosting()){let l,s,a="",i=null;for(let n=0;n<this.objEmpFilter.DocumentsToLoad.Items.length;n++)if(i=null,1==this.objEmpFilter.DocumentsToLoad.Items[n].IsChecked)if("89"==this.objEmpFilter.DocumentsToLoad.Items[n].Value?r.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):"90"==this.objEmpFilter.DocumentsToLoad.Items[n].Value?r.d.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(i=r.d.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")):"103"==this.objEmpFilter.DocumentsToLoad.Items[n].Value&&r.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")),null!=i){let d="";if(null!=this.dtData&&this.dtData.length>0){let c=this.dtData.filter(g=>g.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[n].Value);if(null!=c&&c.length>0)for(let g=0;g<c.length;g++)d.length>0&&(d+=","),d+=c[g].EmpSeqNo.toString()}let h=this.GetGroupByFilterEmployees(d);if(null!=h&&h.length>0){let c="";if(null!=i&&i.length>0){for(let g=0;g<i.length;g++)C.J0.IsEmptySpace(i[g])||(c.length>0&&(c+=","),c+="-1"==i[g]?"RptManager":"-2"==i[g]?"EmpSeqNo":"CCNID"+(parseInt(i[g])-5e4));if(c.length>0){let g=h.ToTable(!0,c.split(","));if(null!=g&&g.length>0){this.dgv.TableColumns.Contains("Flag")&&this.dgv.TableColumns.Remove("Flag"),this.dgv.TableColumns.push("Flag");for(let D=0;D<this.dgv.Table.length;D++)this.dgv.TableColumns.Contains("Flag")&&(this.dgv.Table[D].Flag="0");for(let D=0;D<g.length;D++){let p=h;for(let t=0;t<Object.keys(g[0]).length;t++){let T=Object.keys(g[0])[t],P=g[0][T];p=p.filter(A=>A[T]==C.J0.String(P))}Object.keys(g[0]).length>0&&p.length>0&&lt.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(t=>{t.ScreenObject.GridData.Clear();let T=-1;for(let A=0;A<this.dgv.Table.length;A++)if((0,se.yG0)(this.dgv.Table[A].Select)&&(s=this.dtData.filter(_=>_.InvDocDetailsID==this.dgv.Table[0].InvDocDetailsID&&_.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[n].Value),null!=s&&s.length>0&&"1"!=C.J0.String(this.dgv.Table[A].Flag)&&p.filter(_=>_.EmpCode==s[0].EmpCode.toString()).length>0)){if(this.dgv.Table[A].Flag="1",T++,l=t.ScreenObject.GridDataObj.NewRow(),t.ScreenObject.GridDataObj.addRow(l),t.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(t.ScreenObject.GridData[T].dcCCNID51Code=s[0].EmpCode),t.ScreenObject.GridData[T].dcCCNID51_Key=s[0].EmpSeqNo,t.ScreenObject.GridData[T].dcCCNID51=s[0].EmpName,t.FillDefaultProd(t.ScreenObject.GridData[T],"dcCCNID51"),t.ScreenObject.GridDataColumns.Contains("RefNo")&&(t.ScreenObject.GridData[T].RefNo=s[0].InvDocDetailsID),t.ScreenObject.GridData[T].dcAlpha1=C.J0.ParseDate(s[0].CheckInDate).ToString(r.d.SessionManager.Preferences["Date Format"]),t.ScreenObject.GridData[T].dcAlpha1_Key=C.J0.ParseDate(s[0].CheckInDate),t.Celleditend(t.ScreenObject.GridData[T],"dcCCNID51",0),t.ScreenObject.GridData[T].dcAlpha2=C.J0.ParseDate(s[0].CheckInTime).ToString("HH:mm"),t.ScreenObject.GridData[T].dcAlpha2_Key=C.J0.ParseDate(s[0].CheckInTime),t.ScreenObject.GridData[T].dcAlpha3=C.J0.ParseDate(s[0].CheckOutTime).ToString("HH:mm"),t.ScreenObject.GridData[T].dcAlpha3_Key=C.J0.ParseDate(s[0].CheckOutTime),t.Celleditend(t.ScreenObject.GridData[T],"dcAlpha3",40067),t.ScreenObject._CCFields.length>0)for(let _=0;_<t.ScreenObject._CCFields.length;_++)"DCCCNID51"!=t.ScreenObject._CCFields[_].DBColumnName.toUpperCase()&&(t.ScreenObject.GridDataColumns.Contains(t.ScreenObject._CCFields[_].DBColumnName+"_Key")?t.ScreenObject.GridData[T][t.ScreenObject._CCFields[_].DBColumnName+"_Key"]=s[0][t.ScreenObject._CCFields[_].DBColumnName].toString():(t.ScreenObject._CCFields[_]instanceof ct.y$||t.ScreenObject._CCFields[_]instanceof pt.G)&&(t.ScreenObject._CCFields[_].SelectedValue=parseInt(s[0][t.ScreenObject._CCFields[_].DBColumnName])));for(let _=0;_<t.ScreenObject.GridDataColumns.length;_++)t.ScreenObject.GridDataColumns[_].startsWith("dcCCNID")&&!t.ScreenObject.GridDataColumns[_].endsWith("_Key")&&!t.ScreenObject.GridDataColumns[_].endsWith("Code")&&"DCCCNID51"!=t.ScreenObject.GridDataColumns[_].toUpperCase()&&"DCCCNID73"!=t.ScreenObject.GridDataColumns[_].toUpperCase()&&(t.ScreenObject.GridData[T][t.ScreenObject.GridDataColumns[_]]="",t.ScreenObject.GridData[T][t.ScreenObject.GridDataColumns[_]+"_Key"]=s[0][t.ScreenObject.GridDataColumns[_]]);t.CalculateTotals(t.ScreenObject.GridData[T],!1),t.ScreenObject.GridDataObj.updateRow(t.ScreenObject.GridData[T]),t.ScreenObject.GridDataObj.RefreshGrid=!0}C.J0.IsEmptySpace(a)||(t.DisplayMessage=a,t.MessageVisibility=!0),t.UpdateFooter=!0,t.RefreshGrid=!0,r.d.page.addNewTab({title:t.DisplayName,component:Rt.AddEditDocumentComponent,params:{obj:t}});var P=t.ScreenObject._StaticFields.find(A=>"CommonNarration"==A.DBColumnName);null!=P&&(P.SetFocus=!0)})}}}}}}else{let d=this.dtData.filter(h=>h.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[n].Value);null!=d&&d.length>0&&lt.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(h=>{h.ScreenObject.GridData.Clear();let c=-1;for(let D=0;D<this.dgv.Table.length;D++)if((0,se.yG0)(this.dgv.Table[D].Select)&&(s=this.dtData.filter(p=>p.InvDocDetailsID==this.dgv.Table[D].InvDocDetailsID.toString()&&p.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[n].Value),null!=s&&s.length>0)){if(c++,l=h.ScreenObject.GridDataObj.NewRow(),h.ScreenObject.GridDataObj.addRow(l),h.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(h.ScreenObject.GridData[c].dcCCNID51Code=s[0].EmpCode),h.ScreenObject.GridData[c].dcCCNID51_Key=s[0].EmpSeqNo,h.ScreenObject.GridData[c].dcCCNID51=s[0].EmpName,h.FillDefaultProd(h.ScreenObject.GridData[c],"dcCCNID51"),h.ScreenObject.GridDataColumns.Contains("RefNo")&&(h.ScreenObject.GridData[c].RefNo=s[0].InvDocDetailsID),h.ScreenObject.GridData[c].dcAlpha1=C.J0.ParseDate(s[0].CheckInDate).ToString(r.d.SessionManager.Preferences["Date Format"]),h.ScreenObject.GridData[c].dcAlpha1_Key=C.J0.ParseDate(s[0].CheckInDate),h.Celleditend(h.ScreenObject.GridData[c],"dcCCNID51",0),h.ScreenObject.GridData[c].dcAlpha2=C.J0.ParseDate(s[0].CheckInTime).ToString("HH:mm"),h.ScreenObject.GridData[c].dcAlpha2_Key=C.J0.ParseDate(s[0].CheckInTime),h.ScreenObject.GridData[c].dcAlpha3=C.J0.ParseDate(s[0].CheckOutTime).ToString("HH:mm"),h.ScreenObject.GridData[c].dcAlpha3_Key=C.J0.ParseDate(s[0].CheckOutTime),h.Celleditend(h.ScreenObject.GridData[c],"dcAlpha3",40067),h.ScreenObject._CCFields.length>0)for(let p=0;p<h.ScreenObject._CCFields.length;p++)"DCCCNID51"!=h.ScreenObject._CCFields[p].DBColumnName.toUpperCase()&&(h.ScreenObject.GridDataColumns.Contains(h.ScreenObject._CCFields[p].DBColumnName+"_Key")?h.ScreenObject.GridData[c][h.ScreenObject._CCFields[p].DBColumnName+"_Key"]=s[0][h.ScreenObject._CCFields[p].DBColumnName].toString():(h.ScreenObject._CCFields[p]instanceof ct.y$||h.ScreenObject._CCFields[p]instanceof pt.G)&&(h.ScreenObject._CCFields[p].SelectedValue=parseInt(s[0][h.ScreenObject._CCFields[p].DBColumnName])));for(let p=0;p<h.ScreenObject.GridDataColumns.length;p++)h.ScreenObject.GridDataColumns[p].startsWith("dcCCNID")&&!h.ScreenObject.GridDataColumns[p].endsWith("_Key")&&"DCCCNID51"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&"DCCCNID73"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&(h.ScreenObject.GridData[c][h.ScreenObject.GridDataColumns[p]+"_Key"]=s[0][h.ScreenObject.GridDataColumns[p]]);h.CalculateTotals(h.ScreenObject.GridData[c],!1),h.ScreenObject.GridDataObj.updateRow(h.ScreenObject.GridData[c]),h.ScreenObject.GridDataObj.RefreshGrid=!0}C.J0.IsEmptySpace(a)||(h.DisplayMessage=a,h.MessageVisibility=!0),h.UpdateFooter=!0,h.RefreshGrid=!0,r.d.page.addNewTab({title:h.DisplayName,component:Rt.AddEditDocumentComponent,params:{obj:h}});var g=h.ScreenObject._StaticFields.find(D=>"CommonNarration"==D.DBColumnName);g&&(g.SetFocus=!0)})}}}GetGroupByFilterEmployees(a){let l="  AND EmpSeqNo IN ("+a+")",s=[];return s.push(Date.Today().ToString("dd MMM yyyy")),s.push(l),s.push(0),s.push(r.d.SessionManager.RoleID),s.push(r.d.SessionManager.UserID),s.push(r.d.SessionManager.LanguageID),r.d.empService.GetData(s,"spPAY_GetEmpMasterCCDetails").Tables[0]}ValidatePosting(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");{let a=0;for(let l=0;l<this.dgv.Table.length;l++)(0,se.yG0)(this.dgv.Table[l].Select)&&a++;if(0==a)return this.DisplayMessage="Select atleast one Document to post",!1;for(let l=0;l<this.dgv.Table.length;l++)if((0,se.yG0)(this.dgv.Table[l].Select)&&(null==this.dgv.Table[l].CheckInTime||null==this.dgv.Table[l].CheckInTime||""==this.dgv.Table[l].CheckInTime.toString()||null==this.dgv.Table[l].CheckOutTime||null==this.dgv.Table[l].CheckOutTime||""==this.dgv.Table[l].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(l+1).toString(),!1}return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(a){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+a.stack),!1}}btnFilter_Click(){Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new o.t("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?r.d.page.ShowDialog(this.objEmpFilter,gt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}btnFilter_Click_CallBack(){if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0){let l=1,s="",i="",n="";for(let d=0;d<this.objEmpFilter.CostCenterFilters.length;d++){let h=this.objEmpFilter.CostCenterFilters[d];if(h.CostCenterID>5e4&&(l=2,s="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)n+=" AND ",n+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(c=>c.Id==l&&c.IsGroup))if(n+=" AND ",ht.IPrefetchFilter.IsGroupTree(h)){let c="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(c.length>0&&(c+=","),c+=h.SelectedNodes[g].Id);0==c.length&&(c+=-12912),n+=i+" IN ",n+=" (select T."+s+" GTID from "+ze.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+ze.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",n+=c.toString()+")  group by T."+s+")"}else{n+=i+" IN (";for(let c=0;c<h.SelectedNodes.length;c++)c>0&&(n+=","),n+=h.SelectedNodes[c].Id;n+=")"}}else h.DeleteButtonVisibility||(n+=" AND ",n+=i+"=-12912")}this.sFilter=n.toString()}this.FilterEmployees()}}FilterEmployees(){this.sEmpSeqNosOnGrid="",this.objEmpFilter.rBtnPostAttDocs?this.iPostDocType=89:this.objEmpFilter.rBtnPostTimeSheetDocs?this.iPostDocType=90:this.objEmpFilter.rBtnPostOnDutyDocs&&(this.iPostDocType=103),this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");let l=[];l.push(Date.Today().ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID);let s=r.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails"),i="";if(this.dgv.Clear(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0){for(let d=0;d<s.Tables[0].length;d++)i.Trim().length>0&&(i+=","),i+=s.Tables[0][d].EmpSeqNo.toString();var a;let n="";for(let d=0;d<this.objEmpFilter.DocumentsToLoad.Items.length;d++)1==this.objEmpFilter.DocumentsToLoad.Items[d].IsChecked&&(n.Trim().length>0&&(n+=","),n+=this.objEmpFilter.DocumentsToLoad.Items[d].Value);if(a=r.d.common.GetDataSet3("PAY117",n,i,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy")),this.dtData=a.Tables[0],!(null!=a&&a.Tables.length>0&&a.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");{let d;for(let h=0;h<a.Tables[0].length;h++){d=this.dgv.NewRow(),d.Select=!1,d.SNo=(h+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=a.Tables[0][h].EmpSeqNo.toString(),d.EmpSeqNo=a.Tables[0][h].EmpSeqNo,d.EmpCode=a.Tables[0][h].EmpCode,d.EmpName=a.Tables[0][h].EmpName,d.InvDocDetailsID=a.Tables[0][h].InvDocDetailsID,d.VoucherNo=a.Tables[0][h].VoucherNo,d.CheckInDate=a.Tables[0][h].CheckInDate,C.J0.IsEmptySpace(a.Tables[0][h].CheckInTime)||(d.CheckInTime=C.J0.ParseDate(a.Tables[0][h].CheckInTime).ToString("HH:mm")),C.J0.IsEmptySpace(a.Tables[0][h].CheckOutDate)?d.Row_Background="#F77B7E":d.CheckOutDate=a.Tables[0][h].CheckOutDate,C.J0.IsEmptySpace(a.Tables[0][h].CheckOutTime)||(d.CheckOutTime=C.J0.ParseDate(a.Tables[0][h].CheckOutTime).ToString("HH:mm")),d.TotalTime=C.J0.IsEmptySpace(a.Tables[0][h].TotalTime)?"0.00":a.Tables[0][h].TotalTime,0==parseFloat(d.TotalTime.toString().Replace(":","."))&&(d.Row_Background="#F77B7E");for(let c=0;c<this.dgv.TableColumns.length;c++)this.dgv.TableColumns[c].startsWith("dcCCNID")&&!this.dgv.TableColumns[c].endsWith("_Key")&&(d[this.dgv.TableColumns[c]+"_Key"]=a.Tables[0][h][this.dgv.TableColumns[c]]);this.dgv.addRow(d)}this.dgv.refreshDataView(),this.dgv.RefreshGrid=!0,this.dgv.Update()}}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+l.stack)}}}var Vt=W(5661);const sa=()=>({standalone:!0});let la=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-payslip"]],decls:71,vars:28,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-filter"],[1,"main_div"],[2,"padding","11px"],[1,"row","form-row"],[1,"form-group","col-md-3","col-sm-6","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"align-content","center"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n        "),e.j41(2,"div",1),e.EFF(3,"\n            "),e.j41(4,"span",2),e.EFF(5),e.k0s(),e.EFF(6,"\n            "),e.j41(7,"div",3),e.EFF(8,"\n                "),e.j41(9,"span",4),e.bIt("click",function(){return i.obj.Button_Click("Preview")}),e.nrm(10,"i",5),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.EFF(13," \n                "),e.j41(14,"span",4),e.bIt("click",function(){return i.obj.Button_Click("Print")}),e.nrm(15,"i",6),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.EFF(18," \n                "),e.j41(19,"span",4),e.bIt("click",function(){return i.obj.Button_Click("Export")}),e.nrm(20,"i",7),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.EFF(23,"\n                "),e.j41(24,"span",4),e.bIt("click",function(){return i.obj.Button_Click("EMail")}),e.nrm(25,"i",8),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.EFF(28,"\n                "),e.j41(29,"span",4),e.bIt("click",function(){return i.obj.Button_Click("Filter")}),e.nrm(30,"i",9),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.EFF(33,"\n            "),e.k0s(),e.EFF(34,"\n        "),e.k0s(),e.EFF(35,"\n"),e.j41(36,"div",10),e.EFF(37,"\n    "),e.j41(38,"div",11),e.EFF(39,"          \n        "),e.j41(40,"div",12),e.EFF(41,"\n            "),e.j41(42,"div",13),e.EFF(43,"\n                "),e.eu8(44,14),e.EFF(45,"\n            "),e.k0s(),e.EFF(46,"\n            "),e.j41(47,"div",13),e.EFF(48,"\n                "),e.eu8(49,14),e.EFF(50,"\n            "),e.k0s(),e.EFF(51,"\n            "),e.j41(52,"div",13),e.EFF(53,"\n                "),e.eu8(54,14),e.EFF(55,"\n            "),e.k0s(),e.EFF(56,"\n                "),e.j41(57,"div",15),e.EFF(58,"\n                  "),e.j41(59,"input",16),e.mxI("ngModelChange",function(d){return e.DH7(i.obj.ExportSeperate,d)||(i.obj.ExportSeperate=d),d}),e.k0s(),e.EFF(60,"\n                  "),e.j41(61,"label",17),e.bIt("click",function(){return i.obj.ExportSeperate=!i.obj.ExportSeperate}),e.EFF(62),e.nI1(63,"translate"),e.k0s(),e.EFF(64,"\n              "),e.k0s(),e.EFF(65,"              \n    "),e.k0s(),e.EFF(66,"\n\n    "),e.j41(67,"div",18),e.EFF(68,"\n        \n    "),e.k0s(),e.EFF(69,"\n"),e.k0s(),e.EFF(70,"\n "),e.k0s()()),2&s&&(e.R7$(5),e.JRh(i.obj.Title),e.R7$(6),e.JRh(e.bMT(12,15,"Preview")),e.R7$(5),e.JRh(e.bMT(17,17,"Print")),e.R7$(5),e.JRh(e.bMT(22,19,"Export")),e.R7$(5),e.JRh(e.bMT(27,21,"EMail")),e.R7$(5),e.JRh(e.bMT(32,23,"Filter")),e.R7$(13),e.Y8G("obj",i.obj.dtpPayrollMonth)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.cmbPayslipLayout)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.cmbSortOn)("group",i.form),e.R7$(5),e.R50("ngModel",i.obj.ExportSeperate),e.Y8G("ngModelOptions",e.lJ4(27,sa)),e.R7$(3),e.JRh(e.bMT(63,25,"Export Each Employee Seperately")))},dependencies:[Ae._,ye.Zm,ye.BC,ye.vS,Ue.D9],encapsulation:2})}return G})();var ia=W(54004),It=W(70234),wt=W(54683),St=W(9309),Gt=W(39559),Se=W(31820),dt=W(95005),na=W(3436),oa=W(93426),kt=W(78906);class _t extends at.g{get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}constructor(){super(),this.CostCenterID=0,this.TypeID=0,this.AttachmentVisibility=!1,this.Employee=new pt.G(0),this.AttachVisiblility=!1,this.PayrollTaxFields=new Array,this.dtPayrollTaxCmptsObj=new Ye.vv,this.Savereturnvalue=-1,this.oRadio1=null,this.dsTaxComponents=null,this.CostCenterID=262,this.objEmp=new Gt.h,this.ScreenObject=new kt.a(0,0),this.ScreenObject.Data=[],this.ViewAttachments=new St.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.AttachVisiblility=r.d.SessionManager.IsActionAssigned(262,"Attach"),this.EmpYear=new ge.y$(0),this.EmpYear.LblWidth="60",this.EmpYear.Label=r.d.GetResource("Doc_Year"),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let a=2e3;a<2100;a++){let l=ge._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=C.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("yyyy"),this.EmpRegime=new ge.y$(0),this.EmpRegime.Items.push(ge._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(ge._p.ComboBoxItems_2("New","New")),this.EmpRegime.Label="Regime Opted For",this.lFinancialDate=this.GetFinancialYear(),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.LblWidth="80",this.EmpRegime.LblWidth="80",this.Employee.Label=r.d.GetResource("Pay_Employee"),this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=new Array,this.dtPayrollTaxCmptsObj.Height=110,this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),this.BindHRAGridColumns()}BindHRAGridColumns(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();let a=new X.O7;a.Header="FromDate",a.DisplayMember="ITFromDate",a.ValueMember="ITFromDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="ToDate",a.DisplayMember="ITToDate",a.ValueMember="ITToDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=75,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="Metro",a.ValueBinding="Metro",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=60;let l=[];l.push(ge._p.ComboBoxItems_2("Yes","Yes")),l.push(ge._p.ComboBoxItems_2("No","No")),a.ComboData=l,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="HRAAddress",a.DisplayMember="HRAAddress",a.DataType="TextArea",a.ReadOnly=!1,a.Width=200,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="Name of Landlord",a.DisplayMember="NameofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=153,this.PayrollColumnSourceTaxComponents.push(a),a=new X.O7,a.Header="Pan of Landlord",a.DisplayMember="PanofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=150,this.PayrollColumnSourceTaxComponents.push(a),this.dtPayrollTaxCmptsObj.RefreshGridView()}Employee_SelectedValueChanged(a){""!=this.EmpYear.SelectedValue.toString()?(this.EmpRegime.SelectedValue="",this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new St.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}OnYearSelected(a){this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.lFinancialDate=this.GetFinancialYear(),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth,1),s=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(s.getMonth(),!1)+" "+s.getFullYear(),a}OnComponentSelection(a){let l="",s="";this.PayrollTaxFields.forEach(i=>{if(i instanceof dt.mn){let n=i;if(s=n.Currency.SelectedValue,null!=s){let d=this.dsTaxComponents.Tables[0].filter(h=>"ComboTextValue"==h.ControlType&&h.NodeID==parseInt(s));for(let h=0;h<d.length;h++){let c=d[h];"COMBOTEXTVALUE"===(l=C.J0.String(c.ControlType),l)&&(n.Label=C.J0.String(c.AmountLimit))}}}})}GenerateTaxComponentFields(a,l,s){try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");let n,d,i=0,h=null,c=null;if(null===l&&(l=0),0!=a&&0!=l&&(h=r.d.common.GetDataSet3("PAY071",a.toString(),l.toString())),null!=h&&h.Tables.length>0&&h.Tables[0].length>0&&!C.J0.IsEmpty(h.Tables[0][0].SEQNO)&&(c=r.d.common.GetDataSet("PAY072",h.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=r.d.empService.GetIncomeTaxComponents(0,a,l),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!C.J0.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());let g=this.dsTaxComponents.Tables[0];if(g.forEach(D=>{switch(n=C.J0.String(D.CONTROLTYPE).toUpperCase(),n){case"LABEL":d=new na.D,d.Label=C.J0.String(D.NAME),s.push(d),d.tabname="LABEL";break;case"TEXTBOX":this.LabelLimitAmount=C.J0.String(D.AMOUNTLIMIT),this.oText=new Se.Dw(parseInt(D.NODEID)),this.oText.Label=C.J0.String(D.NAME),this.oText.KeyTip=this.LabelLimitAmount,this.oText.Text=D.AMOUNT.toString(),this.oText.LblWidth="400",this.oText.tabname="TEXTBOX",s.push(this.oText);break;case"COMBOTEXTVALUE":let t=g.filter(T=>"ComboTextValue"==T.CONTROLTYPE&&T.GROUPID==parseInt(D.GROUPID));var p=s.find(T=>T instanceof dt.mn&&T.DBColumnID==parseInt(D.GROUPID));null==p?(this.oRadio1=new dt.mn,this.oRadio1.DBColumnID=parseInt(D.GROUPID)):this.oRadio1=p,this.oRadio1.tabname="COMBOTEXTVALUE",this.oRadio1.LblWidth="1",(0==i||i!=parseInt(D.GROUPID))&&t.length>0&&(t.forEach(T=>{this.oRadio1.Currency.Items.push(ge._p.ComboBoxItems_2(C.J0.String(T.NAME).TrimStart(" "),C.J0.String(T.NODEID)))}),this.oRadio1.Currency.SelectedValue=this.oRadio1.Currency.Items[0].Value,this.oRadio1.Currency.SelectionChangedCommand.Subscribe(this,"OnComponentSelection"),s.push(this.oRadio1)),parseInt(D.SELECTEDNODE)>0?(this.oRadio1.Currency.SelectedValue=C.J0.String(D.SELECTEDNODE),this.oRadio1.ExchangeRate.Text=D.AMOUNT.toString(),this.oRadio1.Label=D.SELECTEDAMTLIMIT.toString()):""==this.oRadio1.ExchangeRate.Text&&(this.oRadio1.ExchangeRate.Text=D.AMOUNT.toString()),null==this.oRadio1.Label&&(this.LabelLimitAmount=C.J0.String(D.AMOUNTLIMIT),this.oRadio1.Label=this.LabelLimitAmount),(0==i||i!=parseInt(D.GROUPID))&&(i=parseInt(D.GROUPID))}}),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>2&&this.dsTaxComponents.Tables[2].length>0&&this.dsTaxComponents.Columns[2].Contains("RegimeType")&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&""!=this.dsTaxComponents.Tables[2][0].RegimeType.toString()&&(this.EmpRegime.SelectedValue=this.dsTaxComponents.Tables[2][0].RegimeType.toString()),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0){let p;for(let t=0;t<this.dsTaxComponents.Tables[1].length;t++)p=this.dtPayrollTaxCmptsObj.NewRow(),p.ITFromDate=C.J0.ParseDate(this.dsTaxComponents.Tables[1][t].FromDate).ToString("MMM/yyyy"),p.ITFromDate_Key=C.J0.ParseDate(this.dsTaxComponents.Tables[1][t].FromDate).ToString("dd-MMM-yyyy"),p.ITToDate=C.J0.ParseDate(this.dsTaxComponents.Tables[1][t].ToDate).ToString("MMM/yyyy"),p.ITToDate_Key=C.J0.ParseDate(this.dsTaxComponents.Tables[1][t].ToDate).ToString("dd-MMM-yyyy"),p.Amount=this.dsTaxComponents.Tables[1][t].Amount.toString(),p.Metro=this.dsTaxComponents.Tables[1][t].Metro.toString().TrimEnd(),p.HRAAddress=this.dsTaxComponents.Tables[1][t].Address.toString(),p.NameofLandlord=this.dsTaxComponents.Tables[1][t].Landlord.toString(),p.PanofLandlord=this.dsTaxComponents.Tables[1][t].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(p)}if(null!=c&&c.Tables.length>0&&c.Tables[0].length>0){let D=c.Tables[0];if(null!=D&&D.length>0)for(let p=0;p<D.length;p++){let t=new wt.AddAttachmentViewModel;t.AddAttachmentViewModel_2(this),t.AttachmentID=parseInt(D[p].FileID),t.ActualFileName=D[p].ActualFileName.toString(),t.FileExtension=D[p].FileExtension.toString(),t.FileDescription=D[p].FileDescription.toString(),t.FilePath=C.J0.GetPath(D[p].GUID+"."+D[p].FileExtension),t.RelativeFileName=D[p].RelativeFileName.toString(),t.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(t)}}else this.BindEmptyRows(2)}catch(i){Logger.ErrorLog("Error : "+i),this.DisplayMessage=i.message}}OnSaveITDeclarations(a){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");let l="";if(l=this.DataValid(),""!=l.toString())return void(this.DisplayMessage=l);this.SaveEmpIncomeTax(),this.OnClear(a)}catch(l){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+l)}}DataValid(){let l,s,a="",i=0,n=0;0==this.Employee.SelectedValue&&(a+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(a+="Please select the Year \r\n");let d=r.d.common.GetDataTable("PAY111",this.EmpYear.SelectedValue.ToString());null!=d&&d.length>0&&(C.J0.IsEmpty(d[0].dcAlpha9)||C.J0.ParseDate(d[0].dcAlpha9)<Date.Today()&&(a+="Cannot save the record,CutOffDate Exceeded \r\n")),this.PayrollTaxFields.forEach(h=>{if(h instanceof Se.Dw){let c=h;i=C.J0.Double(c.KeyTip),n=C.J0.Double(c.Text),i>0&&n>i&&(a=a+"Amount should be less than Limit Amount for '"+c.Label.toString().Trim()+"'\r\n")}if(h instanceof dt.mn){let c=h;i=C.J0.Double(c.Label),n=C.J0.Double(c.ExchangeRate.Text),i>0&&n>i&&(a=a+"Amount should be less than Limit Amount for '"+c.Currency.Text.toString().Trim()+"'\r\n")}});for(let h=0;h<this.dtPayrollTaxCmpts.length;h++)C.J0.IsEmpty(this.dtPayrollTaxCmpts[h].ITFromDate_Key)||(C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))>C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))?a=a+"Fromdate should be less than todate at row no ('"+h.toString()+"')\r\n":C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))<C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))&&(a=a+"Todate should be greater than fromdate at row no ('"+h.toString()+"')\r\n"));for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=C.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key);h++){l=C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),s=C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"));for(let c=0;c<this.dtPayrollTaxCmpts.length;c++)if(h!=c){if(""==C.J0.String(this.dtPayrollTaxCmpts[c].ITFromDate_Key))break;if(+l.Date>=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+l.Date<=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+s.Date>=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+s.Date<=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+l.Date>=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+s.Date<=+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()>=+l.Date&&+C.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()<=+s.Date){a=a+"Invalid dates entered at row no ('"+c.toString()+"')\r\n";break}}}for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=C.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key)&&""!=C.J0.String(this.dtPayrollTaxCmpts[h].ITToDate_Key);h++)if(l=C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),s=C.J0.ParseDate(C.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy")),""!=this.dtPayrollTaxCmpts[h].Amount.toString()){n=parseFloat(this.dtPayrollTaxCmpts[h].Amount);let c=12*(s.getFullYear()-l.getFullYear())+s.getMonth()-l.getMonth()+1;if(n/c>8e3){if(""==this.dtPayrollTaxCmpts[h].NameofLandlord.toString()){a=a+"Mandatory NameofLandlord row no ('"+(h+1).toString()+"')\r\n";break}if(""==this.dtPayrollTaxCmpts[h].PanofLandlord.toString()){a=a+"Mandatory PanofLandlord row no ('"+(h+1).toString()+"')\r\n";break}}}return a}SaveEmpIncomeTax(){Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{let l="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),this.objEmp.Regime=this.EmpRegime.SelectedValue,l+="<Rows>",this.PayrollTaxFields.forEach(n=>{n instanceof Se.Dw?(l+='<row ComponentID="'+n.DBColumnID,l+='" AmountLimit="'+n.KeyTip,l+=null!=n.Text?'" Amount="'+parseFloat(n.Text):'" Amount="0',l+='"/>'):n instanceof dt.mn&&(l+='<row ComponentID="'+n.Currency.SelectedValue,l+='" AmountLimit="'+n.Label,l+=null!=n.ExchangeRate.Text?'" Amount="'+parseFloat(n.ExchangeRate.Text):'" Amount="0',l+='"/>')}),l+="</Rows>";let s="";s+="<HRAINFO>";for(let n=0;n<this.dtPayrollTaxCmpts.length;n++)(""!=C.J0.String(this.dtPayrollTaxCmpts[n].ITFromDate_Key)||""!=C.J0.String(this.dtPayrollTaxCmpts[n].ITToDate_Key))&&(s+='<row FromDt="'+C.J0.ParseDate(this.dtPayrollTaxCmpts[n].ITFromDate_Key).ToString("dd-MMM-yyyy"),s+='" ToDt="'+C.J0.ParseDate(this.dtPayrollTaxCmpts[n].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[n].Amount.toString()?s+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[n].Amount):s+='" Amt="0',s+='" Metro="'+this.dtPayrollTaxCmpts[n].Metro,s+='" Address="'+this.dtPayrollTaxCmpts[n].HRAAddress,s+='" Landlord="'+this.dtPayrollTaxCmpts[n].NameofLandlord,s+='" LandlordPAN="'+this.dtPayrollTaxCmpts[n].PanofLandlord,s+='"/>');s+="</HRAINFO>";let i=this.ViewAttachments.GetXML();r.d.empService.SaveEmpTaxDeclarations(l.toString(),s.toString(),i.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode,this.objEmp.Regime).subscribe(n=>{this.DisplayMessage=n.Message,this.Savereturnvalue=n.RetValue})}catch(a){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+a.stack)}}OnClear(a){try{this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new St.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(l){Logger.ErrorLog("Error : "+l),this.DisplayMessage=l.message}}BindEmptyRows(a){this.dtPayrollTaxCmptsObj.addEmptyRows(a)}FilterEmployees(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");let l,s,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),s=new Date(r.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingToMonth-1,1),s=s.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+s.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),r.d.SessionManager.IsRptManagerUser&&r.d.SessionManager.IsActionAssigned(262,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+r.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+a.stack)}}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let a="";null!=this.Attachment&&(a=this.Attachment.ColID);let l=null;null!=this.Attachment&&(l=this.Attachment.RowID),this.Attachment=new wt.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==a?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=a,this.Attachment.RowID=l),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnClickAttachment(a){this.AttachmentVisibility=!0,r.d.page.ShowDialog(this,oa.l,{Title:"Attachment"})}}function ra(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",6),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.obj.OnClickAttachment())}),e.EFF(1,"\n        "),e.nrm(2,"i",22),e.EFF(3),e.nI1(4,"translate"),e.k0s()}2&G&&(e.R7$(3),e.JRh(e.bMT(4,1,"Attachments")))}function da(G,a){if(1&G&&(e.j41(0,"div",26),e.EFF(1),e.k0s()),2&G){const l=e.XpG().$implicit;e.R7$(),e.JRh(l.Label)}}function ha(G,a){if(1&G&&e.nrm(0,"input",31),2&G){const l=e.XpG(2).$implicit,s=e.XpG();e.Y8G("placeholder",s.lblwatermark)("ngModel",l.Text)}}function U(G,a){if(1&G){const l=e.RV6();e.j41(0,"input",32),e.mxI("ngModelChange",function(i){e.eBV(l);const n=e.XpG(2).$implicit;return e.DH7(n.Text,i)||(n.Text=i),e.Njj(i)}),e.k0s()}if(2&G){const l=e.XpG(2).$implicit;e.Y8G("tabindex",l.IsTabStop?null:-1)("disabled",!l.Enable||l.IsReadOnly),e.R50("ngModel",l.Text)}}function he(G,a){if(1&G&&(e.qex(0),e.EFF(1,"\n                "),e.j41(2,"div"),e.EFF(3,"\n                  "),e.j41(4,"label",27),e.EFF(5),e.k0s(),e.EFF(6," \n                  "),e.j41(7,"label",28),e.EFF(8),e.k0s(),e.EFF(9," \n                  "),e.DNE(10,ha,1,2,"input",29),e.EFF(11,"\n                  "),e.DNE(12,U,1,3,"input",30),e.EFF(13,"\n                     "),e.EFF(14,"\n                "),e.k0s(),e.EFF(15,"\n              "),e.EFF(16,"\n            "),e.bVm()),2&G){const l=e.XpG().$implicit;e.R7$(2),e.AVh("c-flex",l.LblWidth),e.R7$(2),e.BMQ("for",l.DBColumnName),e.R7$(),e.SpI("  ",l.Label," "),e.R7$(2),e.BMQ("for",l.DBColumnName),e.R7$(),e.SpI("    ",l.KeyTip," "),e.R7$(2),e.Y8G("ngIf",!l.ShowControl),e.R7$(2),e.Y8G("ngIf",l.ShowControl)}}function m(G,a){if(1&G&&(e.qex(0),e.EFF(1,"\n              "),e.eu8(2,13),e.EFF(3,"\n            "),e.bVm()),2&G){const l=e.XpG().$implicit,s=e.XpG();e.R7$(2),e.Y8G("obj",l)("group",s.form)}}function I(G,a){if(1&G&&(e.qex(0),e.EFF(1,"\n          "),e.j41(2,"div",23),e.EFF(3,"\n            "),e.DNE(4,da,2,1,"div",24),e.EFF(5,"\n            "),e.DNE(6,he,17,8,"ng-container",25),e.EFF(7,"\n            "),e.DNE(8,m,4,2,"ng-container",25),e.EFF(9,"\n          "),e.k0s(),e.EFF(10,"\n        "),e.bVm()),2&G){const l=a.$implicit;e.R7$(2),e.Y8G("ngSwitch",!0),e.R7$(2),e.Y8G("ngSwitchCase","LABEL"==l.tabname),e.R7$(2),e.Y8G("ngSwitchCase","TEXTBOX"==l.tabname),e.R7$(2),e.Y8G("ngSwitchCase","COMBOTEXTVALUE"==l.tabname)}}let y=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.obj=this.params.obj,console.log(this.obj)}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-income-tax-declaration"]],decls:77,vars:18,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px"],[1,"row"],[1,"form-group","col-xl-3","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label"],[1,"form-group","col-xl-6","col-md-4","col-sm-12","col-xs-12","PACTControl"],[2,"height","calc(100% - 190px)","overflow","auto"],[1,"PACTHeaderFields","row","form-row"],[4,"ngFor","ngForOf"],[1,"documentgrid",2,"height","140px"],[1,"page-subtitle",2,"padding","0","display","block","height","30px","font-size","16px"],[2,"height","90px"],[1,"fa-light","fa-paperclip"],[1,"form-group","row","PACTControl",3,"ngSwitch"],["class","input_cntrl_label panel-heading","style","font-weight: bold; background-color:var(--gridheaderbg-color); padding: 4px;",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"input_cntrl_label","panel-heading",2,"font-weight","bold","background-color","var(--gridheaderbg-color)","padding","4px"],[1,"input_cntrl_label",2,"width","70%"],[1,"input_cntrl_label",2,"width","10%","font-weight","bold"],["disabled","","class","input_cntrl disablecntrl","style","text-align: right;width: 20%;",3,"placeholder","ngModel",4,"ngIf"],["class","input_cntrl","style","width: 20%;text-align: right;",3,"tabindex","disabled","ngModel","ngModelChange",4,"ngIf"],["disabled","",1,"input_cntrl","disablecntrl",2,"text-align","right","width","20%",3,"placeholder","ngModel"],[1,"input_cntrl",2,"width","20%","text-align","right",3,"ngModelChange","tabindex","disabled","ngModel"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n  "),e.j41(2,"div",1),e.EFF(3,"\n  "),e.j41(4,"div",2),e.EFF(5,"\n     "),e.j41(6,"div",3),e.EFF(7,"\n      "),e.j41(8,"span",4),e.EFF(9),e.k0s(),e.EFF(10,"\n    "),e.k0s(),e.EFF(11,"\n    "),e.j41(12,"div",5),e.EFF(13,"\n      "),e.EFF(14,"\n      "),e.j41(15,"span",6),e.bIt("click",function(){return i.obj.OnSaveITDeclarations()}),e.EFF(16,"\n        "),e.nrm(17,"i",7),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.EFF(20,"\n      "),e.j41(21,"span",6),e.bIt("click",function(){return i.obj.OnClear("Clear")}),e.EFF(22,"\n        "),e.nrm(23,"i",8),e.EFF(24),e.nI1(25,"translate"),e.k0s(),e.EFF(26,"\n      "),e.DNE(27,ra,5,3,"span",9),e.EFF(28,"\n  "),e.k0s(),e.EFF(29,"\n  "),e.k0s(),e.EFF(30,"\n  "),e.j41(31,"div",10),e.EFF(32,"\n    "),e.j41(33,"div",11),e.EFF(34,"\n      "),e.j41(35,"div",12),e.EFF(36,"\n        "),e.eu8(37,13),e.EFF(38,"\n        "),e.j41(39,"label",14),e.EFF(40),e.k0s(),e.EFF(41,"\n      "),e.k0s(),e.EFF(42,"\n      "),e.j41(43,"div",15),e.EFF(44,"\n        "),e.eu8(45,13),e.EFF(46,"\n      "),e.k0s(),e.EFF(47,"\n      "),e.j41(48,"div",12),e.EFF(49,"\n        "),e.eu8(50,13),e.EFF(51,"\n      "),e.k0s(),e.EFF(52,"\n    "),e.k0s(),e.EFF(53,"\n    "),e.j41(54,"div",16),e.EFF(55,"\n      "),e.j41(56,"div",17),e.EFF(57,"\n        "),e.DNE(58,I,11,4,"ng-container",18),e.EFF(59,"\n      "),e.k0s(),e.EFF(60,"\n    "),e.k0s(),e.EFF(61,"\n    "),e.j41(62,"div",19),e.EFF(63,"\n      "),e.j41(64,"span",20),e.EFF(65,"HRA Information"),e.k0s(),e.EFF(66,"\n      "),e.j41(67,"div",21),e.EFF(68,"\n        "),e.eu8(69,13),e.EFF(70,"\n      "),e.k0s(),e.EFF(71,"\n    "),e.k0s(),e.EFF(72,"\n  "),e.k0s(),e.EFF(73,"\n  "),e.k0s(),e.EFF(74,"\n"),e.k0s(),e.EFF(75,"\n\n"),e.EFF(76,"\n")),2&s&&(e.R7$(9),e.SpI("\n        ",i.obj.Title,"\n      "),e.R7$(9),e.JRh(e.bMT(19,14,"Save")),e.R7$(6),e.JRh(e.bMT(25,16,"Clear")),e.R7$(3),e.Y8G("ngIf",i.obj.AttachVisiblility),e.R7$(10),e.Y8G("obj",i.obj.EmpYear)("group",i.form),e.R7$(3),e.JRh(i.obj.lFinancialDate),e.R7$(5),e.Y8G("obj",i.obj.Employee)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.EmpRegime)("group",i.form),e.R7$(8),e.Y8G("ngForOf",i.obj.PayrollTaxFields),e.R7$(11),e.Y8G("obj",i.obj.dtPayrollTaxCmptsObj)("group",i.form))},dependencies:[_e.Sq,_e.bT,_e.ux,_e.e1,Ae._,ye.me,ye.BC,ye.vS,Ue.D9],encapsulation:2})}return G})();var u=W(24028);class M extends at.g{constructor(a){super(),this.dtpFromDate=new u.P6(0),this.dtpToDate=new u.P6(0),this.lTotalTaxAmount="",this.lTDSPaidAmount="",this.lTDSAmount="",this.ButtonClick=new Pt.Yk,this.iComponentID=0,Logger.InfoLog("TDSPostingViewModel::Entering TDSPostingViewModel()"),this.DisplayMessage="",this.Parent=a[0],this.lTotalTaxAmount=a[1].toString(),this.lTDSPaidAmount=a[2].toString(),this.lTDSAmount=a[3].toString(),this.iComponentID=parseInt(a[4]),this.ButtonClick.Subscribe(this,"Button_Click"),this.LoadGrid(),this.dtpFromDate.Label="From Date",this.dtpFromDate.LblWidth="80",this.dtpFromDate.Date=new Date(parseInt(this.Parent.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),this.dtpToDate.Label="To Date",this.dtpToDate.LblWidth="80",this.dtpToDate.Date=this.dtpFromDate.Date.AddYears(1).AddMonths(-1),this.Generate_Click(0),Logger.InfoLog("TDSPostingViewModel::Exiting TDSPostingViewModel()")}LoadGrid(){this.dgv=new Ye.vv,this.dgv.Width="550",this.dgv.CanUserDeleteRows=!1,this.dgv.CanUserAddRows=!1,this.dgv.OnCellEditEnding.Subscribe(this,"dgv_EndEdit"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("Month"),this.dgv.TableColumns.push("Amount");let a=new X.O7;this.dgv.Columns=[],a=new X.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new X.O7,a.Header="Month",a.DisplayMember="Month",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new X.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!1,a.TextAlign="FLOAT",this.dgv.Columns.push(a),this.dgv.Columns[2].footer="0.00",this.dgv.UpdateFooter()}Button_Click(a){Logger.InfoLog("TDSPostingViewModel::Entering Button_Click"),"Post"==a.toString()?this.Post_Click():"Cancel"==a.toString()?r.d.page.HideDialog(this.PopUpGUID):"Generate"==a.toString()&&this.Generate_Click(1),Logger.InfoLog("TDSPostingViewModel::Exiting Button_Click")}Generate_Click(a){this.dgv.Clear();let l=new Date(parseInt(this.Parent.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),s=l.AddYears(1).AddMonths(-1);if(this.dtpFromDate.Date<l||this.dtpFromDate.Date>s)return this.DisplayMessage="From Date should be in Between Finacial Year",void(this.MessageVisibility=!0);if(this.dtpToDate.Date<l||this.dtpToDate.Date>s)return this.DisplayMessage="To Date should be in Between Finacial Year",void(this.MessageVisibility=!0);let i=r.d.common.GetDataSet3("PAY122",this.Parent.Employee.SelectedValue,this.dtpFromDate.Date.ToString("dd MMM yyyy"),this.dtpToDate.Date.ToString("dd MMM yyyy"));if(0==a){if(null!=i&&i.length>0){let D=i.Compute("max","PayrollDate");C.J0.IsEmpty(D)||(this.dtpFromDate.Date=new Date(D))}}else if(1==a&&null!=i&&i.length>0)return this.DisplayMessage="Payroll Already Processed For the Month - "+new Date(i.Rows[0].PayrollDate).ToString("dd MMM yyyy"),void(this.MessageVisibility=!0);let n=null,d=0,h=0,c=0,g=this.dtpFromDate.Date;for(;g<=this.dtpToDate.Date;)d+=1,g=g.AddMonths(1);for(h=parseFloat(this.lTDSAmount)/d,h=parseFloat(h.ToString("0.00")),g=this.dtpFromDate.Date;g<=this.dtpToDate.Date;)n=this.dgv.NewRow(),n.SNo=this.dgv.Table.length+1,n.Month=g.ToString("dd MMM yyyy"),n.Amount=g.ToString("dd MMM yyyy")==this.dtpToDate.Date.ToString("dd MMM yyyy")?parseFloat(this.lTDSAmount)-c:h,this.dgv.addRow(n),c+=parseFloat(n.Amount),g=g.AddMonths(1);this.dgv.Columns[2].footer=c.ToString("0.00"),this.dgv.UpdateFooter()}Post_Click(){try{if(Logger.InfoLog("TDSPostingViewModel::Entering Post_Click()"),0==this.dgv.Table.length)return this.DisplayMessage="No Data to Post",void(this.MessageVisibility=!0);if(this.ValidatePosting()){let d,a="",l=0,s="0",i="0",n=r.d.common.GetScreenInfo(40068);d=n.Tables[0].filter(p=>"CreditAccount"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(s=d[0].UserDefaultValue.toString()),d=n.Tables[0].filter(p=>"DebitAccount"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(i=d[0].UserDefaultValue.toString()),d=n.Tables[0].filter(p=>"ProductID"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(l=parseInt(d[0].UserDefaultValue));let h=r.d.common.GetDataSet3("PAY123",this.Parent.Employee.SelectedValue,this.iComponentID.ToString(),this.iComponentID.ToString()),c="",g="",D=0;for(let p=0;p<this.dgv.Table.length;p++)if(c="",D=0,null!=this.dgv.Table[p].Amount&&null!=this.dgv.Table[p].Amount&&""!=this.dgv.Table[p].Amount.toString()&&null!=this.dgv.Table[p].Month&&null!=this.dgv.Table[p].Month&&""!=this.dgv.Table[p].Month.toString()){if(null!=h&&h.Tables.length>0){let t=h.Tables[0].filter(T=>new Date(T.dcAlpha2).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy")||new Date(T.dcAlpha4).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy"));null!=t&&t.length>0&&(g=t[0].InvDocDetailsID.toString(),D=parseInt(t[0].DocID))}c=g.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="Desktop" DetailIds="'+g+'"> </XML>':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="Desktop" > </XML>',a+="<ROWS>",a+="<DocumentXML>",a+=this.GetRecXML(new Date(this.dgv.Table[p].Month),new Date(this.dgv.Table[p].Month),parseFloat(this.dgv.Table[p].Amount),l,s,i,g),a+="</DocumentXML>",a+="<ActivityXML>",a+=c,a+="</ActivityXML>",a+="<DOCIDXML>",a+='<XML DOCID="'+D+'"></XML>',a+="</DOCIDXML>",a+="</ROWS>"}if(a.length>0&&a.length>0){a="<REC>"+a,a+="</REC>";let p=[];p.push(a.toString()),p.push(r.d.SessionManager.GetSysInfo()),p.push("Desktop"),p.push(r.d.SessionManager.UserID),p.push(r.d.SessionManager.LanguageID);let t=r.d.empService.ExecuteQuery_SP(p,"spPAY_PostTDSDoc");return null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Tables.length-1].Contains("ErrorMessage")?(this.DisplayMessage=t.Tables[t.Tables.length-1][0].ErrorMessage.toString(),void(this.MessageVisibility=!0)):(this.DisplayMessage="Problem in processing your request,Please contact administrator.",void(this.MessageVisibility=!0))}}Logger.InfoLog("TDSPostingViewModel::Exiting Post_Click()")}catch(a){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION btnPost_Click()\r\n"+a.stack)}}ValidatePosting(){try{return Logger.InfoLog("TDSPostingViewModel::Entering ValidatePosting()"),parseFloat(this.dgv.Columns[2].footer)!=parseFloat(this.lTDSAmount)?(this.DisplayMessage="TDS Amount not Equal",this.MessageVisibility=!0,!1):this.iComponentID<=0?(this.DisplayMessage="TDS Component Should be Monthly Type",this.MessageVisibility=!0,!1):(Logger.InfoLog("TDSPostingViewModel::Exiting ValidatePosting()"),!0)}catch(a){return Logger.ErrorLog("TDSPostingViewModel::EXCEPTION ValidatePosting()\r\n"+a.stack),!1}}dgv_EndEdit(a,l,s){try{Logger.InfoLog("TDSPostingViewModel::Entering dgv_EndEdit()");let i=0;if(this.dgv.Table.length>0){for(let n=0;n<this.dgv.Table.length;n++)null!=this.dgv.Table[n].Amount&&null!=this.dgv.Table[n].Amount&&""!=this.dgv.Table[n].Amount.toString()&&(i+=parseFloat(this.dgv.Table[n].Amount));this.dgv.Columns[2].footer=i.ToString("0.00"),this.dgv.UpdateFooter()}Logger.InfoLog("TDSPostingViewModel::Exiting dgv_EndEdit()")}catch(i){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION dgv_EndEdit()\r\n"+i.stack)}}GetRecXML(a,l,s,i,n,d,h){let c="",g="",D="",p="",t="",T="";return D+='<Alpha Query="',D+=" dcAlpha1=3,dcAlpha2='"+a.ToString("dd MMM yyyy")+"',dcAlpha3="+this.iComponentID+",dcAlpha4='"+l.ToString("dd MMM yyyy")+"', ",D+='" ></Alpha>',T="",t+='<CostCenters Query="',T+=" dcCCNID51="+this.Parent.Employee.SelectedValue+",",T.length>0&&(t+=T),t+='" ></CostCenters>',g+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',g+='" ProductID="'+i+'" Quantity="0',g+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',g+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',g+='" StockValue="0" StockValueFC="0" RefNO="',g+='" BillDate="'+(new Date).ToString("dd/MMM/yyyy"),g+='" CurrencyID="1" ExchangeRate="1',g+='" DebitAccount="'+n+'" CreditAccount="'+d,g+='" CommonNarration="'+C.J0.EncodeXML(""),p+='<Numeric Query="',p+="dcNum1="+s+", dcCalcNum1="+s,p+='" ></Numeric>',c+="<Row>",c+="<AccountsXML></AccountsXML>",c+='<Transactions DocSeqNo="1',c+='" LinkedInvDocDetailsID="0" LinkedFieldName="',c+='" LineNarration="'+C.J0.EncodeXML(""),c+=g.toString()+'" ></Transactions>',c+=D.toString(),c+=p.toString(),c+=t.toString(),c+="<EXTRAXML></EXTRAXML>",c+="</Row>",c.toString()}}let w=(()=>{class G{constructor(){this.form=new ye.gE({}),this.lblTotalTaxAmount="TOTAL INCOME TAX PAYABLE : ",this.lblTDSPaidAmount="TDS Paid : ",this.lblTDSAmount="Payable TDS Amount : "}ngOnInit(){}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-tds-posting"]],inputs:{obj:"obj"},decls:72,vars:21,consts:[[1,"master-screen",2,"padding-bottom","4px","width","700px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row"],["FieldDirective","",3,"obj","group"],[2,"margin-left","12px"],[1,"form-group",2,"margin-left","12px"],[1,"primary-btn-wicon",3,"click"],[2,"padding-top","5px"],[2,"font-weight","bold","margin-left","10px"],[2,"padding-top","5px","margin-left","25px"],[1,"documentgrid","row","form-row",2,"width","100%","margin-top","5px"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"secondary-btn-wicon",3,"click"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n    "),e.j41(2,"div",1),e.EFF(3,"\n        "),e.j41(4,"div",2),e.EFF(5,"\n            "),e.j41(6,"div"),e.EFF(7,"\n            "),e.eu8(8,3),e.EFF(9,"\n        "),e.k0s(),e.EFF(10,"\n        "),e.j41(11,"div",4),e.EFF(12,"\n            "),e.eu8(13,3),e.EFF(14,"\n        "),e.k0s(),e.EFF(15,"\n        "),e.j41(16,"div",5),e.EFF(17,"\n            "),e.j41(18,"button",6),e.bIt("click",function(){return i.obj.Button_Click("Generate")}),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.EFF(21,"\n          "),e.k0s(),e.EFF(22,"\n        "),e.k0s(),e.EFF(23,"\n        "),e.j41(24,"div",2),e.EFF(25,"\n            "),e.j41(26,"div",7),e.EFF(27,"\n                "),e.j41(28,"label"),e.EFF(29),e.k0s(),e.j41(30,"label",8),e.EFF(31),e.k0s(),e.EFF(32,"\n            "),e.k0s(),e.EFF(33,"\n            "),e.j41(34,"div",9),e.EFF(35,"\n                "),e.j41(36,"label"),e.EFF(37),e.k0s(),e.j41(38,"label",8),e.EFF(39),e.k0s(),e.EFF(40,"\n            "),e.k0s(),e.EFF(41,"\n            "),e.j41(42,"div",9),e.EFF(43,"\n                "),e.j41(44,"label"),e.EFF(45),e.k0s(),e.j41(46,"label",8),e.EFF(47),e.k0s(),e.EFF(48,"\n            "),e.k0s(),e.EFF(49,"\n        "),e.k0s(),e.EFF(50,"\n        "),e.j41(51,"div",10),e.EFF(52,"\n            "),e.nrm(53,"app-PactGridView",11),e.EFF(54,"\n        "),e.k0s(),e.EFF(55,"\n\n\n        "),e.j41(56,"div",12),e.EFF(57,"\n            "),e.j41(58,"div"),e.EFF(59,"\n                "),e.j41(60,"button",6),e.bIt("click",function(){return i.obj.Button_Click("Post")}),e.EFF(61),e.nI1(62,"translate"),e.k0s(),e.EFF(63,"\n                "),e.j41(64,"button",13),e.bIt("click",function(){return i.obj.Button_Click("Cancel")}),e.EFF(65),e.nI1(66,"translate"),e.k0s(),e.EFF(67,"\n            "),e.k0s(),e.EFF(68,"\n        "),e.k0s(),e.EFF(69,"\n    "),e.k0s(),e.EFF(70,"\n"),e.k0s(),e.EFF(71,"\n")),2&s&&(e.R7$(8),e.Y8G("obj",i.obj.dtpFromDate)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.dtpToDate)("group",i.form),e.R7$(6),e.JRh(e.bMT(20,15,"Generate")),e.R7$(10),e.JRh(i.lblTotalTaxAmount),e.R7$(2),e.JRh(i.obj.lTotalTaxAmount),e.R7$(6),e.JRh(i.lblTDSPaidAmount),e.R7$(2),e.JRh(i.obj.lTDSPaidAmount),e.R7$(6),e.JRh(i.lblTDSAmount),e.R7$(2),e.JRh(i.obj.lTDSAmount),e.R7$(6),e.Y8G("obj",i.obj.dgv)("group",i.form),e.R7$(8),e.JRh(e.bMT(62,17,"Post")),e.R7$(4),e.JRh(e.bMT(66,19,"Close")))},dependencies:[Ae._,Qe.X,Ue.D9]})}return G})();class k extends at.g{constructor(){super(...arguments),this.CostCenterID=0,this.MessageDisplay="",this.TypeID=0,this.Employee=new pt.G(0),this.TDSPostVisiblility=!1,this.PrintVisiblility=!1,this.ExportVisiblility=!1,this.WorksheetVisiblility=!1,this.txtDesignation="",this.dtPayrollTaxCmptsObj=new Ye.vv,this.Savereturnvalue=0,this.dsITComputation=null,this.sbComputationData="",this.sbValidation="",this.dPayableTDSAmount=0,this.dTotalTaxAmount=0,this.dTDSPaidAmount=0,this.iCompnentID=0,this.objTDSVM=null}get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}IncomeTaxComputationViewModel(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new Gt.h,this.ScreenObject=new kt.a(0,0),this.ScreenObject.Data=[],this.TDSPostVisiblility=r.d.SessionManager.IsActionAssigned(264,"TDS Posting"),this.PrintVisiblility=r.d.SessionManager.IsActionAssigned(264,"Print"),this.ExportVisiblility=r.d.SessionManager.IsActionAssigned(264,"Export"),this.WorksheetVisiblility=r.d.SessionManager.IsActionAssigned(264,"WorkSheet"),this.EmpYear=new ge.y$(0);for(let a=2e3;a<2100;a++){let l=ge._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=C.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("yyyy"),this.lFinancialDate=this.GetFinancialYear(),this.EmpRegime=new ge.y$(0),this.EmpRegime.Items.push(ge._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(ge._p.ComboBoxItems_2("New","New")),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth,1),s=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(s.getMonth(),!1)+" "+s.getFullYear(),a}Employee_SelectedValueChanged(a){this.dsITComputation=r.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,r.d.SessionManager.AccountingFromMonth),this.GetResPerson()}GetResPerson(){this.lstResponsiblePerson=new K,this.txtDesignation="";let s,i,a=" 1=1 ",l="";if(r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn")&&""!=r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn").toString()&&r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOnXML")&&""!=r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML&&r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML.length>0){s=new C.VB,s.ReadXml(r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML),i=s.Tables[0];let d=r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOn.split(",");if(null!=d&&d.length>0)for(let h=0;h<d.length;h++)if(null!=d[h]&&""!=d[h]&&(l="CCNID"+(parseInt(d[h])-5e4),null!=this.dsITComputation&&this.dsITComputation.Tables.length>27&&this.dsITComputation.Tables[27].length>0)){let c=this.dsITComputation.Tables[27].filter(g=>g.NodeID=this.Employee.SelectedValue);null!=c&&c.length>0&&(a+=" AND ( dc"+l+"="+c[0][l]+" )",i=i.filter(g=>g["dc"+l]==c[0][l]))}}let n="";if(" 1=1 "!=a&&(n=i),null!=n&&n.length>0){this.lstResponsiblePerson.SelectedValue=n[0].ResponsiblePerson.toString();let d=r.d.common.GetDataSet("PAY070",this.lstResponsiblePerson.SelectedValue.toString());null!=d&&d.Tables[0].length>0&&(this.lstResponsiblePerson.Text=d.Tables[0][0].Name.toString(),this.lstResponsiblePerson.Tag=d.Tables[0][0].FHName.toString(),this.txtDesignation=d.Tables[0][0].Designation.toString())}}OnYearSelected(a){this.FilterEmployees(),this.dsITComputation=r.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,r.d.SessionManager.AccountingFromMonth),this.GetResPerson()}OnSaveITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():r.d.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+l.stack)}}OnDeleteITComputation(a){try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():r.d.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+l.stack)}}OnSaveRegimeITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveRegimeITComputation()"),this.sbValidation?(this.DisplayMessage=this.sbValidation.toString(),this.MessageVisibility=!0):null!=this.EmpRegime.SelectedValue?(r.d.common.GetDataSet3("PAY121",this.EmpRegime.SelectedValue,this.Employee.SelectedValue.toString(),this.EmpYear.SelectedValue),this.DisplayMessage="Updated Succesfully",this.MessageVisibility=!0):(this.DisplayMessage="Please select RegimeType",this.MessageVisibility=!0)}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveRegimeITComputation()"+l.stack)}}OnTDSPostITComputation(a){try{if(Logger.InfoLog("ITComputationViewModel::Entering OnTDSPostITComputation()"),!this.DisplayMessage){let l=[];l.push(this),l.push(this.dTotalTaxAmount),l.push(this.dTDSPaidAmount),l.push(this.dPayableTDSAmount),l.push(this.iCompnentID),this.objTDSVM=new M(l),r.d.page.ShowDialog(this.objTDSVM,w,{ShowCenter:!0,Title:"TDS Posting"}).subscribe(()=>{})}Logger.InfoLog("ITComputationViewModel::Exiting OnTDSPostITComputation()")}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnTDSPostITComputation()"+l.stack)}}FilterEmployees(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");let l,s,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),s=new Date(r.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingToMonth-1,1),s=s.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+s.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),r.d.SessionManager.IsRptManagerUser&&r.d.SessionManager.IsActionAssigned(264,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+r.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+a.stack)}}}class K{}var R=W(71336),B=W(78324),O=W(9524),L=W(38859),$=W(35620);function z(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",27),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.PrintForm16_Click("PrintForm16"))}),e.nrm(1,"i",28),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Print")))}function oe(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",6),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.btnSave_Click("Export"))}),e.nrm(1,"i",29),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"Export")))}function Q(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",6),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.btnSave_Click("Worksheet"))}),e.nrm(1,"i",29),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"WorkSheet")))}function Le(G,a){if(1&G){const l=e.RV6();e.j41(0,"span",6),e.bIt("click",function(){e.eBV(l);const i=e.XpG();return e.Njj(i.btnSave_Click("TDSPost"))}),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&G&&(e.R7$(2),e.JRh(e.bMT(3,1,"TDSPost")))}let Me=(()=>{class G{constructor(){this.form=new ye.gE({}),this.prevSelectedEmp=0,this.iSelectedEmpSeqNo=0,this.prevSelectReperson=0,this.BasicIndex=-1,this.TotalSalaryIndex=0,this.Form12Section1Index=0,this.Form12Section2Index=0,this.Exemptionsunder10Index=0,this.HRA10BasicIndex=0,this.HRAAcutalIndex=0,this.HRAMetroNonMetroIndex=0,this.HRAExemptionIndex=0,this.TDSPaidIndex=0,this.NetTaxPayableIndex=0,this.InhandAmountIndex=0,this.MonthlyDeducIndex=0,this.intTotalIncometaxPayableindex=0,this.TotAmtOthExemptUs10Index=0,this.ConveyanceIndex=0,this.ChildrenEduIndex=0,this.StandardDedIndex=0,this.MedicalIndex=0,this.LTAIndex=0,this.LeaveEncashIndex=0,this.FoodIndex=0,this.GratuityIndex=0,this.BalanceSalInc12BAIndex=0,this.ProfessionalTaxIndex=0,this.NetTaxableSalIndex=0,this.GrossTotalIncomeIndex=0,this.IncomefromHousePropertyIndex=0,this.intDeducunder8oCto80CCCIndex=0,this.intTotalDeducunder8oCto80CCCIndex=0,this.intOtherDeducunder8oCto80CCCIndex=0,this.dblTotalIncomeIndex=0,this.dblTotalIncomeRoundoffIndex=0,this.intOtherDeducunder8oCto80CCCIndex1=0,this.dblTaxOnTotalIncomeIndex=0,this.dblRebateIndex=0,this.dblTaxPayableAfterRebateIndex=0,this.dblSurchargeIndex=0,this.dblTaxPayableIndex=0,this.dblEducationCessIndex=0,this.dblSecHighEduCessIndex=0,this.NewStandardDedIndex=0,this.NewRegimeStartIndex=0,this.intNewDeducunder8oCto80CCCIndex=0,this.intNewTotalDeducunder8oCto80CCCIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex1=0,this.dblNewTotalIncomeIndex=0,this.dblNewTotalIncomeRoundoffIndex=0,this.dblNewTaxOnTotalIncomeIndex=0,this.dblNewRebateIndex=0,this.dblNewTaxPayableAfterRebateIndex=0,this.dblNewSurchargeIndex=0,this.dblNewTaxPayableIndex=0,this.dblNewEducationCessIndex=0,this.dblNewSecHighEduCessIndex=0,this.intNewTotalIncometaxPayableindex=0,this.NewTDSPaidIndex=0,this.NewNetTaxPayableIndex=0,this.NewNetTaxableSalIndex=0,this.NewGrossTotalIncomeIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex=0,this.dblbalanceSalaryInc12BA=0,this.dblTotalCellSalary=0,this.dPerq1=0,this.dPerq2=0,this.HraMinValue=0,this.dblMedicalAmount=0,this.dblLTAAmount=0,this.dblLeaveEncashAmount=0,this.dblFoodAmount=0,this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=0,this.dblNetTaxableSal=0,this.dblGrossTotalIncome=0,this.dblTDS=0,this.dblNetTaxPayable=0,this.dblInhandAmount=0,this.dblSelfletoutamount=0,this.dblTotalIncome=0,this.dblTotalIncomeRoundoff=0,this.dblServiceDays=0,this.dblStandardDeduction=0,this.dblNewStandardDeduction=0,this.dblNewTotaldeduction80ccc80c=0,this.dblNewTotalIncome=0,this.dblNewTotalIncomeRoundoff=0,this.dblNewSelfletoutamount=0,this.dblNewGrossTotalIncome=0,this.dblNewNetTaxableSal=0,this.lstTaxSalbs=new Array,this.lstNewTaxSalbs=new Array,this.bIsNewRegime=!1,this.txtPlace=new Se.Dw,this.dvTaxSlabsData=[],this.dvLimitData=[],this.dtpDate=new u.Lc}ngOnInit(){this.obj=this.params.obj,this.grdIncomeTax=new B.j,this.grdIncomeTax.ItComput=!0,this.ITComputationViewModel=this.obj,this.BindGridColumns(),this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.EmpYear.SelectionChangedCommand.Subscribe(this,"cmbYear_SelectionChanged"),this.lstEmployee.SelectionChangedCommand.Subscribe(this,"lstEmployee_SelectionChanged"),this.dtpDate=new u.Lc,r.d.page.MaximizeTab(this.obj),this.MessageDisplay=""}set MessageDisplay(l){this.ITComputationViewModel.DisplayMessage=l}BindGridColumns(){try{let l=new L.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,s=new L.bA;s.Alignment="Left",s.FontFamilyName="Arial",s.FontSize=11,s.IsBold=!1,s.BackColor="White",s.ForeColor="#FF333333",i=new O.D_,i.HeaderText="SNo",i.width=10,i.HeaderAppearance=new L.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),i=new O.D_,i.HeaderText="Header",i.width=20,i.HeaderAppearance=new L.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),i=new O.D_,i.HeaderText="ComponentID",i.width=25,i.HeaderAppearance=new L.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),i=new O.D_,i.HeaderText="Salary Breakup",i.width=220,i.HeaderAppearance=l,i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),i=new O.D_,i.HeaderText="Investment & Bill Details",i.width=100,i.HeaderAppearance=l,i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i);let t,n=0,d=0,h=0,c=0,g=0,D=0,p=0;g=r.d.SessionManager.FinancialYearStartDate.getFullYear(),t=g.toString(),g=parseInt(t.substr(2,2)),D=g+1,n=r.d.SessionManager.AccountingFromMonth,c=n,p=1==c?12:15;for(let T=c;T<=p;T++)if(12==d){h=d-T;for(let P=1;P<=h;P++)i=new O.D_,i.HeaderText=this.GetMonthName(P,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),T+=1}else i=new O.D_,d=n,i.HeaderText=this.GetMonthName(T,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i);i=new O.D_,i.HeaderText="RegimeType",i.width=25,i.HeaderAppearance=new L.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),i=new O.D_,i.HeaderText="Amount",i.width=100,i.HeaderAppearance=l,i.DataAppearance=s,this.grdIncomeTax.ReportColumns.push(i),this.grdIncomeTax.ReportColumns.forEach(T=>T.ID=C.J0.NewGuid())}catch(l){Logger.ErrorLog("Error : "+l),this.MessageDisplay=l.message}}get lstEmployee(){return this.ITComputationViewModel.Employee.Code}get lstEmployeeName(){return this.ITComputationViewModel.Employee.Name}get cmbYear(){return this.ITComputationViewModel.EmpYear}get cmbRegime(){return this.ITComputationViewModel.EmpRegime}clear(l){this.MessageDisplay="",this.prevSelectedEmp=0,this.prevSelectReperson=0,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary=this.dPerq1=this.dPerq2=this.HraMinValue=this.dblMedicalAmount=this.dblLTAAmount=this.dblLeaveEncashAmount=this.dblFoodAmount=this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=this.dblNetTaxableSal=this.dblGrossTotalIncome=this.dblTotalIncome=this.dblTotalIncomeRoundoff=this.dblServiceDays=this.dblTDS=this.dblNetTaxPayable=this.dblInhandAmount=0,this.dblStandardDeduction=0,this.cmbRegime.SelectedValue="",this.grdIncomeTax.Clear(),this.ITComputationViewModel.txtDesignation="",1==l&&(this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null,this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null)}btnSave_Click(l){if(null!=l)try{if("Clear"==l)this.clear(1);else if("Save"==l)try{let s=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i=0,n=0,d=0,h="";if(0==s.length){h+="<Rows>";for(let c=0;c<this.grdIncomeTax.Data.length;c++)null!=this.grdIncomeTax.Data[c].Cells[1].Value&&(h+='<row HeaderID="'+this.grdIncomeTax.Data[c].Cells[1].Value,parseFloat(this.grdIncomeTax.Data[c].Cells[2].Value)<0?h+='" HeaderName="'+this.grdIncomeTax.Data[c].Cells[3].Value:h+='" HeaderName="',h+='" ComponentID="'+this.grdIncomeTax.Data[c].Cells[2].Value,i=C.J0.Double(this.grdIncomeTax.Data[c].Cells[4].Value),h+=i>=0?'" ComponentAmount="'+i:'" ComponentAmount="-1',null!=this.grdIncomeTax.Data[c].Cells[17].Value?(d=C.J0.Int(this.grdIncomeTax.Data[c].Cells[17].Value),h+=d>=0?'" RegimeType="'+d:'" RegimeType="0'):h+='" RegimeType="0',n=C.J0.Double(this.grdIncomeTax.Data[c].Cells[17].Value),h+='" TotalAmount="'+n,h+='"/>');h+="</Rows>",this.ITComputationViewModel.sbComputationData=h,this.clear(1)}else h+=s,this.ITComputationViewModel.sbValidation=h;this.ITComputationViewModel.OnSaveITComputation(l)}catch(s){Logger.ErrorLog("Error : "+s)}else if("Delete"==l)try{let s=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==s.length?(this.ITComputationViewModel.sbComputationData=i,this.clear(1)):(i+=s,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnDeleteITComputation(l)}catch(s){Logger.ErrorLog("Error : "+s)}else if("Export"==l){let s=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==s.length?(this.ITComputationViewModel.sbComputationData=i,this.ExportToExcel()):(i+=s,this.ITComputationViewModel.sbValidation=i)}else if("Worksheet"==l){if(null==this.dtpDate.Date&&(this.dtpDate.Date=new Date),!(this.lstEmployee.SelectedValue>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);this.txtPlace.Text.Trim(),this.dtpDate.Date.ToString("dd/MMM/yyyy"),this.WorkSheetPrintGrid(),this.Form16export()}else if("SaveRegime"==l)try{let s=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==s.length?this.ITComputationViewModel.sbComputationData=i:(i+=s,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnSaveRegimeITComputation(l)}catch(s){Logger.ErrorLog("Error : "+s)}else if("TDSPost"==l)try{if(!(this.iSelectedEmpSeqNo>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation=this.dsTaxData.Tables[21],!(null!=this.dvEmpTaxComputation&&this.dvEmpTaxComputation.length>0))return this.ITComputationViewModel.DisplayMessage="Please Save Income Tax Computation",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation.RowFilter="",null==this.cmbRegime.SelectedValue)return this.ITComputationViewModel.DisplayMessage="Please Save Regime Opted For",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(s=>-122==s.ComponentID&&1==s.RegimeType):this.dsTaxData.Tables[21].filter(s=>-122==s.ComponentID&&0==s.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTotalTaxAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(s=>-123==s.ComponentID&&1==s.RegimeType):this.dsTaxData.Tables[21].filter(s=>-123==s.ComponentID&&0==s.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTDSPaidAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(s=>-124==s.ComponentID&&1==s.RegimeType):this.dsTaxData.Tables[21].filter(s=>-124==s.ComponentID&&0==s.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dPayableTDSAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),null!=this.dsTaxData&&this.dsTaxData.Tables.length>19&&this.dsTaxData.Tables[19].length>0){let s=this.dsTaxData.Tables[19].filter(i=>"TDS"==i.TaxmapName&&"Monthly"==i.FieldType);null!=s&&s.length>0&&(this.ITComputationViewModel.iCompnentID=parseInt(s[0].componentID))}this.ITComputationViewModel.OnTDSPostITComputation(l)}catch{}}catch(s){Logger.ErrorLog("Error : "+s),this.MessageDisplay=s.message}}WorkSheetPrintGrid(){this.grdPrint=new B.j,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let l=new L.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,s=new L.bA;s.Alignment="Left",s.FontFamilyName="Arial",s.FontSize=12,s.IsBold=!0,s.BackColor="White",s.ForeColor="#FF333333";for(let d=1;d<=10;d++)i=new O.D_,i.FieldName="Col"+d.toString(),i.width=70,i.HeaderText="Col"+d.toString(),i.HeaderAppearance=l,i.DataAppearance=s,this.grdPrint.ReportColumns.push(i);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=90,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=90,this.grdPrint.ReportColumns[6].width=80,this.grdPrint.ReportColumns[7].width=80,this.grdPrint.ReportColumns[8].width=80,this.grdPrint.ReportColumns[9].width=80;let n=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[n].Cells[0].Value="WorkSheet\nEmployee Code : "+this.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+this.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+this.dtFromMonth.getFullYear()+" - "+this.dtToMonth.getFullYear()+", Assessment Year : "+this.dtFromMonth.AddYears(1).getFullYear()+" - "+this.dtToMonth.AddYears(1).getFullYear(),this.grdPrint.Data[n].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[0].ColSpan=10,n++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[n].Cells[0].Value="Salary Breakup",this.grdPrint.Data[n].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[0].ColSpan=5,this.grdPrint.Data[n].Cells[5].Value="Investment & Bill Details",this.grdPrint.Data[n].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[5].ColSpan=1,this.grdPrint.Data[n].Cells[6].Value="Post Past",this.grdPrint.Data[n].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[6].ColSpan=1,this.grdPrint.Data[n].Cells[7].Value="Actual",this.grdPrint.Data[n].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[7].ColSpan=1,this.grdPrint.Data[n].Cells[8].Value="Projection",this.grdPrint.Data[n].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[8].ColSpan=1,this.grdPrint.Data[n].Cells[9].Value="Amount",this.grdPrint.Data[n].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[n].Cells[9].ColSpan=1;for(let d=0;d<this.grdIncomeTax.Data.length;d++){let h;n++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[n].Cells[0].Value=null!=this.grdIncomeTax.Data[d].Cells[3].Value&&""!=this.grdIncomeTax.Data[d].Cells[3].Value.toString()?this.grdIncomeTax.Data[d].Cells[3].Value:"",this.grdPrint.Data[n].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[n].Cells[0].ColSpan=5,this.grdPrint.Data[n].Cells[5].Value=null!=this.grdIncomeTax.Data[d].Cells[4].Value&&""!=this.grdIncomeTax.Data[d].Cells[4].Value.toString()&&C.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[4].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[4].Value).toString():"",this.grdPrint.Data[n].Cells[5].CellAppearance.Alignment="Right",this.grdPrint.Data[n].Cells[5].ColSpan=1;let c=0,g=0,D=0;for(let p=5;p<this.grdIncomeTax.ReportColumns.length;p++)null!=this.grdIncomeTax.ReportColumns[p].Tag&&null!=this.grdIncomeTax.ReportColumns[p].Tag&&""!=this.grdIncomeTax.ReportColumns[p].Tag.toString()&&("Past"==this.grdIncomeTax.ReportColumns[p].Tag?(h=C.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString()),c+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&C.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0):"Processed"==this.grdIncomeTax.ReportColumns[p].Tag?g+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&C.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0:"Future"==this.grdIncomeTax.ReportColumns[p].Tag&&(D+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&C.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0));this.grdPrint.Data[n].Cells[6].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?c.toString():"",this.grdPrint.Data[n].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[n].Cells[6].ColSpan=1,this.grdPrint.Data[n].Cells[7].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?g.toString():"",this.grdPrint.Data[n].Cells[7].CellAppearance.Alignment="Right",this.grdPrint.Data[n].Cells[7].ColSpan=1,this.grdPrint.Data[n].Cells[8].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?D.toString():"",this.grdPrint.Data[n].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[n].Cells[8].ColSpan=1,15!=d&&41!=d&&(this.grdPrint.Data[n].Cells[9].Value=null!=this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00"),this.grdPrint.Data[n].Cells[9].CellAppearance.Alignment="Right",this.grdPrint.Data[n].Cells[9].ColSpan=1}}ExportToExcel(){this.export()}export(){var l=this;return(0,le.A)(function*(){let s="Income Tax Computation\nEmployee Code : "+l.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+l.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+l.dtFromMonth.getFullYear()+" - "+l.dtToMonth.getFullYear()+", Assessment Year : "+(l.dtFromMonth.getFullYear()+1)+" - "+(l.dtToMonth.getFullYear()+1),i=l.generatePrintContent(l.grdIncomeTax,s,!0);const n=new Blob([i],{type:"text/plain;charser=utf-8"});(0,yt.saveAs)(n,"ITFile.xls")})()}Form16export(){var l=this;return(0,le.A)(function*(){let s=l.generatePrintContent(l.grdPrint,"",!1,!0);const i=new Blob([s],{type:"text/plain;charser=utf-8"});(0,yt.saveAs)(i,"TAX_PLACE_DATE_Form.xls")})()}getExcelColumnName(l){let n,s=l+1,i="";for(;s>0;)n=(s-1)%26,i=String.fromCharCode(65+n)+i,s=Math.floor((s-n)/26);return i}GetExportHTML(l){Logger.InfoLog("PostedDocumentViewModel:: inside GetExportHTML ");let s="",i="";s+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",i+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",i+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",i+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",i+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",s+="<style>"+i.toString()+"</style>";let h,d=0;for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)d+=this.grdIncomeTax.ReportColumns[c].width;s+="<table>",s+="\r\n<tr><td align='center'><h2>",s+=r.d.SessionManager.CompanyName,s+="</h2></td></tr>",s+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",s+=l,s+="</h3></td></tr>",s+="\r\n<tr><td align='center'>",s+=" From :  "+this.dtFromMonth.ToString(r.d.SessionManager.Preferences["Date Format"]),s+=" &nbs;&nbsp;&nbsp;To :  "+this.dtToMonth.ToString(r.d.SessionManager.Preferences["Date Format"]),s+="</td></tr>",s+="<tr><td style='padding-top:10p;'><table border=1 width='"+d+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",s+="<COLGROUP>";for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)C.J0.IsEmpty(this.grdIncomeTax.ReportColumns[c].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[c].ColumnType?s+="<COL style=''>":s+="<COL style='text-align:righ;'>";s+="</COLGROUP>",s+="<tr style=''>";for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)s+="<th class='hdr' width='"+this.grdIncomeTax.ReportColumns[c].width,s+="' >",s+=this.grdIncomeTax.ReportColumns[c].HeaderText,s+="</th>";s+="</tr>";for(let c=0;c<this.grdIncomeTax.Data.length;c++){s+="<tr",c%2==1&&(s+=" class=alt"),s+=">";for(let g=0;g<this.grdIncomeTax.ReportColumns.length;g++)s+="<td",C.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[g].ColumnType?s+=" align='left'":s+=" align='right'",s+=">",C.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType),h=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[g]),this.grdIncomeTax.ReportColumns.Contains(h)&&(s+=C.J0.String(this.grdIncomeTax.Data[c].Cells[h].Text)),s+="</td>";s+="</tr>"}return s+="</table>",s+="</td></tr></table>",s+="</body><html>",Logger.InfoLog("PostedDocumentViewModel:: exiting GetExportHTML "),s}ValidateData(){let l="";return null==this.lstEmployee.SelectedValue&&(l="Please select the Employee."),l}GetMonthName(l,s){l>12&&(l-=12);let i="";switch(l){case 1:i=s?"January":"Jan";break;case 2:i=s?"February":"Feb";break;case 3:i=s?"March":"Mar";break;case 4:i=s?"April":"Apr";break;case 5:i="May";break;case 6:i=s?"June":"Jun";break;case 7:i=s?"July":"Jul";break;case 8:i=s?"August":"Aug";break;case 9:i=s?"September":"Sep";break;case 10:i=s?"October":"Oct";break;case 11:i=s?"November":"Nov";break;case 12:i=s?"December":"Dec"}return i}lstEmployee_SelectionChanged(l){this.lstEmployee.SelectedValue!=this.prevSelectedEmp&&(this.lstEmployeeName.SelectedValue=this.lstEmployee.SelectedValue,this.clear(0),this.prevSelectedEmp=this.lstEmployee.SelectedValue,this.iSelectedEmpSeqNo=this.lstEmployee.SelectedValue,this.ITComputationViewModel.Employee_SelectedValueChanged(l),this.FillDetails())}grdIncomeTax_CellEndEdit(l){if(4==l.ColumnIndex){let s=0;try{s=parseFloat(this.grdIncomeTax.Data[l.RowIndex][l.ColumnIndex]),s<0&&(s=0)}catch{}if(l.RowIndex==this.IncomefromHousePropertyIndex||l.RowIndex==this.IncomefromHousePropertyIndex+1||l.RowIndex==this.IncomefromHousePropertyIndex+2||l.RowIndex==this.IncomefromHousePropertyIndex+3||l.RowIndex==this.IncomefromHousePropertyIndex+4)return;l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<this.intTotalDeducunder8oCto80CCCIndex||(this.grdIncomeTax.Data[l.RowIndex][this.grdIncomeTax.ReportColumns.length-1]=C.J0.GetAmount(s)),this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+parseFloat(this.grdIncomeTax.Data[this.ConveyanceIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.ChildrenEduIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.MedicalIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LTAIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LeaveEncashIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.FoodIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.GratuityIndex][4].Value)+this.dblStandardDeduction),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblbalanceSalaryInc12BA),s=parseFloat(this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.NetTaxableSalIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(s),this.dblGrossTotalIncome=0,this.dblGrossTotalIncome=s+this.dblSelfletoutamount-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblGrossTotalIncome);let i=0,n=0;if(this.dvLimit=this.dvLimitData.filter(c=>995==c.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(n=parseFloat(this.dvLimit[0].AmountLimit)),l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<=this.intTotalDeducunder8oCto80CCCIndex){let c=0;for(let g=this.intDeducunder8oCto80CCCIndex+1;g<this.intTotalDeducunder8oCto80CCCIndex;g++)this.dvLimit=this.dvLimitData.filter(D=>D.ComponentID==parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)),this.dvLimit.length>0&&(i=C.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value=C.J0.GetAmount(i),this.grdIncomeTax.Data[g].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(i))),c+=parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][4].Value=C.J0.GetAmount(c),c>n&&(c=n),this.dblTotaldeduction80ccc80c=c,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTotaldeduction80ccc80c)}let h=0;for(let c=this.intOtherDeducunder8oCto80CCCIndex;c<=this.intOtherDeducunder8oCto80CCCIndex1;c++)this.dvLimit=this.dvLimitData.filter(g=>g.ComponentID==parseInt(this.grdIncomeTax.Data[c].Cells[2].Value)),this.dvLimit.length>0&&(i=C.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[c].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value=C.J0.GetAmount(i),this.grdIncomeTax.Data[c].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(i))),h+=parseFloat(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.dblTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Math.round(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h)),this.UpdateTotals(parseFloat(this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value))}}UpdateTotals(l){let s=0;for(let p=0;p<this.lstTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstTaxSalbs[p].ToSlab){s+=l*this.lstTaxSalbs[p].Percentage;break}s+=this.lstTaxSalbs[p].ToSlab*this.lstTaxSalbs[p].Percentage}else{if(l<this.lstTaxSalbs[p].ToSlab){s+=(l-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage;break}s+=(this.lstTaxSalbs[p].ToSlab-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Math.round(s));let i=0,n=0;n=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),n>0&&(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?l<=5e5&&(i=2e3):2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=5e5&&(i=5e3):2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=35e4&&(i=2500):parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&l<=5e5&&(i=12500)),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(n<i?Math.round(n):Math.round(i)),n-i<0?(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,s=0):(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(n-i),s=n-i);let c,d=0,h=null,g=new ve.bT;if(this.dsTaxData.Tables[7].length>0){let p;c=new R.Nl("Basic",""),g.push("Basic",c),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),c=new R.Nl("TotalIncome",""),g.push("TotalIncome",c),g.TotalIncome.setFieldValue(this.dblTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let T=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(P=>1==P.Type&&"OverTime"!=P.FieldType),h.length>0)for(let P=0;P<h.length;P++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[P].ComponentID),null!=p&&p.length>0&&(c=new R.Nl(h[P].ComponentName.toString(),""),g.push(h[P].ComponentName.toString(),c),g[h[P].ComponentName.toString()].setFieldValue(T[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(P=>2==P.Type&&"OverTime"!=P.FieldType),h.length>0)for(let P=0;P<h.length;P++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[P].ComponentID),null!=p&&p.length>0&&(c=new R.Nl(h[P].ComponentName.toString(),""),g.push(h[P].ComponentName.toString(),c),g[h[P].ComponentName.toString()].setFieldValue(T[0]["Deduction"+p[0].SNo.toString()].toString()))}let D=g;this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvTaxSlabs[0].Surcharge.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].Surcharge.toString(),D))),this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].Value="Surcharge @ "+d+"%",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=s*d/100)>0?C.J0.GetAmount(Math.round(l)):0,s+=Math.round(l),this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=s>0?C.J0.GetAmount(s):0,d=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].EducationCess&&null!=this.dvTaxSlabs[0].EducationCess&&""!=this.dvTaxSlabs[0].EducationCess.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].EducationCess.toString(),D))),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].Value="Education Cess @ "+d+"%",l=s*d/100,s+=Math.round(l),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?C.J0.GetAmount(Math.round(l)):0,d=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].SecondaryandHighEduc.toString(),D))),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+d+"%",l=s*d/100,s+=Math.round(l),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?C.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=s>0?C.J0.GetAmount(Math.round(s)):0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}UpdateTotalsNewRegime(l){let s=0;for(let p=0;p<this.lstNewTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstNewTaxSalbs[p].ToSlab){s+=l*this.lstNewTaxSalbs[p].Percentage;break}s+=this.lstNewTaxSalbs[p].ToSlab*this.lstNewTaxSalbs[p].Percentage}else{if(l<this.lstNewTaxSalbs[p].ToSlab){s+=(l-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage;break}s+=(this.lstNewTaxSalbs[p].ToSlab-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Math.round(s));let i=0,n=0;n=parseFloat(this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),n>0&&parseInt(this.cmbYear.SelectedValue)>=2023&&l<=7e5&&(i=25e3),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(n<i?Math.round(n):Math.round(i)),n-i<0?(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,s=0):(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(n-i),s=n-i);let c,d=0,h=null,g=new ve.bT;if(this.dsTaxData.Tables[7].length>0){let p;c=new R.Nl("Basic",""),g.push("Basic",c),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),c=new R.Nl("TotalIncome",""),g.push("TotalIncome",c),g.TotalIncome.setFieldValue(this.dblNewTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let t=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(T=>1==T.Type&&"OverTime"!=T.FieldType),h.length>0)for(let T=0;T<h.length;T++)p=this.dsTaxData.Tables[8].filter(P=>P.ComponentID==h[T].ComponentID),null!=p&&p.length>0&&(c=new R.Nl(h[T].ComponentName.toString(),""),g.push(h[T].ComponentName.toString(),c),g[h[T].ComponentName.toString()].setFieldValue(t[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(T=>2==T.Type&&"OverTime"!=T.FieldType),h.length>0)for(let T=0;T<h.length;T++)p=this.dsTaxData.Tables[8].filter(P=>P.ComponentID==h[T].ComponentID),null!=p&&p.length>0&&(c=new R.Nl(h[T].ComponentName.toString(),""),g.push(h[T].ComponentName.toString(),c),g[h[T].ComponentName.toString()].setFieldValue(t[0]["Deduction"+p[0].SNo.toString()].toString()))}let D=g;this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].Surcharge&&""!=this.dvNewTaxSlabs[0].Surcharge.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].Surcharge.toString(),D))),this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].Value="Surcharge @ "+d+"%",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=s*d/100)>0?C.J0.GetAmount(Math.round(l)):0,s+=Math.round(l),this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=s>0?C.J0.GetAmount(s):0,d=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].EducationCess&&""!=this.dvNewTaxSlabs[0].EducationCess.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].EducationCess.toString(),D))),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].Value="Education Cess @ "+d+"%",l=s*d/100,s+=Math.round(l),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?C.J0.GetAmount(Math.round(l)):0,d=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString(),D))),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+d+"%",l=s*d/100,s+=Math.round(l),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?C.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=s>0?C.J0.GetAmount(Math.round(s)):0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}FillDetails(){try{let l=0,s=0,i=0,n=(new Date).OnlyDate(),d="";this.dsTaxData=this.ITComputationViewModel.dsITComputation;let h=this.dsTaxData.Tables[0],c=this.dsTaxData.Tables[22],g=this.dsTaxData.Tables[1],D=this.dsTaxData.Tables[2],p=this.dsTaxData.Tables[2];p=this.dsTaxData.Tables[2].filter(S=>"1"==S.ComponentType);let t=this.dsTaxData.Tables[3],T=this.dsTaxData.Tables[18];this.dvTaxSlabsData=this.dsTaxData.Tables[7],this.dvTaxSlabs=this.dsTaxData.Tables[7];let P=this.dsTaxData.Tables[15].filter(S=>"Old"==S.Regime);null!=P&&P.length>0&&(this.dvLimit=P,this.dvLimitData=this.dvLimit);let A=this.dsTaxData.Tables[15].filter(S=>"New"==S.Regime);null!=A&&A.length>0&&(this.dvNewLimit=A);let _=this.dsTaxData.Tables[7].filter(S=>"New"==S.RegimeType);if(null!=_&&_.length>0&&parseInt(this.cmbYear.SelectedValue)>=2020&&(!C.J0.IsEmpty(this.dvNewLimit)&&this.dvNewLimit.length>0?this.bIsNewRegime=!0:d+="Income tax amount limit data not avalilable for the selected year in New Regime"),this.dvEmpTaxComputation=this.dsTaxData.Tables[21],h.length>0&&(h=this.dsTaxData.Tables[0].filter(S=>"IT_BASIC"==S.MapFieldName),0==h.length&&(d+="Basic component is not available,Please map component in the payroll strucuture\r\n")),0==t.length&&(d+="Employee Payroll information not available\r\n"),!C.J0.IsEmpty(this.dvLimit)&&0==this.dvLimit.length&&(d+="Income tax amount limit data not avalilable for the selected year"),""!=d.toString())return this.MessageDisplay=d,this.ITComputationViewModel.MessageDisplay=d,void(this.ITComputationViewModel.MessageVisibility=!0);this.dsTaxData.Tables.length>26&&this.dsTaxData.Tables[26].length>0&&this.dsTaxData.Columns[26].Contains("RegimeType")&&null!=this.dsTaxData.Tables[26][0].RegimeType&&null!=this.dsTaxData.Tables[26][0].RegimeType&&""!=this.dsTaxData.Tables[26][0].RegimeType.toString()&&(this.cmbRegime.SelectedValue=this.dsTaxData.Tables[26][0].RegimeType.toString()),this.dblServiceDays=0,this.dtDateofJoining=C.J0.ParseDate(T[0].CDOJ),this.dtFromMonth=new Date(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),this.dtToMonth=this.dtFromMonth.AddYears(1).AddDays(-1),this.dblServiceDays=n.Subtract(this.dtDateofJoining).Days+1;let x=0,F=0,j=0,f={iY:x,iM:F,iD:j};C.J0.GetYearsMonthsDays(C.J0.ParseDate(T[0].CDOB),this.dtToMonth.OnlyDate(),f),x=f.iY,F=f.iM,j=f.iD,this.dvTaxSlabs=this.dvTaxSlabsData.filter(x>=80?S=>"SuperSeniorCitizen"==S.Gender&&"Old"==S.RegimeType:x>=60?S=>"SeniorCitizen"==S.Gender&&"Old"==S.RegimeType:S=>S.Gender==C.J0.String(T[0].GenderName)&&"Old"==S.RegimeType),this.lstTaxSalbs.Clear();for(let S=0;S<this.dvTaxSlabs.length;S++)this.lstTaxSalbs.push(new Oe),this.lstTaxSalbs[S].FromSlab=parseFloat(this.dvTaxSlabs[S].Fromslab),this.lstTaxSalbs[S].ToSlab=parseFloat(this.dvTaxSlabs[S].Toslab),this.lstTaxSalbs[S].Percentage=parseFloat(this.dvTaxSlabs[S].Percentage)/100;i=17,s=5;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==C.J0.StringValue(c[0].Month)&&(s=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S])),!C.J0.IsEmpty(c[0].RelieveMonth)&&this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==C.J0.StringValue(c[0].RelieveMonth)&&(i=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S]));let E=0,N=0;this.dsTaxData.Tables[0].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[0].length);let H,ee=0,q=0;for(let S=0;S<this.dsTaxData.Tables[0].length;S++){if(H=new Array,E=5,ee=0,q=0,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=this.dsTaxData.Tables[0][S].SNo,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[0][S].componentID,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[0][S].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance=new L.bA,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=2,null!=this.dsTaxData.Tables[0][S].MapFieldName&&null!=this.dsTaxData.Tables[0][S].MapFieldName&&"IT_BASIC"==this.dsTaxData.Tables[0][S].MapFieldName.toString().Trim()&&(this.BasicIndex=S),parseInt(this.dsTaxData.Tables[0][S].SNo)>0){for(let Y=0;Y<g.length;Y++)for(let J=5;J<this.grdIncomeTax.ReportColumns.length;J++)if(!H.Contains(this.grdIncomeTax.ReportColumns[J].HeaderText)&&g[Y].month.toString()==this.grdIncomeTax.ReportColumns[J].HeaderText.toString()){this.grdIncomeTax.ReportColumns[J].Tag="Processed",H.push(this.grdIncomeTax.ReportColumns[J].HeaderText),l=0,C.J0.IsEmpty(g[Y]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])||(l=parseFloat(g[Y]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])),this.grdIncomeTax.Data[S].Cells[J].Value=l>0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[J].IsNormal=!1,q=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].Value=C.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.IsBold=!0,ee+=l;break}for(let Y=0;Y<p.length;Y++)for(let J=5;J<this.grdIncomeTax.ReportColumns.length;J++)if(parseInt(this.dsTaxData.Tables[0][S].componentID)==parseInt(p[Y].componentid)&&p[Y].FieldName.toString()==this.grdIncomeTax.ReportColumns[J].HeaderText.toString()&&!C.J0.IsEmpty(p[Y].Amount)&&parseFloat(p[Y].Amount)>0&&!H.Contains(this.grdIncomeTax.ReportColumns[J].HeaderText)){H.push(this.grdIncomeTax.ReportColumns[J].HeaderText),l=0,C.J0.IsEmpty(p[Y].Amount)||(l=parseFloat(p[Y].Amount)),this.grdIncomeTax.Data[S].Cells[J].Value=l>0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[J].IsNormal=!1,q=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].Value=C.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[J].CellAppearance.IsBold=!0,ee+=l;break}if(0==t.length)return;for(let Y=0;Y<t.length;Y++)for(E=s;E<i;E++)!H.Contains(this.grdIncomeTax.ReportColumns[E].HeaderText)&&C.J0.IntegerValue(this.grdIncomeTax.Data[S].Cells[E].Value)<=0&&(this.grdIncomeTax.ReportColumns[E].Tag="Future",H.push(this.grdIncomeTax.ReportColumns[E].HeaderText),l=parseFloat(t[Y]["Earning"+this.dsTaxData.Tables[0][S].SNo.toString()]),this.grdIncomeTax.Data[S].Cells[E].Value=l>0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[E].IsNormal=!1,q=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].Value=C.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.IsBold=!0,ee+=l)}E=this.grdIncomeTax.ReportColumns.length-1,this.dblTotalCellSalary=this.dblTotalCellSalary+ee,parseInt(this.dsTaxData.Tables[0][S].SNo)>0?(this.grdIncomeTax.Data[S].Cells[E].Value=C.J0.GetAmount(ee),this.grdIncomeTax.Data[S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[E].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[E].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.ForeColor="#0bd10b"):(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTotalCellSalary),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].IsNormal=!1,this.TotalSalaryIndex=this.dsTaxData.Tables[0].length-1,this.grdIncomeTax.Data[S].Cells[1].Value=this.TotalSalaryIndex,N=this.TotalSalaryIndex)}if(N++,this.Form12Section1Index=this.TotalSalaryIndex+1,this.Form12Section2Index=this.TotalSalaryIndex+2,this.grdIncomeTax.addEmptyRowsWithCellApperance(2),this.dsTaxData.Tables[4].length>0){let S=0;for(let Y=0;Y<this.dsTaxData.Tables[4].length;Y++)S=N+Y,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=0,this.grdIncomeTax.Data[S].Cells[1].Value=S+1,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[4][Y].componentid,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[4][Y].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=14,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.IsBold=!0,-1==parseInt(this.dsTaxData.Tables[4][Y].FieldType)&&(this.dPerq1=parseFloat(this.dsTaxData.Tables[4][Y].Amount)),-2==parseInt(this.dsTaxData.Tables[4][Y].FieldType)&&(this.dPerq2=parseFloat(this.dsTaxData.Tables[4][Y].Amount)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(parseFloat(this.dsTaxData.Tables[4][Y].AMOUNT)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b"}let V=0,ie=0,me=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.Exemptionsunder10Index=this.Form12Section2Index+1,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[1].Value=this.Exemptionsunder10Index,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[2].Value=-101,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].Value="Less : Exemptions Under 10 ",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].ColSpan=15,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.IsBold=!0,this.dsTaxData.Tables[5].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(1),N=this.HRA10BasicIndex=this.Exemptionsunder10Index+1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[1].Value=this.HRA10BasicIndex,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].Value="Actual Rent Paid - 10% of Basic ",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].ColSpan=2;let ce=0,Ne=0,v=this.dsTaxData.Tables[13];if(v.length>0){for(let S=0;S<v.length;S++)for(let Y=5;Y<this.grdIncomeTax.ReportColumns.length;Y++)if(v[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()){l=0,C.J0.IsEmpty(v[S].AMOUNT)||(l=parseFloat(v[S].AMOUNT)),l>0?(Ne=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.BasicIndex].Cells[Y].Value),l-=10*Ne/100,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[Y].Value=C.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[Y].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[Y].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[Y].IsNormal=!1,ce+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].Value=C.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].IsNormal=!1;if(V=ce,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ce),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAAcutalIndex=this.HRA10BasicIndex+1,ce=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[1].Value=this.HRAAcutalIndex,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[2].Value=this.dsTaxData.Tables[6][0].componentid.toString(),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].Value="Actual Received ",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].ColSpan=2,this.dsTaxData.Tables[6].length>0){for(E=5;E<17;E++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].Value=C.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].CellAppearance.Alignment="Right";E=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[6][0].componentid))for(E=5;E<i;E++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].Value=C.J0.GetAmount(C.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value)),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].CellAppearance.Alignment="Right",ce+=C.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value)}ie=ce,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ce),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1;let we=0,Ie=0;if(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dsTaxData.Tables[7].length>0){ce=0;let Y,be,S=null,J=new ve.bT;Y=new R.Nl("Basic",""),J.push("Basic",Y),J.Basic.setFieldValue(C.J0.DoubleTryParse(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),S=this.dsTaxData.Tables[8].filter(De=>1==De.Type&&"OverTime"!=De.FieldType);let te=this.dsTaxData.Tables[3];if(S.length>0)for(let De=0;De<S.length;De++)be=this.dsTaxData.Tables[8].filter(Be=>Be.ComponentID==S[De].ComponentID),null!=be&&be.length>0&&(Y=new R.Nl(S[De].ComponentName.toString(),""),J.push(S[De].ComponentName.toString(),Y),J[S[De].ComponentName.toString()].setFieldValue(te[0]["Earning"+be[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[8].filter(De=>2==De.Type&&"OverTime"!=De.FieldType),S.length>0)for(let De=0;De<S.length;De++)be=this.dsTaxData.Tables[8].filter(Be=>Be.ComponentID==S[De].ComponentID),null!=be&&be.length>0&&(Y=new R.Nl(S[De].ComponentName.toString(),""),J.push(S[De].ComponentName.toString(),Y),J[S[De].ComponentName.toString()].setFieldValue(te[0]["Deduction"+be[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[7],S.length>0){let De=J;we=parseFloat(r.d.eval.EvaluateExpression(S[0].MetroFormula.toString(),De)),Ie=parseFloat(r.d.eval.EvaluateExpression(S[0].NonmetroFormula.toString(),De))}}this.HRAMetroNonMetroIndex=this.HRAAcutalIndex+1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[1].Value=this.HRAMetroNonMetroIndex,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[2].Value=-102,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].Value="Metro/Non-Metro ",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].ColSpan=2;let de="";if(v.length>0){for(let S=0;S<v.length;S++)for(let Y=5;Y<this.grdIncomeTax.ReportColumns.length;Y++)if(v[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()){de=v[S].METRO.toString(),"Yes"==de?(l=we,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[Y].Value=C.J0.GetAmount(l)):"No"==de.TrimEnd(" ")?(l=Ie,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[Y].Value=C.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[Y].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[Y].CellAppearance.Alignment="Right",ce+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].Value=C.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].CellAppearance.Alignment="Right";me=ce,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ce),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAExemptionIndex=this.HRAMetroNonMetroIndex+1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[1].Value=this.HRAExemptionIndex,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[2].Value=-103,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].Value="HRA Exemption ",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.IsBold=!0,this.HraMinValue=Math.min(V,ie,me),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.HraMinValue),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TotAmtOthExemptUs10Index=this.HRAExemptionIndex+1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[1].Value=this.TotAmtOthExemptUs10Index,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[2].Value=10001,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].Value="Total amount of any other exemption under section 10",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].ColSpan=14;let Ve=0,ne=this.dsTaxData.Tables[25].filter(S=>"U/S 10 : 1) Total amount of any other exemption under section 10"==S.Name);null!=ne&&ne.length>0&&null!=ne[0].Amount&&null!=ne[0].Amount&&""!=ne[0].Amount.toString()&&(Ve=parseFloat(ne[0].Amount)),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Ve),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(2);let ke=0,jt=0,ga=0;if(this.dvLimit=this.dvLimitData.filter(S=>998==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(ke=parseFloat(this.dvLimit[0].AmountLimit)),this.ConveyanceIndex=this.TotAmtOthExemptUs10Index+1,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[1].Value=this.ConveyanceIndex,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][0].ComponentID),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].Value="Conveyance",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].ColSpan=14,parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){if(this.dsTaxData.Tables[9].length>0){E=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][0].ComponentID))for(E=5;E<i;E++)C.J0.IsEmpty(this.grdIncomeTax.Data[S].Cells[E].Value)||(jt+=C.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value))}ga=jt/12,0==ga||ga>ke?ke*=12:ke=jt}parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2018&&(ke=0,2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.dblStandardDeduction=4e4:parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.dvLimit=this.dvLimitData.filter(S=>1e3==S.ComponentID),this.dblStandardDeduction=null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()?parseFloat(this.dvLimit[0].AmountLimit):5e4)),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ke),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.ChildrenEduIndex=this.ConveyanceIndex+1,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[1].Value=this.ChildrenEduIndex,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][1].ComponentID),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[3].Value="Children Education Allowances";let Pa=0;if(parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){let S=0,Y=0,J=0,be=0;if(this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(te=>996==te.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(J=parseFloat(this.dvLimit[0].AmountLimit)),this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(te=>996==te.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Y=parseInt(this.dvLimit[0].AmountLimit)),this.dsTaxData.Tables[10].length>0){S=parseInt(this.dsTaxData.Tables[10][0][0]),S>Y&&(S=Y),be=12*S*J,E=5;for(let te=0;te<this.TotalSalaryIndex;te++)if(parseInt(this.grdIncomeTax.Data[te].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][1].ComponentID))for(E=5;E<i;E++)null!=this.grdIncomeTax.Data[te].Cells[E].Value&&""!=this.grdIncomeTax.Data[te].Cells[E].Value.toString()&&0!=C.J0.DoubleTryParse(this.grdIncomeTax.Data[te].Cells[E].Value)&&(Pa+=S*J)}}this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Pa),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.dsTaxData.Tables[11].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[11].length);let ma=0,Ia=0;ma=this.ChildrenEduIndex+1,N=ma;for(let S=0;S<this.dsTaxData.Tables[11].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ma+S,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[11][S].NodeID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[11][S].NAME.toString(),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.dvEmpTaxComputation=this.dsTaxData.Tables[21],this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Y=>Y.ComponentID==parseInt(this.dsTaxData.Tables[11][S].NODEID)&&0==Y.RegimeType),this.dvEmpTaxComputation.length>0?(this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount))):(this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(0),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(0)),Ia+=C.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1;this.MedicalIndex=this.ChildrenEduIndex+1,this.LTAIndex=this.MedicalIndex+1,this.FoodIndex=this.LTAIndex+1,this.LeaveEncashIndex=this.FoodIndex+1,this.GratuityIndex=this.LeaveEncashIndex+1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.StandardDedIndex=this.GratuityIndex+1,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[1].Value=this.StandardDedIndex,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblStandardDeduction),this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.MedicalIndex].Cells[4].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LTAIndex].Cells[4].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LeaveEncashIndex].Cells[4].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.FoodIndex].Cells[4].Value)+C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.GratuityIndex].Cells[4].Value)+this.dblStandardDeduction),this.grdIncomeTax.addEmptyRowsWithCellApperance(3),this.BalanceSalInc12BAIndex=this.StandardDedIndex+1,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[1].Value=this.BalanceSalInc12BAIndex,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[2].Value=-104,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[3].Value="Balance Salary including Perquisites",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblbalanceSalaryInc12BA),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let ut=0,xa=this.dsTaxData.Tables[12];this.ProfessionalTaxIndex=this.BalanceSalInc12BAIndex+1,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[0].Value=-105,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[1].Value=this.ProfessionalTaxIndex,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[3].Value="Professional Tax",g=this.dsTaxData.Tables[20];let Ce=!1;if(xa.length>0){Ce=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("PROFESSIONAL TAX"==C.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let Y=5;Y<this.grdIncomeTax.ReportColumns.length-2;Y++){Ce=!1;for(let J=0;J<g.length;J++)if(g[J].month.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()){C.J0.IsEmpty(g[J]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(ut+=parseFloat(g[J]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),Ce=!0;break}if(!Ce)for(let J=0;J<p.length;J++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[J].componentid)&&p[J].FieldName.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()&&parseFloat(p[J].Amount)>0){C.J0.IsEmpty(p[J].Amount)||(ut+=parseFloat(p[J].Amount)),Ce=!0;break}if(!Ce)for(let J=0;J<t.length;J++)C.J0.IsEmpty(t[J]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(ut+=parseFloat(t[J]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}}this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].Value=C.J0.GetAmount(ut),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ut),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.NetTaxableSalIndex=this.ProfessionalTaxIndex+1,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[1].Value=this.NetTaxableSalIndex,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNetTaxableSal=0,this.dblNetTaxableSal=this.dblbalanceSalaryInc12BA-ut,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNetTaxableSal),this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[14].length+3);let Sa=0;this.IncomefromHousePropertyIndex=this.NetTaxableSalIndex+1;for(let S=0;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[1].Value=this.IncomefromHousePropertyIndex,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Sa=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}let Ma=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[1].Value=this.IncomefromHousePropertyIndex+1,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[2].Value=-107,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[3].Value="Less : Standard deduction 30%",Ma=30*Sa/100,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value=C.J0.GetAmount(Ma),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Bt=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[1].Value=this.IncomefromHousePropertyIndex+2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[2].Value=-108,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[3].Value="",Bt=parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value)-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].Value=C.J0.GetAmount(Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[5].ColSpan=12;let Jt=0;for(let S=1;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[1].Value=this.IncomefromHousePropertyIndex+3,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Jt=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].Value=C.J0.GetAmount(Jt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[1].Value=this.IncomefromHousePropertyIndex+4,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[2].Value=-109,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].Value="Loss from House Property",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(Jt-Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Wt=0;this.dblSelfletoutamount=0,N=Wt=this.IncomefromHousePropertyIndex+5;for(let S=2;S<this.dsTaxData.Tables[14].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Wt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblSelfletoutamount=this.dblSelfletoutamount+parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(C.J0.DoubleTryParse(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,Wt+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.GrossTotalIncomeIndex=Wt,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[1].Value=this.GrossTotalIncomeIndex,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblGrossTotalIncome=this.dblNetTaxableSal+this.dblSelfletoutamount-(Jt-Bt),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblGrossTotalIncome),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intDeducunder8oCto80CCCIndex=this.GrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[1].Value=this.intDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].ColSpan=15,this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[16].length);let fa=0,ca=0,it=0;N=it=this.intDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[16].length;S++){if(this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=it,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[16][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][S].NAME,this.dvEmpTaxComputation.RowFilter="",this.dvEmpTaxComputation.filter(Y=>Y.ComponentID==parseInt(this.dsTaxData.Tables[16][S].NODEID)),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==C.J0.String(this.dsTaxData.Tables[16][S].NAME)){let Y=0;Ce=!1;for(let J=0;J<this.dsTaxData.Tables[19].length;J++)if("PF(Deduction from Salary)"==C.J0.String(this.dsTaxData.Tables[19][J].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][J].SNo)>0)for(let be=5;be<this.grdIncomeTax.ReportColumns.length-2;be++){Ce=!1;for(let te=0;te<g.length;te++)if(C.J0.String(g[te].month)==this.grdIncomeTax.ReportColumns[be].HeaderText.toString()){C.J0.IsEmpty(g[te]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][J].SNo)])||(Y+=parseFloat(g[te]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][J].SNo)])),Ce=!0;break}if(!Ce)for(let te=0;te<p.length;te++)if(parseInt(this.dsTaxData.Tables[19][J].componentID)==parseInt(p[te].componentid)&&p[te].FieldName.toString()==this.grdIncomeTax.ReportColumns[be].HeaderText.toString()&&parseFloat(p[te].Amount)>0){C.J0.IsEmpty(p[te].Amount)||(Y+=parseFloat(p[te].Amount)),Ce=!0;break}if(!Ce&&be>=s)for(let te=0;te<t.length;te++)C.J0.IsEmpty(t[te]["Deduction"+C.J0.String(this.dsTaxData.Tables[19][J].SNo)])||(Y+=parseFloat(t[te]["Deduction"+C.J0.String(this.dsTaxData.Tables[19][J].SNo)]))}this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(Y)}else this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dsTaxData.Tables[16][S].AMOUNT));this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",0==S&&(fa=C.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),S>0&&(ca+=C.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,N+=1,it+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalDeducunder8oCto80CCCIndex=it,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblTotaldeduction80ccc80c=ca+fa,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].Value=C.J0.GetAmount(this.dblTotaldeduction80ccc80c);let Ca=0;this.dvLimit=this.dvLimitData.filter(S=>995==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Ca=parseFloat(this.dvLimit[0].AmountLimit)),this.dblTotaldeduction80ccc80c>Ca&&(this.dblTotaldeduction80ccc80c=Ca),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b";let Mt=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[17].length),this.intOtherDeducunder8oCto80CCCIndex=this.intTotalDeducunder8oCto80CCCIndex+1,N=it=this.intTotalDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[17].length;S++){let Y=0;if(this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=it,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[17][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[17][S].NAME,this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(J=>J.ComponentID==parseInt(this.dsTaxData.Tables[17][S].NODEID)&&0==J.RegimeType),this.dvEmpTaxComputation.length>0)Mt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(Y=0,Y=parseFloat(this.dsTaxData.Tables[17][S].AMOUNT),"80D-Self/Spouse/Dependant Children"==C.J0.String(this.dsTaxData.Tables[17][S].NAME)||"80D-Self/Dependant/Parent (not Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()){Ce=!1;for(let J=0;J<this.dsTaxData.Tables[19].length;J++)if(!C.J0.IsEmpty(this.dsTaxData.Tables[19][J].TaxmapName)&&this.dsTaxData.Tables[19][J].TaxmapName.toString()==this.dsTaxData.Tables[17][S].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][J].SNo)>0)for(let be=5;be<this.grdIncomeTax.ReportColumns.length-2;be++){Ce=!1;for(let te=0;te<g.length;te++)if(g[te].month.toString()==this.grdIncomeTax.ReportColumns[be].HeaderText.toString()){null!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][J].SNo.toString()]&&null!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][J].SNo.toString()]&&""!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][J].SNo.toString()].toString()&&(Y+=parseFloat(g[te]["dcCalcNum"+this.dsTaxData.Tables[19][J].SNo.toString()])),Ce=!0;break}if(!Ce)for(let te=0;te<p.length;te++)if(parseInt(this.dsTaxData.Tables[19][J].componentID)==parseInt(p[te].componentid)&&p[te].FieldName.toString()==this.grdIncomeTax.ReportColumns[be].HeaderText.toString()&&parseFloat(p[te].Amount)>0){null!=p[te].Amount&&null!=p[te].Amount&&""!=p[te].Amount.toString()&&(Y+=parseFloat(p[te].Amount)),Ce=!0;break}if(!Ce)for(let te=0;te<t.length;te++)null!=t[te]["Deduction"+this.dsTaxData.Tables[19][J].SNo.toString()]&&null!=t[te]["Deduction"+this.dsTaxData.Tables[19][J].SNo.toString()]&&""!=t[te]["Deduction"+this.dsTaxData.Tables[19][J].SNo.toString()].toString()&&(Y+=parseFloat(t[te]["Deduction"+this.dsTaxData.Tables[19][J].SNo.toString()]))}}Mt+=Y,this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(Y)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):Y),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,it+=1}this.intOtherDeducunder8oCto80CCCIndex1=it-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeIndex=this.intOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeIndex,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.dblTotalIncome=this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-Mt,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeRoundoffIndex=this.dblTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.IsBold=!0,this.dblTotalIncomeRoundoff=Math.round(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxOnTotalIncomeIndex=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblRebateIndex=this.dblTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[2].Value=-116,parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,000 for Taxable Income below Rs.5,00,000/-)":2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.5,000 for Taxable Income below Rs.5,00,000/-)":2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,500 for Taxable Income below Rs.3,50,000/-)":parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.12,500 for Taxable Income below Rs.5,00,000/-)"),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableAfterRebateIndex=this.dblRebateIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSurchargeIndex=this.dblTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableIndex=this.dblSurchargeIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblEducationCessIndex=this.dblTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSecHighEduCessIndex=this.dblEducationCessIndex+1,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalIncometaxPayableindex=this.dblSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[1].Value=this.intTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TDSPaidIndex=this.intTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[1].Value=this.TDSPaidIndex,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NetTaxPayableIndex=this.TDSPaidIndex+1,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[1].Value=this.NetTaxPayableIndex,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let ba,pa=0,ft=0,Ea=0,Fa=0,Ht=0,Na=0;Ht=r.d.SessionManager.FinancialYearStartDate.getFullYear(),ba=Ht.toString(),Ht=parseInt(ba.substr(2,2)),Na=Ht+1,pa=r.d.SessionManager.AccountingFromMonth,Fa=pa;let Ut=1;ft=pa,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.MonthlyDeducIndex=this.NetTaxPayableIndex+1,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[1].Value=this.MonthlyDeducIndex,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[2].Value=-125,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].Value="Monthly Deductions from salary",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].ColSpan=2;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)if(13==ft){Ea=ft-Ut;for(let Y=1;Y<=Ea;Y++)this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(Y,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",Ut+=1,S++}else this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(ft,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",ft+=1,Ut+=1;this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.dsTaxData.Tables[19].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[19].length+1);let Yt=0,Et=0,nt=0;N=Yt=this.MonthlyDeducIndex+1,g=this.dsTaxData.Tables[20];for(let S=0;S<this.dsTaxData.Tables[19].length;S++){if(H=new Array,E=5,nt=Et=0,this.grdIncomeTax.Data[N+S].Cells[17].Value=0,this.grdIncomeTax.Data[N+S].Cells[0].Value=this.dsTaxData.Tables[19][S].SNo,this.grdIncomeTax.Data[N+S].Cells[1].Value=Yt+S,this.grdIncomeTax.Data[N+S].Cells[2].Value=this.dsTaxData.Tables[19][S].componentID,this.grdIncomeTax.Data[N+S].Cells[3].Value=this.dsTaxData.Tables[19][S].SalaryBreakup,this.grdIncomeTax.Data[N+S].Cells[3].ColSpan=2,parseInt(this.dsTaxData.Tables[19][S].SNo)>0){for(let Y=0;Y<g.length;Y++)for(let J=5;J<this.grdIncomeTax.ReportColumns.length;J++)if(g[Y].month.toString()==this.grdIncomeTax.ReportColumns[J].HeaderText.toString()&&!H.Contains(this.grdIncomeTax.ReportColumns[J].HeaderText)){H.push(this.grdIncomeTax.ReportColumns[J].HeaderText),l=0,C.J0.IsEmpty(g[Y]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(l=parseFloat(g[Y]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),this.grdIncomeTax.Data[N+S].Cells[J].Value=l>=0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[J].IsNormal=!1,nt+=l;break}p=D,p=this.dsTaxData.Tables[2].filter(Y=>"2"==Y.ComponentType);for(let Y=0;Y<p.length;Y++)for(let J=5;J<this.grdIncomeTax.ReportColumns.length;J++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[Y].componentid)&&p[Y].FieldName.toString()==this.grdIncomeTax.ReportColumns[J].HeaderText.toString()&&parseFloat(p[Y].Amount)>0&&!H.Contains(this.grdIncomeTax.ReportColumns[J].HeaderText)){this.grdIncomeTax.ReportColumns[J].Tag="Past",H.push(this.grdIncomeTax.ReportColumns[J].HeaderText),l=0,C.J0.IsEmpty(p[Y].Amount)||(l=parseFloat(p[Y].Amount)),this.grdIncomeTax.Data[N+S].Cells[J].Value=l>=0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[J].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[J].IsNormal=!1,nt+=l;break}if(0==t.length)return;for(let Y=0;Y<t.length;Y++)for(E=s;E<i;E++)!H.Contains(this.grdIncomeTax.ReportColumns[E].HeaderText)&&C.J0.DoubleTryParse(this.grdIncomeTax.Data[N+S].Cells[E].Value)<=0&&(H.push(this.grdIncomeTax.ReportColumns[E].HeaderText),l=parseFloat(t[Y]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]),this.grdIncomeTax.Data[N+S].Cells[E].Value=l>=0?C.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[E].IsNormal=!1,nt+=l)}this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(nt),this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0}this.InhandAmountIndex=Yt+this.dsTaxData.Tables[19].length;let ua=0;this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[1].Value=this.InhandAmountIndex,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[2].Value=-126,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].Value="In Hand",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].IsNormal=!1,E=5;let Da=0;for(E=5;E<17;E++)this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].Value=C.J0.GetAmount(0),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.ForeColor="#dc3545";for(E=5;E<i;E++){Et=0;for(let S=Yt;S<this.InhandAmountIndex;S++)Et+=C.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value);Da=C.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[E].Value)-Et,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].Value=C.J0.GetAmount(Da),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.ForeColor="#dc3545",ua+=Da}this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(ua),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",Ce=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("TDS"==C.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let Y=5;Y<this.grdIncomeTax.ReportColumns.length-2;Y++){Ce=!1;for(let J=0;J<g.length;J++)if(g[J].month.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()){C.J0.IsEmpty(g[J]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(g[J]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),Ce=!0;break}if(!Ce)for(let J=0;J<p.length;J++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[J].componentid)&&p[J].FieldName.toString()==this.grdIncomeTax.ReportColumns[Y].HeaderText.toString()&&parseFloat(p[J].Amount)>0){C.J0.IsEmpty(p[J].Amount)||(this.dblTDS+=parseFloat(p[J].Amount)),Ce=!0;break}if(!Ce)for(let J=0;J<t.length;J++)C.J0.IsEmpty(t[J]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(t[J]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}if(this.UpdateTotals(this.dblTotalIncomeRoundoff),this.bIsNewRegime){let S=0,Y=0,J=0;this.dvNewTaxSlabs=this.dsTaxData.Tables[7];let be={iY:S,iM:Y,iD:J};C.J0.GetYearsMonthsDays(new Date(T[0].CDOB),this.dtToMonth.OnlyDate(),be),S=be.iY,Y=be.iM,J=be.iD,this.dvNewTaxSlabs=this.dsTaxData.Tables[7].filter(S>=80?ae=>"SuperSeniorCitizen"==ae.Gender&&"New"==ae.RegimeType:S>=60?ae=>"SeniorCitizen"==ae.Gender&&"New"==ae.RegimeType:ae=>ae.Gender==C.J0.String(T[0].GenderName)&&"New"==ae.RegimeType),this.lstNewTaxSalbs.Clear();for(let ae=0;ae<this.dvNewTaxSlabs.length;ae++)this.lstNewTaxSalbs.push(new Oe),this.lstNewTaxSalbs[ae].FromSlab=parseFloat(this.dvNewTaxSlabs[ae].Fromslab),this.lstNewTaxSalbs[ae].ToSlab=parseFloat(this.dvNewTaxSlabs[ae].Toslab),this.lstNewTaxSalbs[ae].Percentage=parseFloat(this.dvNewTaxSlabs[ae].Percentage)/100;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewRegimeStartIndex=this.InhandAmountIndex+1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[1].Value=this.NewRegimeStartIndex,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[2].Value=-130,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].Value="Computation Based on New Regime",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.Alignment="Center",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.ForeColor="Black",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontSize=18,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Height=32,this.dvNewLimit=this.dsTaxData.Tables[15].filter(ae=>1e3==ae.ComponentID&&"New"==ae.Regime),this.dblNewStandardDeduction=null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()?parseFloat(this.dvNewLimit[0].AmountLimit):5e4,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewStandardDedIndex=this.NewRegimeStartIndex+1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[1].Value=this.NewStandardDedIndex,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewStandardDeduction),this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxableSalIndex=this.NewStandardDedIndex+1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[1].Value=this.NewNetTaxableSalIndex,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNewNetTaxableSal=0,this.dblNewNetTaxableSal=this.dblTotalCellSalary-this.dblNewStandardDeduction,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewNetTaxableSal),this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red";let te=0;this.dblNewSelfletoutamount=0;let De=this.dsTaxData.Tables[14].filter(ae=>"New"==ae.RegimeType||"Both"==ae.RegimeType);if(null!=De&&De.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(De.length),N=te=this.NewNetTaxableSalIndex+1,null!=De&&De.length>0)for(let ae=0;ae<De.length;ae++)this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=te,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(De[ae].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=De[ae].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(De[ae].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblNewSelfletoutamount=this.dblNewSelfletoutamount+parseFloat(De[ae].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(parseFloat(De[ae].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,te+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewGrossTotalIncomeIndex=te,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[1].Value=this.NewGrossTotalIncomeIndex,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewGrossTotalIncome=this.dblNewNetTaxableSal+this.dblNewSelfletoutamount,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewGrossTotalIncome),this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewDeducunder8oCto80CCCIndex=this.NewGrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].ColSpan=14;let Be=this.dsTaxData.Tables[16].filter(ae=>"New"==ae.RegimeType||"Both"==ae.RegimeType);null!=Be&&Be.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Be.length);let Aa=0,Ta=0,ot=0;if(N=ot=this.intNewDeducunder8oCto80CCCIndex+1,null!=Be&&Be.length>0)for(let ae=0;ae<Be.length;ae++){if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ot,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Be[ae].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][ae].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Je=>Je.ComponentID==parseInt(Be[ae].NODEID)&&0==Je.RegimeType),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==Be[ae].NAME.toString()){let Je=0;Ce=!1;for(let Ee=0;Ee<this.dsTaxData.Tables[19].length;Ee++)if("PF(Deduction from Salary)"==C.J0.String(this.dsTaxData.Tables[19][Ee].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][Ee].SNo)>0)for(let st=5;st<this.grdIncomeTax.ReportColumns.length-2;st++){Ce=!1;for(let re=0;re<g.length;re++)if(C.J0.String(g[re].month)==this.grdIncomeTax.ReportColumns[st].HeaderText.toString()){null!=g[re]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=g[re]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(Je+=parseFloat(g[re]["dcCalcNum"+this.dsTaxData.Tables[19][Ee].SNo.toString()])),Ce=!0;break}if(!Ce)for(let re=0;re<p.length;re++)if(parseInt(this.dsTaxData.Tables[19][Ee].componentID)==parseInt(p[re].componentid)&&p[re].FieldName.toString()==this.grdIncomeTax.ReportColumns[st].HeaderText.toString()&&parseFloat(p[re].Amount)>0){null!=p[re].Amount&&""!=p[re].Amount.toString()&&(Je+=parseFloat(p[re].Amount)),Ce=!0;break}if(!Ce)for(let re=0;re<t.length;re++)null!=t[re]["Deduction"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=t[re]["Deduction"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(Je+=parseFloat(t[re]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]))}this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(Je)}else this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(Be[ae].Amount));0==ae&&(Aa=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),ae>0&&(Ta+=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[5].rowSpan=Be.length,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].rowSpan=Be.length,N+=1,ot+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalDeducunder8oCto80CCCIndex=ot,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblNewTotaldeduction80ccc80c=Ta+Aa,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].Value=C.J0.GetAmount(this.dblNewTotaldeduction80ccc80c);let ya=0;this.dvNewLimit=this.dsTaxData.Tables[15].filter(ae=>995==ae.ComponentID),null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()&&(ya=parseFloat(this.dvNewLimit[0].AmountLimit)),this.dblNewTotaldeduction80ccc80c>ya&&(this.dblNewTotaldeduction80ccc80c=ya),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green";let bt=0,Xe=this.dsTaxData.Tables[17].filter(ae=>"New"==ae.RegimeType||"Both"==ae.RegimeType);if(null!=Xe&&Xe.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Xe.length),this.intNewOtherDeducunder8oCto80CCCIndex=this.intNewTotalDeducunder8oCto80CCCIndex+1,N=ot=this.intNewTotalDeducunder8oCto80CCCIndex+1,null!=Xe&&Xe.length>0)for(let ae=0;ae<Xe.length;ae++){let Je=0;if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ot,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Xe[ae].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=Xe[ae].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Ee=>Ee.ComponentID==parseInt(Xe[ae].NODEID)&&0==Ee.RegimeType),this.dvEmpTaxComputation.length>0)bt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(Je=0,Je=parseFloat(Xe[ae].AMOUNT),"80D-Self/Spouse/Dependant Children"==Xe[ae].NAME.toString()||"80D-Self/Dependant/Parent (not Sr Citizen)"==Xe[ae].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==Xe[ae].NAME.toString()){Ce=!1;for(let Ee=0;Ee<this.dsTaxData.Tables[19].length;Ee++)if(this.dsTaxData.Tables[19][Ee].TaxmapName.toString()==Xe[ae].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][Ee].SNo)>0)for(let st=5;st<this.grdIncomeTax.ReportColumns.length-2;st++){Ce=!1;for(let re=0;re<g.length;re++)if(g[re].month.toString()==this.grdIncomeTax.ReportColumns[st].HeaderText.toString()){null!=g[re]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=g[re]["dcCalcNum"+C.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(Je+=parseFloat(g[re]["dcCalcNum"+this.dsTaxData.Tables[19][Ee].SNo.toString()])),Ce=!0;break}if(!Ce)for(let re=0;re<p.length;re++)if(parseInt(this.dsTaxData.Tables[19][Ee].componentID)==parseInt(p[re].componentid)&&p[re].FieldName.toString()==this.grdIncomeTax.ReportColumns[st].HeaderText.toString()&&parseFloat(p[re].Amount)>0){null!=p[re].Amount&&""!=p[re].Amount.toString()&&(Je+=parseFloat(p[re].Amount)),Ce=!0;break}if(!Ce)for(let re=0;re<t.length;re++)null!=t[re]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]&&null!=t[re]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]&&""!=t[re]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()].toString()&&(Je+=parseFloat(t[re]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]))}}bt+=Je,this.grdIncomeTax.Data[N].Cells[4].Value=C.J0.GetAmount(Je)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):Je),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,ot+=1}this.intNewOtherDeducunder8oCto80CCCIndex1=ot-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeIndex=this.intNewOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewTotalIncome=this.dblNewGrossTotalIncome-this.dblNewTotaldeduction80ccc80c-bt,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeRoundoffIndex=this.dblNewTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.dblNewTotalIncomeRoundoff=Math.round(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblNewTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxOnTotalIncomeIndex=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewRebateIndex=this.dblNewTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[2].Value=-116,parseInt(this.cmbYear.SelectedValue)>=2023&&(this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.25,000 for Taxable Income below Rs.7,00,000/-)"),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableAfterRebateIndex=this.dblNewRebateIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSurchargeIndex=this.dblNewTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableIndex=this.dblNewSurchargeIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewEducationCessIndex=this.dblNewTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSecHighEduCessIndex=this.dblNewEducationCessIndex+1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalIncometaxPayableindex=this.dblNewSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[1].Value=this.intNewTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewTDSPaidIndex=this.intNewTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[1].Value=this.NewTDSPaidIndex,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=C.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxPayableIndex=this.NewTDSPaidIndex+1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[1].Value=this.NewNetTaxPayableIndex,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.UpdateTotalsNewRegime(this.dblNewTotalIncomeRoundoff)}}catch(l){Logger.ErrorLog("Error : "+l)}}cmbYear_SelectionChanged(l){this.clear(0),this.ITComputationViewModel.FilterEmployees(),this.ITComputationViewModel.lFinancialDate=this.ITComputationViewModel.GetFinancialYear(),null!=this.lstEmployee.SelectedValue&&0!=this.lstEmployee.SelectedValue&&(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.OnYearSelected("Year"),this.FillDetails())}PrintForm16_Click(l){var s=this;return(0,le.A)(function*(){if(null==s.dtpDate.Date&&(s.dtpDate.Date=new Date),!(s.lstEmployee.SelectedValue>0))return s.obj.DisplayMessage="Select any Employee",void(s.obj.MessageVisibility=!0);s.txtPlace.Text.Trim(),s.dtpDate.Date.ToString("dd/MMM/yyyy"),s.LoadForm16PrintGrid(),s.Form16export()})()}LoadForm16PrintGrid(){let l,i="",n=-1,d=-1,h=-1,c=-1;this.grdPrint=new B.j,this.grdPrint.ItComput=!0,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let g=new L.bA;g.Alignment="Center",g.FontFamilyName="Arial",g.FontSize=12,g.IsBold=!0,g.BackColor="White",g.ForeColor="Black",g.IsVisible=!0;let p,D=new L.bA;D.Alignment="Left",D.FontFamilyName="Arial",D.FontSize=12,D.IsBold=!0,D.BackColor="White",D.ForeColor="#FF333333";for(let v=1;v<=10;v++)p=new O.D_,p.FieldName="Col"+v.toString(),p.width=70,p.HeaderText="Col"+v.toString(),p.HeaderAppearance=g,p.DataAppearance=D,this.grdPrint.ReportColumns.push(p);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=75,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=75,this.grdPrint.ReportColumns[6].width=40,this.grdPrint.ReportColumns[7].width=90,this.grdPrint.ReportColumns[8].width=90,this.grdPrint.ReportColumns[9].width=90;let t=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="[See rule 31(1)(a)]",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="PART A",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==r.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value=i,this.grdPrint.Data[t].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(v=>4==v.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[t].Cells[5].Value=i,this.grdPrint.Data[t].Cells[5].ColSpan=5,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=3,this.grdPrint.Data[t].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=3,this.grdPrint.Data[t].Cells[6].Value="PAN of the Employee",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value="Employee Reference No. provided by the Employer (If available)",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==r.d.SessionManager.CompanyIndex),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=3,this.grdPrint.Data[t].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=3,this.grdPrint.Data[t].Cells[6].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].Code&&null!=this.dsTaxData.Tables[18][0].Code?this.dsTaxData.Tables[18][0].Code.toString():"",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="Assessment Year",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=3,this.grdPrint.Data[t].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=3,this.grdPrint.Data[t].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[9].CellAppearance.Alignment="Center",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Summary of amount paid/credited and tax deducted at source thereon in respect of the employee",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Quarter(s)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].Value="Receipt Numbers of original quarterly statements of TDS under sub-section (3) of Section 200",this.grdPrint.Data[t].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].Value="Amount paid/credited",this.grdPrint.Data[t].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].Value="Amount of tax deducted (Rs.)",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value="Amount of tax deposited/remitted in respect",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Q1",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,n=t,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Q2",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Q3",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Q4",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,d=t,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=2,this.grdPrint.Data[t].Cells[2].Value="",this.grdPrint.Data[t].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[2].ColSpan=2,this.grdPrint.Data[t].Cells[4].Value="",this.grdPrint.Data[t].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[4].ColSpan=2,this.grdPrint.Data[t].Cells[6].Value="",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value="",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="I. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH BOOK ADJUSTMENT\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",t++,h=t,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Sl. No.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="Book Identification Number (BIN)",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[3].Value="Receipt Numbers of Form No. 24G",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=2,this.grdPrint.Data[t].Cells[5].Value="DDO serial number in Form no. 24G",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=2,this.grdPrint.Data[t].Cells[7].Value="Date of transfer voucher \r\n (dd/mm/yyyy)",this.grdPrint.Data[t].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[7].ColSpan=2,this.grdPrint.Data[t].Cells[9].Value="Status of matching with Form no. 24G",this.grdPrint.Data[t].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[9].ColSpan=1,this.grdPrint.Data[h].Cells[0].rowSpan=2,this.grdPrint.Data[h].Cells[1].rowSpan=2,this.grdPrint.Data[h].Cells[2].rowSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].ColSpan=2,this.grdPrint.Data[t].Cells[5].ColSpan=2,this.grdPrint.Data[t].Cells[7].ColSpan=2,this.grdPrint.Data[t].Cells[9].ColSpan=1,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="II. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH CHALLAN\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",t++,c=t,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Sl. No.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="Challan Identification Number (CIN)",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[3].Value="BSR Code of the Bank Branch",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=2,this.grdPrint.Data[t].Cells[5].Value="Date on which Tax deposited (dd/mm/yyyy)",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=2,this.grdPrint.Data[t].Cells[7].Value="Challan Serial Number",this.grdPrint.Data[t].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[7].ColSpan=2,this.grdPrint.Data[t].Cells[9].Value="Status of matching with OLTAS*",this.grdPrint.Data[t].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[9].ColSpan=1,this.grdPrint.Data[c].Cells[0].rowSpan=2,this.grdPrint.Data[c].Cells[1].rowSpan=2,this.grdPrint.Data[c].Cells[2].rowSpan=2;let T=0,P=0,A=0,_=0,x=0,F=0,j=r.d.common.GetDataTable("INC001",this.iSelectedEmpSeqNo.toString()+"~"+this.obj.EmpYear.SelectedValue);if(null!=j&&j.length>0){if(l=j.filter(v=>"Monthly"==v.dcAlpha2),null!=l&&l.length>0){T=0;for(let v=0;v<l.length;v++)t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value=v+1,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,F=0,F=C.J0.Double(l[v].dcNum5.toString()),this.grdPrint.Data[t].Cells[1].Value=F.ToString("0.00"),this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[1].ColSpan=2,T+=F,this.grdPrint.Data[t].Cells[3].Value=null!=l[v].dcAlpha5&&null!=l[v].dcAlpha5?l[v].dcAlpha5.toString():"",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=2,this.grdPrint.Data[t].Cells[5].Value=null!=l[v].dcAlpha6&&null!=l[v].dcAlpha6?C.J0.ParseDate(l[v].dcAlpha6).ToString("dd'-'MMM'-'yyyy"):"",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=2,this.grdPrint.Data[t].Cells[7].Value=null!=l[v].dcAlpha7&&null!=l[v].dcAlpha7?l[v].dcAlpha7.toString():"",this.grdPrint.Data[t].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[7].ColSpan=2,this.grdPrint.Data[t].Cells[9].Value="F",this.grdPrint.Data[t].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[9].ColSpan=1}if(t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value=T.ToString("0.00"),this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].ColSpan=7,l=j.filter(v=>"Quarterly"==v.dcAlpha2),null!=l&&l.length>0){T=P=A=_=x=0;let v=0;for(let we=0;we<l.length;we++)v=parseInt(l[we].dcAlpha3.toString().Replace("Quarter",""))-1,this.grdPrint.Data[n+v].Cells[2].Value=null!=l[we].dcAlpha8&&null!=l[we].dcAlpha8?l[we].dcAlpha8.toString():"",this.grdPrint.Data[n+v].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[n+v].Cells[2].ColSpan=2,F=0,0==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value):0):1==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value):0):2==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value):0):3==v&&(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value):0),this.grdPrint.Data[n+v].Cells[4].Value=F.ToString("0.00"),this.grdPrint.Data[n+v].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[n+v].Cells[4].ColSpan=2,T+=F,F=0,F=C.J0.Double(l[we].dcNum6.toString()),this.grdPrint.Data[n+v].Cells[6].Value=F.ToString("0.00"),this.grdPrint.Data[n+v].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[n+v].Cells[6].ColSpan=2,P+=F,F=0,F=C.J0.Double(l[we].dcNum7.toString()),this.grdPrint.Data[n+v].Cells[8].Value=F.ToString("0.00"),this.grdPrint.Data[n+v].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[n+v].Cells[8].ColSpan=2,A+=F}this.grdPrint.Data[d+1].Cells[4].Value=T.ToString("0.00"),this.grdPrint.Data[d+1].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[4].ColSpan=2,this.grdPrint.Data[d+1].Cells[6].Value=P.ToString("0.00"),this.grdPrint.Data[d+1].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[6].ColSpan=2,this.grdPrint.Data[d+1].Cells[8].Value=A.ToString("0.00"),this.grdPrint.Data[d+1].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[8].ColSpan=2}t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Verification",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+C.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that a sum of Rs. "+this.grdPrint.Data[d+1].Cells[6].Value+" ["+C.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[d+1].Cells[6].Value&&null!=this.grdPrint.Data[d+1].Cells[6].Value&&""!=this.grdPrint.Data[d+1].Cells[6].Value.toString()?this.grdPrint.Data[d+1].Cells[6].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" (in words)] has been deducted and a sum of Rs. "+this.grdPrint.Data[d+1].Cells[8].Value+" ["+C.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[d+1].Cells[6].Value&&null!=this.grdPrint.Data[d+1].Cells[6].Value&&""!=this.grdPrint.Data[d+1].Cells[6].Value.toString()?this.grdPrint.Data[d+1].Cells[8].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" ] has been deposited to the credit of the Central Government. I further certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, TDS deposited and other available records.",this.grdPrint.Data[t].Cells[0].Value=i,this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[5].Value="Full Name : "+C.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toString(),this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Notes :",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="1. Part B (Annexure) of the certificate in Form No.16 shall be issued by the employer.\n\n2. If an assessee is employed under one employer during the year, Part 'A' of the certificate in Form No.16 issued for the quarter ending on 31st March of the financial year shall contain the details of tax deducted and deposited for all the quarters of the financial year.\n\n3. If an assessee is employed under more than one employer during the year, each of the employers shall issue Part A of the certificate in Form No.16 pertaining to the period for which such assessee was employed with each of the employers. Part B (Annexure) of the certificate in Form No. 16 may be issued by each of the employers or the last employer at the option of the assessee.\n\n4. To update PAN details in Income Tax Department database, apply for 'PAN change request' through NSDL or UTITSL.\n\n",this.grdPrint.Data[t].Cells[0].Value=i,this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Legend used in Form 16",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   * Status of matching with OLTAS",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Legend",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Description",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="Definition",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="U",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Unmatched",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="Deductors have not deposited taxes or have furnished incorrect particulars of tax payment. Final credit will be reflected only when payment details in bank match with details of deposit in TDS / TCS statement",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="P",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Provisional",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value='Provisional tax credit is effected only for TDS / TCS Statements filed by Government deductors."P" status will be changed to Final (F) on verification of payment details submitted by Pay and Accounts Officer (PAO)',this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="F",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Final",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="In case of non-government deductors, payment details of TDS / TCS deposited in bank by deductor have matched with the payment details mentioned in the TDS / TCS statement filed by the deductors. In case of government deductors, details of TDS / TCS booked in Government account have been verified by Pay & Accounts Officer (PAO)",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="O",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=1,this.grdPrint.Data[t].Cells[1].Value="Overbooked",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=2,this.grdPrint.Data[t].Cells[3].Value="Payment details of TDS / TCS deposited in bank by deductor have matched with details mentioned in the TDS / TCS statement but the amount is over claimed in the statement. Final (F) credit will be reflected only when deductor reduces claimed amount in the statement or makes new payment for excess amount claimed in the statement",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[3].ColSpan=7,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Tag="Break",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="PART B",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==r.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value=i,this.grdPrint.Data[t].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(v=>4==v.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[t].Cells[5].Value=i,this.grdPrint.Data[t].Cells[5].ColSpan=5,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=3,this.grdPrint.Data[t].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=4,this.grdPrint.Data[t].Cells[7].Value="PAN of the Employee",this.grdPrint.Data[t].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[7].ColSpan=3,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==r.d.SessionManager.CompanyIndex),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=3,this.grdPrint.Data[t].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[3].ColSpan=4,this.grdPrint.Data[t].Cells[7].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[t].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[7].ColSpan=3,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="Assessment Year",this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=3,this.grdPrint.Data[t].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[5].ColSpan=3,this.grdPrint.Data[t].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[9].CellAppearance.Alignment="Center",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Details of Salary Paid and any other income and tax deducted",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[0].ColSpan=6,this.grdPrint.Data[t].Cells[6].Value="Rs",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value="Rs.",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[t].Cells[8].ColSpan=2;let f=0,E=0,N=0,ee=0,q=0,H=0,V=0,ie=0,me=0;t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="1.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Gross Salary",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=9,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (a)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Salary as per provisions contained in section 17(1)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (b)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Value of perquisites under section 17(2) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (c)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Profits in lieu of salary under section 17(3) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (d)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=7,this.grdPrint.Data[t].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,E=parseFloat(this.grdPrint.Data[t].Cells[8].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (e)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Reported total amount of salary received from other employer(s)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value="0.00",this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,N=parseFloat(this.grdPrint.Data[t].Cells[8].Value),f=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="2.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Less: Allowances to the extent exempt under section 10",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=9,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (a)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Travel concession or assistance under section 10(5)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (b)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Death-cum-retirement gratuity under section 10(10)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value="0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (c)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Commuted value of pension under section 10(10A)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value="0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (d)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Cash equivalent of leave salary encashment under section 10 (10AA)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value="0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (e)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="House rent allowance under section 10(13A)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (f)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Amount of any other exemption under section 10 [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (g)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total amount of any other exemption under section 10",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value,this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (h)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total amount of exemption claimed under section 10\r\n [2(a)+2(b)+2(c)+2(d)+2(e)+2(g)]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,E-=parseFloat(this.grdPrint.Data[t].Cells[8].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="3.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total amount of salary received from current employer\r\n[1(d)-2(h)]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=E.toString(),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,N+=parseFloat(this.grdPrint.Data[t].Cells[8].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="4.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Less: Deductions under section 16",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=9,f=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (a)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Standard deduction under section 16(ia)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (b)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Entertainment allowance under section 16(ii)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value="0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (c)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Tax on employment under section 16(iii)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="5.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total amount of deductions under section 16\r\n[4(a)+4(b)+4(c)]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,N-=parseFloat(this.grdPrint.Data[t].Cells[8].Value),q=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="6.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value='Income chargeable under the head "Salaries"\r\n[(3+1(e))-5]',this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=N.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,q+=parseFloat(this.grdPrint.Data[t].Cells[8].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="7.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Add: Any other income reported by the employee under as per section 192 (2B)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=9,ee=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (a)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Income (or admissible loss) from house property reported by employee offered for TDS",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(-1*parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,ee+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (b)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Income under the head Other Sources offered for TDS",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].ColSpan=2,ee+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="8.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total amount of other income reported by the employee\r\n[7(a)+7(b)]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=ee.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,q+=parseFloat(this.grdPrint.Data[t].Cells[8].Value),V=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="9.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Gross total income (6+8)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=2,this.grdPrint.Data[t].Cells[8].Value=q.ToString("0.00"),this.grdPrint.Data[t].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[8].ColSpan=2,V+=parseFloat(this.grdPrint.Data[t].Cells[8].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="10.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deductions under Chapter VI-A",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=9,H=0;let ce=0;for(let v=this.intDeducunder8oCto80CCCIndex+1;v<this.intTotalDeducunder8oCto80CCCIndex;v++)if(null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCC-")){ce+=null!=this.grdIncomeTax.Data[v].Cells[4].Value&&""!=this.grdIncomeTax.Data[v].Cells[4].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[4].Value):0;break}t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (a)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of life insurance premia, contributions to provident fund etc. under section 80C",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value-ce).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (b)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of contribution to certain pension funds under section 80CCC",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=ce.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(1)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (c)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of contribution by taxpayer to pension scheme under section 80CCD (1)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4;let Ne=f;t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (d)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total deduction under section 80C, 80CCC and 80CCD(1)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=(Ne+parseFloat(null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00")).ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(1B)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (e)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deductions in respect of amount paid/deposited to notified pension scheme under section 80CCD (1B)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(2)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (f)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of contribution by Employer to pension scheme under section 80CCD (2)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80D-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (g)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of health insurance premia under section 80D",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80DD-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (h)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of Medical Treatment of handicapped Dependent under section 80DD",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80U-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (i)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of Physically Disable Assesse under section 80U",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80E-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (j)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of interest on loan taken for higher education under section 80E",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&(this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80G-")||this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GGA-")||this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GGC-"))&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (k)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total Deduction in respect of donations to certain funds, charitable institutions, etc. under section 80G",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=C.J0.Double(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80TTA-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (l)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of interest on deposits in savings account under section 80TTA",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=C.J0.Double(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80EEB-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (m)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of interest on Electric Vehicle Loan under section 80EEB",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (n)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Amount deductible under any other provision(s) of Chapter VI-A [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].ColSpan=4,f=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (o)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total of amount deductible under any other provision(s) of Chapter VI-A",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCF-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (p)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of Amount invested in specific Government approved Infrastructure bonds under section 80CCF",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80DDB-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (q)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction for Medical Treatment of certain specified ailments for Self/Dependent under section 80DDB",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GG-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="   (r)",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Deduction in respect of house rent paid who does not get HRA under section 80GG",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="11.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Aggregate of deductible amount under Chapter VI-A\r\n[10(d)+10(e)+10(f)+10(g)+10(h)+10(i)+10(j)+10(k)+10(l)+10(m)+10(n)+10(o)+10(p)+10(q)+10(r)]",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=H.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,V-=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="12.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Total taxable income (9-11)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=Math.round(V).ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,ie=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="13.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Tax on total income",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,ie+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="14.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Rebate under section 87A, if applicable",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,ie-=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="15.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Surcharge, wherever applicable",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,ie+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="16.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Health and education cess",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,ie+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),me=0,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="17.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Tax payable (13+15+16-14)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=ie.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,me+=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="18.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Less: Relief under section 89 (attach details)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value="0.00",this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,me-=parseFloat(this.grdPrint.Data[t].Cells[6].Value),t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="19.",this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].Value="Net tax payable (17-18)",this.grdPrint.Data[t].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[1].ColSpan=5,this.grdPrint.Data[t].Cells[6].Value=me.ToString("0.00"),this.grdPrint.Data[t].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[t].Cells[6].ColSpan=4,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Verification",this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Center",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+C.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, and other available records.",this.grdPrint.Data[t].Cells[0].Value=i,this.grdPrint.Data[t].Cells[0].ColSpan=10,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=10,t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[5].Value="Full Name : "+C.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text),this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left",t++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[t].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[t].Cells[0].ColSpan=5,this.grdPrint.Data[t].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[t].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[t].Cells[5].ColSpan=5,this.grdPrint.Data[t].Cells[5].CellAppearance.Alignment="Left"}generatePrintContent(l,s="",i=!1,n=!1){let d="",h="",c="",g="",p="";if(d+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",h+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",h+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",h+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",h+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",d+="<style>"+h.toString()+"</style>",p=d,p+=`<h3 style="text-align: center;">${s}</h3>`,p+=" <table  border=1  style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",n){p+="<thead>",p+="<tr>";for(let T=0;T<l.ReportColumns.length;T++){const P=l.ReportColumns[T];P.HeaderAppearance.IsVisible&&(p+=`<th  width=${P.width} ></th>`)}p+="</tr>",p+="</thead>"}else{p+="<thead>",p+="<tr>";for(let T=0;T<l.ReportColumns.length;T++){const P=l.ReportColumns[T];P.HeaderAppearance.IsVisible&&(p+=`<th class='hdr'  width=${P.width} >${P.HeaderText}</th>`)}p+="</tr>",p+="</thead>"}p+="<tbody>";for(let T=0;T<l.Data.length;T++){p+="<tr",T%2==1&&(p+=" class=alt"),p+=">";const P=l.Data[T];for(let A=0;A<l.ReportColumns.length;)l.ReportColumns[A].HeaderAppearance.IsVisible?(p+=P.Cells[A].ColSpan>1?`<td  align=${P.Cells[A].CellAppearance.Alignment} colspan=${P.Cells[A].ColSpan} `:"<td ",null!=P.Cells[A].CellAppearance&&(c=(P.Cells[A].CellAppearance.ForeColor.startsWith("#ff")||P.Cells[A].CellAppearance.ForeColor.startsWith("#FF"))&&9==P.Cells[A].CellAppearance.ForeColor.length?"#"+P.Cells[A].CellAppearance.ForeColor.substr(3):P.Cells[A].CellAppearance.ForeColor,g=(P.Cells[A].CellAppearance.BackColor.startsWith("#ff")||P.Cells[A].CellAppearance.BackColor.startsWith("#FF"))&&9==P.Cells[A].CellAppearance.BackColor.length?"#"+P.Cells[A].CellAppearance.BackColor.substr(3):P.Cells[A].CellAppearance.BackColor,p+=` style='background-color:${g} + ;color:${c}'`),p+=" >",p+=C.J0.StringValue(P.Cells[A].Value),p+="</td>",A+=P.Cells[A].ColSpan):A+=P.Cells[A].ColSpan;p+="</tr>"}return p+="</tbody>",p+="</table>",p}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-income-tax-computation"]],decls:110,vars:29,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex","padding","12px"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px 10px 0 10px"],[1,"row",2,"height","40px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"input_cntrl_label"],[1,"NoLabel",2,"margin-left","5px","width","100px"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label",2,"margin-left","10px"],[1,"NoLabel",2,"margin-left","5px","min-width","150px"],[1,"PactMasterTree","Pactpagetree",2,"height","calc(100% - 80px)","width","100%","border","1px solid rgb(204, 204, 204)"],[3,"obj"],[1,"row",2,"height","40px","margin-top","3px"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"NoLabel",2,"flex","1","margin-left","5px"],[1,"primary-btn-wicon",2,"flex","1","margin-left","5px",3,"click"],[1,"form-group","col-xl-2","col-md-2","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n  "),e.j41(2,"div",1),e.EFF(3,"\n  "),e.j41(4,"div",2),e.EFF(5,"\n     "),e.j41(6,"div",3),e.EFF(7,"\n      "),e.j41(8,"span",4),e.EFF(9),e.k0s(),e.EFF(10,"\n    "),e.k0s(),e.EFF(11,"\n    "),e.j41(12,"div",5),e.EFF(13,"\n      "),e.j41(14,"span",6),e.bIt("click",function(){return i.btnSave_Click("Save")}),e.nrm(15,"i",7),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.EFF(18,"\n      "),e.DNE(19,z,4,3,"span",8),e.EFF(20,"\n      "),e.j41(21,"span",6),e.bIt("click",function(){return i.btnSave_Click("Delete")}),e.nrm(22,"i",9),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.EFF(25,"\n      "),e.j41(26,"span",6),e.bIt("click",function(){return i.btnSave_Click("Clear")}),e.nrm(27,"i",10),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.EFF(30,"\n      "),e.DNE(31,oe,4,3,"span",11),e.EFF(32,"\n      "),e.DNE(33,Q,4,3,"span",11),e.EFF(34,"\n      "),e.DNE(35,Le,4,3,"span",11),e.EFF(36,"\n    "),e.k0s(),e.EFF(37,"\n  "),e.k0s(),e.EFF(38,"\n  "),e.j41(39,"div",12),e.EFF(40,"\n    "),e.j41(41,"div",13),e.EFF(42,"\n      "),e.j41(43,"div",14),e.EFF(44,"\n        "),e.j41(45,"label",15),e.EFF(46,"Financial Year "),e.k0s(),e.EFF(47,"\n        "),e.j41(48,"div",16),e.EFF(49,"\n          "),e.eu8(50,17),e.EFF(51,"\n        "),e.k0s(),e.EFF(52,"\n        "),e.j41(53,"label",18),e.EFF(54),e.k0s(),e.EFF(55,"\n      "),e.k0s(),e.EFF(56,"\n      "),e.j41(57,"div",14),e.EFF(58,"\n      "),e.j41(59,"label",15),e.EFF(60,"Employee "),e.k0s(),e.EFF(61,"\n      "),e.j41(62,"div",19),e.EFF(63,"\n          "),e.eu8(64,17),e.EFF(65,"\n        "),e.k0s(),e.EFF(66,"\n      "),e.k0s(),e.EFF(67,"\n      "),e.k0s(),e.EFF(68,"\n      "),e.j41(69,"div",20),e.EFF(70,"\n        "),e.nrm(71,"app-report-grid",21),e.EFF(72,"\n      "),e.k0s(),e.EFF(73,"\n      "),e.j41(74,"div",22),e.EFF(75,"\n        "),e.j41(76,"div",23),e.EFF(77,"\n          "),e.j41(78,"label",15),e.EFF(79,"Regime Opted For "),e.k0s(),e.EFF(80,"\n          "),e.j41(81,"div",24),e.EFF(82,"\n            "),e.eu8(83,17),e.EFF(84,"\n          "),e.k0s(),e.EFF(85,"\n          "),e.j41(86,"button",25),e.bIt("click",function(){return i.btnSave_Click("SaveRegime")}),e.EFF(87),e.nI1(88,"translate"),e.k0s(),e.EFF(89,"\n        "),e.k0s(),e.EFF(90,"\n        "),e.j41(91,"div",26),e.EFF(92,"\n       "),e.j41(93,"label",15),e.EFF(94,"Place"),e.k0s(),e.EFF(95,"\n        "),e.j41(96,"div",24),e.EFF(97,"\n          "),e.eu8(98,17),e.EFF(99,"\n        "),e.k0s(),e.EFF(100,"\n        "),e.j41(101,"div",24),e.EFF(102,"\n          "),e.eu8(103,17),e.EFF(104,"\n       "),e.k0s(),e.EFF(105,"\n      "),e.k0s(),e.EFF(106,"\n      \n    "),e.k0s(),e.EFF(107,"\n\n  "),e.k0s(),e.EFF(108,"\n  "),e.k0s(),e.EFF(109,"\n"),e.k0s()),2&s&&(e.R7$(9),e.SpI("\n        ",i.obj.Title,"\n      "),e.R7$(7),e.JRh(e.bMT(17,21,"Save")),e.R7$(3),e.Y8G("ngIf",i.obj.PrintVisiblility),e.R7$(4),e.JRh(e.bMT(24,23,"Delete")),e.R7$(5),e.JRh(e.bMT(29,25,"Clear")),e.R7$(3),e.Y8G("ngIf",i.obj.ExportVisiblility),e.R7$(2),e.Y8G("ngIf",i.obj.WorksheetVisiblility),e.R7$(2),e.Y8G("ngIf",i.obj.TDSPostVisiblility),e.R7$(15),e.Y8G("obj",i.obj.EmpYear)("group",i.form),e.R7$(4),e.JRh(i.obj.lFinancialDate),e.R7$(10),e.Y8G("obj",i.obj.Employee)("group",i.form),e.R7$(7),e.Y8G("obj",i.grdIncomeTax),e.R7$(12),e.Y8G("obj",i.obj.EmpRegime)("group",i.form),e.R7$(4),e.JRh(e.bMT(88,27,"SaveRegime")),e.R7$(11),e.Y8G("obj",i.txtPlace)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.dtpDate)("group",i.form))},dependencies:[_e.bT,Ae._,$.e,Ue.D9],encapsulation:2})}return G})();class Oe{constructor(){this.FromSlab=0,this.ToSlab=0,this.Percentage=0}}var Ge=W(84769);class Re{constructor(a){this.MessageVisibility=!1,this.sBMConString="",this.bUseROffTimings=!1,this.bDocColumns=!1,this.bDirection=!1,this.sBMDBAdapterAccess="",this.IsAutoPost=!1,this.dtConfig=null,this.dicConf=new ve.bT,this.BMCDeviceBrandName=ge.y$.PactComboBoxData3("BMCDeviceBrandName",10),this.BMCDatabaseType=ge.y$.PactComboBoxData3("BMCDatabaseType",10),this.BMCServerName=new Se.Dw(0),this.BMCUserId=new Se.Dw(0),this.BMCPassword=new Se.Dw(0),this.BMCDatabaseName=new Se.Dw(0),this.ETMEmpTableName=new Se.Dw(0),this.ETMEmpSeqNo=new Se.Dw(0),this.ETMEmpCode=new Se.Dw(0),this.ETMEmpCodeInDevice=new Se.Dw(0),this.ETMEmpName=new Se.Dw(0),this.ETMEmpWhere=new Se.Dw(0),this.APTMAttendPunchTableName=new Se.Dw(0),this.APTMEmpSeqNo=new Se.Dw(0),this.APTMEmpCode=new Se.Dw(0),this.APTMEmpCodeInDevice=new Se.Dw(0),this.APTMPunchDateTime=new Se.Dw(0),this.APTMDeviceNo=new Se.Dw(0),this.APTMDeviceNoValues=new Se.Dw(0),this.APTMDirection=new Se.Dw(0),this.APTMDirectionInVal=new Se.Dw(0),this.APTMDirectionOutVal=new Se.Dw(0),this.APTMAttendPunchWhere=new Se.Dw(0),this.FromDate=new u.Lc(0),this.ToDate=new u.Lc(0),this.DPCDocumentName=ge.y$.PactComboBoxData3("DPCDocumentName",10),this.ROTUseROffTimings=je.c.PactCheckBoxData_1("Use Round off Timings",10),this.GetMultipleCheckINOUTInaDay=je.c.PactCheckBoxData_1("Get Multiple Check IN/OUT in a Day",10),this.OverrideAttendanceDoc=je.c.PactCheckBoxData_1("Override Attendance Document",10),this.DonotPullBiometricDataifAttendanceisposted=je.c.PactCheckBoxData_1("Do not Pull Biometric Data if Attendance is posted",10),this.AutoPostAtaTime=je.c.PactCheckBoxData_1("AutoPost At a Time",10),this.SortBasedOn=ge.y$.PactComboBoxData3("SortBasedOn",10),this.GDBQchkUseQuery=je.c.PactCheckBoxData_1("Use Query to get the Data",10),this.GDBQtxtQuery=new Se.Dw(0),this.sFilter="",this.sSelectedEmpSeqNos="",this.sSelectedEmpCodes="",this.sbPostErrLog="",this.oDocument=null,this.bOverrideAttendanceDoc=!1,this.bDonotPullBiometricDataifAttendanceisposted=!1,this.bAutoPostAtaTime=!1,this.dtShiftsData=null,this.dtBioMetData=null,this.dsbEmps=null,this.dsbDims=null,this.sEmpSeqNosOnGrid="",this.bGetMultipleCheckInOutInaDay=!0;try{Logger.InfoLog("BiometricConfigViewModel::Entering BiometricConfigViewModel()"),this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.ShowConfigurations=!!r.d.SessionManager.IsActionAssigned(141,"Configuration"),this.Initialize(),this.subcontroller()}catch(l){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION BiometricConfigViewModel()\r\n"+l.Message+"\r\n"+l.stack)}}subcontroller(){var a=this;return(0,le.A)(function*(){yield a.LoadConfig(),a.LoadGrid(),a.DPCDocumentName.SelectionChangedCommand.Subscribe(a,"DPCDocumentNameSelectionChanged"),a.sBMConString=a.GetBMConnString(),a.ToDate.Label="To Date",a.FromDate.Label="From Date"})()}Initialize(){this.BMCDeviceBrandName.Items.Clear(),this.BMCDeviceBrandName.Items.push(ge._p.ComboBoxItems_2("***MANUAL***","1")),this.BMCDeviceBrandName.Items.push(ge._p.ComboBoxItems_2("ViRDI->AC-5000RF","2")),this.BMCDeviceBrandName.SelectedValue="1",this.BMCDatabaseType.Items.Clear(),this.BMCDatabaseType.Items.push(ge._p.ComboBoxItems_2("MS SQL Server","1")),this.BMCDatabaseType.Items.push(ge._p.ComboBoxItems_2("MS Access","2")),this.BMCDatabaseType.Items.push(ge._p.ComboBoxItems_2("API","3")),this.BMCDatabaseType.SelectedValue="1",this.DPCDocumentName.Items.Clear(),this.DPCDocumentName.Items.push(ge._p.ComboBoxItems_2("Attendance","40089")),this.DPCDocumentName.Items.push(ge._p.ComboBoxItems_2("Time Sheet","40090")),this.DPCDocumentName.Items.push(ge._p.ComboBoxItems_2("Daily Attendance","40067")),this.DPCDocumentName.Items.push(ge._p.ComboBoxItems_2("Employee wise Work Sheet","40087")),this.DPCDocumentName.SelectedValue="40090",this.SortBasedOn.Items.Clear(),this.SortBasedOn.Items.push(ge._p.ComboBoxItems_2("None","1")),this.SortBasedOn.Items.push(ge._p.ComboBoxItems_2("EmpCode","2")),this.SortBasedOn.Items.push(ge._p.ComboBoxItems_2("EmpName","3")),this.SortBasedOn.Items.push(ge._p.ComboBoxItems_2("TreeView","4")),this.SortBasedOn.Items.push(ge._p.ComboBoxItems_2("EmpCode Numeric","5")),this.SortBasedOn.SelectedValue="1",this.dgCol=new X.O7,this.dgvROffTimings=new Ye.vv,this.dgvROffTimings.Columns=[],this.dgvROffTimings.Width="",this.dgvROffTimings.AllowReorderColumns=!1,this.dgvROffTimings.CanUserResizeColumns=!0,this.dgvROffTimings.CanUserSortColumns=!1,this.dgvROffTimings.CanUserDeleteRows=!0,this.dgvROffTimings.CanUserAddRows=!0,this.dgCol=new X.O7,this.dgCol.Header="Start Time",this.dgCol.DisplayMember="StartTime",this.dgCol.ValueMember="StartTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="End Time",this.dgCol.DisplayMember="EndTime",this.dgCol.ValueMember="EndTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="ROff Time",this.dgCol.DisplayMember="ROffTime",this.dgCol.ValueMember="ROffTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgvROffTimings.Table=[],this.dgvROffTimings.TableColumns.push("StartTime"),this.dgvROffTimings.TableColumns.push("StartTime_Key"),this.dgvROffTimings.TableColumns.push("EndTime"),this.dgvROffTimings.TableColumns.push("EndTime_Key"),this.dgvROffTimings.TableColumns.push("ROffTime"),this.dgvROffTimings.TableColumns.push("ROffTime_Key"),this.dgvDocColumns=new Ye.vv,this.dgvDocColumns.Columns=[],this.dgvDocColumns.Width="",this.dgvDocColumns.AllowReorderColumns=!1,this.dgvDocColumns.CanUserResizeColumns=!0,this.dgvDocColumns.CanUserSortColumns=!1,this.dgvDocColumns.CanUserDeleteRows=!0,this.dgvDocColumns.CanUserAddRows=!1,this.dgCol=new X.O7,this.dgCol.Header="Source",this.dgCol.DisplayMember="Source",this.dgCol.ValueMember="Source_Key",this.dgCol.DataType="TextBlock",this.dgCol.ReadOnly=!0,this.dgCol.Width=150,this.dgvDocColumns.Columns.push(this.dgCol);let a=[],l=r.d.empService.GetQueryData(0,"BIO001","","","");l&&l.Tables.length>0&&(a=l.Tables[0]),this.dgCol=new X.O7,this.dgCol.Header="Destination",null!=a&&a.length>0&&(this.dgCol.ValueBinding="Destination",this.dgCol.DisplayMember="USERCOLUMNNAME",this.dgCol.ValueMember="SYSCOLUMNNAME",this.dgCol.DataType="ComboBox",this.dgCol.ReadOnly=!1,this.dgCol.Width=150,this.dvcol=a,this.dgCol.ComboData=this.dvcol,this.dgvDocColumns.Columns.push(this.dgCol)),this.dgvDocColumns.Table=[],this.dgvDocColumns.TableColumns.push("Source"),this.dgvDocColumns.TableColumns.push("Source_Key"),this.dgvDocColumns.TableColumns.push("Destination"),this.dgvDocColumns.TableColumns.push("Destination_Key")}LoadGrid(){this.dgv=new Ye.vv,this.dgv.Columns=[],this.dgv.Width="",this.dgv.HeaderHeight=40,this.dgv.AllowReorderColumns=!1,this.dgv.CanUserResizeColumns=!0,this.dgv.CanUserSortColumns=!1,this.dgv.CanUserDeleteRows=!0,this.dgv.IsReadOnly=!0,this.dgCol=new X.O7,this.dgCol.Header="#",this.dgCol.DisplayMember="SlNo",this.dgCol.ID="SlNo",this.dgCol.Width=45,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Employee Code",this.dgCol.DisplayMember="EmpCode",this.dgCol.ID="EmpCode",this.dgCol.Width=120,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Employee Name",this.dgCol.DisplayMember="EmpName",this.dgCol.ID="EmpName",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Punch Date",this.dgCol.DisplayMember="PunchDate",this.dgCol.ID="PunchDate",this.dgCol.Width=90,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Shift Code",this.dgCol.DisplayMember="ShiftCode",this.dgCol.ID="ShiftCode",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Shift Name",this.dgCol.DisplayMember="ShiftName",this.dgCol.ID="ShiftName",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Act.\nStart Time",this.dgCol.DisplayMember="ActStartTime",this.dgCol.ID="ActStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Act.\nEnd Time",this.dgCol.DisplayMember="ActEndTime",this.dgCol.ID="ActEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Act.\nTotal Hours",this.dgCol.DisplayMember="ActTotHrs",this.dgCol.ID="ActTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bUseROffTimings&&(this.dgCol=new X.O7,this.dgCol.Header="ROff\nStart Time",this.dgCol.DisplayMember="ROffStartTime",this.dgCol.ID="ROffStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="ROff\nEnd Time",this.dgCol.DisplayMember="ROffEndTime",this.dgCol.ID="ROffEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="ROff\nTotal Hours",this.dgCol.DisplayMember="ROffTotHrs",this.dgCol.ID="ROffTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&(this.dgCol=new X.O7,this.dgCol.Header=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.DisplayMember=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.ID=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bDocColumns=!0);this.dgCol=new X.O7,this.dgCol.Header="Remarks",this.dgCol.DisplayMember="Remarks",this.dgCol.ID="Remarks",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgv.Table=[],this.dgv.TableColumns.push("SlNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("PunchDate"),this.dgv.TableColumns.push("ShiftCode"),this.dgv.TableColumns.push("ShiftName"),this.dgv.TableColumns.push("ActStartTime"),this.dgv.TableColumns.push("ActEndTime"),this.dgv.TableColumns.push("ActTotHrs"),this.bUseROffTimings&&(this.dgv.TableColumns.push("ROffStartTime"),this.dgv.TableColumns.push("ROffEndTime"),this.dgv.TableColumns.push("ROffTotHrs"));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&this.dgv.TableColumns.push(this.dgvDocColumns.Table[a].Source.toString());this.dgv.TableColumns.push("Remarks"),this.dgv.TableColumns.push("Row_Background"),this.dgvFailedRecord=new Ye.vv,this.dgvFailedRecord.Columns=[],this.dgvFailedRecord.Width="",this.dgvFailedRecord.HeaderHeight=30,this.dgvFailedRecord.CanUserResizeColumns=!0,this.dgvFailedRecord.IsReadOnly=!0,this.dgCol=new X.O7,this.dgCol.Header="Attendance Date",this.dgCol.DisplayMember="AttendanceDate",this.dgCol.ID="AttendanceDate",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Code",this.dgCol.DisplayMember="Code",this.dgCol.ID="Code",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Name",this.dgCol.DisplayMember="Name",this.dgCol.ID="Name",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new X.O7,this.dgCol.Header="Message",this.dgCol.DisplayMember="Message",this.dgCol.ID="Message",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgvFailedRecord.Table=[],this.dgvFailedRecord.TableColumns.push("AttendanceDate"),this.dgvFailedRecord.TableColumns.push("Code"),this.dgvFailedRecord.TableColumns.push("Name"),this.dgvFailedRecord.TableColumns.push("Message")}dgv_BeforeRowDeleting(a){return!1}LoadConfig(){var a=this;return(0,le.A)(function*(){a.dicConf.Clear();let l=r.d.empService.GetQueryData(0,"BIO002","","","");if(l&&l.Tables.length>0&&(a.dtConfig=l.Tables[0]),null!=a.dtConfig&&a.dtConfig.length>0){for(let s=0;s<a.dtConfig.length;s++)a.dicConf.push(C.J0.String(a.dtConfig[s].Name),C.J0.String(a.dtConfig[s].Value));if(a.drc=a.dtConfig.filter(s=>"BMCDeviceBrandName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDeviceBrandName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"BMCDatabaseType"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseType.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"BMCServerName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCServerName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"BMCUserId"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCUserId.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"BMCPassword"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&""!=a.drc[0].Value.toString()){let s=yield r.d.empService.DecryptString(a.drc[0].Value.toString());a.BMCPassword.Text=s.DecryptString}if(a.drc=a.dtConfig.filter(s=>"BMCDatabaseName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpTableName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpSeqNo"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpCode"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpCodeInDevice"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ETMEmpWhere"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMAttendPunchTableName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMEmpSeqNo"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMEmpCode"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMEmpCodeInDevice"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMPunchDateTime"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMPunchDateTime.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMDeviceNo"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMDeviceNoValues"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNoValues.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMDirection"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirection.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMDirectionInVal"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionInVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMDirectionOutVal"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionOutVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"APTMAttendPunchWhere"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"DPCDocumentName"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DPCDocumentName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"GetMultipleCheckINOUTInaDay"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GetMultipleCheckINOUTInaDay.IsChecked=(0,se.yG0)(a.drc[0].Value),a.bGetMultipleCheckInOutInaDay=(0,se.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(s=>"OverrideAttendanceDoc"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.OverrideAttendanceDoc.IsChecked=(0,se.yG0)(a.drc[0].Value),a.bOverrideAttendanceDoc=(0,se.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(s=>"DonotPullBiometricDataifAttendanceisposted"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DonotPullBiometricDataifAttendanceisposted.IsChecked=(0,se.yG0)(a.drc[0].Value),a.bDonotPullBiometricDataifAttendanceisposted=(0,se.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(s=>"AutoPostAtaTime"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.AutoPostAtaTime.IsChecked=(0,se.yG0)(a.drc[0].Value),a.bAutoPostAtaTime=(0,se.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(s=>"SortBasedOn"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.SortBasedOn.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(s=>"ROTUseROffTimings"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ROTUseROffTimings.IsChecked=(0,se.yG0)(a.drc[0].Value),a.bUseROffTimings=a.ROTUseROffTimings.IsChecked),a.dgvROffTimings.Clear(),a.drc=a.dtConfig.filter(s=>"ROffTimingsXML"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsROffTimings=new C.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsROffTimings.ReadXml(a.drc[0].Value.toString());let s=new C.VB;s.LoadXml(a.drc[0].Value.toString());let i=s.SelectSingleNode("RoundOffTimings");if(null!=i){let n;if(i.childNodes.length>0)for(let d=0;d<i.childNodes.length;d++)n=a.dgvROffTimings.NewRow(),n.StartTime=i.childNodes[d].attributes.MinsFrom.value,n.StartTime_Key=i.childNodes[d].attributes.MinsFrom.value,n.EndTime=i.childNodes[d].attributes.MinsUpto.value,n.EndTime_Key=i.childNodes[d].attributes.MinsUpto.value,n.ROffTime=i.childNodes[d].attributes.ROffTime.value,n.ROffTime_Key=i.childNodes[d].attributes.ROffTime.value,a.dgvROffTimings.addRow(n)}}if(a.dgvDocColumns.Clear(),a.drc=a.dtConfig.filter(s=>"DocColumnsXML"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsDocColumns=new C.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsDocColumns.ReadXml(a.drc[0].Value.toString());let s=new C.VB;s.LoadXml(a.drc[0].Value.toString());let i=s.SelectSingleNode("DocColumns");if(null!=i){let n;if(i.childNodes.length>0)for(let d=0;d<i.childNodes.length;d++)n=a.dgvDocColumns.NewRow(),n.Source=i.childNodes[d].attributes.Source.value,n.Source_Key=i.childNodes[d].attributes.Source.value,n.Destination=i.childNodes[d].attributes.Destination.value,n.Destination_Key=i.childNodes[d].attributes.Destination.value,a.dgvDocColumns.addRow(n)}}a.drc=a.dtConfig.filter(s=>"GDBQchkUseQuery"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQchkUseQuery.IsChecked=(0,se.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(s=>"GDBQtxtQuery"==s.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQtxtQuery.Text=a.drc[0].Value.toString().Replace("[ENTER]","\r\n"))}})()}OnButtonClick(a){if(null!=a&&"BMCTestConn"!=a.toString()&&"SaveConfig"!=a.toString())if("GetData"==a.toString())this.GetData_Click();else if("PostData"==a.toString())this.PostData_Click();else if("Export"==a.toString())this.Export_Click();else if("ExportFailedRecords"==a.toString()){let l="";l+="<html><body style='color:blac;background-color:white;'>",l+="<style>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}",l+="</style>",l+="<table border=1 width='950' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >",l+="<tr><td class='hdr'><b>Sno<b></td>",l+="<td class='hdr' width='150'><b>Daily Attendance Date<b></td>",l+="<td class='hdr' width='150'><b>Code<b></td>",l+="<td class='hdr' width='150'><b>Name<b></td>",l+="<td class='hdr' width='750'><b>Message<b></td></tr>";let s=new C.VB;s.LoadXml(this.sbPostErrLog.toString());let i=s.SelectSingleNode("FailedRecord");if(null!=i&&i.childNodes.length>0)for(let n=0;n<i.childNodes.length;n++)l+="<tr",l+=">",l+="<td align='left' >"+n+"1</td>",l+="<td align='left' >"+i.childNodes[n].attributes.DADate!=null?i.childNodes[n].attributes.DADate.value:"</td>",l+="<td align='left' >"+i.childNodes[n].attributes.Code!=null?i.childNodes[n].attributes.Code.value:"</td>",l+="<td align='left' >"+i.childNodes[n].attributes.Name!=null?i.childNodes[n].attributes.Name.value:"</td>",l+="<td align='left' >"+i.childNodes[n].attributes.Error!=null?i.childNodes[n].attributes.Error.value:"</td>",l+="</tr>";l+="</table>",l+="</body>",l+="</html>"}}Filter_Click(){var a=this;return(0,le.A)(function*(){if(a.sSelectedEmpSeqNos=a.sSelectedEmpCodes="",null==a.objEmpFilter?a.objEmpFilter=new o.t("",0,11):(a.objEmpFilter.Filter=11,a.objEmpFilter.InitControls()),a.objEmpFilter.Filter>0&&(yield r.d.page.openDialog(a.objEmpFilter,gt.m,{ShowCenter:!0})),a.objEmpFilter.IsCompleted)if(a.objEmpFilter.CostCenterFilters.length>0){let l=1,s="",i="",n="";a.objEmpFilter.CostCenterFilters.forEach(h=>{if(h.CostCenterID>5e4&&(l=2,s="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)n+=" AND ",n+=i+"="+h.SelectedNodes[0].Id;else if(null==h.SelectedNodes.find(g=>g.Id==l&&g.IsGroup))if(n+=" AND ",ht.IPrefetchFilter.IsGroupTree(h)){let g="";for(let D=0;D<h.SelectedNodes.length;D++)(null==h.SelectedNodes[D].Parent||!h.SelectedNodes[D].Parent.IsSelected)&&(g.length>0&&(g+=","),g+=h.SelectedNodes[D].Id);0==g.length&&(g+=-12912),n+=i+" IN ",n+=" (select T."+s+" GTID from ",n+=ze.A.GetTagTableName(h.CostCenterID)+" T with(nolock),",n+=ze.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+s+" IN (",n+=g.toString()+")  group by T."+s+")"}else{n+=i+" IN (";for(let g=0;g<h.SelectedNodes.length;g++)g>0&&(n+=","),n+=h.SelectedNodes[g].Id;n+=")"}}else h.DeleteButtonVisibility||(n+=" AND ",n+=i+"=-12912")}),a.sFilter=n.toString(),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let d=[];if(d.push(a.ToDate.Date.ToString("dd MMM yyyy")),d.push(a.sFilter),d.push(0),d.push(r.d.SessionManager.RoleID),d.push(r.d.SessionManager.UserID),d.push(r.d.SessionManager.LanguageID),a.dtFiltEmps=r.d.common.GetDataSet_SP(d,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let h=0;h<a.dtFiltEmps.length;h++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[h].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[h].EmpCode.toString()+"'"}else a.objEmpFilter.Filter>0&&a.FilterEmployees()})()}FilterEmployees(){try{Logger.InfoLog("BiometricConfigViewModel::Entering FilterEmployees()"),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),C.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let a=[];if(a.push(this.ToDate.Date.ToString("dd MMM yyyy")),a.push(this.sFilter),a.push(0),a.push(r.d.SessionManager.RoleID),a.push(r.d.SessionManager.UserID),a.push(r.d.SessionManager.LanguageID),this.dtFiltEmps=r.d.common.GetDataSet_SP(a,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=this.dtFiltEmps&&this.dtFiltEmps.length>0)for(let l=0;l<this.dtFiltEmps.length;l++)this.sSelectedEmpSeqNos.length>0&&(this.sSelectedEmpSeqNos+=",",this.sSelectedEmpCodes+=","),this.sSelectedEmpSeqNos+=this.dtFiltEmps[l].EmpSeqNo.toString(),this.sSelectedEmpCodes+="'"+this.dtFiltEmps[l].EmpCode.toString()+"'";Logger.InfoLog("BiometricConfigViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION FilterEmployees()\r\n"+a.Message+"\r\n"+a.stack)}}Export_Click(){}PostData_Click(){lt.RibbonExtViewModel.GetPay_BioPostData(this)}GetGroupByFilterEmployees(){let a="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",l=[];return l.push(this.ToDate.Date.ToString("dd MMM yyyy")),l.push(a),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),r.d.common.GetDataSet_SP(l,"spPAY_GetEmpMasterCCDetails").Tables[0]}CreateSQLTable(a,l){let s="",i="",n="";s=" CREATE TABLE "+a+"(";for(let d=0;d<l.Columns.length;d++){switch(n="",i=l.Columns[d].DataType.toString(),i){case"System.Int32":n=" int ";break;case"System.Int64":n=" bigint ";break;case"System.Int16":n=" smallint ";break;case"System.Byte":n=" tinyint ";break;case"System.Decimal":n=" float ";break;case"System.DateTime":n=" datetime ";break;case"System.String":n=C.J0.Format(" nvarchar({0}) ",-1==l.Columns[d].MaxLength?"max":l.Columns[d].MaxLength.toString())}""!=n?(s+="\n ["+l.Columns[d].ColumnName+"] ",s+=n,s+=","):(l.Columns.Remove(l.Columns[d].ColumnName),l.AcceptChanges(),d--)}return s.substr(0,s.length-1)+"\n)"}BulkInsertData(a,l){}GetShiftsAssignedData(){let l=r.d.empService.GetQueryData(0,"BIO003",r.d.SessionManager.Preferences.ShiftAssignBasedOn,this.FromDate.Date.ToString("dd MMM yyyy"),this.ToDate.Date.ToString("dd MMM yyyy"));l&&l.Tables.length>0&&(this.dtShiftsData=l.Tables[0])}GetBioMetricData(){this.dicConf.APTMAttendPunchTableName=this.dicConf.APTMAttendPunchTableName.Replace("@Month",this.FromDate.Date.iMonth().toString()).Replace("@Year",this.FromDate.Date.getFullYear().toString());let a="\n        Select EmpCode, EmpName, CONVERT(VARCHAR(11), PunchTime, 106) as PunchDate, PunchTime, CONVERT(VARCHAR(8), PunchTime, 108) as PTime ";this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=",DeviceNo as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,Direction as Direction",this.bDirection=!0),a+=" FROM ( Select EMP."+this.dicConf.ETMEmpCode+" as EmpCode, EMP."+this.dicConf.ETMEmpName+" as EmpName, ",a+=" AP."+this.dicConf.APTMPunchDateTime+" as PunchTime ",this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDeviceNo+" as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDirection+" as Direction "),a+=" From "+this.dicConf.APTMAttendPunchTableName+" AP WITH(NOLOCK)",""!=this.dicConf.APTMEmpSeqNo?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpSeqNo+"=AP."+this.dicConf.APTMEmpSeqNo+" ":""!=this.dicConf.APTMEmpCode?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCode+"=AP."+this.dicConf.APTMEmpCode:""!=this.dicConf.APTMEmpCodeInDevice&&(a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCodeInDevice+"=AP."+this.dicConf.APTMEmpCodeInDevice),a+=" WHERE 1=1 ",this.sSelectedEmpCodes.Trim().length>0&&(a+=" AND EMP."+this.dicConf.ETMEmpCode+" IN ("+this.sSelectedEmpCodes+") "),this.dicConf.ETMEmpWhere.Trim().length>0&&(a+=" AND "+this.dicConf.ETMEmpWhere),this.dicConf.APTMAttendPunchWhere.Trim().length>0&&(a+=" AND "+this.dicConf.APTMAttendPunchWhere),this.dicConf.APTMDeviceNo.Trim().length>0&&this.dicConf.APTMDeviceNoValues.Trim().length>0&&(a+=" AND AP."+this.dicConf.APTMDeviceNo+" IN("+this.dicConf.APTMDeviceNoValues+")"),a+=" AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+"')<=0 AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"')>=0\n) as tbl\n        Order By PunchTime, EmpCode ";let l=[];l.push(this.BMCDatabaseType.SelectedValue),l.push(this.BMCServerName.Text.Trim()),l.push(this.BMCDatabaseName.Text.Trim()),l.push(this.BMCUserId.Text.Trim()),l.push(this.BMCPassword.Text);let s=r.d.empService.ReportDataSet("RPT022",!0,a,"","","","",l);this.dtBioMetData=s.Tables[0]}GetData_Click(){var a=this;return(0,le.A)(function*(){let l=0;if(a.sEmpSeqNosOnGrid="",a.ListVisbility=!1,yield a.LoadConfig(),a.IsAutoPost){let h=[];if(h.push(a.ToDate.Date.ToString("dd MMM yyyy")),h.push(a.sFilter),h.push(0),h.push(r.d.SessionManager.RoleID),h.push(r.d.SessionManager.UserID),h.push(r.d.SessionManager.LanguageID),a.dtFiltEmps=r.d.common.GetDataSet_SP(h,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let c=0;c<a.dtFiltEmps.length;c++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[c].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[c].EmpCode.toString()+"'"}else yield a.Filter_Click();if(a.FromDate.Date>a.ToDate.Date)return a.DisplayMessage="'From Date' should be less than or Equal to 'To Date'",void(a.MessageVisibility=!0);if(0==a.sSelectedEmpCodes.length)return a.DisplayMessage="No Employees found",void(a.MessageVisibility=!0);a.DispMessage="Loading data, Please wait....",a.MsgVisibility=!0;let s="";for(let h=0;h<a.dgvDocColumns.Table.length;h++)null!=a.dgvDocColumns.Table[h].Destination&&null!=a.dgvDocColumns.Table[h].Destination&&""!=a.dgvDocColumns.Table[h].Destination.toString()&&"-1"!=a.dgvDocColumns.Table[h].Destination.toString()&&a.dgvDocColumns.Table[h].Destination.toString().startsWith("dcCCNID")&&(s.length>0&&(s+=","),s+=(5e4+parseInt(a.dgvDocColumns.Table[h].Destination.toString().Replace("dcCCNID",""))).toString());s.length>0&&(a.dsbDims=r.d.empService.GetQueryData(0,"BIO007",JSON.stringify(s),"",""));let i="";if(a.dsbEmps=r.d.empService.GetQueryData(0,"BIO004","","",""),a.dgv.Clear(),a.GDBQchkUseQuery.IsChecked&&a.GDBQtxtQuery.Text.Trim().length>0){let h=[],c="";if("1"==a.BMCDatabaseType.SelectedValue){c=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","'"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@TODATE@","'"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=r.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}else if("2"==a.BMCDatabaseType.SelectedValue){c=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","#"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@TODATE@","#"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=r.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}if(null!=h&&h.Tables.length>0&&h.Tables[0].length>0){let g,D;l=0;for(let p=0;p<h.Tables[0].length;p++)D=a.dsbEmps.Tables[0].filter(t=>t.Code==h.Tables[0][p].EmpCode.toString()),null!=D&&D.length>0&&(a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=D[0].NodeID.toString(),l++,g=a.dgv.NewRow(),g.SlNo=l.toString(),g.EmpCode=h.Tables[0][p].EmpCode,g.EmpName=h.Tables[0][p].EmpName,g.PunchDate=new Date(h.Tables[0][p].PunchDate).ToString("dd/MMM/yyyy"),g.ShiftCode=h.Tables[0][p].ShiftCode,g.ShiftName=h.Tables[0][p].ShiftName,h.Tables[0][p].StartTime.toString().Contains(".")||(h.Tables[0][p].StartTime=h.Tables[0][p].StartTime.toString().Contains(":")?h.Tables[0][p].StartTime.toString().Replace(":","."):h.Tables[0][p].StartTime.toString()+".0"),g.ActStartTime=new Date(h.Tables[0][p].StartTime.toString().Replace(".",":")).ToString("HH:mm"),h.Tables[0][p].EndTime.toString().Contains(".")||(h.Tables[0][p].EndTime=h.Tables[0][p].EndTime.toString().Contains(":")?h.Tables[0][p].EndTime.toString().Replace(":","."):h.Tables[0][p].EndTime.toString()+".0"),g.ActEndTime=new Date(h.Tables[0][p].EndTime.toString().Replace(".",":")).ToString("HH:mm"),g.ActTotHrs=parseFloat(h.Tables[0][p].TotHrs).ToString("00.00"),0==parseFloat(g.ActTotHrs)&&(g.Row_Background="#F77B7E"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(g["IN Device No"]=h.Tables[0][p].INDeviceNo),a.dgv.TableColumns.Contains("OUT Device No")&&(g["OUT Device No"]=h.Tables[0][p].OUTDeviceNo)),g.Remarks="",a.dgv.addRow(g));a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0;return}if("2"==a.BMCDatabaseType.SelectedValue){a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim();let g="";g=" SELECT * FROM "+a.dicConf.ETMEmpTableName,a.dicConf.APTMAttendPunchTableName=a.dicConf.APTMAttendPunchTableName.Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString()),g=" SELECT * FROM "+a.dicConf.APTMAttendPunchTableName+" WHERE DateValue("+a.dicConf.APTMPunchDateTime+") BETWEEN #"+a.FromDate.Date.AddDays(-1).ToString("dd/MMM/yyyy")+"# AND #"+a.ToDate.Date.AddDays(1).ToString("dd/MMM/yyyy")+"#"}"3"==a.BMCDatabaseType.SelectedValue&&(a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim());let n=[],d=!1;if(""!=a.dicConf.ETMEmpTableName.Trim()&&""!=a.dicConf.APTMAttendPunchTableName.Trim()){if(null!=a.dtFiltEmps&&a.dtFiltEmps.length>0){if(a.GetShiftsAssignedData(),null==a.dtShiftsData||0==a.dtShiftsData.length)return a.MsgVisibility=!1,a.DisplayMessage="Enter atlest one Shift Assign document for Default Employee",void(a.MessageVisibility=!0);let c=r.d.SessionManager.Preferences.ShiftAssignBasedOn;a.GetBioMetricData();let g=[];g.push("EmpSeqNo"),g.push("EmpCode"),g.push("EmpName"),g.push("PunchDate"),g.push("StartTime"),g.push("EndTime"),g.push("TotHrs"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&g.push("IN Device No"),a.dgv.TableColumns.Contains("OUT Device No")&&g.push("OUT Device No")),g.push("Remarks"),g.push("lfts"),g.push("EmpCodeNumeric");let t,T,P,A,_,x,F,D=a.FromDate.Date.OnlyDate(),p=a.ToDate.Date.OnlyDate(),j=null,f="",E="",N=!1,ee=0,q=0;l=0;let H=a.dtBioMetData.ToTable(!0,["EmpCode","EmpName"]);if(null!=H&&H.length>0){let V=null,ie="";for(let Ne=0;Ne<H.length;Ne++)P=a.dtFiltEmps.filter(v=>v.EmpCode==H[Ne].EmpCode.toString()),null!=P&&P.length>0&&(ie.length>0&&(ie+=","),ie+=P[0].EmpSeqNo.toString());if("-2"!=c){let Ne=[];Ne.push(p.ToString("dd MMM yyyy")),Ne.push(" AND EmpSeqNo IN("+ie+")"),Ne.push(0),Ne.push(r.d.SessionManager.RoleID),Ne.push(r.d.SessionManager.UserID),Ne.push(r.d.SessionManager.LanguageID),V=r.d.common.GetDataSet_SP(Ne,"spPAY_GetEmpMasterCCDetails").Tables[0]}a.bDonotPullBiometricDataifAttendanceisposted&&(i="",40067==parseInt(a.DPCDocumentName.SelectedValue)||40087==parseInt(a.DPCDocumentName.SelectedValue)?i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tDocumentType = 67 AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+ie+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') ":(40089==parseInt(a.DPCDocumentName.SelectedValue)||40090==parseInt(a.DPCDocumentName.SelectedValue))&&(i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tCostCenterID = "+parseInt(a.DPCDocumentName.SelectedValue)+" AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+ie+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') "),i.Trim().length>0&&(j=r.d.empService.GetQueryData(parseInt(a.DPCDocumentName.SelectedValue),"BIO008",JSON.stringify(ie),a.FromDate.Date.ToString("dd/MMM/yyyy"),a.ToDate.Date.ToString("dd/MMM/yyyy"))));let me=null,ce=null;for(;D<=p;){for(let Ne=0;Ne<H.length;Ne++){if(d=!1,P=a.dtFiltEmps.filter(Ie=>Ie.EmpCode==H[Ne].EmpCode.toString()),null!=P&&P.length>0){if(D<C.J0.ParseDate(P[0].DOJ))continue;E=P[0].EmpSeqNo.toString(),ee=parseInt(P[0].lft)}if(a.bDonotPullBiometricDataifAttendanceisposted&&null!=j&&j.length>0&&(_=j.filter(Ie=>Ie.EmpSeqNo==E&&Ie.DADate==D.ToString("dd/MMM/yyyy")),null!=_&&_.length>0))continue;l++,t={},t.SNo=l.toString(),t.EmpSeqNo=E,t.lfts=ee,null!=a.SortBasedOn.SelectedValue&&"5"==a.SortBasedOn.SelectedValue&&(q=0,q=C.J0.Int(H[Ne].EmpCode),t.EmpCodeNumeric=q>0?q:0),t.EmpCode=H[Ne].EmpCode,t.EmpName=H[Ne].EmpName,t.PunchDate=D.ToString("dd/MMM/yyyy"),N=!1;let v="",we=a.dtShiftsData;if("-2"==c)v="EmpSeqNo IN(1,"+E+") ",we=we.filter(Ie=>1==Ie.EmpSeqNo||Ie.EmpSeqNo==E);else{let Ie="",de=c.split(",");if(null!=de&&de.length>0){let Ve=V.filter(ne=>ne.EmpSeqNo==E);for(let ne=0;ne<de.length;ne++)null!=de[ne]&&""!=de[ne]&&(Ie="-2"==de[ne]?"EmpSeqNo":"dcCCNID"+(parseInt(de[ne])-5e4),v.length>0&&(v+=" AND "),v+=Ie+"="+Ve[0][Ie.Replace("dcCCNID","CCNID")],we=we.filter(ke=>ke[Ie]==Ve[0][Ie.Replace("dcCCNID","CCNID")]))}}if(f=v+" AND AssigningFrom <='"+D.ToString("dd/MMM/yyyy")+"' AND AssigningUpto >='"+D.ToString("dd/MMM/yyyy")+"'",we=we.filter(Ie=>null!=Ie.AssigningFrom&&new Date(Ie.AssigningFrom.ToString("dd/MMM/yyyy"))<=D&&null!=Ie.AssigningUpto&&new Date(Ie.AssigningUpto.ToString("dd/MMM/yyyy"))>=D),P=we,P.sort((Ie,de)=>Ie.DocID>de.DocID||Ie.DocID==de.DocID&&Ie.EmpSeqNo>de.EmpSeqNo?1:-1),null!=P&&P.length>0){let Ie=(new Date).OnlyDate();if(x=C.J0.ParseDate(Ie.ToString("dd/MMM/yyyy")+" "+P[0].ShiftBMStartTime),F=C.J0.ParseDate(Ie.ToString("dd/MMM/yyyy")+" "+P[0].ShiftBMEndTime),x>F?(x=D.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=D.AddDays(1).AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())):(x=D.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=D.AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())),f="EmpCode='"+t.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"'",A=a.dtBioMetData.filter(de=>de.EmpCode==t.EmpCode.toString()&&new Date(de.PunchTime)>=x&&new Date(de.PunchTime)<=F),A.sort((de,Ve)=>de.PunchTime-Ve.PunchTime),!(null!=A&&A.length>0))continue;if(1==A.length)t.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),t.EndTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),F=x,a.bDirection&&(t.Remarks=a.APTMDirectionInVal.Text==A[0].Direction.toString()?"Check-Out Missing":"Check-In Missing"),g.Contains("IN Device No")&&(t["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(t["OUT Device No"]=A[0].DeviceNo.toString());else if(a.bDirection){let de=!1,Ve=!1;if(a.bGetMultipleCheckInOutInaDay){for(let ne=0;ne<A.length;ne++){de=!1,Ve=!1,T={};for(let ke=0;ke<t.ItemArray.length;ke++)T[ke]=t[ke];a.APTMDirectionInVal.Text==A[ne].Direction.toString()&&(T.StartTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[ne].DeviceNo.toString()),de=!0),a.APTMDirectionOutVal.Text==A[ne].Direction.toString()&&(T.EndTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ne].DeviceNo.toString()),Ve=!0),(de||Ve)&&(A.length>ne+1?(de&&(a.APTMDirectionOutVal.Text==A[ne+1].Direction.toString()?(T.EndTime=new Date(A[ne+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ne+1].DeviceNo.toString()),ne++):(T.EndTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ne].DeviceNo.toString()),T.Remarks="Check-Out Missing",F=x)),Ve&&(T.StartTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[ne].DeviceNo.toString()),T.Remarks="Check-In Missing",F=x)):(de&&(T.EndTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ne].DeviceNo.toString()),T.Remarks="Check-Out Missing",F=x),Ve&&(T.StartTime=new Date(A[ne].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[ne].DeviceNo.toString()),T.Remarks="Check-In Missing",F=x)),x=new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()),T.TotHrs=lt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),n.push(T))}N=!0}else{if(f="EmpCode='"+t.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionInVal.Text+"'",me=a.dtBioMetData.filter(ne=>ne.EmpCode==t.EmpCode.toString()&&new Date(ne.PunchTime)>=x&&new Date(ne.PunchTime)<=F&&ne.Direction==a.APTMDirectionInVal.Text),me.sort((ne,ke)=>ne.PunchTime-ke.PunchTime),null!=me&&me.length>0&&(de=!0,t.StartTime=new Date(me[0].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(t["IN Device No"]=me[0].DeviceNo.toString())),f="EmpCode='"+t.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionOutVal.Text+"'",ce=a.dtBioMetData.filter(ne=>ne.EmpCode==t.EmpCode.toString()&&new Date(ne.PunchTime)>=x&&new Date(ne.PunchTime)<=F&&ne.Direction==a.APTMDirectionInVal.Text),ce.sort((ne,ke)=>ne.PunchTime-ke.PunchTime),null!=ce&&ce.length>0&&(de?new Date(ce[ce.length-1].PunchTime)>new Date(me[0].PunchTime)&&(Ve=!0,t.EndTime=new Date(ce[ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(t["OUT Device No"]=ce[ce.length-1].DeviceNo.toString())):(Ve=!0,t.EndTime=new Date(ce[ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(t["OUT Device No"]=ce[ce.length-1].DeviceNo.toString()))),!de&&!Ve)continue;(!de||!Ve)&&(F=x,de?(t.EndTime=new Date(me[0].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(t["OUT Device No"]=me[0].DeviceNo.toString()),t.Remarks="Check-Out Missing"):(t.StartTime=new Date(ce[ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(t["IN Device No"]=ce[ce.length-1].DeviceNo.toString()),t.Remarks="Check-In Missing"))}}else if(a.bGetMultipleCheckInOutInaDay&&A.length>2){for(let de=0;de<A.length;de+=2){T={};for(let Ve=0;Ve<t.ItemArray.length;Ve++)T[Ve]=t[Ve];T.StartTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[de].DeviceNo.toString()),de==A.length-1?(T.EndTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[de].DeviceNo.toString())):(T.EndTime=new Date(A[de+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[de+1].DeviceNo.toString())),x=new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()),T.TotHrs=lt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),n.push(T)}N=!0}else t.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),t.EndTime=new Date(A[A.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(t["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(t["OUT Device No"]=A[A.length-1].DeviceNo.toString());N||(x=new Date(x.ToString("dd/MMM/yyyy")+" "+t.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+t.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+t.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+t.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+t.EndTime.toString()),t.TotHrs=lt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F))}else{if(!a.IsAutoPost)return a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+H[Ne].EmpCode,void(a.MessageVisibility=!0);a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+H[Ne].EmpCode,a.MessageVisibility=!0,d=!0}d||N||n.push(t)}D=D.AddDays(1)}}}if(l=0,n.length>0){let c,g,D="";null!=a.SortBasedOn.SelectedValue&&"1"!=a.SortBasedOn.SelectedValue&&("2"==a.SortBasedOn.SelectedValue?D="EmpCode":"3"==a.SortBasedOn.SelectedValue?D="EmpName":"4"==a.SortBasedOn.SelectedValue?D="lfts":"5"==a.SortBasedOn.SelectedValue&&(D="EmpCodeNumeric"));for(let p=0;p<n.length;p++){if(g=a.dsbEmps.Tables[0].filter(T=>T.Code==n[p].EmpCode.toString()),!(null!=g&&g.length>0))continue;a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=g[0].NodeID.toString(),l++;let t=(new Date).OnlyDate();if(c=a.dgv.NewRow(),c.SlNo=l.toString(),c.EmpCode=n[p].EmpCode,c.EmpName=n[p].EmpName,c.PunchDate=new Date(n[p].PunchDate).ToString("dd/MMM/yyyy"),c.ActStartTime=C.J0.ParseDate(t.ToString("dd/MMM/yyyy")+" "+n[p].StartTime).ToString("HH:mm"),c.ActEndTime=C.J0.ParseDate(t.ToString("dd/MMM/yyyy")+" "+n[p].EndTime).ToString("HH:mm"),c.ActTotHrs=n[p].TotHrs,a.bUseROffTimings){let T,P,A,x,_=0;if(T=C.J0.ParseDate(t.ToString("dd/MMM/yyyy")+" "+c.ActStartTime),P=C.J0.ParseDate(t.ToString("dd/MMM/yyyy")+" "+c.ActEndTime),null!=a.dsROffTimings.Tables.ROffRow&&(x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=T.ToString("HH:mm")&&T.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(T=new Date(T.getFullYear(),T.iMonth(),T.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0)),x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=P.ToString("HH:mm")&&P.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(P=new Date(P.getFullYear(),P.iMonth(),P.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0))),c.ROffStartTime=T.ToString("HH:mm"),c.ROffEndTime=P.ToString("HH:mm"),_=0,A=P.Subtract(T),T>P){c.ROffTotHrs="00.00",c.Row_Background="#F77B7E";continue}A=P.Subtract(T),_=parseFloat(A.Hours.ToString("00")+"."+A.Minutes.ToString("00")),c.ROffTotHrs=_.ToString("00.00")}a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(c["IN Device No"]=n[p]["IN Device No"].toString()),a.dgv.TableColumns.Contains("OUT Device No")&&(c["OUT Device No"]=n[p]["OUT Device No"].toString())),0==parseFloat(c.ActTotHrs)&&(c.Row_Background="#F77B7E"),c.Remarks=C.J0.String(n[p].Remarks),a.dgv.addRow(c)}a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0}})()}GetBMConnString(){return"1"==this.BMCDatabaseType.SelectedValue?"Data Source="+this.BMCServerName.Text.Trim()+";Initial Catalog="+this.BMCDatabaseName.Text.Trim()+";Persist Security Info=True;User ID="+this.BMCUserId.Text.Trim()+";Password="+this.BMCPassword.Text:""}}var Te=W(13816);function Pe(G,a){if(1&G&&(e.j41(0,"div",20),e.EFF(1,"\n                            "),e.j41(2,"app-PactGridView",21),e.EFF(3,"\n                            "),e.k0s(),e.EFF(4,"\n                        "),e.k0s()),2&G){const l=e.XpG();e.R7$(2),e.Y8G("obj",l.obj.dgv)("group",l.form)}}function Ze(G,a){if(1&G&&(e.qex(0),e.EFF(1,"\n                                "),e.j41(2,"app-PactGridView",21),e.EFF(3,"\n                                "),e.k0s(),e.EFF(4,"\n                            "),e.bVm()),2&G){const l=e.XpG();e.R7$(2),e.Y8G("obj",l.obj.dgvFailedRecord)("group",l.form)}}let et=(()=>{class G{constructor(){this.form=new ye.gE({})}ngOnInit(){this.params?.obj&&(this.obj=this.params.obj)}static#e=this.\u0275fac=function(s){return new(s||G)};static#t=this.\u0275cmp=e.VBU({type:G,selectors:[["app-biometric-config-view-model"]],decls:64,vars:17,consts:[["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-export"],[1,"document-screen","main_div"],[1,"PACTTabFields","pagesection-noborder","tab_content","tab-exrafields","custom_accordion",2,"height","100%"],[1,"master-tab-container",2,"width","100%","height","98%"],["heading","Data",3,"removable"],[1,"row","form-row",2,"width","100%","margin-left","10px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"overflow","scroll"],[4,"ngIf"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.EFF(1,"\n    "),e.j41(2,"div",1),e.EFF(3,"\n        "),e.j41(4,"div",2),e.EFF(5,"\n            "),e.j41(6,"span",3),e.EFF(7),e.k0s(),e.EFF(8,"\n\n        "),e.k0s(),e.EFF(9,"\n        "),e.j41(10,"div",4),e.EFF(11,"\n            "),e.j41(12,"span",5),e.bIt("click",function(){return i.obj.OnButtonClick("GetData")}),e.nrm(13,"i",6),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.EFF(16,"\n            "),e.j41(17,"span",5),e.bIt("click",function(){return i.obj.OnButtonClick("PostData")}),e.nrm(18,"i",7),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.EFF(21,"\n            "),e.j41(22,"span",5),e.bIt("click",function(){return i.obj.OnButtonClick("Export")}),e.nrm(23,"i",8),e.EFF(24),e.nI1(25,"translate"),e.k0s(),e.EFF(26,"\n        "),e.k0s(),e.EFF(27,"\n    "),e.k0s(),e.EFF(28,"\n\n    "),e.j41(29,"div",9),e.EFF(30,"\n\n        "),e.j41(31,"div",10),e.EFF(32,"\n            "),e.j41(33,"tabset",11),e.EFF(34,"\n                "),e.j41(35,"tab",12),e.EFF(36,"\n                    "),e.j41(37,"div",13),e.EFF(38,"\n                        "),e.j41(39,"div",14),e.EFF(40,"\n                            "),e.eu8(41,15),e.EFF(42,"\n                        "),e.k0s(),e.EFF(43,"\n                        "),e.j41(44,"div",14),e.EFF(45,"\n                            "),e.eu8(46,15),e.EFF(47,"\n                        "),e.k0s(),e.EFF(48,"\n                    "),e.k0s(),e.EFF(49,"\n                    "),e.j41(50,"div",16),e.EFF(51,"\n                        "),e.DNE(52,Pe,5,2,"div",17),e.EFF(53,"\n                        "),e.j41(54,"div",18),e.EFF(55,"\n                            "),e.DNE(56,Ze,5,2,"ng-container",19),e.EFF(57,"\n\n                        "),e.k0s(),e.EFF(58,"\n                    "),e.k0s(),e.EFF(59,"\n                "),e.k0s(),e.EFF(60,"\n            "),e.k0s(),e.EFF(61,"\n        "),e.k0s(),e.EFF(62,"\n    "),e.k0s(),e.EFF(63,"\n"),e.k0s()),2&s&&(e.R7$(7),e.SpI("\n                ",i.obj.Title,"\n            "),e.R7$(7),e.JRh(e.bMT(15,11,"Get Data")),e.R7$(5),e.JRh(e.bMT(20,13,"Post")),e.R7$(5),e.JRh(e.bMT(25,15,"Export")),e.R7$(11),e.Y8G("removable",!1),e.R7$(6),e.Y8G("obj",i.obj.FromDate)("group",i.form),e.R7$(5),e.Y8G("obj",i.obj.ToDate)("group",i.form),e.R7$(6),e.Y8G("ngIf",i.obj.dgv),e.R7$(4),e.Y8G("ngIf",i.obj.ListVisbility))},dependencies:[_e.bT,Ae._,Qe.X,Te.V6,Te.fw,Ue.D9]})}return G})();class fe{static LoadPayrollScreen(a,l){if(50054!=a.FeatureID)if(256==a.FeatureID){let s=new b.SetPayrollDateViewModel;r.d.page.ShowDialog(s,qe.SetPayrollDateComponent,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")})}else if(258==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof Lt);if(s)r.d.page.SetActiveTab(s);else{let i=new Lt(l);i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:zt,params:{obj:i}})}}else if(260==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof rt);if(s)r.d.page.SetActiveTab(s);else{let i=new rt(l);i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:$e,params:{obj:i}})}}else if(261==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof Vt.N);if(s)r.d.page.SetActiveTab(s);else{let i=new Vt.N(l);i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:la,params:{obj:i}})}}else if(262==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof _t);if(s)r.d.page.SetActiveTab(s);else{let i=new _t;i.Title=i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:y,params:{obj:i}})}}else if(263!=a.FeatureID)if(264==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof k);if(s)r.d.page.SetActiveTab(s);else{let i=new k;i.IncomeTaxComputationViewModel(),i.Title=i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:Me,params:{obj:i}})}}else if(40095==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof It.FinalSettlementViewModel);if(s)r.d.page.SetActiveTab(s);else{let i=new It.FinalSettlementViewModel(l);i.FinalSettlementViewModel_1().then(n=>{1==i.DialogResult&&(i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:ia.FinalSettlementComponent,params:{obj:i}}))})}}else if(141==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof Re);if(s)r.d.page.SetActiveTab(s);else{let i=new Re(l);i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:et,params:{obj:i}})}}else if(266==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof Ot);if(s)r.d.page.SetActiveTab(s);else{let i=new Ot(l);i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:aa,params:{obj:i}})}}else if(267!=a.FeatureID)if(40054==a.FeatureID){let s=r.d.page.tabs.find(i=>i.params?.obj instanceof He.MonthlyPayrollViewModel);if(s)r.d.page.SetActiveTab(s);else{let i=new He.MonthlyPayrollViewModel(a.ScreenName,"");i.DisplayName=l,r.d.page.addNewTab({title:a.ScreenName,component:Dt.MonthlyPayrollComponent,params:{obj:i}})}}else if(40088!=a.FeatureID&&"4101"===a.FeatureActionID.toString())return{component:We.TreeViewPageComponent,params:{ScreenName:a.ScreenName,FeatureActionID:a.FeatureActionID,CostCenterID:a.FeatureID,Call:"C3"},basedon:"CostCenterID"};return{}}static LoadMonthlyPayrolByVoucherNo(a,l){return new He.MonthlyPayrollViewModel(a,"",l)}static GetAppraisal(a){let A,l=0,s=0,i=0,n=0,d=!1,c="",g="",D="",p=new Date,t=new Date,T=new Date,P=a.ToTable(!0,["EmpSeqNo"]);if(null!=P&&P.length>0)for(let _=0;_<P.length;_++)if(null!=P[_].EmpSeqNo&&null!=P[_].EmpSeqNo&&""!=P[_].EmpSeqNo.toString()&&(l=parseInt(P[_].EmpSeqNo),A=a.filter(x=>x.EmpSeqNo==l),null!=A&&A.length>0)){p=new Date(A[0].EffectFrom),t=new Date(A[0].ApplyFrom),T=new Date(A[0].NextAppraisalDate),null!=A[0].Remarks&&null!=A[0].Remarks&&(c=A[0].Remarks.toString()),null!=A[0].Reason&&null!=A[0].Reason&&(g=A[0].Reason.toString());let x=r.d.common.GetDataSet3("BULK004",l.toString(),p.getMonth().toString(),p.getFullYear().toString());i=null!=x&&x.Tables.length>0&&x.Tables[0].length>0?parseInt(x.Tables[0][0].SeqNo):0;let F=new Ge.X(null,l,new Date,i);F.isFromBulkAppraisals=!0,F.EffectFrom.Date=p,F.ActAppraisalFrom.Date=t,F.NextAppraisal.Date=T,F.Remarks.Text=c,F.Reason.Text=g;for(let j=0;j<A.length;j++){if(s=parseInt(A[j].ComponentID),n=parseFloat(A[j].Amt),d=!1,null!=x&&x.Tables.length>1&&x.Tables[1].length>0){let f=x.Tables[1].filter(E=>"BasicMonthlyFld"==E.prefname);null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&s==parseInt(f[0].prefvalue.toString())&&(F.BasicMonthly.Text=n.toString(),d=!0),f=x.Tables[1].filter(E=>"AnnualCTCFld"==E.prefname),null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&s==parseInt(f[0].prefvalue.toString())&&(F.AnnualCTC.Text=n.toString(),d=!0)}for(let f=0;f<F.dgvEarnings.Table.length;f++)if(F.dgvEarnings.Table[f].EarComponentID.toString()==s.toString()){F.dgvEarnings.Table[f].EarValue=n,d=!0;break}if(!d)for(let f=0;f<F.dgvDeductions.Table.length;f++)if(F.dgvDeductions.Table[f].DedComponentID.toString()==s.toString()){F.dgvDeductions.Table[f].DedValue=n;break}}F.ExecuteFormulas(),F.OnButtonClick("Save"),null!=F.DisplayMessage&&F.DisplayMessage.length>0||F.strUpdate.length>0&&(D+=F.strUpdate)}return D}static LoadFinalSettlementByVoucherNo(a,l){return new It.FinalSettlementViewModel(a,l)}static ShowQuickAdd_Payroll(a,l){return(0,le.A)(function*(){if(50051==a){const{AddEditEmpMasterComponent:s}=yield W.e(2742).then(W.bind(W,12742)),{AddEditEmpMasterViewModel:i}=yield Promise.resolve().then(W.bind(W,76412));let d={obj:new i(l,0,0,"",!1)};r.d.page.addNewTab({title:"",component:s,params:d})}})()}}}}]);