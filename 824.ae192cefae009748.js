"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[824],{39559:(Xt,Ze,J)=>{J.d(Ze,{h:()=>ie});class ie{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}},54004:(Xt,Ze,J)=>{J.r(Ze),J.d(Ze,{FinalSettlementComponent:()=>da});var ie=J(89417),f=J(86739),Le=J(31820),d=J(98669),_e=J(49710),st=J(7601),et=J(32647),v=J(8787),s=J(72099),fe=J(38816),Ye=J(75782),Qe=J(81669),Xe=J(95005),yt=J(96833),be=J(10287),Z=J(18569),he=J(92701),je=J(9309),ue=J(54683),Ke=J(47267),c=J(27961),Fe=J(50334),le=J(48875),He=J(39560),tt=J(35063),Ft=J(44904),K=J(95707),n=J(54438),lt=J(60177),mt=J(60440),qe=J(94304),$e=J(36688),Pt=J(13816),Kt=J(73955);function qt(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("Approve"))}),n.nrm(1,"i",39),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Approve")))}function ct(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("Save"))}),n.nrm(1,"i",40),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Post")))}function It(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("SaveAndPrint"))}),n.nrm(1,"i",41),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"SaveAndPrint")))}function Ct(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.btnPrint_Click("Print"))}),n.nrm(1,"i",42),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Print")))}function Be(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.btnPrintPreview_Click("Preview"))}),n.nrm(1,"i",43),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Preview")))}function Nt(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.btnExport_Click("Export"))}),n.nrm(1,"i",44),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Export")))}function pt(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("Attachments"))}),n.nrm(1,"i",45),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Attachments")))}function ut(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("EMail"))}),n.nrm(1,"i",46),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"SMTP_Email")))}function ht(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("Delete"))}),n.nrm(1,"i",47),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Delete")))}function $t(H,me){if(1&H){const m=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.obj.Button_Click("Report"))}),n.nrm(1,"i",48),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&H&&(n.R7$(2),n.JRh(n.bMT(3,1,"Report")))}function Qt(H,me){if(1&H){const m=n.RV6();n.j41(0,"div",22),n.EFF(1,"\n                "),n.j41(2,"div"),n.EFF(3,"\n                  "),n.j41(4,"div",49),n.EFF(5,"\n                    "),n.eu8(6,50),n.EFF(7,"\n                    "),n.j41(8,"div",51),n.EFF(9,"\n                      "),n.j41(10,"label",52),n.EFF(11),n.k0s(),n.EFF(12,"\n                      "),n.j41(13,"div",53),n.EFF(14,"\n                        "),n.j41(15,"span",54),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.Calculate_Click("Previous"))}),n.nrm(16,"i",55),n.k0s(),n.EFF(17,"\n                        "),n.j41(18,"span",54),n.bIt("click",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.Calculate_Click("Next"))}),n.nrm(19,"i",56),n.k0s(),n.EFF(20,"\n                      "),n.k0s(),n.EFF(21,"\n                    "),n.k0s(),n.EFF(22,"\n                  "),n.k0s(),n.EFF(23,"\n                  \n                  \n                "),n.k0s(),n.EFF(24,"\n              "),n.k0s()}if(2&H){const m=n.XpG();n.R7$(6),n.Y8G("obj",m.obj.DocPrefix)("group",m.form),n.R7$(5),n.JRh(m.obj.lblDocNo)}}function zt(H,me){if(1&H&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.dtpDocDate)("group",m.form)}}function Zt(H,me){if(1&H&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.EmployeeList)("group",m.form)}}function St(H,me){if(1&H&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.cmbSettlementType)("group",m.form)}}function ea(H,me){if(1&H&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.dtpDateOfJoining)("group",m.form)}}function ta(H,me){if(1&H&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.dtpDateOfRelieving)("group",m.form)}}function vt(H,me){if(1&H&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.txtRemarks)("group",m.form)}}function Lt(H,me){if(1&H&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.obj.txtNetAmount)("group",m.form)}}function aa(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.EFF(2,"\n              "),n.nrm(3,"app-PactGridView",59),n.EFF(4,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(3),n.Y8G("obj",m.dgvGratuity)("group",m.form)}}function sa(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.cmbResignType)("group",m.form)}}function Dt(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.cmbResignReason)("group",m.form)}}function it(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtGratuityAmount)("group",m.form)}}function Rt(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtAvailedGratuityAmount)("group",m.form)}}function Ot(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtPartialGratuityAmount)("group",m.form)}}function Vt(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.dgvLeaveEncash)("group",m.form)}}function la(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtCumLeaveSalBalAmt)("group",m.form)}}function ia(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtLEAmount)("group",m.form)}}function na(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG(2);n.R7$(2),n.Y8G("obj",m.dgvUPS)("group",m.form)}}function Mt(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG(2);n.R7$(2),n.Y8G("obj",m.txtUPSAmount)("group",m.form)}}function wt(H,me){if(1&H){const m=n.RV6();n.j41(0,"tab",26),n.bIt("selectTab",function(){n.eBV(m);const y=n.XpG();return n.Njj(y.onSelectTab("dgvUPS"))}),n.EFF(1,"\n          "),n.j41(2,"div",36),n.EFF(3,"\n            "),n.DNE(4,na,4,2,"div",28),n.EFF(5,"\n            "),n.j41(6,"div",37),n.EFF(7,"\n              "),n.j41(8,"div",31),n.EFF(9,"\n                "),n.eu8(10,32),n.EFF(11,"\n              "),n.k0s(),n.EFF(12,"\n              "),n.DNE(13,Mt,4,2,"div",30),n.EFF(14,"\n            "),n.k0s(),n.EFF(15,"\n          "),n.k0s(),n.EFF(16,"\n        "),n.k0s()}if(2&H){const m=n.XpG();n.FS9("heading",m.tpUnProcessedSalary),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",m.dgvUPS.Visible),n.R7$(6),n.Y8G("obj",m.UPSRemarks)("group",m.form),n.R7$(3),n.Y8G("ngIf",m.txtUPSAmount.Visible)}}function ft(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.dgvNoticePay)("group",m.form)}}function Gt(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtNPAmount)("group",m.form)}}function Me(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.dgvOthAdd)("group",m.form)}}function gt(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtOthAddAmount)("group",m.form)}}function oa(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.dgvOthDed)("group",m.form)}}function ra(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtOthDedAmount)("group",m.form)}}function kt(H,me){if(1&H&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.dgvLoanBal)("group",m.form)}}function _t(H,me){if(1&H&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&H){const m=n.XpG();n.R7$(2),n.Y8G("obj",m.txtLoanBalAmount)("group",m.form)}}let da=(()=>{class H{constructor(){this.form=new ie.gE({}),this.IsAccordionOpen=!0,this.EmpSeqNo=0,this.GratuityGrade=0,this.EmpGrade=0,this.GratuityDocID=0,this.PrevEmpSeqNo=0,this.sDocNo="0",this.strFormula="",this.isLoaded=!1,this.dblAmount=0,this.drwRes=null,this.chkCalcBasedOnLastSal=new s.c,this.chkCalcBasedOnActDays=new s.c,this.chkLECalcBasedOnLastApprSerYearWise=new s.c,this.GratuityRemarks=new Le.Dw(0),this.LeaveRemarks=new Le.Dw(0),this.UPSRemarks=new Le.Dw(0),this.NoticePayRemarks=new Le.Dw(0),this.OAddRemarks=new Le.Dw(0),this.ODedRemarks=new Le.Dw(0),this.LoanRemarks=new Le.Dw(0),this.txtGratuityAmount=new Le.Dw(0),this.txtAvailedGratuityAmount=new Le.Dw(0),this.txtPartialGratuityAmount=new Le.Dw(0),this.txtCumLeaveSalBalAmt=new Le.Dw(0),this.txtLEAmount=new Le.Dw(0),this.txtUPSAmount=new Le.Dw(0),this.txtOthAddAmount=new Le.Dw(0),this.txtOthDedAmount=new Le.Dw(0),this.txtNPAmount=new Le.Dw(0),this.txtLoanBalAmount=new Le.Dw(0),this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="",this.lblActRelievingDate="",this.dgvGratuity=new _e.vv,this.dgvLeaveEncash=new _e.vv,this.dgvUPS=new _e.vv,this.dgvOthAdd=new _e.vv,this.dgvOthDed=new _e.vv,this.dgvNoticePay=new _e.vv,this.dgvLoanBal=new _e.vv,this.lblDocNo="",this.tpGratuity="",this.tpLeaveEncashment="",this.tpUnProcessedSalary="",this.tpNoticePay="",this.tpOtherAdditions="",this.tpOtherDeductions="",this.tpLoanBalances="",this.btnCalcGratuity="",this.lbl1GratuityTotalDays="",this.lbl1GratuityServiceDays="",this.lbl1GratuityLOPDays="",this.lbl1GratuityBalDays="",this.lbl1GratuityTotalGrDays="",this.lblGratuityAmount="",this.lblAvailedGratuityAmount="",this.lblPartialGratuityAmount="",this.lbl1GratuityTaken="",this.lblCumLeaveSalBalAmt="",this.btnCalcLE="",this.lblLEAmount="",this.lblUPSAmount="",this.lblNPAmount="",this.lblOthAddAmount="",this.lblOthDedAmount="",this.lblLoanBalAmount="",this.dtEdit=null,this.iCurDocNo=0,this.CostCenterID=40095,this.DefProdID=0,this.dblBasic=0,this.EOS_ROff=0,this.dServiceDaysFormulaAmount=0,this.dblGratuityAmount=0,this.dActServiceDays=0,this.dServiceDaysAfterLOP=0,this.dLOPDays=0,this.EOS_ROffYear=0,this.isLast=!1,this.isConsdExpiredupto=!1,this.sVacTypeSeqNo="-1",this.EOS_GratuityFormula="",this.EOS_AvailedFormula="",this.EOS_MaxDays=0,this.dEarnedGrDays=0,this.lst=new Array,this.dTotGratuityDays=0,this.dGratuityTaken=0,this.isMaxDaysExceded=!1,this.oEvalPayFormulas=null,this.MoreThanOneLayout=!1,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null,this._Ddate=Date.Today(),this.IsRefLCTR=!1,this.guid=""}ngOnInit(){this.obj=this.params?.obj,this.FinalSettlement_DataContextChanged(),this.FinalSettlement_Loaded(),console.log(this)}onSelectTab(m){f.d.page.RefreshSlickGridUI()}get txtDocNo(){return""!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox:this.ViewModel.txtDocNo}get txtRemarks(){return this.ViewModel.txtRemarks}get txtNetAmount(){return this.ViewModel.txtNetAmount}get EmployeeList(){return this.ViewModel.EmployeeList}get cmbResignType(){return this.ViewModel.cmbResignType}get cmbResignReason(){return this.ViewModel.cmbResignReason}get cmbSettlementType(){return this.ViewModel.cmbSettlementType}get dtpDocDate(){return this.ViewModel.dtpDocDate}get dtpDateOfJoining(){return this.ViewModel.dtpDateOfJoining}get dtpDateOfRelieving(){return this.ViewModel.dtpDateOfRelieving}FinalSettlement_DataContextChanged(){this.ViewModel=this.params?.obj,this.ViewModel.CalculateClick.Subscribe(this,"Calculate_Click"),this.ViewModel.EmpSelectionChanged.Subscribe(this,"Employee_SelectionChanged"),this.ViewModel.txtDocNo.LostFocusCommand.Subscribe(this,"txtDocNo_LostFocus"),this.ViewModel.DocPrefixSelectionChanged.Subscribe(this,"OnDocPrefixChanged"),this.dgvOthAdd.CellEditEnding.Subscribe(this,"dgvOthAdd_CellEndEdit"),this.dgvOthDed.CellEditEnding.Subscribe(this,"dgvOthDed_CellEndEdit"),this.dtpDateOfRelieving.SelectedDateChanged.Subscribe(this,"dtpDateOfRelieving_SelectedDateChanged"),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1)}FinalSettlement_Loaded(){this.isLoaded||(this.LoadGrids(),this.Clear_Click(),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.CheckDateInDocNumber(!0,!0),this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),this.dsLookups=f.d.common.GetDataSet("CRM015",""),this.dgvOthAdd.Columns.find(I=>"dgColOthAddParticulars"==I.ValueBinding).ComboData=this.dsLookups.Tables[0],this.dgvOthDed.Columns.find(I=>"dgColOthDedParticulars"==I.ValueBinding).ComboData=this.dsLookups.Tables[1],this.dgvOthAdd.CanUserAddRows=!0,this.dgvOthAdd.CanUserDeleteRows=!0,this.dgvOthAdd.addEmptyRow(),this.dgvOthDed.CanUserAddRows=!0,this.dgvOthDed.CanUserDeleteRows=!0,this.dgvOthDed.addEmptyRow(),this.dgvOthAdd.refreshDataView(),this.lblDocNo=this.GetResource("VoucherNo",40095),this.tpGratuity=this.GetResource("Gratuity",40095),this.tpLeaveEncashment=this.GetResource("Leave Encashment",40095),this.tpUnProcessedSalary=this.GetResource("Un-Processed Salary",40095),this.tpNoticePay=this.GetResource("Notice Pay",40095),this.tpOtherAdditions=this.GetResource("Other Additions",40095),this.tpOtherDeductions=this.GetResource("Other Deductions",40095),this.tpLoanBalances=this.GetResource("Loan Balances",40095),this.chkCalcBasedOnLastSal.Label=this.GetResource("Calculate based on Last Salary",40095),this.chkCalcBasedOnActDays.Label=this.GetResource("Calculate Salary based on Actual Days",40095),this.btnCalcGratuity=this.GetResource("Calculate",40095),this.lbl1GratuityTotalDays=this.GetResource("Total Days",40095)+" : ",this.lbl1GratuityServiceDays=this.GetResource("Service Days",40095)+" : ",this.lbl1GratuityLOPDays=", "+this.GetResource("LOP",40095)+" : ",this.lbl1GratuityBalDays=", "+this.GetResource("Balance",40095)+" : ",this.lbl1GratuityTotalGrDays=this.GetResource("Total Gratuity Days",40095)+" : ",this.lbl1GratuityTaken=this.GetResource("Gratuity Taken",40095)+" : ",this.lblGratuityAmount=this.GetResource("Gratuity Amount",40095),this.lblAvailedGratuityAmount=this.GetResource("Availed Gratuity Amount",40095),this.lblPartialGratuityAmount=this.GetResource("Partial Gratuity Amount",40095),this.lblCumLeaveSalBalAmt=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.chkLECalcBasedOnLastApprSerYearWise.Label=this.GetResource("Calculate based on Last Appraisal - Service Year Wise",40095),this.btnCalcLE=this.GetResource("Calculate",40095),this.lblLEAmount=this.GetResource("Amount",40095),this.lblUPSAmount=this.GetResource("Amount",40095),this.lblNPAmount=this.GetResource("Amount",40095),this.lblOthAddAmount=this.GetResource("Amount",40095),this.lblOthDedAmount=this.GetResource("Amount",40095),this.lblLoanBalAmount=this.GetResource("Amount",40095),this.isLoaded=!0,""!=this.ViewModel.sVNo&&this.LoadDocument(parseInt(this.ViewModel.sVNo.Replace("FST-","")),this.Prefix))}txtDocNo_LostFocus(m){try{this.txtDocNo.Text.Trim().length>0&&this.LoadDocument(parseInt(this.txtDocNo.Text.Trim()),this.Prefix)}catch{this.ViewModel.DisplayMessage="Enter Valid DocNo."}}LoadDocument(m,I){let y;this.ViewModel.DisplayMessage="",this.ViewModel.MessageVisibility=!0,this.sDocNo=m.toString();let u=f.d.common.GetDataTable("CRM016",m.toString()+"~"+I);if(null!=u&&u.length>0){if(!v.J0.IsEmpty(f.d.SessionManager.sEmpFilteredEmpSeqNos)&&!f.d.SessionManager.sEmpFilteredEmpSeqNos.split(",").Contains(parseInt(u[0].EmpSeqNo).toString()))return this.ViewModel.DisplayMessage="You don't have permission to view this Document.",this.ViewModel.MessageVisibility=!0,this.Clear_Click(),this.txtDocNo.Text=m.toString(),void(this.EmployeeList.IsEnabled=!1);this.EmployeeList.IsEnabled=!0,this.ViewModel.PostVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ViewModel.SavePrintVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.EmployeeList.SelectedValue=parseInt(u[0].EmpSeqNo),this.EmployeeList.SelectedValue=parseInt(u[0].EmpSeqNo),this.ClearControlValues(),this.dtEdit=null,this.EmpSeqNo=parseInt(u[0].EmpSeqNo),this.dtEdit=f.d.common.GetDataTable("CRM018",this.EmpSeqNo.toString()+"~"+m+"~"+I),null!=this.dtEdit&&this.dtEdit.length>0&&(this.dtpDocDate.Date=v.J0.ParseDate(this.dtEdit[0].cDocDate));let M=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.iMonth(),1),O=[];if(O.push(this.EmpSeqNo),O.push(0),O.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),O.push(M.ToString("dd/MMM/yyyy")),O.push(m),O.push(I),O.push(1),O.push(f.d.SessionManager.UserID),O.push(f.d.SessionManager.RoleID),O.push(f.d.SessionManager.LanguageID),this.dsD=f.d.common.GetDataSet_SP(O,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0&&this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.cmbSettlementType.SelectedValue="Final",this.DOB=v.J0.ParseDate(this.dsD.Tables[0][0].DOB),9e3!=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+" : "+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=new Date,this.cmbResignType.SelectedValue=v.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==v.J0.String(this.dsD.Tables[0][0].ResignStatus)){let R=v.J0.ParseDate(this.dsD.Tables[0][0].DOResign),U=new Date(R.getFullYear(),R.getMonth(),1),k=new Date,V=U;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=f.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(f.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(k=U.AddMonths(parseInt(f.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=f.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(f.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(k=U.AddMonths(parseInt(f.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=f.d.SessionManager.Preferences.NPResignation&&parseInt(f.d.SessionManager.Preferences.NPResignation)>0&&(k=U.AddMonths(parseInt(f.d.SessionManager.Preferences.NPResignation)-1));let $=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfRelieving.Date.iMonth(),1);if(k<$)for(;k<$;)k=k.AddMonths(1);let ee,re=new Date,z=new Date,Ae=new Date;for(;V<=k;){if(y=this.dsD.Tables[5].filter(Pe=>Pe.PayrollDate==V.ToString("dd/MMM/yyyy")),null==y||0==y.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=V.ToString("dd/MMM/yyyy"),"Actual Days"==f.d.SessionManager.Preferences.PayDays){let Pe={PayrollMonth:re,PayrollMonthStart:z,PayrollMonthEnd:Ae};if(v.J0.SetPayrollDate_1(V,Pe),re=Pe.PayrollMonth,z=Pe.PayrollMonthStart,Ae=Pe.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Oe=0;Oe=v.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),re,z,Ae),Oe>0&&(v.J0.SetPayrollDate_1(V,Pe,this.EmpGrade),re=Pe.PayrollMonth,z=Pe.PayrollMonthStart,Ae=Pe.PayrollMonthEnd)}ee=Ae.Subtract(z).Days+1}else ee=parseInt(f.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=ee,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(f.d.SessionManager.sPayrollDecimals)}V=V.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&f.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==f.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let R=0,U=0;for(let k=0;k<this.dsD.Columns[8].length;k++)v.J0.IsEmpty(this.dsD.Tables[8][0][k])||(R+=parseFloat(this.dsD.Tables[8][0][k]));for(let k=0;k<this.dsD.Tables[9].length;k++)v.J0.IsEmpty(this.dsD.Tables[9][k].Amount)||(U+=parseFloat(this.dsD.Tables[9][k].Amount));this.txtCumLeaveSalBalAmt.Text=(R-U).ToString(f.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(f.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let R;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let U=0;U<this.dsD.Tables[4].length;U++)R=v.J0.ParseDate(this.dsD.Tables[4][U].PayrollMonth),this.dgvUPS.Table[U].dgColUPSPayrollMonth=R.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[U].dgColUPSMonthDays=R.DaysInMonth(),this.dgvUPS.Table[U].dgColUPSDaysAtt=0,this.dgvUPS.Table[U].dgColUPSLOP=0,this.dgvUPS.Table[U].dgColUPSNetSal=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[U].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[U])}let Y=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let R=0;R<this.dsD.Tables[10].length;R++)this.dgvLoanBal.Table[R].dgColLoanBalSNo=(R+1).toString(),this.dgvLoanBal.Table[R].dgColLoanBalDocNo=this.dsD.Tables[10][R].DocNo.toString(),this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][R].DocID.toString(),this.dgvLoanBal.Table[R].dgColLoanBalLoanType=this.dsD.Tables[10][R].LoanType.toString(),this.dgvLoanBal.Table[R].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][R].LoanCompID.toString(),this.dgvLoanBal.Table[R].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][R].ApprovedAmt).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][R].Paid).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][R].Balance).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[R].dgColLoanBalCalc="Pay",Y+=parseFloat(this.dsD.Tables[10][R].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[R])}this.txtLoanBalAmount.Text=Y.ToString(f.d.SessionManager.sPayrollDecimals),this.ViewModel.ApproveVisibility=!1;let q=null;if(null!=this.dtEdit&&this.dtEdit.length>0){if(this.ViewModel.DocStatus="["+this.dtEdit[0].DocStatus.toString()+"]",this.ViewModel.DocID=parseInt(this.dtEdit[0].DocID),this.sDocNo=this.dtEdit[0].DocNumber.toString(),this.txtDocNo.Text=this.sDocNo,this.dtpDocDate.Date=v.J0.ParseDate(this.dtEdit[0].cDocDate),this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dtEdit[0].dcAlpha3),this.dtpDateOfRelieving_SelectedDateChanged(this,this.dtpDateOfRelieving),this.txtRemarks.Text=this.dtEdit[0].CommonNarration.toString(),this.ViewModel.StatusID=parseInt(this.dtEdit[0].StatusID),this.ViewModel.WID=parseInt(this.dtEdit[0].WorkflowID),this.cmbSettlementType.SelectedValue=v.J0.String(this.dtEdit[0].dcAlpha10),q=f.d.common.GetDataSet("CRM029",this.ViewModel.DocID.toString()),y=this.dtEdit.filter(V=>"1"==V.dcAlpha1),null!=y&&y.length>0&&(this.GratuityRemarks.Text=y[0].dcAlpha8.toString(),this.cmbResignType.Text=y[0].dcAlpha11.toString(),this.chkCalcBasedOnLastSal.IsChecked=(0,et.yG0)(y[0].dcAlpha12),this.chkCalcBasedOnActDays.IsChecked=(0,et.yG0)(y[0].dcAlpha13),this.cmbResignReason.SelectedValue=y[0].dcAlpha33.toString(),this.Calculate_Click("Gratuity"),this.txtPartialGratuityAmount.Text=parseFloat(y[0].dcCalcNum4).ToString(f.d.SessionManager.sPayrollDecimals)),y=this.dtEdit.filter(V=>"2"==V.dcAlpha1),null!=y&&y.length>0){this.LeaveRemarks.Text=y[0].dcAlpha8.toString(),this.chkLECalcBasedOnLastApprSerYearWise.IsChecked=!v.J0.IsEmpty(y[0].dcAlpha17)&&(0,et.yG0)(y[0].dcAlpha17);for(let V=0;V<y.length;V++)for(let $=0;$<this.dgvLeaveEncash.Table.length;$++)if(y[V].dcAlpha11.toString()==this.dgvLeaveEncash.Table[$+"_Tag"].toString()){this.dgvLeaveEncash.Table[$].dgColLEAvailable=y[V].dcAlpha13.toString(),this.dgvLeaveEncash.Table[$].dgColLEMaxEncash=y[V].dcAlpha14.toString(),this.dgvLeaveEncash.Table[$].dgColLEApplied=y[V].dcAlpha15.toString();break}this.Calculate_Click("LeaveEncash"),this.dgvLeaveEncash.Update()}if(y=this.dtEdit.filter(V=>"3"==V.dcAlpha1),null!=y&&y.length>0){this.UPSRemarks.Text=y[0].dcAlpha8.toString();for(let V=0;V<y.length;V++)for(let $=0;$<this.dgvUPS.Table.length;$++)if(v.J0.ParseDate(y[V].dcAlpha11).ToString("dd MMM yyyy")==v.J0.ParseDate(this.dgvUPS.Table[$].dgColUPSPayrollMonth).ToString("dd MMM yyyy")){this.dgvUPS.Table[$].dgColUPSDaysAtt=y[V].dcAlpha13.toString(),this.dgvUPS.Table[$].dgColUPSLOP=y[V].dcAlpha14.toString(),this.dgvUPS.Table[$].dgColUPSNetSal=y[V].dcAlpha15.toString();break}this.dgvUPS.Update(),this.txtUPSAmount.Text=parseFloat(y[0].dcCalcNum1).ToString(f.d.SessionManager.sPayrollDecimals)}if(y=this.dtEdit.filter(V=>"4"==V.dcAlpha1),null!=y&&y.length>0){this.NoticePayRemarks.Text=y[0].dcAlpha8.toString();for(let V=0;V<y.length;V++)for(let $=0;$<this.dgvNoticePay.Table.length;$++)if(v.J0.ParseDate(y[V].dcAlpha11).ToString("dd MMM yyyy")==v.J0.ParseDate(this.dgvNoticePay.Table[$].dgColNPPayrollMonth).ToString("dd MMM yyyy")){this.dgvNoticePay.Table[$].dgColNPDaysAtt=y[V].dcAlpha13.toString(),this.dgvNoticePay.Table[$].dgColNPLOP=y[V].dcAlpha14.toString(),this.dgvNoticePay.Table[$].dgColNPNetSal=y[V].dcAlpha15.toString(),this.dgvNoticePay.Table[$].dgColNPType=y[V].dcAlpha16.toString(),this.dgvNoticePay.Table[$].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[$]);break}this.txtNPAmount.Text=parseFloat(y[0].dcCalcNum1).ToString(f.d.SessionManager.sPayrollDecimals)}if(y=this.dtEdit.filter(V=>"5"==V.dcAlpha1),null!=y&&y.length>0){this.OAddRemarks.Text=y[0].dcAlpha8.toString(),this.dgvOthAdd.addEmptyRows(y.length);for(let V=0;V<y.length;V++)this.dgvOthAdd.Table[V].dgColOthAddParticulars=parseInt(y[V].dcAlpha11.toString()),this.dgvOthAdd.Table[V].dgColOthAddAmount=y[V].dcAlpha12.toString(),v.J0.IsEmpty(y[V].dcAlpha13)||(this.dgvOthAdd.Table[V].dgColOthAddRemarks=y[V].dcAlpha13.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[V]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2)}if(y=this.dtEdit.filter(V=>"6"==V.dcAlpha1),null!=y&&y.length>0){this.ODedRemarks.Text=y[0].dcAlpha8.toString(),this.dgvOthDed.addEmptyRows(y.length);for(let V=0;V<y.length;V++)this.dgvOthDed.Table[V].dgColOthDedParticulars=parseInt(y[V].dcAlpha11.toString()),this.dgvOthDed.Table[V].dgColOthDedAmount=y[V].dcAlpha12.toString(),v.J0.IsEmpty(y[V].dcAlpha13)||(this.dgvOthDed.Table[V].dgColOthDedRemarks=y[V].dcAlpha13.toString()),this.dgvOthDed.updateRow(this.dgvOthDed.Table[V]),this.dgvOthDed_CellEndEdit(this.dgvOthDed,2)}if(y=this.dtEdit.filter(V=>"7"==V.dcAlpha1),null!=y&&y.length>0){this.LoanRemarks.Text=y[0].dcAlpha8.toString();for(let V=0;V<y.length;V++)for(let $=0;$<this.dgvLoanBal.Table.length;$++)if(y[V].dcAlpha12.toString()==this.dgvLoanBal.Table[$].dgColLoanBalDocNo_Tag.toString()){this.dgvLoanBal.Table[$].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[$].dgColLoanBalSNo_Tag=y[V].dcAlpha17.toString(),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[$]);break}}if(null!=q&&q.Tables.length>0&&q.Tables[0].length>0){let V=q.Tables[0];if(null!=V&&V.length>0)for(let $=0;$<V.length;$++){let ee=new ue.AddAttachmentViewModel;ee.AddAttachmentViewModel_2(this.ViewModel),ee.AttachmentID=parseInt(V[$].FileID),ee.ActualFileName=V[$].ActualFileName.toString(),ee.FileExtension=V[$].FileExtension.toString(),ee.FileDescription=V[$].FileDescription.toString(),ee.FilePath=v.J0.GetPath(V[$].GUID+"."+V[$].FileExtension),ee.RelativeFileName=V[$].RelativeFileName.toString(),ee.IsProductImage=!1,this.ViewModel.ViewAttachments.AttachmentsList.push(ee)}}if(this.ViewModel.WID>0){let V=f.d.common.GetDataTable("CRM020",this.dtEdit[0].InvDocDetailsID.toString()+",95,'"+f.d.SessionManager.UserName+"',40095,"+this.ViewModel.WID+","+this.dtEdit[0].WorkFlowLevel.toString()+","+this.dtEdit[0].StatusID.toString()+","+this.dtEdit[0].CreatedDate.toString()+","+f.d.SessionManager.UserID+","+f.d.SessionManager.RoleID);null!=V&&V.length>0&&(null!=V[0].CanApprove&&null!=V[0].CanApprove&&"TRUE"==V[0].CanApprove.toString().toUpperCase()?(this.ViewModel.ApproveVisibility=!0,this.ViewModel.PostVisiblility=!1):this.ViewModel.PostVisiblility=!(!f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))}let R=f.d.common.GetDataSet3("CRM021",this.CostCenterID.toString(),this.ViewModel.DocID.toString());this.ViewModel.WFDocLevelList.Clear();let U=null,k=null;if(U=R.Tables[1],k=R.Tables[0],null!=U&&U.length>0&&!f.d.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let $,V=parseInt(this.dtEdit[0].WorkFlowLevel);k.length>0&&($=parseInt(k[k.length-1].StatusID));let ee=k.length>0?parseInt(k[0].WORKFLOWLEVEL)-1:0;for(let re=0;re<U.length;re++){let z=new st.O(parseInt(U[0].WID),parseInt(U[re].LEVELID),U[re].LEVELNAME.toString(),this.CostCenterID,this.ViewModel.DocID,v.J0.ParseDate(U[re].DocDate));re==ee&&(z.IsPending=!0,z.Label="C"),0==re&&(z.LeftLineBrush="#FFFFFFFF"),re==U.length-1&&(z.RightLineBrush="#FFFFFFFF"),this.ViewModel.WFDocLevelList.push(z)}for(let re=k.length-1;re>=0;re--){let z=parseInt(k[re].WORKFLOWLEVEL);if(z<=V&&z<=this.ViewModel.WFDocLevelList.length&&!this.ViewModel.WFDocLevelList[z-1].IsSet){this.ViewModel.WFDocLevelList[z-1].IsSet=!0,this.ViewModel.WFDocLevelList[z-1].ModifiedBy=k[re].STATUS.toString()+" By "+k[re].CREATEDBY.toString(),k[re].FIRSTNAME.toString().length>0&&(this.ViewModel.WFDocLevelList[z-1].ModifiedBy+="("+k[re].FIRSTNAME.toString()+")");let Ae=v.J0.ParseDate(k[re].DATE);this.ViewModel.WFDocLevelList[z-1].ModifiedBy+=" On "+Ae.ToString(f.d.SessionManager.Preferences["Date Format"]);let Pe=parseInt(k[re].STATUSID);372==Pe?this.ViewModel.WFDocLevelList[z-1].IsRejected=!0:441==Pe?this.ViewModel.WFDocLevelList[z-1].IsApproved=!0:369==Pe&&(this.ViewModel.WFDocLevelList[z-1].IsPending=!0,this.ViewModel.WFDocLevelList[z-1].Label=" P")}}}}else this.ViewModel.DocStatus="[UnPosted]",this.ViewModel.DocID=0,this.sDocNo="0",this.ViewModel.StatusID=0,this.ViewModel.PostVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete");this.CalculateTotalAmount()}this.ViewModel.EmployeeList.Code.SelectedValue=parseInt(u[0].EmpSeqNo),this.ViewModel.EmployeeList.Name.SelectedValue=parseInt(u[0].EmpSeqNo),this.ViewModel.DocID=parseInt(u[0].DocID),this.ViewModel.sVoucherNo=u[0].VoucherNo.toString()}else this.Clear_Click(),this.txtDocNo.Text=m.toString(),this.dtpDocDate.SetFocus=!0}Clear_Click(){this.OnDocPrefixChanged_3(this.Prefix,0,0,{value:this._Ddate},!1),null!=this.ViewModel.dtCodePrefix&&this.ViewModel.dtCodePrefix.Tables[0].length>0&&0==this.ViewModel.DocPrefix.Prefixes.length&&this.fillPrefixes(this.ViewModel.dtCodePrefix.Tables[0]),this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=0,this.EmpSeqNo=0,this.PrevEmpSeqNo=0,this.ViewModel.DocID=0,this.ClearControlValues(),this.ViewModel.sCmdParameter="",this.ViewModel.SelectedEmpID=0,this.dTotGratuityDays=0,null!=this.ViewModel&&null!=this.ViewModel.WFDocLevelList&&this.ViewModel.WFDocLevelList.Clear(),this.ViewModel.ApproveVisibility=!1,this.ViewModel.PostVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=f.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new je.ViewAttachmentViewModel(this.ViewModel,f.d.SessionManager,f.d.admin),this.ViewModel.OnAddAttachment()}ClearControlValues(){this.dtEdit=null,this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="0",this.chkCalcBasedOnLastSal.Label="Calculate based on Last Salary",this.chkCalcBasedOnActDays.Label="Calculate Salary based on Actual Days",this.txtRemarks.Label=f.d.GetResource("Remarks"),this.txtRemarks.Text="",this.GratuityRemarks.Label=f.d.GetResource("Remarks"),this.GratuityRemarks.Text="",this.LeaveRemarks.Label=f.d.GetResource("Remarks"),this.LeaveRemarks.Text="",this.UPSRemarks.Label=f.d.GetResource("Remarks"),this.UPSRemarks.Text="",this.NoticePayRemarks.Label=f.d.GetResource("Remarks"),this.NoticePayRemarks.Text="",this.OAddRemarks.Label=f.d.GetResource("Remarks"),this.OAddRemarks.Text="",this.ODedRemarks.Label=f.d.GetResource("Remarks"),this.ODedRemarks.Text="",this.cmbSettlementType.SelectedIndex=0,this.LoanRemarks.Label=f.d.GetResource("Remarks"),this.LoanRemarks.Text="",this.dtpDocDate.Date=(new Date).Date(),this.cmbResignType.Label=f.d.GetResource("Resign Type"),this.cmbResignType.SelectedValue="Resigned",this.cmbResignReason.SelectedValue="",this.cmbResignReason.Label="Resign Reason",this.dblBasic=0,this.sDocNo="0",this.ViewModel.DocStatus="[UnPosted]",this.dGratuityTaken=0,this.dgvGratuity.Clear(),this.dgvLeaveEncash.Clear(),this.dgvUPS.Clear(),this.dgvOthAdd.Clear(),this.dgvOthDed.Clear(),this.dgvNoticePay.Clear(),this.dgvLoanBal.Clear(),this.txtGratuityAmount.Label=this.GetResource("Gratuity Amount",40095),this.txtGratuityAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtGratuityAmount.Align="right",this.txtAvailedGratuityAmount.Label=this.GetResource("Availed Gratuity Amount",40095),this.txtAvailedGratuityAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Align="right",this.txtPartialGratuityAmount.Label=this.GetResource("Partial Gratuity Amount",40095),this.txtPartialGratuityAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtPartialGratuityAmount.Align="right",this.txtCumLeaveSalBalAmt.Label=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.txtCumLeaveSalBalAmt.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtCumLeaveSalBalAmt.Align="right",this.txtLEAmount.Label=this.GetResource("Amount",40095),this.txtLEAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtLEAmount.Align="right",this.txtUPSAmount.Label=this.GetResource("Amount",40095),this.txtUPSAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtUPSAmount.Align="right",this.txtOthAddAmount.Label=this.GetResource("Amount",40095),this.txtOthAddAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtOthAddAmount.Align="right",this.txtOthDedAmount.Label=this.GetResource("Amount",40095),this.txtOthDedAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtOthDedAmount.Align="right",this.txtNPAmount.Label=this.GetResource("Amount",40095),this.txtNPAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtNPAmount.Align="right",this.txtLoanBalAmount.Label=this.GetResource("Amount",40095),this.txtLoanBalAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtLoanBalAmount.Align="right",this.txtNetAmount.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtNetAmount.Align="right",this.lblActRelievingDate="",null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new je.ViewAttachmentViewModel(this.ViewModel,f.d.SessionManager,f.d.admin),this.ViewModel.OnAddAttachment(),this.setDefaultRows()}setDefaultRows(){this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd"),this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")}GetNextDocNo(){let m=f.d.common.GetDataTable("CRM017","");null!=m&&(this.txtDocNo.Text=m.length>0?v.J0.IsEmpty(m[0].CurrentCodeNumber)?"1":parseInt(m[0].CurrentCodeNumber).toString():"1")}Employee_SelectionChanged(m){if(this.EmpSeqNo==m)return;this.EmpSeqNo=m,this.ClearControlValues();let I,y=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.getMonth(),1),u=[];if(u.push(this.EmpSeqNo),u.push(this.ViewModel.DocID),u.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),u.push(y.ToString("dd/MMM/yyyy")),u.push(0),u.push(""),u.push(0),u.push(f.d.SessionManager.UserID),u.push(f.d.SessionManager.RoleID),u.push(f.d.SessionManager.LanguageID),this.dsD=f.d.common.GetDataSet_SP(u,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0)if(this.dsD.Tables.length>14&&this.dsD.Tables[14].length>0)this.ViewModel.DisplayMessage="Employee FinalSettlement is Already done @VoucherNo - "+this.dsD.Tables[14][0].VoucherNo.ToString(),this.ViewModel.MessageVisibility=!0;else if(this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.DOB=v.J0.ParseDate(this.dsD.Tables[0][0].DOB),this.cmbSettlementType.SelectedValue="Final",9e3!=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=Date.Today(),this.cmbResignType.SelectedValue=v.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==this.dsD.Tables[0][0].ResignStatus.toString()){let O=v.J0.ParseDate(this.dsD.Tables[0][0].DOResign),Y=new Date,q=new Date,R=new Date,U={PayrollMonth:Y,PayrollMonthStart:q,PayrollMonthEnd:R};v.J0.SetPayrollDate_1(O,U),Y=U.PayrollMonth,q=U.PayrollMonthStart,R=U.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(O,U,this.EmpGrade),Y=U.PayrollMonth,q=U.PayrollMonthStart,R=U.PayrollMonthEnd);let k=new Date(Y.getFullYear(),Y.getMonth(),1),V=new Date,$=k;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=f.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(f.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(V=k.AddMonths(parseInt(f.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=f.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(f.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(V=k.AddMonths(parseInt(f.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=f.d.SessionManager.Preferences.NPResignation&&parseInt(f.d.SessionManager.Preferences.NPResignation)>0&&(V=k.AddMonths(parseInt(f.d.SessionManager.Preferences.NPResignation)-1)),Y=new Date,q=new Date,R=new Date,U={PayrollMonth:Y,PayrollMonthStart:q,PayrollMonthEnd:R},v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U),Y=U.PayrollMonth,q=U.PayrollMonthStart,R=U.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U,this.EmpGrade),Y=U.PayrollMonth,q=U.PayrollMonthStart,R=U.PayrollMonthEnd);let ee=new Date(Y.getFullYear(),Y.iMonth(),1);if(V<ee)for(;V<ee;)V=V.AddMonths(1);let re=0;for(Y=new Date,q=new Date,R=new Date;$<=V;){if(I=this.dsD.Tables[5].filter(z=>z.PayrollDate==$.ToString("dd/MMM/yyyy")),null==I||0==I.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=$.ToString("dd/MMM/yyyy"),"Actual Days"==f.d.SessionManager.Preferences.PayDays){let z={PayrollMonth:Y,PayrollMonthStart:q,PayrollMonthEnd:R};if(v.J0.SetPayrollDate_1($,z),Y=z.PayrollMonth,q=z.PayrollMonthStart,R=z.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Ae=0;Ae=v.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),Y,q,R),Ae>0&&(v.J0.SetPayrollDate_1($,z,Ae),Y=z.PayrollMonth,q=z.PayrollMonthStart,R=z.PayrollMonthEnd)}re=R.Subtract(q).Days+1}else re=parseInt(f.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=re,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1])}$=$.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&f.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==f.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let O=0,Y=0;for(let q=0;q<this.dsD.Columns[8].length;q++)v.J0.IsEmpty(this.dsD.Tables[8][0][this.dsD.Columns[8][q]])||(O+=parseFloat(this.dsD.Tables[8][0][this.dsD.Columns[8][q]]));for(let q=0;q<this.dsD.Tables[9].length;q++)v.J0.IsEmpty(this.dsD.Tables[9][q].Amount)||(Y+=parseFloat(this.dsD.Tables[9][q].Amount));this.txtCumLeaveSalBalAmt.Text=(O-Y).ToString(f.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(f.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(f.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let O;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let Y=0;Y<this.dsD.Tables[4].length;Y++)O=v.J0.ParseDate(this.dsD.Tables[4][Y].PayrollMonth),this.dgvUPS.Table[Y].dgColUPSPayrollMonth=O.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[Y].dgColUPSMonthDays=O.DaysInMonth(),this.dgvUPS.Table[Y].dgColUPSDaysAtt=0,this.dgvUPS.Table[Y].dgColUPSLOP=0,this.dgvUPS.Table[Y].dgColUPSNetSal=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[Y].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[Y])}let M=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let O=0;O<this.dsD.Tables[10].length;O++)this.dgvLoanBal.Table[O].dgColLoanBalSNo=(O+1).toString(),this.dgvLoanBal.Table[O].dgColLoanBalDocNo=this.dsD.Tables[10][O].DocNo.toString(),this.dgvLoanBal.Table[O].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][O].DocID.toString(),this.dgvLoanBal.Table[O].dgColLoanBalLoanType=this.dsD.Tables[10][O].LoanType.toString(),this.dgvLoanBal.Table[O].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][O].LoanCompID.toString(),this.dgvLoanBal.Table[O].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][O].ApprovedAmt).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[O].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][O].Paid).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[O].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][O].Balance).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[O].dgColLoanBalCalc="Pay",M+=parseFloat(this.dsD.Tables[10][O].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[O])}this.CalculateTotalAmount()}}AutoCalculateLeaveEncashment(){f.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==f.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&this.btnCalcLeaveEncash_Click()}RefreshLeaveEncashDetails(){if(this.EmpSeqNo>0&&(this.dgvLeaveEncash.Clear(),this.dsD.Tables[1].length>0)){this.dgvLeaveEncash.addEmptyRows(this.dsD.Tables[1].length);for(let m=0;m<this.dsD.Tables[1].length;m++){this.dgvLeaveEncash.Table[m+"_Tag"]=this.dsD.Tables[1][m].SNo.toString(),this.dgvLeaveEncash.Table[m].dgColLELeaveType=this.dsD.Tables[1][m].ComponentName.toString(),this.dgvLeaveEncash.Table[m].dgColLELeaveType_Tag=this.dsD.Tables[1][m].ComponentID.toString();let I=0,y=0;if(this.dsD.Tables[1][m].ComponentID.toString()==this.sVacTypeSeqNo)this.dgvLeaveEncash.Table[m].dgColLEAvailable=this.GetVacationAvailability(this.dtpDateOfRelieving.Date,parseInt(this.sVacTypeSeqNo));else{let u={dTaken:0,dAvail:0},M={dAvail:0};this.GetLeavesTaken1(this.dtpDateOfRelieving.Date,this.dtpDateOfJoining.Date,this.dsD.Tables[1][m].ComponentID.toString(),M),I=u.dTaken,y=u.dAvail,this.dgvLeaveEncash.Table[m].dgColLEAvailable=y}this.dgvLeaveEncash.Table[m].dgColLEMaxEncash=parseFloat(this.dgvLeaveEncash.Table[m].dgColLEAvailable)>parseFloat(this.dsD.Tables[1][m].MaxEncashDays)?this.dsD.Tables[1][m].MaxEncashDays.toString():this.dgvLeaveEncash.Table[m].dgColLEAvailable.toString(),this.dgvLeaveEncash.Table[m].dgColLEApplied=0,this.dgvLeaveEncash.Table[m].dgColLEAmount=(0).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.Table[m].dgColLEAmount_Tag=this.dsD.Tables[1][m].EncashFormula.toString(),f.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==f.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&(this.dgvLeaveEncash.Table[m].dgColLEApplied=this.dgvLeaveEncash.Table[m].dgColLEMaxEncash)}this.dgvLeaveEncash.Update()}}GetAvailableLeavesToEncash(m){m.SNo.toString();let u=m.ComponentID.toString();if(this.sVacTypeSeqNo!=u){let M=f.d.common.GetDataSet3("CRM022",this.dtpDocDate.Date.ToString("dd MMM yyyy"),new Date(this.dtpDocDate.Date.getFullYear(),parseInt(f.d.SessionManager.Preferences.LeaveYear.toString()),1).ToString("dd MMM yyyy"),this.EmpSeqNo+"~"+u);if(null!=M&&M.Tables.length>0&&M.Tables[0].length>0){let O=0,Y=0,q=0;return M.Tables[1].length>0&&(Y=parseFloat(M.Tables[1][0].NoOfDays.toString())),M.Tables[2].length>0&&(q=parseFloat(M.Tables[2][0].NoOfDays.toString())),O-Y-q}return 0}try{return 0}catch(M){return this.ViewModel.DisplayMessage="Exception when Calculating Available leaves of Vacation Type",console.log(M),0}}GetVacationAvailability(m,I){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");let y=0,u=[];u.push(m.ToString("dd/MMM/yyyy")),u.push(this.EmpSeqNo),u.push(2),u.push(f.d.SessionManager.UserID),u.push(f.d.SessionManager.LanguageID);let M=f.d.common.GetDataSet_SP(u,"spPAY_GetRemainingVacationDays");if(null!=M&&M.Tables.length>0&&M.Tables[0].length>0){let O=M.Tables[0].filter(Y=>Y.LeaveType==I);null!=O&&O.length>0&&(y=parseFloat(O[0].AvlblDays))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),y.toString()}GetLeavesTaken(m,I,y,u){u.dTaken=u.dAvail=0;let M=[];M.push(m.ToString("dd/MMM/yyyy")),M.push(I.ToString("dd/MMM/yyyy")),M.push(this.EmpSeqNo),M.push(y),M.push("Both"),M.push(f.d.SessionManager.UserID),M.push(f.d.SessionManager.LanguageID);let O=f.d.common.GetDataSet_SP(M,"spPAY_ExtGetAvlblNoofDays");null!=O&&O.Tables.length>0&&O.Tables[0].length>0&&(v.J0.IsEmpty(O.Tables[0][0].LeavesTaken)||(u.dTaken=parseFloat(O.Tables[0][0].LeavesTaken)),v.J0.IsEmpty(O.Tables[0][0].AvailableLeaves)||(u.dAvail=parseFloat(O.Tables[0][0].AvailableLeaves)))}GetLeavesTaken1(m,I,y,u){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken1()"),u.dAvail=0;let M=[];M.push(this.EmpSeqNo),M.push(y),M.push(m.ToString("dd/MMM/yyyy")),M.push(0),M.push(f.d.SessionManager.UserID),M.push(f.d.SessionManager.LanguageID),M.push(0);let O=f.d.common.GetDataSet_SP(M,"spPAY_ExtGetAssignedLeaves");null!=O&&O.Tables.length>0&&O.Tables[0].length>0&&(v.J0.IsEmpty(null!=O.Tables[0][0].AvailableLeaves)||(u.dAvail=v.J0.DoubleTryParse(O.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}CalculateTotalAmount(){let m=0;m+="Partial"==this.cmbSettlementType.SelectedValue?parseFloat(this.txtPartialGratuityAmount.Text):parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken,m+=parseFloat(this.txtLEAmount.Text),m+=parseFloat(this.txtUPSAmount.Text),m+=parseFloat(this.txtOthAddAmount.Text),m-=parseFloat(this.txtOthDedAmount.Text),m+=parseFloat(this.txtNPAmount.Text),m-=parseFloat(this.txtLoanBalAmount.Text),this.txtNetAmount.Text=m.ToString(f.d.SessionManager.sPayrollDecimals)}GenerateSerialNos(m,I=""){for(let y=0;y<m.Table.length;y++)"dgvOthAdd"==I?m.Table[y].dgColOthAddSNo=y+1:m.Table[y].dgColOthDedSNo=y+1;m.invalidate()}LoadGrids(){let m;this.SetGridProperties(this.dgvLeaveEncash),m=new Z.O7,m.DisplayMember="dgColLELeaveType",m.Header=this.GetResource("Leave Type",40095),m.ReadOnly=!0,this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLELeaveType"),m=new Z.O7,m.DisplayMember="dgColLEAvailable",m.Header=this.GetResource("Available Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEAvailable"),m=new Z.O7,m.DisplayMember="dgColLEMaxEncash",m.Header=this.GetResource("Max Encash Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEMaxEncash"),m=new Z.O7,m.DisplayMember="dgColLEApplied",m.Header=this.GetResource("Applied Days",40095),m.TextAlign="Center",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEApplied"),m=new Z.O7,m.DisplayMember="dgColLEAmount",m.Header=this.GetResource("Encash Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLeaveEncash.Columns.push(m),this.dgvLeaveEncash.TableColumns.push("dgColLEAmount"),this.SetGridProperties(this.dgvUPS),m=new Z.O7,m.DisplayMember="dgColUPSPayrollMonth",m.Header=this.GetResource("Payroll Month",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSPayrollMonth"),m=new Z.O7,m.DisplayMember="dgColUPSMonthDays",m.Header=this.GetResource("Month Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSMonthDays"),m=new Z.O7,m.DisplayMember="dgColUPSDaysAtt",m.Header=this.GetResource("Days Attended",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSDaysAtt"),m=new Z.O7,m.DisplayMember="dgColUPSLOP",m.Header=this.GetResource("LOP Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSLOP"),m=new Z.O7,m.DisplayMember="dgColUPSNetSal",m.Header=this.GetResource("Net Salary",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSNetSal"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColUPSCalc",m.Header=this.GetResource("Calculate",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvUPS_CellClick"),this.dgvUPS.Columns.push(m),this.dgvUPS.TableColumns.push("dgColUPSCalc"),this.SetGridProperties(this.dgvNoticePay),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColNPType",m.DisplayMember="Name",m.ValueMember="Value",m.Header=this.GetResource("Type",40095);let I=new Array;I.push(he._p.ComboBoxItems_2("Add","Add")),I.push(he._p.ComboBoxItems_2("Subtract","Subtract")),I.push(he._p.ComboBoxItems_2("None","None")),m.ComboData=I,this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPType"),m=new Z.O7,m.DisplayMember="dgColNPPayrollMonth",m.Header=this.GetResource("Payroll Month",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPPayrollMonth"),m=new Z.O7,m.DisplayMember="dgColNPMonthDays",m.Header=this.GetResource("Month Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPMonthDays"),m=new Z.O7,m.DisplayMember="dgColNPDaysAtt",m.Header=this.GetResource("Days Attended",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPDaysAtt"),m=new Z.O7,m.DisplayMember="dgColNPLOP",m.Header=this.GetResource("LOP Days",40095),m.ReadOnly=!0,m.TextAlign="Center",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPLOP"),m=new Z.O7,m.DisplayMember="dgColNPNetSal",m.Header=this.GetResource("Net Salary",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPNetSal"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColNPCalc",m.Header=this.GetResource("Calculate",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvNoticePay_CellClick"),this.dgvNoticePay.Columns.push(m),this.dgvNoticePay.TableColumns.push("dgColNPCalc"),this.SetGridProperties(this.dgvOthAdd),m=new Z.O7,m.DisplayMember="dgColOthAddSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddSNo"),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColOthAddParticulars",m.DisplayMember="Name",m.ValueMember="NodeID",m.Header=this.GetResource("Particulars",40095),this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddParticulars"),m=new Z.O7,m.DisplayMember="dgColOthAddAmount",m.Header=this.GetResource("Amount",40095),m.TextAlign="Right",this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddAmount"),m=new Z.O7,m.DisplayMember="dgColOthAddRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvOthAdd.Columns.push(m),this.dgvOthAdd.TableColumns.push("dgColOthAddRemarks"),this.SetGridProperties(this.dgvOthDed),m=new Z.O7,m.DisplayMember="dgColOthDedSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedSNo"),m=new Z.O7,m.DataType="ComboBox",m.ValueBinding="dgColOthDedParticulars",m.DisplayMember="Name",m.ValueMember="NodeID",m.Header=this.GetResource("Particulars",40095),this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedParticulars"),m=new Z.O7,m.DisplayMember="dgColOthDedAmount",m.Header=this.GetResource("Amount",40095),m.TextAlign="Right",this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedAmount"),m=new Z.O7,m.DisplayMember="dgColOthDedRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvOthDed.Columns.push(m),this.dgvOthDed.TableColumns.push("dgColOthDedRemarks"),this.SetGridProperties(this.dgvLoanBal),m=new Z.O7,m.DisplayMember="dgColLoanBalSNo",m.Header="#",m.ReadOnly=!0,m.TextAlign="Center",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalSNo"),m=new Z.O7,m.DisplayMember="dgColLoanBalDocNo",m.Header=this.GetResource("Loan Doc. No.",40095),m.ReadOnly=!0,this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalDocNo"),m=new Z.O7,m.DisplayMember="dgColLoanBalLoanType",m.Header=this.GetResource("Loan Type",40095),m.ReadOnly=!0,this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalLoanType"),m=new Z.O7,m.DisplayMember="dgColLoanBalApprAmount",m.Header=this.GetResource("Approved Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalApprAmount"),m=new Z.O7,m.DisplayMember="dgColLoanBalAmountPaid",m.Header=this.GetResource("Amount Paid",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalAmountPaid"),m=new Z.O7,m.DisplayMember="dgColLoanBalBalAmount",m.Header=this.GetResource("Balance Amount",40095),m.ReadOnly=!0,m.TextAlign="Right",this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalBalAmount"),m=new Z.O7,m.DisplayMember="dgColLoanBalRemarks",m.Header=this.GetResource("LineNarration",40095),this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalRemarks"),m=new Z.O7,m.DataType="LINK",m.DisplayMember="dgColLoanBalCalc",m.Header=this.GetResource("Pay",40095),m.TextAlign="Center",m.Click.Subscribe(this,"dgvLoanBal_CellClick"),this.dgvLoanBal.Columns.push(m),this.dgvLoanBal.TableColumns.push("dgColLoanBalCalc")}SetGridProperties(m){m.Table=[],m.Columns=[]}Calculate_Click(m){switch(m){case"Gratuity":this.btnCalcGratuity_Click();break;case"LeaveEncash":this.btnCalcLeaveEncash_Click();break;case"Clear":this.Clear_Click();break;case"Save":this.Save_Click();break;case"Delete":this.Delete_Click();break;case"Previous":this.Previous_Click();break;case"Next":this.Next_Click();break;case"Approve":this.Approve_Click()}return""}Approve_Click(){let m=new Ke.a(this.CostCenterID,this.ViewModel.DocID,null,this.ViewModel);f.d.page.ShowDialog(m,c.H,{ShowCenter:!0,Title:f.d.GetResource("ApproveReject")})}Next_Click(){if(""!=this.ViewModel.DocPrefix.TextBox.Text){let m=0;null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&""!=this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname&&(m=parseInt(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname));let I=(parseInt(this.ViewModel.DocPrefix.TextBox.Text)+1).ToString();for(;I.length<m;)I="0"+I;this.ViewModel.DocPrefix.TextBox.Text=I,this.LoadDocument(parseInt(I),this.Prefix)}}Previous_Click(){""!=this.ViewModel.DocPrefix.TextBox.Text&&(this.iCurDocNo=parseInt(this.ViewModel.DocPrefix.TextBox.Text.Trim()),this.iCurDocNo>1&&this.LoadDocument(this.iCurDocNo-1,this.Prefix))}Delete_Click(){if(""!=this.sDocNo&&parseInt(this.sDocNo)>0){if(confirm("Are you sure want to Delete.?")){let m=0,I=[];I.push(40095),I.push(this.ViewModel.DocID),I.push(1);let y=f.d.document.DeleteSelectedRows(I,m);this.ViewModel.DisplayMessage=y.Message,m=y.RetValue,this.ViewModel.MessageVisibility=!0,this.Clear_Click()}}else this.ViewModel.DisplayMessage="Select any saved Document to Delete",this.ViewModel.MessageVisibility=!0}Save_Click(){if(this.dgvOthAdd.angularGrid&&this.dgvOthAdd.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.dgvOthDed.angularGrid&&this.dgvOthDed.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.ValidateSave()){let m=[];m.push(this.CostCenterID),m.push(this.ViewModel.DocID),m.push(null!=this.Prefix?this.Prefix:""),m.push(null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:""),m.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),m.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),m.push(""),m.push(this.GetDocumentXML()),m.push(""),m.push(""),m.push(this.ViewModel.ViewAttachments.GetXML()),m.push(this.GetActivityXML()),m.push("false"),f.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==f.d.SessionManager.Preferences.EnableLocationWise.toString()?m.push(f.d.SessionManager.LocationID>0?f.d.SessionManager.LocationID:1):m.push(0),f.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==f.d.SessionManager.Preferences.EnableDivisionWise.toString()?m.push(f.d.SessionManager.DivisionID>0?f.d.SessionManager.DivisionID:1):m.push(0),m.push(this.ViewModel.WID),m.push(f.d.SessionManager.RoleID),m.push(""),m.push(0),m.push(0),m.push(f.d.SessionManager.CompanyGUID),m.push(f.d.SessionManager.UserName),m.push(f.d.SessionManager.UserID),m.push(f.d.SessionManager.LanguageID),m.push(f.d.SessionManager.IsOffline);let I=0,y="";f.d.document.SetTempInvDocument(m).subscribe(u=>{I=u.obj;let M=u;if(y=null!=M&&M.Tables.length>0&&M.Tables[M.Tables.length-1].length>0&&M.Columns[M.Tables.length-1].Contains("ErrorMessage")?M.Tables[M.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",I>0){let O=[];O.push(I),O.push(f.d.SessionManager.UserID),O.push(f.d.SessionManager.LanguageID);let Y=this.ViewModel.PostApplyLeaves(parseInt(f.d.SessionManager.CompanyIndex),O,"spPAY_PostApplyLeaves");null!=Y&&Y.Tables.length>0&&(y="Problem in processing your request,Please contact administrator."),this.ViewModel.SelectedEmpID=this.EmpSeqNo,this.Clear_Click()}else null!=M&&M.Tables.length>0&&M.Tables[M.Tables.length-1].length>0&&M.Columns[M.Tables.length-1].Contains("ServerMessage")&&(I="-407"==M.Tables[M.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.ViewModel.DisplayMessage=y,this.ViewModel.MessageVisibility=!0})}}GetActivityXML(){let m='<XML  SysInfo="'+f.d.SessionManager.GetSysInfo()+'" AP="Desktop" ';return"Approve"==this.ViewModel.sCmdParameter&&(m+=' AppRejDate="'+Date.Today().ToString("dd/MMM/yyyy")+'"'),m+=" >",m+=" </XML> ",m}GetDocumentXML(){let R,I="",y="",u="",M="",O="",Y="";if(new Array,null!=f.d.SessionManager.dtDocDefAccs&&(R=f.d.SessionManager.dtDocDefAccs.filter(U=>40095==U.CostCenterID&&"CreditAccount"==U.SysColumnName),null!=R&&R.length>0&&null!=R[0].UserDefaultValue&&""!=R[0].UserDefaultValue.toString().Trim()&&(O=R[0].UserDefaultValue.toString()),R=f.d.SessionManager.dtDocDefAccs.filter(U=>40095==U.CostCenterID&&"DebitAccount"==U.SysColumnName),null!=R&&R.length>0&&null!=R[0].UserDefaultValue&&""!=R[0].UserDefaultValue.toString().Trim()&&(Y=R[0].UserDefaultValue.toString())),y+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="'+parseFloat(this.txtNetAmount.Text)+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+f.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+Y+'" CreditAccount="'+O+'" CommonNarration="'+v.J0.EncodeXML(this.txtRemarks.Text),null!=this.dgvGratuity&&this.dgvGratuity.Table.length>0){let U=1;for(let k=0;k<this.dgvGratuity.Table.length;k++)I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Gratuity',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='1',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha4='"+this.lblGratuityServiceDays+"',",u+=" dcAlpha5='"+this.lblGratuityLOPDays+"',",u+=" dcAlpha6='"+this.lblGratuityBalDays+"',",u+=" dcAlpha7='"+this.lblGratuityTotalGrDays+"',",u+=" dcAlpha8='"+this.GratuityRemarks.Text+"',",u+=" dcAlpha9='"+this.GratuityGrade+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.cmbResignType.SelectedValue+"',",u+=" dcAlpha12='"+this.chkCalcBasedOnLastSal.IsChecked+"',",u+=" dcAlpha13='"+this.chkCalcBasedOnActDays.IsChecked+"',",u+=" dcAlpha14='"+this.lblGratuityTotalDays+"',",u+=" dcAlpha15='"+this.dgvGratuity.Table[k][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha16='"+this.dgvGratuity.Table[k+1][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha17='"+this.dgvGratuity.Table[k+1][this.dgvGratuity.TableColumns[4]]+"',",u+=" dcAlpha18='"+this.dgvGratuity.Table[k+2][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha19='"+this.dgvGratuity.Table[k+3][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha20='"+this.dgvGratuity.Table[k+3][this.dgvGratuity.TableColumns[4]]+"',",u+=" dcAlpha21='"+this.dgvGratuity.Table[k+5][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha22='"+this.dgvGratuity.Table[k+5][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha23='"+this.dgvGratuity.Table[k+5][this.dgvGratuity.TableColumns[3]]+"',",u+=" dcAlpha24='"+this.dgvGratuity.Table[k+6][this.dgvGratuity.TableColumns[1]]+"',",u+=" dcAlpha25='"+this.dgvGratuity.Table[k+6][this.dgvGratuity.TableColumns[2]]+"',",u+=" dcAlpha26='"+this.dgvGratuity.Table[k+6][this.dgvGratuity.TableColumns[3]]+"',",u+=" dcAlpha27='"+this.dgvGratuity.Table[k+6][this.dgvGratuity.TableColumns[5]]+"',",u+=" dcAlpha28='"+this.dgvGratuity.Table[k+6][this.dgvGratuity.TableColumns[7]]+"',",u+=" dcAlpha29='"+this.dgvGratuity.Table[k+7][this.dgvGratuity.TableColumns[5]]+"',",u+=" dcAlpha30='"+this.dgvGratuity.Table[k+3][this.dgvGratuity.TableColumns[6]]+"',",u+=" dcAlpha31='"+this.GratuityDocID+"',",u+=" dcAlpha32='"+this.lblGratuityTaken+"',",u+=" dcAlpha33='"+this.cmbResignReason.SelectedValue+"',",u+=" dcAlpha34='"+this.dgvGratuity.Table[k+1][this.dgvGratuity.TableColumns[6]]+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",k+=8,U++}if(null!=this.dgvLeaveEncash&&this.dgvLeaveEncash.Table.length>0){let U=1;for(let k=0;k<this.dgvLeaveEncash.Table.length;k++)0!=v.J0.Double(this.dgvLeaveEncash.Table[k].dgColLEAmount)&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leave Encashment',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",u+=" dcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",u+=" dcCalcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='2',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.LeaveRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvLeaveEncash.Table[k+"_Tag"].toString()+"',",u+=" dcAlpha12='"+this.dgvLeaveEncash.Table[k].dgColLELeaveType+"',",u+=" dcAlpha13='"+this.dgvLeaveEncash.Table[k].dgColLEAvailable+"',",u+=" dcAlpha14='"+this.dgvLeaveEncash.Table[k].dgColLEMaxEncash+"',",u+=" dcAlpha15='"+this.dgvLeaveEncash.Table[k].dgColLEApplied+"',",u+=" dcAlpha16='"+this.dgvLeaveEncash.Table[k].dgColLEAmount.toString().Replace(",","")+"',",u+=" dcAlpha17='"+this.chkLECalcBasedOnLastApprSerYearWise.IsChecked+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}if(null!=this.dgvUPS&&this.dgvUPS.Table.length>0){let U=1;for(let k=0;k<this.dgvUPS.Table.length;k++)v.J0.Double(this.dgvUPS.Table[k].dgColUPSNetSal)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Un-Processed Salary',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='3',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.UPSRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvUPS.Table[k].dgColUPSPayrollMonth+"',",u+=" dcAlpha12='"+this.dgvUPS.Table[k].dgColUPSMonthDays+"',",u+=" dcAlpha13='"+this.dgvUPS.Table[k].dgColUPSDaysAtt+"',",u+=" dcAlpha14='"+this.dgvUPS.Table[k].dgColUPSLOP+"',",u+=" dcAlpha15='"+this.dgvUPS.Table[k].dgColUPSNetSal.toString().Replace(",","")+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}if(null!=this.dgvNoticePay&&this.dgvNoticePay.Table.length>0){let U=1;for(let k=0;k<this.dgvNoticePay.Table.length;k++)v.J0.Double(this.dgvNoticePay.Table[k].dgColNPNetSal)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Notice Pay',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='4',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.NoticePayRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvNoticePay.Table[k].dgColNPPayrollMonth+"',",u+=" dcAlpha12='"+this.dgvNoticePay.Table[k].dgColNPMonthDays+"',",u+=" dcAlpha13='"+this.dgvNoticePay.Table[k].dgColNPDaysAtt+"',",u+=" dcAlpha14='"+this.dgvNoticePay.Table[k].dgColNPLOP+"',",u+=" dcAlpha15='"+this.dgvNoticePay.Table[k].dgColNPNetSal.toString().Replace(",","")+"',",u+=" dcAlpha16='"+this.dgvNoticePay.Table[k].dgColNPType+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}if(null!=this.dgvOthAdd&&this.dgvOthAdd.Table.length>0){let U=1;for(let k=0;k<this.dgvOthAdd.Table.length;k++)!v.J0.IsEmpty(this.dgvOthAdd.Table[k].dgColOthAddParticulars)&&v.J0.Double(this.dgvOthAdd.Table[k].dgColOthAddAmount)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Additions',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='5',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.OAddRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvOthAdd.Table[k].dgColOthAddParticulars+"',",u+=" dcAlpha12='"+this.dgvOthAdd.Table[k].dgColOthAddAmount.toString().Replace(",","")+"',",v.J0.IsEmpty(this.dgvOthAdd.Table[k].dgColOthAddRemarks)||(u+=" dcAlpha13='"+this.dgvOthAdd.Table[k].dgColOthAddRemarks+"',"),u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}if(null!=this.dgvOthDed&&this.dgvOthDed.Table.length>0){let U=1;for(let k=0;k<this.dgvOthDed.Table.length;k++)!v.J0.IsEmpty(this.dgvOthDed.Table[k].dgColOthDedParticulars)&&v.J0.Double(this.dgvOthDed.Table[k].dgColOthDedAmount)>0&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Deductions',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='6',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.ODedRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvOthDed.Table[k].dgColOthDedParticulars+"',",u+=" dcAlpha12='"+this.dgvOthDed.Table[k].dgColOthDedAmount.toString().Replace(",","")+"',",null!=this.dgvOthDed.Table[k].dgColOthDedRemarks&&""!=this.dgvOthDed.Table[k].dgColOthDedRemarks.toString().Trim()&&(u+=" dcAlpha13='"+this.dgvOthDed.Table[k].dgColOthDedRemarks+"',"),u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}if(null!=this.dgvLoanBal&&this.dgvLoanBal.Table.length>0){let U=1;for(let k=0;k<this.dgvLoanBal.Table.length;k++)!v.J0.IsEmpty(this.dgvLoanBal.Table[k].dgColLoanBalDocNo_Tag)&&null!=this.dgvLoanBal.Table[k].dgColLoanBalCalc_Tag&&(I+="\x11",I+="<Row>",I+="<AccountsXML></AccountsXML>",I+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan Balances',M="",I+=M.length>0?'" DocDetailsID="'+M:'" DocDetailsID="',I+=y.toString()+'" ></Transactions>',u='<Numeric Query="',u+=" dcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",u+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",u+='" ></Numeric>',I+=u,u='<Alpha Query="',u+=" dcAlpha1='7',",u+=" dcAlpha2='"+U+"',",u+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",u+=" dcAlpha8='"+this.LoanRemarks.Text+"',",u+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",u+=" dcAlpha11='"+this.dgvLoanBal.Table[k].dgColLoanBalDocNo+"',",u+=" dcAlpha12='"+this.dgvLoanBal.Table[k].dgColLoanBalDocNo_Tag+"',",u+=" dcAlpha13='"+this.dgvLoanBal.Table[k].dgColLoanBalLoanType_Tag+"',",u+=" dcAlpha14='"+this.dgvLoanBal.Table[k].dgColLoanBalApprAmount.toString().Replace(",","")+"',",u+=" dcAlpha15='"+this.dgvLoanBal.Table[k].dgColLoanBalAmountPaid.toString().Replace(",","")+"',",u+=" dcAlpha16='"+this.dgvLoanBal.Table[k].dgColLoanBalBalAmount.toString().Replace(",","")+"',",u+=" dcAlpha17='"+this.dgvLoanBal.Table[k].dgColLoanBalSNo_Tag+"',",u+='" ></Alpha>',I+=u,u='<CostCenters Query="',u+=" dcCCNID51="+this.EmpSeqNo+",",u+=" dcCCNID53="+this.EmpGrade+",",u+='" ></CostCenters>',I+=u,I+="<EXTRAXML></EXTRAXML>",I+="</Row>",U++)}return I.toString()}GetCalcXML(){let m="";if(m+="<Rows>",this.dgvGratuity.Table.length>0){let I=1;for(let y=0;y<this.dgvGratuity.Table.length;y++)m+='<Row DType="1" SubDType="'+I+'" Field1="'+this.cmbResignType.SelectedValue+'" Field2="'+this.chkCalcBasedOnLastSal.IsChecked+'" Field3="'+this.chkCalcBasedOnActDays.IsChecked+'" Field4="'+this.lblGratuityTotalDays+'" Field5="'+this.dgvGratuity.Table[y][this.dgvGratuity.TableColumns[1]]+'" Field6="'+this.dgvGratuity.Table[y+1][this.dgvGratuity.TableColumns[2]]+'" Field7="'+this.dgvGratuity.Table[y+1][this.dgvGratuity.TableColumns[4]]+'" Field8="'+this.dgvGratuity.Table[y+2][this.dgvGratuity.TableColumns[1]]+'" Field9="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[1]]+'" Field10="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[4]]+'" Field11="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[1]]+'" Field12="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[2]]+'" Field13="'+this.dgvGratuity.Table[y+5][this.dgvGratuity.TableColumns[3]]+'" Field14="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[1]]+'" Field15="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[2]]+'" Field16="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[3]]+'" Field17="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[5]]+'" Field18="'+this.dgvGratuity.Table[y+6][this.dgvGratuity.TableColumns[7]]+'" Field19="'+this.dgvGratuity.Table[y+7][this.dgvGratuity.TableColumns[5]]+'" Field20="'+this.dgvGratuity.Table[y+3][this.dgvGratuity.TableColumns[6]],m+='" />',y+=8,I++}if(this.dgvLeaveEncash.Table.length>0)for(let I=0;I<this.dgvLeaveEncash.Table.length;I++)0!=v.J0.Double(this.dgvLeaveEncash.Table[I].dgColLEAmount)&&(m+='<Row DType="2" SubDType="'+I+'1" Field1="'+this.dgvLeaveEncash.Table[I+"_Tag"].toString()+'" Field2="'+this.dgvLeaveEncash.Table[I].dgColLELeaveType+'" Field3="'+this.dgvLeaveEncash.Table[I].dgColLEAvailable+'" Field4="'+this.dgvLeaveEncash.Table[I].dgColLEMaxEncash+'" Field5="'+this.dgvLeaveEncash.Table[I].dgColLEApplied+'" Field6="'+this.dgvLeaveEncash.Table[I].dgColLEAmount,m+='" />');if(this.dgvUPS.Table.length>0)for(let I=0;I<this.dgvUPS.Table.length;I++)v.J0.Double(this.dgvUPS.Table[I].dgColUPSNetSal)>0&&(m+='<Row DType="3" SubDType="'+I+'1" Field1="'+this.dgvUPS.Table[I].dgColUPSPayrollMonth+'" Field2="'+this.dgvUPS.Table[I].dgColUPSMonthDays+'" Field3="'+this.dgvUPS.Table[I].dgColUPSDaysAtt+'" Field4="'+this.dgvUPS.Table[I].dgColUPSLOP+'" Field5="'+this.dgvUPS.Table[I].dgColUPSNetSal,m+='" />');if(this.dgvNoticePay.Table.length>0)for(let I=0;I<this.dgvNoticePay.Table.length;I++)v.J0.Double(this.dgvNoticePay.Table[I].dgColNPNetSal)>0&&(m+='<Row DType="4" SubDType="'+I+'1" Field1="'+this.dgvNoticePay.Table[I].dgColNPPayrollMonth+'" Field2="'+this.dgvNoticePay.Table[I].dgColNPMonthDays+'" Field3="'+this.dgvNoticePay.Table[I].dgColNPDaysAtt+'" Field4="'+this.dgvNoticePay.Table[I].dgColNPLOP+'" Field5="'+this.dgvNoticePay.Table[I].dgColNPNetSal+'" Field6="'+this.dgvNoticePay.Table[I].dgColNPType,m+='" />');if(this.dgvOthAdd.Table.length>0)for(let I=0;I<this.dgvOthAdd.Table.length;I++)!v.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddParticulars)&&v.J0.Double(this.dgvOthAdd.Table[I].dgColOthAddAmount)>0&&(m+='<Row DType="5" SubDType="'+I+'1" Field1="'+this.dgvOthAdd.Table[I].dgColOthAddParticulars+'" Field2="'+this.dgvOthAdd.Table[I].dgColOthAddAmount,v.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddRemarks)||(m+='" Field3="'+this.dgvOthAdd.Table[I].dgColOthAddRemarks),m+='" />');if(this.dgvOthDed.Table.length>0)for(let I=0;I<this.dgvOthDed.Table.length;I++)!v.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedParticulars)&&v.J0.Double(this.dgvOthDed.Table[I].dgColOthDedAmount)>0&&(m+='<Row DType="6" SubDType="'+I+'1" Field1="'+this.dgvOthDed.Table[I].dgColOthDedParticulars+'" Field2="'+this.dgvOthDed.Table[I].dgColOthDedAmount,v.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedRemarks)||(m+='" Field3="'+this.dgvOthDed.Table[I].dgColOthDedRemarks),m+='" />');if(this.dgvLoanBal.Table.length>0)for(let I=0;I<this.dgvLoanBal.Table.length;I++)v.J0.IsEmpty(this.dgvLoanBal.Table[I].dgColLoanBalDocNo_Tag)||(m+='<Row DType="7" SubDType="'+I+'1" Field1="'+this.dgvLoanBal.Table[I].dgColLoanBalDocNo+'" Field2="'+this.dgvLoanBal.Table[I].dgColLoanBalDocNo_Tag+'" Field3="'+this.dgvLoanBal.Table[I].dgColLoanBalLoanType_Tag+'" Field4="'+this.dgvLoanBal.Table[I].dgColLoanBalApprAmount+'" Field5="'+this.dgvLoanBal.Table[I].dgColLoanBalAmountPaid+'" Field6="'+this.dgvLoanBal.Table[I].dgColLoanBalBalAmount+'" Field7="'+this.dgvLoanBal.Table[I].dgColLoanBalSNo_Tag,m+='" />');return m+="</Rows>",m.toString()}ValidateSave(){if(0==this.EmpSeqNo)return this.ViewModel.DisplayMessage="Please Select Employee.",this.EmployeeList.SetFocus=!0,!1;if(null!=this.dsD&&this.dsD.Tables[0].length>0&&"Final"==this.cmbSettlementType.SelectedValue&&(9e3==v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()||null==this.dsD.Tables[0][0].DORelieve.toString()||""==this.dsD.Tables[0][0].DORelieve.toString()||null==this.dsD.Tables[0][0].DORelieve||""==v.J0.String(this.dsD.Tables[0][0].ResignStatus)||"Posted"!=v.J0.String(this.dsD.Tables[0][0].ResignStatus)))return this.ViewModel.DisplayMessage="Selected Employee not yet Resigned, Please check",!1;let m=f.d.report.GetDataTable("FS001",this.EmpSeqNo.toString(),this.ViewModel.DocID.toString());if(null!=m&&m.length>0)return this.ViewModel.DisplayMessage="Cannot save the record, Employee FinalSettlement is Already done",this.ViewModel.MessageVisibility=!0,!1;if(("Final"==this.cmbSettlementType.SelectedValue||"Partial"==this.cmbSettlementType.SelectedValue&&f.d.SessionManager.Preferences.ContainsKey("PartialFinalSettlementMandatoryRepaymentofloan")&&"True"==f.d.SessionManager.Preferences.PartialFinalSettlementMandatoryRepaymentofloan.toString())&&this.dgvLoanBal.Table.length>0)for(let I=0;I<this.dgvLoanBal.Table.length;I++)if(v.J0.IsEmpty(this.dgvLoanBal.Table[I].dgColLoanBalCalc_Tag))return this.ViewModel.DisplayMessage="Please pay pending Loan Balance amounts.",!1;return null!=f.d.SessionManager.Preferences.PayrollProduct&&""!=f.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(f.d.SessionManager.Preferences.PayrollProduct)),0!=this.DefProdID||(this.ViewModel.DisplayMessage="Select any Default Payroll Product at Global Preferences",!1)}btnCalcGratuity_Click(){this.dgvGratuity.Columns.Clear(),this.dgvGratuity.TableColumns.Clear(),this.dgvGratuity.Clear();let m={dTotGratuitySal:0};if(this.dEarnedGrDays=0,this.isMaxDaysExceded=!1,this.dTotGratuityDays=0,!(this.EmpSeqNo>0))return this.ViewModel.DisplayMessage="Select any Employee",void(this.EmployeeList.SetFocus=!0);{let M=f.d.common.GetDataSet3("CRM023",this.EmpSeqNo.toString(),this.dtpDateOfRelieving.Date.Date().ToString("dd MMM yyyy"));if(null!=M&&M.Tables.length>0){if(this.isConsdExpiredupto=!1,4==this.cmbResignType.SelectedIndex&&M.Tables[0].length>0){let O=0;O=v.J0.IntTryParse(M.Tables[0][0].ConsdExpiredupto),O>0&&(this.dtpDateOfRelieving.Date=this.DOB.AddYears(O),this.isConsdExpiredupto=!0)}if(this.dLOPDays=0,this.dLOPDays=parseFloat(this.dsD.Tables[0][0].OPLOPDays),M.Tables[2].length>0)if(null!=this.dtEdit&&this.dtEdit.length>0){let O=this.dtEdit.filter(Y=>"1"==Y.dcAlpha1&&"1"==Y.dcAlpha2);null!=O&&O.length>0&&(this.dGratuityTaken=parseFloat(""==v.J0.String(O[0].dcAlpha32)?"0":O[0].dcAlpha32))}else this.dGratuityTaken=parseFloat(M.Tables[2][0].GratuityTaken);if(!(M.Tables[0].length>0))return void(this.ViewModel.DisplayMessage="Gratuity settings not found for this Grade.");{this.EOS_ROffYear=v.J0.DoubleTryParse(M.Tables[0][0].ROffYear);let q,O=this.dtpDateOfJoining.Date.Date(),Y=this.dtpDateOfRelieving.Date.Date();if(this.EOS_ROffYear>0){let h=0,C=0;if(v.J0.GetYearsMonthsDays(O,Y,{iY22:0,iM22:h,iD22:C}),h>=this.EOS_ROffYear){let D=0;C>0?(D=12-h,Y=Y.AddMonths(D).AddDays(-C)):Y=Y.AddMonths(-h).AddDays(-C)}else Y=Y.AddMonths(-h).AddDays(-C)}if(this.LoadExperinceDaysData(this.lst,M.Tables[0],"Resigned"==this.cmbResignType.SelectedValue?0:"Expired"==this.cmbResignType.SelectedValue?2:1),this.GratuityDocID=parseInt(M.Tables[0][0].DocID),this.GratuityGrade=parseInt(M.Tables[0][0].GradeID),this.EOS_MaxDays=v.J0.Double(M.Tables[0][0].MaxDays),this.EOS_ExcludeLOP=M.Tables[0][0].ExcludeLOP.toString(),this.ActEOS_ExcludeLOP=M.Tables[0][0].ExcludeLOP.toString(),this.EOS_ROff=v.J0.Double(M.Tables[0][0].ROff),this.EOS_CalcBasedOn=M.Tables[0][0].CalcBasedOn.toString(),this.EOS_GratuityFormula=M.Tables[0][0].Formula.toString(),this.EOS_AvailedFormula=null!=M.Tables[0][0].AvailedFormula&&null!=M.Tables[0][0].AvailedFormula&&""!=M.Tables[0][0].AvailedFormula.toString().Trim()?M.Tables[0][0].AvailedFormula.toString():"GratuityAmount","Exclude at Last"==this.EOS_ExcludeLOP){this.EOS_ExcludeLOP="No";let r={PayrollMonth:I=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:u=new Date};v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,r),I=r.PayrollMonth,u=r.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,r,this.EmpGrade),I=r.PayrollMonth,u=r.PayrollMonthEnd);let h=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),C=I,g=0;if(f.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==f.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())g=this.GetLOPDaysFromDoc(h,u),this.dLOPDays+=g;else{g=this.GetPreviousLOPDays(h,C),this.dLOPDays+=g;let D=f.d.common.GetDataSet3("CRM024",this.EmpSeqNo.toString(),h.ToString("dd/MMM/yyyy"),C.ToString("dd/MMM/yyyy"));null!=D&&D.Tables.length>0&&(D.Tables[0].length>0&&(this.dLOPDays+=parseFloat(D.Tables[0][0].LOP.toString())),D.Tables[1].length>0&&(this.dLOPDays-=parseFloat(D.Tables[1][0].LOP.toString())))}Y=Y.AddDays(-this.dLOPDays)}for(let r=0;r<8;r++)q=new Z.O7,q.DisplayMember="Column"+r,q.ReadOnly=!0,q.Header="",q.Width=0==r?150:80,this.dgvGratuity.Columns.push(q),this.dgvGratuity.TableColumns.push(q.DisplayMember);if(this.dgvGratuity.RefreshColumns(),this.dActServiceDays=Y.Subtract(O).Days+1,"Service Days"==this.EOS_CalcBasedOn){if(this.dServiceDaysAfterLOP=0,"No"!=this.EOS_ExcludeLOP){var I,u;let g={PayrollMonth:I=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:u=new Date};v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,g),I=g.PayrollMonth,u=g.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,g,this.EmpGrade),I=g.PayrollMonth,u=g.PayrollMonthEnd);let D=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),p=I,e=0;if(f.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==f.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())e=this.GetLOPDaysFromDoc(D,u),this.dLOPDays+=e;else{e=this.GetPreviousLOPDays(D,p),this.dLOPDays+=e;let T=f.d.common.GetDataSet3("CRM025",this.EmpSeqNo.toString(),D.ToString("dd/MMM/yyyy"),p.ToString("dd/MMM/yyyy"));null!=T&&T.Tables.length>0&&T.Tables[0].length>0&&(this.dLOPDays+=parseFloat(T.Tables[0][0].LOP.toString()))}}this.dServiceDaysAfterLOP=this.dActServiceDays-this.dLOPDays,this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("ServiceDays",this.dActServiceDays.toString()),this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("LOPDays",this.dLOPDays.toString()),this.EOS_AvailedFormula=this.EOS_AvailedFormula.Replace("ServiceDays",this.dActServiceDays.toString())}this.dblGratuityAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly);let R=this.dtpDateOfJoining.Date.Date(),U=this.dtpDateOfRelieving.Date.Date(),k=0,V=0,$=0,ee={iY:k,iM:V,iD:$};if(v.J0.GetYearsMonthsDays(R,U,ee),k=ee.iY,V=ee.iM,$=ee.iD,"Service Days"==this.EOS_CalcBasedOn){this.CalcGratuityBasedOnServiceDays(this.dblGratuityAmount,O,Y,m);let r=0,h=0,C=0,g={iY:r,iM:h,iD:C};v.J0.GetYearsMonthsDays(O,Y,g),r=g.iY,h=g.iM,C=g.iD,this.lblGratuityTotalDays=r+" : "+this.GetResource("Years",40095)+", "+h+" : "+this.GetResource("Months",40095)+", "+C+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=m.dTotGratuitySal.ToString(f.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount(),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let D={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),D),this.oEvalPayFormulas.PayrollMonth=D.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=D.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=D.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),g,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=D.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=D.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=D.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),M.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(M.Tables[1].length);for(let p=0;p<M.Tables[1].length;p++)this.oCPF=new fe.ph,this.oCPF.ComponentName="Lookup"+M.Tables[1][p].NodeID.toString(),this.oCPF.SNo=p+1,null!=M.Tables[0][0][M.Tables[1][p].SysColumnName.toString()]&&null!=M.Tables[0][0][M.Tables[1][p].SysColumnName.toString()]&&(this.oCPF.Formula=M.Tables[0][0][M.Tables[1][p].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[p].dgColOthAddParticulars=parseInt(M.Tables[1][p].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[p])}this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=k,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let p=0;p<this.oEvalPayFormulas.arrLstCPFields[6].length;p++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][p].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(f.d.SessionManager.sPayrollDecimals):(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][p].dEarned).ToString(f.d.SessionManager.sPayrollDecimals);else for(let e=0;e<this.dgvOthAdd.Table.length;e++)if(this.oEvalPayFormulas.arrLstCPFields[6][p].ComponentName=="Lookup"+v.J0.String(this.dgvOthAdd.Table[e].dgColOthAddParticulars)){this.dgvOthAdd.Table[e].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][p].dEarned).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[e]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}return}let z,re=O,Oe=0,Ve=0,we=0,De={iY:Oe,iM:Ve,iD:we};v.J0.GetYearsMonthsDays(O,Y,De),Oe=De.iY,Ve=De.iM,we=De.iD;let Ie=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked,ze=this.dblGratuityAmount,ye=new Array,Ne=new Array,G=new Array;ye.push(re);for(let r=0;r<this.lst.length;r++){if(Oe<parseInt(this.lst[r].Year.Replace("=",""))){Ne.push(Y),G.push(G.length>0?G[G.length-1]:0);break}if(this.lst[r].Days>0){if(this.lst[r].IsApplyToPrevYrs)for(let h=0;h<G.length;h++)G[h]=this.lst[r].Days;if(z=re.AddYears(parseInt(this.lst[r].Year.Replace("=",""))).AddDays(-1),z>=Y){z=Y,Ne.push(z),G.push(this.lst[r].Days);break}G.Contains(this.lst[r].Days)?(Ne[Ne.length-1]=z,ye[ye.length-1]=z.AddDays(1)):(G.push(this.lst[r].Days),Ne.push(z),ye.push(z.AddDays(1)))}}if(this.isLast=!1,ye.length>0)for(let r=0;r<ye.length;r++)if(r==ye.length-1&&(this.isLast=!0),Ie){if(ye.length>r+1)if(G[r]!=G[r+1]){if(this.CalcGratuityDays(G[r],ze,ye[r],Ne[r],m),this.isMaxDaysExceded)break}else Ne[r]=Ne[r+1],ye.RemoveAt(r+1),Ne.RemoveAt(r+1),G.RemoveAt(r+1),r--;else if(this.isConsdExpiredupto){if(this.CalcGratuityDays(G[r],ze,ye[r],this.dtActRelievingDate,m),this.isMaxDaysExceded||(this.CalcGratuityDays(G[r],ze,this.dtActRelievingDate.AddDays(1),Ne[r],m),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(G[r],ze,ye[r],Ne[r],m),this.isMaxDaysExceded)break}else if(ye.length>r+1)if(G[r]!=G[r+1]){let h=this.dsD.Tables[3].filter(g=>v.J0.ParseDate(g.dtEffectFrom)>=ye[r].AddDays(1)&&v.J0.ParseDate(g.dtEffectFrom)<=Ne[r]),C=this.dsD.Tables[3].filter(g=>v.J0.ParseDate(g.dtEffectFrom)<=ye[r]);if(C.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=h&&h.length>0){let D,g=0;for(g=0;g<h.length;g++)if(0==g){if(this.CalcGratuityDays(G[r],parseFloat(C[0].BasicMonthly),ye[r],v.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),m),this.isMaxDaysExceded){D=!0;break}}else if(this.CalcGratuityDays(G[r],parseFloat(h[g-1].BasicMonthly),v.J0.ParseDate(h[g-1].dtEffectFrom),v.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),m),this.isMaxDaysExceded){D=!0;break}if(D||(this.CalcGratuityDays(G[r],parseFloat(h[g-1].BasicMonthly),v.J0.ParseDate(h[g-1].dtEffectFrom),Ne[r],m),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(G[r],parseFloat(C[0].BasicMonthly),ye[r],Ne[r],m),this.isMaxDaysExceded)break}else Ne[r]=Ne[r+1],ye.RemoveAt(r+1),Ne.RemoveAt(r+1),G.RemoveAt(r+1),r--;else{let h=this.dsD.Tables[3].filter(g=>v.J0.ParseDate(g.dtEffectFrom)>=ye[r].AddDays(1)&&v.J0.ParseDate(g.dtEffectFrom)<=Ne[r]),C=this.dsD.Tables[3].filter(g=>v.J0.ParseDate(g.dtEffectFrom)<=ye[r]);if(C.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=h&&h.length>0){let D,g=0;for(g=0;g<h.length;g++)if(0==g){if(this.CalcGratuityDays(G[r],parseFloat(C[0].BasicMonthly),ye[r],v.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),m),this.isMaxDaysExceded){D=!0;break}}else if(this.CalcGratuityDays(G[r],parseFloat(h[g-1].BasicMonthly),v.J0.ParseDate(h[g-1].dtEffectFrom),v.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),m),this.isMaxDaysExceded){D=!0;break}if(D||(this.CalcGratuityDays(G[r],parseFloat(h[g-1].BasicMonthly),v.J0.ParseDate(h[g-1].dtEffectFrom),Ne[r],m),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(G[r],parseFloat(C[0].BasicMonthly),ye[r],Ne[r],m),this.isMaxDaysExceded)break}let a=0,l=0,t=0,i={iY:a,iM:l,iD:t};v.J0.GetYearsMonthsDays(O,Y,i),a=i.iY,l=i.iM,t=i.iD,this.lblGratuityTotalDays=a+" : "+this.GetResource("Years",40095)+", "+l+" : "+this.GetResource("Months",40095)+", "+t+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=m.dTotGratuitySal.ToString(f.d.SessionManager.sPayrollDecimals);let o=this.dtpDateOfRelieving.Date.Date().Subtract(O.Date()).Days+1;if(this.lblGratuityServiceDays=o.toString(),this.lblGratuityLOPDays=this.dLOPDays.toString(),this.lblGratuityBalDays=(o-this.dLOPDays).toString(),this.lblGratuityTotalGrDays=this.dTotGratuityDays.toString(),this.lblGratuityTaken=this.dGratuityTaken.toString(),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),ee={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),ee),this.oEvalPayFormulas.PayrollMonth=ee.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=ee.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=ee.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),ee,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=ee.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=ee.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=ee.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),M.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(M.Tables[1].length);for(let r=0;r<M.Tables[1].length;r++)this.oCPF=new fe.ph,this.oCPF.ComponentName="Lookup"+M.Tables[1][r].NodeID.toString(),this.oCPF.SNo=r+1,v.J0.IsEmpty(M.Tables[0][0][M.Tables[1][r].SysColumnName.toString()])||(this.oCPF.Formula=M.Tables[0][0][M.Tables[1][r].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[r].dgColOthAddParticulars=parseInt(M.Tables[1][r].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[r])}this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=k,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let r=0;r<this.oEvalPayFormulas.arrLstCPFields[6].length;r++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][r].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(f.d.SessionManager.sPayrollDecimals):(0).ToString(f.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][r].dEarned).ToString(f.d.SessionManager.sPayrollDecimals);else for(let h=0;h<this.dgvOthAdd.Table.length;h++)if(this.oEvalPayFormulas.arrLstCPFields[6][r].ComponentName=="Lookup"+v.J0.String(this.dgvOthAdd.Table[h].dgColOthAddParticulars)){this.dgvOthAdd.Table[h].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][r].dEarned).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[h]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}}}}this.CalculateTotalAmount()}LoadExperinceDaysData(m,I,y){m.Clear();let u="Res";1==y?u="Term":2==y&&(u="Expired");for(let M=0;M<I.length;M++)m.push(new ha),m[M].Year=I[M][u+"Exp"].toString().Contains("+")?I[M][u+"Exp"].toString().Replace("[+]",""):"="+I[M][u+"Exp"].toString(),m[M].Days=parseFloat(I[M][u+"GrDays"]),m[M].IsApplyToPrevYrs="Yes"==I[M][u+"ApplyPrevYrs"].toString()}CalcGratuityDays(m,I,y,u,M){this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity/Year",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=m;let O=m,Y="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),Y=this.GetResource("Start Date",40095)+y.ToString("dd/MMM/yyyy")+"          ",Y+=this.GetResource("End Date",40095)+u.ToString("dd/MMM/yyyy");let R=0,U=0,k=0,V=this.dtpDateOfJoining.Date.Date(),$=this.dtpDateOfRelieving.Date.Date(),ee=0,re=0,z=0,Ae={iY:ee,iM:re,iD:z};v.J0.GetYearsMonthsDays(V,u,Ae),ee=Ae.iY,re=Ae.iM,z=Ae.iD;let Pe=0,Oe=0,Ve=0,we={iY:Pe,iM:Oe,iD:Ve};v.J0.GetYearsMonthsDays(y,u,we),Pe=we.iY,Oe=we.iM,Ve=we.iD;let De=0;if("No"!=this.EOS_ExcludeLOP){var Ie=new Date,nt=new Date,ze=new Date,ye={PayrollMonth:Ie,PayrollMonthStart:nt,PayrollMonthEnd:ze};if(v.J0.SetPayrollDate_1(u,ye),Ie=ye.PayrollMonth,nt=ye.PayrollMonthStart,ze=ye.PayrollMonthEnd,f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(u,ye,this.EmpGrade),Ie=ye.PayrollMonth,nt=ye.PayrollMonthStart,ze=ye.PayrollMonthEnd),f.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==f.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())De=this.GetLOPDaysFromDoc(y,u);else{De=this.GetPreviousLOPDays(y,Ie);let C=f.d.common.GetDataSet3("CRM026",this.EmpSeqNo.toString(),y.ToString("dd/MMM/yyyy"),Ie.ToString("dd/MMM/yyyy"));null!=C&&C.Tables.length>0&&C.Tables[0].length>0&&(De+=parseFloat(C.Tables[0][0].LOP.toString()))}let r=u;r=y==this.dtpDateOfJoining.Date.Date()?r.AddDays(-(this.dLOPDays+De)):r.AddDays(-De);let h={iY:Pe,iM:Oe,iD:Ve};v.J0.GetYearsMonthsDays(y,r,h),Pe=h.iY,Oe=h.iM,Ve=h.iD,this.dLOPDays+=De}R=Pe*O,U=Oe/12*O,k=Ve/365*O,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=y.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=u.ToString("dd/MMM/yyyy"),"Exclude at Last"==this.ActEOS_ExcludeLOP&&u.ToString("dd MMM yyyy")==$.AddDays(-this.dLOPDays).ToString("dd MMM yyyy")&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Actual End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=$.ToString("dd/MMM/yyyy"));let Ne=!!this.chkCalcBasedOnActDays.IsChecked&&this.chkCalcBasedOnActDays.IsChecked,G=0,a=0,l=0;if(Ne){let C,r=y,h=u,g=0,D=0;for(;r<=h;){if(C=new Date(r.getFullYear(),r.getMonth(),r.DaysInMonth()),!(C<=h)){g=h.Subtract(r).Days+1,a+=g,D=I*g/C.getDate(),l+=D;break}g=C.Subtract(r).Days+1,a+=g,D=I*g/C.getDate(),l+=D,r=C.AddDays(1)}G=l/a}let t=u.Subtract(y).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let i=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=I,i=I,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=Pe+" : "+this.GetResource("Years",40095)+", "+Oe+" : "+this.GetResource("Months",40095)+", "+Ve+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=t,"Exclude at Last"==this.ActEOS_ExcludeLOP?this.isLast&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Total LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=this.dLOPDays):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=De),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("Months",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=Pe,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=Oe,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=Ve,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Available Gratuity",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=R,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=U,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=k;let o=R+U+k;if(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=o,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",o=H.RoundOffValue(o,this.EOS_ROff),this.EOS_MaxDays>0&&this.dEarnedGrDays+o>=this.EOS_MaxDays?(o=this.EOS_MaxDays-this.dEarnedGrDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=o,this.isMaxDaysExceded=!0):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=o,this.dEarnedGrDays+=o),this.dTotGratuityDays+=o,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity",40095),Ne)this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=l+" / "+a,i=G*o;else{let r=this.dtpDateOfJoining.Date.Date(),h=this.dtpDateOfRelieving.Date.Date(),C=0,g=0,D=0,p={iY:C,iM:g,iD:D};v.J0.GetYearsMonthsDays(r,h,p),C=p.iY,g=p.iM,D=p.iD;let e=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked;this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),p={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},e?(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),p),f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),p,this.EmpGrade)):(v.J0.SetPayrollDate_1(y.Date(),p),f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(y.Date(),p,this.EmpGrade)),this.oEvalPayFormulas.PayrollMonth=p.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=p.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=p.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula.Replace("GratuityDays",o.toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=I,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=C,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let T=0;T<this.oEvalPayFormulas.arrLstCPFields[6].length;T++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][T].ComponentName){i=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][T].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=i,M.dTotGratuitySal+=i,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.refreshDataView()}GetPreviousLOPDays(m,I){let y=0,u=f.d.common.GetDataSet3("CRM027",this.EmpSeqNo.toString(),m.ToString("dd/MMM/yyyy"),I.ToString("dd/MMM/yyyy")).Tables[0];return null!=u&&u.length>0&&(y=parseFloat(u[0].LOPDays)),y}GetLOPDaysFromDoc(m,I){let y=0;if(f.d.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=f.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){let u=[];u.push(this.EmpSeqNo),u.push(m.ToString("dd/MMM/yyyy")),u.push(m.ToString("dd/MMM/yyyy")),u.push(I.ToString("dd/MMM/yyyy")),u.push(2),u.push(f.d.SessionManager.UserID),u.push(f.d.SessionManager.RoleID),u.push(f.d.SessionManager.LanguageID);let M=f.d.common.GetDataSet_SP(u,"spPAY_GetEmpAdjDetailsMultiple"),O=[];O.push(m.ToString("dd MMM yyyy")),O.push(""),O.push(0),O.push(f.d.SessionManager.RoleID),O.push(f.d.SessionManager.UserID),O.push(f.d.SessionManager.LanguageID);let Y=f.d.common.GetDataSet_SP(O,"spPAY_GetEmpMasterCCDetails");null!=M&&M.Tables.length>0&&M.Tables[0].length>0&&M.Columns[0].Contains("EmpSeqNo")&&(y=this.AggregateLeaves(this.EmpSeqNo.toString(),M,m,I,Y,this.dsD.Tables[0],this.EmpGrade))}return y}static RoundOffValue(m,I){if(I>0&&m>0){let y=0,u=!1;y=m%I,y>0&&(I/y<=2&&(u=!0),m-=y,u&&(m+=I))}return m}CalcGratuityBasedOnServiceDays(m,I,y,u){this.dgvGratuity.addEmptyRow();let M="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),M=this.GetResource("Start Date",40095)+I.ToString("dd/MMM/yyyy")+"          ",M+=this.GetResource("End Date",40095)+y.ToString("dd/MMM/yyyy");let O=0,Y=0,q=0,R={iY:O,iM:Y,iD:q};v.J0.GetYearsMonthsDays(I,y,R),O=R.iY,Y=R.iM,q=R.iD,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=I.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=y.ToString("dd/MMM/yyyy");let U=y.Subtract(I).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let k=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=m,k=m,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=O+" : "+this.GetResource("Years",40095)+", "+Y+" : "+this.GetResource("Months",40095)+", "+q+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=U,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Total Duration Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Service Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dActServiceDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.dLOPDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.dServiceDaysAfterLOP,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dServiceDaysAfterLOP,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]="/",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]="365";let V=this.dServiceDaysAfterLOP/365;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=V,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=V,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity Amount",40095);{this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let $={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),$),f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),$,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=$.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=$.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=$.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=m,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=O,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let ee=0;ee<this.oEvalPayFormulas.arrLstCPFields[6].length;ee++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][ee].ComponentName){this.dServiceDaysFormulaAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][ee].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.dServiceDaysFormulaAmount,u.dTotGratuitySal+=this.dServiceDaysFormulaAmount,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]="* * * * *"}dgvLeaveEncash_CellValidating(m,I){}btnCalcLeaveEncash_Click(){let m=this.chkLECalcBasedOnLastApprSerYearWise.IsChecked;this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let I={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),I),f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),I,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=I.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=I.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=I.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear();let y=0;if(this.dgvLeaveEncash.Table.length>0){for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)m&&this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag==this.sVacTypeSeqNo||v.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEApplied)||(v.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag)||(this.strFormula=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays",this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag==this.sVacTypeSeqNo?"("+this.dgvLeaveEncash.Table[M].dgColLEApplied.toString()+")":"("+this.dgvLeaveEncash.Table[M].dgColLEApplied.toString().Replace("-","!")+")"),this.oCPF=new fe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[M+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF));this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas();for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)if((!m||this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag!=this.sVacTypeSeqNo)&&0!=v.J0.Double(this.dgvLeaveEncash.Table[M].dgColLEApplied))for(let O=0;O<this.oEvalPayFormulas.arrLstCPFields[6].length;O++)if(this.oEvalPayFormulas.arrLstCPFields[6][O].ComponentName=="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString()){this.dgvLeaveEncash.Table[M].dgColLEAmount=this.oEvalPayFormulas.arrLstCPFields[6][O].dEarned,y+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][O].dEarned);break}}let u=0;if(m&&this.dgvLeaveEncash.Table.length>0)for(let M=0;M<this.dgvLeaveEncash.Table.length;M++)if(this.dgvLeaveEncash.Table[M].dgColLELeaveType_Tag.toString()==this.sVacTypeSeqNo){if(!v.J0.IsEmpty(this.dgvLeaveEncash.Table[M].dgColLEApplied)&&parseFloat(this.dgvLeaveEncash.Table[M].dgColLEApplied)>0){let U,k,Y=parseFloat(this.dgvLeaveEncash.Table[M].dgColLEApplied),q=0,R=null;try{U=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate())}catch{U=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate()-1)}for(U>this.dtpDateOfRelieving.Date&&(U=U.AddYears(-1)),k=this.dtpDateOfRelieving.Date;Y>0;){R=this.ViewModel.GetVacationDays(U,k,this.EmpSeqNo),q=parseFloat(R.Tables[1][0].CreditedDays),q>Y&&(q=Y),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let V={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(k,V),f.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==f.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(k,V,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=V.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=V.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=V.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),null!=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag&&""!=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString().Trim()&&(this.strFormula=this.dgvLeaveEncash.Table[M].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+q.toString().Replace("-","!")+")"),this.oCPF=new fe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[M+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[M+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.oEvalPayFormulas.dsAllEmpsData.Tables[2][this.dsD.Tables[2].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),u+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned),Y=parseFloat((Y-q).ToString("0.00")),k=U.AddDays(-1),U=U.AddYears(-1)}this.dgvLeaveEncash.Table[M].dgColLEAmount=u}break}this.txtLEAmount.Text=(parseFloat(this.txtCumLeaveSalBalAmt.Text)+y+u).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.invalidate(),this.CalculateTotalAmount()}dgvUPS_CellClick(m,I){if("dgColUPSCalc"==this.dgvUPS.Columns[m.cell].DisplayMember){v.J0.SetPayrollMonth(v.J0.ParseDate(this.dgvUPS.Table[m.row].dgColUPSPayrollMonth));let y=new Ye.MonthlyPayrollViewModel("Monthly Payroll","UnProcessed");y.sProcessType="UnProcessed",y.SelectedEmpID=this.EmpSeqNo,y.EmployeeList.Code.SelectedValue=y.EmployeeList.Name.SelectedValue=this.EmpSeqNo,y.EmployeeList.Code.Text=y.EmployeeList.Name.Text=this.EmployeeList.Text,y.InitSelectedEmployee(),f.d.page.ShowDialog(y,Fe.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{y.DialogResult&&(this.dgvUPS.Table[m.row].dgColUPSDaysAtt=y.dFS_DaysAttended,this.dgvUPS.Table[m.row].dgColUPSLOP=y.dFS_LOPDays,this.dgvUPS.Table[m.row].dgColUPSNetSal=y.dFS_NetSal,this.dgvUPS.updateRow(this.dgvUPS[m.row]));let u=0;if(this.dgvUPS.Table.length>0)for(let M=0;M<this.dgvUPS.Table.length;M++)u+=parseFloat(this.dgvUPS.Table[M].dgColUPSNetSal);this.txtUPSAmount.Text=u.ToString(f.d.SessionManager.sPayrollDecimals),this.dgvUPS.invalidate(),this.CalculateTotalAmount()})}}dgvNoticePay_CellClick(m,I){if("dgColNPCalc"==this.dgvNoticePay.Columns[m.cell].DisplayMember){v.J0.SetPayrollMonth(v.J0.ParseDate(this.dgvNoticePay.Table[m.row].dgColNPPayrollMonth));let y=new Ye.MonthlyPayrollViewModel("Monthly Payroll","NoticePay");y.sProcessType="NoticePay",y.SelectedEmpID=this.EmpSeqNo,y.EmployeeList.Code.SelectedValue=y.EmployeeList.Name.SelectedValue=this.EmpSeqNo,y.EmployeeList.Code.Text=y.EmployeeList.Name.Text=this.EmployeeList.Text,y.InitSelectedEmployee(),f.d.page.ShowDialog(y,Fe.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{y.DialogResult&&(this.dgvNoticePay.Table[m.row].dgColNPDaysAtt=y.dFS_DaysAttended,this.dgvNoticePay.Table[m.row].dgColNPLOP=y.dFS_LOPDays,this.dgvNoticePay.Table[m.row].dgColNPNetSal=y.dFS_NetSal,this.dgvNoticePay.updateRow(this.dgvNoticePay[m.row])),this.dgvNoticePay.Update(),this.CalculateNoticePayAmount()})}}CalculateNoticePayAmount(){let m=0;if(this.dgvNoticePay.Table.length>0)for(let I=0;I<this.dgvNoticePay.Table.length;I++)"Add"==v.J0.String(this.dgvNoticePay.Table[I].dgColNPType)?m+=parseFloat(this.dgvNoticePay.Table[I].dgColNPNetSal):"Subtract"==v.J0.String(this.dgvNoticePay.Table[I].dgColNPType)&&(m-=parseFloat(this.dgvNoticePay.Table[I].dgColNPNetSal));this.txtNPAmount.Text=m.ToString(f.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthAdd_CellEndEdit(m,I){null==I&&(I=m.cell),"dgColOthAddAmount"==this.dgvOthAdd.Columns[I].DisplayMember&&(this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd")),"dgColOthAddAmount"==this.dgvOthAdd.Columns[I].DisplayMember&&this.CalculateOthAddAmount()}dgvOthAdd_RowsAdded(m,I){this.GenerateSerialNos(this.dgvOthAdd)}CalculateOthAddAmount(){let m=0;for(let I=0;I<this.dgvOthAdd.Table.length;I++)v.J0.IsEmpty(this.dgvOthAdd.Table[I].dgColOthAddAmount)||(m+=parseFloat(this.dgvOthAdd.Table[I].dgColOthAddAmount));this.txtOthAddAmount.Text=m.ToString(f.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthDed_CellEndEdit(m,I){null==I&&(I=m.cell),"dgColOthDedAmount"==this.dgvOthDed.Columns[I].DisplayMember&&(this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")),"dgColOthDedAmount"==this.dgvOthDed.Columns[I].DisplayMember&&this.CalculateOthDedAmount()}dgvOthDed_RowsAdded(m,I){this.GenerateSerialNos(this.dgvOthDed)}CalculateOthDedAmount(){let m=0;for(let I=0;I<this.dgvOthDed.Table.length;I++)v.J0.IsEmpty(this.dgvOthDed.Table[I].dgColOthDedAmount)||(m+=parseFloat(this.dgvOthDed.Table[I].dgColOthDedAmount));this.txtOthDedAmount.Text=m.ToString(f.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dtpDateOfRelieving_SelectedDateChanged(m,I){this.PrevEmpSeqNo==this.EmpSeqNo&&0==v.J0.GetDateDifference(this.dtpDateOfRelieving.Date,this.dtPrevDateOfRelieving)||(this.PrevEmpSeqNo=this.EmpSeqNo,this.dtPrevDateOfRelieving=this.dtpDateOfRelieving.Date,this.RefreshLeaveEncashDetails())}btnSaveAndPrint_Click(m){this.ViewModel.SelectedEmpID>0?(this.Save_Click(),this.ViewModel.IsSaved&&this.ViewModel.DocID>0&&(this.PrintFS("SaveAndPrint"),this.ViewModel.IsSaved=!1,this.ViewModel.SelectedEmpID=0)):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrint_Click(m){return this.ViewModel.DocID>0?(this.PrintFS("Print"),""):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0,"")}PrintFS(m){this.MoreThanOneLayout=!1;let y=this.ViewModel.DocID;this.IsExportPrint=!1;let u=null,M=He.VoucherExportExcel.GetLocationPrintLayouts(50051,0,y);if(this.IsExportPrint)u=null;else{if(null==M||0==M.Tables[0].length)return f.d.GetResource("Err_PrintLayoutNotDefined");if(M.Tables[0].length>1){this.MoreThanOneLayout=!0;let O=new tt.VPTDialogViewModel(M.Tables[0]);f.d.page.ShowDialog(O,Ft.VPTDialogComponent,{ShowCenter:!0},()=>{if(O.IsOkClicked&&(u=O.SelectedRow),null!=u){let q=new K.bT;q.push("IsFSDoc","1"),f.d.report.ExportPDF_Masters(50051,y.toString(),parseInt(u.DocPrintLayoutID),"PDF","",q).subscribe(R=>{"Export"==m?f.d.SessionManager.Download(R.FileName,R.FileName):(f.d.SessionManager.printTab(R.FileName),v.J0.IsEmpty(R.Message)&&!v.J0.IsEmpty(R.FileName)&&(this.ViewModel.DisplayMessage="Printed Sucessfully"))},R=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(R)})}})}else u=M.Tables[0][0]}if(this.dsTotLayouts=M,this.drSelPrintLayout=u,null!=u&&!this.MoreThanOneLayout){let O=new K.bT;O.push("IsFSDoc","1"),f.d.report.ExportPDF_Masters(50051,y.toString(),parseInt(u.DocPrintLayoutID),"PDF","",O).subscribe(Y=>{console.log(Y),f.d.SessionManager.Download(Y.FileName,Y.FileName),f.d.SessionManager.printTab(Y.FileName),v.J0.IsEmpty(Y.Message)&&!v.J0.IsEmpty(Y.FileName)&&(this.ViewModel.DisplayMessage="printed Successfully")},Y=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(Y)})}return""}btnPrintPreview_Click(m){this.ViewModel.DocID>0?this.PrintFS("Preview"):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnExport_Click(m){if(!(this.ViewModel.DocID>0))return this.ViewModel.DisplayMessage="Load document in Edit Mode",void(this.ViewModel.MessageVisibility=!0);this.PrintFS("Export")}dgvLoanBal_CellClick(m,I){if("dgColLoanBalCalc"==this.dgvLoanBal.Columns[m.cell].DisplayMember){let M=f.d.common.GetDataTable("CRM028","");if(null!=M&&M.length>0){let O,Y=Date.Today(),q=this.dsD.Tables[11].filter(R=>R.RefNo==this.dgvLoanBal.Table[m.row].dgColLoanBalDocNo);if(q.length>0){O=new be.AddEditDocumentViewModel(40057,"Loan Repayment",!0,"IsFrmFS_LoanBal"),O.ScreenObject.Link.LinkCombo.Enable=!1,O.ScreenObject.Link.DocumentList.Enable=!1,O.ScreenObject.Preferences.Selective="false";let R={value:Y};O.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(q[0].DocID),R,!1),Y=R.value}else{O=new be.AddEditDocumentViewModel(40057,"Loan Repayment",!1,"IsFrmFS_LoanBal"),O.ScreenObject.Link.LinkCombo.SelectedValue=M[0].DocumentLinkDefID.toString(),O.ScreenObject.Link.LinkCombo.Enable=!1,O.ScreenObject.Link.DocumentList.Enable=!1,O.ScreenObject.Preferences.Selective="false";let R=O.ScreenObject._CCFields.find(U=>"dcCCNID51"==U.DBColumnName);null!=R&&(R instanceof d.y$||R instanceof le.G)&&(R.SelectedValue=this.EmpSeqNo),O.OLinkSelectionChanged(null)}O.IsFrmFS_LoanBal=!0;var y=O.ScreenObject.HeaderFields.find(R=>R instanceof Qe.MI&&"DocDate"==R.DBColumnName.toString());y&&(y.Enable=!1),(y=O.ScreenObject.HeaderFields.find(R=>R instanceof Qe.MI&&"VoucherNo"==R.DBColumnName.toString()))instanceof Xe.e3&&(y.Enable=!1,y.LoadVisibility=!1,y.PreviousVisibility=!1,y.NextVisibility=!1);var u=O.ScreenObject.Link.DocumentList.Items.find(R=>R.Value==this.dgvLoanBal.Table[m.row].dgColLoanBalDocNo_Tag.toString());u&&(u.IsChecked=!0,O.OnLinkDocumentCheckedChanged(u)),(y=O.ScreenObject._CCFields.find(R=>"dcCCNID51"==R.DBColumnName))&&(y.Enable=!1),(y=O.ScreenObject._TextFields.find(R=>"dcAlpha6"==R.DBColumnName))instanceof Le.Dw&&(y.Text="FFS_LoanBalances");for(let R=0;R<O.ScreenObject.GridData.length;R++)v.J0.IsEmpty(O.ScreenObject.GridData[R].ProductID_Key)||(O.ScreenObject.GridData[R].dcAlpha5=this.dtpDocDate.Date.ToString(f.d.SessionManager.Preferences["Date Format"]),O.ScreenObject.GridData[R].dcAlpha5_Key=this.dtpDocDate.Date.toString());f.d.page.ShowDialog(O,yt.AddEditDocumentComponent),O.DialogResult&&(this.txtLoanBalAmount.Text=(parseFloat(this.txtLoanBalAmount.Text)+O.dFS_LoanAmt).ToString(f.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[m.row].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[m.row].dgColLoanBalSNo_Tag=O.RetValue,this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[m.row])),this.CalculateTotalAmount()}}}NumberValidationTextBox(m,I){}GetResource(m,I){let y=m;return null!=this.ViewModel.dsRes1&&this.ViewModel.dsRes1.Tables.length>0&&this.ViewModel.dsRes1.Tables[0].length>0&&(this.drwRes=this.ViewModel.dsRes1.Tables[0].filter(u=>u.CCID==I&&u.Code=="'"+m+"'")),null!=this.drwRes&&this.drwRes.length>0?this.drwRes[0].AliasName.toString():y}cmbSettlementType_SelectionChanged(m,I){this.txtPartialGratuityAmount.IsReadOnly="Partial"!=this.cmbSettlementType.SelectedValue}AggregateLeaves(m,I,y,u,M,O,Y){let V,$,Ae,q=0,R=0,k=0,ee=f.d.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),re=" 1=1 ",z="";if(Ae=I.Tables[2],null!=ee&&null!=ee&&ee.length>0)for(let De=0;De<ee.length;De++)v.J0.IsEmpty(ee[De])||(z="CCNID"+(parseInt(ee[De])-5e4),V=M.Tables[0].filter(Ie=>Ie.EmpSeqNo==m),null!=V&&V.length>0&&(z.Contains("CCNID51")?(re+=" AND ( "+z+"="+V[0].EmpSeqNo+" OR "+z+"= 1)",Ae=Ae.filter(Ie=>Ie[z]==V[0].EmpSeqNo||1==Ie[z])):(re+=" AND ( "+z+"="+V[0][z]+" OR "+z+"= 1)",Ae=Ae.filter(Ie=>Ie[z]==V[0][z]||1==Ie[z]))));" 1=1 "!=re&&(this.drcWOffAdjDef=Ae);let Oe,Ve,we,Pe=I.Tables[3];if(ee=f.d.SessionManager.Preferences.HolidaysBasedOn.split(","),re=" 1=1 ",z="",null!=ee&&null!=ee&&ee.length>0)for(let De=0;De<ee.length;De++)v.J0.IsEmpty(ee[De])||(z="CCNID"+(parseInt(ee[De])-5e4),V=M.Tables[0].filter(Ie=>Ie.EmpSeqNo==m),null!=V&&V.length>0&&(z.Contains("CCNID51")?(re+=" AND ( "+z+"="+V[0].EmpSeqNo+" OR "+z+"= 1)",Pe=Pe.filter(Ie=>Ie[z]==V[0].EmpSeqNo||1==Ie[z])):(re+=" AND ( "+z+"="+V[0][z]+" OR "+z+"= 1)",Pe=Pe.filter(Ie=>Ie[z]==V[0][z]||1==Ie[z]))));if(" 1=1 "!=re&&($=Pe),null!=$&&$.length>0&&(this.dtHolidayAdjDef=$),we=I.Tables[0].filter(De=>De.EmpSeqNo==m),!v.J0.IsEmpty(we)&&null!=we&&we.length>0)for(let De=0;De<we.length;De++){Oe=v.J0.ParseDate(we[De].FromDate),Ve=v.J0.ParseDate(we[De].ToDate),k=parseInt(we[De].ComponentID);let Ie=f.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),nt=null;Ie.length>0&&(nt=Ie.split(",")),Oe>=y?Ve<=u?(R=parseFloat(we[De].NoOfDays),q+=R):Oe<=u&&(R=this.GetNoOfDays(Oe,u,k,I,O,Y),q+=R):Ve<=u?Ve>=y&&(R=this.GetNoOfDays(y,Ve,k,I,O,Y),q+=R):(R=this.GetNoOfDays(y,u,k,I,O,Y),q+=R)}return q}GetNoOfDays(m,I,y,u,M,O){let Y=0,q=0,R=0,U=null,k=u.Tables[1].filter(V=>V.GradeID==O&&4==V.Type&&V.ComponentID==y);if(null!=k&&k.length>0){let V=m,$=k[0].IncludeRExclude.toString();if(Y=v.J0.GetDateDifference(I,m)+1,"IncludeBoth"==$||""==$)return Y;if("IncludeWeeklyOffs"==$)for(;V<=I;)v.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(ee=>ee.HolidayDate==V.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&R++,V=V.AddDays(1);else if("IncludeHolidays"==$)for(;V<=I;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(V,u,m,I,M)&&q++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff1&&q++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff2&&q++),V=V.AddDays(1);else if("ExcludeBoth"==$)for(;V<=I;){let ee=!1;v.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(re=>re.HolidayDate==V.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&(R++,ee=!0),null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(V,u,m,I,M)&&!ee&&q++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&!ee&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff1&&!ee&&q++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&!ee&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff2&&!ee&&q++),V=V.AddDays(1)}else if("ExcludeWeeklyOffs"==$)for(;V<=I;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(V,u,m,I,M)&&q++:("NONE"!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff1.toString()&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff1&&q++,"NONE"!=M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?M.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=M.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&V.getDay().toString()==M.drcAllEmpsData[0].WeeklyOff2.toString()&&q++:V.getDay().toString()==f.d.SessionManager.Preferences.WeeklyOff2&&q++),V=V.AddDays(1);else if("ExcludeHolidays"==$)for(;V<=I;)v.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(ee=>ee.HolidayDate==V.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&R++,V=V.AddDays(1)}return Y-(q+R)}CheckIsWeeklyOffFromDef(m,I,y,u,M){if(null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0){let U,O=1,q=M.DateOfRelieve<u?M.DateOfRelieve:u,R=M.DateOfJoining>y?M.DateOfJoining:y;for(;R<=q;){for(U=R.AddDays(6);R<=U&&R<=q;){if(I.Columns[2].Contains("Week"+O.toString()+"_W1")&&!v.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+O.toString()+"_W1"].toString())&&R.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+O.toString()+"_W1"].toString().toLowerCase()){if(R.ToString("dd MMM yyyy")==m.ToString("dd MMM yyyy"))return!0}else if(I.Columns[2].Contains("Week"+O.toString()+"_W2")&&!v.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+O.toString()+"_W2"].toString())&&R.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+O.toString()+"_W2"].toString().toLowerCase()&&R.ToString("dd MMM yyyy")==m.ToString("dd MMM yyyy"))return!0;R=R.AddDays(1)}O++}}return!1}get Prefix(){let m="";return null!=this.ViewModel.DocPrefix&&null!=this.ViewModel.DocPrefix.ComboBox.SelectedValue&&(m=this.ViewModel.DocPrefix.ComboBox.SelectedValue),m}OnDocPrefixChanged(m){this.OnDocPrefixChanged_2(m,!1),null!=m&&"lostFocus"==m.toString()||this.Clear_Click()}OnDocPrefixChanged_2(m,I=!1){if(Logger.InfoLog("FinalSettlement::Entering OnDocPrefixChanged"),null!=m)try{let y={value:this._Ddate};this.OnDocPrefixChanged_3(m,0,0,y,I),this._Ddate=y.value}catch(y){this.ViewModel.DisplayMessage="Error Loading document try again",Logger.ErrorLog("FinalSettlement","OnDocPrefixChanged",y.stack)}Logger.InfoLog("FinalSettlement::Exiting OnDocPrefixChanged")}OnDocPrefixChanged_3(m,I,y,u,M){let O=0;if(null!=m&&"lostFocus"==m.toString()){this.IsRefLCTR=!1,Logger.InfoLog("FinalSettlement:: Inside GetDocument");let R=null;v.J0.IsValidID(y)?(R=f.d.document.GetEditData(this.CostCenterID,"","","0",this.ViewModel.DocID,"",!0),null!=R&&R.Tables.length>0&&R.Columns[0].Contains("DocPrefix")&&R.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(U=>U instanceof he._p&&U.Value==R.Tables[0][0].DocPrefix.toString())||this.ViewModel.DocPrefix.ComboBox.Items.push(he._p.ComboBoxItems_2(R.Tables[0][0].DocPrefix.toString(),R.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=R.Tables[0][0].DocPrefix.toString(),this.ViewModel.DocPrefix.TextBox.Text=R.Tables[0][0].DocNumber.toString())):(R=f.d.document.GetEditData(this.CostCenterID,this.Prefix,null!=this.ViewModel.DocPrefix.TextBox.Text?this.ViewModel.DocPrefix.TextBox.Text:"",I,"0","",!0),null!=R&&R.Tables.length>0&&R.Columns[0].Contains("DocPrefix")&&R.Tables[0].length>0&&(this.ViewModel.DocPrefix.ComboBox.Items.find(k=>k instanceof he._p&&k.Value==R.Tables[0][0].DocPrefix.toString())||(this.ViewModel.DocPrefix.ComboBox.Items.push(he._p.ComboBoxItems_2(R.Tables[0][0].DocPrefix.toString(),R.Tables[0][0].DocPrefix.toString())),this.ViewModel.DocPrefix.ComboBox.SelectedValue=R.Tables[0][0].DocPrefix.toString()))),R.Tables.length>1&&R.Tables[0].length>0&&!R.Columns[0].Contains("ErrorMessage")?(this.guid=v.J0.String(R.Tables[0][0].GUID),O=parseInt(R.Tables[0][0].StatusID),this.LoadDocument(parseInt(this.ViewModel.DocPrefix.TextBox.Text),this.Prefix),v.J0.IsEmpty(R.Tables[0][0].DocDate)||(u.value=v.J0.ParseDate(R.Tables[0][0].DocDate))):this.Clear_Click(),Logger.InfoLog("VoucherGenerator:: Exiting GetDocument")}else if(null!=m){this.IsRefLCTR=!1;let R=f.d.document.getcurrentcode(this.CostCenterID,this.Prefix);null!=R&&R.Tables.length>0&&R.Tables[0].length>0&&!R.Columns[0].Contains("ErrorMessage")&&R.Columns[0].Contains("CurrentCodeNumber")&&!v.J0.IsNullOrWhiteSpace(R.Tables[0][0].CurrentCodeNumber)?(this.ViewModel.DocPrefix.TextBox.Text=R.Tables[0][0].CurrentCodeNumber.toString(),null!=this.ViewModel.DocPrefix.ComboBox.SelectedItem&&(v.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)||"1"==this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname)&&R.Columns[0].Contains("Codelength")&&!v.J0.IsEmpty(R.Tables[0][0].Codelength)&&parseInt(R.Tables[0][0].Codelength)>1&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem.Aliasname=R.Tables[0][0].Codelength.toString())):this.ViewModel.DocPrefix.TextBox.Text="1"}}fillPrefixes(m){let I="",y=0;for(let M=0;M<m.length;M++)if(0==M&&(y=parseInt(m[M].SeriesNo.toString())),""!=m[M].SeriesNo.toString()&&parseInt(m[M].SeriesNo.toString())!=y&&(null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(I)&&this.ViewModel.DocPrefix.Prefixes.push(I,(0,et.yG0)(m[M-1].Isdefault.toString())),y=parseInt(m[M].SeriesNo.toString()),I=""),51==parseInt(m[M].CCID.toString())||52==parseInt(m[M].CCID.toString())||53==parseInt(m[M].CCID.toString()))I+="'"+m[M].Length.toString()+"'"+m[M].Delimiter.toString();else if(54==parseInt(m[M].CCID.toString()))I+=m[M].Length.toString()+m[M].Delimiter.toString();else if(parseInt(m[M].CCID.toString())>5e4){var u=this.ViewModel.oEmpFilter.CostCenterFilters.find(O=>O.CostCenterID==parseInt(m[M].CCID.toString()));null!=u&&u.SelectedNodes.length>0&&(I+=this.GetTrimString(this.ViewModel.GetDocNumberString(m[M].SysColumnName.toString(),u.CostCenterID,u.SelectedNodes[0].Id),parseInt(m[M].Length.toString()))+m[M].Delimiter.toString())}m.length>0&&null!=this.ViewModel.DocPrefix&&!this.ViewModel.DocPrefix.Prefixes.ContainsKey(I)&&this.ViewModel.DocPrefix.Prefixes.push(I,(0,et.yG0)(m[m.length-1].Isdefault.toString())),this.ViewModel.FillDocumentPrefix(!1)}CheckDateInDocNumber(m,I=!0){let y=!1,u="";if(null==this.ViewModel.DocPrefix)return;let M=new K.bT;if(this.ViewModel.DocPrefix.Prefixes.keys.forEach(O=>{null!=O&&(u=O);let Y=this.ViewModel.DocPrefix.Prefixes[O];u.Contains("'DD'")?(y=!0,u=this.dtpDocDate.Date.getDate()>9?u.replace("'DD'",this.dtpDocDate.Date.getDate().toString()):u.replace("'DD'","0"+this.dtpDocDate.Date.getDate().toString())):u.Contains("'D'")&&(y=!0,u=u.replace("'D'",this.dtpDocDate.Date.getDate().toString())),u.Contains("'MMM'")?(y=!0,u=u.replace("'MMM'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!1))):u.Contains("'MM'")?(y=!0,u=this.dtpDocDate.Date.iMonth()>9?u.replace("'MM'",this.dtpDocDate.Date.iMonth().toString()):u.replace("'MM'","0"+this.dtpDocDate.Date.iMonth().toString())):u.Contains("'M'")?(y=!0,u=u.replace("'M'",this.dtpDocDate.Date.iMonth().toString())):u.Contains("'Name'")&&(y=!0,u=u.replace("'Name'",this.GetMonthName(this.dtpDocDate.Date.iMonth(),!0))),u.Contains("'YYYY'")?(y=!0,u=u.replace("'YYYY'",this.dtpDocDate.Date.getFullYear().toString())):u.Contains("'YY'")?(y=!0,u=u.replace("'YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2))):u.Contains("'YY-YY'")&&(y=!0,u=this.dtpDocDate.Date.iMonth()<f.d.SessionManager.AccountingFromMonth?u.replace("'YY-YY'",(this.dtpDocDate.Date.getFullYear()-1).toString().substr(2)+"-"+this.dtpDocDate.Date.getFullYear().toString().substr(2)):u.replace("'YY-YY'",this.dtpDocDate.Date.getFullYear().toString().substr(2)+"-"+(this.dtpDocDate.Date.getFullYear()+1).toString().substr(2))),y||Y?this.ViewModel.DocPrefix.ComboBox.Items.find(R=>R.Value==u)?M.ContainsKey(u)||M.push(u,Y):(this.ViewModel.DocPrefix.ComboBox.Items.push(he._p.ComboBoxItems_4(u,u,"","1")),M.ContainsKey(u)||M.push(u,Y),I&&(Y||1==this.ViewModel.DocPrefix.Prefixes.length)&&(this.ViewModel.DocPrefix.ComboBox.SelectedItem=this.ViewModel.DocPrefix.ComboBox.Items[this.ViewModel.DocPrefix.ComboBox.Items.length-1],this.ViewModel.DocPrefix.ComboBox.SelectedValue=u)):(null==this.ViewModel.DocPrefix.ComboBox.Items.find(R=>R.Value==u)&&this.ViewModel.DocPrefix.ComboBox.Items.push(he._p.ComboBoxItems_4(u,u,"","1")),M.ContainsKey(u)||M.push(u,Y))}),y&&M.length>0&&!m&&I&&!v.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)&&!M.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue)){let O=M.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==O&&M.length>0?M.keys[0]:O.Key}else if(y&&M.length>0&&m&&I&&(v.J0.IsEmpty(this.ViewModel.DocPrefix.ComboBox.SelectedValue)||!M.ContainsKey(this.ViewModel.DocPrefix.ComboBox.SelectedValue))){let O=M.GetItemByValue(!0);this.ViewModel.DocPrefix.ComboBox.SelectedValue=null==O&&M.length>0?M.keys[0]:O.Key}else if(!y&&m){let O=this.ViewModel.DocPrefix.Prefixes.values.indexOf(!0);if(u=-1==O&&this.ViewModel.DocPrefix.Prefixes.length>0?this.ViewModel.DocPrefix.Prefixes.keys[0]:this.ViewModel.DocPrefix.Prefixes.keys[O],null!=u){let Y=this.ViewModel.DocPrefix.ComboBox.Items.find(q=>q.Value==u);v.J0.IsEmpty(Y)&&this.ViewModel.DocPrefix.ComboBox.Items.push(he._p.ComboBoxItems_4(u,u,"","1")),this.ViewModel.DocPrefix.ComboBox.SelectedValue=u}}m||I&&(this.ViewModel.DisplayMessage="")}GetTrimString(m,I){return null!=m&&I>=0&&m.length>I?m.substr(0,I):m}GetMonthName(m,I){m>12&&(m-=12);let y="";switch(m){case 1:y=I?"January":"Jan";break;case 2:y=I?"February":"Feb";break;case 3:y=I?"March":"Mar";break;case 4:y=I?"April":"Apr";break;case 5:y="May";break;case 6:y=I?"June":"Jun";break;case 7:y=I?"July":"Jul";break;case 8:y=I?"August":"Aug";break;case 9:y=I?"September":"Sep";break;case 10:y=I?"October":"Oct";break;case 11:y=I?"November":"Nov";break;case 12:y=I?"December":"Dec"}return y}static#e=this.\u0275fac=function(I){return new(I||H)};static#t=this.\u0275cmp=n.VBU({type:H,selectors:[["app-final-settlement"]],decls:300,vars:93,consts:[["acoordionHeader",""],["btnCollapseheader",""],["TabHeaderField",""],["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnpill"],[1,"btnMetroDiv","secondary-btn-group"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"document-screen","main_div"],[1,"section"],["panelClass","row form-row",3,"isOpen"],["accordion-heading","",1,"collapse_tabfields"],[1,"btn","btn-link"],[1,"fa","pull-right","btn-tab-icon",2,"line-height","36px","color","white","position","relative","left","-10px","float","right","background","none","border","none"],[1,"PACTHeaderFields"],[2,"display","flex","width","100%"],["class","form-group col-xl-3  col-md-3 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl"],[2,"margin-top","auto"],[1,"PACTTabFields","section","tab_content","tab-exrafields","custom_accordion",2,"display","flex"],[1,"master-tab-container",2,"width","100%"],[3,"selectTab","heading","removable"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"height","250px","border","1px solid #ccc","overflow","scroll"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","flex-direction","row","padding","0px 30px 8px 0px !important","width","100%"],[2,"font-weight","bold"],[1,"form-row","row"],[1,"form-group","col-3"],[3,"heading","removable","selectTab",4,"ngIf"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fas","fa-print"],[1,"fa-light","fa-print"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-paperclip"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-file-chart-line"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","/* flex-direction","row","*/padding","0px 0px 0px 0px !important","width","100%"],["FieldDirective","",2,"width","100%",3,"obj","group"],[2,"display","flex"],[1,"input_cntrl_label",2,"flex-direction","column"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-left","auto","margin-bottom","2px"],[1,"secondary-btn","prevnextbtn",3,"click"],[1,"far","fa-angle-left"],[1,"far","fa-angle-right"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(I,y){if(1&I){const u=n.RV6();n.j41(0,"div",3),n.EFF(1,"\n  "),n.j41(2,"div",4),n.EFF(3,"\n    "),n.j41(4,"div",5),n.EFF(5,"\n      "),n.j41(6,"span",6),n.EFF(7),n.j41(8,"span",7),n.EFF(9),n.k0s(),n.EFF(10,"\n      "),n.k0s(),n.EFF(11,"\n    "),n.k0s(),n.EFF(12,"\n    "),n.j41(13,"div",8),n.EFF(14,"\n      "),n.EFF(15,"\n      "),n.DNE(16,qt,4,3,"span",9),n.EFF(17,"\n      "),n.DNE(18,ct,4,3,"span",9),n.EFF(19,"\n      "),n.DNE(20,It,4,3,"span",9),n.EFF(21,"\n      "),n.DNE(22,Ct,4,3,"span",9),n.EFF(23,"\n      "),n.DNE(24,Be,4,3,"span",9),n.EFF(25,"\n      "),n.DNE(26,Nt,4,3,"span",9),n.EFF(27,"\n      "),n.DNE(28,pt,4,3,"span",9),n.EFF(29,"\n      "),n.DNE(30,ut,4,3,"span",9),n.EFF(31,"\n      "),n.j41(32,"span",10),n.bIt("click",function(){return n.eBV(u),n.Njj(y.obj.Button_Click("Clear"))}),n.nrm(33,"i",11),n.EFF(34),n.nI1(35,"translate"),n.k0s(),n.EFF(36,"\n      "),n.DNE(37,ht,4,3,"span",9),n.EFF(38,"\n          "),n.DNE(39,$t,4,3,"span",9),n.EFF(40,"           \n    "),n.k0s(),n.EFF(41,"\n  "),n.k0s(),n.EFF(42,"\n  "),n.j41(43,"div",12),n.EFF(44,"\n    "),n.j41(45,"accordion",13,0),n.EFF(47,"\n      "),n.j41(48,"accordion-group",14),n.EFF(49,"\n        "),n.j41(50,"div",15),n.EFF(51,"\n          "),n.j41(52,"span",16),n.EFF(53," Primary Information"),n.k0s(),n.EFF(54,"\n          "),n.nrm(55,"span",17,1),n.EFF(57,"\n        "),n.k0s(),n.EFF(58,"\n        "),n.j41(59,"div"),n.EFF(60,"\n          "),n.j41(61,"div",18),n.EFF(62,"\n            "),n.j41(63,"div",19),n.EFF(64,"\n              "),n.DNE(65,Qt,25,3,"div",20),n.EFF(66,"\n              "),n.DNE(67,zt,4,2,"div",20),n.EFF(68,"\n            "),n.k0s(),n.EFF(69,"\n            "),n.j41(70,"div",19),n.EFF(71,"\n              "),n.DNE(72,Zt,4,2,"div",21),n.EFF(73,"\n              "),n.DNE(74,St,4,2,"div",20),n.EFF(75,"\n            "),n.k0s(),n.EFF(76,"\n            "),n.j41(77,"div",19),n.EFF(78,"\n              "),n.DNE(79,ea,4,2,"div",20),n.EFF(80,"\n              "),n.DNE(81,ta,4,2,"div",20),n.EFF(82,"\n              "),n.j41(83,"div",22),n.EFF(84,"\n                "),n.j41(85,"label",23),n.EFF(86),n.k0s(),n.EFF(87,"\n              "),n.k0s(),n.EFF(88,"\n            "),n.k0s(),n.EFF(89,"\n            "),n.j41(90,"div",19),n.EFF(91,"\n              "),n.DNE(92,vt,4,2,"div",21),n.EFF(93,"\n              "),n.DNE(94,Lt,4,2,"div",20),n.EFF(95,"\n            "),n.k0s(),n.EFF(96,"\n          "),n.k0s(),n.EFF(97,"\n        "),n.k0s(),n.EFF(98,"\n      "),n.k0s(),n.EFF(99,"\n    "),n.k0s(),n.EFF(100,"\n\n    "),n.j41(101,"div",24,2),n.EFF(103,"\n      "),n.j41(104,"tabset",25),n.EFF(105,"\n        "),n.j41(106,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvGratuity"))}),n.EFF(107,"\n          "),n.EFF(108,"\n            "),n.j41(109,"div",27),n.EFF(110,"\n            "),n.DNE(111,aa,5,2,"div",28),n.EFF(112,"\n            \n            "),n.j41(113,"div",29),n.EFF(114,"\n              "),n.EFF(115," \n              "),n.DNE(116,sa,4,2,"div",30),n.EFF(117,"\n              "),n.DNE(118,Dt,4,2,"div",30),n.EFF(119,"\n              "),n.j41(120,"div",31),n.EFF(121,"\n                "),n.eu8(122,32),n.EFF(123,"\n              "),n.k0s(),n.EFF(124,"\n              "),n.j41(125,"div",31),n.EFF(126,"\n                "),n.eu8(127,32),n.EFF(128,"\n              "),n.k0s(),n.EFF(129,"\n              "),n.j41(130,"div",31),n.EFF(131,"\n                "),n.eu8(132,32),n.EFF(133,"\n              "),n.k0s(),n.EFF(134,"\n              "),n.j41(135,"div",31),n.EFF(136,"\n                "),n.j41(137,"button",33),n.bIt("click",function(){return n.eBV(u),n.Njj(y.obj.Button_Click("Gratuity"))}),n.EFF(138),n.k0s(),n.EFF(139,"\n              "),n.k0s(),n.EFF(140,"\n              "),n.j41(141,"div",34),n.EFF(142,"\n                "),n.j41(143,"label"),n.EFF(144),n.k0s(),n.j41(145,"label",35),n.EFF(146),n.k0s(),n.EFF(147,"\n              "),n.k0s(),n.EFF(148,"\n              "),n.j41(149,"div",34),n.EFF(150,"\n                "),n.j41(151,"label"),n.EFF(152),n.k0s(),n.j41(153,"label",35),n.EFF(154),n.k0s(),n.EFF(155," "),n.j41(156,"label"),n.EFF(157),n.k0s(),n.j41(158,"label",35),n.EFF(159),n.k0s(),n.EFF(160," "),n.j41(161,"label"),n.EFF(162),n.k0s(),n.j41(163,"label",35),n.EFF(164),n.k0s(),n.EFF(165,"\n              "),n.k0s(),n.EFF(166,"\n              "),n.j41(167,"div",34),n.EFF(168,"\n                "),n.j41(169,"label"),n.EFF(170),n.k0s(),n.j41(171,"label",35),n.EFF(172),n.k0s(),n.EFF(173,"\n              "),n.k0s(),n.EFF(174,"\n              "),n.j41(175,"div",34),n.EFF(176,"\n                "),n.j41(177,"label"),n.EFF(178),n.k0s(),n.j41(179,"label",35),n.EFF(180),n.k0s(),n.EFF(181,"\n              "),n.k0s(),n.EFF(182,"\n              "),n.DNE(183,it,4,2,"div",30),n.EFF(184,"\n              "),n.DNE(185,Rt,4,2,"div",30),n.EFF(186,"\n              "),n.DNE(187,Ot,4,2,"div",30),n.EFF(188,"\n            "),n.k0s(),n.EFF(189,"\n          "),n.k0s(),n.EFF(190,"\n        "),n.k0s(),n.EFF(191,"\n        "),n.j41(192,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvLeaveEncash"))}),n.EFF(193,"\n          "),n.j41(194,"div",36),n.EFF(195,"\n            "),n.DNE(196,Vt,4,2,"div",28),n.EFF(197,"\n            "),n.j41(198,"div",37),n.EFF(199,"\n              "),n.DNE(200,la,4,2,"div",30),n.EFF(201,"\n              "),n.j41(202,"div",31),n.EFF(203,"\n                "),n.eu8(204,32),n.EFF(205,"\n              "),n.k0s(),n.EFF(206,"\n              "),n.j41(207,"div",31),n.EFF(208,"\n                "),n.eu8(209,32),n.EFF(210,"\n              "),n.k0s(),n.EFF(211,"\n              "),n.j41(212,"div",31),n.EFF(213,"\n                "),n.j41(214,"button",33),n.bIt("click",function(){return n.eBV(u),n.Njj(y.obj.Button_Click("LeaveEncash"))}),n.EFF(215),n.k0s(),n.EFF(216,"\n              "),n.k0s(),n.EFF(217,"\n              "),n.DNE(218,ia,4,2,"div",30),n.EFF(219,"\n            "),n.k0s(),n.EFF(220,"\n          "),n.k0s(),n.EFF(221,"\n        "),n.k0s(),n.EFF(222,"\n        "),n.DNE(223,wt,17,6,"tab",38),n.EFF(224,"\n        "),n.j41(225,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvNoticePay"))}),n.EFF(226,"\n          "),n.j41(227,"div",36),n.EFF(228,"\n            "),n.DNE(229,ft,4,2,"div",28),n.EFF(230,"\n            "),n.j41(231,"div",37),n.EFF(232,"\n              "),n.j41(233,"div",31),n.EFF(234,"\n                "),n.eu8(235,32),n.EFF(236,"\n              "),n.k0s(),n.EFF(237,"\n              "),n.DNE(238,Gt,4,2,"div",30),n.EFF(239,"\n            "),n.k0s(),n.EFF(240,"\n          "),n.k0s(),n.EFF(241,"\n        "),n.k0s(),n.EFF(242,"\n        "),n.j41(243,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvOthAdd"))}),n.EFF(244,"\n          "),n.j41(245,"div",36),n.EFF(246,"\n            "),n.DNE(247,Me,4,2,"div",28),n.EFF(248,"\n            "),n.j41(249,"div",37),n.EFF(250,"\n              "),n.j41(251,"div",31),n.EFF(252,"\n                "),n.eu8(253,32),n.EFF(254,"\n              "),n.k0s(),n.EFF(255,"\n              "),n.DNE(256,gt,4,2,"div",30),n.EFF(257,"\n            "),n.k0s(),n.EFF(258,"\n          "),n.k0s(),n.EFF(259,"\n        "),n.k0s(),n.EFF(260,"\n        "),n.j41(261,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvOthDed"))}),n.EFF(262,"\n          "),n.j41(263,"div",36),n.EFF(264,"\n            "),n.DNE(265,oa,4,2,"div",28),n.EFF(266,"\n            "),n.j41(267,"div",37),n.EFF(268,"\n              "),n.j41(269,"div",31),n.EFF(270,"\n                "),n.eu8(271,32),n.EFF(272,"\n              "),n.k0s(),n.EFF(273,"\n              "),n.DNE(274,ra,4,2,"div",30),n.EFF(275,"\n            "),n.k0s(),n.EFF(276,"\n          "),n.k0s(),n.EFF(277,"\n        "),n.k0s(),n.EFF(278,"\n        "),n.j41(279,"tab",26),n.bIt("selectTab",function(){return n.eBV(u),n.Njj(y.onSelectTab("dgvLoanBal"))}),n.EFF(280,"\n          "),n.j41(281,"div",36),n.EFF(282,"\n            "),n.DNE(283,kt,4,2,"div",28),n.EFF(284,"\n            "),n.j41(285,"div",37),n.EFF(286,"\n              "),n.j41(287,"div",31),n.EFF(288,"\n                "),n.eu8(289,32),n.EFF(290,"\n              "),n.k0s(),n.EFF(291,"\n              "),n.DNE(292,_t,4,2,"div",30),n.EFF(293,"\n            "),n.k0s(),n.EFF(294,"\n          "),n.k0s(),n.EFF(295,"\n        "),n.k0s(),n.EFF(296,"\n      "),n.k0s(),n.EFF(297,"\n\n    "),n.k0s(),n.EFF(298,"\n\n  "),n.k0s(),n.EFF(299,"\n"),n.k0s()}2&I&&(n.R7$(7),n.SpI("\n        ",y.obj.Title," "),n.R7$(),n.xc7("background-color",y.obj.StatusColor),n.R7$(),n.JRh(y.obj.DocStatus),n.R7$(7),n.Y8G("ngIf",y.ViewModel.ApproveVisibility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.PostVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.SavePrintVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.PrintVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.PreviewVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.ExportVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.AttachVisiblility),n.R7$(2),n.Y8G("ngIf",y.ViewModel.EMailVisiblility),n.R7$(4),n.JRh(n.bMT(35,91,"Clear")),n.R7$(3),n.Y8G("ngIf",y.obj.UnPostVisiblility),n.R7$(2),n.Y8G("ngIf",y.obj.ReportInfoVisibility),n.R7$(9),n.Y8G("isOpen",y.IsAccordionOpen),n.R7$(7),n.AVh("fa-chevron-down",y.IsAccordionOpen)("fa-chevron-up",!y.IsAccordionOpen),n.R7$(10),n.Y8G("ngIf",y.obj.txtDocNo.Visible),n.R7$(2),n.Y8G("ngIf",y.obj.dtpDocDate.Visible),n.R7$(5),n.Y8G("ngIf",y.obj.EmployeeList.Visible),n.R7$(2),n.Y8G("ngIf",y.obj.cmbSettlementType.Visible),n.R7$(5),n.Y8G("ngIf",y.obj.dtpDateOfJoining.Visible),n.R7$(2),n.Y8G("ngIf",y.obj.dtpDateOfRelieving.Visible),n.R7$(5),n.JRh(y.lblActRelievingDate),n.R7$(6),n.Y8G("ngIf",y.obj.txtRemarks.Visible),n.R7$(2),n.Y8G("ngIf",y.obj.txtNetAmount.Visible),n.R7$(12),n.FS9("heading",y.tpGratuity),n.Y8G("removable",!1),n.R7$(5),n.Y8G("ngIf",y.dgvGratuity.Visible),n.R7$(5),n.Y8G("ngIf",y.cmbResignType.Visible),n.R7$(2),n.Y8G("ngIf",y.cmbResignReason.Visible),n.R7$(4),n.Y8G("obj",y.chkCalcBasedOnLastSal)("group",y.form),n.R7$(5),n.Y8G("obj",y.chkCalcBasedOnActDays)("group",y.form),n.R7$(5),n.Y8G("obj",y.GratuityRemarks)("group",y.form),n.R7$(6),n.JRh(y.btnCalcGratuity),n.R7$(6),n.JRh(y.lbl1GratuityTotalDays),n.R7$(2),n.JRh(y.lblGratuityTotalDays),n.R7$(6),n.JRh(y.lbl1GratuityServiceDays),n.R7$(2),n.JRh(y.lblGratuityServiceDays),n.R7$(3),n.JRh(y.lbl1GratuityLOPDays),n.R7$(2),n.JRh(y.lblGratuityLOPDays),n.R7$(3),n.JRh(y.lbl1GratuityBalDays),n.R7$(2),n.JRh(y.lblGratuityBalDays),n.R7$(6),n.JRh(y.lbl1GratuityTotalGrDays),n.R7$(2),n.JRh(y.lblGratuityTotalGrDays),n.R7$(6),n.JRh(y.lbl1GratuityTaken),n.R7$(2),n.JRh(y.lblGratuityTaken),n.R7$(3),n.Y8G("ngIf",y.txtGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",y.txtAvailedGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",y.txtPartialGratuityAmount.Visible),n.R7$(5),n.FS9("heading",y.tpLeaveEncashment),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",y.dgvLeaveEncash.Visible),n.R7$(4),n.Y8G("ngIf",y.txtCumLeaveSalBalAmt.Visible),n.R7$(4),n.Y8G("obj",y.chkLECalcBasedOnLastApprSerYearWise)("group",y.form),n.R7$(5),n.Y8G("obj",y.LeaveRemarks)("group",y.form),n.R7$(6),n.JRh(y.btnCalcLE),n.R7$(3),n.Y8G("ngIf",y.txtLEAmount.Visible),n.R7$(5),n.Y8G("ngIf",y.ViewModel.UnProcessedVisible),n.R7$(2),n.FS9("heading",y.tpNoticePay),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",y.dgvNoticePay.Visible),n.R7$(6),n.Y8G("obj",y.NoticePayRemarks)("group",y.form),n.R7$(3),n.Y8G("ngIf",y.txtNPAmount.Visible),n.R7$(5),n.FS9("heading",y.tpOtherAdditions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",y.dgvOthAdd.Visible),n.R7$(6),n.Y8G("obj",y.OAddRemarks)("group",y.form),n.R7$(3),n.Y8G("ngIf",y.txtOthAddAmount.Visible),n.R7$(5),n.FS9("heading",y.tpOtherDeductions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",y.dgvOthDed.Visible),n.R7$(6),n.Y8G("obj",y.ODedRemarks)("group",y.form),n.R7$(3),n.Y8G("ngIf",y.txtOthDedAmount.Visible),n.R7$(5),n.FS9("heading",y.tpLoanBalances),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",y.dgvLoanBal.Visible),n.R7$(6),n.Y8G("obj",y.LoanRemarks)("group",y.form),n.R7$(3),n.Y8G("ngIf",y.txtLoanBalAmount.Visible))},dependencies:[lt.bT,mt._,qe.Mj,qe.kt,$e.X,Pt.V6,Pt.fw,Kt.D9],encapsulation:2})}return H})();class ha{constructor(){this.Days=0}}},5661:(Xt,Ze,J)=>{J.d(Ze,{N:()=>Xe});var ie=J(86739),f=J(8787),Le=J(23823),d=J(24028),_e=J(92701),st=J(72743),et=J(35275),v=J(7023),s=J(26531),fe=J(29788),Ye=J(81669),Qe=J(61994);class Xe extends Le.g{constructor(be){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.dtpPayrollMonth=new d.Lc(0),this.cmbPayslipLayout=new _e.y$(0),this.cmbSortOn=new _e.y$(0),this.PrintCallBack=new Ye.Yk,this.dtPrintLayouts=null,this.sFilter="",this.drSelectedPrintLayout=null,this.sDocIDs="",this.IsPDFExport=!1,this.iCostCenterID=40054,this.ExportSeperate=!1;try{if(this.DisplayName=ie.d.GetResource(be),this.Title=ie.d.GetResource(be),this.DisplayMessage="",this.dtpPayrollMonth.CustomFormat="MMM/yyyy",this.dtpPayrollMonth.Date=ie.d.SessionManager.PayrollMonth,this.dtPrintLayouts=ie.d.common.GetDataTable("PAY064",this.iCostCenterID.toString()+"~"+ie.d.SessionManager.RoleID+"~"+ie.d.SessionManager.UserID+"~"+ie.d.SessionManager.LocationID),null!=this.dtPrintLayouts&&this.dtPrintLayouts.length>0){let Z="-1";for(let he=0;he<this.dtPrintLayouts.length;he++)this.cmbPayslipLayout.Items.push(_e._p.ComboBoxItems_2(this.dtPrintLayouts[he].Name.toString(),this.dtPrintLayouts[he].DocPrintLayoutID.toString())),"true"==this.dtPrintLayouts[he].IsDefault.toString().toLowerCase()&&(Z=this.dtPrintLayouts[he].DocPrintLayoutID.toString());this.cmbPayslipLayout.SelectedValue=Z,"-1"==Z&&!f.J0.IsEmpty(this.dtPrintLayouts[0].DocPrintLayoutID)&&(Z=this.dtPrintLayouts[0].DocPrintLayoutID.toString(),this.cmbPayslipLayout.SelectedValue=Z)}if(this.cmbSortOn.Items.Clear(),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("EmpCode","1")),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("EmpName","2")),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("TreeView","3")),this.cmbSortOn.SelectedValue="1",this.dtpPayrollMonth.Label=ie.d.GetResource("Payroll_Month"),this.cmbPayslipLayout.Label=ie.d.GetResource("PayslipLayout"),this.cmbSortOn.Label=ie.d.GetResource("SortOn"),ie.d.SessionManager.IsEmpUser&&!ie.d.SessionManager.IsRptManagerUser){let Z="";f.J0.IsEmpty(ie.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(Z="  AND EmpSeqNo IN ("+ie.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let he=[];he.push(ie.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),he.push(Z),he.push(1),he.push(ie.d.SessionManager.RoleID),he.push(ie.d.SessionManager.UserID),he.push(ie.d.SessionManager.LanguageID),this.dsEmps=ie.d.empService.GetData(he,"spPAY_GetEmpMasterCCDetails")}else this.btnFilter_Click();this.PrintCallBack.Subscribe(this,"PrintVoucher")}catch(Z){Logger.ErrorLog("PayslipViewModel::EXCEPTION PayslipViewModel()",Z)}}Button_Click(be){this.IsPDFExport=!1,"Preview"==be.toString()?this.btnPreview_Click(0):"Print"==be.toString()?this.btnPreview_Click(1):"Export"==be.toString()?(this.IsPDFExport=!0,this.btnPreview_Click(3)):"EMail"==be.toString()?this.btnPreview_Click(2):"Filter"==be.toString()&&this.btnFilter_Click(),Logger.InfoLog("PayslipViewModel::Exiting Button_Click()")}btnPreview_Click(be){if(null!=this.dsEmps&&0!=this.dsEmps.Tables.length)try{let Z=this.dsEmps.Tables[0],he=0,je=0;if(null!=Z&&Z.length>0){let ue="",Ke="";for(let c=0;c<Z.length;c++)ue+=Z[c].EmpSeqNo.toString()+",",je++;if(ue.length>0&&je>0){ue=ue.substr(0,ue.length-1),Ke="TreeView"==this.cmbSortOn.GetselectedItem().Name?" ORDER BY e.lft":" ORDER BY e."+this.cmbSortOn.GetselectedItem().Name.Replace("Emp","");let c=ie.d.common.GetDataSet3("PAY065",this.iCostCenterID.toString(),this.dtpPayrollMonth.Date.ToString("01/MMM/yyyy"),ue+"~"+Ke);if(null!=c&&c.Tables[0].length>0&&f.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)>0){he=c.Tables[0].length,this.sDocIDs="";let Fe=this.dtPrintLayouts.filter(le=>le.DocPrintLayoutID==this.cmbPayslipLayout.SelectedValue);for(let le=0;le<c.Tables[0].length;le++)this.sDocIDs+=c.Tables[0][le].DocID.toString()+",";if(this.sDocIDs.length>0)if(this.drSelectedPrintLayout=Fe[0],this.sDocIDs=this.sDocIDs.substr(0,this.sDocIDs.length-1),0==be)this.PrintCallBack.Call(!0);else if(1==be)this.PrintCallBack.Call(!1);else if(3==be)if(this.ExportSeperate)for(let le=0;le<c.Tables[0].length;le++)this.sDocIDs=c.Tables[0][le].DocID.toString(),this.PrintCallBack.Call(!1);else this.PrintCallBack.Call(!1);else 2==be&&this.SendPaySlipsToEMail()}else 0==c.Tables[0].length?this.DisplayMessage="Payroll Not Processed For Selected Employees On This Payroll Month":-1==f.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)&&(this.DisplayMessage="Please select Payslip Layout")}}else this.DisplayMessage="No Employees found to generate preview.";Logger.InfoLog("PayslipViewModel::Exiting btnPreview_Click()")}catch(Z){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnPreview_Click()"+Z.stack)}else this.DisplayMessage="First filter the Employees, then Preview"}SendPaySlipsToEMail(){try{Logger.InfoLog("PayslipViewModel::Entering SendPaySlipsToEMail()"),null!=this.sDocIDs&&this.sDocIDs.length>0?ie.d.page.ShowDialog(new s.SendEmailSMSViewModel(!0,this.iCostCenterID,0,this),fe.SendEmailSMSComponent):this.DisplayMessage="No Employees found to Send Email.",Logger.InfoLog("PayslipViewModel::Exiting SendPaySlipsToEMail()")}catch(be){Logger.ErrorLog("PayslipViewModel::EXCEPTION SendPaySlipsToEMail()"+be.stack)}}btnFilter_Click(){try{this.sFilter="",ie.d.SessionManager.Preferences.ContainsKey("PayslipFilter")&&parseInt(ie.d.SessionManager.Preferences.PayslipFilter)>0&&"Widget"!=this.DisplayName?null==this.objEmpFilter?this.objEmpFilter=new st.t("",0,4):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=4,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new st.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?ie.d.page.ShowDialog(this.objEmpFilter,Qe.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}catch(be){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnFilter_Click()",be)}}btnFilter_Click_CallBack(){if(this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let Z=1,he="",je="",ue="";for(let Ke=0;Ke<this.objEmpFilter.CostCenterFilters.length;Ke++){let c=this.objEmpFilter.CostCenterFilters[Ke];if(c.CostCenterID>5e4&&(Z=2,he="NodeID",je=50051==c.CostCenterID?"EmpSeqNo":"CCNID"+(c.CostCenterID-5e4)),c.SelectedNodes.length>0){if(1==c.SelectedNodes.length)ue+=" AND ",ue+=je+"="+c.SelectedNodes[0].Id;else if(!c.SelectedNodes.find(Fe=>Fe.Id==Z&&Fe.IsGroup))if(ue+=" AND ",et.IPrefetchFilter.IsGroupTree(c)){let Fe="";for(let le=0;le<c.SelectedNodes.length;le++)(null==c.SelectedNodes[le].Parent||!c.SelectedNodes[le].Parent.IsSelected)&&(Fe.length>0&&(Fe+=","),Fe+=c.SelectedNodes[le].Id);0==Fe.length&&(Fe+=-12912),ue+=je+" IN ",ue+=" (select T."+he+" GTID from "+v.A.GetTagTableName(c.CostCenterID)+" T with(nolock),",v.A.GetTagTableName(c.CostCenterID),ue+=Fe.toString()+")  group by T."+he+")"}else{ue+=je+" IN (";for(let Fe=0;Fe<c.SelectedNodes.length;Fe++)Fe>0&&(ue+=","),ue+=c.SelectedNodes[Fe].Id;ue+=")"}}else c.DeleteButtonVisibility||(ue+=" AND ",ue+=je+"=-12912")}this.sFilter=ue.toString()}if(this.objEmpFilter.Filter>0){ie.d.SessionManager.LocationID>0&&ie.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&ie.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+ie.d.SessionManager.LocationID+")"),f.J0.IsEmpty(ie.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+ie.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),4==this.objEmpFilter.Filter&&"All"!=this.objEmpFilter.PaymentModes.SelectedValue&&(this.sFilter+=" AND EMP.PaymentMode ='"+this.objEmpFilter.PaymentModes.SelectedValue+"' ");let Z=[];Z.push(ie.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),Z.push(this.sFilter),Z.push(1),Z.push(ie.d.SessionManager.RoleID),Z.push(ie.d.SessionManager.UserID),Z.push(ie.d.SessionManager.LanguageID),this.dsEmps=ie.d.empService.GetData(Z,"spPAY_GetEmpMasterCCDetails")}}}PrintVoucher(be){let he=this;if(he.DisplayMessage="",!f.J0.IsEmpty(he.sDocIDs)){let je=null;je=he.drSelectedPrintLayout,null!=je&&ie.d.report.VoucherExport_PDF(40054,he.IsPDFExport,he.sDocIDs,"",he.IsPDFExport,f.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)).subscribe(ue=>{console.log(ue),he.IsPDFExport?be?ie.d.SessionManager.printTab(ue.FileName):ie.d.SessionManager.Download(ue.FileName,ue.FileName):setTimeout(()=>{ie.d.SessionManager.printTab(ue.FileName)},500),f.J0.IsEmpty(ue.Message)&&!f.J0.IsEmpty(ue.FileName)&&(this.DisplayMessage="Exported Successfully")},ue=>{console.log(ue)})}return""}}},70824:(Xt,Ze,J)=>{J.r(Ze),J.d(Ze,{RibbonExtPay:()=>Ne});var ie=J(10467),f=J(62846),Le=J(15091),d=J(86739),_e=J(72974),st=J(75782),et=J(50334),v=J(89417),s=J(54438),fe=J(60177),Ye=J(60440),Qe=J(36688),Xe=J(73955);const yt=()=>({standalone:!0});function be(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Process"))}),s.nrm(1,"i",22),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Process")))}function Z(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",23),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function he(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",24),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function je(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Export"))}),s.nrm(1,"i",25),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function ue(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",26),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let Ke=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-consolidated-monthly-payroll"]],decls:89,vars:32,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"page-Subtitle",3,"dblclick"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-search"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"row",2,"height","30px"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"padding-left","inherit"],["FieldDirective","",3,"obj"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"padding-left","inherit"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-gears"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-file-chart-line"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n          "),s.j41(6,"span",3),s.EFF(7),s.j41(8,"span",4),s.bIt("dblclick",function(r){return i.obj.sPayrollMonth_MouseDoubleClick(r)}),s.EFF(9),s.k0s(),s.EFF(10,"\n          "),s.k0s(),s.EFF(11,"\n        "),s.k0s(),s.EFF(12,"\n\n        "),s.j41(13,"div",5),s.EFF(14,"\n          "),s.DNE(15,be,4,3,"span",6),s.EFF(16,"\n          "),s.DNE(17,Z,4,3,"span",6),s.EFF(18,"\n          "),s.j41(19,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(20,"i",8),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n          "),s.DNE(24,he,4,3,"span",6),s.EFF(25,"\n          "),s.j41(26,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(27,"i",9),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n          "),s.j41(31,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Load")}),s.nrm(32,"i",10),s.EFF(33),s.nI1(34,"translate"),s.k0s(),s.EFF(35,"\n          "),s.DNE(36,je,4,3,"span",6),s.EFF(37,"\n          "),s.DNE(38,ue,4,3,"span",6),s.EFF(39,"           \n        "),s.k0s(),s.EFF(40,"\n      "),s.k0s(),s.EFF(41,"\n    "),s.j41(42,"div",11),s.EFF(43,"\n      "),s.j41(44,"div",12),s.EFF(45,"\n        "),s.j41(46,"div",13),s.EFF(47,"\n          "),s.eu8(48,14),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",15),s.EFF(52,"\n          "),s.eu8(53,14),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n        "),s.j41(56,"div",15),s.EFF(57,"\n          "),s.eu8(58,14),s.EFF(59,"\n        "),s.k0s(),s.EFF(60,"\n      "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",12),s.EFF(63,"\n        "),s.j41(64,"div",16),s.EFF(65,"\n          "),s.j41(66,"input",17),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.IsProcessWithArrears,r)||(i.obj.IsProcessWithArrears=r),r}),s.k0s(),s.EFF(67,"\n          "),s.j41(68,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithArrears=!i.obj.IsProcessWithArrears}),s.EFF(69),s.nI1(70,"translate"),s.k0s(),s.EFF(71,"\n        "),s.k0s(),s.EFF(72,"\n        "),s.j41(73,"div",19),s.EFF(74,"\n          "),s.j41(75,"input",17),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.IsProcessWithAdjustments,r)||(i.obj.IsProcessWithAdjustments=r),r}),s.k0s(),s.EFF(76,"\n          "),s.j41(77,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithAdjustments=!i.obj.IsProcessWithAdjustments}),s.EFF(78),s.nI1(79,"translate"),s.k0s(),s.EFF(80,"\n        "),s.k0s(),s.EFF(81,"\n      "),s.k0s(),s.EFF(82,"\n        \n        "),s.j41(83,"div",20),s.EFF(84,"\n          "),s.nrm(85,"app-PactGridView",21),s.EFF(86,"  \n        "),s.k0s(),s.EFF(87,"\n    "),s.k0s(),s.EFF(88,"\n"),s.k0s()),2&t&&(s.R7$(7),s.SpI("\n            ",i.obj.Title,"\n            "),s.R7$(2),s.SpI("\n              ",i.obj.sPayrollMonth,"\n            "),s.R7$(6),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(22,20,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(29,22,"Filter")),s.R7$(5),s.JRh(s.bMT(34,24,"Load")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(10),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(5),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(8),s.R50("ngModel",i.obj.IsProcessWithArrears),s.Y8G("ngModelOptions",s.lJ4(30,yt)),s.R7$(3),s.JRh(s.bMT(70,26,"ProcesswithArrears")),s.R7$(6),s.R50("ngModel",i.obj.IsProcessWithAdjustments),s.Y8G("ngModelOptions",s.lJ4(31,yt)),s.R7$(3),s.JRh(s.bMT(79,28,"ProcesswithAdjustments")),s.R7$(7),s.Y8G("obj",i.obj.dgvEmployees))},dependencies:[fe.bT,Ye._,v.Zm,v.BC,Qe.X,v.vS,Xe.D9],encapsulation:2})}return G})();var c=J(8787),Fe=J(95707),le=J(32647),He=J(49710),tt=J(23823),Ft=J(33547),K=J(18569),n=J(92701),lt=J(72743),mt=J(35275),qe=J(7023),$e=J(5464),Pt=J(62288);class Kt extends tt.g{constructor(a){super(),this.DialogResult=!1,this.dtData=null,this.dtDataColumns=null,this.ExcelData=[],this.DisplayMessage="",this.Parent=a[0],this.Parent.Opacity=.3,this.dgv=new He.vv,this.dgv.Columns=new Array,this.dgv.Width="450",this.dgv.Table=[]}Button_Click(a){if("Load"==a.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{let t;this.dtData=[],this.dtDataColumns=[];for(let i=0;i<this.dgv.Columns.length;i++)this.dtDataColumns.push(this.dgv.TableColumns[i]);for(let i=0;i<this.dgv.Table.length;i++){t={};for(let o=0;o<this.dgv.Columns.length;o++)null!=this.dgv.Table[i][o]&&null!=this.dgv.Table[i][o]&&(t[o]=this.dgv.Table[i][o].toString());this.dtData.push(t)}this.dtData=this.dgv.Table}catch{}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,d.d.page.HideDialog(this.PopUpGUID)}else if("View"==a.toString()){let t;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var l=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(let o=0;o<this.ExcelTableColumns.length;o++)t=new K.O7,t.Header=this.ExcelTableColumns[o],t.DisplayMember=this.ExcelTableColumns[o],t.ID=this.ExcelTableColumns[o],t.Width=100,t.ReadOnly=!0,l.push(t),this.dgv.TableColumns.push(this.ExcelTableColumns[o]);let i;this.dgv.Columns=l;for(let o=1;o<this.ExcelTable.length;o++){i=this.dgv.NewRow();for(let r=0;r<this.ExcelTableColumns.length;r++)i[this.ExcelTableColumns[r]]=this.ExcelTable[o][r];this.dgv.Table.push(i),this.dgv.updateRow(i)}this.dgv.RefreshGrid=!0,this.dgv.refreshDataView()}}else"Browse"==a.toString()||"Cancel"==a.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,d.d.page.HideDialog(this.PopUpGUID));Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}OpenFile(a){if(1!==a.target.files.length)throw new Error("Cannot use multiple files");const l=new FileReader,t=a.target.files[0];this.fileExt=t.name.split(".").pop(),this.fileName=t.name,l.onload=i=>{const h=Pt.LF(l.result,{type:"binary"});if(this.ExcelData=Pt.Wp.sheet_to_json(h.Sheets[h.SheetNames[0]],{header:1}),!c.J0.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.ExcelTable=this.ExcelData,this.ExcelTableColumns=this.ExcelData[0],this.ActualFileName=this.fileName}catch(D){return void(this.DisplayMessage=D.Message)}},l.readAsBinaryString(t)}}let qt=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-cons-mpload"]],decls:52,vars:18,consts:[["fileUpload",""],[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row",2,"margin-bottom","10px","flex-direction","row","display","flex","align-items","center"],[1,"col-md-auto","col-sm-12","col-xs-12"],[1,"input_cntrl_label",2,"margin-right","10px"],["type","text","readonly","",3,"ngModelChange","ngModel"],[1,"col-xl-2","col-md-2","col-sm-12","col-xs-12",2,"display","flex !important"],["type","file","accept",".xlsx,.xls,.csv","name","upload",2,"display","none",3,"change"],[1,"secondary-btn-wicon",2,"border","0px !important",3,"click"],[1,"fa-light","fa-search"],[1,"form-group","row","form-row","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(t,i){if(1&t){const o=s.RV6();s.j41(0,"div",1),s.EFF(1,"\n    "),s.j41(2,"div",2),s.EFF(3,"\n        "),s.j41(4,"div",3),s.EFF(5,"\n            "),s.j41(6,"div",4),s.EFF(7,"\n                "),s.j41(8,"label",5),s.EFF(9),s.nI1(10,"translate"),s.k0s(),s.EFF(11,"\n                "),s.j41(12,"input",6),s.mxI("ngModelChange",function(h){return s.eBV(o),s.DH7(i.obj.ActualFileName,h)||(i.obj.ActualFileName=h),s.Njj(h)}),s.k0s(),s.EFF(13,"\n            "),s.k0s(),s.EFF(14,"\n            "),s.j41(15,"div",7),s.EFF(16,"\n                "),s.j41(17,"input",8,0),s.bIt("change",function(h){return s.eBV(o),s.Njj(i.obj.OpenFile(h))}),s.k0s(),s.EFF(19,"               \n                "),s.j41(20,"span",9),s.bIt("click",function(){s.eBV(o);const h=s.sdS(18);return s.Njj(h.click())}),s.nrm(21,"i",10),s.EFF(22),s.nI1(23,"translate"),s.k0s(),s.EFF(24,"\n             \n            "),s.k0s(),s.EFF(25,"\n        "),s.k0s(),s.EFF(26,"  \n            \n        "),s.j41(27,"div",11),s.EFF(28,"\n            "),s.eu8(29,12),s.EFF(30,"\n        "),s.k0s(),s.EFF(31,"\n    "),s.k0s(),s.EFF(32,"\n    "),s.j41(33,"div",13),s.EFF(34,"\n        "),s.j41(35,"div"),s.EFF(36,"\n            "),s.j41(37,"button",14),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Load"))}),s.EFF(38),s.nI1(39,"translate"),s.k0s(),s.EFF(40,"\n            "),s.j41(41,"button",15),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("View"))}),s.EFF(42),s.nI1(43,"translate"),s.k0s(),s.EFF(44,"\n            "),s.j41(45,"button",15),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Cancel"))}),s.nrm(46,"i",16),s.EFF(47),s.nI1(48,"translate"),s.k0s(),s.EFF(49,"\n           \n        "),s.k0s(),s.EFF(50,"\n    "),s.k0s(),s.EFF(51,"\n"),s.k0s()}2&t&&(s.R7$(9),s.JRh(s.bMT(10,8,"Com_Attachments_FileName")),s.R7$(3),s.R50("ngModel",i.obj.ActualFileName),s.R7$(10),s.JRh(s.bMT(23,10,"Browse")),s.R7$(7),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(9),s.JRh(s.bMT(39,12,"Load")),s.R7$(4),s.JRh(s.bMT(43,14,"View")),s.R7$(5),s.JRh(s.bMT(48,16,"Cancel")))},dependencies:[Ye._,v.me,v.BC,v.vS,Xe.D9],encapsulation:2})}return G})();var ct=J(61994),It=J(2578),Ct=J(38816),Be=J(72099),Nt=J(39032),pt=J(98669),ut=J(36466);class ht extends tt.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}SerializeGridColumnType(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(let a=0;a<this.dgvEmployees.TableColumns.length;a++);}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.Opacity=1,this.DialogResult=!1,this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this._SelectAll=!1,this.IsProcessWithArrears=!1,this.IsProcessWithAdjustments=!1,this.chkPostBasedOnDailyAttendance=new Be.c,this.chkPostBasedOnAttDimWise=new Be.c,this.chkIncludeOTHours=new Be.c,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.ExportVisiblility=!0,this.GridColumnType=new Fe.bT,this.dsDailyAttendanceData=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new ut.v,this.CostCenterID=0,this.sCrAccount="0",this.sDrAccount="0",this.dtRes=null,this.drwRes=null,this.dtCust=null,this.SelectUnCheck=0,this.objCMPLData=null,this.IsProcessed=!1,this.sFilter="",this.iColId=0,this.sBGWorkType="",this.dtArrData=null,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),this.ClassName="ConsolidatedMonthlyPayrollViewModel",this.CostCenterID=40054,this.dtRes=d.d.common.GetDataTable("PAY073",d.d.SessionManager.LangID),this.DisplayName=d.d.GetResource(a.Replace(" ","")),this.Title=d.d.GetResource(a.Replace(" ","")),this.DisplayMessage="",this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ExportVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.chkPostBasedOnDailyAttendance.Label=d.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=d.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=d.d.GetResource("PostbasedonAttendanceDimensionwise"),this.LoadGrid(),this.btnFilter_Click(),d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView()}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",l)}}sPayrollMonth_MouseDoubleClick(a){let l=new Le.SetPayrollDateViewModel;d.d.page.ShowDialog(l,_e.SetPayrollDateComponent,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")}).subscribe(()=>{l.DialogResult&&this.btnClear_Click()})}dgvEmployees_EndEdit(a,l,t){let i=this.dgvEmployees.Table.indexOf(a);if(this.iEmpIndex=this.lstSelectedEmps.indexOf(i),!(this.iEmpIndex<0)){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);"DaysAttended"==l?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(a[l])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=d.d.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",a.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==l?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(a[l])):l.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(l.Replace("EarningOTHrs","")),a[l].toString()):l.startsWith("Earning")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(l.Replace("Earning","")),a[l].toString()):l.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(l.Replace("DeductionOTHrs","")),a[l].toString()):l.startsWith("Deduction")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(l.Replace("Deduction","")),a[l].toString()):l.startsWith("dcAlpha")?l.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l.Replace("_Key",""),c.J0.ParseDate(a[l]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString()):l.startsWith("dcCCNID")&&(Object.keys(a).Contains(l+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString())),this.dgvEmployees.updateRow(a),this.FillProcessedData(i)}}GetResource(a,l){let t=a;return this.drwRes=this.dtRes.filter(i=>i.CCID==l&&i.Code==a),null!=this.drwRes&&this.drwRes.length>0?1==d.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():t}LoadGrid(){let l,a=new Ft.ControlGenerator;this.dsDocDesig=a.GetScreenInfo(this.CostCenterID),l=this.dsDocDesig.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=l&&l.length>0&&!c.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sCrAccount=l[0].UserDefaultValue.toString()),l=this.dsDocDesig.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=l&&l.length>0&&!c.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sDrAccount=l[0].UserDefaultValue.toString()),this.dgvEmployees=new He.vv,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();let t=new K.O7;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],t=new K.O7,t.Header=this.GetResource("Select",40054),t.DisplayMember="Select",t.ID="Select",t.DataType="CheckBox",t.Width=50,t.IsFrozen=!0,t.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),t=new K.O7,t.Header=this.GetResource("S No",40054),t.DisplayMember="SNo",t.ID="SNo",t.DataType="TextBlock",t.Width=50,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("SNo"),t=new K.O7,t.Header="EmpSeqNo",t.DisplayMember="EmpSeqNo",t.ID="EmpSeqNo",t.DataType="TextBlock",t.Width=50,t.ReadOnly=!0,t.IsFrozen=!0,t.IsVisible=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpSeqNo"),t=new K.O7,t.Header=this.GetResource("Employee Code",40054),t.DisplayMember="EmpCode",t.ID="EmpCode",t.CrRefColName="dcCCNID51",t.DataType="TextBlock",t.Width=150,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpCode"),t=new K.O7,t.Header=this.GetResource("Employee Name",40054),t.DisplayMember="EmpName",t.ID="EmpName",t.CrRefColName="dcCCNID51",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpName"),t=new K.O7,t.Header="GradeID",t.DisplayMember="GradeID",t.ID="GradeID",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,t.IsFrozen=!0,t.IsVisible=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("GradeID"),t=new K.O7,t.Header=this.GetResource("dcAlpha3",40054),t.DisplayMember="NetSalary",t.ID="NetSalary",t.CrRefColName="dcAlpha3",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=90,t.ReadOnly=!0,t.IsFontBold=!0,t.IsFrozen=!0,t.ShowTotal=!0,t.IsCalculated=1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),t=new K.O7,t.Header=this.GetResource("Month Days",40054),t.DisplayMember="MonthDays",t.ID="MonthDays",t.CrRefColName="dcAlpha4",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),t=new K.O7,t.Header=this.GetResource("dcAlpha5",40054),t.DisplayMember="DaysAttended",t.ID="DaysAttended",t.CrRefColName="dcAlpha5",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),t=new K.O7,t.Header=this.GetResource("dcAlpha24",40054),t.DisplayMember="PaidLeaves",t.ID="PaidLeaves",t.CrRefColName="dcAlpha24",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),t=new K.O7,t.Header=this.GetResource("dcAlpha6",40054),t.DisplayMember="TotalLeaves",t.ID="TotalLeaves",t.CrRefColName="dcAlpha6",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),t=new K.O7,t.Header=this.GetResource("dcAlpha7",40054),t.DisplayMember="WeeklyOffs",t.ID="WeeklyOffs",t.CrRefColName="dcAlpha7",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),t=new K.O7,t.Header=this.GetResource("dcAlpha8",40054),t.DisplayMember="Holidays",t.ID="Holidays",t.CrRefColName="dcAlpha8",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),t=new K.O7,t.Header=this.GetResource("dcAlpha9",40054),t.DisplayMember="LOPDays",t.ID="LOPDays",t.CrRefColName="dcAlpha9",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),t=new K.O7,t.Header=this.GetResource("dcAlpha10",40054),t.DisplayMember="UnpaidDays",t.ID="UnpaidDays",t.CrRefColName="dcAlpha10",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),t=new K.O7,t.Header=this.GetResource("dcAlpha4",40054),t.DisplayMember="TotalDays",t.ID="TotalDays",t.CrRefColName="dcAlpha4",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=d.d.common.GetDataSet("PAY058",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if(l=this.dsStructure.Tables[0].filter(o=>1==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!c.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())||(t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Earning"+l[o].SNo.toString(),t.ID="Earning"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightBlue",t.Width=80,"OverTime"==l[o].FieldType.toString()?(t.DisplayMember="EarningOTHrs"+l[o].SNo.toString(),t.ID="EarningOTHrs"+l[o].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="EarningOTAmt"+l[o].SNo.toString(),t.ID="EarningOTAmt"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightBlue","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember)));if(t=new K.O7,t.Header=this.GetResource("dcAlpha11",40054),t.DisplayMember="TotalEarnings",t.ID="TotalEarnings",t.CrRefColName="dcAlpha11",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightBlue",t.Width=90,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!c.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())&&(t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Earning"+l[o].SNo.toString(),t.ID="Earning"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="GreenYellow",t.Width=80,"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>2==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Deduction"+l[o].SNo.toString(),t.ID="Deduction"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightCoral",t.Width=80,"OverTime"==l[o].FieldType.toString()?(t.DisplayMember="DeductionOTHrs"+l[o].SNo.toString(),t.ID="DeductionOTHrs"+l[o].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="DeductionOTAmt"+l[o].SNo.toString(),t.ID="DeductionOTAmt"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightCoral","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>3==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Loan"+l[o].SNo.toString(),t.ID="Loan"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightGoldenrodYellow",t.Width=80,"-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember);if(t=new K.O7,t.Header=this.GetResource("dcAlpha12",40054),t.DisplayMember="TotalDeductions",t.ID="TotalDeductions",t.CrRefColName="dcAlpha12",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightCoral",t.Width=90,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),l=this.dsStructure.Tables[0].filter(o=>4==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new K.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Leave"+l[o].SNo.toString(),t.ID="Leave"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints="1",t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightGreen",t.Width=60,"-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember)}let i=this.dsDocDesig.Tables[0].filter(o=>1==o.IsColumnUserDefined&&(2==o.SectionID&&"H"==o.SectionName||3==o.SectionID));if(null!=i&&i.length>0)for(let o=0;o<i.length;o++){switch(t=new K.O7,t.Header=this.GetResource(i[o].SysColumnName.toString(),40054),t.DisplayMember=i[o].SysColumnName.toString(),t.ID=i[o].SysColumnName.toString(),t.CrRefColName=i[o].SysColumnName.toString(),t.DataType=i[o].ColumnDataType.toString(),t.IsColumnUserDefined=(0,le.yG0)(i[o].IsColumnUserDefined),t.Mandatory=(0,le.yG0)(i[o].IsMandatory),t.DataType.toUpperCase()){case"LISTBOX":t.ValueMember=t.ID+"_Key",this.dgvEmployees.TableColumns.push(t.ID),this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(t.ID+"_Key"),t.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),t.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString()),c.J0.IsEmpty(i[o].FetchMaxRows)?c.J0.IsEmpty(i[o].UserProbableValues)||(t.FilterColumn=i[o].UserProbableValues.toString()):t.GridViewID=parseInt(i[o].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(t.ID),t.IsColumnUserDefined)if("Date"==i[o].UserColumnType.toString()&&(t.DataType="DATE",this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(t.ID+"_Key")),"DateTime"==i[o].UserColumnType.toString())t.DataType="DATETIME",this.dgvEmployees.TableColumns.push(t.ID+"_Key");else if("Time"==i[o].UserColumnType.toString())t.DataType="TIME",this.dgvEmployees.TableColumns.push(t.ID+"_Key");else if("Numeric"==i[o].UserColumnType.toString())t.DataType="FLOAT";else if("SELECTIONBOX"==i[o].UserColumnType.toString()||"editablecombobox"==i[o].UserColumnType.toString().toLowerCase())t.DataType="SELECTIONBOX",t.CostCenterID=this.CostCenterID;else if("combobox"==i[o].UserColumnType.toString().toLowerCase()){if(t.ValueBinding=t.ID,!c.J0.IsEmpty(i[o].linkData)&&22803==parseInt(i[o].linkData.toString())||"@YEAR"==t.DefaultValue){t.DataType="PactComboBox";let r=[];for(let h=1980;h<2100;h++){let C={};C.Year=h.toString(),r.push(C)}t.DisplayMember="Year",t.ValueMember="Year",t.ComboData=r,"@YEAR"==t.DefaultValue&&(t.DefaultValue="")}else{t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=[],h=i[o].UserProbableValues.toString().Trim();if(h.length>0){let C=h.split(";");for(let g=0;g<C.length;g++)r.push(n._p.ComboBoxItems_2(C[g],C[g]))}t.ComboData=r}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}else if("LISTBOX"==i[o].UserColumnType.toString())if(44==parseInt(i[o].ColumnCostCenterID.toString())){t.ValueBinding=t.ID,t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=ht.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=r){let h=[];for(let C=0;C<r.length;C++)h.push(n._p.ComboBoxItems_2(r[C].Name.toString(),r[C].NodeID.toString()));t.ComboData=h}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}else t.DataType="LISTBOX",t.ValueMember=t.ID+"_Key",this.dgvEmployees.TableColumns.push(t.ID+"_Key"),t.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),t.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString());else if("Attachment"==i[o].UserColumnType.toString())t.DataType="LINK",t.ReadOnly=!0,t.FilterCondition=i[o].BasedOnXml.toString(),t.Dependantinuse=!1;else if("Image"==i[o].UserColumnType.toString())t.DataType="LINK",t.ReadOnly=!0,t.Dependantinuse=!0;else if("LOOKUP"==i[o].UserColumnType.toString()){t.ValueBinding=t.ID,t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=ht.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=r){let h=[];for(let C=0;C<r.length;C++)h.push(n._p.ComboBoxItems_2(r[C].Name.toString(),r[C].NodeID.toString()));t.ComboData=h}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}break;case"DATE":t.DataType="DATE",this.dgvEmployees.TableColumns.push(t.ID),this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(t.ID+"_Key")}t.Width=100,t.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.Contains(i[o].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(i[o].SysColumnName.toString())}if(this.dtCust=d.d.common.GetDataTable("PAY059",d.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let o=new c.VB;if(o.ReadXml(this.dtCust[0].ValueXml.toString()),null!=o&&o.Tables.length>0&&o.Tables[0].length>0){let r,h=3;for(let C=0;C<this.dgvEmployees.Columns.length;C++)r=o.Tables[0].filter(g=>g.SysColumnName==this.dgvEmployees.Columns[C].CrRefColName),r.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[C].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):(r=o.Tables[0].filter(g=>g.ID==this.dgvEmployees.Columns[C].CrRefColID),null!=r&&r.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[C].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):(r=o.Tables[0].filter(g=>g.ID==-this.dgvEmployees.Columns[C].CrRefColID),null!=r&&r.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[C].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):this.dgvEmployees.Columns[C].DisplayIndex=C))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}t=new K.O7,t.Header=this.GetResource("Result",40054),t.DisplayMember="Result",t.ID="Result",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}OnPreviewKeyDown(a,l,t){if("F5"==l.key){var i=this.dgvEmployees.Columns.find(o=>o.DisplayMember==t);if(null!=i){if(i.ReadOnly||"sno"==t.toLowerCase()||!confirm("Do you want to override all.?"))return!0;for(let o=0;o<this.dgvEmployees.Table.length;o++)this.dgvEmployees.Table[o][t]=a[t].toString(),this.dgvEmployees.TableColumns.Contains(t+"_Key")&&(this.dgvEmployees.Table[o][t+"_Key"]=a[t+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[o]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[o],t,-1)}}else if(l.ctrlKey)if("F"==l.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),l.Handled=!0;else if("E"==l.key){let o=this.GetRawExportHTML().toString();const r=new Blob([o],{type:"text/plain;charser=utf-8"});It.saveAs(r,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),l.Handled=!0}return!1}static GetLookupData(a){let l=d.d.common.GetDataSet("PAY060",a.toString());return null!=l&&l.Tables.length>0&&l.Columns[0].Contains("NodeID")?l.Tables[0]:null}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgvEmployees.Table.length;l++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Process"==a.toString()?this.btnProcess_Click():"Load"==a.toString()?this.btnLoad_Click():"Export"==a.toString()?this.btnExport_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,d.d.page.ShowDialog(this,Nt.L,{Title:"Reports"}));Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}btnExport_Click(){this.dgvEmployees.Excelexportdelegate.Call()}btnLoad_Click(){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;let a=[];a.push(this);let l=new Kt(a);d.d.page.ShowDialog(l,qt,{Title:"Load Data"}).subscribe(()=>{if(l.DialogResult){if(!l.dtDataColumns.Contains("Employee Code"))return this.DisplayMessage="'Employee Code' Column not found.",void(this.MessageVisibility=!0);this.objCMPLData=l.dtData,this.sBGWorkType="LOAD",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")})}catch(a){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",a)}}LoadXLData(a){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";let l=0;if(null!=a&&a.length>0){l=a.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=l,this.ProgressMessage="Loading Excel Data, please wait ...";let t,i="",o=-1;for(let r=0;r<this.dgvEmployees.Table.length;r++)if(!c.J0.IsEmpty(this.dgvEmployees.Table[r].EmpCode)&&(i="",t=a.filter(h=>h["Employee Code"].toLowerCase()==this.dgvEmployees.Table[r].EmpCode.toString().toLowerCase()),t.length>0)){for(let h=1;h<Object.keys(a[0]).length;h++){let C=Object.keys(a[0])[h];for(let g=0;g<this.dgvEmployees.TableColumns.length;g++)if(this.dgvEmployees.Columns[g].Header==C&&this.dgvEmployees.TableColumns.Contains(this.dgvEmployees.Columns[g].ID)){this.dgvEmployees.Table[r][this.dgvEmployees.Columns[g].ID]=t[0][Object.keys(t[0])[h]].toString();{let D=this.dgvEmployees.Table.indexOf(this.dgvEmployees.Table[r]);this.iEmpIndex=this.lstSelectedEmps.indexOf(D);let p=0,e=-1;this.dgvEmployees.Columns[g].ID.startsWith("EarningOTHrs")?(p=1,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("EarningOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Earning")?(p=0,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Earning","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("DeductionOTHrs")?(p=3,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("DeductionOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Deduction")&&(p=2,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Deduction","")),i=this.dgvEmployees.Columns[g].ID,o=g);let T=this.oCMP.arrLstCPFields[this.iEmpIndex][p].find(P=>P.SNo==e);null!=T&&(T.dActual=parseFloat(t[0][Object.keys(t[0])[h]].toString()).ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],("DaysAttended"==this.dgvEmployees.Columns[g].ID||"LOPDays"==this.dgvEmployees.Columns[g].ID)&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[r],this.dgvEmployees.Columns[g].ID,g)}break}}o>=0&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[r],i,o),this.ProgressValue=r+1,this.InProgress=r+1+" of "+l}this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}btnProcess_Click(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}AddArrearColumns(){if(this.IsProcessWithArrears||this.IsProcessWithAdjustments){let t=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);t.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(t,"Earning"),t=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),t.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(t,"Deduction")}else{let t=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);if(t.sort((i,o)=>i.SNo-o.SNo),null!=t&&t.length>0)for(let i=0;i<t.length;i++)this.dgvEmployees.TableColumns.Contains("Earning"+t[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Earning"+t[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(o=>o.DisplayMember=="Earning"+t[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Earning"+t[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Earning"+t[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Earning"+t[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a));if(t=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),null!=t&&t.length>0)for(let i=0;i<t.length;i++){var a;this.dgvEmployees.TableColumns.Contains("Deduction"+t[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+t[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Deduction"+t[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Deduction"+t[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+t[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Deduction"+t[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a))}}let l=[];for(let t=0;t<this.dgvEmployees.Columns.length;t++)l.push(this.dgvEmployees.Columns[t]);this.dgvEmployees.Columns=l}AddEarDedArrearColumns(a,l){if(null!=a&&a.length>0){let t;if(this.IsProcessWithArrears)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Arr"))break;if(!c.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;t=new K.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Arr",t.DisplayMember=l+a[i].SNo.toString()+"_Arr",t.ID=l+a[i].SNo.toString()+"_Arr",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"-1"!=c.J0.String(a[i].Visible)&&(t.IsVisible="1"==c.J0.String(a[i].Visible)),"-1"!=c.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=c.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=c.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==c.J0.String(a[i].Mandatory));let o=this.dgvEmployees.Columns.find(r=>r.DisplayMember==l+a[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}if(this.IsProcessWithAdjustments)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Adj"))break;if(!c.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;t=new K.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Adj",t.DisplayMember=l+a[i].SNo.toString()+"_Adj",t.ID=l+a[i].SNo.toString()+"_Adj",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"-1"!=c.J0.String(a[i].Visible)&&(t.IsVisible="1"==c.J0.String(a[i].Visible)),"-1"!=c.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=c.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=c.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==c.J0.String(a[i].Mandatory));let o=this.dgvEmployees.Columns.find(r=>r.DisplayMember==l+a[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}}}btnUnPost_Click(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1,d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnFilter_Click(){this.sFilter="",d.d.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(d.d.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new lt.t("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new lt.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),d.d.page.ShowDialog(this.objEmpFilter,ct.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let r=0;r<this.objEmpFilter.CostCenterFilters.length;r++){let h=this.objEmpFilter.CostCenterFilters[r];if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(C=>C.Id==l&&C.IsGroup))if(o+=" AND ",mt.IPrefetchFilter.IsGroupTree(h)){let C="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(C.length>0&&(C+=","),C+=h.SelectedNodes[g].Id);0==C.length&&(C+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+qe.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+qe.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ",o+=C.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let C=0;C<h.SelectedNodes.length;C++)C>0&&(o+=","),o+=h.SelectedNodes[C].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}if(this.objEmpFilter.Filter>0){this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let l=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=l.Trim()&&"None"!=l&&(this.sFilter+="TreeView"==l?" ORDER BY EMP.lft ":" ORDER BY EMP."+l);let t=[];t.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(d.d.SessionManager.RoleID),t.push(d.d.SessionManager.UserID),t.push(d.d.SessionManager.LanguageID);let o,i=d.d.empService.GetData(t,"spPAY_GetEmpMasterCCDetails");if(this.btnClear_Click(),null!=i&&i.Tables.length>0&&i.Tables[0].length>0){if(o=i.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let r=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayroll"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53);if(null!=r&&r.length>0&&null!=r[0].Value&&null!=r[0].Value&&""!=r[0].Value.toString()&&"True"==r[0].Value.toString()&&(r=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayrollDays"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53),null!=r&&r.length>0&&null!=r[0].Value&&null!=r[0].Value&&""!=r[0].Value.toString())){let h=0;if(h=parseInt(r[0].Value),h>0){let C=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),h),g=i.Tables[0].filter(D=>new Date(D.DOJ)<=C);null!=g&&g.length>0&&(i=[],i=g)}}i.sort((h,C)=>C.CCNID53-h.CCNID53),o=i}this.AddGradeApplicableColumns(o);for(let r=0;r<o.length;r++){let h=this.dgvEmployees.NewRow();h.EmpSeqNo=o[r].EmpSeqNo,h.EmpCode=o[r].EmpCode,h.EmpName=o[r].EmpName,h.GradeID=o[r].CCNID53,h.SNo=(r+1).toString(),h.Select=!1;let C,g="";for(let D=0;D<this.dgvEmployees.TableColumns.length;D++)g=this.dgvEmployees.TableColumns[D],(g.startsWith("dcAlpha")||g.startsWith("dcCCNID"))&&(C=this.dsDocDesig.Tables[0].filter(p=>p.SysColumnName==g),null!=C&&C.length>0&&(c.J0.IsEmpty(C[0].UserColumnType)||("LISTBOX"==C[0].UserColumnType.toString().toUpperCase()?c.J0.IsEmpty(C[0].UserDefaultValue)||(h[g+"_Key"]=C[0].UserDefaultValue.toString()):"TEXT"==C[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==C[0].UserColumnType.toString().toUpperCase()?c.J0.IsEmpty(C[0].UserDefaultValue)||(h[g]=C[0].UserDefaultValue.toString()):"DATE"==C[0].UserColumnType.toString().toUpperCase()&&(c.J0.IsEmpty(C[0].UserDefaultValue)||"TODAY"==C[0].UserDefaultValue.toString().toUpperCase()&&(h[g]=(new Date).ToString(d.d.SessionManager.Preferences["Date Format"]),this.dgvEmployees.TableColumns.Contains(g+"_Key")&&(h[g+"_Key"]=new Date))))));this.dgvEmployees.addRow(h),this.dgvEmployees.RefreshGrid=!0}}}}}),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}AddGradeApplicableColumns(a){let l,t="";if(null!=(a=a.ToTable(!0,["CCNID53"]))&&a.length>0)for(let o=0;o<a.length;o++)!c.J0.IsEmpty(t)&&t.length>0&&(t+=","),t+=a[o].CCNID53.toString();if(!c.J0.IsEmpty(t)&&t.length>0&&(l=d.d.common.GetDataSet3("PAY125",t,d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"")),null!=l&&l.Tables.length>0){let o=this.dsStructure.Tables[0].filter(C=>1==C.Type);if(o.sort((C,g)=>C.SNo-g.SNo),null!=o&&o.length>0)for(let C=0;C<o.length;C++)this.dgvEmployees.TableColumns.Contains("Earning"+o[C].SNo)?(this.dgvEmployees.TableColumns.Remove("Earning"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(g=>g.DisplayMember=="Earning"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i)):this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTHrs"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="EarningOTHrs"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTAmt"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="EarningOTAmt"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i)));if(o=this.dsStructure.Tables[0].filter(C=>2==C.Type),null!=o&&o.length>0)for(let C=0;C<o.length;C++)if(this.dgvEmployees.TableColumns.Contains("Deduction"+o[C].SNo))this.dgvEmployees.TableColumns.Remove("Deduction"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="Deduction"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i);else if(this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+o[C].SNo)){var i;this.dgvEmployees.TableColumns.Remove("DeductionOTHrs"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(D=>D.DisplayMember=="DeductionOTHrs"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("DeductionOTAmt"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(p=>p.DisplayMember=="DeductionOTAmt"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i))}let r=this.dgvEmployees.Columns.find(C=>"TotalDays"==C.DisplayMember);null!=r&&(this.iColId=this.dgvEmployees.Columns.indexOf(r)),o=l.Tables[0].filter(C=>1==C.Type),o.sort((C,g)=>C.SNo-g.SNo),this.AddEarDedColumns(o,"Earning"),r=this.dgvEmployees.Columns.find(C=>"TotalEarnings"==C.DisplayMember),null!=r&&(this.iColId=this.dgvEmployees.Columns.indexOf(r)),o=l.Tables[0].filter(C=>2==C.Type),o.sort((C,g)=>C.SNo-g.SNo),this.AddEarDedColumns(o,"Deduction");let h=[];for(let C=0;C<this.dgvEmployees.Columns.length;C++)h.push(this.dgvEmployees.Columns[C]);if(this.dgvEmployees.Columns=h,this.dtCust=d.d.common.GetDataTable("PAY059",d.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let C=new c.VB;if(C.ReadXml(this.dtCust[0].ValueXml.toString()),null!=C&&C.Tables.length>0&&C.Tables[0].length>0){let g,D=3;for(let p=0;p<this.dgvEmployees.Columns.length;p++)g=C.Tables[0].filter(e=>e.SysColumnName==this.dgvEmployees.Columns[p].CrRefColName),g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=C.Tables[0].filter(e=>e.ID==this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=C.Tables[0].filter(e=>e.ID==-this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+D,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):this.dgvEmployees.Columns[p].DisplayIndex=p))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}}}AddEarDedColumns(a,l){if(null!=a&&a.length>0){let t;for(let i=0;i<a.length;i++)c.J0.IsEmpty(a[i].Behaviour)||"Accruals"!=a[i].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=a[i].Behaviour.toString()?(t=new K.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052),t.DisplayMember=l+a[i].SNo.toString(),t.ID=l+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"OverTime"==a[i].FieldType.toString()?(t.DisplayMember="EarningOTHrs"+a[i].SNo.toString(),t.ID="EarningOTHrs"+a[i].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==a[i].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=c.J0.String(a[i].Visible)&&(t.IsVisible="1"==c.J0.String(a[i].Visible)),"-1"!=c.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=c.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=c.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==c.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember),"OverTime"==a[i].FieldType.toString()&&(t=new K.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(a[i].ComponentID),t.DisplayMember=l+"OTAmt"+a[i].SNo.toString(),t.ID=l+"OTAmt"+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightBlue","-1"!=a[i].Visible.toString()&&(t.IsVisible="1"==a[i].Visible.toString()),"-1"!=a[i].Width.toString()&&(t.Width=parseInt(a[i].Width)),"-1"!=a[i].IndexValue.toString()&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=a[i].Mandatory.toString()&&(t.Mandatory="1"==a[i].Mandatory.toString()),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))):(t=new K.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052),t.DisplayMember=l+a[i].SNo.toString(),t.ID=l+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="GreenYellow",t.Width=80,"Monthly"==a[i].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=c.J0.String(a[i].Visible)&&(t.IsVisible="1"==c.J0.String(a[i].Visible)),"-1"!=c.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=c.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=c.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==c.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}}bgworker_DoWork(a,l){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}ProcessPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let r,t="",i="",o=new Array,h=!1,C=0;for(let g=0;g<this.dgvEmployees.Table.length;g++)if((0,le.yG0)(this.dgvEmployees.Table[g].Select)&&(t+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,C=0,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let D=0;D<o.length;D++)if(o[D].GradeID==parseInt(this.dgvEmployees.Table[g].GradeID)){C=D,h=!0;break}h?(i=o[C].sEmpIds,i+=","+this.dgvEmployees.Table[g].EmpSeqNo.toString(),o[C].sEmpIds=i,o[C].lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo))):(r=new Ct.ii,r.GradeID=parseInt(this.dgvEmployees.Table[g].GradeID),r.sEmpIds=this.dgvEmployees.Table[g].EmpSeqNo.toString(),r.lstGradeEmps=new Array,r.lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo)),o.push(r))}if(t.length>0&&l>0){if(t=t.substr(0,t.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let g=[];g.push(t),g.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(c.J0.IntTryParse(d.d.SessionManager.UserID)),g.push(d.d.SessionManager.LanguageID),this.dsDailyAttendanceData=d.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new $e.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=t,d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()&&(this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0)),this.oCMP.PayrollMonth=d.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let D=0;D<o.length;D++)o[D].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=o[D].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=o[D].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=o[D].GradePayrollMonthEnd);this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);let g=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(g=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(D=>D.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==D.VoucherType)),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(c.J0.IsEmpty(g[0].dcAlpha21)||""==c.J0.String(g[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=g[0].dcAlpha21.toString()),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=g[0].dcAlpha22.toString());let D=d.d.common.GetDataTable("PAY099",c.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=D&&D.length>0){let p=d.d.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<D.length;e++){let T=c.J0.ParseDate(D[e].ArrearsCalcMonths);if(null!=p&&p.length>0){let P=p.filter(A=>A.ArrAdjMonth==T);if(null!=P&&P.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].ArrData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].ArrData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][D].dArrear="0";for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][D].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}if(this.IsProcessWithAdjustments){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(c.J0.IsEmpty(g[0].dcAlpha32)||""==c.J0.String(g[0].dcAlpha32).Trim())this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=g[0].dcAlpha32.toString()),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=g[0].dcAlpha33.toString());let D=d.d.common.GetDataTable("PAY113",c.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy")+"~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);if(null!=D&&D.length>0){let p=d.d.common.GetDataTable("PAY114",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<D.length;e++){let T=c.J0.ParseDate(D[e].AdjMonth);if(null!=p&&p.length>0){let P=p.filter(A=>A.ArrAdjMonth==T);if(null!=P&&P.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].AdjData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].AdjData+=T.ToString("dd MMM yyyy")+","+parseFloat(P[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][D].dAdjusted="0";for(let D=0;D<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;D++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][D].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=""),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.IsProcessWithAdjustments&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(D=>(0,le.yG0)(D.Select)).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}CalculateArrears(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];let l=new Array,t=d.d.empService.GetQueryData(a,"ARE001",d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"","");if(null!=t&&t.Tables[0].length>0){let i=c.J0.ParseDate(t.Tables[0][0].DtApplyFrom.toString()),o=c.J0.ParseDate(t.Tables[0][0].DtEffectFrom.toString()),r=t.Tables[1][0].ArrCalcMonths.toString().Replace("/"," ");if(o>i&&d.d.SessionManager.PayrollMonth>=o){let h=i;for(;h<o;)r.Contains(h.ToString("dd MMM yyyy"))||l.push(h.ToString("dd MMM yyyy")),h=h.AddMonths(1)}}if(l.length>0){let o,r,i="";for(let D=0;D<l.length;D++)i.length>0&&(i+=";"),i+=l[D],o={},o.PayrollMonth=l[D],this.dtArrData.push(o);let h="'"+i.Replace(";","','")+"'",C=d.d.common.GetDataSet3("PAY079",a.toString(),h).Tables[0];if(null!=C&&C.length>0){r=C.filter(D=>11==D.VoucherType);for(let D=0;D<r.length;D++)this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.length>0&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+=";"),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+c.J0.String(r[D].PaidDays)}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=i;let g=i.split(";");if(g.length>0){for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][F].dArrear="0";for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][F].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0;let e,T,D=d.d.common.GetDataTable("PAY098",""),p=d.d.common.GetDataSet3("PAY101",a.toString(),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),A=0;for(let F=0;F<g.length;F++)if(null!=g[F]&&""!=g[F]&&(r=C.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")),r.length>0)){let j=D.filter(N=>N.GradeID==r[0].dcCCNID53&&new Date(N.CPayrollDate)<=new Date(g[F])).Compute("max","CPayrollDate"),E=D.filter(N=>N.GradeID==r[0].dcCCNID53&&new Date(N.CPayrollDate)==new Date(j.ToString())),b=new $e.O;if(b.oParent=this,b.sSelectedEmpSeqNos=a.toString(),b.PayrollMonth=d.d.SessionManager.PayrollMonth,b.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,b.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,b.drcArrStructure=E,b.IsArrearclick=!0,b.ArrGradeID=parseInt(r[0].dcCCNID53),b.ProcessPayroll(),b.IsCompleted){b.arrLstOthMPFields[0].TotalDays=parseFloat(r[0].TotalDays),b.arrLstOthMPFields[0].MonthDays=parseFloat(r[0].TotalDays),b.arrLstOthMPFields[0].PaidLeaves=parseFloat(r[0].dcAlpha24),b.arrLstOthMPFields[0].TotalLeaves=parseFloat(r[0].LeavesTaken),b.arrLstOthMPFields[0].WeeklyOffs=parseFloat(r[0].WOffs),b.arrLstOthMPFields[0].Holidays=parseFloat(r[0].Holidays);let N=parseFloat(r[0].TotalDays.toString())-parseFloat(r[0].LOPDays.toString())-parseFloat(r[0].LeavesTaken.toString())-parseFloat(r[0].UnpaidDays.toString());e=p.Tables[0].filter(w=>w.AdjMonth==c.J0.ParseDate(g[F])),null!=e&&e.length>0&&(N+=parseFloat(e[0].Days)),T=p.Tables[1].filter(w=>2==w.DType&&w.ArrAdjMonth==c.J0.ParseDate(g[F])),b.SetDaysAttended(0,"Days Attended",N);let te=0,Q=-1,W=0;r=C.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&11==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;w++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateArrears)for(let ne=0;ne<b.arrLstCPFields[0][0].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo==b.arrLstCPFields[0][0][ne].SNo){W=0,A=0,Q=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo,c.J0.IsEmpty(r[0]["dcCalcNum"+Q])||(W=parseFloat(r[0]["dcCalcNum"+Q])),null!=T&&T.length>0&&(c.J0.IsEmpty(T[0]["Earning"+Q])||(A=parseFloat(T[0]["Earning"+Q]))),te=parseFloat(b.arrLstCPFields[0][0][ne].dEarned)-W-A,this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData+=g[F]+","+te+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dArrear)+te).ToString(d.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+=te);break}r=C.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&12==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;w++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateArrears)for(let ne=0;ne<b.arrLstCPFields[0][2].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo==b.arrLstCPFields[0][2][ne].SNo){W=0,A=0,Q=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo,null!=r[0]["dcCalcNum"+Q]&&null!=r[0]["dcCalcNum"+Q]&&""!=r[0]["dcCalcNum"+Q].toString()&&(W=parseFloat(r[0]["dcCalcNum"+Q])),null!=T&&T.length>0&&null!=T[0]["Deduction"+Q]&&null!=T[0]["Deduction"+Q]&&""!=T[0]["Deduction"+Q].toString()&&(A=parseFloat(T[0]["Deduction"+Q])),te=parseFloat(b.arrLstCPFields[0][2][ne].dEarned)-W-A,this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData+=g[F]+","+te+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dArrear)+te).ToString(d.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+=te);break}}b.IsArrearclick=!1}let _="",x="";_=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays,x=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=_,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=x,this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+l.Message+"\r\n"+l.stack)}}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,C,l=[],t=d.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=d.d.SessionManager.PayrollMonth.AddMonths(-1),r=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=r;){if(C=t.filter(D=>D.PayrollMonth&&c.J0.ParseDate(D.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=C&&C.length>0){if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let D,p,e,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e};if(c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=c.J0.GetEmployeeGrade(a.toString(),D,p,e),_>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e},c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T,_),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd)}let P=[];P.push(a),P.push(D.ToString("dd/MMM/yyyy")),P.push(p.ToString("dd/MMM/yyyy")),P.push(e.ToString("dd/MMM/yyyy")),P.push(0),P.push(d.d.SessionManager.UserID),P.push(d.d.SessionManager.RoleID),P.push(d.d.SessionManager.LanguageID);let A=d.d.empService.ExecuteQuery_SP(P,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(e.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(d.d.SessionManager.RoleID),_.push(d.d.SessionManager.UserID),_.push(d.d.SessionManager.LanguageID);let x=d.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),F=new Ct.mr,j=F.AggregateLeaves(a.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);j>0&&(h.Days=-j),g=F.lstPrevAdj}l.push(h)}if(null!=g&&g.length>0&&d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let D=0;D<g.length;D++)g[D].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy"),h.Days=g[D].dDays,l.push(h))}else if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let D,p,e,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e};c.J0.SetPayrollDate_1(i,T),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd;let P=d.d.SessionManager.PayrollMonth,A=0;d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=c.J0.GetEmployeeGrade(a.toString(),D,p,e),A>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e},c.J0.SetPayrollDate(i,T,A),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd),c.J0.SetPayrollMonth(D,d.d.SessionManager,A)),c.J0.SetPayrollMonth(D,d.d.SessionManager,A);let _=new $e.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=d.d.SessionManager.PayrollMonth,_.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),c.J0.SetPayrollMonth(P),l.push(h)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let D=0;D<l.length;D++)null!=l[D].Days&&null!=l[D].Days&&""!=l[D].Days.toString().Trim()&&(h={},h.PayrollMonth=d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[D].PayrollMonth.toString(),h.Days=l[D].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let D=0;D<this.dtAdjData.length;D++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[D].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[D].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=d.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),c.J0.SetPayrollMonth(a,d.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let t,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let r=d.d.empService.GetQueryData(a,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=d.d.empService.GetQueryData(0,"MPL014","","",""),C=d.d.empService.GetQueryData(a,"MPL005","","",""),g=d.d.empService.GetQueryData(a,"MPL011",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),D="";for(let e=0;e<this.dtAdjData.length;e++){let T=new Date(this.dtAdjData[e].AdjMonth),P=T;t=r.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==j.VoucherType);let A=null;if(null!=t&&t.length>0){let j=h.filter(E=>E.GradeID==t[0].dcCCNID53&&E.CPayrollDate<=P.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(E=>E.GradeID==t[0].dcCCNID53&&E.CPayrollDate==c.J0.String(j))}if(D="'"+T.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+T.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=C.filter(j=>T.ToString("dd/MMM/yyyy")>=j.ApplyFrom&&T.ToString("dd/MMM/yyyy")<=j.EffectFrom),p=p.sort((j,E)=>j.EffectFrom-E.EffectFrom),i=g.Tables[0].filter(j=>j.ArrearsCalcMonths==c.J0.ParseDate(T)),o=g.Tables[1].filter(j=>1==j.DType&&j.ArrAdjMonth==c.J0.ParseDate(T)),null!=p&&p.length>0){let j=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let E=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(E.length>0)for(let b=0;b<E.length;b++)c.J0.ParseDate(E[b]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(j=!0)}null!=i&&i.length>0||j?(T=c.J0.ParseDate(p[0].EffectFrom),d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T)):d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T)}else d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T);let _=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=d.d.SessionManager.Preferences.PayDays?parseInt(d.d.SessionManager.Preferences.PayDays):T.DaysInMonth();let F=new $e.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=d.d.SessionManager.PayrollMonth,F.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=t&&t.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=c.J0.Int(t[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let j=0;null!=t&&t.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(t[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(t[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(t[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(t[0].Holidays),j=parseFloat(t[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",j)):c.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&c.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let W,E=0,b=-1,N=0,te=0,Q=0;t=r.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;w++)if(c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateAdjustments)for(let ne=0;ne<F.arrLstCPFields[0][0].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo==F.arrLstCPFields[0][0][ne].SNo){if(N=0,te=0,Q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo,!c.J0.IsEmpty(t)&&t.length>0&&!c.J0.IsEmpty(t[0]["dcCalcNum"+b])&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.split(";"),null!=W&&W.length>0))for(let ce=0;ce<W.length;ce+=2)new Date(W[ce]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(te=parseFloat(W[ce+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+b]&&null!=o[0]["Earning"+b]&&""!=o[0]["Earning"+b]&&(Q=parseFloat(o[0]["Earning"+b])),E=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,le.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][ne].ComponentName?parseFloat(F.arrLstCPFields[0][0][ne].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][ne].dEarned)-N-te-Q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData=c.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData+=P.ToString("dd MMM yyyy")+","+E+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dAdjusted)+E).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=E);break}t=r.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&12==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;w++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments)for(let ne=0;ne<F.arrLstCPFields[0][2].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo==F.arrLstCPFields[0][2][ne].SNo){if(N=0,te=0,Q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo,null!=t&&t.length>0&&null!=t[0]["dcCalcNum"+b]&&null!=t[0]["dcCalcNum"+b]&&""!=t[0]["dcCalcNum"+b].toString()&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.split(";"),null!=W&&W.length>0))for(let ce=0;ce<W.length;ce+=2)new Date(W[ce]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(te=parseFloat(W[ce+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+b]&&null!=o[0]["Deduction"+b]&&""!=o[0]["Deduction"+b]&&(Q=parseFloat(o[0]["Deduction"+b])),E=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,le.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][ne].ComponentName?parseFloat(F.arrLstCPFields[0][2][ne].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][ne].dEarned)-N-te-Q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData=c.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData+=P.ToString("dd MMM yyyy")+","+E+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dAdjusted)+E).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=E);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(t=>t.EmpSeqNo==a),l.length>0&&c.J0.ParseDate(l[0].cEffectFrom).getFullYear()==d.d.SessionManager.PayrollMonth.getFullYear()&&c.J0.ParseDate(l[0].cEffectFrom).iMonth()==d.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",i=0,o=0,r=0,h=0,C=0,g=0,D=0,p=0,e=0,T=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let P=d.d.empService.GetQueryData(a,"CONS002",JSON.stringify(t),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=d.d.empService.GetQueryData(0,"CONS003","","","");if(null!=P&&P.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,r=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<P.length;F++)C=parseFloat(P[F].TotalDays),h=parseFloat(P[F].DaysAttended)+parseFloat(P[F].PaidLeaves)+parseFloat(P[F].LOPDays),g=parseFloat(P[F]["dcCalcNum"+T]),D=parseFloat(P[F]["dcCalcNumFC"+T]),p=parseFloat((h/C*i).ToString(d.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(d.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(d.d.SessionManager.sPayrollDecimals)),r+=D;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-r).ToString(d.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<P.length;x++){let F=A.filter(b=>b.GradeID==parseInt(P[x].GradeID)&&b.CPayrollDate==c.J0.ParseDate(P[x].PayrollDate)).Compute("max","CPayrollDate"),j=A.filter(b=>b.GradeID==parseInt(P[x].GradeID)&&b.CPayrollDate==F),E=new $e.O;if(E.oParent=this,E.sSelectedEmpSeqNos=a.toString(),E.PayrollMonth=d.d.SessionManager.PayrollMonth,E.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,E.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,E.drcArrStructure=j,E.IsCalculateAccruals=!0,E.ArrGradeID=parseInt(P[x].GradeID),E.ProcessPayroll(),E.IsCompleted){E.arrLstOthMPFields[0].TotalDays=parseFloat(P[x].TotalDays),E.arrLstOthMPFields[0].MonthDays=parseFloat(P[x].TotalDays),E.arrLstOthMPFields[0].PaidLeaves=parseFloat(P[x].PaidLeaves),E.arrLstOthMPFields[0].TotalLeaves=parseFloat(P[x].LeavesTaken),E.arrLstOthMPFields[0].WeeklyOffs=parseFloat(P[x].WOffs),E.arrLstOthMPFields[0].Holidays=parseFloat(P[x].Holidays),h=parseFloat(P[x].TotalDays.toString())-parseFloat(P[x].LOPDays.toString())-parseFloat(P[x].LeavesTaken.toString())-parseFloat(P[x].UnpaidDays.toString()),E.SetDaysAttended(0,"Days Attended",h);let b=0,N=-1,te=0,Q=0;for(let W=0;W<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].Behaviour)for(let w=0;w<E.arrLstCPFields[0][0].length;w++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].SNo==E.arrLstCPFields[0][0][w].SNo){te=0,Q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].SNo,null!=P[x]["dcCalcNum"+N]&&null!=P[x]["dcCalcNum"+N]&&""!=P[x]["dcCalcNum"+N].toString()&&(te=parseFloat(P[x]["dcCalcNum"+N])),null!=P[x]["dcCalcNumFC"+N]&&null!=P[x]["dcCalcNumFC"+N]&&""!=P[x]["dcCalcNumFC"+N].toString()&&(Q=parseFloat(P[x]["dcCalcNumFC"+N])),b=parseFloat(E.arrLstCPFields[0][0][w].dEarned)-te,this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].dPrevAccEar+=parseFloat(b.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].dPrevAccAdj+=Q;break}for(let W=0;W<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].Behaviour)for(let w=0;w<E.arrLstCPFields[0][2].length;w++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].SNo==E.arrLstCPFields[0][2][w].SNo){te=0,Q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].SNo,null!=P[x]["dcCalcNum"+N]&&null!=P[x]["dcCalcNum"+N]&&""!=P[x]["dcCalcNum"+N].toString()&&(te=parseFloat(P[x]["dcCalcNum"+N])),null!=P[x]["dcCalcNumFC"+N]&&null!=P[x]["dcCalcNumFC"+N]&&""!=P[x]["dcCalcNumFC"+N].toString()&&(Q=parseFloat(P[x]["dcCalcNumFC"+N])),b=parseFloat(E.arrLstCPFields[0][2][w].dEarned)-te,this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].dPrevAccEar+=parseFloat(b.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].dPrevAccAdj+=Q;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals))}}}}FillProcessedData(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;l++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo)&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dArrear).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dAdjusted).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;l++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dActual).ToString(d.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;l++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo)&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dArrear).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dAdjusted).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;l++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dActual).ToString(d.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;l++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt&&(this.dgvEmployees.Table[a]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo]=c.J0.Double(this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;l++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo)&&(this.dgvEmployees.Table[a]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].LeaveTaken).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;l++)if(this.dgvEmployees.TableColumns.Contains(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName))if("LISTBOX"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldDataType){if("EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue){let t=d.d.SessionManager.dtFeatures.filter(i=>i.FeatureID==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName.Replace("dcCCNID",""))+5e4);if(null!=t&&t.length>0){let i=d.d.empService.GetQueryData(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,"CONS001",t[0].TableName.toString(),"","");null!=i&&i.length>0&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=i[0].Name.toString(),this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)}}}else"DATE"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldUserColumnType?"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=c.J0.ParseDate(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)))):"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[a].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[a].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[a].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[a].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[a].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[a].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[a].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[a].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[a].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[a].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[a].TotalEarnings=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[a].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[a].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[a]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}CheckViewForUser(a){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(let l=0;l<this.dgvEmployees.Columns.length;l++)this.SetView(this.dgvEmployees.Columns[l])}SetView(a){let l=this.dsDocDesig.Tables[6],t=this.dsDocDesig.Tables[0];l=l.filter(i=>1==i.Mode||2==i.Mode||3==i.Mode||4==i.Mode),a instanceof K.O7&&(l=a.CrRefColID>0?l.filter(i=>i.CostCenterColID==1e6+a.CrRefColID):null!=a.CrRefColName&&""!=a.CrRefColName&&a.CrRefColName.startsWith("dcAlpha")?l.filter(i=>i.SysColumnName==a.CrRefColName):[]),l.length>0?(a instanceof K.O7&&(a.IsVisible=(0,le.yG0)(l[0].IsVisible.toString())),c.J0.IsEmpty(l[0].IsMandatory)||a instanceof K.O7&&(a.Mandatory=(0,le.yG0)(l[0].IsMandatory)),a instanceof K.O7&&(a.ReadOnly=!(0,le.yG0)(l[0].IsEditable)),a instanceof K.O7&&(a.Expression=c.J0.String(l[0].Expression)),a instanceof K.O7&&(a.Message=c.J0.String(l[0].FailureMessage)),c.J0.IsEmpty(l[0].ActionOptionID)?a instanceof K.O7&&(a.Action=0):a instanceof K.O7&&(a.Action=parseInt(l[0].ActionOptionID)),c.J0.IsEmpty(l[0].NumFieldEditOptionID)?a instanceof K.O7&&(a.EditOption=0):a instanceof K.O7&&(a.EditOption=parseInt(l[0].NumFieldEditOptionID.toString()))):(a instanceof K.O7&&(t="combobox"==a.DataType.toLowerCase()?t.filter(i=>i.SysColumnName==a.ValueBinding):t.filter(3==a.CostCenterID||2==a.CostCenterID?i=>i.CostcenterColid==a.ID:i=>i.SysColumnName==a.DisplayMember)),t.length>0&&(a instanceof K.O7&&(d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==a.CostCenterID||d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()&&50002==a.CostCenterID||(a.ReadOnly=!(0,le.yG0)(t[0].IsEditable.toString()))),c.J0.IsEmpty(t[0].IsMandatory)||a instanceof K.O7&&(a.Mandatory=(0,le.yG0)(t[0].IsMandatory)),a instanceof K.O7&&(a.IsVisible=(0,le.yG0)(t[0].IsVisible.toString()))),a instanceof K.O7&&(a.EditOption=0),a instanceof K.O7&&(a.Expression=""),a instanceof K.O7&&(a.Message=""),a instanceof K.O7&&(a.Action=0))}UnPostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let t="";for(let i=0;i<this.dgvEmployees.Table.length;i++)(0,le.yG0)(this.dgvEmployees.Table[i].Select)&&(t+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(t.length>0&&l>0){t=t.substr(0,t.length-1);let o,i=t.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...";let r=d.d.common.GetDataSet3("PAY061",t,d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0];for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(o=r.filter(C=>C.EmpSeqNo==i[h]),null!=o&&o.length>0){let C=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let D=d.d.document.DeleteSelectedRows(g,C);this.strResult=D.Message,C=D.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.dgvEmployees.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.dgvEmployees.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(C=>(0,le.yG0)(C.Select)).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}PostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(let t=0;t<this.dgvEmployees.Table.length;t++)(0,le.yG0)(this.dgvEmployees.Table[t].Select)&&l++;if(l>0){a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Posting data, please wait...";for(let t=0;t<this.dgvEmployees.Table.length;t++)if((0,le.yG0)(this.dgvEmployees.Table[t].Select)){let i=this.oCMP.arrLstOthMPFields.find(o=>o.EmpSeqNo==this.dgvEmployees.Table[t].EmpSeqNo.toString());if(this.iEmpIndex=this.oCMP.arrLstOthMPFields.indexOf(i),this.iEmpIndex>=0){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let o=d.d.common.GetDataTable("PAY087",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+d.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+d.d.SessionManager.UserID+","+d.d.SessionManager.RoleID);null!=o&&o.length>0&&(!c.J0.IsEmpty(o[0].CanApprove)&&"TRUE"==o[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0?(this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[t].Result=this.strResult):(this.strResult="",this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a)}this.IsProcessed=!1}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(i=>(0,le.yG0)(i.Select)).length>0&&(this.DisplayMessage="Posted Successfully",d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}ValidatePosting(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=d.d.SessionManager.Preferences.PayrollProduct&&""!=d.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(d.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(let a=0;a<this.dgvEmployees.Columns.length;a++)if(this.dgvEmployees.Columns[a].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[a].ID.endsWith("_Key")&&this.dgvEmployees.Columns[a].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[a].DataType&&""==c.J0.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[a].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[a].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(d.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",a),!1}}SaveVoucher(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(d.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(d.d.SessionManager.LocationID>0?d.d.SessionManager.LocationID:1):l.push(0),d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(d.d.SessionManager.DivisionID>0?d.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(d.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(d.d.SessionManager.CompanyGUID),l.push(d.d.SessionManager.UserName),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),l.push(d.d.SessionManager.IsOffline);let t="",i="",o=d.d.document.SetTempInvDocumentPostPayroll(l);a=o.obj;let r=o;t=null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("ErrorMessage")?r.Tables[r.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a=o.obj,a>0?null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("VoucherNo")&&(i=r.Tables[r.Tables.length-1][0].VoucherNo.toString()):null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==r.Tables[r.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=t,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+a.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}GetDocumentXML(){let a,l="",t="",i="",o="",r="",h="",C=new Array,g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended.toString()+"'",i+='<Alpha Query="',i+=g;for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[e].endsWith("_Key")&&(r+=" "+this.dgvEmployees.TableColumns[e]+"='"+c.J0.EncodeXML(c.J0.StringValue(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]]))+"',");r+=" ",r.length>0&&(i+=","+r),i+='" ></Alpha>',r="",o+='<CostCenters Query="',r+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",r+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?r+=" dcCCNID68=1,":r+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",C.push("dcCCNID51"),C.push("dcCCNID53"),C.push("dcCCNID68");let D="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0]).length;e++)D=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0])[e].toString(),p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][D].toString(),D.Contains("CCNID")&&"CCNID51"!=D&&"CCNID53"!=D&&"CCNID68"!=D&&(r+=" dc"+D+"="+p+",",C.Contains("dc"+D)||C.push("dc"+D));for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcCCNID")&&(C.Contains(this.dgvEmployees.TableColumns[e])||this.dgvEmployees.TableColumns[e].endsWith("_Key")||(r+=" "+this.dgvEmployees.TableColumns[e]+"="+c.J0.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]+"_Key"].toString())+","));if(r.length>0&&(o+=r),o+='" ></CostCenters>',t+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+c.J0.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&!c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo)&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)!c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",t="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let r=0;r<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;r++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[r].InvDocDetailsID.toString();let o="";if(o+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?a.length>0?'<XML DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML DetailIds="'+a+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let r,h,C,g,D,e,p="0";if(l=t="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let T=0;null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"CreditAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"DebitAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString()));for(let P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;P++)if(!c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].IsVisible&&!c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt)){r=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanDocNo,C=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstNo,D=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.Replace(",","");let A=parseInt(C);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==r&&j.dcAlpha5==d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(d.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==d.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==r&&j.InstallmentNo==A),e.SortBy(["InstallmentNo"])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==r&&j.InstBalance>0&&j.InstallmentNo<A),e.SortBy(["InstallmentNo"])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let _=parseFloat(D),x=0,F=0;do{if(T++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==r&&j.InstallmentNo==A),h=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):_,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+T+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+r+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanBalAmt)-F)+"', dcAlpha3=N'"+D+"', dcAlpha4=N'"+c.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,_-=x,e[0].Flag=1,d.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==d.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(E=>E.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&E.DocNo==r&&0==E.Flag&&E.InstBalance>0).Compute("max","InstallmentNo");null!=j&&null!=j&&(A=parseInt(j))}else A++}while(_>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let D,r="",h="",C="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){C=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let T=0;T<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;T++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[T].InvDocDetailsID.toString()}D=p="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(D=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+C+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(T=>T.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,_,x,F,T=[],P=[];P.push("EMPNODE");for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)P.push(this.dsDailyAttendanceData.Tables[3][E].Data.toString());P.push("OT1"),P.push("OT2"),P.push("OT3"),P.push("OT4"),P.push("OT5"),P.push("DAYSATTENDED"),P.push("ABSENTDAYS"),P.push("Leaves"),P.push("TOTALOTAMOUNT");for(let E=0;E<e.length;E++)if(_=this.ApplyFilter(T,e[E]),null!=_&&_.length>0)for(let b=0;b<P.length;b++)P[b].startsWith("OT")&&(_[0][P[b]]=c.J0.SUMHoursAndMinutes(_[0][P[b]].toString(),e[E][P[b]].toString()));else{A={},A.EMPNODE=e[E].EMPNODE;for(let b=1;b<P.length;b++)A[P[b]]=e[E][P[b]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[E]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[E]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let b=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[E]),N=0;if(null!=b&&b.length>0){let te,Q;N=0;for(let W=0;W<b.length;W++)te=c.J0.ParseDate(b[W].FromDate),Q=c.J0.ParseDate(b[W].ToDate),te>=d.d.SessionManager.PayrollMonthStart?Q<=d.d.SessionManager.PayrollMonthEnd?N+=parseFloat(b[W].Leaves):te<=d.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(te,d.d.SessionManager.PayrollMonthEnd,parseInt(b[W].ComponentID))):Q<=d.d.SessionManager.PayrollMonthEnd?Q>=d.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,Q,parseInt(b[W].ComponentID))):N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,d.d.SessionManager.PayrollMonthEnd,parseInt(b[W].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}T.push(A)}let j="0";for(let E=0;E<T.length;E++){if(j="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>E&&(j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[E].InvDocDetailsID.toString()),r="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+E+'"  DocDetailsID="'+j+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+D+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+c.J0.Double(T[E].TOTALOTAMOUNT)+", dcCalcNum1="+c.J0.Double(T[E].TOTALOTAMOUNT)+", ",o+="dcNum5="+c.J0.Double(T[E].OT1)+", dcCalcNum5="+c.J0.Double(T[E].OT1)+", ",o+="dcNum7="+c.J0.Double(T[E].OT2)+", dcCalcNum7="+c.J0.Double(T[E].OT2)+", ",o+="dcNum9="+c.J0.Double(T[E].OT3)+", dcCalcNum9="+c.J0.Double(T[E].OT3)+", ",o+="dcNum11="+c.J0.Double(T[E].OT4)+", dcCalcNum11="+c.J0.Double(T[E].OT4)+", ",o+="dcNum13="+c.J0.Double(T[E].OT5)+", dcCalcNum13="+c.J0.Double(T[E].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+c.J0.Double(T[E].DAYSATTENDED)+"', dcAlpha3=N'"+c.J0.Double(T[E].ABSENTDAYS)+"', dcAlpha4=N'"+c.J0.Double(T[E].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',r+=" dcCCNID51="+c.J0.Int(T[E].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let b=0;b<this.dsDailyAttendanceData.Tables[3].length;b++)h=this.dsDailyAttendanceData.Tables[3][b].Data.toString(),r+=" "+h+"="+c.J0.Int(T[E][h])+","}r.length>0&&(o+=r),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(r.length>0){o+="<ArrearsXML>",o+="<Rows>";for(let C=0;C<r.length;C++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" ArrearsCalcMonths="'+c.J0.ParseDate(r[C]).ToString("dd/MMM/yyyy"),o+='" ArrCalcMonthPayDays="'+h[C].toString(),o+='" ArrearsCalcDays="',o+='" />';o+="</Rows>",o+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(r.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let C=0;C<r.length;C++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+c.J0.ParseDate(r[C]).ToString("dd/MMM/yyyy"),o+='" Days="'+h[C].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(d.d.SessionManager.Preferences.CreateLoanType)>0&&(l=t="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"CreditAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"DebitAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+d.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<r.length;C++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[C].toString()+"',1";for(let p=0;p<this.oCMP.arrLstCPFields[0][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.split(";"),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.split(";"),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=D+")",h+=g+")"}o+='<ArrearsDetailXML Query="'+h+'"></ArrearsDetailXML>'}}if(this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<r.length;C++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[C].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=D+")",h+=g+")"}o+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}GetRawExportHTML(){let a="",l="";a+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",l+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",l+=".null{background-color:#ECF9C;}",a+="<style>"+l.toString()+"</style>";let t=this.dgvEmployees.Table;a+="<table>",a+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",a+="<COLGROUP>";let i=null;for(let r=0;r<this.dgvEmployees.TableColumns.length;r++){var o=this.dgvEmployees.TableColumns[r];i=this.dgvEmployees.Columns.find(h=>h.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[r][o].toUpperCase()),null!=i&&i.IsVisible&&(a+="<COL>")}a+="</COLGROUP>",a+="<tr style=''>";for(let r=0;r<this.dgvEmployees.Table.length;r++)o=this.dgvEmployees.Table[r],i=this.dgvEmployees.Columns.find(C=>C.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[r][o].toUpperCase()),null!=i&&i.IsVisible&&(a+="<th class='hdr'>",a+=i.Header,a+="</th>");a+="</tr>";for(let r=0;r<t.length;r++){if(a+="<tr",r%2==1&&(a+=" class=alt"),a+=">",0==this.dgvEmployees.TableColumns.length)a+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(let h=0;h<this.dgvEmployees.TableColumns.length;h++)o=this.dgvEmployees.TableColumns[r],i=this.dgvEmployees.Columns.find(g=>g.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[h][o].toUpperCase()),null!=i&&i.IsVisible&&(null==t[r][h]?a+="<td class='null'>":(a+="<td>",a+=t[r][h].toString()),a+="</td>");a+="</tr>"}return a+="</table>",a+="</td></tr></table>",a+="</body><html>",a.toString()}ApplyFilter(a,l){let t=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();t=t.filter(r=>r[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return t}ReportView(){this.ReportDimension=new pt.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=d.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+d.d.SessionManager.UserID+" set @RoleID="+d.d.SessionManager.RoleID+"    \n                    SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                    FROM ADM_RevenUReports R  with(nolock)\n                    inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                    left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                    left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                    where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                    GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                    order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(t=>{let i=new ut.v;i.DBColumnID=parseInt(t.ReportID),i.Label=t.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=t.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=t.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==t.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=t.Width.toString()&&(i.Width=t.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=t.Height.toString()&&(i.Length=t.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=t.DocumentField.toString()&&(i.Formula=t.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=t.mapxml.toString()&&(i.ToolTipDescription=t.mapxml.toString()),a.Contains(parseInt(t.ReportID))||(a.push(parseInt(t.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,ie.A)(function*(){const{ReportViewModel:t}=yield Promise.resolve().then(J.bind(J,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(J.bind(J,73540));let h,o={strXML:""},r=new t;if(l.DisplayMessage=l.GetReportFilterXML(a,o),h=o.strXML,0==l.DisplayMessage.length){var C=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=C&&C.Dependantinuse)r.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!c.J0.IsEmpty(C.Width)&&c.J0.Double(C.Width)>0&&(r.RptWidth=c.J0.Double(C.Width)),!c.J0.IsEmpty(C.length)&&c.J0.Double(C.length)>0&&(r.RptHeight=c.J0.Double(C.length)),r.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.ShowDialog(r,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new t;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let t="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let r,o=!1;i.forEach(h=>{(0,le.yG0)(h.GroupLevel)&&(o=!0)}),t+="<XML",o&&(t+=' GroupLevel="1"'),t+=" >";for(let h=0;h<i.length;h++){if(r=i[h].ReportField.toString(),t+="<Row ",t+='ColID ="'+r+'" ',!c.J0.IsEmpty(i[h].SysColumnName))if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let C="";for(let g=0;g<this.dgvEmployees.Table.length;g++)(0,le.yG0)(this.dgvEmployees.Table[g].Select)&&(C+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",");if(c.J0.IsEmpty(C)||!(C.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";C=C.substr(0,C.length-1),t+='Value ="'+C+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(t+='Value ="'+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');t+=" />"}return t+="</XML>",l.strXML=t.toString(),""}}function $t(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",19),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function Qt(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",20),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function zt(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",21),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let Zt=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-post-payroll"]],decls:100,vars:27,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"masterscreen",2,"height","120px"],[1,"row",2,"height","30px"],[1,"col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row","margin-bottom","9px"],[1,"input_cntrl_label",2,"font-size","13px"],[1,"input_cntrl_label",2,"font-weight","bold","font-size","12px !important"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],["FieldDirective","",3,"obj"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-chart-line"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n        "),s.j41(7,"div",3),s.EFF(8,"\n          "),s.DNE(9,$t,4,3,"span",4),s.EFF(10,"\n          "),s.j41(11,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(12,"i",6),s.EFF(13),s.nI1(14,"translate"),s.k0s(),s.EFF(15,"\n          "),s.DNE(16,Qt,4,3,"span",4),s.EFF(17,"\n          "),s.j41(18,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",7),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n          "),s.DNE(23,zt,4,3,"span",4),s.EFF(24,"           \n        "),s.k0s(),s.EFF(25,"\n      "),s.k0s(),s.EFF(26,"\n      "),s.j41(27,"div",8),s.EFF(28," \n        "),s.j41(29,"div",9),s.EFF(30,"\n          "),s.j41(31,"div",10),s.EFF(32," \n            "),s.j41(33,"div",11),s.EFF(34,"\n                  "),s.j41(35,"label",12),s.EFF(36),s.nI1(37,"translate"),s.k0s(),s.EFF(38,"\n                  "),s.j41(39,"label",13),s.EFF(40),s.k0s(),s.EFF(41,"\n              "),s.k0s(),s.EFF(42,"\n            "),s.k0s(),s.EFF(43,"\n          "),s.j41(44,"div",10),s.EFF(45,"\n                "),s.j41(46,"div",14),s.EFF(47,"\n                "),s.j41(48,"label",12),s.EFF(49),s.nI1(50,"translate"),s.k0s(),s.EFF(51,"\n                "),s.j41(52,"label",13),s.EFF(53),s.k0s(),s.EFF(54,"\n              "),s.k0s(),s.EFF(55,"\n              "),s.j41(56,"div",14),s.EFF(57,"\n                "),s.j41(58,"label",12),s.EFF(59),s.nI1(60,"translate"),s.k0s(),s.EFF(61,"\n                "),s.j41(62,"label",13),s.EFF(63),s.k0s(),s.EFF(64,"              \n            "),s.k0s(),s.EFF(65,"\n          "),s.k0s(),s.EFF(66,"\n          "),s.j41(67,"div",10),s.EFF(68,"\n            "),s.j41(69,"div",15),s.EFF(70,"\n              "),s.eu8(71,16),s.EFF(72,"\n          "),s.k0s(),s.EFF(73,"\n  \n          "),s.j41(74,"div",15),s.EFF(75,"\n            "),s.eu8(76,16),s.EFF(77,"\n        "),s.k0s(),s.EFF(78,"                  \n           "),s.k0s(),s.EFF(79,"\n           "),s.j41(80,"div",10),s.EFF(81,"\n        "),s.j41(82,"div",15),s.EFF(83,"\n          "),s.eu8(84,16),s.EFF(85,"\n      "),s.k0s(),s.EFF(86,"\n      "),s.j41(87,"div",15),s.EFF(88,"\n        "),s.eu8(89,16),s.EFF(90,"\n    "),s.k0s(),s.EFF(91,"\n          "),s.k0s(),s.EFF(92,"\n        "),s.k0s(),s.EFF(93,"\n        "),s.j41(94,"div",17),s.EFF(95,"\n          "),s.nrm(96,"app-PactGridView",18),s.EFF(97,"  \n        "),s.k0s(),s.EFF(98,"\n      "),s.k0s(),s.EFF(99,"\n "),s.k0s()),2&t&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(14,17,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(21,19,"Filter")),s.R7$(3),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(13),s.SpI("",s.bMT(37,21,"Payroll_PayMonth"),"        :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonth),s.R7$(9),s.SpI("",s.bMT(50,23,"Payroll_StartDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthStart),s.R7$(6),s.SpI("",s.bMT(60,25,"Payroll_EndDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthEnd),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(5),s.Y8G("obj",i.obj.IsProcessWithAdjustments),s.R7$(7),s.Y8G("obj",i.obj.EmployeesList))},dependencies:[fe.bT,Ye._,Qe.X,Xe.D9],encapsulation:2})}return G})();var St=J(81669),ea=J(73631);const ta=G=>({width:G});let vt=(()=>{class G extends ea.P{constructor(){super()}ngOnInit(){c.J0.IsEmpty(this.obj.ProgressMessage)||(this.ProgressMessage=this.obj.ProgressMessage),this.obj.progress||(this.obj.progress=0),0===this.obj.total?this.obj.total=this.obj.progress:this.obj.total||(this.obj.total=100),this.obj.progress>this.obj.total&&(this.obj.progress=100,this.obj.total=100),this.obj.progress=this.obj.progress/this.obj.total*100,this.color=this.obj.progress<55?"red":this.obj.progress<75?"yellow":"green",setTimeout(()=>{d.d.page.HideDialog(this.obj.PopUpGUID)},2e3)}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-progress-bar"]],inputs:{progress:"progress",total:"total"},features:[s.Vt3],decls:7,vars:7,consts:[[1,"progress-bar-container"],[3,"ngStyle"]],template:function(t,i){1&t&&(s.EFF(0,"\n  "),s.j41(1,"div",0),s.EFF(2,"\n     "),s.j41(3,"div",1),s.EFF(4),s.k0s(),s.EFF(5,"\n  "),s.k0s(),s.EFF(6,"\n  ")),2&t&&(s.R7$(3),s.ZvI("progress-bar ",i.color,""),s.Y8G("ngStyle",s.eq3(5,ta,i.progress+"%")),s.R7$(),s.SpI("\n      ",i.ProgressMessage,"\n     "))},dependencies:[fe.B3],encapsulation:2})}return G})();class Lt extends tt.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.ButtonClick=new St.Yk,this.ProgressVisibility=!1,this.chkPostBasedOnDailyAttendance=new Be.c,this.chkPostBasedOnAttDimWise=new Be.c,this.chkIncludeOTHours=new Be.c,this.IsProcessWithAdjustments=new Be.c,this.EmployeesList=new He.vv,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.dsDailyAttendanceData=null,this.sPayrollMonthMouseDoubleClickCommand=new St.Yk,this.btnCancelFlag=!1,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new ut.v,this.sCrAccount="0",this.sDrAccount="0",this.SelectUnCheck=0,this.sFilter="",this.IsPosting=!1,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),this.ClassName="PostPayrollViewModel",this.CostCenterID=40054,this.DisplayName=d.d.GetResource(a),this.Title=d.d.GetResource(a),this.DisplayMessage="",this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.ButtonClick.Subscribe(this,"Button_Click"),this.sPayrollMonthMouseDoubleClickCommand.Subscribe(this,"sPayrollMonth_MouseDoubleClick"),this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.btnCancelFlag=!1,this.chkPostBasedOnDailyAttendance.Label=d.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=d.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=d.d.GetResource("PostbasedonAttendanceDimensionwise"),this.IsProcessWithAdjustments.Label=d.d.GetResource("IsProcessWithAdjustments"),this.LoadGrid(),this.btnFilter_Click(),d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView(),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(l){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+l.stack)}}sPayrollMonth_MouseDoubleClick(a){var l=this;return(0,ie.A)(function*(){const{SetPayrollDateViewModel:t}=yield Promise.resolve().then(J.bind(J,15091)),{SetPayrollDateComponent:i}=yield Promise.resolve().then(J.bind(J,72974));let o=new t;d.d.page.ShowDialog(o,i,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")}),o.DialogResult&&l.btnClear_Click()})()}LoadGrid(){let t,l=(new Ft.ControlGenerator).GetScreenInfo(this.CostCenterID);t=l.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=t&&t.length>0&&!c.J0.IsEmpty(t[0].UserDefaultValue)&&(this.sCrAccount=t[0].UserDefaultValue.toString()),t=l.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=t&&t.length>0&&null!=t[0].UserDefaultValue&&""!=t[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=t[0].UserDefaultValue.toString()),this.EmployeesList=new He.vv,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("GradeID"),this.EmployeesList.TableColumns.push("Result");let i=new K.O7;this.EmployeesList.Columns=[],i=new K.O7,i.Header=d.d.GetResource("Pay_Select"),i.DisplayMember="Select",i.DataType="CheckBox",i.Width=50,i.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(i),i=new K.O7,i.Header=d.d.GetResource("Payroll_EmpSNo"),i.DisplayMember="SNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new K.O7,i.Header=d.d.GetResource("EmployeeCode"),i.DisplayMember="EmpCode",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new K.O7,i.Header=d.d.GetResource("EmployeeName"),i.DisplayMember="EmpName",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new K.O7,i.Header=d.d.GetResource("Result"),i.DisplayMember="Result",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.EmployeesList.Table.length;l++)0==this.SelectUnCheck&&(this.EmployeesList.Table[l].Select=a);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}Button_Click(a){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,d.d.page.ShowDialog(this,Nt.L,{Title:"Reports"})),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}btnUnPost_Click(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}btnFilter_Click(){Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),d.d.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(d.d.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new lt.t("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new lt.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&d.d.page.ShowDialog(this.objEmpFilter,ct.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted)if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let D=0;D<this.objEmpFilter.CostCenterFilters.length;D++){let p=this.objEmpFilter.CostCenterFilters[D];if(p.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==p.CostCenterID?"EmpSeqNo":"CCNID"+(p.CostCenterID-5e4)),p.SelectedNodes.length>0){if(1==p.SelectedNodes.length)o+=" AND ",o+=i+"="+p.SelectedNodes[0].Id;else if(!p.SelectedNodes.find(e=>e.Id==l&&e.IsGroup))if(o+=" AND ",mt.IPrefetchFilter.IsGroupTree(p)){let e="";for(let T=0;T<p.SelectedNodes.length;T++)(null==p.SelectedNodes[T].Parent||!p.SelectedNodes[T].Parent.IsSelected)&&(e.length>0&&(e+=","),e+=p.SelectedNodes[T].Id);0==e.length&&(e+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+qe.A.GetTagTableName(p.CostCenterID)+" T with(nolock),"+qe.A.GetTagTableName(p.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=e.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let e=0;e<p.SelectedNodes.length;e++)e>0&&(o+=","),o+=p.SelectedNodes[e].Id;o+=")"}}else p.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let r=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=r.Trim()&&"None"!=r&&(this.sFilter+="TreeView"==r?" ORDER BY EMP.lft ":" ORDER BY EMP."+r);let h=[];h.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),h.push(this.sFilter),h.push(0),h.push(d.d.SessionManager.RoleID),h.push(d.d.SessionManager.UserID),h.push(d.d.SessionManager.LanguageID);let g,C=d.d.empService.GetData(h,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=C&&C.Tables.length>0&&C.Tables[0].length>0){if(g=C.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let D=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayroll"==p.Name&&p.GradeID==C.Tables[0][0].CCNID53);if(null!=D&&D.length>0&&null!=D[0].Value&&null!=D[0].Value&&""!=D[0].Value.toString()&&"True"==D[0].Value.toString()&&(D=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayrollDays"==p.Name&&p.GradeID==C.Tables[0][0].CCNID53),null!=D&&D.length>0&&null!=D[0].Value&&null!=D[0].Value&&""!=D[0].Value.toString())){let p=0;if(p=parseInt(D[0].Value),p>0){let e=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),p),T=C.Tables[0].filter(P=>P.DOJ<=e);null!=T&&T.length>0&&(C=[],C=T)}}C.Tables[0].DefaultView.Sort="CCNID53",g=C.Tables[0].DefaultView.ToTable()}for(let D=0;D<g.length;D++){let p=this.EmployeesList.NewRow();p.EmpSeqNo=g[D].EmpSeqNo,p.EmpCode=g[D].EmpCode,p.EmpName=g[D].EmpName,p.GradeID=g[D].CCNID53,p.SNo=(D+1).toString(),p.Select=!1,this.EmployeesList.addRow(p)}}}else this.objEmpFilter.Filter>0&&this.FilterEmployees()}),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}FilterEmployees(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let a=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=a.Trim()&&"None"!=a&&(this.sFilter+="TreeView"==a?" ORDER BY EMP.lft ":" ORDER BY EMP."+a);let l=[];l.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID);let i,t=d.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){if(i=t.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let o=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(r=>"DontConsiderEmpsForPayroll"==r.Name&&r.GradeID==t.Tables[0][0].CCNID53);if(null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString()&&"True"==o[0].Value.toString()&&(o=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(r=>"DontConsiderEmpsForPayrollDays"==r.Name&&r.GradeID==t.Tables[0][0].CCNID53),null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString())){let r=0;if(r=parseInt(o[0].Value),r>0){let h=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),r),C=t.Tables[0].filter(g=>new Date(g.DOJ)<=h);null!=C&&C.length>0&&(t=[],t=C)}}t.sort((r,h)=>h.CCNID53-r.CCNID53),i=t}for(let o=0;o<i.length;o++){let r=this.EmployeesList.NewRow();r.EmpSeqNo=i[o].EmpSeqNo,r.EmpCode=i[o].EmpCode,r.EmpName=i[o].EmpName,r.GradeID=i[o].CCNID53,r.SNo=(o+1).toString(),r.Select=!1,this.EmployeesList.addRow(r)}}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+a.stack)}}bgworker_DoWork(a,l){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}UnPostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let t="";for(let i=0;i<this.EmployeesList.Table.length;i++)(0,le.yG0)(this.EmployeesList.Table[i].Select)&&(t+=this.EmployeesList.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(t.length>0&&l>0){t=t.substr(0,t.length-1);let o,i=t.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...",d.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},vt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});let r=d.d.report.GetDataTable("PPVM01",t,d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"));for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(o=r.filter(C=>C.EmpSeqNo==i[h]),null!=o&&o.length>0){let C=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let D=d.d.document.DeleteSelectedRows(g,C);this.strResult=D.Message,C=D.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.EmployeesList.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.EmployeesList.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(C=>1==C.Select).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}PostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let r,t="",i="",o=new Array,h=!1,C=0;for(let g=0;g<this.EmployeesList.Table.length;g++)if((0,le.yG0)(this.EmployeesList.Table[g].Select)&&(t+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,C=0,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let D=0;D<o.length;D++)if(o[D].GradeID==parseInt(this.EmployeesList.Table[g].GradeID)){C=D,h=!0;break}h?(i=o[C].sEmpIds,i+=","+this.EmployeesList.Table[g].EmpSeqNo.toString(),o[C].sEmpIds=i,o[C].lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo))):(r=new Ct.ii,r.GradeID=parseInt(this.EmployeesList.Table[g].GradeID),r.sEmpIds=this.EmployeesList.Table[g].EmpSeqNo.toString(),r.lstGradeEmps=new Array,r.lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo)),o.push(r))}if(t.length>0&&l>0){if(t=t.substr(0,t.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",d.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},vt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString())if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++){c.J0.SetPayrollMonth(d.d.SessionManager.PayrollMonth,d.d.SessionManager,o[g].GradeID);let p=[];p.push(t),p.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),p.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),p.push(this.chkIncludeOTHours.IsChecked?1:0),p.push(c.J0.IntTryParse(d.d.SessionManager.UserID)),p.push(d.d.SessionManager.LanguageID);let e=d.d.empService.GetData(p,"spPAY_PostDailyAttendancetoPayroll");o[g].dsDailyAttendanceDataCollection=e}else{let g=[];g.push(t),g.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(c.J0.IntTryParse(d.d.SessionManager.UserID)),g.push(d.d.SessionManager.LanguageID),this.dsDailyAttendanceData=d.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new $e.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=t,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=d.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++)o[g].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=o[g].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=o[g].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=o[g].GradePayrollMonthEnd,this.dsDailyAttendanceData=o[g].dsDailyAttendanceDataCollection);if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let g=d.d.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+d.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+d.d.SessionManager.UserID+","+d.d.SessionManager.RoleID);null!=g&&g.length>0&&(!c.J0.IsEmpty(g[0].CanApprove)&&"TRUE"==g[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.IsProcessWithAdjustments.IsChecked&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(D=>1==D.Select).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,C,l=[],t=d.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=d.d.SessionManager.PayrollMonth.AddMonths(-1),r=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=r;){if(C=t.filter(D=>D.PayrollMonth&&c.J0.ParseDate(D.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=C&&C.length>0){if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let D,p,e,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e};if(c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=c.J0.GetEmployeeGrade(a.toString(),D,p,e),_>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e},c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T,_),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd)}let P=[];P.push(a),P.push(D.ToString("dd/MMM/yyyy")),P.push(p.ToString("dd/MMM/yyyy")),P.push(e.ToString("dd/MMM/yyyy")),P.push(0),P.push(d.d.SessionManager.UserID),P.push(d.d.SessionManager.RoleID),P.push(d.d.SessionManager.LanguageID);let A=d.d.empService.ExecuteQuery_SP(P,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(e.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(d.d.SessionManager.RoleID),_.push(d.d.SessionManager.UserID),_.push(d.d.SessionManager.LanguageID);let x=d.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),j=(new Ct.mr).AggregateLeaves(a.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);j>0&&(h.Days=-j)}l.push(h)}if(null!=g&&g.length>0&&d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let D=0;D<g.length;D++)g[D].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy"),h.Days=g[D].dDays,l.push(h))}else if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let D,p,e,T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e};c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd;let P=d.d.SessionManager.PayrollMonth,A=0;d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=c.J0.GetEmployeeGrade(a.toString(),D,p,e),A>0&&(T={PayrollMonth:D,PayrollMonthStart:p,PayrollMonthEnd:e},c.J0.SetPayrollDate_1(c.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),T,A),D=T.PayrollMonth,p=T.PayrollMonthStart,e=T.PayrollMonthEnd)),c.J0.SetPayrollMonth(D);let _=new $e.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=d.d.SessionManager.PayrollMonth,_.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),c.J0.SetPayrollMonth(P),l.push(h)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let D=0;D<l.length;D++)null!=l[D].Days&&null!=l[D].Days&&""!=l[D].Days.toString().Trim()&&(h={},h.PayrollMonth=d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[D].PayrollMonth.toString(),h.Days=l[D].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let D=0;D<this.dtAdjData.length;D++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[D].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[D].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=d.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),c.J0.SetPayrollMonth(a,d.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let t,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let r=d.d.empService.GetQueryData(a,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=d.d.empService.GetQueryData(0,"MPL014","","",""),C=d.d.empService.GetQueryData(a,"MPL005","","",""),g=d.d.empService.GetQueryData(a,"MPL011",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),D="";for(let e=0;e<this.dtAdjData.length;e++){let T=new Date(this.dtAdjData[e].AdjMonth),P=T;t=r.filter(j=>new Date(j.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==j.VoucherType);let A=null;if(null!=t&&t.length>0){let j=h.filter(E=>E.GradeID==t[0].dcCCNID53&&E.CPayrollDate<=P.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(E=>E.GradeID==t[0].dcCCNID53&&E.CPayrollDate==c.J0.String(j))}if(D="'"+T.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+T.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=C.filter(j=>T.ToString("dd/MMM/yyyy")>=j.ApplyFrom&&T.ToString("dd/MMM/yyyy")<=j.EffectFrom),p=p.sort((j,E)=>j.EffectFrom-E.EffectFrom),i=g.Tables[0].filter(j=>j.ArrearsCalcMonths==c.J0.ParseDate(T)),o=g.Tables[1].filter(j=>1==j.DType&&j.ArrAdjMonth==c.J0.ParseDate(T)),null!=p&&p.length>0){let j=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let E=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(E.length>0)for(let b=0;b<E.length;b++)c.J0.ParseDate(E[b]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(j=!0)}null!=i&&i.length>0||j?(T=c.J0.ParseDate(p[0].EffectFrom),d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T)):d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T)}else d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?c.J0.SetPayrollMonth(T,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):c.J0.SetPayrollMonth(T);let _=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=d.d.SessionManager.Preferences.PayDays?parseInt(d.d.SessionManager.Preferences.PayDays):T.DaysInMonth();let F=new $e.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=d.d.SessionManager.PayrollMonth,F.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=t&&t.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=c.J0.Int(t[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let j=0;null!=t&&t.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(t[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(t[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(t[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(t[0].Holidays),j=parseFloat(t[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",j)):c.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&c.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let W,E=0,b=-1,N=0,te=0,Q=0;t=r.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&11==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;w++)if(c.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].CalculateAdjustments)for(let ne=0;ne<F.arrLstCPFields[0][0].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo==F.arrLstCPFields[0][0][ne].SNo){if(N=0,te=0,Q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].SNo,!c.J0.IsEmpty(t)&&t.length>0&&!c.J0.IsEmpty(t[0]["dcCalcNum"+b])&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].ArrData.split(";"),null!=W&&W.length>0))for(let ce=0;ce<W.length;ce+=2)new Date(W[ce]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(te=parseFloat(W[ce+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+b]&&null!=o[0]["Earning"+b]&&""!=o[0]["Earning"+b]&&(Q=parseFloat(o[0]["Earning"+b])),E=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,le.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][ne].ComponentName?parseFloat(F.arrLstCPFields[0][0][ne].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][ne].dEarned)-N-te-Q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData=c.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AdjData+=P.ToString("dd MMM yyyy")+","+E+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].dAdjusted)+E).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=E);break}t=r.filter(w=>new Date(w.PayrollMonth).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&12==w.VoucherType);for(let w=0;w<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;w++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].CalculateAdjustments)for(let ne=0;ne<F.arrLstCPFields[0][2].length;ne++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo==F.arrLstCPFields[0][2][ne].SNo){if(N=0,te=0,Q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].SNo,null!=t&&t.length>0&&null!=t[0]["dcCalcNum"+b]&&null!=t[0]["dcCalcNum"+b]&&""!=t[0]["dcCalcNum"+b].toString()&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].ArrData.split(";"),null!=W&&W.length>0))for(let ce=0;ce<W.length;ce+=2)new Date(W[ce]).ToString("dd MMM yyyy")==P.ToString("dd MMM yyyy")&&(te=parseFloat(W[ce+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+b]&&null!=o[0]["Deduction"+b]&&""!=o[0]["Deduction"+b]&&(Q=parseFloat(o[0]["Deduction"+b])),E=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,le.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][ne].ComponentName?parseFloat(F.arrLstCPFields[0][2][ne].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][ne].dEarned)-N-te-Q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData=c.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AdjData+=P.ToString("dd MMM yyyy")+","+E+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].dAdjusted)+E).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][w].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=E);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet()}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(t=>t.EmpSeqNo==a),l.length>0&&c.J0.ParseDate(l[0].cEffectFrom).getFullYear()==d.d.SessionManager.PayrollMonth.getFullYear()&&c.J0.ParseDate(l[0].cEffectFrom).iMonth()==d.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",i=0,o=0,r=0,h=0,C=0,g=0,D=0,p=0,e=0,T=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let P=d.d.empService.GetQueryData(a,"PostCalculateAccural",JSON.stringify(t),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=d.d.report.GetDataTable("PPVM02","");if(null!=P&&P.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,r=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<P.length;F++)C=parseFloat(P[F].TotalDays),h=parseFloat(P[F].DaysAttended)+parseFloat(P[F].PaidLeaves)+parseFloat(P[F].LOPDays),g=parseFloat(P[F]["dcCalcNum"+T]),D=parseFloat(P[F]["dcCalcNumFC"+T]),p=parseFloat((h/C*i).ToString(d.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(d.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(d.d.SessionManager.sPayrollDecimals)),r+=D;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-r).ToString(d.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<P.length;x++){let F=A.filter(E=>E.GradeID==parseInt(P[x].GradeID)&&E.CPayrollDate==c.J0.ParseDate(P[x].PayrollDate)).Compute("max","MaxSchemeID"),j=new $e.O;if(j.oParent=this,j.sSelectedEmpSeqNos=a.toString(),j.PayrollMonth=d.d.SessionManager.PayrollMonth,j.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,j.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,j.drcArrStructure=F,j.IsCalculateAccruals=!0,j.ArrGradeID=parseInt(P[x].GradeID),j.ProcessPayroll(),j.IsCompleted){j.arrLstOthMPFields[0].TotalDays=parseFloat(P[x].TotalDays),j.arrLstOthMPFields[0].MonthDays=parseFloat(P[x].TotalDays),j.arrLstOthMPFields[0].PaidLeaves=parseFloat(P[x].PaidLeaves),j.arrLstOthMPFields[0].TotalLeaves=parseFloat(P[x].LeavesTaken),j.arrLstOthMPFields[0].WeeklyOffs=parseFloat(P[x].WOffs),j.arrLstOthMPFields[0].Holidays=parseFloat(P[x].Holidays),h=parseFloat(P[x].TotalDays.toString())-parseFloat(P[x].LOPDays.toString())-parseFloat(P[x].LeavesTaken.toString())-parseFloat(P[x].UnpaidDays.toString()),j.SetDaysAttended(0,"Days Attended",h);let E=0,b=-1,N=0,te=0;for(let Q=0;Q<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;Q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].Behaviour)for(let W=0;W<j.arrLstCPFields[0][0].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].SNo==j.arrLstCPFields[0][0][W].SNo){N=0,te=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].SNo,null!=P[x]["dcCalcNum"+b]&&null!=P[x]["dcCalcNum"+b]&&""!=P[x]["dcCalcNum"+b].toString()&&(N=parseFloat(P[x]["dcCalcNum"+b])),null!=P[x]["dcCalcNumFC"+b]&&null!=P[x]["dcCalcNumFC"+b]&&""!=P[x]["dcCalcNumFC"+b].toString()&&(te=parseFloat(P[x]["dcCalcNumFC"+b])),E=parseFloat(j.arrLstCPFields[0][0][W].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].dPrevAccEar+=parseFloat(E.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][Q].dPrevAccAdj+=te;break}for(let Q=0;Q<this.oCMP.arrLstCPFields[2].length;Q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].Behaviour)for(let W=0;W<j.arrLstCPFields[0][2].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].SNo==j.arrLstCPFields[0][2][W].SNo){N=0,te=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].SNo,null!=P[x]["dcCalcNum"+b]&&null!=P[x]["dcCalcNum"+b]&&""!=P[x]["dcCalcNum"+b].toString()&&(N=parseFloat(P[x]["dcCalcNum"+b])),null!=P[x]["dcCalcNumFC"+b]&&null!=P[x]["dcCalcNumFC"+b]&&""!=P[x]["dcCalcNumFC"+b].toString()&&(te=parseFloat(P[x]["dcCalcNumFC"+b])),E=parseFloat(j.arrLstCPFields[0][2][W].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].dPrevAccEar+=parseFloat(E.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][Q].dPrevAccAdj+=te;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals))}}}}ValidatePosting(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=d.d.SessionManager.Preferences.PayrollProduct&&""!=d.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(d.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(d.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+a.stack),!1}}SaveVoucher(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(d.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(d.d.SessionManager.LocationID>0?d.d.SessionManager.LocationID:1):l.push(0),d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(d.d.SessionManager.DivisionID>0?d.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(d.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(d.d.SessionManager.CompanyGUID),l.push(d.d.SessionManager.UserName),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),l.push(d.d.SessionManager.IsOffline);let t="",i="",o=d.d.document.SetTempInvDocumentPostPayroll(l);a=o.obj;let r=o;t=null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("ErrorMessage"))?r.Tables[r.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a>0?null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("VoucherNo"))&&(i=r.Tables[r.Tables.length-1][0].VoucherNo.toString()):null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("ServerMessage"))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==r.Tables[r.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=t,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",a)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}GetDocumentXML(){let a,l="",t="",i="",o="",r="",h="",C=[],g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?g+=",dcAlpha15='"+c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended+"'",i+='<Alpha Query="',i+=g,r+=" ",r.length>0&&(i+=","+r),i+='" ></Alpha>',r="",o+='<CostCenters Query="',r+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",r+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?r+=" dcCCNID68=1,":r+=" dcCCNID68="+c.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",C.push("dcCCNID51"),C.push("dcCCNID53"),C.push("dcCCNID68");let D="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;e++)D=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[e],p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][D],D.Contains("CCNID")&&"CCNID51"!=D&&"CCNID53"!=D&&"CCNID68"!=D&&(r+=" dc"+D+"="+p+",",C.Contains("dc"+D)||C.push("dc"+D));if(r.length>0&&(o+=r),o+='" ></CostCenters>',t+='" ProductID="'+this.DefProdID+'" Quantity="0',t+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',t+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',t+='" StockValue="0" StockValueFC="0" RefNO="',t+='" BillDate="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),t+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',t+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,t+='" CommonNarration="'+c.J0.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Leave',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",t="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let r=0;r<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;r++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[r].InvDocDetailsID.toString();let o="";if(o+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?a.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" >':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" >',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let r,h,C,g,D,e,p="0";if(l=t="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let T=0;null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"CreditAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(P=>40057==P.CostCenterID&&"DebitAccount"==P.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString()));for(let P=0;P<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;P++)if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].IsVisible&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.toString()){r=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanDocNo,C=this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstNo,D=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanInstAmt.Replace(",","");let A=parseInt(C);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==r&&c.J0.ParseDate(j.dcAlpha5)==d.d.SessionManager.PayrollMonth),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(d.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==d.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.RefNo==r&&j.InstallmentNo==A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==r&&j.InstBalance>0&&j.InstallmentNo<A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let _=parseFloat(D),x=0,F=0;do{if(T++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(j=>j.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&j.DocNo==r&&j.InstallmentNo==A),e.length>0)if(h=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):_,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+T+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="'+r+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanBalAmt)-F)+"', dcAlpha3=N'"+D+"', dcAlpha4=N'"+c.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][P].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,_-=x,e[0].Flag=1,d.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==d.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(E=>E.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&E.DocNo==r&&0==E.Flag&&E.InstBalance>0).Compute("max","InstallmentNo");null!=j&&null!=j&&(A=parseInt(j))}else A++;else _=0}while(_>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let D,r="",h="",C="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){C=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let T=0;T<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;T++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[T].InvDocDetailsID.toString()}D=p="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(D=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(T=>40079==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+C+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(T=>T.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,_,x,F,T=[],P=[];P.push("EMPNODE");for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)P.push(this.dsDailyAttendanceData.Tables[3][E].Data.toString());P.push("OT1"),P.push("OT2"),P.push("OT3"),P.push("OT4"),P.push("OT5"),P.push("DAYSATTENDED"),P.push("ABSENTDAYS"),P.push("Leaves"),P.push("TOTALOTAMOUNT");for(let E=0;E<e.length;E++)if(_=this.ApplyFilter(T,e[E]),null!=_&&_.length>0)for(let b=0;b<P.length;b++)P[b].startsWith("OT")&&(_[0][P[b]]=c.J0.SUMHoursAndMinutes(_[0][P[b]].toString(),e[E][P[b]].toString()));else{A={},A.EMPNODE=e[E].EMPNODE;for(let b=1;b<P.length;b++)A[P[b]]=e[E][P[b]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[E]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[E]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let b=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[E]),N=0;if(null!=b&&b.length>0){let te,Q;N=0;for(let W=0;W<b.length;W++)te=c.J0.ParseDate(b[W].FromDate),Q=c.J0.ParseDate(b[W].ToDate),te>=d.d.SessionManager.PayrollMonthStart?Q<=d.d.SessionManager.PayrollMonthEnd?N+=parseFloat(b[W].Leaves):te<=d.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(te,d.d.SessionManager.PayrollMonthEnd,parseInt(b[W].ComponentID))):Q<=d.d.SessionManager.PayrollMonthEnd?Q>=d.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,Q,parseInt(b[W].ComponentID))):N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,d.d.SessionManager.PayrollMonthEnd,parseInt(b[W].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}T.push(A)}let j="0";for(let E=0;E<T.length;E++){if(j="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>E&&(j=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[E].InvDocDetailsID.toString()),r="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+E+'"  DocDetailsID="'+j+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+D+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+c.J0.Double(T[E].TOTALOTAMOUNT)+", dcCalcNum1="+c.J0.Double(T[E].TOTALOTAMOUNT)+", ",o+="dcNum5="+c.J0.Double(T[E].OT1)+", dcCalcNum5="+c.J0.Double(T[E].OT1)+", ",o+="dcNum7="+c.J0.Double(T[E].OT2)+", dcCalcNum7="+c.J0.Double(T[E].OT2)+", ",o+="dcNum9="+c.J0.Double(T[E].OT3)+", dcCalcNum9="+c.J0.Double(T[E].OT3)+", ",o+="dcNum11="+c.J0.Double(T[E].OT4)+", dcCalcNum11="+c.J0.Double(T[E].OT4)+", ",o+="dcNum13="+c.J0.Double(T[E].OT5)+", dcCalcNum13="+c.J0.Double(T[E].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+c.J0.Double(T[E].DAYSATTENDED)+"', dcAlpha3=N'"+c.J0.Double(T[E].ABSENTDAYS)+"', dcAlpha4=N'"+c.J0.Double(T[E].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',r+=" dcCCNID51="+c.J0.Int(T[E].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let b=0;b<this.dsDailyAttendanceData.Tables[3].length;b++)h=this.dsDailyAttendanceData.Tables[3][b].Data.toString(),r+=" "+h+"="+c.J0.Int(T[E][h])+","}r.length>0&&(o+=r),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(r.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let C=0;C<r.length;C++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+c.J0.ParseDate(r[C]).ToString("dd/MMM/yyyy"),o+='" Days="'+h[C].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),l=t="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(d.d.SessionManager.Preferences.CreateLoanType)>0&&(null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"CreditAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"DebitAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+d.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<r.length;C++){let g="",D="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[C].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let T=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),T=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=T&&T.length>0)for(let P=0;P<T.length;P+=2)c.J0.ParseDate(T[P]).ToString("dd MMM yyyy")==c.J0.ParseDate(r[C]).ToString("dd MMM yyyy")&&(e=T[P+1])}D+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=D+")",h+=g+")"}o+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}ApplyFilter(a,l){let t=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();t=t.filter(r=>r[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return t}ReportView(){this.ReportDimension=new pt.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=d.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+d.d.SessionManager.UserID+" set @RoleID="+d.d.SessionManager.RoleID+"    \n                     SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                     FROM ADM_RevenUReports R  with(nolock)\n                     inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                     left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                     left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                     where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                     GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                     order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(t=>{let i=new ut.v;i.DBColumnID=parseInt(t.ReportID),i.Label=t.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=t.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=t.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==t.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=t.Width.toString()&&(i.Width=t.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=t.Height.toString()&&(i.Length=t.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=t.DocumentField.toString()&&(i.Formula=t.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=t.mapxml.toString()&&(i.ToolTipDescription=t.mapxml.toString()),a.Contains(parseInt(t.ReportID))||(a.push(parseInt(t.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,ie.A)(function*(){const{ReportViewModel:t}=yield Promise.resolve().then(J.bind(J,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(J.bind(J,73540));let h,o={strXML:""},r=new t;if(l.DisplayMessage=l.GetReportFilterXML(a,o),h=o.strXML,0==l.DisplayMessage.length){var C=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=C&&C.Dependantinuse)r.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!c.J0.IsEmpty(C.Width)&&c.J0.Double(C.Width)>0&&(r.RptWidth=c.J0.Double(C.Width)),!c.J0.IsEmpty(C.length)&&c.J0.Double(C.length)>0&&(r.RptHeight=c.J0.Double(C.length)),r.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.ShowDialog(r,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new t;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let t="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let r,o=!1;i.forEach(h=>{(0,le.yG0)(h.GroupLevel)&&(o=!0)}),t+="<XML",o&&(t+=' GroupLevel="1"'),t+=" >";for(let h=0;h<i.length;h++)if(r=i[h].ReportField.toString(),t+="<Row ",t+='ColID ="'+r+'" ',!c.J0.IsEmpty(i[h].SysColumnName)){if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let C="";for(let g=0;g<this.EmployeesList.Table.length;g++)(0,le.yG0)(this.EmployeesList.Table[g].Select)&&(C+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",");if(c.J0.IsEmpty(C)||!(C.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";C=C.substr(0,C.length-1),t+='Value ="'+C+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(t+='Value ="'+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');t+=" />"}return t+="</XML>",l.strXML=t.toString(),""}}function aa(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",12),s.EFF(2,"Post"),s.k0s()}}let sa=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-post-att-time-sheet-to-daily-att"]],decls:36,vars:12,consts:[[2,"display","flex","position","relative","height","100%"],[2,"width","100%"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-file-export"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"label",3),s.EFF(7),s.k0s(),s.EFF(8,"\n            "),s.j41(9,"div",4),s.EFF(10,"\n            "),s.DNE(11,aa,3,0,"span",5),s.EFF(12,"\n            "),s.j41(13,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(14,"i",7),s.EFF(15),s.nI1(16,"translate"),s.k0s(),s.EFF(17,"\n            "),s.j41(18,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",8),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n            "),s.j41(23,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(24,"i",9),s.EFF(25),s.nI1(26,"translate"),s.k0s(),s.EFF(27,"\n            "),s.k0s(),s.EFF(28,"\n        "),s.k0s(),s.EFF(29,"\n        "),s.j41(30,"div",10),s.EFF(31,"\n            "),s.nrm(32,"app-PactGridView",11),s.EFF(33,"  \n        "),s.k0s(),s.EFF(34,"\n   "),s.k0s(),s.EFF(35,"\n "),s.k0s()),2&t&&(s.R7$(7),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(16,6,"Clear")),s.R7$(5),s.JRh(s.bMT(21,8,"Filter")),s.R7$(5),s.JRh(s.bMT(26,10,"lbl_Export")),s.R7$(7),s.Y8G("obj",i.obj.dgv))},dependencies:[fe.bT,Qe.X,Xe.D9],encapsulation:2})}return G})();var Dt=J(48875),it=J(95050),Rt=J(96833);class Ot extends tt.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}set RefreshGrid(a){}constructor(a){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.DialogResult=!1,this.PostVisiblility=!0,this._SelectAll=!1,this.ChkBtnPostOnlyFirstAndLastTrans=new Be.c,this.PostOnlyFirstInLastOut=!1,this.PostOnlyFirstInLastOutVisibility=!0,this.btnCancelFlag=!1,this.SelectUnCheck=0,this.dsEmps=null,this.sEmpSeqNosOnGrid="",this.sFilter="",this.iPostDocType=0,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.btnCancelFlag=!1,this.LoadGrid(),this.btnFilter_Click()}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",l)}}LoadGrid(){this.dgv=new He.vv,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");let l,a=new K.O7;if(this.dgv.Columns=new Array,a=new K.O7,a.Header="Select",a.DisplayMember="Select",a.DataType="CheckBox",a.Width=50,a.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(a),a=new K.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new K.O7,a.Header="Employee Code",a.DisplayMember="EmpCode",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new K.O7,a.Header="Employee Name",a.DisplayMember="EmpName",a.DataType="TextBlock",a.Width=220,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new K.O7,a.Header="Voucher No.",a.DisplayMember="VoucherNo",a.DataType="LINK_VOUCHER",a.Width=180,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new K.O7,a.Header="Check-in Date",a.DisplayMember="CheckInDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Check-in Time",a.DisplayMember="CheckInTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Check-out Date",a.DisplayMember="CheckOutDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Check-out Time",a.DisplayMember="CheckOutTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Total Time",a.DisplayMember="TotalTime",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Result",a.DisplayMember="Result",a.DataType="TextBlock",a.Width=200,a.ReadOnly=!0,this.dgv.Columns.push(a),this.dsCols=d.d.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(l=this.dsCols.Tables[0].filter(t=>1==t.IsColumnInUse),null!=l&&l.length>0))for(let t=0;t<l.length;t++)a=new K.O7,a.Header=l[t].USERCOLUMNNAME.toString(),a.DisplayMember=l[t].SysColumnName.toString(),a.ID=l[t].SysColumnName.toString(),a.DataType="LISTBOX",a.CostCenterID=parseInt(l[t].ColumnCostCenterID),a.TypeID=parseInt(l[t].ColumnCCListViewTypeID),a.ReadOnly=!0,a.Width=120,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember),a=new K.O7,a.DisplayMember=l[t].SysColumnName.toString()+"_Key",a.IsVisible=!1,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgv.Table.length;l++)0==this.SelectUnCheck&&(this.dgv.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"Filter"==a.toString()?this.btnFilter_Click():"Export"==a.toString()&&this.Export_Click()}Export_Click(){this.dgv.Excelexportdelegate.Call()}btnClear_Click(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}btnPost_Click(){if(this.ValidatePosting()){let l,t,a="",i=null;for(let o=0;o<this.objEmpFilter.DocumentsToLoad.Items.length;o++)if(i=null,1==this.objEmpFilter.DocumentsToLoad.Items[o].IsChecked)if("89"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?d.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):"90"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?d.d.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(i=d.d.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")):"103"==this.objEmpFilter.DocumentsToLoad.Items[o].Value&&d.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")),null!=i){let r="";if(null!=this.dtData&&this.dtData.length>0){let C=this.dtData.filter(g=>g.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);if(null!=C&&C.length>0)for(let g=0;g<C.length;g++)r.length>0&&(r+=","),r+=C[g].EmpSeqNo.toString()}let h=this.GetGroupByFilterEmployees(r);if(null!=h&&h.length>0){let C="";if(null!=i&&i.length>0){for(let g=0;g<i.length;g++)c.J0.IsEmptySpace(i[g])||(C.length>0&&(C+=","),C+="-1"==i[g]?"RptManager":"-2"==i[g]?"EmpSeqNo":"CCNID"+(parseInt(i[g])-5e4));if(C.length>0){let g=h.ToTable(!0,C.split(","));if(null!=g&&g.length>0){this.dgv.TableColumns.Contains("Flag")&&this.dgv.TableColumns.Remove("Flag"),this.dgv.TableColumns.push("Flag");for(let D=0;D<this.dgv.Table.length;D++)this.dgv.TableColumns.Contains("Flag")&&(this.dgv.Table[D].Flag="0");for(let D=0;D<g.length;D++){let p=h;for(let e=0;e<Object.keys(g[0]).length;e++){let T=Object.keys(g[0])[e],P=g[0][T];p=p.filter(A=>A[T]==c.J0.String(P))}Object.keys(g[0]).length>0&&p.length>0&&it.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(e=>{e.ScreenObject.GridData.Clear();let T=-1;for(let A=0;A<this.dgv.Table.length;A++)if((0,le.yG0)(this.dgv.Table[A].Select)&&(t=this.dtData.filter(_=>_.InvDocDetailsID==this.dgv.Table[0].InvDocDetailsID&&_.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=t&&t.length>0&&"1"!=c.J0.String(this.dgv.Table[A].Flag)&&p.filter(_=>_.EmpCode==t[0].EmpCode.toString()).length>0)){if(this.dgv.Table[A].Flag="1",T++,l=e.ScreenObject.GridDataObj.NewRow(),e.ScreenObject.GridDataObj.addRow(l),e.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(e.ScreenObject.GridData[T].dcCCNID51Code=t[0].EmpCode),e.ScreenObject.GridData[T].dcCCNID51_Key=t[0].EmpSeqNo,e.ScreenObject.GridData[T].dcCCNID51=t[0].EmpName,e.FillDefaultProd(e.ScreenObject.GridData[T],"dcCCNID51"),e.ScreenObject.GridDataColumns.Contains("RefNo")&&(e.ScreenObject.GridData[T].RefNo=t[0].InvDocDetailsID),e.ScreenObject.GridData[T].dcAlpha1=c.J0.ParseDate(t[0].CheckInDate).ToString(d.d.SessionManager.Preferences["Date Format"]),e.ScreenObject.GridData[T].dcAlpha1_Key=c.J0.ParseDate(t[0].CheckInDate),e.Celleditend(e.ScreenObject.GridData[T],"dcCCNID51",0),e.ScreenObject.GridData[T].dcAlpha2=c.J0.ParseDate(t[0].CheckInTime).ToString("HH:mm"),e.ScreenObject.GridData[T].dcAlpha2_Key=c.J0.ParseDate(t[0].CheckInTime),e.ScreenObject.GridData[T].dcAlpha3=c.J0.ParseDate(t[0].CheckOutTime).ToString("HH:mm"),e.ScreenObject.GridData[T].dcAlpha3_Key=c.J0.ParseDate(t[0].CheckOutTime),e.Celleditend(e.ScreenObject.GridData[T],"dcAlpha3",40067),e.ScreenObject._CCFields.length>0)for(let _=0;_<e.ScreenObject._CCFields.length;_++)"DCCCNID51"!=e.ScreenObject._CCFields[_].DBColumnName.toUpperCase()&&(e.ScreenObject.GridDataColumns.Contains(e.ScreenObject._CCFields[_].DBColumnName+"_Key")?e.ScreenObject.GridData[T][e.ScreenObject._CCFields[_].DBColumnName+"_Key"]=t[0][e.ScreenObject._CCFields[_].DBColumnName].toString():(e.ScreenObject._CCFields[_]instanceof pt.y$||e.ScreenObject._CCFields[_]instanceof Dt.G)&&(e.ScreenObject._CCFields[_].SelectedValue=parseInt(t[0][e.ScreenObject._CCFields[_].DBColumnName])));for(let _=0;_<e.ScreenObject.GridDataColumns.length;_++)e.ScreenObject.GridDataColumns[_].startsWith("dcCCNID")&&!e.ScreenObject.GridDataColumns[_].endsWith("_Key")&&!e.ScreenObject.GridDataColumns[_].endsWith("Code")&&"DCCCNID51"!=e.ScreenObject.GridDataColumns[_].toUpperCase()&&"DCCCNID73"!=e.ScreenObject.GridDataColumns[_].toUpperCase()&&(e.ScreenObject.GridData[T][e.ScreenObject.GridDataColumns[_]]="",e.ScreenObject.GridData[T][e.ScreenObject.GridDataColumns[_]+"_Key"]=t[0][e.ScreenObject.GridDataColumns[_]]);e.CalculateTotals(e.ScreenObject.GridData[T],!1),e.ScreenObject.GridDataObj.updateRow(e.ScreenObject.GridData[T]),e.ScreenObject.GridDataObj.RefreshGrid=!0}c.J0.IsEmptySpace(a)||(e.DisplayMessage=a,e.MessageVisibility=!0),e.UpdateFooter=!0,e.RefreshGrid=!0,d.d.page.addNewTab({title:e.DisplayName,component:Rt.AddEditDocumentComponent,params:{obj:e}});var P=e.ScreenObject._StaticFields.find(A=>"CommonNarration"==A.DBColumnName);null!=P&&(P.SetFocus=!0)})}}}}}}else{let r=this.dtData.filter(h=>h.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);null!=r&&r.length>0&&it.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(h=>{h.ScreenObject.GridData.Clear();let C=-1;for(let D=0;D<this.dgv.Table.length;D++)if((0,le.yG0)(this.dgv.Table[D].Select)&&(t=this.dtData.filter(p=>p.InvDocDetailsID==this.dgv.Table[D].InvDocDetailsID.toString()&&p.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=t&&t.length>0)){if(C++,l=h.ScreenObject.GridDataObj.NewRow(),h.ScreenObject.GridDataObj.addRow(l),h.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(h.ScreenObject.GridData[C].dcCCNID51Code=t[0].EmpCode),h.ScreenObject.GridData[C].dcCCNID51_Key=t[0].EmpSeqNo,h.ScreenObject.GridData[C].dcCCNID51=t[0].EmpName,h.FillDefaultProd(h.ScreenObject.GridData[C],"dcCCNID51"),h.ScreenObject.GridDataColumns.Contains("RefNo")&&(h.ScreenObject.GridData[C].RefNo=t[0].InvDocDetailsID),h.ScreenObject.GridData[C].dcAlpha1=c.J0.ParseDate(t[0].CheckInDate).ToString(d.d.SessionManager.Preferences["Date Format"]),h.ScreenObject.GridData[C].dcAlpha1_Key=c.J0.ParseDate(t[0].CheckInDate),h.Celleditend(h.ScreenObject.GridData[C],"dcCCNID51",0),h.ScreenObject.GridData[C].dcAlpha2=c.J0.ParseDate(t[0].CheckInTime).ToString("HH:mm"),h.ScreenObject.GridData[C].dcAlpha2_Key=c.J0.ParseDate(t[0].CheckInTime),h.ScreenObject.GridData[C].dcAlpha3=c.J0.ParseDate(t[0].CheckOutTime).ToString("HH:mm"),h.ScreenObject.GridData[C].dcAlpha3_Key=c.J0.ParseDate(t[0].CheckOutTime),h.Celleditend(h.ScreenObject.GridData[C],"dcAlpha3",40067),h.ScreenObject._CCFields.length>0)for(let p=0;p<h.ScreenObject._CCFields.length;p++)"DCCCNID51"!=h.ScreenObject._CCFields[p].DBColumnName.toUpperCase()&&(h.ScreenObject.GridDataColumns.Contains(h.ScreenObject._CCFields[p].DBColumnName+"_Key")?h.ScreenObject.GridData[C][h.ScreenObject._CCFields[p].DBColumnName+"_Key"]=t[0][h.ScreenObject._CCFields[p].DBColumnName].toString():(h.ScreenObject._CCFields[p]instanceof pt.y$||h.ScreenObject._CCFields[p]instanceof Dt.G)&&(h.ScreenObject._CCFields[p].SelectedValue=parseInt(t[0][h.ScreenObject._CCFields[p].DBColumnName])));for(let p=0;p<h.ScreenObject.GridDataColumns.length;p++)h.ScreenObject.GridDataColumns[p].startsWith("dcCCNID")&&!h.ScreenObject.GridDataColumns[p].endsWith("_Key")&&"DCCCNID51"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&"DCCCNID73"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&(h.ScreenObject.GridData[C][h.ScreenObject.GridDataColumns[p]+"_Key"]=t[0][h.ScreenObject.GridDataColumns[p]]);h.CalculateTotals(h.ScreenObject.GridData[C],!1),h.ScreenObject.GridDataObj.updateRow(h.ScreenObject.GridData[C]),h.ScreenObject.GridDataObj.RefreshGrid=!0}c.J0.IsEmptySpace(a)||(h.DisplayMessage=a,h.MessageVisibility=!0),h.UpdateFooter=!0,h.RefreshGrid=!0,d.d.page.addNewTab({title:h.DisplayName,component:Rt.AddEditDocumentComponent,params:{obj:h}});var g=h.ScreenObject._StaticFields.find(D=>"CommonNarration"==D.DBColumnName);g&&(g.SetFocus=!0)})}}}GetGroupByFilterEmployees(a){let l="  AND EmpSeqNo IN ("+a+")",t=[];return t.push(Date.Today().ToString("dd MMM yyyy")),t.push(l),t.push(0),t.push(d.d.SessionManager.RoleID),t.push(d.d.SessionManager.UserID),t.push(d.d.SessionManager.LanguageID),d.d.empService.GetData(t,"spPAY_GetEmpMasterCCDetails").Tables[0]}ValidatePosting(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");{let a=0;for(let l=0;l<this.dgv.Table.length;l++)(0,le.yG0)(this.dgv.Table[l].Select)&&a++;if(0==a)return this.DisplayMessage="Select atleast one Document to post",!1;for(let l=0;l<this.dgv.Table.length;l++)if((0,le.yG0)(this.dgv.Table[l].Select)&&(null==this.dgv.Table[l].CheckInTime||null==this.dgv.Table[l].CheckInTime||""==this.dgv.Table[l].CheckInTime.toString()||null==this.dgv.Table[l].CheckOutTime||null==this.dgv.Table[l].CheckOutTime||""==this.dgv.Table[l].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(l+1).toString(),!1}return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(a){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+a.stack),!1}}btnFilter_Click(){Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new lt.t("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?d.d.page.ShowDialog(this.objEmpFilter,ct.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}btnFilter_Click_CallBack(){if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let r=0;r<this.objEmpFilter.CostCenterFilters.length;r++){let h=this.objEmpFilter.CostCenterFilters[r];if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(C=>C.Id==l&&C.IsGroup))if(o+=" AND ",mt.IPrefetchFilter.IsGroupTree(h)){let C="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(C.length>0&&(C+=","),C+=h.SelectedNodes[g].Id);0==C.length&&(C+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+qe.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+qe.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=C.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let C=0;C<h.SelectedNodes.length;C++)C>0&&(o+=","),o+=h.SelectedNodes[C].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}this.FilterEmployees()}}FilterEmployees(){this.sEmpSeqNosOnGrid="",this.objEmpFilter.rBtnPostAttDocs?this.iPostDocType=89:this.objEmpFilter.rBtnPostTimeSheetDocs?this.iPostDocType=90:this.objEmpFilter.rBtnPostOnDutyDocs&&(this.iPostDocType=103),this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");let l=[];l.push(Date.Today().ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID);let t=d.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails"),i="";if(this.dgv.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(let r=0;r<t.Tables[0].length;r++)i.Trim().length>0&&(i+=","),i+=t.Tables[0][r].EmpSeqNo.toString();var a;let o="";for(let r=0;r<this.objEmpFilter.DocumentsToLoad.Items.length;r++)1==this.objEmpFilter.DocumentsToLoad.Items[r].IsChecked&&(o.Trim().length>0&&(o+=","),o+=this.objEmpFilter.DocumentsToLoad.Items[r].Value);if(a=d.d.common.GetDataSet3("PAY117",o,i,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy")),this.dtData=a.Tables[0],!(null!=a&&a.Tables.length>0&&a.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");{let r;for(let h=0;h<a.Tables[0].length;h++){r=this.dgv.NewRow(),r.Select=!1,r.SNo=(h+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=a.Tables[0][h].EmpSeqNo.toString(),r.EmpSeqNo=a.Tables[0][h].EmpSeqNo,r.EmpCode=a.Tables[0][h].EmpCode,r.EmpName=a.Tables[0][h].EmpName,r.InvDocDetailsID=a.Tables[0][h].InvDocDetailsID,r.VoucherNo=a.Tables[0][h].VoucherNo,r.CheckInDate=a.Tables[0][h].CheckInDate,c.J0.IsEmptySpace(a.Tables[0][h].CheckInTime)||(r.CheckInTime=c.J0.ParseDate(a.Tables[0][h].CheckInTime).ToString("HH:mm")),c.J0.IsEmptySpace(a.Tables[0][h].CheckOutDate)?r.Row_Background="#F77B7E":r.CheckOutDate=a.Tables[0][h].CheckOutDate,c.J0.IsEmptySpace(a.Tables[0][h].CheckOutTime)||(r.CheckOutTime=c.J0.ParseDate(a.Tables[0][h].CheckOutTime).ToString("HH:mm")),r.TotalTime=c.J0.IsEmptySpace(a.Tables[0][h].TotalTime)?"0.00":a.Tables[0][h].TotalTime,0==parseFloat(r.TotalTime.toString().Replace(":","."))&&(r.Row_Background="#F77B7E");for(let C=0;C<this.dgv.TableColumns.length;C++)this.dgv.TableColumns[C].startsWith("dcCCNID")&&!this.dgv.TableColumns[C].endsWith("_Key")&&(r[this.dgv.TableColumns[C]+"_Key"]=a.Tables[0][h][this.dgv.TableColumns[C]]);this.dgv.addRow(r)}this.dgv.refreshDataView(),this.dgv.RefreshGrid=!0,this.dgv.Update()}}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+l.stack)}}}var Vt=J(5661);const la=()=>({standalone:!0});let ia=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-payslip"]],decls:71,vars:28,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-filter"],[1,"main_div"],[2,"padding","11px"],[1,"row","form-row"],[1,"form-group","col-md-3","col-sm-6","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"align-content","center"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n        "),s.j41(2,"div",1),s.EFF(3,"\n            "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n            "),s.j41(7,"div",3),s.EFF(8,"\n                "),s.j41(9,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Preview")}),s.nrm(10,"i",5),s.EFF(11),s.nI1(12,"translate"),s.k0s(),s.EFF(13," \n                "),s.j41(14,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Print")}),s.nrm(15,"i",6),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18," \n                "),s.j41(19,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(20,"i",7),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n                "),s.j41(24,"span",4),s.bIt("click",function(){return i.obj.Button_Click("EMail")}),s.nrm(25,"i",8),s.EFF(26),s.nI1(27,"translate"),s.k0s(),s.EFF(28,"\n                "),s.j41(29,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(30,"i",9),s.EFF(31),s.nI1(32,"translate"),s.k0s(),s.EFF(33,"\n            "),s.k0s(),s.EFF(34,"\n        "),s.k0s(),s.EFF(35,"\n"),s.j41(36,"div",10),s.EFF(37,"\n    "),s.j41(38,"div",11),s.EFF(39,"          \n        "),s.j41(40,"div",12),s.EFF(41,"\n            "),s.j41(42,"div",13),s.EFF(43,"\n                "),s.eu8(44,14),s.EFF(45,"\n            "),s.k0s(),s.EFF(46,"\n            "),s.j41(47,"div",13),s.EFF(48,"\n                "),s.eu8(49,14),s.EFF(50,"\n            "),s.k0s(),s.EFF(51,"\n            "),s.j41(52,"div",13),s.EFF(53,"\n                "),s.eu8(54,14),s.EFF(55,"\n            "),s.k0s(),s.EFF(56,"\n                "),s.j41(57,"div",15),s.EFF(58,"\n                  "),s.j41(59,"input",16),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.ExportSeperate,r)||(i.obj.ExportSeperate=r),r}),s.k0s(),s.EFF(60,"\n                  "),s.j41(61,"label",17),s.bIt("click",function(){return i.obj.ExportSeperate=!i.obj.ExportSeperate}),s.EFF(62),s.nI1(63,"translate"),s.k0s(),s.EFF(64,"\n              "),s.k0s(),s.EFF(65,"              \n    "),s.k0s(),s.EFF(66,"\n\n    "),s.j41(67,"div",18),s.EFF(68,"\n        \n    "),s.k0s(),s.EFF(69,"\n"),s.k0s(),s.EFF(70,"\n "),s.k0s()()),2&t&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(6),s.JRh(s.bMT(12,15,"Preview")),s.R7$(5),s.JRh(s.bMT(17,17,"Print")),s.R7$(5),s.JRh(s.bMT(22,19,"Export")),s.R7$(5),s.JRh(s.bMT(27,21,"EMail")),s.R7$(5),s.JRh(s.bMT(32,23,"Filter")),s.R7$(13),s.Y8G("obj",i.obj.dtpPayrollMonth)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbPayslipLayout)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbSortOn)("group",i.form),s.R7$(5),s.R50("ngModel",i.obj.ExportSeperate),s.Y8G("ngModelOptions",s.lJ4(27,la)),s.R7$(3),s.JRh(s.bMT(63,25,"Export Each Employee Seperately")))},dependencies:[Ye._,v.Zm,v.BC,v.vS,Xe.D9],encapsulation:2})}return G})();var na=J(54004),Mt=J(70234),wt=J(54683),ft=J(9309),Gt=J(39559),Me=J(31820),gt=J(95005),oa=J(3436),ra=J(93426),kt=J(78906);class _t extends tt.g{get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}constructor(){super(),this.CostCenterID=0,this.TypeID=0,this.AttachmentVisibility=!1,this.Employee=new Dt.G(0),this.AttachVisiblility=!1,this.PayrollTaxFields=new Array,this.dtPayrollTaxCmptsObj=new He.vv,this.Savereturnvalue=-1,this.oRadio1=null,this.dsTaxComponents=null,this.CostCenterID=262,this.objEmp=new Gt.h,this.ScreenObject=new kt.a(0,0),this.ScreenObject.Data=[],this.ViewAttachments=new ft.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.AttachVisiblility=d.d.SessionManager.IsActionAssigned(262,"Attach"),this.EmpYear=new n.y$(0),this.EmpYear.LblWidth="60",this.EmpYear.Label=d.d.GetResource("Doc_Year"),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let a=2e3;a<2100;a++){let l=n._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=c.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("yyyy"),this.EmpRegime=new n.y$(0),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("New","New")),this.EmpRegime.Label="Regime Opted For",this.lFinancialDate=this.GetFinancialYear(),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.LblWidth="80",this.EmpRegime.LblWidth="80",this.Employee.Label=d.d.GetResource("Pay_Employee"),this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=new Array,this.dtPayrollTaxCmptsObj.Height=110,this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),this.BindHRAGridColumns()}BindHRAGridColumns(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();let a=new K.O7;a.Header="FromDate",a.DisplayMember="ITFromDate",a.ValueMember="ITFromDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="ToDate",a.DisplayMember="ITToDate",a.ValueMember="ITToDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=75,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="Metro",a.ValueBinding="Metro",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=60;let l=[];l.push(n._p.ComboBoxItems_2("Yes","Yes")),l.push(n._p.ComboBoxItems_2("No","No")),a.ComboData=l,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="HRAAddress",a.DisplayMember="HRAAddress",a.DataType="TextArea",a.ReadOnly=!1,a.Width=200,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="Name of Landlord",a.DisplayMember="NameofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=153,this.PayrollColumnSourceTaxComponents.push(a),a=new K.O7,a.Header="Pan of Landlord",a.DisplayMember="PanofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=150,this.PayrollColumnSourceTaxComponents.push(a),this.dtPayrollTaxCmptsObj.RefreshGridView()}Employee_SelectedValueChanged(a){""!=this.EmpYear.SelectedValue.toString()?(this.EmpRegime.SelectedValue="",this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new ft.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}OnYearSelected(a){this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.lFinancialDate=this.GetFinancialYear(),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth,1),t=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(t.getMonth(),!1)+" "+t.getFullYear(),a}OnComponentSelection(a){let l="",t="";this.PayrollTaxFields.forEach(i=>{if(i instanceof gt.mn){let o=i;if(t=o.Currency.SelectedValue,null!=t){let r=this.dsTaxComponents.Tables[0].filter(h=>"ComboTextValue"==h.ControlType&&h.NodeID==parseInt(t));for(let h=0;h<r.length;h++){let C=r[h];"COMBOTEXTVALUE"===(l=c.J0.String(C.ControlType),l)&&(o.Label=c.J0.String(C.AmountLimit))}}}})}GenerateTaxComponentFields(a,l,t){try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");let o,r,i=0,h=null,C=null;if(null===l&&(l=0),0!=a&&0!=l&&(h=d.d.common.GetDataSet3("PAY071",a.toString(),l.toString())),null!=h&&h.Tables.length>0&&h.Tables[0].length>0&&!c.J0.IsEmpty(h.Tables[0][0].SEQNO)&&(C=d.d.common.GetDataSet("PAY072",h.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=d.d.empService.GetIncomeTaxComponents(0,a,l),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!c.J0.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());let g=this.dsTaxComponents.Tables[0];if(g.forEach(D=>{switch(o=c.J0.String(D.CONTROLTYPE).toUpperCase(),o){case"LABEL":r=new oa.D,r.Label=c.J0.String(D.NAME),t.push(r),r.tabname="LABEL";break;case"TEXTBOX":this.LabelLimitAmount=c.J0.String(D.AMOUNTLIMIT),this.oText=new Me.Dw(parseInt(D.NODEID)),this.oText.Label=c.J0.String(D.NAME),this.oText.KeyTip=this.LabelLimitAmount,this.oText.Text=D.AMOUNT.toString(),this.oText.LblWidth="400",this.oText.tabname="TEXTBOX",t.push(this.oText);break;case"COMBOTEXTVALUE":let e=g.filter(T=>"ComboTextValue"==T.CONTROLTYPE&&T.GROUPID==parseInt(D.GROUPID));var p=t.find(T=>T instanceof gt.mn&&T.DBColumnID==parseInt(D.GROUPID));null==p?(this.oRadio1=new gt.mn,this.oRadio1.DBColumnID=parseInt(D.GROUPID)):this.oRadio1=p,this.oRadio1.tabname="COMBOTEXTVALUE",this.oRadio1.LblWidth="1",(0==i||i!=parseInt(D.GROUPID))&&e.length>0&&(e.forEach(T=>{this.oRadio1.Currency.Items.push(n._p.ComboBoxItems_2(c.J0.String(T.NAME).TrimStart(" "),c.J0.String(T.NODEID)))}),this.oRadio1.Currency.SelectedValue=this.oRadio1.Currency.Items[0].Value,this.oRadio1.Currency.SelectionChangedCommand.Subscribe(this,"OnComponentSelection"),t.push(this.oRadio1)),parseInt(D.SELECTEDNODE)>0?(this.oRadio1.Currency.SelectedValue=c.J0.String(D.SELECTEDNODE),this.oRadio1.ExchangeRate.Text=D.AMOUNT.toString(),this.oRadio1.Label=D.SELECTEDAMTLIMIT.toString()):""==this.oRadio1.ExchangeRate.Text&&(this.oRadio1.ExchangeRate.Text=D.AMOUNT.toString()),null==this.oRadio1.Label&&(this.LabelLimitAmount=c.J0.String(D.AMOUNTLIMIT),this.oRadio1.Label=this.LabelLimitAmount),(0==i||i!=parseInt(D.GROUPID))&&(i=parseInt(D.GROUPID))}}),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>2&&this.dsTaxComponents.Tables[2].length>0&&this.dsTaxComponents.Columns[2].Contains("RegimeType")&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&""!=this.dsTaxComponents.Tables[2][0].RegimeType.toString()&&(this.EmpRegime.SelectedValue=this.dsTaxComponents.Tables[2][0].RegimeType.toString()),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0){let p;for(let e=0;e<this.dsTaxComponents.Tables[1].length;e++)p=this.dtPayrollTaxCmptsObj.NewRow(),p.ITFromDate=c.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("MMM/yyyy"),p.ITFromDate_Key=c.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("dd-MMM-yyyy"),p.ITToDate=c.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("MMM/yyyy"),p.ITToDate_Key=c.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("dd-MMM-yyyy"),p.Amount=this.dsTaxComponents.Tables[1][e].Amount.toString(),p.Metro=this.dsTaxComponents.Tables[1][e].Metro.toString().TrimEnd(),p.HRAAddress=this.dsTaxComponents.Tables[1][e].Address.toString(),p.NameofLandlord=this.dsTaxComponents.Tables[1][e].Landlord.toString(),p.PanofLandlord=this.dsTaxComponents.Tables[1][e].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(p)}if(null!=C&&C.Tables.length>0&&C.Tables[0].length>0){let D=C.Tables[0];if(null!=D&&D.length>0)for(let p=0;p<D.length;p++){let e=new wt.AddAttachmentViewModel;e.AddAttachmentViewModel_2(this),e.AttachmentID=parseInt(D[p].FileID),e.ActualFileName=D[p].ActualFileName.toString(),e.FileExtension=D[p].FileExtension.toString(),e.FileDescription=D[p].FileDescription.toString(),e.FilePath=c.J0.GetPath(D[p].GUID+"."+D[p].FileExtension),e.RelativeFileName=D[p].RelativeFileName.toString(),e.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(e)}}else this.BindEmptyRows(2)}catch(i){Logger.ErrorLog("Error : "+i),this.DisplayMessage=i.message}}OnSaveITDeclarations(a){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");let l="";if(l=this.DataValid(),""!=l.toString())return void(this.DisplayMessage=l);this.SaveEmpIncomeTax(),this.OnClear(a)}catch(l){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+l)}}DataValid(){let l,t,a="",i=0,o=0;0==this.Employee.SelectedValue&&(a+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(a+="Please select the Year \r\n");let r=d.d.common.GetDataTable("PAY111",this.EmpYear.SelectedValue.ToString());null!=r&&r.length>0&&(c.J0.IsEmpty(r[0].dcAlpha9)||c.J0.ParseDate(r[0].dcAlpha9)<Date.Today()&&(a+="Cannot save the record,CutOffDate Exceeded \r\n")),this.PayrollTaxFields.forEach(h=>{if(h instanceof Me.Dw){let C=h;i=c.J0.Double(C.KeyTip),o=c.J0.Double(C.Text),i>0&&o>i&&(a=a+"Amount should be less than Limit Amount for '"+C.Label.toString().Trim()+"'\r\n")}if(h instanceof gt.mn){let C=h;i=c.J0.Double(C.Label),o=c.J0.Double(C.ExchangeRate.Text),i>0&&o>i&&(a=a+"Amount should be less than Limit Amount for '"+C.Currency.Text.toString().Trim()+"'\r\n")}});for(let h=0;h<this.dtPayrollTaxCmpts.length;h++)c.J0.IsEmpty(this.dtPayrollTaxCmpts[h].ITFromDate_Key)||(c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))>c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))?a=a+"Fromdate should be less than todate at row no ('"+h.toString()+"')\r\n":c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))<c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))&&(a=a+"Todate should be greater than fromdate at row no ('"+h.toString()+"')\r\n"));for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=c.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key);h++){l=c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),t=c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"));for(let C=0;C<this.dtPayrollTaxCmpts.length;C++)if(h!=C){if(""==c.J0.String(this.dtPayrollTaxCmpts[C].ITFromDate_Key))break;if(+l.Date>=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+l.Date<=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+t.Date>=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+t.Date<=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+l.Date>=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+t.Date<=+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()>=+l.Date&&+c.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()<=+t.Date){a=a+"Invalid dates entered at row no ('"+C.toString()+"')\r\n";break}}}for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=c.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key)&&""!=c.J0.String(this.dtPayrollTaxCmpts[h].ITToDate_Key);h++)if(l=c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),t=c.J0.ParseDate(c.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy")),""!=this.dtPayrollTaxCmpts[h].Amount.toString()){o=parseFloat(this.dtPayrollTaxCmpts[h].Amount);let C=12*(t.getFullYear()-l.getFullYear())+t.getMonth()-l.getMonth()+1;if(o/C>8e3){if(""==this.dtPayrollTaxCmpts[h].NameofLandlord.toString()){a=a+"Mandatory NameofLandlord row no ('"+(h+1).toString()+"')\r\n";break}if(""==this.dtPayrollTaxCmpts[h].PanofLandlord.toString()){a=a+"Mandatory PanofLandlord row no ('"+(h+1).toString()+"')\r\n";break}}}return a}SaveEmpIncomeTax(){Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{let l="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),this.objEmp.Regime=this.EmpRegime.SelectedValue,l+="<Rows>",this.PayrollTaxFields.forEach(o=>{o instanceof Me.Dw?(l+='<row ComponentID="'+o.DBColumnID,l+='" AmountLimit="'+o.KeyTip,l+=null!=o.Text?'" Amount="'+parseFloat(o.Text):'" Amount="0',l+='"/>'):o instanceof gt.mn&&(l+='<row ComponentID="'+o.Currency.SelectedValue,l+='" AmountLimit="'+o.Label,l+=null!=o.ExchangeRate.Text?'" Amount="'+parseFloat(o.ExchangeRate.Text):'" Amount="0',l+='"/>')}),l+="</Rows>";let t="";t+="<HRAINFO>";for(let o=0;o<this.dtPayrollTaxCmpts.length;o++)(""!=c.J0.String(this.dtPayrollTaxCmpts[o].ITFromDate_Key)||""!=c.J0.String(this.dtPayrollTaxCmpts[o].ITToDate_Key))&&(t+='<row FromDt="'+c.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITFromDate_Key).ToString("dd-MMM-yyyy"),t+='" ToDt="'+c.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[o].Amount.toString()?t+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[o].Amount):t+='" Amt="0',t+='" Metro="'+this.dtPayrollTaxCmpts[o].Metro,t+='" Address="'+this.dtPayrollTaxCmpts[o].HRAAddress,t+='" Landlord="'+this.dtPayrollTaxCmpts[o].NameofLandlord,t+='" LandlordPAN="'+this.dtPayrollTaxCmpts[o].PanofLandlord,t+='"/>');t+="</HRAINFO>";let i=this.ViewAttachments.GetXML();d.d.empService.SaveEmpTaxDeclarations(l.toString(),t.toString(),i.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode,this.objEmp.Regime).subscribe(o=>{this.DisplayMessage=o.Message,this.Savereturnvalue=o.RetValue})}catch(a){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+a.stack)}}OnClear(a){try{this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new ft.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(l){Logger.ErrorLog("Error : "+l),this.DisplayMessage=l.message}}BindEmptyRows(a){this.dtPayrollTaxCmptsObj.addEmptyRows(a)}FilterEmployees(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");let l,t,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=new Date(d.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),d.d.SessionManager.IsRptManagerUser&&d.d.SessionManager.IsActionAssigned(262,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+d.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+a.stack)}}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let a="";null!=this.Attachment&&(a=this.Attachment.ColID);let l=null;null!=this.Attachment&&(l=this.Attachment.RowID),this.Attachment=new wt.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==a?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=a,this.Attachment.RowID=l),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnClickAttachment(a){this.AttachmentVisibility=!0,d.d.page.ShowDialog(this,ra.l,{Title:"Attachment"})}}function da(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.OnClickAttachment())}),s.EFF(1,"\n        "),s.nrm(2,"i",22),s.EFF(3),s.nI1(4,"translate"),s.k0s()}2&G&&(s.R7$(3),s.JRh(s.bMT(4,1,"Attachments")))}function ha(G,a){if(1&G&&(s.j41(0,"div",26),s.EFF(1),s.k0s()),2&G){const l=s.XpG().$implicit;s.R7$(),s.JRh(l.Label)}}function H(G,a){if(1&G&&s.nrm(0,"input",31),2&G){const l=s.XpG(2).$implicit,t=s.XpG();s.Y8G("placeholder",t.lblwatermark)("ngModel",l.Text)}}function me(G,a){if(1&G){const l=s.RV6();s.j41(0,"input",32),s.mxI("ngModelChange",function(i){s.eBV(l);const o=s.XpG(2).$implicit;return s.DH7(o.Text,i)||(o.Text=i),s.Njj(i)}),s.k0s()}if(2&G){const l=s.XpG(2).$implicit;s.Y8G("tabindex",l.IsTabStop?null:-1)("disabled",!l.Enable||l.IsReadOnly),s.R50("ngModel",l.Text)}}function m(G,a){if(1&G&&(s.qex(0),s.EFF(1,"\n                "),s.j41(2,"div"),s.EFF(3,"\n                  "),s.j41(4,"label",27),s.EFF(5),s.k0s(),s.EFF(6," \n                  "),s.j41(7,"label",28),s.EFF(8),s.k0s(),s.EFF(9," \n                  "),s.DNE(10,H,1,2,"input",29),s.EFF(11,"\n                  "),s.DNE(12,me,1,3,"input",30),s.EFF(13,"\n                     "),s.EFF(14,"\n                "),s.k0s(),s.EFF(15,"\n              "),s.EFF(16,"\n            "),s.bVm()),2&G){const l=s.XpG().$implicit;s.R7$(2),s.AVh("c-flex",l.LblWidth),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("  ",l.Label," "),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("    ",l.KeyTip," "),s.R7$(2),s.Y8G("ngIf",!l.ShowControl),s.R7$(2),s.Y8G("ngIf",l.ShowControl)}}function I(G,a){if(1&G&&(s.qex(0),s.EFF(1,"\n              "),s.eu8(2,13),s.EFF(3,"\n            "),s.bVm()),2&G){const l=s.XpG().$implicit,t=s.XpG();s.R7$(2),s.Y8G("obj",l)("group",t.form)}}function y(G,a){if(1&G&&(s.qex(0),s.EFF(1,"\n          "),s.j41(2,"div",23),s.EFF(3,"\n            "),s.DNE(4,ha,2,1,"div",24),s.EFF(5,"\n            "),s.DNE(6,m,17,8,"ng-container",25),s.EFF(7,"\n            "),s.DNE(8,I,4,2,"ng-container",25),s.EFF(9,"\n          "),s.k0s(),s.EFF(10,"\n        "),s.bVm()),2&G){const l=a.$implicit;s.R7$(2),s.Y8G("ngSwitch",!0),s.R7$(2),s.Y8G("ngSwitchCase","LABEL"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","TEXTBOX"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","COMBOTEXTVALUE"==l.tabname)}}let u=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj,console.log(this.obj)}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-income-tax-declaration"]],decls:77,vars:18,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px"],[1,"row"],[1,"form-group","col-xl-3","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label"],[1,"form-group","col-xl-6","col-md-4","col-sm-12","col-xs-12","PACTControl"],[2,"height","calc(100% - 190px)","overflow","auto"],[1,"PACTHeaderFields","row","form-row"],[4,"ngFor","ngForOf"],[1,"documentgrid",2,"height","140px"],[1,"page-subtitle",2,"padding","0","display","block","height","30px","font-size","16px"],[2,"height","90px"],[1,"fa-light","fa-paperclip"],[1,"form-group","row","PACTControl",3,"ngSwitch"],["class","input_cntrl_label panel-heading","style","font-weight: bold; background-color:var(--gridheaderbg-color); padding: 4px;",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"input_cntrl_label","panel-heading",2,"font-weight","bold","background-color","var(--gridheaderbg-color)","padding","4px"],[1,"input_cntrl_label",2,"width","70%"],[1,"input_cntrl_label",2,"width","10%","font-weight","bold"],["disabled","","class","input_cntrl disablecntrl","style","text-align: right;width: 20%;",3,"placeholder","ngModel",4,"ngIf"],["class","input_cntrl","style","width: 20%;text-align: right;",3,"tabindex","disabled","ngModel","ngModelChange",4,"ngIf"],["disabled","",1,"input_cntrl","disablecntrl",2,"text-align","right","width","20%",3,"placeholder","ngModel"],[1,"input_cntrl",2,"width","20%","text-align","right",3,"ngModelChange","tabindex","disabled","ngModel"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.EFF(14,"\n      "),s.j41(15,"span",6),s.bIt("click",function(){return i.obj.OnSaveITDeclarations()}),s.EFF(16,"\n        "),s.nrm(17,"i",7),s.EFF(18),s.nI1(19,"translate"),s.k0s(),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.obj.OnClear("Clear")}),s.EFF(22,"\n        "),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n      "),s.DNE(27,da,5,3,"span",9),s.EFF(28,"\n  "),s.k0s(),s.EFF(29,"\n  "),s.k0s(),s.EFF(30,"\n  "),s.j41(31,"div",10),s.EFF(32,"\n    "),s.j41(33,"div",11),s.EFF(34,"\n      "),s.j41(35,"div",12),s.EFF(36,"\n        "),s.eu8(37,13),s.EFF(38,"\n        "),s.j41(39,"label",14),s.EFF(40),s.k0s(),s.EFF(41,"\n      "),s.k0s(),s.EFF(42,"\n      "),s.j41(43,"div",15),s.EFF(44,"\n        "),s.eu8(45,13),s.EFF(46,"\n      "),s.k0s(),s.EFF(47,"\n      "),s.j41(48,"div",12),s.EFF(49,"\n        "),s.eu8(50,13),s.EFF(51,"\n      "),s.k0s(),s.EFF(52,"\n    "),s.k0s(),s.EFF(53,"\n    "),s.j41(54,"div",16),s.EFF(55,"\n      "),s.j41(56,"div",17),s.EFF(57,"\n        "),s.DNE(58,y,11,4,"ng-container",18),s.EFF(59,"\n      "),s.k0s(),s.EFF(60,"\n    "),s.k0s(),s.EFF(61,"\n    "),s.j41(62,"div",19),s.EFF(63,"\n      "),s.j41(64,"span",20),s.EFF(65,"HRA Information"),s.k0s(),s.EFF(66,"\n      "),s.j41(67,"div",21),s.EFF(68,"\n        "),s.eu8(69,13),s.EFF(70,"\n      "),s.k0s(),s.EFF(71,"\n    "),s.k0s(),s.EFF(72,"\n  "),s.k0s(),s.EFF(73,"\n  "),s.k0s(),s.EFF(74,"\n"),s.k0s(),s.EFF(75,"\n\n"),s.EFF(76,"\n")),2&t&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(9),s.JRh(s.bMT(19,14,"Save")),s.R7$(6),s.JRh(s.bMT(25,16,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.AttachVisiblility),s.R7$(10),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(3),s.JRh(i.obj.lFinancialDate),s.R7$(5),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(8),s.Y8G("ngForOf",i.obj.PayrollTaxFields),s.R7$(11),s.Y8G("obj",i.obj.dtPayrollTaxCmptsObj)("group",i.form))},dependencies:[fe.Sq,fe.bT,fe.ux,fe.e1,Ye._,v.me,v.BC,v.vS,Xe.D9],encapsulation:2})}return G})();var M=J(24028);class O extends tt.g{constructor(a){super(),this.dtpFromDate=new M.P6(0),this.dtpToDate=new M.P6(0),this.lTotalTaxAmount="",this.lTDSPaidAmount="",this.lTDSAmount="",this.ButtonClick=new St.Yk,this.iComponentID=0,Logger.InfoLog("TDSPostingViewModel::Entering TDSPostingViewModel()"),this.DisplayMessage="",this.Parent=a[0],this.lTotalTaxAmount=a[1].toString(),this.lTDSPaidAmount=a[2].toString(),this.lTDSAmount=a[3].toString(),this.iComponentID=parseInt(a[4]),this.ButtonClick.Subscribe(this,"Button_Click"),this.LoadGrid(),this.dtpFromDate.Label="From Date",this.dtpFromDate.LblWidth="80",this.dtpFromDate.Date=new Date(parseInt(this.Parent.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),this.dtpToDate.Label="To Date",this.dtpToDate.LblWidth="80",this.dtpToDate.Date=this.dtpFromDate.Date.AddYears(1).AddMonths(-1),this.Generate_Click(0),Logger.InfoLog("TDSPostingViewModel::Exiting TDSPostingViewModel()")}LoadGrid(){this.dgv=new He.vv,this.dgv.Width="550",this.dgv.CanUserDeleteRows=!1,this.dgv.CanUserAddRows=!1,this.dgv.OnCellEditEnding.Subscribe(this,"dgv_EndEdit"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("Month"),this.dgv.TableColumns.push("Amount");let a=new K.O7;this.dgv.Columns=[],a=new K.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new K.O7,a.Header="Month",a.DisplayMember="Month",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new K.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!1,a.TextAlign="FLOAT",this.dgv.Columns.push(a),this.dgv.Columns[2].footer="0.00",this.dgv.UpdateFooter()}Button_Click(a){Logger.InfoLog("TDSPostingViewModel::Entering Button_Click"),"Post"==a.toString()?this.Post_Click():"Cancel"==a.toString()?d.d.page.HideDialog(this.PopUpGUID):"Generate"==a.toString()&&this.Generate_Click(1),Logger.InfoLog("TDSPostingViewModel::Exiting Button_Click")}Generate_Click(a){this.dgv.Clear();let l=new Date(parseInt(this.Parent.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=l.AddYears(1).AddMonths(-1);if(this.dtpFromDate.Date<l||this.dtpFromDate.Date>t)return this.DisplayMessage="From Date should be in Between Finacial Year",void(this.MessageVisibility=!0);if(this.dtpToDate.Date<l||this.dtpToDate.Date>t)return this.DisplayMessage="To Date should be in Between Finacial Year",void(this.MessageVisibility=!0);let i=d.d.common.GetDataSet3("PAY122",this.Parent.Employee.SelectedValue,this.dtpFromDate.Date.ToString("dd MMM yyyy"),this.dtpToDate.Date.ToString("dd MMM yyyy"));if(0==a){if(null!=i&&i.length>0){let D=i.Compute("max","PayrollDate");c.J0.IsEmpty(D)||(this.dtpFromDate.Date=new Date(D))}}else if(1==a&&null!=i&&i.length>0)return this.DisplayMessage="Payroll Already Processed For the Month - "+new Date(i.Rows[0].PayrollDate).ToString("dd MMM yyyy"),void(this.MessageVisibility=!0);let o=null,r=0,h=0,C=0,g=this.dtpFromDate.Date;for(;g<=this.dtpToDate.Date;)r+=1,g=g.AddMonths(1);for(h=parseFloat(this.lTDSAmount)/r,h=parseFloat(h.ToString("0.00")),g=this.dtpFromDate.Date;g<=this.dtpToDate.Date;)o=this.dgv.NewRow(),o.SNo=this.dgv.Table.length+1,o.Month=g.ToString("dd MMM yyyy"),o.Amount=g.ToString("dd MMM yyyy")==this.dtpToDate.Date.ToString("dd MMM yyyy")?parseFloat(this.lTDSAmount)-C:h,this.dgv.addRow(o),C+=parseFloat(o.Amount),g=g.AddMonths(1);this.dgv.Columns[2].footer=C.ToString("0.00"),this.dgv.UpdateFooter()}Post_Click(){try{if(Logger.InfoLog("TDSPostingViewModel::Entering Post_Click()"),0==this.dgv.Table.length)return this.DisplayMessage="No Data to Post",void(this.MessageVisibility=!0);if(this.ValidatePosting()){let r,a="",l=0,t="0",i="0",o=d.d.common.GetScreenInfo(40068);r=o.Tables[0].filter(p=>"CreditAccount"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(t=r[0].UserDefaultValue.toString()),r=o.Tables[0].filter(p=>"DebitAccount"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(i=r[0].UserDefaultValue.toString()),r=o.Tables[0].filter(p=>"ProductID"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(l=parseInt(r[0].UserDefaultValue));let h=d.d.common.GetDataSet3("PAY123",this.Parent.Employee.SelectedValue,this.iComponentID.ToString(),this.iComponentID.ToString()),C="",g="",D=0;for(let p=0;p<this.dgv.Table.length;p++)if(C="",D=0,null!=this.dgv.Table[p].Amount&&null!=this.dgv.Table[p].Amount&&""!=this.dgv.Table[p].Amount.toString()&&null!=this.dgv.Table[p].Month&&null!=this.dgv.Table[p].Month&&""!=this.dgv.Table[p].Month.toString()){if(null!=h&&h.Tables.length>0){let e=h.Tables[0].filter(T=>new Date(T.dcAlpha2).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy")||new Date(T.dcAlpha4).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy"));null!=e&&e.length>0&&(g=e[0].InvDocDetailsID.toString(),D=parseInt(e[0].DocID))}C=g.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="Desktop" DetailIds="'+g+'"> </XML>':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="Desktop" > </XML>',a+="<ROWS>",a+="<DocumentXML>",a+=this.GetRecXML(new Date(this.dgv.Table[p].Month),new Date(this.dgv.Table[p].Month),parseFloat(this.dgv.Table[p].Amount),l,t,i,g),a+="</DocumentXML>",a+="<ActivityXML>",a+=C,a+="</ActivityXML>",a+="<DOCIDXML>",a+='<XML DOCID="'+D+'"></XML>',a+="</DOCIDXML>",a+="</ROWS>"}if(a.length>0&&a.length>0){a="<REC>"+a,a+="</REC>";let p=[];p.push(a.toString()),p.push(d.d.SessionManager.GetSysInfo()),p.push("Desktop"),p.push(d.d.SessionManager.UserID),p.push(d.d.SessionManager.LanguageID);let e=d.d.empService.ExecuteQuery_SP(p,"spPAY_PostTDSDoc");return null!=e&&e.Tables.length>0&&e.Tables[e.Tables.length-1].length>0&&e.Columns[e.Tables.length-1].Contains("ErrorMessage")?(this.DisplayMessage=e.Tables[e.Tables.length-1][0].ErrorMessage.toString(),void(this.MessageVisibility=!0)):(this.DisplayMessage="Problem in processing your request,Please contact administrator.",void(this.MessageVisibility=!0))}}Logger.InfoLog("TDSPostingViewModel::Exiting Post_Click()")}catch(a){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION btnPost_Click()\r\n"+a.stack)}}ValidatePosting(){try{return Logger.InfoLog("TDSPostingViewModel::Entering ValidatePosting()"),parseFloat(this.dgv.Columns[2].footer)!=parseFloat(this.lTDSAmount)?(this.DisplayMessage="TDS Amount not Equal",this.MessageVisibility=!0,!1):this.iComponentID<=0?(this.DisplayMessage="TDS Component Should be Monthly Type",this.MessageVisibility=!0,!1):(Logger.InfoLog("TDSPostingViewModel::Exiting ValidatePosting()"),!0)}catch(a){return Logger.ErrorLog("TDSPostingViewModel::EXCEPTION ValidatePosting()\r\n"+a.stack),!1}}dgv_EndEdit(a,l,t){try{Logger.InfoLog("TDSPostingViewModel::Entering dgv_EndEdit()");let i=0;if(this.dgv.Table.length>0){for(let o=0;o<this.dgv.Table.length;o++)null!=this.dgv.Table[o].Amount&&null!=this.dgv.Table[o].Amount&&""!=this.dgv.Table[o].Amount.toString()&&(i+=parseFloat(this.dgv.Table[o].Amount));this.dgv.Columns[2].footer=i.ToString("0.00"),this.dgv.UpdateFooter()}Logger.InfoLog("TDSPostingViewModel::Exiting dgv_EndEdit()")}catch(i){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION dgv_EndEdit()\r\n"+i.stack)}}GetRecXML(a,l,t,i,o,r,h){let C="",g="",D="",p="",e="",T="";return D+='<Alpha Query="',D+=" dcAlpha1=3,dcAlpha2='"+a.ToString("dd MMM yyyy")+"',dcAlpha3="+this.iComponentID+",dcAlpha4='"+l.ToString("dd MMM yyyy")+"', ",D+='" ></Alpha>',T="",e+='<CostCenters Query="',T+=" dcCCNID51="+this.Parent.Employee.SelectedValue+",",T.length>0&&(e+=T),e+='" ></CostCenters>',g+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',g+='" ProductID="'+i+'" Quantity="0',g+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',g+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',g+='" StockValue="0" StockValueFC="0" RefNO="',g+='" BillDate="'+(new Date).ToString("dd/MMM/yyyy"),g+='" CurrencyID="1" ExchangeRate="1',g+='" DebitAccount="'+o+'" CreditAccount="'+r,g+='" CommonNarration="'+c.J0.EncodeXML(""),p+='<Numeric Query="',p+="dcNum1="+t+", dcCalcNum1="+t,p+='" ></Numeric>',C+="<Row>",C+="<AccountsXML></AccountsXML>",C+='<Transactions DocSeqNo="1',C+='" LinkedInvDocDetailsID="0" LinkedFieldName="',C+='" LineNarration="'+c.J0.EncodeXML(""),C+=g.toString()+'" ></Transactions>',C+=D.toString(),C+=p.toString(),C+=e.toString(),C+="<EXTRAXML></EXTRAXML>",C+="</Row>",C.toString()}}let Y=(()=>{class G{constructor(){this.form=new v.gE({}),this.lblTotalTaxAmount="TOTAL INCOME TAX PAYABLE : ",this.lblTDSPaidAmount="TDS Paid : ",this.lblTDSAmount="Payable TDS Amount : "}ngOnInit(){}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-tds-posting"]],inputs:{obj:"obj"},decls:72,vars:21,consts:[[1,"master-screen",2,"padding-bottom","4px","width","700px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row"],["FieldDirective","",3,"obj","group"],[2,"margin-left","12px"],[1,"form-group",2,"margin-left","12px"],[1,"primary-btn-wicon",3,"click"],[2,"padding-top","5px"],[2,"font-weight","bold","margin-left","10px"],[2,"padding-top","5px","margin-left","25px"],[1,"documentgrid","row","form-row",2,"width","100%","margin-top","5px"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"secondary-btn-wicon",3,"click"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"div"),s.EFF(7,"\n            "),s.eu8(8,3),s.EFF(9,"\n        "),s.k0s(),s.EFF(10,"\n        "),s.j41(11,"div",4),s.EFF(12,"\n            "),s.eu8(13,3),s.EFF(14,"\n        "),s.k0s(),s.EFF(15,"\n        "),s.j41(16,"div",5),s.EFF(17,"\n            "),s.j41(18,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Generate")}),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n          "),s.k0s(),s.EFF(22,"\n        "),s.k0s(),s.EFF(23,"\n        "),s.j41(24,"div",2),s.EFF(25,"\n            "),s.j41(26,"div",7),s.EFF(27,"\n                "),s.j41(28,"label"),s.EFF(29),s.k0s(),s.j41(30,"label",8),s.EFF(31),s.k0s(),s.EFF(32,"\n            "),s.k0s(),s.EFF(33,"\n            "),s.j41(34,"div",9),s.EFF(35,"\n                "),s.j41(36,"label"),s.EFF(37),s.k0s(),s.j41(38,"label",8),s.EFF(39),s.k0s(),s.EFF(40,"\n            "),s.k0s(),s.EFF(41,"\n            "),s.j41(42,"div",9),s.EFF(43,"\n                "),s.j41(44,"label"),s.EFF(45),s.k0s(),s.j41(46,"label",8),s.EFF(47),s.k0s(),s.EFF(48,"\n            "),s.k0s(),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",10),s.EFF(52,"\n            "),s.nrm(53,"app-PactGridView",11),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n\n\n        "),s.j41(56,"div",12),s.EFF(57,"\n            "),s.j41(58,"div"),s.EFF(59,"\n                "),s.j41(60,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Post")}),s.EFF(61),s.nI1(62,"translate"),s.k0s(),s.EFF(63,"\n                "),s.j41(64,"button",13),s.bIt("click",function(){return i.obj.Button_Click("Cancel")}),s.EFF(65),s.nI1(66,"translate"),s.k0s(),s.EFF(67,"\n            "),s.k0s(),s.EFF(68,"\n        "),s.k0s(),s.EFF(69,"\n    "),s.k0s(),s.EFF(70,"\n"),s.k0s(),s.EFF(71,"\n")),2&t&&(s.R7$(8),s.Y8G("obj",i.obj.dtpFromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpToDate)("group",i.form),s.R7$(6),s.JRh(s.bMT(20,15,"Generate")),s.R7$(10),s.JRh(i.lblTotalTaxAmount),s.R7$(2),s.JRh(i.obj.lTotalTaxAmount),s.R7$(6),s.JRh(i.lblTDSPaidAmount),s.R7$(2),s.JRh(i.obj.lTDSPaidAmount),s.R7$(6),s.JRh(i.lblTDSAmount),s.R7$(2),s.JRh(i.obj.lTDSAmount),s.R7$(6),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(8),s.JRh(s.bMT(62,17,"Post")),s.R7$(4),s.JRh(s.bMT(66,19,"Close")))},dependencies:[Ye._,Qe.X,Xe.D9]})}return G})();class q extends tt.g{constructor(){super(...arguments),this.CostCenterID=0,this.MessageDisplay="",this.TypeID=0,this.Employee=new Dt.G(0),this.TDSPostVisiblility=!1,this.PrintVisiblility=!1,this.ExportVisiblility=!1,this.WorksheetVisiblility=!1,this.txtDesignation="",this.dtPayrollTaxCmptsObj=new He.vv,this.Savereturnvalue=0,this.dsITComputation=null,this.sbComputationData="",this.sbValidation="",this.dPayableTDSAmount=0,this.dTotalTaxAmount=0,this.dTDSPaidAmount=0,this.iCompnentID=0,this.objTDSVM=null}get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}IncomeTaxComputationViewModel(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new Gt.h,this.ScreenObject=new kt.a(0,0),this.ScreenObject.Data=[],this.TDSPostVisiblility=d.d.SessionManager.IsActionAssigned(264,"TDS Posting"),this.PrintVisiblility=d.d.SessionManager.IsActionAssigned(264,"Print"),this.ExportVisiblility=d.d.SessionManager.IsActionAssigned(264,"Export"),this.WorksheetVisiblility=d.d.SessionManager.IsActionAssigned(264,"WorkSheet"),this.EmpYear=new n.y$(0);for(let a=2e3;a<2100;a++){let l=n._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=c.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("yyyy"),this.lFinancialDate=this.GetFinancialYear(),this.EmpRegime=new n.y$(0),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("New","New")),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth,1),t=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(t.getMonth(),!1)+" "+t.getFullYear(),a}Employee_SelectedValueChanged(a){this.dsITComputation=d.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,d.d.SessionManager.AccountingFromMonth),this.GetResPerson()}GetResPerson(){this.lstResponsiblePerson=new R,this.txtDesignation="";let t,i,a=" 1=1 ",l="";if(d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn")&&""!=d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn").toString()&&d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOnXML")&&""!=d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML&&d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML.length>0){t=new c.VB,t.ReadXml(d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML),i=t.Tables[0];let r=d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOn.split(",");if(null!=r&&r.length>0)for(let h=0;h<r.length;h++)if(null!=r[h]&&""!=r[h]&&(l="CCNID"+(parseInt(r[h])-5e4),null!=this.dsITComputation&&this.dsITComputation.Tables.length>27&&this.dsITComputation.Tables[27].length>0)){let C=this.dsITComputation.Tables[27].filter(g=>g.NodeID=this.Employee.SelectedValue);null!=C&&C.length>0&&(a+=" AND ( dc"+l+"="+C[0][l]+" )",i=i.filter(g=>g["dc"+l]==C[0][l]))}}let o="";if(" 1=1 "!=a&&(o=i),null!=o&&o.length>0){this.lstResponsiblePerson.SelectedValue=o[0].ResponsiblePerson.toString();let r=d.d.common.GetDataSet("PAY070",this.lstResponsiblePerson.SelectedValue.toString());null!=r&&r.Tables[0].length>0&&(this.lstResponsiblePerson.Text=r.Tables[0][0].Name.toString(),this.lstResponsiblePerson.Tag=r.Tables[0][0].FHName.toString(),this.txtDesignation=r.Tables[0][0].Designation.toString())}}OnYearSelected(a){this.FilterEmployees(),this.dsITComputation=d.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,d.d.SessionManager.AccountingFromMonth),this.GetResPerson()}OnSaveITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():d.d.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+l.stack)}}OnDeleteITComputation(a){try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():d.d.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+l.stack)}}OnSaveRegimeITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveRegimeITComputation()"),this.sbValidation?(this.DisplayMessage=this.sbValidation.toString(),this.MessageVisibility=!0):null!=this.EmpRegime.SelectedValue?(d.d.common.GetDataSet3("PAY121",this.EmpRegime.SelectedValue,this.Employee.SelectedValue.toString(),this.EmpYear.SelectedValue),this.DisplayMessage="Updated Succesfully",this.MessageVisibility=!0):(this.DisplayMessage="Please select RegimeType",this.MessageVisibility=!0)}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveRegimeITComputation()"+l.stack)}}OnTDSPostITComputation(a){try{if(Logger.InfoLog("ITComputationViewModel::Entering OnTDSPostITComputation()"),!this.DisplayMessage){let l=[];l.push(this),l.push(this.dTotalTaxAmount),l.push(this.dTDSPaidAmount),l.push(this.dPayableTDSAmount),l.push(this.iCompnentID),this.objTDSVM=new O(l),d.d.page.ShowDialog(this.objTDSVM,Y,{ShowCenter:!0,Title:"TDS Posting"}).subscribe(()=>{})}Logger.InfoLog("ITComputationViewModel::Exiting OnTDSPostITComputation()")}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnTDSPostITComputation()"+l.stack)}}FilterEmployees(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");let l,t,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=new Date(d.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),d.d.SessionManager.IsRptManagerUser&&d.d.SessionManager.IsActionAssigned(264,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+d.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+a.stack)}}}class R{}var U=J(71336),k=J(78324),V=J(9524),$=J(38859),ee=J(35620);function re(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",27),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.PrintForm16_Click("PrintForm16"))}),s.nrm(1,"i",28),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Print")))}function z(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Export"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function Ae(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Worksheet"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"WorkSheet")))}function Pe(G,a){if(1&G){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("TDSPost"))}),s.nrm(1,"i",7),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&G&&(s.R7$(2),s.JRh(s.bMT(3,1,"TDSPost")))}let Oe=(()=>{class G{constructor(){this.form=new v.gE({}),this.prevSelectedEmp=0,this.iSelectedEmpSeqNo=0,this.prevSelectReperson=0,this.BasicIndex=-1,this.TotalSalaryIndex=0,this.Form12Section1Index=0,this.Form12Section2Index=0,this.Exemptionsunder10Index=0,this.HRA10BasicIndex=0,this.HRAAcutalIndex=0,this.HRAMetroNonMetroIndex=0,this.HRAExemptionIndex=0,this.TDSPaidIndex=0,this.NetTaxPayableIndex=0,this.InhandAmountIndex=0,this.MonthlyDeducIndex=0,this.intTotalIncometaxPayableindex=0,this.TotAmtOthExemptUs10Index=0,this.ConveyanceIndex=0,this.ChildrenEduIndex=0,this.StandardDedIndex=0,this.MedicalIndex=0,this.LTAIndex=0,this.LeaveEncashIndex=0,this.FoodIndex=0,this.GratuityIndex=0,this.BalanceSalInc12BAIndex=0,this.ProfessionalTaxIndex=0,this.NetTaxableSalIndex=0,this.GrossTotalIncomeIndex=0,this.IncomefromHousePropertyIndex=0,this.intDeducunder8oCto80CCCIndex=0,this.intTotalDeducunder8oCto80CCCIndex=0,this.intOtherDeducunder8oCto80CCCIndex=0,this.dblTotalIncomeIndex=0,this.dblTotalIncomeRoundoffIndex=0,this.intOtherDeducunder8oCto80CCCIndex1=0,this.dblTaxOnTotalIncomeIndex=0,this.dblRebateIndex=0,this.dblTaxPayableAfterRebateIndex=0,this.dblSurchargeIndex=0,this.dblTaxPayableIndex=0,this.dblEducationCessIndex=0,this.dblSecHighEduCessIndex=0,this.NewStandardDedIndex=0,this.NewRegimeStartIndex=0,this.intNewDeducunder8oCto80CCCIndex=0,this.intNewTotalDeducunder8oCto80CCCIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex1=0,this.dblNewTotalIncomeIndex=0,this.dblNewTotalIncomeRoundoffIndex=0,this.dblNewTaxOnTotalIncomeIndex=0,this.dblNewRebateIndex=0,this.dblNewTaxPayableAfterRebateIndex=0,this.dblNewSurchargeIndex=0,this.dblNewTaxPayableIndex=0,this.dblNewEducationCessIndex=0,this.dblNewSecHighEduCessIndex=0,this.intNewTotalIncometaxPayableindex=0,this.NewTDSPaidIndex=0,this.NewNetTaxPayableIndex=0,this.NewNetTaxableSalIndex=0,this.NewGrossTotalIncomeIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex=0,this.dblbalanceSalaryInc12BA=0,this.dblTotalCellSalary=0,this.dPerq1=0,this.dPerq2=0,this.HraMinValue=0,this.dblMedicalAmount=0,this.dblLTAAmount=0,this.dblLeaveEncashAmount=0,this.dblFoodAmount=0,this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=0,this.dblNetTaxableSal=0,this.dblGrossTotalIncome=0,this.dblTDS=0,this.dblNetTaxPayable=0,this.dblInhandAmount=0,this.dblSelfletoutamount=0,this.dblTotalIncome=0,this.dblTotalIncomeRoundoff=0,this.dblServiceDays=0,this.dblStandardDeduction=0,this.dblNewStandardDeduction=0,this.dblNewTotaldeduction80ccc80c=0,this.dblNewTotalIncome=0,this.dblNewTotalIncomeRoundoff=0,this.dblNewSelfletoutamount=0,this.dblNewGrossTotalIncome=0,this.dblNewNetTaxableSal=0,this.lstTaxSalbs=new Array,this.lstNewTaxSalbs=new Array,this.bIsNewRegime=!1,this.txtPlace=new Me.Dw,this.dvTaxSlabsData=[],this.dvLimitData=[],this.dtpDate=new M.Lc}ngOnInit(){this.obj=this.params.obj,this.grdIncomeTax=new k.j,this.grdIncomeTax.ItComput=!0,this.ITComputationViewModel=this.obj,this.BindGridColumns(),this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.EmpYear.SelectionChangedCommand.Subscribe(this,"cmbYear_SelectionChanged"),this.lstEmployee.SelectionChangedCommand.Subscribe(this,"lstEmployee_SelectionChanged"),this.dtpDate=new M.Lc,d.d.page.MaximizeTab(this.obj),this.MessageDisplay=""}set MessageDisplay(l){this.ITComputationViewModel.DisplayMessage=l}BindGridColumns(){try{let l=new $.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,t=new $.bA;t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=11,t.IsBold=!1,t.BackColor="White",t.ForeColor="#FF333333",i=new V.D_,i.HeaderText="SNo",i.width=10,i.HeaderAppearance=new $.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new V.D_,i.HeaderText="Header",i.width=20,i.HeaderAppearance=new $.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new V.D_,i.HeaderText="ComponentID",i.width=25,i.HeaderAppearance=new $.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new V.D_,i.HeaderText="Salary Breakup",i.width=220,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new V.D_,i.HeaderText="Investment & Bill Details",i.width=100,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i);let e,o=0,r=0,h=0,C=0,g=0,D=0,p=0;g=d.d.SessionManager.FinancialYearStartDate.getFullYear(),e=g.toString(),g=parseInt(e.substr(2,2)),D=g+1,o=d.d.SessionManager.AccountingFromMonth,C=o,p=1==C?12:15;for(let T=C;T<=p;T++)if(12==r){h=r-T;for(let P=1;P<=h;P++)i=new V.D_,i.HeaderText=this.GetMonthName(P,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),T+=1}else i=new V.D_,r=o,i.HeaderText=this.GetMonthName(T,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i);i=new V.D_,i.HeaderText="RegimeType",i.width=25,i.HeaderAppearance=new $.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new V.D_,i.HeaderText="Amount",i.width=100,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),this.grdIncomeTax.ReportColumns.forEach(T=>T.ID=c.J0.NewGuid())}catch(l){Logger.ErrorLog("Error : "+l),this.MessageDisplay=l.message}}get lstEmployee(){return this.ITComputationViewModel.Employee.Code}get lstEmployeeName(){return this.ITComputationViewModel.Employee.Name}get cmbYear(){return this.ITComputationViewModel.EmpYear}get cmbRegime(){return this.ITComputationViewModel.EmpRegime}clear(l){this.MessageDisplay="",this.prevSelectedEmp=0,this.prevSelectReperson=0,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary=this.dPerq1=this.dPerq2=this.HraMinValue=this.dblMedicalAmount=this.dblLTAAmount=this.dblLeaveEncashAmount=this.dblFoodAmount=this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=this.dblNetTaxableSal=this.dblGrossTotalIncome=this.dblTotalIncome=this.dblTotalIncomeRoundoff=this.dblServiceDays=this.dblTDS=this.dblNetTaxPayable=this.dblInhandAmount=0,this.dblStandardDeduction=0,this.cmbRegime.SelectedValue="",this.grdIncomeTax.Clear(),this.ITComputationViewModel.txtDesignation="",1==l&&(this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null,this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null)}btnSave_Click(l){if(null!=l)try{if("Clear"==l)this.clear(1);else if("Save"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i=0,o=0,r=0,h="";if(0==t.length){h+="<Rows>";for(let C=0;C<this.grdIncomeTax.Data.length;C++)null!=this.grdIncomeTax.Data[C].Cells[1].Value&&(h+='<row HeaderID="'+this.grdIncomeTax.Data[C].Cells[1].Value,parseFloat(this.grdIncomeTax.Data[C].Cells[2].Value)<0?h+='" HeaderName="'+this.grdIncomeTax.Data[C].Cells[3].Value:h+='" HeaderName="',h+='" ComponentID="'+this.grdIncomeTax.Data[C].Cells[2].Value,i=c.J0.Double(this.grdIncomeTax.Data[C].Cells[4].Value),h+=i>=0?'" ComponentAmount="'+i:'" ComponentAmount="-1',null!=this.grdIncomeTax.Data[C].Cells[17].Value?(r=c.J0.Int(this.grdIncomeTax.Data[C].Cells[17].Value),h+=r>=0?'" RegimeType="'+r:'" RegimeType="0'):h+='" RegimeType="0',o=c.J0.Double(this.grdIncomeTax.Data[C].Cells[17].Value),h+='" TotalAmount="'+o,h+='"/>');h+="</Rows>",this.ITComputationViewModel.sbComputationData=h,this.clear(1)}else h+=t,this.ITComputationViewModel.sbValidation=h;this.ITComputationViewModel.OnSaveITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("Delete"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?(this.ITComputationViewModel.sbComputationData=i,this.clear(1)):(i+=t,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnDeleteITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("Export"==l){let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?(this.ITComputationViewModel.sbComputationData=i,this.ExportToExcel()):(i+=t,this.ITComputationViewModel.sbValidation=i)}else if("Worksheet"==l){if(null==this.dtpDate.Date&&(this.dtpDate.Date=new Date),!(this.lstEmployee.SelectedValue>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);this.txtPlace.Text.Trim(),this.dtpDate.Date.ToString("dd/MMM/yyyy"),this.WorkSheetPrintGrid(),this.Form16export()}else if("SaveRegime"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?this.ITComputationViewModel.sbComputationData=i:(i+=t,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnSaveRegimeITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("TDSPost"==l)try{if(!(this.iSelectedEmpSeqNo>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation=this.dsTaxData.Tables[21],!(null!=this.dvEmpTaxComputation&&this.dvEmpTaxComputation.length>0))return this.ITComputationViewModel.DisplayMessage="Please Save Income Tax Computation",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation.RowFilter="",null==this.cmbRegime.SelectedValue)return this.ITComputationViewModel.DisplayMessage="Please Save Regime Opted For",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-122==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-122==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTotalTaxAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-123==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-123==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTDSPaidAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-124==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-124==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dPayableTDSAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),null!=this.dsTaxData&&this.dsTaxData.Tables.length>19&&this.dsTaxData.Tables[19].length>0){let t=this.dsTaxData.Tables[19].filter(i=>"TDS"==i.TaxmapName&&"Monthly"==i.FieldType);null!=t&&t.length>0&&(this.ITComputationViewModel.iCompnentID=parseInt(t[0].componentID))}this.ITComputationViewModel.OnTDSPostITComputation(l)}catch{}}catch(t){Logger.ErrorLog("Error : "+t),this.MessageDisplay=t.message}}WorkSheetPrintGrid(){this.grdPrint=new k.j,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let l=new $.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,t=new $.bA;t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=12,t.IsBold=!0,t.BackColor="White",t.ForeColor="#FF333333";for(let r=1;r<=10;r++)i=new V.D_,i.FieldName="Col"+r.toString(),i.width=70,i.HeaderText="Col"+r.toString(),i.HeaderAppearance=l,i.DataAppearance=t,this.grdPrint.ReportColumns.push(i);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=90,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=90,this.grdPrint.ReportColumns[6].width=80,this.grdPrint.ReportColumns[7].width=80,this.grdPrint.ReportColumns[8].width=80,this.grdPrint.ReportColumns[9].width=80;let o=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="WorkSheet\nEmployee Code : "+this.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+this.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+this.dtFromMonth.getFullYear()+" - "+this.dtToMonth.getFullYear()+", Assessment Year : "+this.dtFromMonth.AddYears(1).getFullYear()+" - "+this.dtToMonth.AddYears(1).getFullYear(),this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=10,o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="Salary Breakup",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value="Investment & Bill Details",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[5].ColSpan=1,this.grdPrint.Data[o].Cells[6].Value="Post Past",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value="Actual",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value="Projection",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[8].ColSpan=1,this.grdPrint.Data[o].Cells[9].Value="Amount",this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[9].ColSpan=1;for(let r=0;r<this.grdIncomeTax.Data.length;r++){let h;o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value=null!=this.grdIncomeTax.Data[r].Cells[3].Value&&""!=this.grdIncomeTax.Data[r].Cells[3].Value.toString()?this.grdIncomeTax.Data[r].Cells[3].Value:"",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value=null!=this.grdIncomeTax.Data[r].Cells[4].Value&&""!=this.grdIncomeTax.Data[r].Cells[4].Value.toString()&&c.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[4].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[4].Value).toString():"",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[5].ColSpan=1;let C=0,g=0,D=0;for(let p=5;p<this.grdIncomeTax.ReportColumns.length;p++)null!=this.grdIncomeTax.ReportColumns[p].Tag&&null!=this.grdIncomeTax.ReportColumns[p].Tag&&""!=this.grdIncomeTax.ReportColumns[p].Tag.toString()&&("Past"==this.grdIncomeTax.ReportColumns[p].Tag?(h=c.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString()),C+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&c.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0):"Processed"==this.grdIncomeTax.ReportColumns[p].Tag?g+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&c.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0:"Future"==this.grdIncomeTax.ReportColumns[p].Tag&&(D+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&c.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0));this.grdPrint.Data[o].Cells[6].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?C.toString():"",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?g.toString():"",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?D.toString():"",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[8].ColSpan=1,15!=r&&41!=r&&(this.grdPrint.Data[o].Cells[9].Value=null!=this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00"),this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[9].ColSpan=1}}ExportToExcel(){this.export()}export(){var l=this;return(0,ie.A)(function*(){let t="Income Tax Computation\nEmployee Code : "+l.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+l.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+l.dtFromMonth.getFullYear()+" - "+l.dtToMonth.getFullYear()+", Assessment Year : "+(l.dtFromMonth.getFullYear()+1)+" - "+(l.dtToMonth.getFullYear()+1),i=l.generatePrintContent(l.grdIncomeTax,t,!0);const o=new Blob([i],{type:"text/plain;charser=utf-8"});(0,It.saveAs)(o,"ITFile.xls")})()}Form16export(){var l=this;return(0,ie.A)(function*(){let t=l.generatePrintContent(l.grdPrint,"",!1,!0);const i=new Blob([t],{type:"text/plain;charser=utf-8"});(0,It.saveAs)(i,"TAX_PLACE_DATE_Form.xls")})()}getExcelColumnName(l){let o,t=l+1,i="";for(;t>0;)o=(t-1)%26,i=String.fromCharCode(65+o)+i,t=Math.floor((t-o)/26);return i}GetExportHTML(l){Logger.InfoLog("PostedDocumentViewModel:: inside GetExportHTML ");let t="",i="";t+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",i+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",i+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",i+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",i+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",t+="<style>"+i.toString()+"</style>";let h,r=0;for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)r+=this.grdIncomeTax.ReportColumns[C].width;t+="<table>",t+="\r\n<tr><td align='center'><h2>",t+=d.d.SessionManager.CompanyName,t+="</h2></td></tr>",t+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",t+=l,t+="</h3></td></tr>",t+="\r\n<tr><td align='center'>",t+=" From :  "+this.dtFromMonth.ToString(d.d.SessionManager.Preferences["Date Format"]),t+=" &nbs;&nbsp;&nbsp;To :  "+this.dtToMonth.ToString(d.d.SessionManager.Preferences["Date Format"]),t+="</td></tr>",t+="<tr><td style='padding-top:10p;'><table border=1 width='"+r+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",t+="<COLGROUP>";for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)c.J0.IsEmpty(this.grdIncomeTax.ReportColumns[C].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[C].ColumnType?t+="<COL style=''>":t+="<COL style='text-align:righ;'>";t+="</COLGROUP>",t+="<tr style=''>";for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)t+="<th class='hdr' width='"+this.grdIncomeTax.ReportColumns[C].width,t+="' >",t+=this.grdIncomeTax.ReportColumns[C].HeaderText,t+="</th>";t+="</tr>";for(let C=0;C<this.grdIncomeTax.Data.length;C++){t+="<tr",C%2==1&&(t+=" class=alt"),t+=">";for(let g=0;g<this.grdIncomeTax.ReportColumns.length;g++)t+="<td",c.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[g].ColumnType?t+=" align='left'":t+=" align='right'",t+=">",c.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType),h=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[g]),this.grdIncomeTax.ReportColumns.Contains(h)&&(t+=c.J0.String(this.grdIncomeTax.Data[C].Cells[h].Text)),t+="</td>";t+="</tr>"}return t+="</table>",t+="</td></tr></table>",t+="</body><html>",Logger.InfoLog("PostedDocumentViewModel:: exiting GetExportHTML "),t}ValidateData(){let l="";return null==this.lstEmployee.SelectedValue&&(l="Please select the Employee."),l}GetMonthName(l,t){l>12&&(l-=12);let i="";switch(l){case 1:i=t?"January":"Jan";break;case 2:i=t?"February":"Feb";break;case 3:i=t?"March":"Mar";break;case 4:i=t?"April":"Apr";break;case 5:i="May";break;case 6:i=t?"June":"Jun";break;case 7:i=t?"July":"Jul";break;case 8:i=t?"August":"Aug";break;case 9:i=t?"September":"Sep";break;case 10:i=t?"October":"Oct";break;case 11:i=t?"November":"Nov";break;case 12:i=t?"December":"Dec"}return i}lstEmployee_SelectionChanged(l){this.lstEmployee.SelectedValue!=this.prevSelectedEmp&&(this.lstEmployeeName.SelectedValue=this.lstEmployee.SelectedValue,this.clear(0),this.prevSelectedEmp=this.lstEmployee.SelectedValue,this.iSelectedEmpSeqNo=this.lstEmployee.SelectedValue,this.ITComputationViewModel.Employee_SelectedValueChanged(l),this.FillDetails())}grdIncomeTax_CellEndEdit(l){if(4==l.ColumnIndex){let t=0;try{t=parseFloat(this.grdIncomeTax.Data[l.RowIndex][l.ColumnIndex]),t<0&&(t=0)}catch{}if(l.RowIndex==this.IncomefromHousePropertyIndex||l.RowIndex==this.IncomefromHousePropertyIndex+1||l.RowIndex==this.IncomefromHousePropertyIndex+2||l.RowIndex==this.IncomefromHousePropertyIndex+3||l.RowIndex==this.IncomefromHousePropertyIndex+4)return;l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<this.intTotalDeducunder8oCto80CCCIndex||(this.grdIncomeTax.Data[l.RowIndex][this.grdIncomeTax.ReportColumns.length-1]=c.J0.GetAmount(t)),this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+parseFloat(this.grdIncomeTax.Data[this.ConveyanceIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.ChildrenEduIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.MedicalIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LTAIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LeaveEncashIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.FoodIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.GratuityIndex][4].Value)+this.dblStandardDeduction),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblbalanceSalaryInc12BA),t=parseFloat(this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.NetTaxableSalIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(t),this.dblGrossTotalIncome=0,this.dblGrossTotalIncome=t+this.dblSelfletoutamount-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblGrossTotalIncome);let i=0,o=0;if(this.dvLimit=this.dvLimitData.filter(C=>995==C.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(o=parseFloat(this.dvLimit[0].AmountLimit)),l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<=this.intTotalDeducunder8oCto80CCCIndex){let C=0;for(let g=this.intDeducunder8oCto80CCCIndex+1;g<this.intTotalDeducunder8oCto80CCCIndex;g++)this.dvLimit=this.dvLimitData.filter(D=>D.ComponentID==parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)),this.dvLimit.length>0&&(i=c.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value=c.J0.GetAmount(i),this.grdIncomeTax.Data[g].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(i))),C+=parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][4].Value=c.J0.GetAmount(C),C>o&&(C=o),this.dblTotaldeduction80ccc80c=C,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTotaldeduction80ccc80c)}let h=0;for(let C=this.intOtherDeducunder8oCto80CCCIndex;C<=this.intOtherDeducunder8oCto80CCCIndex1;C++)this.dvLimit=this.dvLimitData.filter(g=>g.ComponentID==parseInt(this.grdIncomeTax.Data[C].Cells[2].Value)),this.dvLimit.length>0&&(i=c.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[C].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value=c.J0.GetAmount(i),this.grdIncomeTax.Data[C].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(i))),h+=parseFloat(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.dblTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Math.round(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h)),this.UpdateTotals(parseFloat(this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value))}}UpdateTotals(l){let t=0;for(let p=0;p<this.lstTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstTaxSalbs[p].ToSlab){t+=l*this.lstTaxSalbs[p].Percentage;break}t+=this.lstTaxSalbs[p].ToSlab*this.lstTaxSalbs[p].Percentage}else{if(l<this.lstTaxSalbs[p].ToSlab){t+=(l-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage;break}t+=(this.lstTaxSalbs[p].ToSlab-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Math.round(t));let i=0,o=0;o=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?l<=5e5&&(i=2e3):2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=5e5&&(i=5e3):2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=35e4&&(i=2500):parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&l<=5e5&&(i=12500)),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,t=0):(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(o-i),t=o-i);let C,r=0,h=null,g=new Fe.bT;if(this.dsTaxData.Tables[7].length>0){let p;C=new U.Nl("Basic",""),g.push("Basic",C),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),C=new U.Nl("TotalIncome",""),g.push("TotalIncome",C),g.TotalIncome.setFieldValue(this.dblTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let T=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(P=>1==P.Type&&"OverTime"!=P.FieldType),h.length>0)for(let P=0;P<h.length;P++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[P].ComponentID),null!=p&&p.length>0&&(C=new U.Nl(h[P].ComponentName.toString(),""),g.push(h[P].ComponentName.toString(),C),g[h[P].ComponentName.toString()].setFieldValue(T[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(P=>2==P.Type&&"OverTime"!=P.FieldType),h.length>0)for(let P=0;P<h.length;P++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[P].ComponentID),null!=p&&p.length>0&&(C=new U.Nl(h[P].ComponentName.toString(),""),g.push(h[P].ComponentName.toString(),C),g[h[P].ComponentName.toString()].setFieldValue(T[0]["Deduction"+p[0].SNo.toString()].toString()))}let D=g;this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvTaxSlabs[0].Surcharge.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].Surcharge.toString(),D))),this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].Value="Surcharge @ "+r+"%",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=t*r/100)>0?c.J0.GetAmount(Math.round(l)):0,t+=Math.round(l),this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?c.J0.GetAmount(t):0,r=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].EducationCess&&null!=this.dvTaxSlabs[0].EducationCess&&""!=this.dvTaxSlabs[0].EducationCess.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].EducationCess.toString(),D))),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].Value="Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?c.J0.GetAmount(Math.round(l)):0,r=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].SecondaryandHighEduc.toString(),D))),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?c.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?c.J0.GetAmount(Math.round(t)):0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}UpdateTotalsNewRegime(l){let t=0;for(let p=0;p<this.lstNewTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstNewTaxSalbs[p].ToSlab){t+=l*this.lstNewTaxSalbs[p].Percentage;break}t+=this.lstNewTaxSalbs[p].ToSlab*this.lstNewTaxSalbs[p].Percentage}else{if(l<this.lstNewTaxSalbs[p].ToSlab){t+=(l-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage;break}t+=(this.lstNewTaxSalbs[p].ToSlab-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Math.round(t));let i=0,o=0;o=parseFloat(this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&parseInt(this.cmbYear.SelectedValue)>=2023&&l<=7e5&&(i=25e3),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,t=0):(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(o-i),t=o-i);let C,r=0,h=null,g=new Fe.bT;if(this.dsTaxData.Tables[7].length>0){let p;C=new U.Nl("Basic",""),g.push("Basic",C),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),C=new U.Nl("TotalIncome",""),g.push("TotalIncome",C),g.TotalIncome.setFieldValue(this.dblNewTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let e=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(T=>1==T.Type&&"OverTime"!=T.FieldType),h.length>0)for(let T=0;T<h.length;T++)p=this.dsTaxData.Tables[8].filter(P=>P.ComponentID==h[T].ComponentID),null!=p&&p.length>0&&(C=new U.Nl(h[T].ComponentName.toString(),""),g.push(h[T].ComponentName.toString(),C),g[h[T].ComponentName.toString()].setFieldValue(e[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(T=>2==T.Type&&"OverTime"!=T.FieldType),h.length>0)for(let T=0;T<h.length;T++)p=this.dsTaxData.Tables[8].filter(P=>P.ComponentID==h[T].ComponentID),null!=p&&p.length>0&&(C=new U.Nl(h[T].ComponentName.toString(),""),g.push(h[T].ComponentName.toString(),C),g[h[T].ComponentName.toString()].setFieldValue(e[0]["Deduction"+p[0].SNo.toString()].toString()))}let D=g;this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].Surcharge&&""!=this.dvNewTaxSlabs[0].Surcharge.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].Surcharge.toString(),D))),this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].Value="Surcharge @ "+r+"%",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=t*r/100)>0?c.J0.GetAmount(Math.round(l)):0,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?c.J0.GetAmount(t):0,r=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].EducationCess&&""!=this.dvNewTaxSlabs[0].EducationCess.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].EducationCess.toString(),D))),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].Value="Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?c.J0.GetAmount(Math.round(l)):0,r=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString(),D))),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?c.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?c.J0.GetAmount(Math.round(t)):0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}FillDetails(){try{let l=0,t=0,i=0,o=(new Date).OnlyDate(),r="";this.dsTaxData=this.ITComputationViewModel.dsITComputation;let h=this.dsTaxData.Tables[0],C=this.dsTaxData.Tables[22],g=this.dsTaxData.Tables[1],D=this.dsTaxData.Tables[2],p=this.dsTaxData.Tables[2];p=this.dsTaxData.Tables[2].filter(S=>"1"==S.ComponentType);let e=this.dsTaxData.Tables[3],T=this.dsTaxData.Tables[18];this.dvTaxSlabsData=this.dsTaxData.Tables[7],this.dvTaxSlabs=this.dsTaxData.Tables[7];let P=this.dsTaxData.Tables[15].filter(S=>"Old"==S.Regime);null!=P&&P.length>0&&(this.dvLimit=P,this.dvLimitData=this.dvLimit);let A=this.dsTaxData.Tables[15].filter(S=>"New"==S.Regime);null!=A&&A.length>0&&(this.dvNewLimit=A);let _=this.dsTaxData.Tables[7].filter(S=>"New"==S.RegimeType);if(null!=_&&_.length>0&&parseInt(this.cmbYear.SelectedValue)>=2020&&(!c.J0.IsEmpty(this.dvNewLimit)&&this.dvNewLimit.length>0?this.bIsNewRegime=!0:r+="Income tax amount limit data not avalilable for the selected year in New Regime"),this.dvEmpTaxComputation=this.dsTaxData.Tables[21],h.length>0&&(h=this.dsTaxData.Tables[0].filter(S=>"IT_BASIC"==S.MapFieldName),0==h.length&&(r+="Basic component is not available,Please map component in the payroll strucuture\r\n")),0==e.length&&(r+="Employee Payroll information not available\r\n"),!c.J0.IsEmpty(this.dvLimit)&&0==this.dvLimit.length&&(r+="Income tax amount limit data not avalilable for the selected year"),""!=r.toString())return this.MessageDisplay=r,this.ITComputationViewModel.MessageDisplay=r,void(this.ITComputationViewModel.MessageVisibility=!0);this.dsTaxData.Tables.length>26&&this.dsTaxData.Tables[26].length>0&&this.dsTaxData.Columns[26].Contains("RegimeType")&&null!=this.dsTaxData.Tables[26][0].RegimeType&&null!=this.dsTaxData.Tables[26][0].RegimeType&&""!=this.dsTaxData.Tables[26][0].RegimeType.toString()&&(this.cmbRegime.SelectedValue=this.dsTaxData.Tables[26][0].RegimeType.toString()),this.dblServiceDays=0,this.dtDateofJoining=c.J0.ParseDate(T[0].CDOJ),this.dtFromMonth=new Date(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),this.dtToMonth=this.dtFromMonth.AddYears(1).AddDays(-1),this.dblServiceDays=o.Subtract(this.dtDateofJoining).Days+1;let x=0,F=0,j=0,E={iY:x,iM:F,iD:j};c.J0.GetYearsMonthsDays(c.J0.ParseDate(T[0].CDOB),this.dtToMonth.OnlyDate(),E),x=E.iY,F=E.iM,j=E.iD,this.dvTaxSlabs=this.dvTaxSlabsData.filter(x>=80?S=>"SuperSeniorCitizen"==S.Gender&&"Old"==S.RegimeType:x>=60?S=>"SeniorCitizen"==S.Gender&&"Old"==S.RegimeType:S=>S.Gender==c.J0.String(T[0].GenderName)&&"Old"==S.RegimeType),this.lstTaxSalbs.Clear();for(let S=0;S<this.dvTaxSlabs.length;S++)this.lstTaxSalbs.push(new Ve),this.lstTaxSalbs[S].FromSlab=parseFloat(this.dvTaxSlabs[S].Fromslab),this.lstTaxSalbs[S].ToSlab=parseFloat(this.dvTaxSlabs[S].Toslab),this.lstTaxSalbs[S].Percentage=parseFloat(this.dvTaxSlabs[S].Percentage)/100;i=17,t=5;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==c.J0.StringValue(C[0].Month)&&(t=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S])),!c.J0.IsEmpty(C[0].RelieveMonth)&&this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==c.J0.StringValue(C[0].RelieveMonth)&&(i=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S]));let b=0,N=0;this.dsTaxData.Tables[0].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[0].length);let W,te=0,Q=0;for(let S=0;S<this.dsTaxData.Tables[0].length;S++){if(W=new Array,b=5,te=0,Q=0,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=this.dsTaxData.Tables[0][S].SNo,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[0][S].componentID,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[0][S].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance=new $.bA,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=2,null!=this.dsTaxData.Tables[0][S].MapFieldName&&null!=this.dsTaxData.Tables[0][S].MapFieldName&&"IT_BASIC"==this.dsTaxData.Tables[0][S].MapFieldName.toString().Trim()&&(this.BasicIndex=S),parseInt(this.dsTaxData.Tables[0][S].SNo)>0){for(let X=0;X<g.length;X++)for(let B=5;B<this.grdIncomeTax.ReportColumns.length;B++)if(!W.Contains(this.grdIncomeTax.ReportColumns[B].HeaderText)&&g[X].month.toString()==this.grdIncomeTax.ReportColumns[B].HeaderText.toString()){this.grdIncomeTax.ReportColumns[B].Tag="Processed",W.push(this.grdIncomeTax.ReportColumns[B].HeaderText),l=0,c.J0.IsEmpty(g[X]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])||(l=parseFloat(g[X]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])),this.grdIncomeTax.Data[S].Cells[B].Value=l>0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[B].IsNormal=!1,Q=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].Value=c.J0.GetAmount(Q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.IsBold=!0,te+=l;break}for(let X=0;X<p.length;X++)for(let B=5;B<this.grdIncomeTax.ReportColumns.length;B++)if(parseInt(this.dsTaxData.Tables[0][S].componentID)==parseInt(p[X].componentid)&&p[X].FieldName.toString()==this.grdIncomeTax.ReportColumns[B].HeaderText.toString()&&!c.J0.IsEmpty(p[X].Amount)&&parseFloat(p[X].Amount)>0&&!W.Contains(this.grdIncomeTax.ReportColumns[B].HeaderText)){W.push(this.grdIncomeTax.ReportColumns[B].HeaderText),l=0,c.J0.IsEmpty(p[X].Amount)||(l=parseFloat(p[X].Amount)),this.grdIncomeTax.Data[S].Cells[B].Value=l>0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[B].IsNormal=!1,Q=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].Value=c.J0.GetAmount(Q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[B].CellAppearance.IsBold=!0,te+=l;break}if(0==e.length)return;for(let X=0;X<e.length;X++)for(b=t;b<i;b++)!W.Contains(this.grdIncomeTax.ReportColumns[b].HeaderText)&&c.J0.IntegerValue(this.grdIncomeTax.Data[S].Cells[b].Value)<=0&&(this.grdIncomeTax.ReportColumns[b].Tag="Future",W.push(this.grdIncomeTax.ReportColumns[b].HeaderText),l=parseFloat(e[X]["Earning"+this.dsTaxData.Tables[0][S].SNo.toString()]),this.grdIncomeTax.Data[S].Cells[b].Value=l>0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[b].IsNormal=!1,Q=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].Value=c.J0.GetAmount(Q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.IsBold=!0,te+=l)}b=this.grdIncomeTax.ReportColumns.length-1,this.dblTotalCellSalary=this.dblTotalCellSalary+te,parseInt(this.dsTaxData.Tables[0][S].SNo)>0?(this.grdIncomeTax.Data[S].Cells[b].Value=c.J0.GetAmount(te),this.grdIncomeTax.Data[S].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[b].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[b].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[b].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[b].CellAppearance.ForeColor="#0bd10b"):(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTotalCellSalary),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].IsNormal=!1,this.TotalSalaryIndex=this.dsTaxData.Tables[0].length-1,this.grdIncomeTax.Data[S].Cells[1].Value=this.TotalSalaryIndex,N=this.TotalSalaryIndex)}if(N++,this.Form12Section1Index=this.TotalSalaryIndex+1,this.Form12Section2Index=this.TotalSalaryIndex+2,this.grdIncomeTax.addEmptyRowsWithCellApperance(2),this.dsTaxData.Tables[4].length>0){let S=0;for(let X=0;X<this.dsTaxData.Tables[4].length;X++)S=N+X,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=0,this.grdIncomeTax.Data[S].Cells[1].Value=S+1,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[4][X].componentid,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[4][X].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=14,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.IsBold=!0,-1==parseInt(this.dsTaxData.Tables[4][X].FieldType)&&(this.dPerq1=parseFloat(this.dsTaxData.Tables[4][X].Amount)),-2==parseInt(this.dsTaxData.Tables[4][X].FieldType)&&(this.dPerq2=parseFloat(this.dsTaxData.Tables[4][X].Amount)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(parseFloat(this.dsTaxData.Tables[4][X].AMOUNT)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b"}let w=0,ne=0,ce=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.Exemptionsunder10Index=this.Form12Section2Index+1,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[1].Value=this.Exemptionsunder10Index,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[2].Value=-101,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].Value="Less : Exemptions Under 10 ",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].ColSpan=15,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.IsBold=!0,this.dsTaxData.Tables[5].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(1),N=this.HRA10BasicIndex=this.Exemptionsunder10Index+1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[1].Value=this.HRA10BasicIndex,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].Value="Actual Rent Paid - 10% of Basic ",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].ColSpan=2;let Ce=0,ve=0,L=this.dsTaxData.Tables[13];if(L.length>0){for(let S=0;S<L.length;S++)for(let X=5;X<this.grdIncomeTax.ReportColumns.length;X++)if(L[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()){l=0,c.J0.IsEmpty(L[S].AMOUNT)||(l=parseFloat(L[S].AMOUNT)),l>0?(ve=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.BasicIndex].Cells[X].Value),l-=10*ve/100,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[X].Value=c.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[X].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[X].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[X].IsNormal=!1,Ce+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].Value=c.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].IsNormal=!1;if(w=Ce,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Ce),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAAcutalIndex=this.HRA10BasicIndex+1,Ce=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[1].Value=this.HRAAcutalIndex,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[2].Value=this.dsTaxData.Tables[6][0].componentid.toString(),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].Value="Actual Received ",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].ColSpan=2,this.dsTaxData.Tables[6].length>0){for(b=5;b<17;b++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].Value=c.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].CellAppearance.Alignment="Right";b=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[6][0].componentid))for(b=5;b<i;b++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].Value=c.J0.GetAmount(c.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[b].Value)),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].CellAppearance.Alignment="Right",Ce+=c.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[b].Value)}ne=Ce,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Ce),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1;let Ge=0,Se=0;if(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dsTaxData.Tables[7].length>0){Ce=0;let X,xe,S=null,B=new Fe.bT;X=new U.Nl("Basic",""),B.push("Basic",X),B.Basic.setFieldValue(c.J0.DoubleTryParse(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),S=this.dsTaxData.Tables[8].filter(Te=>1==Te.Type&&"OverTime"!=Te.FieldType);let ae=this.dsTaxData.Tables[3];if(S.length>0)for(let Te=0;Te<S.length;Te++)xe=this.dsTaxData.Tables[8].filter(Je=>Je.ComponentID==S[Te].ComponentID),null!=xe&&xe.length>0&&(X=new U.Nl(S[Te].ComponentName.toString(),""),B.push(S[Te].ComponentName.toString(),X),B[S[Te].ComponentName.toString()].setFieldValue(ae[0]["Earning"+xe[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[8].filter(Te=>2==Te.Type&&"OverTime"!=Te.FieldType),S.length>0)for(let Te=0;Te<S.length;Te++)xe=this.dsTaxData.Tables[8].filter(Je=>Je.ComponentID==S[Te].ComponentID),null!=xe&&xe.length>0&&(X=new U.Nl(S[Te].ComponentName.toString(),""),B.push(S[Te].ComponentName.toString(),X),B[S[Te].ComponentName.toString()].setFieldValue(ae[0]["Deduction"+xe[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[7],S.length>0){let Te=B;Ge=parseFloat(d.d.eval.EvaluateExpression(S[0].MetroFormula.toString(),Te)),Se=parseFloat(d.d.eval.EvaluateExpression(S[0].NonmetroFormula.toString(),Te))}}this.HRAMetroNonMetroIndex=this.HRAAcutalIndex+1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[1].Value=this.HRAMetroNonMetroIndex,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[2].Value=-102,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].Value="Metro/Non-Metro ",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].ColSpan=2;let ge="";if(L.length>0){for(let S=0;S<L.length;S++)for(let X=5;X<this.grdIncomeTax.ReportColumns.length;X++)if(L[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()){ge=L[S].METRO.toString(),"Yes"==ge?(l=Ge,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[X].Value=c.J0.GetAmount(l)):"No"==ge.TrimEnd(" ")?(l=Se,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[X].Value=c.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[X].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[X].CellAppearance.Alignment="Right",Ce+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].Value=c.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].CellAppearance.Alignment="Right";ce=Ce,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Ce),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAExemptionIndex=this.HRAMetroNonMetroIndex+1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[1].Value=this.HRAExemptionIndex,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[2].Value=-103,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].Value="HRA Exemption ",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.IsBold=!0,this.HraMinValue=Math.min(w,ne,ce),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.HraMinValue),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TotAmtOthExemptUs10Index=this.HRAExemptionIndex+1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[1].Value=this.TotAmtOthExemptUs10Index,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[2].Value=10001,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].Value="Total amount of any other exemption under section 10",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].ColSpan=14;let Re=0,oe=this.dsTaxData.Tables[25].filter(S=>"U/S 10 : 1) Total amount of any other exemption under section 10"==S.Name);null!=oe&&oe.length>0&&null!=oe[0].Amount&&null!=oe[0].Amount&&""!=oe[0].Amount.toString()&&(Re=parseFloat(oe[0].Amount)),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Re),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(2);let ke=0,jt=0,ga=0;if(this.dvLimit=this.dvLimitData.filter(S=>998==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(ke=parseFloat(this.dvLimit[0].AmountLimit)),this.ConveyanceIndex=this.TotAmtOthExemptUs10Index+1,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[1].Value=this.ConveyanceIndex,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][0].ComponentID),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].Value="Conveyance",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].ColSpan=14,parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){if(this.dsTaxData.Tables[9].length>0){b=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][0].ComponentID))for(b=5;b<i;b++)c.J0.IsEmpty(this.grdIncomeTax.Data[S].Cells[b].Value)||(jt+=c.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[b].Value))}ga=jt/12,0==ga||ga>ke?ke*=12:ke=jt}parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2018&&(ke=0,2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.dblStandardDeduction=4e4:parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.dvLimit=this.dvLimitData.filter(S=>1e3==S.ComponentID),this.dblStandardDeduction=null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()?parseFloat(this.dvLimit[0].AmountLimit):5e4)),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(ke),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.ChildrenEduIndex=this.ConveyanceIndex+1,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[1].Value=this.ChildrenEduIndex,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][1].ComponentID),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[3].Value="Children Education Allowances";let Pa=0;if(parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){let S=0,X=0,B=0,xe=0;if(this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(ae=>996==ae.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(B=parseFloat(this.dvLimit[0].AmountLimit)),this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(ae=>996==ae.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(X=parseInt(this.dvLimit[0].AmountLimit)),this.dsTaxData.Tables[10].length>0){S=parseInt(this.dsTaxData.Tables[10][0][0]),S>X&&(S=X),xe=12*S*B,b=5;for(let ae=0;ae<this.TotalSalaryIndex;ae++)if(parseInt(this.grdIncomeTax.Data[ae].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][1].ComponentID))for(b=5;b<i;b++)null!=this.grdIncomeTax.Data[ae].Cells[b].Value&&""!=this.grdIncomeTax.Data[ae].Cells[b].Value.toString()&&0!=c.J0.DoubleTryParse(this.grdIncomeTax.Data[ae].Cells[b].Value)&&(Pa+=S*B)}}this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Pa),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.dsTaxData.Tables[11].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[11].length);let ma=0,Ia=0;ma=this.ChildrenEduIndex+1,N=ma;for(let S=0;S<this.dsTaxData.Tables[11].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ma+S,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[11][S].NodeID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[11][S].NAME.toString(),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.dvEmpTaxComputation=this.dsTaxData.Tables[21],this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(X=>X.ComponentID==parseInt(this.dsTaxData.Tables[11][S].NODEID)&&0==X.RegimeType),this.dvEmpTaxComputation.length>0?(this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount))):(this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(0),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(0)),Ia+=c.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1;this.MedicalIndex=this.ChildrenEduIndex+1,this.LTAIndex=this.MedicalIndex+1,this.FoodIndex=this.LTAIndex+1,this.LeaveEncashIndex=this.FoodIndex+1,this.GratuityIndex=this.LeaveEncashIndex+1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.StandardDedIndex=this.GratuityIndex+1,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[1].Value=this.StandardDedIndex,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblStandardDeduction),this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.MedicalIndex].Cells[4].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LTAIndex].Cells[4].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LeaveEncashIndex].Cells[4].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.FoodIndex].Cells[4].Value)+c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.GratuityIndex].Cells[4].Value)+this.dblStandardDeduction),this.grdIncomeTax.addEmptyRowsWithCellApperance(3),this.BalanceSalInc12BAIndex=this.StandardDedIndex+1,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[1].Value=this.BalanceSalInc12BAIndex,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[2].Value=-104,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[3].Value="Balance Salary including Perquisites",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblbalanceSalaryInc12BA),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let Tt=0,xa=this.dsTaxData.Tables[12];this.ProfessionalTaxIndex=this.BalanceSalInc12BAIndex+1,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[0].Value=-105,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[1].Value=this.ProfessionalTaxIndex,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[3].Value="Professional Tax",g=this.dsTaxData.Tables[20];let pe=!1;if(xa.length>0){pe=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("PROFESSIONAL TAX"==c.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let X=5;X<this.grdIncomeTax.ReportColumns.length-2;X++){pe=!1;for(let B=0;B<g.length;B++)if(g[B].month.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()){c.J0.IsEmpty(g[B]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(Tt+=parseFloat(g[B]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),pe=!0;break}if(!pe)for(let B=0;B<p.length;B++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[B].componentid)&&p[B].FieldName.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()&&parseFloat(p[B].Amount)>0){c.J0.IsEmpty(p[B].Amount)||(Tt+=parseFloat(p[B].Amount)),pe=!0;break}if(!pe)for(let B=0;B<e.length;B++)c.J0.IsEmpty(e[B]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(Tt+=parseFloat(e[B]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}}this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].Value=c.J0.GetAmount(Tt),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Tt),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.NetTaxableSalIndex=this.ProfessionalTaxIndex+1,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[1].Value=this.NetTaxableSalIndex,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNetTaxableSal=0,this.dblNetTaxableSal=this.dblbalanceSalaryInc12BA-Tt,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNetTaxableSal),this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[14].length+3);let Sa=0;this.IncomefromHousePropertyIndex=this.NetTaxableSalIndex+1;for(let S=0;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[1].Value=this.IncomefromHousePropertyIndex,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Sa=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}let Ma=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[1].Value=this.IncomefromHousePropertyIndex+1,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[2].Value=-107,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[3].Value="Less : Standard deduction 30%",Ma=30*Sa/100,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value=c.J0.GetAmount(Ma),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Bt=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[1].Value=this.IncomefromHousePropertyIndex+2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[2].Value=-108,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[3].Value="",Bt=parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value)-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].Value=c.J0.GetAmount(Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[5].ColSpan=12;let Jt=0;for(let S=1;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[1].Value=this.IncomefromHousePropertyIndex+3,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Jt=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].Value=c.J0.GetAmount(Jt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[1].Value=this.IncomefromHousePropertyIndex+4,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[2].Value=-109,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].Value="Loss from House Property",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(Jt-Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Wt=0;this.dblSelfletoutamount=0,N=Wt=this.IncomefromHousePropertyIndex+5;for(let S=2;S<this.dsTaxData.Tables[14].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Wt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblSelfletoutamount=this.dblSelfletoutamount+parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(c.J0.DoubleTryParse(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,Wt+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.GrossTotalIncomeIndex=Wt,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[1].Value=this.GrossTotalIncomeIndex,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblGrossTotalIncome=this.dblNetTaxableSal+this.dblSelfletoutamount-(Jt-Bt),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblGrossTotalIncome),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intDeducunder8oCto80CCCIndex=this.GrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[1].Value=this.intDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].ColSpan=15,this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[16].length);let fa=0,ca=0,ot=0;N=ot=this.intDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[16].length;S++){if(this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ot,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[16][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][S].NAME,this.dvEmpTaxComputation.RowFilter="",this.dvEmpTaxComputation.filter(X=>X.ComponentID==parseInt(this.dsTaxData.Tables[16][S].NODEID)),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==c.J0.String(this.dsTaxData.Tables[16][S].NAME)){let X=0;pe=!1;for(let B=0;B<this.dsTaxData.Tables[19].length;B++)if("PF(Deduction from Salary)"==c.J0.String(this.dsTaxData.Tables[19][B].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][B].SNo)>0)for(let xe=5;xe<this.grdIncomeTax.ReportColumns.length-2;xe++){pe=!1;for(let ae=0;ae<g.length;ae++)if(c.J0.String(g[ae].month)==this.grdIncomeTax.ReportColumns[xe].HeaderText.toString()){c.J0.IsEmpty(g[ae]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][B].SNo)])||(X+=parseFloat(g[ae]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][B].SNo)])),pe=!0;break}if(!pe)for(let ae=0;ae<p.length;ae++)if(parseInt(this.dsTaxData.Tables[19][B].componentID)==parseInt(p[ae].componentid)&&p[ae].FieldName.toString()==this.grdIncomeTax.ReportColumns[xe].HeaderText.toString()&&parseFloat(p[ae].Amount)>0){c.J0.IsEmpty(p[ae].Amount)||(X+=parseFloat(p[ae].Amount)),pe=!0;break}if(!pe&&xe>=t)for(let ae=0;ae<e.length;ae++)c.J0.IsEmpty(e[ae]["Deduction"+c.J0.String(this.dsTaxData.Tables[19][B].SNo)])||(X+=parseFloat(e[ae]["Deduction"+c.J0.String(this.dsTaxData.Tables[19][B].SNo)]))}this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(X)}else this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dsTaxData.Tables[16][S].AMOUNT));this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",0==S&&(fa=c.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),S>0&&(ca+=c.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,N+=1,ot+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalDeducunder8oCto80CCCIndex=ot,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblTotaldeduction80ccc80c=ca+fa,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].Value=c.J0.GetAmount(this.dblTotaldeduction80ccc80c);let Ca=0;this.dvLimit=this.dvLimitData.filter(S=>995==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Ca=parseFloat(this.dvLimit[0].AmountLimit)),this.dblTotaldeduction80ccc80c>Ca&&(this.dblTotaldeduction80ccc80c=Ca),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b";let Et=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[17].length),this.intOtherDeducunder8oCto80CCCIndex=this.intTotalDeducunder8oCto80CCCIndex+1,N=ot=this.intTotalDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[17].length;S++){let X=0;if(this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ot,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[17][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[17][S].NAME,this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(B=>B.ComponentID==parseInt(this.dsTaxData.Tables[17][S].NODEID)&&0==B.RegimeType),this.dvEmpTaxComputation.length>0)Et+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(X=0,X=parseFloat(this.dsTaxData.Tables[17][S].AMOUNT),"80D-Self/Spouse/Dependant Children"==c.J0.String(this.dsTaxData.Tables[17][S].NAME)||"80D-Self/Dependant/Parent (not Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()){pe=!1;for(let B=0;B<this.dsTaxData.Tables[19].length;B++)if(!c.J0.IsEmpty(this.dsTaxData.Tables[19][B].TaxmapName)&&this.dsTaxData.Tables[19][B].TaxmapName.toString()==this.dsTaxData.Tables[17][S].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][B].SNo)>0)for(let xe=5;xe<this.grdIncomeTax.ReportColumns.length-2;xe++){pe=!1;for(let ae=0;ae<g.length;ae++)if(g[ae].month.toString()==this.grdIncomeTax.ReportColumns[xe].HeaderText.toString()){null!=g[ae]["dcCalcNum"+this.dsTaxData.Tables[19][B].SNo.toString()]&&null!=g[ae]["dcCalcNum"+this.dsTaxData.Tables[19][B].SNo.toString()]&&""!=g[ae]["dcCalcNum"+this.dsTaxData.Tables[19][B].SNo.toString()].toString()&&(X+=parseFloat(g[ae]["dcCalcNum"+this.dsTaxData.Tables[19][B].SNo.toString()])),pe=!0;break}if(!pe)for(let ae=0;ae<p.length;ae++)if(parseInt(this.dsTaxData.Tables[19][B].componentID)==parseInt(p[ae].componentid)&&p[ae].FieldName.toString()==this.grdIncomeTax.ReportColumns[xe].HeaderText.toString()&&parseFloat(p[ae].Amount)>0){null!=p[ae].Amount&&null!=p[ae].Amount&&""!=p[ae].Amount.toString()&&(X+=parseFloat(p[ae].Amount)),pe=!0;break}if(!pe)for(let ae=0;ae<e.length;ae++)null!=e[ae]["Deduction"+this.dsTaxData.Tables[19][B].SNo.toString()]&&null!=e[ae]["Deduction"+this.dsTaxData.Tables[19][B].SNo.toString()]&&""!=e[ae]["Deduction"+this.dsTaxData.Tables[19][B].SNo.toString()].toString()&&(X+=parseFloat(e[ae]["Deduction"+this.dsTaxData.Tables[19][B].SNo.toString()]))}}Et+=X,this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(X)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):X),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,ot+=1}this.intOtherDeducunder8oCto80CCCIndex1=ot-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeIndex=this.intOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeIndex,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.dblTotalIncome=this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-Et,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeRoundoffIndex=this.dblTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.IsBold=!0,this.dblTotalIncomeRoundoff=Math.round(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxOnTotalIncomeIndex=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblRebateIndex=this.dblTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[2].Value=-116,parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,000 for Taxable Income below Rs.5,00,000/-)":2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.5,000 for Taxable Income below Rs.5,00,000/-)":2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,500 for Taxable Income below Rs.3,50,000/-)":parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.12,500 for Taxable Income below Rs.5,00,000/-)"),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableAfterRebateIndex=this.dblRebateIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSurchargeIndex=this.dblTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableIndex=this.dblSurchargeIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblEducationCessIndex=this.dblTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSecHighEduCessIndex=this.dblEducationCessIndex+1,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalIncometaxPayableindex=this.dblSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[1].Value=this.intTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TDSPaidIndex=this.intTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[1].Value=this.TDSPaidIndex,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NetTaxPayableIndex=this.TDSPaidIndex+1,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[1].Value=this.NetTaxPayableIndex,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let ba,pa=0,bt=0,Ea=0,Fa=0,Ht=0,Na=0;Ht=d.d.SessionManager.FinancialYearStartDate.getFullYear(),ba=Ht.toString(),Ht=parseInt(ba.substr(2,2)),Na=Ht+1,pa=d.d.SessionManager.AccountingFromMonth,Fa=pa;let Ut=1;bt=pa,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.MonthlyDeducIndex=this.NetTaxPayableIndex+1,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[1].Value=this.MonthlyDeducIndex,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[2].Value=-125,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].Value="Monthly Deductions from salary",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].ColSpan=2;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)if(13==bt){Ea=bt-Ut;for(let X=1;X<=Ea;X++)this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(X,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",Ut+=1,S++}else this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(bt,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",bt+=1,Ut+=1;this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.dsTaxData.Tables[19].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[19].length+1);let Yt=0,At=0,rt=0;N=Yt=this.MonthlyDeducIndex+1,g=this.dsTaxData.Tables[20];for(let S=0;S<this.dsTaxData.Tables[19].length;S++){if(W=new Array,b=5,rt=At=0,this.grdIncomeTax.Data[N+S].Cells[17].Value=0,this.grdIncomeTax.Data[N+S].Cells[0].Value=this.dsTaxData.Tables[19][S].SNo,this.grdIncomeTax.Data[N+S].Cells[1].Value=Yt+S,this.grdIncomeTax.Data[N+S].Cells[2].Value=this.dsTaxData.Tables[19][S].componentID,this.grdIncomeTax.Data[N+S].Cells[3].Value=this.dsTaxData.Tables[19][S].SalaryBreakup,this.grdIncomeTax.Data[N+S].Cells[3].ColSpan=2,parseInt(this.dsTaxData.Tables[19][S].SNo)>0){for(let X=0;X<g.length;X++)for(let B=5;B<this.grdIncomeTax.ReportColumns.length;B++)if(g[X].month.toString()==this.grdIncomeTax.ReportColumns[B].HeaderText.toString()&&!W.Contains(this.grdIncomeTax.ReportColumns[B].HeaderText)){W.push(this.grdIncomeTax.ReportColumns[B].HeaderText),l=0,c.J0.IsEmpty(g[X]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(l=parseFloat(g[X]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),this.grdIncomeTax.Data[N+S].Cells[B].Value=l>=0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[B].IsNormal=!1,rt+=l;break}p=D,p=this.dsTaxData.Tables[2].filter(X=>"2"==X.ComponentType);for(let X=0;X<p.length;X++)for(let B=5;B<this.grdIncomeTax.ReportColumns.length;B++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[X].componentid)&&p[X].FieldName.toString()==this.grdIncomeTax.ReportColumns[B].HeaderText.toString()&&parseFloat(p[X].Amount)>0&&!W.Contains(this.grdIncomeTax.ReportColumns[B].HeaderText)){this.grdIncomeTax.ReportColumns[B].Tag="Past",W.push(this.grdIncomeTax.ReportColumns[B].HeaderText),l=0,c.J0.IsEmpty(p[X].Amount)||(l=parseFloat(p[X].Amount)),this.grdIncomeTax.Data[N+S].Cells[B].Value=l>=0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[B].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[B].IsNormal=!1,rt+=l;break}if(0==e.length)return;for(let X=0;X<e.length;X++)for(b=t;b<i;b++)!W.Contains(this.grdIncomeTax.ReportColumns[b].HeaderText)&&c.J0.DoubleTryParse(this.grdIncomeTax.Data[N+S].Cells[b].Value)<=0&&(W.push(this.grdIncomeTax.ReportColumns[b].HeaderText),l=parseFloat(e[X]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]),this.grdIncomeTax.Data[N+S].Cells[b].Value=l>=0?c.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[b].IsNormal=!1,rt+=l)}this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(rt),this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0}this.InhandAmountIndex=Yt+this.dsTaxData.Tables[19].length;let ua=0;this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[1].Value=this.InhandAmountIndex,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[2].Value=-126,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].Value="In Hand",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].IsNormal=!1,b=5;let Da=0;for(b=5;b<17;b++)this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].Value=c.J0.GetAmount(0),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.ForeColor="#dc3545";for(b=5;b<i;b++){At=0;for(let S=Yt;S<this.InhandAmountIndex;S++)At+=c.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[b].Value);Da=c.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[b].Value)-At,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].Value=c.J0.GetAmount(Da),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.ForeColor="#dc3545",ua+=Da}this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(ua),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",pe=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("TDS"==c.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let X=5;X<this.grdIncomeTax.ReportColumns.length-2;X++){pe=!1;for(let B=0;B<g.length;B++)if(g[B].month.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()){c.J0.IsEmpty(g[B]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(g[B]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),pe=!0;break}if(!pe)for(let B=0;B<p.length;B++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[B].componentid)&&p[B].FieldName.toString()==this.grdIncomeTax.ReportColumns[X].HeaderText.toString()&&parseFloat(p[B].Amount)>0){c.J0.IsEmpty(p[B].Amount)||(this.dblTDS+=parseFloat(p[B].Amount)),pe=!0;break}if(!pe)for(let B=0;B<e.length;B++)c.J0.IsEmpty(e[B]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(e[B]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}if(this.UpdateTotals(this.dblTotalIncomeRoundoff),this.bIsNewRegime){let S=0,X=0,B=0;this.dvNewTaxSlabs=this.dsTaxData.Tables[7];let xe={iY:S,iM:X,iD:B};c.J0.GetYearsMonthsDays(new Date(T[0].CDOB),this.dtToMonth.OnlyDate(),xe),S=xe.iY,X=xe.iM,B=xe.iD,this.dvNewTaxSlabs=this.dsTaxData.Tables[7].filter(S>=80?se=>"SuperSeniorCitizen"==se.Gender&&"New"==se.RegimeType:S>=60?se=>"SeniorCitizen"==se.Gender&&"New"==se.RegimeType:se=>se.Gender==c.J0.String(T[0].GenderName)&&"New"==se.RegimeType),this.lstNewTaxSalbs.Clear();for(let se=0;se<this.dvNewTaxSlabs.length;se++)this.lstNewTaxSalbs.push(new Ve),this.lstNewTaxSalbs[se].FromSlab=parseFloat(this.dvNewTaxSlabs[se].Fromslab),this.lstNewTaxSalbs[se].ToSlab=parseFloat(this.dvNewTaxSlabs[se].Toslab),this.lstNewTaxSalbs[se].Percentage=parseFloat(this.dvNewTaxSlabs[se].Percentage)/100;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewRegimeStartIndex=this.InhandAmountIndex+1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[1].Value=this.NewRegimeStartIndex,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[2].Value=-130,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].Value="Computation Based on New Regime",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.Alignment="Center",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.ForeColor="Black",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontSize=18,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Height=32,this.dvNewLimit=this.dsTaxData.Tables[15].filter(se=>1e3==se.ComponentID&&"New"==se.Regime),this.dblNewStandardDeduction=null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()?parseFloat(this.dvNewLimit[0].AmountLimit):5e4,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewStandardDedIndex=this.NewRegimeStartIndex+1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[1].Value=this.NewStandardDedIndex,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewStandardDeduction),this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxableSalIndex=this.NewStandardDedIndex+1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[1].Value=this.NewNetTaxableSalIndex,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNewNetTaxableSal=0,this.dblNewNetTaxableSal=this.dblTotalCellSalary-this.dblNewStandardDeduction,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewNetTaxableSal),this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red";let ae=0;this.dblNewSelfletoutamount=0;let Te=this.dsTaxData.Tables[14].filter(se=>"New"==se.RegimeType||"Both"==se.RegimeType);if(null!=Te&&Te.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Te.length),N=ae=this.NewNetTaxableSalIndex+1,null!=Te&&Te.length>0)for(let se=0;se<Te.length;se++)this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ae,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Te[se].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=Te[se].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(Te[se].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblNewSelfletoutamount=this.dblNewSelfletoutamount+parseFloat(Te[se].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(parseFloat(Te[se].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,ae+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewGrossTotalIncomeIndex=ae,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[1].Value=this.NewGrossTotalIncomeIndex,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewGrossTotalIncome=this.dblNewNetTaxableSal+this.dblNewSelfletoutamount,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewGrossTotalIncome),this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewDeducunder8oCto80CCCIndex=this.NewGrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].ColSpan=14;let Je=this.dsTaxData.Tables[16].filter(se=>"New"==se.RegimeType||"Both"==se.RegimeType);null!=Je&&Je.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Je.length);let Aa=0,Ta=0,dt=0;if(N=dt=this.intNewDeducunder8oCto80CCCIndex+1,null!=Je&&Je.length>0)for(let se=0;se<Je.length;se++){if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=dt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Je[se].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][se].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(We=>We.ComponentID==parseInt(Je[se].NODEID)&&0==We.RegimeType),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==Je[se].NAME.toString()){let We=0;pe=!1;for(let Ee=0;Ee<this.dsTaxData.Tables[19].length;Ee++)if("PF(Deduction from Salary)"==c.J0.String(this.dsTaxData.Tables[19][Ee].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][Ee].SNo)>0)for(let at=5;at<this.grdIncomeTax.ReportColumns.length-2;at++){pe=!1;for(let de=0;de<g.length;de++)if(c.J0.String(g[de].month)==this.grdIncomeTax.ReportColumns[at].HeaderText.toString()){null!=g[de]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=g[de]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(We+=parseFloat(g[de]["dcCalcNum"+this.dsTaxData.Tables[19][Ee].SNo.toString()])),pe=!0;break}if(!pe)for(let de=0;de<p.length;de++)if(parseInt(this.dsTaxData.Tables[19][Ee].componentID)==parseInt(p[de].componentid)&&p[de].FieldName.toString()==this.grdIncomeTax.ReportColumns[at].HeaderText.toString()&&parseFloat(p[de].Amount)>0){null!=p[de].Amount&&""!=p[de].Amount.toString()&&(We+=parseFloat(p[de].Amount)),pe=!0;break}if(!pe)for(let de=0;de<e.length;de++)null!=e[de]["Deduction"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=e[de]["Deduction"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(We+=parseFloat(e[de]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]))}this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(We)}else this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(Je[se].Amount));0==se&&(Aa=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),se>0&&(Ta+=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[5].rowSpan=Je.length,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].rowSpan=Je.length,N+=1,dt+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalDeducunder8oCto80CCCIndex=dt,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblNewTotaldeduction80ccc80c=Ta+Aa,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].Value=c.J0.GetAmount(this.dblNewTotaldeduction80ccc80c);let ya=0;this.dvNewLimit=this.dsTaxData.Tables[15].filter(se=>995==se.ComponentID),null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()&&(ya=parseFloat(this.dvNewLimit[0].AmountLimit)),this.dblNewTotaldeduction80ccc80c>ya&&(this.dblNewTotaldeduction80ccc80c=ya),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green";let xt=0,Ue=this.dsTaxData.Tables[17].filter(se=>"New"==se.RegimeType||"Both"==se.RegimeType);if(null!=Ue&&Ue.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Ue.length),this.intNewOtherDeducunder8oCto80CCCIndex=this.intNewTotalDeducunder8oCto80CCCIndex+1,N=dt=this.intNewTotalDeducunder8oCto80CCCIndex+1,null!=Ue&&Ue.length>0)for(let se=0;se<Ue.length;se++){let We=0;if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=dt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Ue[se].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=Ue[se].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Ee=>Ee.ComponentID==parseInt(Ue[se].NODEID)&&0==Ee.RegimeType),this.dvEmpTaxComputation.length>0)xt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(We=0,We=parseFloat(Ue[se].AMOUNT),"80D-Self/Spouse/Dependant Children"==Ue[se].NAME.toString()||"80D-Self/Dependant/Parent (not Sr Citizen)"==Ue[se].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==Ue[se].NAME.toString()){pe=!1;for(let Ee=0;Ee<this.dsTaxData.Tables[19].length;Ee++)if(this.dsTaxData.Tables[19][Ee].TaxmapName.toString()==Ue[se].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][Ee].SNo)>0)for(let at=5;at<this.grdIncomeTax.ReportColumns.length-2;at++){pe=!1;for(let de=0;de<g.length;de++)if(g[de].month.toString()==this.grdIncomeTax.ReportColumns[at].HeaderText.toString()){null!=g[de]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)]&&""!=g[de]["dcCalcNum"+c.J0.String(this.dsTaxData.Tables[19][Ee].SNo)].toString()&&(We+=parseFloat(g[de]["dcCalcNum"+this.dsTaxData.Tables[19][Ee].SNo.toString()])),pe=!0;break}if(!pe)for(let de=0;de<p.length;de++)if(parseInt(this.dsTaxData.Tables[19][Ee].componentID)==parseInt(p[de].componentid)&&p[de].FieldName.toString()==this.grdIncomeTax.ReportColumns[at].HeaderText.toString()&&parseFloat(p[de].Amount)>0){null!=p[de].Amount&&""!=p[de].Amount.toString()&&(We+=parseFloat(p[de].Amount)),pe=!0;break}if(!pe)for(let de=0;de<e.length;de++)null!=e[de]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]&&null!=e[de]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]&&""!=e[de]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()].toString()&&(We+=parseFloat(e[de]["Deduction"+this.dsTaxData.Tables[19][Ee].SNo.toString()]))}}xt+=We,this.grdIncomeTax.Data[N].Cells[4].Value=c.J0.GetAmount(We)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):We),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,dt+=1}this.intNewOtherDeducunder8oCto80CCCIndex1=dt-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeIndex=this.intNewOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewTotalIncome=this.dblNewGrossTotalIncome-this.dblNewTotaldeduction80ccc80c-xt,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeRoundoffIndex=this.dblNewTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.dblNewTotalIncomeRoundoff=Math.round(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblNewTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxOnTotalIncomeIndex=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewRebateIndex=this.dblNewTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[2].Value=-116,parseInt(this.cmbYear.SelectedValue)>=2023&&(this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.25,000 for Taxable Income below Rs.7,00,000/-)"),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableAfterRebateIndex=this.dblNewRebateIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSurchargeIndex=this.dblNewTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableIndex=this.dblNewSurchargeIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewEducationCessIndex=this.dblNewTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSecHighEduCessIndex=this.dblNewEducationCessIndex+1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalIncometaxPayableindex=this.dblNewSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[1].Value=this.intNewTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewTDSPaidIndex=this.intNewTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[1].Value=this.NewTDSPaidIndex,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=c.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxPayableIndex=this.NewTDSPaidIndex+1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[1].Value=this.NewNetTaxPayableIndex,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.UpdateTotalsNewRegime(this.dblNewTotalIncomeRoundoff)}}catch(l){Logger.ErrorLog("Error : "+l)}}cmbYear_SelectionChanged(l){this.clear(0),this.ITComputationViewModel.FilterEmployees(),this.ITComputationViewModel.lFinancialDate=this.ITComputationViewModel.GetFinancialYear(),null!=this.lstEmployee.SelectedValue&&0!=this.lstEmployee.SelectedValue&&(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.OnYearSelected("Year"),this.FillDetails())}PrintForm16_Click(l){var t=this;return(0,ie.A)(function*(){if(null==t.dtpDate.Date&&(t.dtpDate.Date=new Date),!(t.lstEmployee.SelectedValue>0))return t.obj.DisplayMessage="Select any Employee",void(t.obj.MessageVisibility=!0);t.txtPlace.Text.Trim(),t.dtpDate.Date.ToString("dd/MMM/yyyy"),t.LoadForm16PrintGrid(),t.Form16export()})()}LoadForm16PrintGrid(){let l,i="",o=-1,r=-1,h=-1,C=-1;this.grdPrint=new k.j,this.grdPrint.ItComput=!0,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let g=new $.bA;g.Alignment="Center",g.FontFamilyName="Arial",g.FontSize=12,g.IsBold=!0,g.BackColor="White",g.ForeColor="Black",g.IsVisible=!0;let p,D=new $.bA;D.Alignment="Left",D.FontFamilyName="Arial",D.FontSize=12,D.IsBold=!0,D.BackColor="White",D.ForeColor="#FF333333";for(let L=1;L<=10;L++)p=new V.D_,p.FieldName="Col"+L.toString(),p.width=70,p.HeaderText="Col"+L.toString(),p.HeaderAppearance=g,p.DataAppearance=D,this.grdPrint.ReportColumns.push(p);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=75,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=75,this.grdPrint.ReportColumns[6].width=40,this.grdPrint.ReportColumns[7].width=90,this.grdPrint.ReportColumns[8].width=90,this.grdPrint.ReportColumns[9].width=90;let e=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="[See rule 31(1)(a)]",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART A",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(L=>L.DBIndex==d.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(L=>4==L.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Employee Reference No. provided by the Employer (If available)",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,l=this.dsTaxData.Tables[23].filter(L=>L.DBIndex==d.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].Code&&null!=this.dsTaxData.Tables[18][0].Code?this.dsTaxData.Tables[18][0].Code.toString():"",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Summary of amount paid/credited and tax deducted at source thereon in respect of the employee",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Quarter(s)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="Receipt Numbers of original quarterly statements of TDS under sub-section (3) of Section 200",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="Amount paid/credited",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="Amount of tax deducted (Rs.)",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Amount of tax deposited/remitted in respect",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q1",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,o=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q2",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q3",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q4",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,r=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="I. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH BOOK ADJUSTMENT\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,h=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Book Identification Number (BIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="Receipt Numbers of Form No. 24G",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="DDO serial number in Form no. 24G",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Date of transfer voucher \r\n (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with Form no. 24G",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[h].Cells[0].rowSpan=2,this.grdPrint.Data[h].Cells[1].rowSpan=2,this.grdPrint.Data[h].Cells[2].rowSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].ColSpan=1,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="II. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH CHALLAN\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,C=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Challan Identification Number (CIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="BSR Code of the Bank Branch",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="Date on which Tax deposited (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Challan Serial Number",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with OLTAS*",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[C].Cells[0].rowSpan=2,this.grdPrint.Data[C].Cells[1].rowSpan=2,this.grdPrint.Data[C].Cells[2].rowSpan=2;let T=0,P=0,A=0,_=0,x=0,F=0,j=d.d.common.GetDataTable("INC001",this.iSelectedEmpSeqNo.toString()+"~"+this.obj.EmpYear.SelectedValue);if(null!=j&&j.length>0){if(l=j.filter(L=>"Monthly"==L.dcAlpha2),null!=l&&l.length>0){T=0;for(let L=0;L<l.length;L++)e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=L+1,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,F=0,F=c.J0.Double(l[L].dcNum5.toString()),this.grdPrint.Data[e].Cells[1].Value=F.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,T+=F,this.grdPrint.Data[e].Cells[3].Value=null!=l[L].dcAlpha5&&null!=l[L].dcAlpha5?l[L].dcAlpha5.toString():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value=null!=l[L].dcAlpha6&&null!=l[L].dcAlpha6?c.J0.ParseDate(l[L].dcAlpha6).ToString("dd'-'MMM'-'yyyy"):"",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value=null!=l[L].dcAlpha7&&null!=l[L].dcAlpha7?l[L].dcAlpha7.toString():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="F",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1}if(e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value=T.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=7,l=j.filter(L=>"Quarterly"==L.dcAlpha2),null!=l&&l.length>0){T=P=A=_=x=0;let L=0;for(let Ge=0;Ge<l.length;Ge++)L=parseInt(l[Ge].dcAlpha3.toString().Replace("Quarter",""))-1,this.grdPrint.Data[o+L].Cells[2].Value=null!=l[Ge].dcAlpha8&&null!=l[Ge].dcAlpha8?l[Ge].dcAlpha8.toString():"",this.grdPrint.Data[o+L].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[o+L].Cells[2].ColSpan=2,F=0,0==L?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value):0):1==L?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value):0):2==L?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value):0):3==L&&(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value):0),this.grdPrint.Data[o+L].Cells[4].Value=F.ToString("0.00"),this.grdPrint.Data[o+L].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[o+L].Cells[4].ColSpan=2,T+=F,F=0,F=c.J0.Double(l[Ge].dcNum6.toString()),this.grdPrint.Data[o+L].Cells[6].Value=F.ToString("0.00"),this.grdPrint.Data[o+L].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o+L].Cells[6].ColSpan=2,P+=F,F=0,F=c.J0.Double(l[Ge].dcNum7.toString()),this.grdPrint.Data[o+L].Cells[8].Value=F.ToString("0.00"),this.grdPrint.Data[o+L].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o+L].Cells[8].ColSpan=2,A+=F}this.grdPrint.Data[r+1].Cells[4].Value=T.ToString("0.00"),this.grdPrint.Data[r+1].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[4].ColSpan=2,this.grdPrint.Data[r+1].Cells[6].Value=P.ToString("0.00"),this.grdPrint.Data[r+1].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[6].ColSpan=2,this.grdPrint.Data[r+1].Cells[8].Value=A.ToString("0.00"),this.grdPrint.Data[r+1].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[8].ColSpan=2}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+c.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that a sum of Rs. "+this.grdPrint.Data[r+1].Cells[6].Value+" ["+c.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[r+1].Cells[6].Value&&null!=this.grdPrint.Data[r+1].Cells[6].Value&&""!=this.grdPrint.Data[r+1].Cells[6].Value.toString()?this.grdPrint.Data[r+1].Cells[6].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" (in words)] has been deducted and a sum of Rs. "+this.grdPrint.Data[r+1].Cells[8].Value+" ["+c.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[r+1].Cells[6].Value&&null!=this.grdPrint.Data[r+1].Cells[6].Value&&""!=this.grdPrint.Data[r+1].Cells[6].Value.toString()?this.grdPrint.Data[r+1].Cells[8].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" ] has been deposited to the credit of the Central Government. I further certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, TDS deposited and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+c.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toString(),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Notes :",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="1. Part B (Annexure) of the certificate in Form No.16 shall be issued by the employer.\n\n2. If an assessee is employed under one employer during the year, Part 'A' of the certificate in Form No.16 issued for the quarter ending on 31st March of the financial year shall contain the details of tax deducted and deposited for all the quarters of the financial year.\n\n3. If an assessee is employed under more than one employer during the year, each of the employers shall issue Part A of the certificate in Form No.16 pertaining to the period for which such assessee was employed with each of the employers. Part B (Annexure) of the certificate in Form No. 16 may be issued by each of the employers or the last employer at the option of the assessee.\n\n4. To update PAN details in Income Tax Department database, apply for 'PAN change request' through NSDL or UTITSL.\n\n",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend used in Form 16",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   * Status of matching with OLTAS",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Description",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Definition",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="U",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Unmatched",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Deductors have not deposited taxes or have furnished incorrect particulars of tax payment. Final credit will be reflected only when payment details in bank match with details of deposit in TDS / TCS statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="P",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Provisional",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value='Provisional tax credit is effected only for TDS / TCS Statements filed by Government deductors."P" status will be changed to Final (F) on verification of payment details submitted by Pay and Accounts Officer (PAO)',this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="F",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Final",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="In case of non-government deductors, payment details of TDS / TCS deposited in bank by deductor have matched with the payment details mentioned in the TDS / TCS statement filed by the deductors. In case of government deductors, details of TDS / TCS booked in Government account have been verified by Pay & Accounts Officer (PAO)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="O",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Overbooked",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Payment details of TDS / TCS deposited in bank by deductor have matched with details mentioned in the TDS / TCS statement but the amount is over claimed in the statement. Final (F) credit will be reflected only when deductor reduces claimed amount in the statement or makes new payment for excess amount claimed in the statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Tag="Break",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART B",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(L=>L.DBIndex==d.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(L=>4==L.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,l=this.dsTaxData.Tables[23].filter(L=>L.DBIndex==d.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Details of Salary Paid and any other income and tax deducted",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[0].ColSpan=6,this.grdPrint.Data[e].Cells[6].Value="Rs",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Rs.",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2;let E=0,b=0,N=0,te=0,Q=0,W=0,w=0,ne=0,ce=0;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="1.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross Salary",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Salary as per provisions contained in section 17(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Value of perquisites under section 17(2) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Profits in lieu of salary under section 17(3) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=7,this.grdPrint.Data[e].Cells[8].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,b=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Reported total amount of salary received from other employer(s)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="0.00",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N=parseFloat(this.grdPrint.Data[e].Cells[8].Value),E=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="2.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Allowances to the extent exempt under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Travel concession or assistance under section 10(5)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Death-cum-retirement gratuity under section 10(10)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Commuted value of pension under section 10(10A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Cash equivalent of leave salary encashment under section 10 (10AA)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="House rent allowance under section 10(13A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount of any other exemption under section 10 [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of any other exemption under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value,this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of exemption claimed under section 10\r\n [2(a)+2(b)+2(c)+2(d)+2(e)+2(g)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,b-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="3.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of salary received from current employer\r\n[1(d)-2(h)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=b.toString(),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="4.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Deductions under section 16",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,E=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Standard deduction under section 16(ia)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Entertainment allowance under section 16(ii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on employment under section 16(iii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,E+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="5.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of deductions under section 16\r\n[4(a)+4(b)+4(c)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),Q=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="6.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value='Income chargeable under the head "Salaries"\r\n[(3+1(e))-5]',this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=N.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,Q+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="7.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Add: Any other income reported by the employee under as per section 192 (2B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,te=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income (or admissible loss) from house property reported by employee offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(-1*parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,te+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income under the head Other Sources offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,te+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="8.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of other income reported by the employee\r\n[7(a)+7(b)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=te.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,Q+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),w=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="9.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross total income (6+8)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=Q.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,w+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="10.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions under Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,W=0;let Ce=0;for(let L=this.intDeducunder8oCto80CCCIndex+1;L<this.intTotalDeducunder8oCto80CCCIndex;L++)if(null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80CCC-")){Ce+=null!=this.grdIncomeTax.Data[L].Cells[4].Value&&""!=this.grdIncomeTax.Data[L].Cells[4].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[4].Value):0;break}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of life insurance premia, contributions to provident fund etc. under section 80C",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value-Ce).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution to certain pension funds under section 80CCC",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=Ce.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80CCD(1)-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by taxpayer to pension scheme under section 80CCD (1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4;let ve=E;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total deduction under section 80C, 80CCC and 80CCD(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=(ve+parseFloat(null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00")).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80CCD(1B)-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions in respect of amount paid/deposited to notified pension scheme under section 80CCD (1B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80CCD(2)-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by Employer to pension scheme under section 80CCD (2)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80D-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of health insurance premia under section 80D",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80DD-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Medical Treatment of handicapped Dependent under section 80DD",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80U-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (i)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Physically Disable Assesse under section 80U",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80E-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (j)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on loan taken for higher education under section 80E",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&(this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80G-")||this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80GGA-")||this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80GGC-"))&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (k)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total Deduction in respect of donations to certain funds, charitable institutions, etc. under section 80G",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=c.J0.Double(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80TTA-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (l)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on deposits in savings account under section 80TTA",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=c.J0.Double(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80EEB-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (m)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on Electric Vehicle Loan under section 80EEB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (n)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount deductible under any other provision(s) of Chapter VI-A [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=4,E=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (o)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total of amount deductible under any other provision(s) of Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80CCF-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (p)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Amount invested in specific Government approved Infrastructure bonds under section 80CCF",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80DDB-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (q)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction for Medical Treatment of certain specified ailments for Self/Dependent under section 80DDB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),E=0;for(let L=this.intOtherDeducunder8oCto80CCCIndex;L<=this.intOtherDeducunder8oCto80CCCIndex1;L++)null!=this.grdIncomeTax.Data[L].Cells[3].Value&&this.grdIncomeTax.Data[L].Cells[3].Value.toString().startsWith("80GG-")&&(E+=null!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[L].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (r)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of house rent paid who does not get HRA under section 80GG",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=E.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="11.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Aggregate of deductible amount under Chapter VI-A\r\n[10(d)+10(e)+10(f)+10(g)+10(h)+10(i)+10(j)+10(k)+10(l)+10(m)+10(n)+10(o)+10(p)+10(q)+10(r)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=W.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,w-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="12.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total taxable income (9-11)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=Math.round(w).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ne=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="13.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on total income",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ne+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="14.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Rebate under section 87A, if applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ne-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="15.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Surcharge, wherever applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ne+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="16.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Health and education cess",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ne+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),ce=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="17.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax payable (13+15+16-14)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=ne.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ce+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="18.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Relief under section 89 (attach details)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ce-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="19.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Net tax payable (17-18)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=ce.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+c.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+c.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left"}generatePrintContent(l,t="",i=!1,o=!1){let r="",h="",C="",g="",p="";if(r+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",h+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",h+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",h+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",h+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",r+="<style>"+h.toString()+"</style>",p=r,p+=`<h3 style="text-align: center;">${t}</h3>`,p+=" <table  border=1  style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",o){p+="<thead>",p+="<tr>";for(let T=0;T<l.ReportColumns.length;T++){const P=l.ReportColumns[T];P.HeaderAppearance.IsVisible&&(p+=`<th  width=${P.width} ></th>`)}p+="</tr>",p+="</thead>"}else{p+="<thead>",p+="<tr>";for(let T=0;T<l.ReportColumns.length;T++){const P=l.ReportColumns[T];P.HeaderAppearance.IsVisible&&(p+=`<th class='hdr'  width=${P.width} >${P.HeaderText}</th>`)}p+="</tr>",p+="</thead>"}p+="<tbody>";for(let T=0;T<l.Data.length;T++){p+="<tr",T%2==1&&(p+=" class=alt"),p+=">";const P=l.Data[T];for(let A=0;A<l.ReportColumns.length;)l.ReportColumns[A].HeaderAppearance.IsVisible?(p+=P.Cells[A].ColSpan>1?`<td  align=${P.Cells[A].CellAppearance.Alignment} colspan=${P.Cells[A].ColSpan} `:"<td ",null!=P.Cells[A].CellAppearance&&(C=(P.Cells[A].CellAppearance.ForeColor.startsWith("#ff")||P.Cells[A].CellAppearance.ForeColor.startsWith("#FF"))&&9==P.Cells[A].CellAppearance.ForeColor.length?"#"+P.Cells[A].CellAppearance.ForeColor.substr(3):P.Cells[A].CellAppearance.ForeColor,g=(P.Cells[A].CellAppearance.BackColor.startsWith("#ff")||P.Cells[A].CellAppearance.BackColor.startsWith("#FF"))&&9==P.Cells[A].CellAppearance.BackColor.length?"#"+P.Cells[A].CellAppearance.BackColor.substr(3):P.Cells[A].CellAppearance.BackColor,p+=` style='background-color:${g} + ;color:${C}'`),p+=" >",p+=c.J0.StringValue(P.Cells[A].Value),p+="</td>",A+=P.Cells[A].ColSpan):A+=P.Cells[A].ColSpan;p+="</tr>"}return p+="</tbody>",p+="</table>",p}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-income-tax-computation"]],decls:110,vars:29,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex","padding","12px"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px 10px 0 10px"],[1,"row",2,"height","40px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"input_cntrl_label"],[1,"NoLabel",2,"margin-left","5px","width","100px"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label",2,"margin-left","10px"],[1,"NoLabel",2,"margin-left","5px","min-width","150px"],[1,"PactMasterTree","Pactpagetree",2,"height","calc(100% - 80px)","width","100%","border","1px solid rgb(204, 204, 204)"],[3,"obj"],[1,"row",2,"height","40px","margin-top","3px"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"NoLabel",2,"flex","1","margin-left","5px"],[1,"primary-btn-wicon",2,"flex","1","margin-left","5px",3,"click"],[1,"form-group","col-xl-2","col-md-2","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.j41(14,"span",6),s.bIt("click",function(){return i.btnSave_Click("Save")}),s.nrm(15,"i",7),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18,"\n      "),s.DNE(19,re,4,3,"span",8),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.btnSave_Click("Delete")}),s.nrm(22,"i",9),s.EFF(23),s.nI1(24,"translate"),s.k0s(),s.EFF(25,"\n      "),s.j41(26,"span",6),s.bIt("click",function(){return i.btnSave_Click("Clear")}),s.nrm(27,"i",10),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n      "),s.DNE(31,z,4,3,"span",11),s.EFF(32,"\n      "),s.DNE(33,Ae,4,3,"span",11),s.EFF(34,"\n      "),s.DNE(35,Pe,4,3,"span",11),s.EFF(36,"\n    "),s.k0s(),s.EFF(37,"\n  "),s.k0s(),s.EFF(38,"\n  "),s.j41(39,"div",12),s.EFF(40,"\n    "),s.j41(41,"div",13),s.EFF(42,"\n      "),s.j41(43,"div",14),s.EFF(44,"\n        "),s.j41(45,"label",15),s.EFF(46,"Financial Year "),s.k0s(),s.EFF(47,"\n        "),s.j41(48,"div",16),s.EFF(49,"\n          "),s.eu8(50,17),s.EFF(51,"\n        "),s.k0s(),s.EFF(52,"\n        "),s.j41(53,"label",18),s.EFF(54),s.k0s(),s.EFF(55,"\n      "),s.k0s(),s.EFF(56,"\n      "),s.j41(57,"div",14),s.EFF(58,"\n      "),s.j41(59,"label",15),s.EFF(60,"Employee "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",19),s.EFF(63,"\n          "),s.eu8(64,17),s.EFF(65,"\n        "),s.k0s(),s.EFF(66,"\n      "),s.k0s(),s.EFF(67,"\n      "),s.k0s(),s.EFF(68,"\n      "),s.j41(69,"div",20),s.EFF(70,"\n        "),s.nrm(71,"app-report-grid",21),s.EFF(72,"\n      "),s.k0s(),s.EFF(73,"\n      "),s.j41(74,"div",22),s.EFF(75,"\n        "),s.j41(76,"div",23),s.EFF(77,"\n          "),s.j41(78,"label",15),s.EFF(79,"Regime Opted For "),s.k0s(),s.EFF(80,"\n          "),s.j41(81,"div",24),s.EFF(82,"\n            "),s.eu8(83,17),s.EFF(84,"\n          "),s.k0s(),s.EFF(85,"\n          "),s.j41(86,"button",25),s.bIt("click",function(){return i.btnSave_Click("SaveRegime")}),s.EFF(87),s.nI1(88,"translate"),s.k0s(),s.EFF(89,"\n        "),s.k0s(),s.EFF(90,"\n        "),s.j41(91,"div",26),s.EFF(92,"\n       "),s.j41(93,"label",15),s.EFF(94,"Place"),s.k0s(),s.EFF(95,"\n        "),s.j41(96,"div",24),s.EFF(97,"\n          "),s.eu8(98,17),s.EFF(99,"\n        "),s.k0s(),s.EFF(100,"\n        "),s.j41(101,"div",24),s.EFF(102,"\n          "),s.eu8(103,17),s.EFF(104,"\n       "),s.k0s(),s.EFF(105,"\n      "),s.k0s(),s.EFF(106,"\n      \n    "),s.k0s(),s.EFF(107,"\n\n  "),s.k0s(),s.EFF(108,"\n  "),s.k0s(),s.EFF(109,"\n"),s.k0s()),2&t&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(7),s.JRh(s.bMT(17,21,"Save")),s.R7$(3),s.Y8G("ngIf",i.obj.PrintVisiblility),s.R7$(4),s.JRh(s.bMT(24,23,"Delete")),s.R7$(5),s.JRh(s.bMT(29,25,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.WorksheetVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.TDSPostVisiblility),s.R7$(15),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(4),s.JRh(i.obj.lFinancialDate),s.R7$(10),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(7),s.Y8G("obj",i.grdIncomeTax),s.R7$(12),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(4),s.JRh(s.bMT(88,27,"SaveRegime")),s.R7$(11),s.Y8G("obj",i.txtPlace)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpDate)("group",i.form))},dependencies:[fe.bT,Ye._,ee.e,Xe.D9],encapsulation:2})}return G})();class Ve{constructor(){this.FromSlab=0,this.ToSlab=0,this.Percentage=0}}var we=J(84769);class De{constructor(a){this.MessageVisibility=!1,this.sBMConString="",this.bUseROffTimings=!1,this.bDocColumns=!1,this.bDirection=!1,this.sBMDBAdapterAccess="",this.IsAutoPost=!1,this.dtConfig=null,this.dicConf=new Fe.bT,this.BMCDeviceBrandName=n.y$.PactComboBoxData3("BMCDeviceBrandName",10),this.BMCDatabaseType=n.y$.PactComboBoxData3("BMCDatabaseType",10),this.BMCServerName=new Me.Dw(0),this.BMCUserId=new Me.Dw(0),this.BMCPassword=new Me.Dw(0),this.BMCDatabaseName=new Me.Dw(0),this.ETMEmpTableName=new Me.Dw(0),this.ETMEmpSeqNo=new Me.Dw(0),this.ETMEmpCode=new Me.Dw(0),this.ETMEmpCodeInDevice=new Me.Dw(0),this.ETMEmpName=new Me.Dw(0),this.ETMEmpWhere=new Me.Dw(0),this.APTMAttendPunchTableName=new Me.Dw(0),this.APTMEmpSeqNo=new Me.Dw(0),this.APTMEmpCode=new Me.Dw(0),this.APTMEmpCodeInDevice=new Me.Dw(0),this.APTMPunchDateTime=new Me.Dw(0),this.APTMDeviceNo=new Me.Dw(0),this.APTMDeviceNoValues=new Me.Dw(0),this.APTMDirection=new Me.Dw(0),this.APTMDirectionInVal=new Me.Dw(0),this.APTMDirectionOutVal=new Me.Dw(0),this.APTMAttendPunchWhere=new Me.Dw(0),this.FromDate=new M.Lc(0),this.ToDate=new M.Lc(0),this.DPCDocumentName=n.y$.PactComboBoxData3("DPCDocumentName",10),this.ROTUseROffTimings=Be.c.PactCheckBoxData_1("Use Round off Timings",10),this.GetMultipleCheckINOUTInaDay=Be.c.PactCheckBoxData_1("Get Multiple Check IN/OUT in a Day",10),this.OverrideAttendanceDoc=Be.c.PactCheckBoxData_1("Override Attendance Document",10),this.DonotPullBiometricDataifAttendanceisposted=Be.c.PactCheckBoxData_1("Do not Pull Biometric Data if Attendance is posted",10),this.AutoPostAtaTime=Be.c.PactCheckBoxData_1("AutoPost At a Time",10),this.SortBasedOn=n.y$.PactComboBoxData3("SortBasedOn",10),this.GDBQchkUseQuery=Be.c.PactCheckBoxData_1("Use Query to get the Data",10),this.GDBQtxtQuery=new Me.Dw(0),this.sFilter="",this.sSelectedEmpSeqNos="",this.sSelectedEmpCodes="",this.sbPostErrLog="",this.oDocument=null,this.bOverrideAttendanceDoc=!1,this.bDonotPullBiometricDataifAttendanceisposted=!1,this.bAutoPostAtaTime=!1,this.dtShiftsData=null,this.dtBioMetData=null,this.dsbEmps=null,this.dsbDims=null,this.sEmpSeqNosOnGrid="",this.bGetMultipleCheckInOutInaDay=!0;try{Logger.InfoLog("BiometricConfigViewModel::Entering BiometricConfigViewModel()"),this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.ShowConfigurations=!!d.d.SessionManager.IsActionAssigned(141,"Configuration"),this.Initialize(),this.subcontroller()}catch(l){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION BiometricConfigViewModel()\r\n"+l.Message+"\r\n"+l.stack)}}subcontroller(){var a=this;return(0,ie.A)(function*(){yield a.LoadConfig(),a.LoadGrid(),a.DPCDocumentName.SelectionChangedCommand.Subscribe(a,"DPCDocumentNameSelectionChanged"),a.sBMConString=a.GetBMConnString(),a.ToDate.Label="To Date",a.FromDate.Label="From Date"})()}Initialize(){this.BMCDeviceBrandName.Items.Clear(),this.BMCDeviceBrandName.Items.push(n._p.ComboBoxItems_2("***MANUAL***","1")),this.BMCDeviceBrandName.Items.push(n._p.ComboBoxItems_2("ViRDI->AC-5000RF","2")),this.BMCDeviceBrandName.SelectedValue="1",this.BMCDatabaseType.Items.Clear(),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("MS SQL Server","1")),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("MS Access","2")),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("API","3")),this.BMCDatabaseType.SelectedValue="1",this.DPCDocumentName.Items.Clear(),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Attendance","40089")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Time Sheet","40090")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Daily Attendance","40067")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Employee wise Work Sheet","40087")),this.DPCDocumentName.SelectedValue="40090",this.SortBasedOn.Items.Clear(),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("None","1")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpCode","2")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpName","3")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("TreeView","4")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpCode Numeric","5")),this.SortBasedOn.SelectedValue="1",this.dgCol=new K.O7,this.dgvROffTimings=new He.vv,this.dgvROffTimings.Columns=[],this.dgvROffTimings.Width="",this.dgvROffTimings.AllowReorderColumns=!1,this.dgvROffTimings.CanUserResizeColumns=!0,this.dgvROffTimings.CanUserSortColumns=!1,this.dgvROffTimings.CanUserDeleteRows=!0,this.dgvROffTimings.CanUserAddRows=!0,this.dgCol=new K.O7,this.dgCol.Header="Start Time",this.dgCol.DisplayMember="StartTime",this.dgCol.ValueMember="StartTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="End Time",this.dgCol.DisplayMember="EndTime",this.dgCol.ValueMember="EndTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="ROff Time",this.dgCol.DisplayMember="ROffTime",this.dgCol.ValueMember="ROffTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgvROffTimings.Table=[],this.dgvROffTimings.TableColumns.push("StartTime"),this.dgvROffTimings.TableColumns.push("StartTime_Key"),this.dgvROffTimings.TableColumns.push("EndTime"),this.dgvROffTimings.TableColumns.push("EndTime_Key"),this.dgvROffTimings.TableColumns.push("ROffTime"),this.dgvROffTimings.TableColumns.push("ROffTime_Key"),this.dgvDocColumns=new He.vv,this.dgvDocColumns.Columns=[],this.dgvDocColumns.Width="",this.dgvDocColumns.AllowReorderColumns=!1,this.dgvDocColumns.CanUserResizeColumns=!0,this.dgvDocColumns.CanUserSortColumns=!1,this.dgvDocColumns.CanUserDeleteRows=!0,this.dgvDocColumns.CanUserAddRows=!1,this.dgCol=new K.O7,this.dgCol.Header="Source",this.dgCol.DisplayMember="Source",this.dgCol.ValueMember="Source_Key",this.dgCol.DataType="TextBlock",this.dgCol.ReadOnly=!0,this.dgCol.Width=150,this.dgvDocColumns.Columns.push(this.dgCol);let a=[],l=d.d.empService.GetQueryData(0,"BIO001","","","");l&&l.Tables.length>0&&(a=l.Tables[0]),this.dgCol=new K.O7,this.dgCol.Header="Destination",null!=a&&a.length>0&&(this.dgCol.ValueBinding="Destination",this.dgCol.DisplayMember="USERCOLUMNNAME",this.dgCol.ValueMember="SYSCOLUMNNAME",this.dgCol.DataType="ComboBox",this.dgCol.ReadOnly=!1,this.dgCol.Width=150,this.dvcol=a,this.dgCol.ComboData=this.dvcol,this.dgvDocColumns.Columns.push(this.dgCol)),this.dgvDocColumns.Table=[],this.dgvDocColumns.TableColumns.push("Source"),this.dgvDocColumns.TableColumns.push("Source_Key"),this.dgvDocColumns.TableColumns.push("Destination"),this.dgvDocColumns.TableColumns.push("Destination_Key")}LoadGrid(){this.dgv=new He.vv,this.dgv.Columns=[],this.dgv.Width="",this.dgv.HeaderHeight=40,this.dgv.AllowReorderColumns=!1,this.dgv.CanUserResizeColumns=!0,this.dgv.CanUserSortColumns=!1,this.dgv.CanUserDeleteRows=!0,this.dgv.IsReadOnly=!0,this.dgCol=new K.O7,this.dgCol.Header="#",this.dgCol.DisplayMember="SlNo",this.dgCol.ID="SlNo",this.dgCol.Width=45,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Employee Code",this.dgCol.DisplayMember="EmpCode",this.dgCol.ID="EmpCode",this.dgCol.Width=120,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Employee Name",this.dgCol.DisplayMember="EmpName",this.dgCol.ID="EmpName",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Punch Date",this.dgCol.DisplayMember="PunchDate",this.dgCol.ID="PunchDate",this.dgCol.Width=90,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Shift Code",this.dgCol.DisplayMember="ShiftCode",this.dgCol.ID="ShiftCode",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Shift Name",this.dgCol.DisplayMember="ShiftName",this.dgCol.ID="ShiftName",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Act.\nStart Time",this.dgCol.DisplayMember="ActStartTime",this.dgCol.ID="ActStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Act.\nEnd Time",this.dgCol.DisplayMember="ActEndTime",this.dgCol.ID="ActEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Act.\nTotal Hours",this.dgCol.DisplayMember="ActTotHrs",this.dgCol.ID="ActTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bUseROffTimings&&(this.dgCol=new K.O7,this.dgCol.Header="ROff\nStart Time",this.dgCol.DisplayMember="ROffStartTime",this.dgCol.ID="ROffStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="ROff\nEnd Time",this.dgCol.DisplayMember="ROffEndTime",this.dgCol.ID="ROffEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="ROff\nTotal Hours",this.dgCol.DisplayMember="ROffTotHrs",this.dgCol.ID="ROffTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&(this.dgCol=new K.O7,this.dgCol.Header=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.DisplayMember=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.ID=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bDocColumns=!0);this.dgCol=new K.O7,this.dgCol.Header="Remarks",this.dgCol.DisplayMember="Remarks",this.dgCol.ID="Remarks",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgv.Table=[],this.dgv.TableColumns.push("SlNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("PunchDate"),this.dgv.TableColumns.push("ShiftCode"),this.dgv.TableColumns.push("ShiftName"),this.dgv.TableColumns.push("ActStartTime"),this.dgv.TableColumns.push("ActEndTime"),this.dgv.TableColumns.push("ActTotHrs"),this.bUseROffTimings&&(this.dgv.TableColumns.push("ROffStartTime"),this.dgv.TableColumns.push("ROffEndTime"),this.dgv.TableColumns.push("ROffTotHrs"));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&this.dgv.TableColumns.push(this.dgvDocColumns.Table[a].Source.toString());this.dgv.TableColumns.push("Remarks"),this.dgv.TableColumns.push("Row_Background"),this.dgvFailedRecord=new He.vv,this.dgvFailedRecord.Columns=[],this.dgvFailedRecord.Width="",this.dgvFailedRecord.HeaderHeight=30,this.dgvFailedRecord.CanUserResizeColumns=!0,this.dgvFailedRecord.IsReadOnly=!0,this.dgCol=new K.O7,this.dgCol.Header="Attendance Date",this.dgCol.DisplayMember="AttendanceDate",this.dgCol.ID="AttendanceDate",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Code",this.dgCol.DisplayMember="Code",this.dgCol.ID="Code",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Name",this.dgCol.DisplayMember="Name",this.dgCol.ID="Name",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new K.O7,this.dgCol.Header="Message",this.dgCol.DisplayMember="Message",this.dgCol.ID="Message",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgvFailedRecord.Table=[],this.dgvFailedRecord.TableColumns.push("AttendanceDate"),this.dgvFailedRecord.TableColumns.push("Code"),this.dgvFailedRecord.TableColumns.push("Name"),this.dgvFailedRecord.TableColumns.push("Message")}dgv_BeforeRowDeleting(a){return!1}LoadConfig(){var a=this;return(0,ie.A)(function*(){a.dicConf.Clear();let l=d.d.empService.GetQueryData(0,"BIO002","","","");if(l&&l.Tables.length>0&&(a.dtConfig=l.Tables[0]),null!=a.dtConfig&&a.dtConfig.length>0){for(let t=0;t<a.dtConfig.length;t++)a.dicConf.push(c.J0.String(a.dtConfig[t].Name),c.J0.String(a.dtConfig[t].Value));if(a.drc=a.dtConfig.filter(t=>"BMCDeviceBrandName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDeviceBrandName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCDatabaseType"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseType.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCServerName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCServerName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCUserId"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCUserId.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCPassword"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&""!=a.drc[0].Value.toString()){let t=yield d.d.empService.DecryptString(a.drc[0].Value.toString());a.BMCPassword.Text=t.DecryptString}if(a.drc=a.dtConfig.filter(t=>"BMCDatabaseName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpTableName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpSeqNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpCode"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpCodeInDevice"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpWhere"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMAttendPunchTableName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpSeqNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpCode"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpCodeInDevice"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMPunchDateTime"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMPunchDateTime.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDeviceNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDeviceNoValues"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNoValues.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirection"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirection.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirectionInVal"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionInVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirectionOutVal"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionOutVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMAttendPunchWhere"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"DPCDocumentName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DPCDocumentName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"GetMultipleCheckINOUTInaDay"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GetMultipleCheckINOUTInaDay.IsChecked=(0,le.yG0)(a.drc[0].Value),a.bGetMultipleCheckInOutInaDay=(0,le.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"OverrideAttendanceDoc"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.OverrideAttendanceDoc.IsChecked=(0,le.yG0)(a.drc[0].Value),a.bOverrideAttendanceDoc=(0,le.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"DonotPullBiometricDataifAttendanceisposted"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DonotPullBiometricDataifAttendanceisposted.IsChecked=(0,le.yG0)(a.drc[0].Value),a.bDonotPullBiometricDataifAttendanceisposted=(0,le.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"AutoPostAtaTime"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.AutoPostAtaTime.IsChecked=(0,le.yG0)(a.drc[0].Value),a.bAutoPostAtaTime=(0,le.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"SortBasedOn"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.SortBasedOn.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ROTUseROffTimings"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ROTUseROffTimings.IsChecked=(0,le.yG0)(a.drc[0].Value),a.bUseROffTimings=a.ROTUseROffTimings.IsChecked),a.dgvROffTimings.Clear(),a.drc=a.dtConfig.filter(t=>"ROffTimingsXML"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsROffTimings=new c.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsROffTimings.ReadXml(a.drc[0].Value.toString());let t=new c.VB;t.LoadXml(a.drc[0].Value.toString());let i=t.SelectSingleNode("RoundOffTimings");if(null!=i){let o;if(i.childNodes.length>0)for(let r=0;r<i.childNodes.length;r++)o=a.dgvROffTimings.NewRow(),o.StartTime=i.childNodes[r].attributes.MinsFrom.value,o.StartTime_Key=i.childNodes[r].attributes.MinsFrom.value,o.EndTime=i.childNodes[r].attributes.MinsUpto.value,o.EndTime_Key=i.childNodes[r].attributes.MinsUpto.value,o.ROffTime=i.childNodes[r].attributes.ROffTime.value,o.ROffTime_Key=i.childNodes[r].attributes.ROffTime.value,a.dgvROffTimings.addRow(o)}}if(a.dgvDocColumns.Clear(),a.drc=a.dtConfig.filter(t=>"DocColumnsXML"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsDocColumns=new c.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsDocColumns.ReadXml(a.drc[0].Value.toString());let t=new c.VB;t.LoadXml(a.drc[0].Value.toString());let i=t.SelectSingleNode("DocColumns");if(null!=i){let o;if(i.childNodes.length>0)for(let r=0;r<i.childNodes.length;r++)o=a.dgvDocColumns.NewRow(),o.Source=i.childNodes[r].attributes.Source.value,o.Source_Key=i.childNodes[r].attributes.Source.value,o.Destination=i.childNodes[r].attributes.Destination.value,o.Destination_Key=i.childNodes[r].attributes.Destination.value,a.dgvDocColumns.addRow(o)}}a.drc=a.dtConfig.filter(t=>"GDBQchkUseQuery"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQchkUseQuery.IsChecked=(0,le.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"GDBQtxtQuery"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQtxtQuery.Text=a.drc[0].Value.toString().Replace("[ENTER]","\r\n"))}})()}OnButtonClick(a){if(null!=a&&"BMCTestConn"!=a.toString()&&"SaveConfig"!=a.toString())if("GetData"==a.toString())this.GetData_Click();else if("PostData"==a.toString())this.PostData_Click();else if("Export"==a.toString())this.Export_Click();else if("ExportFailedRecords"==a.toString()){let l="";l+="<html><body style='color:blac;background-color:white;'>",l+="<style>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}",l+="</style>",l+="<table border=1 width='950' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >",l+="<tr><td class='hdr'><b>Sno<b></td>",l+="<td class='hdr' width='150'><b>Daily Attendance Date<b></td>",l+="<td class='hdr' width='150'><b>Code<b></td>",l+="<td class='hdr' width='150'><b>Name<b></td>",l+="<td class='hdr' width='750'><b>Message<b></td></tr>";let t=new c.VB;t.LoadXml(this.sbPostErrLog.toString());let i=t.SelectSingleNode("FailedRecord");if(null!=i&&i.childNodes.length>0)for(let o=0;o<i.childNodes.length;o++)l+="<tr",l+=">",l+="<td align='left' >"+o+"1</td>",l+="<td align='left' >"+i.childNodes[o].attributes.DADate!=null?i.childNodes[o].attributes.DADate.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Code!=null?i.childNodes[o].attributes.Code.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Name!=null?i.childNodes[o].attributes.Name.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Error!=null?i.childNodes[o].attributes.Error.value:"</td>",l+="</tr>";l+="</table>",l+="</body>",l+="</html>"}}Filter_Click(){var a=this;return(0,ie.A)(function*(){if(a.sSelectedEmpSeqNos=a.sSelectedEmpCodes="",null==a.objEmpFilter?a.objEmpFilter=new lt.t("",0,11):(a.objEmpFilter.Filter=11,a.objEmpFilter.InitControls()),a.objEmpFilter.Filter>0&&(yield d.d.page.openDialog(a.objEmpFilter,ct.m,{ShowCenter:!0})),a.objEmpFilter.IsCompleted)if(a.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";a.objEmpFilter.CostCenterFilters.forEach(h=>{if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(null==h.SelectedNodes.find(g=>g.Id==l&&g.IsGroup))if(o+=" AND ",mt.IPrefetchFilter.IsGroupTree(h)){let g="";for(let D=0;D<h.SelectedNodes.length;D++)(null==h.SelectedNodes[D].Parent||!h.SelectedNodes[D].Parent.IsSelected)&&(g.length>0&&(g+=","),g+=h.SelectedNodes[D].Id);0==g.length&&(g+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from ",o+=qe.A.GetTagTableName(h.CostCenterID)+" T with(nolock),",o+=qe.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=g.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let g=0;g<h.SelectedNodes.length;g++)g>0&&(o+=","),o+=h.SelectedNodes[g].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}),a.sFilter=o.toString(),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let r=[];if(r.push(a.ToDate.Date.ToString("dd MMM yyyy")),r.push(a.sFilter),r.push(0),r.push(d.d.SessionManager.RoleID),r.push(d.d.SessionManager.UserID),r.push(d.d.SessionManager.LanguageID),a.dtFiltEmps=d.d.common.GetDataSet_SP(r,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let h=0;h<a.dtFiltEmps.length;h++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[h].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[h].EmpCode.toString()+"'"}else a.objEmpFilter.Filter>0&&a.FilterEmployees()})()}FilterEmployees(){try{Logger.InfoLog("BiometricConfigViewModel::Entering FilterEmployees()"),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),c.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let a=[];if(a.push(this.ToDate.Date.ToString("dd MMM yyyy")),a.push(this.sFilter),a.push(0),a.push(d.d.SessionManager.RoleID),a.push(d.d.SessionManager.UserID),a.push(d.d.SessionManager.LanguageID),this.dtFiltEmps=d.d.common.GetDataSet_SP(a,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=this.dtFiltEmps&&this.dtFiltEmps.length>0)for(let l=0;l<this.dtFiltEmps.length;l++)this.sSelectedEmpSeqNos.length>0&&(this.sSelectedEmpSeqNos+=",",this.sSelectedEmpCodes+=","),this.sSelectedEmpSeqNos+=this.dtFiltEmps[l].EmpSeqNo.toString(),this.sSelectedEmpCodes+="'"+this.dtFiltEmps[l].EmpCode.toString()+"'";Logger.InfoLog("BiometricConfigViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION FilterEmployees()\r\n"+a.Message+"\r\n"+a.stack)}}Export_Click(){}PostData_Click(){it.RibbonExtViewModel.GetPay_BioPostData(this)}GetGroupByFilterEmployees(){let a="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",l=[];return l.push(this.ToDate.Date.ToString("dd MMM yyyy")),l.push(a),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),d.d.common.GetDataSet_SP(l,"spPAY_GetEmpMasterCCDetails").Tables[0]}CreateSQLTable(a,l){let t="",i="",o="";t=" CREATE TABLE "+a+"(";for(let r=0;r<l.Columns.length;r++){switch(o="",i=l.Columns[r].DataType.toString(),i){case"System.Int32":o=" int ";break;case"System.Int64":o=" bigint ";break;case"System.Int16":o=" smallint ";break;case"System.Byte":o=" tinyint ";break;case"System.Decimal":o=" float ";break;case"System.DateTime":o=" datetime ";break;case"System.String":o=c.J0.Format(" nvarchar({0}) ",-1==l.Columns[r].MaxLength?"max":l.Columns[r].MaxLength.toString())}""!=o?(t+="\n ["+l.Columns[r].ColumnName+"] ",t+=o,t+=","):(l.Columns.Remove(l.Columns[r].ColumnName),l.AcceptChanges(),r--)}return t.substr(0,t.length-1)+"\n)"}BulkInsertData(a,l){}GetShiftsAssignedData(){let l=d.d.empService.GetQueryData(0,"BIO003",d.d.SessionManager.Preferences.ShiftAssignBasedOn,this.FromDate.Date.ToString("dd MMM yyyy"),this.ToDate.Date.ToString("dd MMM yyyy"));l&&l.Tables.length>0&&(this.dtShiftsData=l.Tables[0])}GetBioMetricData(){this.dicConf.APTMAttendPunchTableName=this.dicConf.APTMAttendPunchTableName.Replace("@Month",this.FromDate.Date.iMonth().toString()).Replace("@Year",this.FromDate.Date.getFullYear().toString());let a="\n        Select EmpCode, EmpName, CONVERT(VARCHAR(11), PunchTime, 106) as PunchDate, PunchTime, CONVERT(VARCHAR(8), PunchTime, 108) as PTime ";this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=",DeviceNo as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,Direction as Direction",this.bDirection=!0),a+=" FROM ( Select EMP."+this.dicConf.ETMEmpCode+" as EmpCode, EMP."+this.dicConf.ETMEmpName+" as EmpName, ",a+=" AP."+this.dicConf.APTMPunchDateTime+" as PunchTime ",this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDeviceNo+" as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDirection+" as Direction "),a+=" From "+this.dicConf.APTMAttendPunchTableName+" AP WITH(NOLOCK)",""!=this.dicConf.APTMEmpSeqNo?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpSeqNo+"=AP."+this.dicConf.APTMEmpSeqNo+" ":""!=this.dicConf.APTMEmpCode?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCode+"=AP."+this.dicConf.APTMEmpCode:""!=this.dicConf.APTMEmpCodeInDevice&&(a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCodeInDevice+"=AP."+this.dicConf.APTMEmpCodeInDevice),a+=" WHERE 1=1 ",this.sSelectedEmpCodes.Trim().length>0&&(a+=" AND EMP."+this.dicConf.ETMEmpCode+" IN ("+this.sSelectedEmpCodes+") "),this.dicConf.ETMEmpWhere.Trim().length>0&&(a+=" AND "+this.dicConf.ETMEmpWhere),this.dicConf.APTMAttendPunchWhere.Trim().length>0&&(a+=" AND "+this.dicConf.APTMAttendPunchWhere),this.dicConf.APTMDeviceNo.Trim().length>0&&this.dicConf.APTMDeviceNoValues.Trim().length>0&&(a+=" AND AP."+this.dicConf.APTMDeviceNo+" IN("+this.dicConf.APTMDeviceNoValues+")"),a+=" AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+"')<=0 AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"')>=0\n) as tbl\n        Order By PunchTime, EmpCode ";let l=[];l.push(this.BMCDatabaseType.SelectedValue),l.push(this.BMCServerName.Text.Trim()),l.push(this.BMCDatabaseName.Text.Trim()),l.push(this.BMCUserId.Text.Trim()),l.push(this.BMCPassword.Text);let t=d.d.empService.ReportDataSet("RPT022",!0,a,"","","","",l);this.dtBioMetData=t.Tables[0]}GetData_Click(){var a=this;return(0,ie.A)(function*(){let l=0;if(a.sEmpSeqNosOnGrid="",a.ListVisbility=!1,yield a.LoadConfig(),a.IsAutoPost){let h=[];if(h.push(a.ToDate.Date.ToString("dd MMM yyyy")),h.push(a.sFilter),h.push(0),h.push(d.d.SessionManager.RoleID),h.push(d.d.SessionManager.UserID),h.push(d.d.SessionManager.LanguageID),a.dtFiltEmps=d.d.common.GetDataSet_SP(h,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let C=0;C<a.dtFiltEmps.length;C++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[C].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[C].EmpCode.toString()+"'"}else yield a.Filter_Click();if(a.FromDate.Date>a.ToDate.Date)return a.DisplayMessage="'From Date' should be less than or Equal to 'To Date'",void(a.MessageVisibility=!0);if(0==a.sSelectedEmpCodes.length)return a.DisplayMessage="No Employees found",void(a.MessageVisibility=!0);a.DispMessage="Loading data, Please wait....",a.MsgVisibility=!0;let t="";for(let h=0;h<a.dgvDocColumns.Table.length;h++)null!=a.dgvDocColumns.Table[h].Destination&&null!=a.dgvDocColumns.Table[h].Destination&&""!=a.dgvDocColumns.Table[h].Destination.toString()&&"-1"!=a.dgvDocColumns.Table[h].Destination.toString()&&a.dgvDocColumns.Table[h].Destination.toString().startsWith("dcCCNID")&&(t.length>0&&(t+=","),t+=(5e4+parseInt(a.dgvDocColumns.Table[h].Destination.toString().Replace("dcCCNID",""))).toString());t.length>0&&(a.dsbDims=d.d.empService.GetQueryData(0,"BIO007",JSON.stringify(t),"",""));let i="";if(a.dsbEmps=d.d.empService.GetQueryData(0,"BIO004","","",""),a.dgv.Clear(),a.GDBQchkUseQuery.IsChecked&&a.GDBQtxtQuery.Text.Trim().length>0){let h=[],C="";if("1"==a.BMCDatabaseType.SelectedValue){C=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","'"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@TODATE@","'"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=d.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}else if("2"==a.BMCDatabaseType.SelectedValue){C=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","#"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@TODATE@","#"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=d.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}if(null!=h&&h.Tables.length>0&&h.Tables[0].length>0){let g,D;l=0;for(let p=0;p<h.Tables[0].length;p++)D=a.dsbEmps.Tables[0].filter(e=>e.Code==h.Tables[0][p].EmpCode.toString()),null!=D&&D.length>0&&(a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=D[0].NodeID.toString(),l++,g=a.dgv.NewRow(),g.SlNo=l.toString(),g.EmpCode=h.Tables[0][p].EmpCode,g.EmpName=h.Tables[0][p].EmpName,g.PunchDate=new Date(h.Tables[0][p].PunchDate).ToString("dd/MMM/yyyy"),g.ShiftCode=h.Tables[0][p].ShiftCode,g.ShiftName=h.Tables[0][p].ShiftName,h.Tables[0][p].StartTime.toString().Contains(".")||(h.Tables[0][p].StartTime=h.Tables[0][p].StartTime.toString().Contains(":")?h.Tables[0][p].StartTime.toString().Replace(":","."):h.Tables[0][p].StartTime.toString()+".0"),g.ActStartTime=new Date(h.Tables[0][p].StartTime.toString().Replace(".",":")).ToString("HH:mm"),h.Tables[0][p].EndTime.toString().Contains(".")||(h.Tables[0][p].EndTime=h.Tables[0][p].EndTime.toString().Contains(":")?h.Tables[0][p].EndTime.toString().Replace(":","."):h.Tables[0][p].EndTime.toString()+".0"),g.ActEndTime=new Date(h.Tables[0][p].EndTime.toString().Replace(".",":")).ToString("HH:mm"),g.ActTotHrs=parseFloat(h.Tables[0][p].TotHrs).ToString("00.00"),0==parseFloat(g.ActTotHrs)&&(g.Row_Background="#F77B7E"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(g["IN Device No"]=h.Tables[0][p].INDeviceNo),a.dgv.TableColumns.Contains("OUT Device No")&&(g["OUT Device No"]=h.Tables[0][p].OUTDeviceNo)),g.Remarks="",a.dgv.addRow(g));a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0;return}if("2"==a.BMCDatabaseType.SelectedValue){a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim();let g="";g=" SELECT * FROM "+a.dicConf.ETMEmpTableName,a.dicConf.APTMAttendPunchTableName=a.dicConf.APTMAttendPunchTableName.Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString()),g=" SELECT * FROM "+a.dicConf.APTMAttendPunchTableName+" WHERE DateValue("+a.dicConf.APTMPunchDateTime+") BETWEEN #"+a.FromDate.Date.AddDays(-1).ToString("dd/MMM/yyyy")+"# AND #"+a.ToDate.Date.AddDays(1).ToString("dd/MMM/yyyy")+"#"}"3"==a.BMCDatabaseType.SelectedValue&&(a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim());let o=[],r=!1;if(""!=a.dicConf.ETMEmpTableName.Trim()&&""!=a.dicConf.APTMAttendPunchTableName.Trim()){if(null!=a.dtFiltEmps&&a.dtFiltEmps.length>0){if(a.GetShiftsAssignedData(),null==a.dtShiftsData||0==a.dtShiftsData.length)return a.MsgVisibility=!1,a.DisplayMessage="Enter atlest one Shift Assign document for Default Employee",void(a.MessageVisibility=!0);let C=d.d.SessionManager.Preferences.ShiftAssignBasedOn;a.GetBioMetricData();let g=[];g.push("EmpSeqNo"),g.push("EmpCode"),g.push("EmpName"),g.push("PunchDate"),g.push("StartTime"),g.push("EndTime"),g.push("TotHrs"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&g.push("IN Device No"),a.dgv.TableColumns.Contains("OUT Device No")&&g.push("OUT Device No")),g.push("Remarks"),g.push("lfts"),g.push("EmpCodeNumeric");let e,T,P,A,_,x,F,D=a.FromDate.Date.OnlyDate(),p=a.ToDate.Date.OnlyDate(),j=null,E="",b="",N=!1,te=0,Q=0;l=0;let W=a.dtBioMetData.ToTable(!0,["EmpCode","EmpName"]);if(null!=W&&W.length>0){let w=null,ne="";for(let ve=0;ve<W.length;ve++)P=a.dtFiltEmps.filter(L=>L.EmpCode==W[ve].EmpCode.toString()),null!=P&&P.length>0&&(ne.length>0&&(ne+=","),ne+=P[0].EmpSeqNo.toString());if("-2"!=C){let ve=[];ve.push(p.ToString("dd MMM yyyy")),ve.push(" AND EmpSeqNo IN("+ne+")"),ve.push(0),ve.push(d.d.SessionManager.RoleID),ve.push(d.d.SessionManager.UserID),ve.push(d.d.SessionManager.LanguageID),w=d.d.common.GetDataSet_SP(ve,"spPAY_GetEmpMasterCCDetails").Tables[0]}a.bDonotPullBiometricDataifAttendanceisposted&&(i="",40067==parseInt(a.DPCDocumentName.SelectedValue)||40087==parseInt(a.DPCDocumentName.SelectedValue)?i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tDocumentType = 67 AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+ne+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') ":(40089==parseInt(a.DPCDocumentName.SelectedValue)||40090==parseInt(a.DPCDocumentName.SelectedValue))&&(i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tCostCenterID = "+parseInt(a.DPCDocumentName.SelectedValue)+" AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+ne+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') "),i.Trim().length>0&&(j=d.d.empService.GetQueryData(parseInt(a.DPCDocumentName.SelectedValue),"BIO008",JSON.stringify(ne),a.FromDate.Date.ToString("dd/MMM/yyyy"),a.ToDate.Date.ToString("dd/MMM/yyyy"))));let ce=null,Ce=null;for(;D<=p;){for(let ve=0;ve<W.length;ve++){if(r=!1,P=a.dtFiltEmps.filter(Se=>Se.EmpCode==W[ve].EmpCode.toString()),null!=P&&P.length>0){if(D<c.J0.ParseDate(P[0].DOJ))continue;b=P[0].EmpSeqNo.toString(),te=parseInt(P[0].lft)}if(a.bDonotPullBiometricDataifAttendanceisposted&&null!=j&&j.length>0&&(_=j.filter(Se=>Se.EmpSeqNo==b&&Se.DADate==D.ToString("dd/MMM/yyyy")),null!=_&&_.length>0))continue;l++,e={},e.SNo=l.toString(),e.EmpSeqNo=b,e.lfts=te,null!=a.SortBasedOn.SelectedValue&&"5"==a.SortBasedOn.SelectedValue&&(Q=0,Q=c.J0.Int(W[ve].EmpCode),e.EmpCodeNumeric=Q>0?Q:0),e.EmpCode=W[ve].EmpCode,e.EmpName=W[ve].EmpName,e.PunchDate=D.ToString("dd/MMM/yyyy"),N=!1;let L="",Ge=a.dtShiftsData;if("-2"==C)L="EmpSeqNo IN(1,"+b+") ",Ge=Ge.filter(Se=>1==Se.EmpSeqNo||Se.EmpSeqNo==b);else{let Se="",ge=C.split(",");if(null!=ge&&ge.length>0){let Re=w.filter(oe=>oe.EmpSeqNo==b);for(let oe=0;oe<ge.length;oe++)null!=ge[oe]&&""!=ge[oe]&&(Se="-2"==ge[oe]?"EmpSeqNo":"dcCCNID"+(parseInt(ge[oe])-5e4),L.length>0&&(L+=" AND "),L+=Se+"="+Re[0][Se.Replace("dcCCNID","CCNID")],Ge=Ge.filter(ke=>ke[Se]==Re[0][Se.Replace("dcCCNID","CCNID")]))}}if(E=L+" AND AssigningFrom <='"+D.ToString("dd/MMM/yyyy")+"' AND AssigningUpto >='"+D.ToString("dd/MMM/yyyy")+"'",Ge=Ge.filter(Se=>null!=Se.AssigningFrom&&new Date(Se.AssigningFrom.ToString("dd/MMM/yyyy"))<=D&&null!=Se.AssigningUpto&&new Date(Se.AssigningUpto.ToString("dd/MMM/yyyy"))>=D),P=Ge,P.sort((Se,ge)=>Se.DocID>ge.DocID||Se.DocID==ge.DocID&&Se.EmpSeqNo>ge.EmpSeqNo?1:-1),null!=P&&P.length>0){let Se=(new Date).OnlyDate();if(x=c.J0.ParseDate(Se.ToString("dd/MMM/yyyy")+" "+P[0].ShiftBMStartTime),F=c.J0.ParseDate(Se.ToString("dd/MMM/yyyy")+" "+P[0].ShiftBMEndTime),x>F?(x=D.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=D.AddDays(1).AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())):(x=D.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=D.AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())),E="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"'",A=a.dtBioMetData.filter(ge=>ge.EmpCode==e.EmpCode.toString()&&new Date(ge.PunchTime)>=x&&new Date(ge.PunchTime)<=F),A.sort((ge,Re)=>ge.PunchTime-Re.PunchTime),!(null!=A&&A.length>0))continue;if(1==A.length)e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),F=x,a.bDirection&&(e.Remarks=a.APTMDirectionInVal.Text==A[0].Direction.toString()?"Check-Out Missing":"Check-In Missing"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[0].DeviceNo.toString());else if(a.bDirection){let ge=!1,Re=!1;if(a.bGetMultipleCheckInOutInaDay){for(let oe=0;oe<A.length;oe++){ge=!1,Re=!1,T={};for(let ke=0;ke<e.ItemArray.length;ke++)T[ke]=e[ke];a.APTMDirectionInVal.Text==A[oe].Direction.toString()&&(T.StartTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[oe].DeviceNo.toString()),ge=!0),a.APTMDirectionOutVal.Text==A[oe].Direction.toString()&&(T.EndTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[oe].DeviceNo.toString()),Re=!0),(ge||Re)&&(A.length>oe+1?(ge&&(a.APTMDirectionOutVal.Text==A[oe+1].Direction.toString()?(T.EndTime=new Date(A[oe+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[oe+1].DeviceNo.toString()),oe++):(T.EndTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[oe].DeviceNo.toString()),T.Remarks="Check-Out Missing",F=x)),Re&&(T.StartTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[oe].DeviceNo.toString()),T.Remarks="Check-In Missing",F=x)):(ge&&(T.EndTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[oe].DeviceNo.toString()),T.Remarks="Check-Out Missing",F=x),Re&&(T.StartTime=new Date(A[oe].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[oe].DeviceNo.toString()),T.Remarks="Check-In Missing",F=x)),x=new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()),T.TotHrs=it.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(T))}N=!0}else{if(E="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionInVal.Text+"'",ce=a.dtBioMetData.filter(oe=>oe.EmpCode==e.EmpCode.toString()&&new Date(oe.PunchTime)>=x&&new Date(oe.PunchTime)<=F&&oe.Direction==a.APTMDirectionInVal.Text),ce.sort((oe,ke)=>oe.PunchTime-ke.PunchTime),null!=ce&&ce.length>0&&(ge=!0,e.StartTime=new Date(ce[0].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=ce[0].DeviceNo.toString())),E="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionOutVal.Text+"'",Ce=a.dtBioMetData.filter(oe=>oe.EmpCode==e.EmpCode.toString()&&new Date(oe.PunchTime)>=x&&new Date(oe.PunchTime)<=F&&oe.Direction==a.APTMDirectionInVal.Text),Ce.sort((oe,ke)=>oe.PunchTime-ke.PunchTime),null!=Ce&&Ce.length>0&&(ge?new Date(Ce[Ce.length-1].PunchTime)>new Date(ce[0].PunchTime)&&(Re=!0,e.EndTime=new Date(Ce[Ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=Ce[Ce.length-1].DeviceNo.toString())):(Re=!0,e.EndTime=new Date(Ce[Ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=Ce[Ce.length-1].DeviceNo.toString()))),!ge&&!Re)continue;(!ge||!Re)&&(F=x,ge?(e.EndTime=new Date(ce[0].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=ce[0].DeviceNo.toString()),e.Remarks="Check-Out Missing"):(e.StartTime=new Date(Ce[Ce.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=Ce[Ce.length-1].DeviceNo.toString()),e.Remarks="Check-In Missing"))}}else if(a.bGetMultipleCheckInOutInaDay&&A.length>2){for(let ge=0;ge<A.length;ge+=2){T={};for(let Re=0;Re<e.ItemArray.length;Re++)T[Re]=e[Re];T.StartTime=new Date(A[ge].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(T["IN Device No"]=A[ge].DeviceNo.toString()),ge==A.length-1?(T.EndTime=new Date(A[ge].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ge].DeviceNo.toString())):(T.EndTime=new Date(A[ge+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(T["OUT Device No"]=A[ge+1].DeviceNo.toString())),x=new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+T.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+T.EndTime.toString()),T.TotHrs=it.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(T)}N=!0}else e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[A.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[A.length-1].DeviceNo.toString());N||(x=new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()),e.TotHrs=it.RibbonExtViewModel.CalculateTotalTime(x,x,F,F))}else{if(!a.IsAutoPost)return a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+W[ve].EmpCode,void(a.MessageVisibility=!0);a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+W[ve].EmpCode,a.MessageVisibility=!0,r=!0}r||N||o.push(e)}D=D.AddDays(1)}}}if(l=0,o.length>0){let C,g,D="";null!=a.SortBasedOn.SelectedValue&&"1"!=a.SortBasedOn.SelectedValue&&("2"==a.SortBasedOn.SelectedValue?D="EmpCode":"3"==a.SortBasedOn.SelectedValue?D="EmpName":"4"==a.SortBasedOn.SelectedValue?D="lfts":"5"==a.SortBasedOn.SelectedValue&&(D="EmpCodeNumeric"));for(let p=0;p<o.length;p++){if(g=a.dsbEmps.Tables[0].filter(T=>T.Code==o[p].EmpCode.toString()),!(null!=g&&g.length>0))continue;a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=g[0].NodeID.toString(),l++;let e=(new Date).OnlyDate();if(C=a.dgv.NewRow(),C.SlNo=l.toString(),C.EmpCode=o[p].EmpCode,C.EmpName=o[p].EmpName,C.PunchDate=new Date(o[p].PunchDate).ToString("dd/MMM/yyyy"),C.ActStartTime=c.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].StartTime).ToString("HH:mm"),C.ActEndTime=c.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].EndTime).ToString("HH:mm"),C.ActTotHrs=o[p].TotHrs,a.bUseROffTimings){let T,P,A,x,_=0;if(T=c.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+C.ActStartTime),P=c.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+C.ActEndTime),null!=a.dsROffTimings.Tables.ROffRow&&(x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=T.ToString("HH:mm")&&T.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(T=new Date(T.getFullYear(),T.iMonth(),T.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0)),x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=P.ToString("HH:mm")&&P.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(P=new Date(P.getFullYear(),P.iMonth(),P.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0))),C.ROffStartTime=T.ToString("HH:mm"),C.ROffEndTime=P.ToString("HH:mm"),_=0,A=P.Subtract(T),T>P){C.ROffTotHrs="00.00",C.Row_Background="#F77B7E";continue}A=P.Subtract(T),_=parseFloat(A.Hours.ToString("00")+"."+A.Minutes.ToString("00")),C.ROffTotHrs=_.ToString("00.00")}a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(C["IN Device No"]=o[p]["IN Device No"].toString()),a.dgv.TableColumns.Contains("OUT Device No")&&(C["OUT Device No"]=o[p]["OUT Device No"].toString())),0==parseFloat(C.ActTotHrs)&&(C.Row_Background="#F77B7E"),C.Remarks=c.J0.String(o[p].Remarks),a.dgv.addRow(C)}a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0}})()}GetBMConnString(){return"1"==this.BMCDatabaseType.SelectedValue?"Data Source="+this.BMCServerName.Text.Trim()+";Initial Catalog="+this.BMCDatabaseName.Text.Trim()+";Persist Security Info=True;User ID="+this.BMCUserId.Text.Trim()+";Password="+this.BMCPassword.Text:""}}var Ie=J(13816);function nt(G,a){if(1&G&&(s.j41(0,"div",20),s.EFF(1,"\n                            "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                            "),s.k0s(),s.EFF(4,"\n                        "),s.k0s()),2&G){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgv)("group",l.form)}}function ze(G,a){if(1&G&&(s.qex(0),s.EFF(1,"\n                                "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                                "),s.k0s(),s.EFF(4,"\n                            "),s.bVm()),2&G){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgvFailedRecord)("group",l.form)}}let ye=(()=>{class G{constructor(){this.form=new v.gE({})}ngOnInit(){this.params?.obj&&(this.obj=this.params.obj)}static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275cmp=s.VBU({type:G,selectors:[["app-biometric-config-view-model"]],decls:64,vars:17,consts:[["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-export"],[1,"document-screen","main_div"],[1,"PACTTabFields","pagesection-noborder","tab_content","tab-exrafields","custom_accordion",2,"height","100%"],[1,"master-tab-container",2,"width","100%","height","98%"],["heading","Data",3,"removable"],[1,"row","form-row",2,"width","100%","margin-left","10px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"overflow","scroll"],[4,"ngIf"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"span",3),s.EFF(7),s.k0s(),s.EFF(8,"\n\n        "),s.k0s(),s.EFF(9,"\n        "),s.j41(10,"div",4),s.EFF(11,"\n            "),s.j41(12,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("GetData")}),s.nrm(13,"i",6),s.EFF(14),s.nI1(15,"translate"),s.k0s(),s.EFF(16,"\n            "),s.j41(17,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("PostData")}),s.nrm(18,"i",7),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n            "),s.j41(22,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("Export")}),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n        "),s.k0s(),s.EFF(27,"\n    "),s.k0s(),s.EFF(28,"\n\n    "),s.j41(29,"div",9),s.EFF(30,"\n\n        "),s.j41(31,"div",10),s.EFF(32,"\n            "),s.j41(33,"tabset",11),s.EFF(34,"\n                "),s.j41(35,"tab",12),s.EFF(36,"\n                    "),s.j41(37,"div",13),s.EFF(38,"\n                        "),s.j41(39,"div",14),s.EFF(40,"\n                            "),s.eu8(41,15),s.EFF(42,"\n                        "),s.k0s(),s.EFF(43,"\n                        "),s.j41(44,"div",14),s.EFF(45,"\n                            "),s.eu8(46,15),s.EFF(47,"\n                        "),s.k0s(),s.EFF(48,"\n                    "),s.k0s(),s.EFF(49,"\n                    "),s.j41(50,"div",16),s.EFF(51,"\n                        "),s.DNE(52,nt,5,2,"div",17),s.EFF(53,"\n                        "),s.j41(54,"div",18),s.EFF(55,"\n                            "),s.DNE(56,ze,5,2,"ng-container",19),s.EFF(57,"\n\n                        "),s.k0s(),s.EFF(58,"\n                    "),s.k0s(),s.EFF(59,"\n                "),s.k0s(),s.EFF(60,"\n            "),s.k0s(),s.EFF(61,"\n        "),s.k0s(),s.EFF(62,"\n    "),s.k0s(),s.EFF(63,"\n"),s.k0s()),2&t&&(s.R7$(7),s.SpI("\n                ",i.obj.Title,"\n            "),s.R7$(7),s.JRh(s.bMT(15,11,"Get Data")),s.R7$(5),s.JRh(s.bMT(20,13,"Post")),s.R7$(5),s.JRh(s.bMT(25,15,"Export")),s.R7$(11),s.Y8G("removable",!1),s.R7$(6),s.Y8G("obj",i.obj.FromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.ToDate)("group",i.form),s.R7$(6),s.Y8G("ngIf",i.obj.dgv),s.R7$(4),s.Y8G("ngIf",i.obj.ListVisbility))},dependencies:[fe.bT,Ye._,Qe.X,Ie.V6,Ie.fw,Xe.D9]})}return G})();class Ne{static LoadPayrollScreen(a,l){if(50054!=a.FeatureID)if(256==a.FeatureID){let t=new Le.SetPayrollDateViewModel;d.d.page.ShowDialog(t,_e.SetPayrollDateComponent,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")})}else if(258==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Lt);if(t)d.d.page.SetActiveTab(t);else{let i=new Lt(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Zt,params:{obj:i}})}}else if(260==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof ht);if(t)d.d.page.SetActiveTab(t);else{let i=new ht(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Ke,params:{obj:i}})}}else if(261==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Vt.N);if(t)d.d.page.SetActiveTab(t);else{let i=new Vt.N(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:ia,params:{obj:i}})}}else if(262==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof _t);if(t)d.d.page.SetActiveTab(t);else{let i=new _t;i.Title=i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:u,params:{obj:i}})}}else if(263!=a.FeatureID)if(264==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof q);if(t)d.d.page.SetActiveTab(t);else{let i=new q;i.IncomeTaxComputationViewModel(),i.Title=i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Oe,params:{obj:i}})}}else if(40095==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Mt.FinalSettlementViewModel);if(t)d.d.page.SetActiveTab(t);else{let i=new Mt.FinalSettlementViewModel(l);i.FinalSettlementViewModel_1().then(o=>{1==i.DialogResult&&(i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:na.FinalSettlementComponent,params:{obj:i}}))})}}else if(141==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof De);if(t)d.d.page.SetActiveTab(t);else{let i=new De(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:ye,params:{obj:i}})}}else if(266==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Ot);if(t)d.d.page.SetActiveTab(t);else{let i=new Ot(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:sa,params:{obj:i}})}}else if(267!=a.FeatureID)if(40054==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof st.MonthlyPayrollViewModel);if(t)d.d.page.SetActiveTab(t);else{let i=new st.MonthlyPayrollViewModel(a.ScreenName,"");i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:et.MonthlyPayrollComponent,params:{obj:i}})}}else if(40088!=a.FeatureID&&"4101"===a.FeatureActionID.toString())return{component:f.TreeViewPageComponent,params:{ScreenName:a.ScreenName,FeatureActionID:a.FeatureActionID,CostCenterID:a.FeatureID,Call:"C3"},basedon:"CostCenterID"};return{}}static LoadMonthlyPayrolByVoucherNo(a,l){return new st.MonthlyPayrollViewModel(a,"",l)}static GetAppraisal(a){let A,l=0,t=0,i=0,o=0,r=!1,C="",g="",D="",p=new Date,e=new Date,T=new Date,P=a.ToTable(!0,["EmpSeqNo"]);if(null!=P&&P.length>0)for(let _=0;_<P.length;_++)if(null!=P[_].EmpSeqNo&&null!=P[_].EmpSeqNo&&""!=P[_].EmpSeqNo.toString()&&(l=parseInt(P[_].EmpSeqNo),A=a.filter(x=>x.EmpSeqNo==l),null!=A&&A.length>0)){p=new Date(A[0].EffectFrom),e=new Date(A[0].ApplyFrom),T=new Date(A[0].NextAppraisalDate),null!=A[0].Remarks&&null!=A[0].Remarks&&(C=A[0].Remarks.toString()),null!=A[0].Reason&&null!=A[0].Reason&&(g=A[0].Reason.toString());let x=d.d.common.GetDataSet3("BULK004",l.toString(),p.getMonth().toString(),p.getFullYear().toString());i=null!=x&&x.Tables.length>0&&x.Tables[0].length>0?parseInt(x.Tables[0][0].SeqNo):0;let F=new we.X(null,l,new Date,i);F.isFromBulkAppraisals=!0,F.EffectFrom.Date=p,F.ActAppraisalFrom.Date=e,F.NextAppraisal.Date=T,F.Remarks.Text=C,F.Reason.Text=g;for(let j=0;j<A.length;j++){if(t=parseInt(A[j].ComponentID),o=parseFloat(A[j].Amt),r=!1,null!=x&&x.Tables.length>1&&x.Tables[1].length>0){let E=x.Tables[1].filter(b=>"BasicMonthlyFld"==b.prefname);null!=E&&E.length>0&&""!=E[0].prefvalue.toString()&&t==parseInt(E[0].prefvalue.toString())&&(F.BasicMonthly.Text=o.toString(),r=!0),E=x.Tables[1].filter(b=>"AnnualCTCFld"==b.prefname),null!=E&&E.length>0&&""!=E[0].prefvalue.toString()&&t==parseInt(E[0].prefvalue.toString())&&(F.AnnualCTC.Text=o.toString(),r=!0)}for(let E=0;E<F.dgvEarnings.Table.length;E++)if(F.dgvEarnings.Table[E].EarComponentID.toString()==t.toString()){F.dgvEarnings.Table[E].EarValue=o,r=!0;break}if(!r)for(let E=0;E<F.dgvDeductions.Table.length;E++)if(F.dgvDeductions.Table[E].DedComponentID.toString()==t.toString()){F.dgvDeductions.Table[E].DedValue=o;break}}F.ExecuteFormulas(),F.OnButtonClick("Save"),null!=F.DisplayMessage&&F.DisplayMessage.length>0||F.strUpdate.length>0&&(D+=F.strUpdate)}return D}static LoadFinalSettlementByVoucherNo(a,l){return new Mt.FinalSettlementViewModel(a,l)}static ShowQuickAdd_Payroll(a,l){return(0,ie.A)(function*(){if(50051==a){const{AddEditEmpMasterComponent:t}=yield J.e(2742).then(J.bind(J,12742)),{AddEditEmpMasterViewModel:i}=yield Promise.resolve().then(J.bind(J,76412));let r={obj:new i(l,0,0,"",!1)};d.d.page.addNewTab({title:"",component:t,params:r})}})()}}}}]);