"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[946],{70234:(Xt,at,G)=>{G.r(at),G.d(at,{FinalSettlementViewModel:()=>Te});var ne=G(10467),I=G(86739),Me=G(8787),d=G(23823),Oe=G(31820),qe=G(24028),lt=G(48875),L=G(92701),s=G(81669),fe=G(9309),Ye=G(54683),ze=G(57547),Xe=G(26531),gt=G(29788),Ae=G(39032),Z=G(98669),Ce=G(36466),Ve=G(32647);class Te extends d.g{get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(m){m!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=m)}constructor(m,ae=""){super(),this.ApproveVisibility=!1,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.UnProcessedVisible=!0,this.PrintVisiblility=!0,this.SavePrintVisiblility=!0,this.PreviewVisiblility=!0,this.AttachVisiblility=!0,this.EMailVisiblility=!0,this.WID=0,this.DocID=0,this.txtDocNo=new Oe.Dw(0),this.dtpDocDate=new qe.Lc(0),this.EmployeeList=new lt.G(0),this.dtpDateOfJoining=new qe.Lc(0),this.dtpDateOfRelieving=new qe.Lc(0),this.txtRemarks=new Oe.Dw(0),this.txtNetAmount=new Oe.Dw(0),this.DialogResult=!1,this.AttachmentVisibility=!1,this.CostCenterID=40095,this.cmbResignReason=new L.y$(0),this.CalculateClick=new s.Yk,this.EmpSelectionChanged=new s.Yk,this.strCustomEmpFilter="",this.sCmdParameter="",this.IsSaved=!1,this.sVNo="",this.dsRes1=null,this.drwRes=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Ce.v,this.SelectedEmpID=0,this.StatusColor="#736F6F",this.StatusID=0,this.WFDocLevelList=new Array,this.ErrorMessage="Missing Report Parameter ' ",this.ClassName="FinalSettlementViewModel";try{this.CostCenterID=40095,this.dsRes1=I.d.common.GetDataSet("CRM030",I.d.SessionManager.LangID),this.txtDocNo.Label=this.GetResource("VoucherNo",40095),this.dtpDocDate.Label=this.GetResource("DocDate",40095),this.EmployeeList.Label=this.GetResource("Employee",40095),this.dtpDateOfJoining.Label=this.GetResource("Date of Joining",40095),this.dtpDateOfRelieving.Label=this.GetResource("Date of Relieving",40095),this.txtNetAmount.Label=this.GetResource("Net Amount",40095),I.d.SessionManager.Preferences.ContainsKey("FinalsettlementHideUnProcessedSalaryTab")&&"True"==I.d.SessionManager.Preferences.FinalsettlementHideUnProcessedSalaryTab.toString()&&(this.UnProcessedVisible=!1),this.DisplayName=m,this.Title=m,this.sVNo=ae,this.DisplayMessage="",this.DocStatus="[UnPosted]",this.ViewAttachments=new fe.ViewAttachmentViewModel(this,I.d.SessionManager,I.d.admin),this.OnAddAttachment(),this.txtDocNo.LblWidth="",this.txtRemarks.Label=I.d.GetResource("Remarks"),this.txtNetAmount.IsReadOnly=!0,this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.Code.Visible&&(this.EmployeeList.Code.CCID=50051,this.EmployeeList.Code.TypeID=4),this.EmployeeList.Name.Visible&&(this.EmployeeList.Name.CCID=50051,this.EmployeeList.Name.TypeID=1),this.strCustomEmpFilter=this.FilterEmployees(),this.EmployeeList.Code.CustomWhere=this.EmployeeList.Name.CustomWhere=this.strCustomEmpFilter,this.EmployeeList.SelectionCallBack.Subscribe(this,"EmployeeList_SelectedValueChanged"),this.cmbResignType=new L.y$(0),this.cmbResignType.Items.push(L._p.ComboBoxItems_2("Resigned","Resigned")),this.cmbResignType.Items.push(L._p.ComboBoxItems_2("Terminated","Terminated")),this.cmbResignType.Items.push(L._p.ComboBoxItems_2("Terminated With Cause","Terminated With Cause")),this.cmbResignType.Items.push(L._p.ComboBoxItems_2("Terminated Without Cause","Terminated Without Cause")),this.cmbResignType.Items.push(L._p.ComboBoxItems_2("Expired","Expired")),this.cmbResignType.Label=this.GetResource("Resign Type",40095),null!=this.dsRes1&&this.dsRes1.Tables.length>1&&this.dsRes1.Tables[1].length>0&&L.y$.FillComboWithDefaultOption_3(this.dsRes1.Tables[1],this.cmbResignReason,!1),this.cmbSettlementType=new L.y$(0),this.cmbSettlementType.Items.push(L._p.ComboBoxItems_2("Final","Final")),this.cmbSettlementType.Items.push(L._p.ComboBoxItems_2("Partial","Partial")),this.cmbSettlementType.Label=this.GetResource("Settlement Type",40095),this.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.PrintVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Print"),this.SavePrintVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Save&Print"),this.PreviewVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"PrintPreview"),this.ExportVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.AttachVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Attach"),this.EMailVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Email"),I.d.SessionManager.Preferences.ContainsKey("DisableDateOfRelievingFieldInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.DisableDateOfRelievingFieldInFinalSettlement.toString()&&(this.dtpDateOfRelieving.Enable=!1),I.d.SessionManager.Preferences.ContainsKey("DisableResignTypeFieldInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.DisableResignTypeFieldInFinalSettlement.toString()&&(this.cmbResignType.Enable=!1),this.ReportView(),Logger.InfoLog("FinalSettlementViewModel::Exiting FinalSettlementViewModel()")}catch(Q){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FinalSettlementViewModel()",Q)}}EmployeeList_SelectedValueChanged(m){try{this.DisplayMessage="",this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.SelectedEmpID>0&&this.EmpSelectionChanged.Call(this.SelectedEmpID)}catch(ae){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION EmployeeList_SelectedValueChanged()",ae)}}get DocStatus(){return this._DocStatus}set DocStatus(m){m!=this._DocStatus&&(this._DocStatus=m,this.setStatusColor())}setStatusColor(){this.StatusColor=this.DocStatus.startsWith("["+I.d.GetResource("Doc_Draft")+"]")||this.DocStatus.startsWith("[UnPosted]")?I.d.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?I.d.SessionManager.Preferences.partialColor:369==this.StatusID?I.d.SessionManager.Preferences.PostedColor:370==this.StatusID?I.d.SessionManager.Preferences.PDCColor:371==this.StatusID?I.d.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?I.d.SessionManager.Preferences.RejectedColor:376==this.StatusID?I.d.SessionManager.Preferences.CancelledColor:429==this.StatusID?I.d.SessionManager.Preferences.BouncedColor:441==this.StatusID?I.d.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}Button_Click(m){try{if("Clear"==m.toString())this.EmployeeList.SelectedValue=0,this.SelectedEmpID=0,this.CalculateClick.Call(m);else if("EMail"==m.toString()){if(!(this.DocID>0))return void(this.DisplayMessage="Load document in Edit Mode");I.d.page.ShowDialog(new Xe.SendEmailSMSViewModel(!0,50051,this.EmployeeList.SelectedValue,this),gt.SendEmailSMSComponent)}else"Attachments"==m.toString()?(this.AttachmentVisibility=!0,I.d.page.ShowDialog(this.Attachment,ze.o,{Title:this.Attachment.Title})):"Report"==m.toString()?(this.ReportInfoVisibility=!0,I.d.page.ShowDialog(this,Ae.L,{Title:"Reports"})):this.CalculateClick.Call(m)}catch(ae){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION Button_Click()",ae)}}SetDocStatus(m,ae,Q,re,je,Ke,J){let n=[];return n.push(m),n.push(je??""),n.push(re.ToString("dd/MMM/yyyy")),n.push(!0),n.push(this.DocID),n.push(this.CostCenterID),n.push(ae),n.push(Q),n.push(Ke),n.push(I.d.SessionManager.GetSysInfo()),n.push(I.d.SessionManager.GetAccessPoint()),n.push(J),n.push(I.d.SessionManager.CompanyGUID),n.push(I.d.SessionManager.UserName),n.push(I.d.SessionManager.UserID),n.push(I.d.SessionManager.RoleID),n.push(I.d.SessionManager.LanguageID),I.d.document.SetDocStatus(n)}FilterEmployees(){let m="";try{Logger.InfoLog("FinalSettlementViewModel::Entering FilterEmployees()"),I.d.SessionManager.LocationID>0&&I.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&I.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(m=m+" a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+I.d.SessionManager.LocationID+")"),Logger.InfoLog("FinalSettlementViewModel::Exiting FilterEmployees()")}catch(ae){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FilterEmployees()",ae)}return m}SaveFinalSettlement(m){return I.d.document.SetTempInvDocument(m)}OnShowAttachment(){Logger.InfoLog("AddProductViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddProductViewModel::Exiting OnShowAttachment")}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let m="";null!=this.Attachment&&(m=this.Attachment.ColID);let ae=null;null!=this.Attachment&&(ae=this.Attachment.RowID),this.Attachment=new Ye.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==m?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=m,this.Attachment.RowID=ae),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}GetResource(m,ae){let Q=m;return null!=this.dsRes1&&this.dsRes1.Tables.length>0&&this.dsRes1.Tables[0].length>0&&(this.drwRes=this.dsRes1.Tables[0].filter(re=>re.CCID==ae&&re.Code==m)),null!=this.drwRes&&this.drwRes.length>0?1==I.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():Q}PostApplyLeaves(m,ae,Q){return I.d.empService.ExecuteQuery_SP(ae,Q)}ReportView(){this.ReportDimension=new Z.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let m=[];this.dsData=I.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+I.d.SessionManager.UserID+" set @RoleID="+I.d.SessionManager.RoleID+"    \n                            SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                            FROM ADM_RevenUReports R  with(nolock)\n                            inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                            left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                            left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                            where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                            GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                            order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(Q=>{let re=new Ce.v;re.DBColumnID=parseInt(Q.ReportID),re.Label=Q.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(re.KeyTip=Q.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=Q.DisplayAsPopup.toString()&&(re.Dependantinuse="1"==Q.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=Q.Width.toString()&&(re.Width=Q.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=Q.Height.toString()&&(re.Length=Q.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=Q.DocumentField.toString()&&(re.Formula=Q.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=Q.mapxml.toString()&&(re.ToolTipDescription=Q.mapxml.toString()),m.Contains(parseInt(Q.ReportID))||(m.push(parseInt(Q.ReportID)),this.ReportsList.push(re)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(m){var ae=this;return(0,ne.A)(function*(){const{ReportViewModel:Q}=yield Promise.resolve().then(G.bind(G,35725)),{ReportViewComponent:re}=yield Promise.resolve().then(G.bind(G,73540));let J,je={strXML:""},Ke=new Q;if(ae.DisplayMessage=ae.GetReportFilterXML(m,je),J=je.strXML,0==ae.DisplayMessage.length){var n=ae.ReportsList.find($e=>$e.DBColumnID==parseInt(m));if(null!=n&&n.Dependantinuse)Ke.ReportViewModel_Document(ae.CostCenterID,J,parseInt(m),!0,null,null),!Me.J0.IsEmpty(n.Width)&&Me.J0.Double(n.Width)>0&&(Ke.RptWidth=Me.J0.Double(n.Width)),!Me.J0.IsEmpty(n.length)&&Me.J0.Double(n.length)>0&&(Ke.RptHeight=Me.J0.Double(n.length)),Ke.DocumentObject=ae,I.d.page.HideDialog(ae.PopUpGUID),I.d.page.ShowDialog(Ke,re,{Title:"",HideClose:!0,ShowCenter:!0});else{let $e=new Q;$e.ReportViewModel_Document(ae.CostCenterID,J,parseInt(m),!1,null,null),$e.DocumentObject=ae,I.d.page.HideDialog(ae.PopUpGUID),I.d.page.addNewTab({component:re,params:{obj:$e}})}}})()}GetReportFilterXML(m,ae){let Q="";ae.strXML="";let re=this.dsData.Tables[0];re=re.filter(J=>J.ReportID==m);let Ke,je=!1;re.forEach(J=>{(0,Ve.yG0)(J.GroupLevel)&&(je=!0)}),Q+="<XML",je&&(Q+=' GroupLevel="1"'),Q+=" >";for(let J=0;J<re.length;J++){if(Ke=re[J].ReportField.toString(),Q+="<Row ",Q+='ColID ="'+Ke+'" ',!Me.J0.IsEmpty(re[J].SysColumnName)&&"-1"==re[J].DocumentField.toString()){if(0==this.SelectedEmpID)return alert(this.ErrorMessage+"Employee '"),"Empty Value";Q+='Value ="'+this.SelectedEmpID+'" '}Q+=" />"}return Q+="</XML>",ae.strXML=Q.toString(),""}GetVacationDays(m,ae,Q){Logger.InfoLog("FinalSettlementViewModel::  Entered into GetVacationDays");let re=[];return re.push(m.ToString("dd MMM yyyy")),re.push(ae.ToString("dd MMM yyyy")),re.push(Q),re.push(-200),re.push(0),re.push(0),re.push(0),re.push(I.d.SessionManager.UserID),re.push(I.d.SessionManager.LanguageID),I.d.empService.GetVacationDays(re)}}},54004:(Xt,at,G)=>{G.r(at),G.d(at,{FinalSettlementComponent:()=>da});var ne=G(89417),I=G(86739),Me=G(31820),d=G(98669),Oe=G(49710),qe=G(7601),lt=G(32647),L=G(8787),s=G(72099),fe=G(38816),Ye=G(75782),ze=G(81669),Xe=G(95005),gt=G(96833),Ae=G(10287),Z=G(18569),Ce=G(92701),Ve=G(9309),Te=G(54683),Ze=G(47267),m=G(27961),ae=G(50334),Q=G(48875),re=G(39560),je=G(35063),Ke=G(44904),J=G(95707),n=G(54438),$e=G(60177),Ct=G(60440),et=G(94304),tt=G(95021),It=G(13816),Kt=G(73955);function $t(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("Approve"))}),n.nrm(1,"i",39),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Approve")))}function pt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("Save"))}),n.nrm(1,"i",40),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Post")))}function St(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("SaveAndPrint"))}),n.nrm(1,"i",41),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"SaveAndPrint")))}function ut(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.btnPrint_Click("Print"))}),n.nrm(1,"i",42),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Print")))}function Je(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.btnPrintPreview_Click("Preview"))}),n.nrm(1,"i",43),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Preview")))}function Nt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.btnExport_Click("Export"))}),n.nrm(1,"i",44),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Export")))}function Dt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("Attachments"))}),n.nrm(1,"i",45),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Attachments")))}function Tt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("EMail"))}),n.nrm(1,"i",46),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"SMTP_Email")))}function mt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("Delete"))}),n.nrm(1,"i",47),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Delete")))}function Qt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.obj.Button_Click("Report"))}),n.nrm(1,"i",48),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Y&&(n.R7$(2),n.JRh(n.bMT(3,1,"Report")))}function qt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"div",22),n.EFF(1,"\n                "),n.j41(2,"div"),n.EFF(3,"\n                  "),n.j41(4,"div",49),n.EFF(5,"\n                    "),n.eu8(6,50),n.EFF(7,"\n                    "),n.j41(8,"div",51),n.EFF(9,"\n                      "),n.j41(10,"label",52),n.EFF(11),n.k0s(),n.EFF(12,"\n                      "),n.j41(13,"div",53),n.EFF(14,"\n                        "),n.j41(15,"span",54),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.Calculate_Click("Previous"))}),n.nrm(16,"i",55),n.k0s(),n.EFF(17,"\n                        "),n.j41(18,"span",54),n.bIt("click",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.Calculate_Click("Next"))}),n.nrm(19,"i",56),n.k0s(),n.EFF(20,"\n                      "),n.k0s(),n.EFF(21,"\n                    "),n.k0s(),n.EFF(22,"\n                  "),n.k0s(),n.EFF(23,"\n                  \n                  \n                "),n.k0s(),n.EFF(24,"\n              "),n.k0s()}if(2&Y){const C=n.XpG();n.R7$(6),n.Y8G("obj",C.obj.txtDocNo)("group",C.form),n.R7$(5),n.JRh(C.obj.lblDocNo)}}function zt(Y,ce){if(1&Y&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.dtpDocDate)("group",C.form)}}function Zt(Y,ce){if(1&Y&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.EmployeeList)("group",C.form)}}function Mt(Y,ce){if(1&Y&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.cmbSettlementType)("group",C.form)}}function ea(Y,ce){if(1&Y&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.dtpDateOfJoining)("group",C.form)}}function ta(Y,ce){if(1&Y&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.dtpDateOfRelieving)("group",C.form)}}function Rt(Y,ce){if(1&Y&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.txtRemarks)("group",C.form)}}function Lt(Y,ce){if(1&Y&&(n.j41(0,"div",22),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.obj.txtNetAmount)("group",C.form)}}function aa(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.EFF(2,"\n              "),n.nrm(3,"app-PactGridView",59),n.EFF(4,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(3),n.Y8G("obj",C.dgvGratuity)("group",C.form)}}function sa(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.cmbResignType)("group",C.form)}}function yt(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.cmbResignReason)("group",C.form)}}function nt(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtGratuityAmount)("group",C.form)}}function vt(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtAvailedGratuityAmount)("group",C.form)}}function Ot(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtPartialGratuityAmount)("group",C.form)}}function Vt(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.dgvLeaveEncash)("group",C.form)}}function la(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtCumLeaveSalBalAmt)("group",C.form)}}function ia(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtLEAmount)("group",C.form)}}function na(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG(2);n.R7$(2),n.Y8G("obj",C.dgvUPS)("group",C.form)}}function ft(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG(2);n.R7$(2),n.Y8G("obj",C.txtUPSAmount)("group",C.form)}}function wt(Y,ce){if(1&Y){const C=n.RV6();n.j41(0,"tab",26),n.bIt("selectTab",function(){n.eBV(C);const S=n.XpG();return n.Njj(S.onSelectTab("dgvUPS"))}),n.EFF(1,"\n          "),n.j41(2,"div",36),n.EFF(3,"\n            "),n.DNE(4,na,4,2,"div",28),n.EFF(5,"\n            "),n.j41(6,"div",37),n.EFF(7,"\n              "),n.j41(8,"div",31),n.EFF(9,"\n                "),n.eu8(10,32),n.EFF(11,"\n              "),n.k0s(),n.EFF(12,"\n              "),n.DNE(13,ft,4,2,"div",30),n.EFF(14,"\n            "),n.k0s(),n.EFF(15,"\n          "),n.k0s(),n.EFF(16,"\n        "),n.k0s()}if(2&Y){const C=n.XpG();n.FS9("heading",C.tpUnProcessedSalary),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",C.dgvUPS.Visible),n.R7$(6),n.Y8G("obj",C.UPSRemarks)("group",C.form),n.R7$(3),n.Y8G("ngIf",C.txtUPSAmount.Visible)}}function Et(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.dgvNoticePay)("group",C.form)}}function Gt(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtNPAmount)("group",C.form)}}function xe(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.dgvOthAdd)("group",C.form)}}function ct(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtOthAddAmount)("group",C.form)}}function oa(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.dgvOthDed)("group",C.form)}}function ra(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtOthDedAmount)("group",C.form)}}function _t(Y,ce){if(1&Y&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.dgvLoanBal)("group",C.form)}}function kt(Y,ce){if(1&Y&&(n.j41(0,"div",31),n.EFF(1,"\n                "),n.eu8(2,32),n.EFF(3,"\n              "),n.k0s()),2&Y){const C=n.XpG();n.R7$(2),n.Y8G("obj",C.txtLoanBalAmount)("group",C.form)}}let da=(()=>{class Y{constructor(){this.form=new ne.gE({}),this.IsAccordionOpen=!0,this.EmpSeqNo=0,this.GratuityGrade=0,this.EmpGrade=0,this.GratuityDocID=0,this.PrevEmpSeqNo=0,this.sDocNo="0",this.strFormula="",this.isLoaded=!1,this.dblAmount=0,this.drwRes=null,this.chkCalcBasedOnLastSal=new s.c,this.chkCalcBasedOnActDays=new s.c,this.chkLECalcBasedOnLastApprSerYearWise=new s.c,this.GratuityRemarks=new Me.Dw(0),this.LeaveRemarks=new Me.Dw(0),this.UPSRemarks=new Me.Dw(0),this.NoticePayRemarks=new Me.Dw(0),this.OAddRemarks=new Me.Dw(0),this.ODedRemarks=new Me.Dw(0),this.LoanRemarks=new Me.Dw(0),this.txtGratuityAmount=new Me.Dw(0),this.txtAvailedGratuityAmount=new Me.Dw(0),this.txtPartialGratuityAmount=new Me.Dw(0),this.txtCumLeaveSalBalAmt=new Me.Dw(0),this.txtLEAmount=new Me.Dw(0),this.txtUPSAmount=new Me.Dw(0),this.txtOthAddAmount=new Me.Dw(0),this.txtOthDedAmount=new Me.Dw(0),this.txtNPAmount=new Me.Dw(0),this.txtLoanBalAmount=new Me.Dw(0),this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="",this.lblActRelievingDate="",this.dgvGratuity=new Oe.vv,this.dgvLeaveEncash=new Oe.vv,this.dgvUPS=new Oe.vv,this.dgvOthAdd=new Oe.vv,this.dgvOthDed=new Oe.vv,this.dgvNoticePay=new Oe.vv,this.dgvLoanBal=new Oe.vv,this.lblDocNo="",this.tpGratuity="",this.tpLeaveEncashment="",this.tpUnProcessedSalary="",this.tpNoticePay="",this.tpOtherAdditions="",this.tpOtherDeductions="",this.tpLoanBalances="",this.btnCalcGratuity="",this.lbl1GratuityTotalDays="",this.lbl1GratuityServiceDays="",this.lbl1GratuityLOPDays="",this.lbl1GratuityBalDays="",this.lbl1GratuityTotalGrDays="",this.lblGratuityAmount="",this.lblAvailedGratuityAmount="",this.lblPartialGratuityAmount="",this.lbl1GratuityTaken="",this.lblCumLeaveSalBalAmt="",this.btnCalcLE="",this.lblLEAmount="",this.lblUPSAmount="",this.lblNPAmount="",this.lblOthAddAmount="",this.lblOthDedAmount="",this.lblLoanBalAmount="",this.dtEdit=null,this.iCurDocNo=0,this.CostCenterID=40095,this.DefProdID=0,this.dblBasic=0,this.EOS_ROff=0,this.dServiceDaysFormulaAmount=0,this.dblGratuityAmount=0,this.dActServiceDays=0,this.dServiceDaysAfterLOP=0,this.dLOPDays=0,this.EOS_ROffYear=0,this.isLast=!1,this.isConsdExpiredupto=!1,this.sVacTypeSeqNo="-1",this.EOS_GratuityFormula="",this.EOS_AvailedFormula="",this.EOS_MaxDays=0,this.dEarnedGrDays=0,this.lst=new Array,this.dTotGratuityDays=0,this.dGratuityTaken=0,this.isMaxDaysExceded=!1,this.oEvalPayFormulas=null,this.MoreThanOneLayout=!1,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null}ngOnInit(){this.obj=this.params?.obj,this.FinalSettlement_DataContextChanged(),this.FinalSettlement_Loaded(),console.log(this)}onSelectTab(C){I.d.page.RefreshSlickGridUI()}get txtDocNo(){return this.ViewModel.txtDocNo}get txtRemarks(){return this.ViewModel.txtRemarks}get txtNetAmount(){return this.ViewModel.txtNetAmount}get EmployeeList(){return this.ViewModel.EmployeeList}get cmbResignType(){return this.ViewModel.cmbResignType}get cmbResignReason(){return this.ViewModel.cmbResignReason}get cmbSettlementType(){return this.ViewModel.cmbSettlementType}get dtpDocDate(){return this.ViewModel.dtpDocDate}get dtpDateOfJoining(){return this.ViewModel.dtpDateOfJoining}get dtpDateOfRelieving(){return this.ViewModel.dtpDateOfRelieving}FinalSettlement_DataContextChanged(){this.ViewModel=this.params?.obj,this.ViewModel.CalculateClick.Subscribe(this,"Calculate_Click"),this.ViewModel.EmpSelectionChanged.Subscribe(this,"Employee_SelectionChanged"),this.ViewModel.txtDocNo.LostFocusCommand.Subscribe(this,"txtDocNo_LostFocus"),this.dgvOthAdd.CellEditEnding.Subscribe(this,"dgvOthAdd_CellEndEdit"),this.dgvOthDed.CellEditEnding.Subscribe(this,"dgvOthDed_CellEndEdit"),this.dtpDateOfRelieving.SelectedDateChanged.Subscribe(this,"dtpDateOfRelieving_SelectedDateChanged")}FinalSettlement_Loaded(){this.isLoaded||(this.LoadGrids(),this.Clear_Click(),this.dsLookups=I.d.common.GetDataSet("CRM015",""),this.dgvOthAdd.Columns.find(C=>"dgColOthAddParticulars"==C.ValueBinding).ComboData=this.dsLookups.Tables[0],this.dgvOthDed.Columns.find(C=>"dgColOthDedParticulars"==C.ValueBinding).ComboData=this.dsLookups.Tables[1],this.dgvOthAdd.CanUserAddRows=!0,this.dgvOthAdd.CanUserDeleteRows=!0,this.dgvOthAdd.addEmptyRow(),this.dgvOthDed.CanUserAddRows=!0,this.dgvOthDed.CanUserDeleteRows=!0,this.dgvOthDed.addEmptyRow(),this.dgvOthAdd.refreshDataView(),this.lblDocNo=this.GetResource("VoucherNo",40095),this.tpGratuity=this.GetResource("Gratuity",40095),this.tpLeaveEncashment=this.GetResource("Leave Encashment",40095),this.tpUnProcessedSalary=this.GetResource("Un-Processed Salary",40095),this.tpNoticePay=this.GetResource("Notice Pay",40095),this.tpOtherAdditions=this.GetResource("Other Additions",40095),this.tpOtherDeductions=this.GetResource("Other Deductions",40095),this.tpLoanBalances=this.GetResource("Loan Balances",40095),this.chkCalcBasedOnLastSal.Label=this.GetResource("Calculate based on Last Salary",40095),this.chkCalcBasedOnActDays.Label=this.GetResource("Calculate Salary based on Actual Days",40095),this.btnCalcGratuity=this.GetResource("Calculate",40095),this.lbl1GratuityTotalDays=this.GetResource("Total Days",40095)+" : ",this.lbl1GratuityServiceDays=this.GetResource("Service Days",40095)+" : ",this.lbl1GratuityLOPDays=", "+this.GetResource("LOP",40095)+" : ",this.lbl1GratuityBalDays=", "+this.GetResource("Balance",40095)+" : ",this.lbl1GratuityTotalGrDays=this.GetResource("Total Gratuity Days",40095)+" : ",this.lbl1GratuityTaken=this.GetResource("Gratuity Taken",40095)+" : ",this.lblGratuityAmount=this.GetResource("Gratuity Amount",40095),this.lblAvailedGratuityAmount=this.GetResource("Availed Gratuity Amount",40095),this.lblPartialGratuityAmount=this.GetResource("Partial Gratuity Amount",40095),this.lblCumLeaveSalBalAmt=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.chkLECalcBasedOnLastApprSerYearWise.Label=this.GetResource("Calculate based on Last Appraisal - Service Year Wise",40095),this.btnCalcLE=this.GetResource("Calculate",40095),this.lblLEAmount=this.GetResource("Amount",40095),this.lblUPSAmount=this.GetResource("Amount",40095),this.lblNPAmount=this.GetResource("Amount",40095),this.lblOthAddAmount=this.GetResource("Amount",40095),this.lblOthDedAmount=this.GetResource("Amount",40095),this.lblLoanBalAmount=this.GetResource("Amount",40095),this.isLoaded=!0,""!=this.ViewModel.sVNo&&this.LoadDocument(parseInt(this.ViewModel.sVNo.Replace("FST-",""))))}txtDocNo_LostFocus(C){try{this.txtDocNo.Text.Trim().length>0&&this.LoadDocument(parseInt(this.txtDocNo.Text.Trim()))}catch{this.ViewModel.DisplayMessage="Enter Valid DocNo."}}LoadDocument(C){let T;this.ViewModel.DisplayMessage="",this.ViewModel.MessageVisibility=!0,this.sDocNo=C.toString();let S=I.d.common.GetDataTable("CRM016",C.toString());if(null!=S&&S.length>0){if(!L.J0.IsEmpty(I.d.SessionManager.sEmpFilteredEmpSeqNos)&&!I.d.SessionManager.sEmpFilteredEmpSeqNos.split(",").Contains(parseInt(S[0].EmpSeqNo).toString()))return this.ViewModel.DisplayMessage="You don't have permission to view this Document.",this.ViewModel.MessageVisibility=!0,this.Clear_Click(),this.txtDocNo.Text=C.toString(),void(this.EmployeeList.IsEnabled=!1);this.EmployeeList.IsEnabled=!0,this.ViewModel.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.ViewModel.SavePrintVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit"),this.EmployeeList.SelectedValue=parseInt(S[0].EmpSeqNo),this.EmployeeList.SelectedValue=parseInt(S[0].EmpSeqNo),this.ClearControlValues(),this.dtEdit=null,this.EmpSeqNo=parseInt(S[0].EmpSeqNo),this.dtEdit=I.d.common.GetDataTable("CRM018",this.EmpSeqNo.toString()+"~"+C),null!=this.dtEdit&&this.dtEdit.length>0&&(this.dtpDocDate.Date=L.J0.ParseDate(this.dtEdit[0].cDocDate));let P=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.iMonth(),1),E=[];if(E.push(this.EmpSeqNo),E.push(0),E.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),E.push(P.ToString("dd/MMM/yyyy")),E.push(C),E.push(1),E.push(I.d.SessionManager.UserID),E.push(I.d.SessionManager.RoleID),E.push(I.d.SessionManager.LanguageID),this.dsD=I.d.common.GetDataSet_SP(E,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0&&this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=L.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.cmbSettlementType.SelectedValue="Final",this.DOB=L.J0.ParseDate(this.dsD.Tables[0][0].DOB),9e3!=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+" : "+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=new Date,this.cmbResignType.SelectedValue=L.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==L.J0.String(this.dsD.Tables[0][0].ResignStatus)){let X=L.J0.ParseDate(this.dsD.Tables[0][0].DOResign),W=new Date(X.getFullYear(),X.getMonth(),1),U=new Date,R=W;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(U=W.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(U=W.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=I.d.SessionManager.Preferences.NPResignation&&parseInt(I.d.SessionManager.Preferences.NPResignation)>0&&(U=W.AddMonths(parseInt(I.d.SessionManager.Preferences.NPResignation)-1));let B=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfRelieving.Date.iMonth(),1);if(U<B)for(;U<B;)U=U.AddMonths(1);let se,z=new Date,he=new Date,le=new Date;for(;R<=U;){if(T=this.dsD.Tables[5].filter(Ie=>Ie.PayrollDate==R.ToString("dd/MMM/yyyy")),null==T||0==T.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=R.ToString("dd/MMM/yyyy"),"Actual Days"==I.d.SessionManager.Preferences.PayDays){let Ie={PayrollMonth:z,PayrollMonthStart:he,PayrollMonthEnd:le};if(L.J0.SetPayrollDate_1(R,Ie),z=Ie.PayrollMonth,he=Ie.PayrollMonthStart,le=Ie.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let we=0;we=L.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),z,he,le),we>0&&(L.J0.SetPayrollDate_1(R,Ie,this.EmpGrade),z=Ie.PayrollMonth,he=Ie.PayrollMonthStart,le=Ie.PayrollMonthEnd)}se=le.Subtract(he).Days+1}else se=parseInt(I.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=se,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals)}R=R.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&I.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==I.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let X=0,W=0;for(let U=0;U<this.dsD.Columns[8].length;U++)L.J0.IsEmpty(this.dsD.Tables[8][0][U])||(X+=parseFloat(this.dsD.Tables[8][0][U]));for(let U=0;U<this.dsD.Tables[9].length;U++)L.J0.IsEmpty(this.dsD.Tables[9][U].Amount)||(W+=parseFloat(this.dsD.Tables[9][U].Amount));this.txtCumLeaveSalBalAmt.Text=(X-W).ToString(I.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(I.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let X;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let W=0;W<this.dsD.Tables[4].length;W++)X=L.J0.ParseDate(this.dsD.Tables[4][W].PayrollMonth),this.dgvUPS.Table[W].dgColUPSPayrollMonth=X.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[W].dgColUPSMonthDays=X.DaysInMonth(),this.dgvUPS.Table[W].dgColUPSDaysAtt=0,this.dgvUPS.Table[W].dgColUPSLOP=0,this.dgvUPS.Table[W].dgColUPSNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[W].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[W])}let w=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let X=0;X<this.dsD.Tables[10].length;X++)this.dgvLoanBal.Table[X].dgColLoanBalSNo=(X+1).toString(),this.dgvLoanBal.Table[X].dgColLoanBalDocNo=this.dsD.Tables[10][X].DocNo.toString(),this.dgvLoanBal.Table[X].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][X].DocID.toString(),this.dgvLoanBal.Table[X].dgColLoanBalLoanType=this.dsD.Tables[10][X].LoanType.toString(),this.dgvLoanBal.Table[X].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][X].LoanCompID.toString(),this.dgvLoanBal.Table[X].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][X].ApprovedAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][X].Paid).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][X].Balance).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalCalc="Pay",w+=parseFloat(this.dsD.Tables[10][X].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[X])}this.txtLoanBalAmount.Text=w.ToString(I.d.SessionManager.sPayrollDecimals),this.ViewModel.ApproveVisibility=!1;let $=null;if(null!=this.dtEdit&&this.dtEdit.length>0){if(this.ViewModel.DocStatus="["+this.dtEdit[0].DocStatus.toString()+"]",this.ViewModel.DocID=parseInt(this.dtEdit[0].DocID),this.sDocNo=this.dtEdit[0].DocNumber.toString(),this.txtDocNo.Text=this.sDocNo,this.dtpDocDate.Date=L.J0.ParseDate(this.dtEdit[0].cDocDate),this.dtpDateOfRelieving.Date=L.J0.ParseDate(this.dtEdit[0].dcAlpha3),this.dtpDateOfRelieving_SelectedDateChanged(this,this.dtpDateOfRelieving),this.txtRemarks.Text=this.dtEdit[0].CommonNarration.toString(),this.ViewModel.StatusID=parseInt(this.dtEdit[0].StatusID),this.ViewModel.WID=parseInt(this.dtEdit[0].WorkflowID),this.cmbSettlementType.SelectedValue=L.J0.String(this.dtEdit[0].dcAlpha10),$=I.d.common.GetDataSet("CRM029",this.ViewModel.DocID.toString()),T=this.dtEdit.filter(R=>"1"==R.dcAlpha1),null!=T&&T.length>0&&(this.GratuityRemarks.Text=T[0].dcAlpha8.toString(),this.cmbResignType.Text=T[0].dcAlpha11.toString(),this.chkCalcBasedOnLastSal.IsChecked=(0,lt.yG0)(T[0].dcAlpha12),this.chkCalcBasedOnActDays.IsChecked=(0,lt.yG0)(T[0].dcAlpha13),this.cmbResignReason.SelectedValue=T[0].dcAlpha33.toString(),this.Calculate_Click("Gratuity"),this.txtPartialGratuityAmount.Text=parseFloat(T[0].dcCalcNum4).ToString(I.d.SessionManager.sPayrollDecimals)),T=this.dtEdit.filter(R=>"2"==R.dcAlpha1),null!=T&&T.length>0){this.LeaveRemarks.Text=T[0].dcAlpha8.toString(),this.chkLECalcBasedOnLastApprSerYearWise.IsChecked=!L.J0.IsEmpty(T[0].dcAlpha17)&&(0,lt.yG0)(T[0].dcAlpha17);for(let R=0;R<T.length;R++)for(let B=0;B<this.dgvLeaveEncash.Table.length;B++)if(T[R].dcAlpha11.toString()==this.dgvLeaveEncash.Table[B+"_Tag"].toString()){this.dgvLeaveEncash.Table[B].dgColLEAvailable=T[R].dcAlpha13.toString(),this.dgvLeaveEncash.Table[B].dgColLEMaxEncash=T[R].dcAlpha14.toString(),this.dgvLeaveEncash.Table[B].dgColLEApplied=T[R].dcAlpha15.toString();break}this.Calculate_Click("LeaveEncash"),this.dgvLeaveEncash.Update()}if(T=this.dtEdit.filter(R=>"3"==R.dcAlpha1),null!=T&&T.length>0){this.UPSRemarks.Text=T[0].dcAlpha8.toString();for(let R=0;R<T.length;R++)for(let B=0;B<this.dgvUPS.Table.length;B++)if(L.J0.ParseDate(T[R].dcAlpha11).ToString("dd MMM yyyy")==L.J0.ParseDate(this.dgvUPS.Table[B].dgColUPSPayrollMonth).ToString("dd MMM yyyy")){this.dgvUPS.Table[B].dgColUPSDaysAtt=T[R].dcAlpha13.toString(),this.dgvUPS.Table[B].dgColUPSLOP=T[R].dcAlpha14.toString(),this.dgvUPS.Table[B].dgColUPSNetSal=T[R].dcAlpha15.toString();break}this.dgvUPS.Update(),this.txtUPSAmount.Text=parseFloat(T[0].dcCalcNum1).ToString(I.d.SessionManager.sPayrollDecimals)}if(T=this.dtEdit.filter(R=>"4"==R.dcAlpha1),null!=T&&T.length>0){this.NoticePayRemarks.Text=T[0].dcAlpha8.toString();for(let R=0;R<T.length;R++)for(let B=0;B<this.dgvNoticePay.Table.length;B++)if(L.J0.ParseDate(T[R].dcAlpha11).ToString("dd MMM yyyy")==L.J0.ParseDate(this.dgvNoticePay.Table[B].dgColNPPayrollMonth).ToString("dd MMM yyyy")){this.dgvNoticePay.Table[B].dgColNPDaysAtt=T[R].dcAlpha13.toString(),this.dgvNoticePay.Table[B].dgColNPLOP=T[R].dcAlpha14.toString(),this.dgvNoticePay.Table[B].dgColNPNetSal=T[R].dcAlpha15.toString(),this.dgvNoticePay.Table[B].dgColNPType=T[R].dcAlpha16.toString(),this.dgvNoticePay.Table[B].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[B]);break}this.txtNPAmount.Text=parseFloat(T[0].dcCalcNum1).ToString(I.d.SessionManager.sPayrollDecimals)}if(T=this.dtEdit.filter(R=>"5"==R.dcAlpha1),null!=T&&T.length>0){this.OAddRemarks.Text=T[0].dcAlpha8.toString(),this.dgvOthAdd.addEmptyRows(T.length);for(let R=0;R<T.length;R++)this.dgvOthAdd.Table[R].dgColOthAddParticulars=parseInt(T[R].dcAlpha11.toString()),this.dgvOthAdd.Table[R].dgColOthAddAmount=T[R].dcAlpha12.toString(),L.J0.IsEmpty(T[R].dcAlpha13)||(this.dgvOthAdd.Table[R].dgColOthAddRemarks=T[R].dcAlpha13.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[R]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2)}if(T=this.dtEdit.filter(R=>"6"==R.dcAlpha1),null!=T&&T.length>0){this.ODedRemarks.Text=T[0].dcAlpha8.toString(),this.dgvOthDed.addEmptyRows(T.length);for(let R=0;R<T.length;R++)this.dgvOthDed.Table[R].dgColOthDedParticulars=parseInt(T[R].dcAlpha11.toString()),this.dgvOthDed.Table[R].dgColOthDedAmount=T[R].dcAlpha12.toString(),L.J0.IsEmpty(T[R].dcAlpha13)||(this.dgvOthDed.Table[R].dgColOthDedRemarks=T[R].dcAlpha13.toString()),this.dgvOthDed.updateRow(this.dgvOthDed.Table[R]),this.dgvOthDed_CellEndEdit(this.dgvOthDed,2)}if(T=this.dtEdit.filter(R=>"7"==R.dcAlpha1),null!=T&&T.length>0){this.LoanRemarks.Text=T[0].dcAlpha8.toString();for(let R=0;R<T.length;R++)for(let B=0;B<this.dgvLoanBal.Table.length;B++)if(T[R].dcAlpha12.toString()==this.dgvLoanBal.Table[B].dgColLoanBalDocNo_Tag.toString()){this.dgvLoanBal.Table[B].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[B].dgColLoanBalSNo_Tag=T[R].dcAlpha17.toString(),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[B]);break}}if(null!=$&&$.Tables.length>0&&$.Tables[0].length>0){let R=$.Tables[0];if(null!=R&&R.length>0)for(let B=0;B<R.length;B++){let se=new Te.AddAttachmentViewModel;se.AddAttachmentViewModel_2(this.ViewModel),se.AttachmentID=parseInt(R[B].FileID),se.ActualFileName=R[B].ActualFileName.toString(),se.FileExtension=R[B].FileExtension.toString(),se.FileDescription=R[B].FileDescription.toString(),se.FilePath=L.J0.GetPath(R[B].GUID+"."+R[B].FileExtension),se.RelativeFileName=R[B].RelativeFileName.toString(),se.IsProductImage=!1,this.ViewModel.ViewAttachments.AttachmentsList.push(se)}}if(this.ViewModel.WID>0){let R=I.d.common.GetDataTable("CRM020",this.dtEdit[0].InvDocDetailsID.toString()+",95,'"+I.d.SessionManager.UserName+"',40095,"+this.ViewModel.WID+","+this.dtEdit[0].WorkFlowLevel.toString()+","+this.dtEdit[0].StatusID.toString()+","+this.dtEdit[0].CreatedDate.toString()+","+I.d.SessionManager.UserID+","+I.d.SessionManager.RoleID);null!=R&&R.length>0&&(null!=R[0].CanApprove&&null!=R[0].CanApprove&&"TRUE"==R[0].CanApprove.toString().toUpperCase()?(this.ViewModel.ApproveVisibility=!0,this.ViewModel.PostVisiblility=!1):this.ViewModel.PostVisiblility=!(!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))}let X=I.d.common.GetDataSet3("CRM021",this.CostCenterID.toString(),this.ViewModel.DocID.toString());this.ViewModel.WFDocLevelList.Clear();let W=null,U=null;if(W=X.Tables[1],U=X.Tables[0],null!=W&&W.length>0&&!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let B,R=parseInt(this.dtEdit[0].WorkFlowLevel);U.length>0&&(B=parseInt(U[U.length-1].StatusID));let se=U.length>0?parseInt(U[0].WORKFLOWLEVEL)-1:0;for(let z=0;z<W.length;z++){let he=new qe.O(parseInt(W[0].WID),parseInt(W[z].LEVELID),W[z].LEVELNAME.toString(),this.CostCenterID,this.ViewModel.DocID,L.J0.ParseDate(W[z].DocDate));z==se&&(he.IsPending=!0,he.Label="C"),0==z&&(he.LeftLineBrush="#FFFFFFFF"),z==W.length-1&&(he.RightLineBrush="#FFFFFFFF"),this.ViewModel.WFDocLevelList.push(he)}for(let z=U.length-1;z>=0;z--){let he=parseInt(U[z].WORKFLOWLEVEL);if(he<=R&&he<=this.ViewModel.WFDocLevelList.length&&!this.ViewModel.WFDocLevelList[he-1].IsSet){this.ViewModel.WFDocLevelList[he-1].IsSet=!0,this.ViewModel.WFDocLevelList[he-1].ModifiedBy=U[z].STATUS.toString()+" By "+U[z].CREATEDBY.toString(),U[z].FIRSTNAME.toString().length>0&&(this.ViewModel.WFDocLevelList[he-1].ModifiedBy+="("+U[z].FIRSTNAME.toString()+")");let le=L.J0.ParseDate(U[z].DATE);this.ViewModel.WFDocLevelList[he-1].ModifiedBy+=" On "+le.ToString(I.d.SessionManager.Preferences["Date Format"]);let Ie=parseInt(U[z].STATUSID);372==Ie?this.ViewModel.WFDocLevelList[he-1].IsRejected=!0:441==Ie?this.ViewModel.WFDocLevelList[he-1].IsApproved=!0:369==Ie&&(this.ViewModel.WFDocLevelList[he-1].IsPending=!0,this.ViewModel.WFDocLevelList[he-1].Label=" P")}}}}else this.ViewModel.DocStatus="[UnPosted]",this.ViewModel.DocID=0,this.sDocNo="0",this.ViewModel.StatusID=0,this.ViewModel.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete");this.CalculateTotalAmount()}this.ViewModel.EmployeeList.Code.SelectedValue=parseInt(S[0].EmpSeqNo),this.ViewModel.EmployeeList.Name.SelectedValue=parseInt(S[0].EmpSeqNo),this.ViewModel.DocID=parseInt(S[0].DocID),this.ViewModel.sVoucherNo=S[0].VoucherNo.toString()}else this.Clear_Click(),this.txtDocNo.Text=C.toString(),this.dtpDocDate.SetFocus=!0}Clear_Click(){this.GetNextDocNo(),this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=0,this.EmpSeqNo=0,this.PrevEmpSeqNo=0,this.ViewModel.DocID=0,this.ClearControlValues(),this.ViewModel.sCmdParameter="",this.ViewModel.SelectedEmpID=0,this.dTotGratuityDays=0,null!=this.ViewModel&&null!=this.ViewModel.WFDocLevelList&&this.ViewModel.WFDocLevelList.Clear(),this.ViewModel.ApproveVisibility=!1,this.ViewModel.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new Ve.ViewAttachmentViewModel(this.ViewModel,I.d.SessionManager,I.d.admin),this.ViewModel.OnAddAttachment()}ClearControlValues(){this.dtEdit=null,this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="0",this.chkCalcBasedOnLastSal.Label="Calculate based on Last Salary",this.chkCalcBasedOnActDays.Label="Calculate Salary based on Actual Days",this.txtRemarks.Label=I.d.GetResource("Remarks"),this.txtRemarks.Text="",this.GratuityRemarks.Label=I.d.GetResource("Remarks"),this.GratuityRemarks.Text="",this.LeaveRemarks.Label=I.d.GetResource("Remarks"),this.LeaveRemarks.Text="",this.UPSRemarks.Label=I.d.GetResource("Remarks"),this.UPSRemarks.Text="",this.NoticePayRemarks.Label=I.d.GetResource("Remarks"),this.NoticePayRemarks.Text="",this.OAddRemarks.Label=I.d.GetResource("Remarks"),this.OAddRemarks.Text="",this.ODedRemarks.Label=I.d.GetResource("Remarks"),this.ODedRemarks.Text="",this.cmbSettlementType.SelectedIndex=0,this.LoanRemarks.Label=I.d.GetResource("Remarks"),this.LoanRemarks.Text="",this.dtpDocDate.Date=(new Date).Date(),this.cmbResignType.Label=I.d.GetResource("Resign Type"),this.cmbResignType.SelectedValue="Resigned",this.cmbResignReason.SelectedValue="",this.cmbResignReason.Label="Resign Reason",this.dblBasic=0,this.sDocNo="0",this.ViewModel.DocStatus="[UnPosted]",this.dGratuityTaken=0,this.dgvGratuity.Clear(),this.dgvLeaveEncash.Clear(),this.dgvUPS.Clear(),this.dgvOthAdd.Clear(),this.dgvOthDed.Clear(),this.dgvNoticePay.Clear(),this.dgvLoanBal.Clear(),this.txtGratuityAmount.Label=this.GetResource("Gratuity Amount",40095),this.txtGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtGratuityAmount.Align="right",this.txtAvailedGratuityAmount.Label=this.GetResource("Availed Gratuity Amount",40095),this.txtAvailedGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Align="right",this.txtPartialGratuityAmount.Label=this.GetResource("Partial Gratuity Amount",40095),this.txtPartialGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtPartialGratuityAmount.Align="right",this.txtCumLeaveSalBalAmt.Label=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtCumLeaveSalBalAmt.Align="right",this.txtLEAmount.Label=this.GetResource("Amount",40095),this.txtLEAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtLEAmount.Align="right",this.txtUPSAmount.Label=this.GetResource("Amount",40095),this.txtUPSAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtUPSAmount.Align="right",this.txtOthAddAmount.Label=this.GetResource("Amount",40095),this.txtOthAddAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtOthAddAmount.Align="right",this.txtOthDedAmount.Label=this.GetResource("Amount",40095),this.txtOthDedAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtOthDedAmount.Align="right",this.txtNPAmount.Label=this.GetResource("Amount",40095),this.txtNPAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtNPAmount.Align="right",this.txtLoanBalAmount.Label=this.GetResource("Amount",40095),this.txtLoanBalAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtLoanBalAmount.Align="right",this.txtNetAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtNetAmount.Align="right",this.lblActRelievingDate="",null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new Ve.ViewAttachmentViewModel(this.ViewModel,I.d.SessionManager,I.d.admin),this.ViewModel.OnAddAttachment(),this.setDefaultRows()}setDefaultRows(){this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd"),this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")}GetNextDocNo(){let C=I.d.common.GetDataTable("CRM017","");null!=C&&(this.txtDocNo.Text=C.length>0?L.J0.IsEmpty(C[0].CurrentCodeNumber)?"1":parseInt(C[0].CurrentCodeNumber).toString():"1")}Employee_SelectionChanged(C){if(this.EmpSeqNo==C)return;this.EmpSeqNo=C,this.ClearControlValues();let T,S=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.getMonth(),1),P=[];if(P.push(this.EmpSeqNo),P.push(this.ViewModel.DocID),P.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),P.push(S.ToString("dd/MMM/yyyy")),P.push(0),P.push(0),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.RoleID),P.push(I.d.SessionManager.LanguageID),this.dsD=I.d.common.GetDataSet_SP(P,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0)if(this.dsD.Tables.length>14&&this.dsD.Tables[14].length>0)this.ViewModel.DisplayMessage="Employee FinalSettlement is Already done @VoucherNo - "+this.dsD.Tables[14][0].VoucherNo.ToString(),this.ViewModel.MessageVisibility=!0;else if(this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=L.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.DOB=L.J0.ParseDate(this.dsD.Tables[0][0].DOB),this.cmbSettlementType.SelectedValue="Final",9e3!=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=Date.Today(),this.cmbResignType.SelectedValue=L.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==this.dsD.Tables[0][0].ResignStatus.toString()){let w=L.J0.ParseDate(this.dsD.Tables[0][0].DOResign),$=new Date,X=new Date,W=new Date,U={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:W};L.J0.SetPayrollDate_1(w,U),$=U.PayrollMonth,X=U.PayrollMonthStart,W=U.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(w,U,this.EmpGrade),$=U.PayrollMonth,X=U.PayrollMonthStart,W=U.PayrollMonthEnd);let R=new Date($.getFullYear(),$.getMonth(),1),B=new Date,se=R;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(B=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(B=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=I.d.SessionManager.Preferences.NPResignation&&parseInt(I.d.SessionManager.Preferences.NPResignation)>0&&(B=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPResignation)-1)),$=new Date,X=new Date,W=new Date,U={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:W},L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U),$=U.PayrollMonth,X=U.PayrollMonthStart,W=U.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U,this.EmpGrade),$=U.PayrollMonth,X=U.PayrollMonthStart,W=U.PayrollMonthEnd);let z=new Date($.getFullYear(),$.iMonth(),1);if(B<z)for(;B<z;)B=B.AddMonths(1);let he=0;for($=new Date,X=new Date,W=new Date;se<=B;){if(T=this.dsD.Tables[5].filter(le=>le.PayrollDate==se.ToString("dd/MMM/yyyy")),null==T||0==T.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=se.ToString("dd/MMM/yyyy"),"Actual Days"==I.d.SessionManager.Preferences.PayDays){let le={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:W};if(L.J0.SetPayrollDate_1(se,le),$=le.PayrollMonth,X=le.PayrollMonthStart,W=le.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Ie=0;Ie=L.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),$,X,W),Ie>0&&(L.J0.SetPayrollDate_1(se,le,Ie),$=le.PayrollMonth,X=le.PayrollMonthStart,W=le.PayrollMonthEnd)}he=W.Subtract(X).Days+1}else he=parseInt(I.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=he,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1])}se=se.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&I.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==I.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let w=0,$=0;for(let X=0;X<this.dsD.Columns[8].length;X++)L.J0.IsEmpty(this.dsD.Tables[8][0][this.dsD.Columns[8][X]])||(w+=parseFloat(this.dsD.Tables[8][0][this.dsD.Columns[8][X]]));for(let X=0;X<this.dsD.Tables[9].length;X++)L.J0.IsEmpty(this.dsD.Tables[9][X].Amount)||($+=parseFloat(this.dsD.Tables[9][X].Amount));this.txtCumLeaveSalBalAmt.Text=(w-$).ToString(I.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(I.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let w;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let $=0;$<this.dsD.Tables[4].length;$++)w=L.J0.ParseDate(this.dsD.Tables[4][$].PayrollMonth),this.dgvUPS.Table[$].dgColUPSPayrollMonth=w.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[$].dgColUPSMonthDays=w.DaysInMonth(),this.dgvUPS.Table[$].dgColUPSDaysAtt=0,this.dgvUPS.Table[$].dgColUPSLOP=0,this.dgvUPS.Table[$].dgColUPSNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[$].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[$])}let E=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let w=0;w<this.dsD.Tables[10].length;w++)this.dgvLoanBal.Table[w].dgColLoanBalSNo=(w+1).toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo=this.dsD.Tables[10][w].DocNo.toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][w].DocID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType=this.dsD.Tables[10][w].LoanType.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][w].LoanCompID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][w].ApprovedAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][w].Paid).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][w].Balance).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalCalc="Pay",E+=parseFloat(this.dsD.Tables[10][w].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[w])}this.CalculateTotalAmount()}}AutoCalculateLeaveEncashment(){I.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&this.btnCalcLeaveEncash_Click()}RefreshLeaveEncashDetails(){if(this.EmpSeqNo>0&&(this.dgvLeaveEncash.Clear(),this.dsD.Tables[1].length>0)){this.dgvLeaveEncash.addEmptyRows(this.dsD.Tables[1].length);for(let C=0;C<this.dsD.Tables[1].length;C++){this.dgvLeaveEncash.Table[C+"_Tag"]=this.dsD.Tables[1][C].SNo.toString(),this.dgvLeaveEncash.Table[C].dgColLELeaveType=this.dsD.Tables[1][C].ComponentName.toString(),this.dgvLeaveEncash.Table[C].dgColLELeaveType_Tag=this.dsD.Tables[1][C].ComponentID.toString();let T=0,S=0;if(this.dsD.Tables[1][C].ComponentID.toString()==this.sVacTypeSeqNo)this.dgvLeaveEncash.Table[C].dgColLEAvailable=this.GetVacationAvailability(this.dtpDateOfRelieving.Date,parseInt(this.sVacTypeSeqNo));else{let P={dTaken:0,dAvail:0},E={dAvail:0};this.GetLeavesTaken1(this.dtpDateOfRelieving.Date,this.dtpDateOfJoining.Date,this.dsD.Tables[1][C].ComponentID.toString(),E),T=P.dTaken,S=P.dAvail,this.dgvLeaveEncash.Table[C].dgColLEAvailable=S}this.dgvLeaveEncash.Table[C].dgColLEMaxEncash=parseFloat(this.dgvLeaveEncash.Table[C].dgColLEAvailable)>parseFloat(this.dsD.Tables[1][C].MaxEncashDays)?this.dsD.Tables[1][C].MaxEncashDays.toString():this.dgvLeaveEncash.Table[C].dgColLEAvailable.toString(),this.dgvLeaveEncash.Table[C].dgColLEApplied=0,this.dgvLeaveEncash.Table[C].dgColLEAmount=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.Table[C].dgColLEAmount_Tag=this.dsD.Tables[1][C].EncashFormula.toString(),I.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&(this.dgvLeaveEncash.Table[C].dgColLEApplied=this.dgvLeaveEncash.Table[C].dgColLEMaxEncash)}this.dgvLeaveEncash.Update()}}GetAvailableLeavesToEncash(C){C.SNo.toString();let P=C.ComponentID.toString();if(this.sVacTypeSeqNo!=P){let E=I.d.common.GetDataSet3("CRM022",this.dtpDocDate.Date.ToString("dd MMM yyyy"),new Date(this.dtpDocDate.Date.getFullYear(),parseInt(I.d.SessionManager.Preferences.LeaveYear.toString()),1).ToString("dd MMM yyyy"),this.EmpSeqNo+"~"+P);if(null!=E&&E.Tables.length>0&&E.Tables[0].length>0){let w=0,$=0,X=0;return E.Tables[1].length>0&&($=parseFloat(E.Tables[1][0].NoOfDays.toString())),E.Tables[2].length>0&&(X=parseFloat(E.Tables[2][0].NoOfDays.toString())),w-$-X}return 0}try{return 0}catch(E){return this.ViewModel.DisplayMessage="Exception when Calculating Available leaves of Vacation Type",console.log(E),0}}GetVacationAvailability(C,T){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");let S=0,P=[];P.push(C.ToString("dd/MMM/yyyy")),P.push(this.EmpSeqNo),P.push(2),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.LanguageID);let E=I.d.common.GetDataSet_SP(P,"spPAY_GetRemainingVacationDays");if(null!=E&&E.Tables.length>0&&E.Tables[0].length>0){let w=E.Tables[0].filter($=>$.LeaveType==T);null!=w&&w.length>0&&(S=parseFloat(w[0].AvlblDays))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),S.toString()}GetLeavesTaken(C,T,S,P){P.dTaken=P.dAvail=0;let E=[];E.push(C.ToString("dd/MMM/yyyy")),E.push(T.ToString("dd/MMM/yyyy")),E.push(this.EmpSeqNo),E.push(S),E.push("Both"),E.push(I.d.SessionManager.UserID),E.push(I.d.SessionManager.LanguageID);let w=I.d.common.GetDataSet_SP(E,"spPAY_ExtGetAvlblNoofDays");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(L.J0.IsEmpty(w.Tables[0][0].LeavesTaken)||(P.dTaken=parseFloat(w.Tables[0][0].LeavesTaken)),L.J0.IsEmpty(w.Tables[0][0].AvailableLeaves)||(P.dAvail=parseFloat(w.Tables[0][0].AvailableLeaves)))}GetLeavesTaken1(C,T,S,P){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken1()"),P.dAvail=0;let E=[];E.push(this.EmpSeqNo),E.push(S),E.push(C.ToString("dd/MMM/yyyy")),E.push(0),E.push(I.d.SessionManager.UserID),E.push(I.d.SessionManager.LanguageID),E.push(0);let w=I.d.common.GetDataSet_SP(E,"spPAY_ExtGetAssignedLeaves");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(L.J0.IsEmpty(null!=w.Tables[0][0].AvailableLeaves)||(P.dAvail=L.J0.DoubleTryParse(w.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}CalculateTotalAmount(){let C=0;C+="Partial"==this.cmbSettlementType.SelectedValue?parseFloat(this.txtPartialGratuityAmount.Text):parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken,C+=parseFloat(this.txtLEAmount.Text),C+=parseFloat(this.txtUPSAmount.Text),C+=parseFloat(this.txtOthAddAmount.Text),C-=parseFloat(this.txtOthDedAmount.Text),C+=parseFloat(this.txtNPAmount.Text),C-=parseFloat(this.txtLoanBalAmount.Text),this.txtNetAmount.Text=C.ToString(I.d.SessionManager.sPayrollDecimals)}GenerateSerialNos(C,T=""){for(let S=0;S<C.Table.length;S++)"dgvOthAdd"==T?C.Table[S].dgColOthAddSNo=S+1:C.Table[S].dgColOthDedSNo=S+1;C.invalidate()}LoadGrids(){let C;this.SetGridProperties(this.dgvLeaveEncash),C=new Z.O7,C.DisplayMember="dgColLELeaveType",C.Header=this.GetResource("Leave Type",40095),C.ReadOnly=!0,this.dgvLeaveEncash.Columns.push(C),this.dgvLeaveEncash.TableColumns.push("dgColLELeaveType"),C=new Z.O7,C.DisplayMember="dgColLEAvailable",C.Header=this.GetResource("Available Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvLeaveEncash.Columns.push(C),this.dgvLeaveEncash.TableColumns.push("dgColLEAvailable"),C=new Z.O7,C.DisplayMember="dgColLEMaxEncash",C.Header=this.GetResource("Max Encash Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvLeaveEncash.Columns.push(C),this.dgvLeaveEncash.TableColumns.push("dgColLEMaxEncash"),C=new Z.O7,C.DisplayMember="dgColLEApplied",C.Header=this.GetResource("Applied Days",40095),C.TextAlign="Center",this.dgvLeaveEncash.Columns.push(C),this.dgvLeaveEncash.TableColumns.push("dgColLEApplied"),C=new Z.O7,C.DisplayMember="dgColLEAmount",C.Header=this.GetResource("Encash Amount",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvLeaveEncash.Columns.push(C),this.dgvLeaveEncash.TableColumns.push("dgColLEAmount"),this.SetGridProperties(this.dgvUPS),C=new Z.O7,C.DisplayMember="dgColUPSPayrollMonth",C.Header=this.GetResource("Payroll Month",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSPayrollMonth"),C=new Z.O7,C.DisplayMember="dgColUPSMonthDays",C.Header=this.GetResource("Month Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSMonthDays"),C=new Z.O7,C.DisplayMember="dgColUPSDaysAtt",C.Header=this.GetResource("Days Attended",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSDaysAtt"),C=new Z.O7,C.DisplayMember="dgColUPSLOP",C.Header=this.GetResource("LOP Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSLOP"),C=new Z.O7,C.DisplayMember="dgColUPSNetSal",C.Header=this.GetResource("Net Salary",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSNetSal"),C=new Z.O7,C.DataType="LINK",C.DisplayMember="dgColUPSCalc",C.Header=this.GetResource("Calculate",40095),C.TextAlign="Center",C.Click.Subscribe(this,"dgvUPS_CellClick"),this.dgvUPS.Columns.push(C),this.dgvUPS.TableColumns.push("dgColUPSCalc"),this.SetGridProperties(this.dgvNoticePay),C=new Z.O7,C.DataType="ComboBox",C.ValueBinding="dgColNPType",C.DisplayMember="Name",C.ValueMember="Value",C.Header=this.GetResource("Type",40095);let T=new Array;T.push(Ce._p.ComboBoxItems_2("Add","Add")),T.push(Ce._p.ComboBoxItems_2("Subtract","Subtract")),T.push(Ce._p.ComboBoxItems_2("None","None")),C.ComboData=T,this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPType"),C=new Z.O7,C.DisplayMember="dgColNPPayrollMonth",C.Header=this.GetResource("Payroll Month",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPPayrollMonth"),C=new Z.O7,C.DisplayMember="dgColNPMonthDays",C.Header=this.GetResource("Month Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPMonthDays"),C=new Z.O7,C.DisplayMember="dgColNPDaysAtt",C.Header=this.GetResource("Days Attended",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPDaysAtt"),C=new Z.O7,C.DisplayMember="dgColNPLOP",C.Header=this.GetResource("LOP Days",40095),C.ReadOnly=!0,C.TextAlign="Center",this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPLOP"),C=new Z.O7,C.DisplayMember="dgColNPNetSal",C.Header=this.GetResource("Net Salary",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPNetSal"),C=new Z.O7,C.DataType="LINK",C.DisplayMember="dgColNPCalc",C.Header=this.GetResource("Calculate",40095),C.TextAlign="Center",C.Click.Subscribe(this,"dgvNoticePay_CellClick"),this.dgvNoticePay.Columns.push(C),this.dgvNoticePay.TableColumns.push("dgColNPCalc"),this.SetGridProperties(this.dgvOthAdd),C=new Z.O7,C.DisplayMember="dgColOthAddSNo",C.Header="#",C.ReadOnly=!0,C.TextAlign="Center",this.dgvOthAdd.Columns.push(C),this.dgvOthAdd.TableColumns.push("dgColOthAddSNo"),C=new Z.O7,C.DataType="ComboBox",C.ValueBinding="dgColOthAddParticulars",C.DisplayMember="Name",C.ValueMember="NodeID",C.Header=this.GetResource("Particulars",40095),this.dgvOthAdd.Columns.push(C),this.dgvOthAdd.TableColumns.push("dgColOthAddParticulars"),C=new Z.O7,C.DisplayMember="dgColOthAddAmount",C.Header=this.GetResource("Amount",40095),C.TextAlign="Right",this.dgvOthAdd.Columns.push(C),this.dgvOthAdd.TableColumns.push("dgColOthAddAmount"),C=new Z.O7,C.DisplayMember="dgColOthAddRemarks",C.Header=this.GetResource("LineNarration",40095),this.dgvOthAdd.Columns.push(C),this.dgvOthAdd.TableColumns.push("dgColOthAddRemarks"),this.SetGridProperties(this.dgvOthDed),C=new Z.O7,C.DisplayMember="dgColOthDedSNo",C.Header="#",C.ReadOnly=!0,C.TextAlign="Center",this.dgvOthDed.Columns.push(C),this.dgvOthDed.TableColumns.push("dgColOthDedSNo"),C=new Z.O7,C.DataType="ComboBox",C.ValueBinding="dgColOthDedParticulars",C.DisplayMember="Name",C.ValueMember="NodeID",C.Header=this.GetResource("Particulars",40095),this.dgvOthDed.Columns.push(C),this.dgvOthDed.TableColumns.push("dgColOthDedParticulars"),C=new Z.O7,C.DisplayMember="dgColOthDedAmount",C.Header=this.GetResource("Amount",40095),C.TextAlign="Right",this.dgvOthDed.Columns.push(C),this.dgvOthDed.TableColumns.push("dgColOthDedAmount"),C=new Z.O7,C.DisplayMember="dgColOthDedRemarks",C.Header=this.GetResource("LineNarration",40095),this.dgvOthDed.Columns.push(C),this.dgvOthDed.TableColumns.push("dgColOthDedRemarks"),this.SetGridProperties(this.dgvLoanBal),C=new Z.O7,C.DisplayMember="dgColLoanBalSNo",C.Header="#",C.ReadOnly=!0,C.TextAlign="Center",this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalSNo"),C=new Z.O7,C.DisplayMember="dgColLoanBalDocNo",C.Header=this.GetResource("Loan Doc. No.",40095),C.ReadOnly=!0,this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalDocNo"),C=new Z.O7,C.DisplayMember="dgColLoanBalLoanType",C.Header=this.GetResource("Loan Type",40095),C.ReadOnly=!0,this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalLoanType"),C=new Z.O7,C.DisplayMember="dgColLoanBalApprAmount",C.Header=this.GetResource("Approved Amount",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalApprAmount"),C=new Z.O7,C.DisplayMember="dgColLoanBalAmountPaid",C.Header=this.GetResource("Amount Paid",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalAmountPaid"),C=new Z.O7,C.DisplayMember="dgColLoanBalBalAmount",C.Header=this.GetResource("Balance Amount",40095),C.ReadOnly=!0,C.TextAlign="Right",this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalBalAmount"),C=new Z.O7,C.DisplayMember="dgColLoanBalRemarks",C.Header=this.GetResource("LineNarration",40095),this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalRemarks"),C=new Z.O7,C.DataType="LINK",C.DisplayMember="dgColLoanBalCalc",C.Header=this.GetResource("Pay",40095),C.TextAlign="Center",C.Click.Subscribe(this,"dgvLoanBal_CellClick"),this.dgvLoanBal.Columns.push(C),this.dgvLoanBal.TableColumns.push("dgColLoanBalCalc")}SetGridProperties(C){C.Table=[],C.Columns=[]}Calculate_Click(C){switch(C){case"Gratuity":this.btnCalcGratuity_Click();break;case"LeaveEncash":this.btnCalcLeaveEncash_Click();break;case"Clear":this.Clear_Click();break;case"Save":this.Save_Click();break;case"Delete":this.Delete_Click();break;case"Previous":this.Previous_Click();break;case"Next":this.Next_Click();break;case"Approve":this.Approve_Click()}return""}Approve_Click(){let C=new Ze.a(this.CostCenterID,this.ViewModel.DocID,null,this.ViewModel);I.d.page.ShowDialog(C,m.H,{ShowCenter:!0,Title:I.d.GetResource("ApproveReject")})}Next_Click(){this.iCurDocNo=parseInt(this.txtDocNo.Text.Trim()),this.LoadDocument(this.iCurDocNo+1)}Previous_Click(){this.iCurDocNo=parseInt(this.txtDocNo.Text.Trim()),this.iCurDocNo>1&&this.LoadDocument(this.iCurDocNo-1)}Delete_Click(){if(""!=this.sDocNo&&parseInt(this.sDocNo)>0){if(confirm("Are you sure want to Delete.?")){let C=0,T=[];T.push(40095),T.push(this.ViewModel.DocID),T.push(1);let S=I.d.document.DeleteSelectedRows(T,C);this.ViewModel.DisplayMessage=S.Message,C=S.RetValue,this.ViewModel.MessageVisibility=!0,this.Clear_Click()}}else this.ViewModel.DisplayMessage="Select any saved Document to Delete",this.ViewModel.MessageVisibility=!0}Save_Click(){if(this.dgvOthAdd.angularGrid&&this.dgvOthAdd.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.dgvOthDed.angularGrid&&this.dgvOthDed.angularGrid.slickGrid.getEditorLock()?.commitCurrentEdit(),this.ValidateSave()){let C=[];C.push(this.CostCenterID),C.push(this.ViewModel.DocID),C.push(""),C.push(this.txtDocNo.Text),C.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),C.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),C.push(""),C.push(this.GetDocumentXML()),C.push(""),C.push(""),C.push(this.ViewModel.ViewAttachments.GetXML()),C.push(this.GetActivityXML()),C.push("false"),I.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==I.d.SessionManager.Preferences.EnableLocationWise.toString()?C.push(I.d.SessionManager.LocationID>0?I.d.SessionManager.LocationID:1):C.push(0),I.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==I.d.SessionManager.Preferences.EnableDivisionWise.toString()?C.push(I.d.SessionManager.DivisionID>0?I.d.SessionManager.DivisionID:1):C.push(0),C.push(this.ViewModel.WID),C.push(I.d.SessionManager.RoleID),C.push(""),C.push(0),C.push(0),C.push(I.d.SessionManager.CompanyGUID),C.push(I.d.SessionManager.UserName),C.push(I.d.SessionManager.UserID),C.push(I.d.SessionManager.LanguageID),C.push(I.d.SessionManager.IsOffline);let T=0,S="";I.d.document.SetTempInvDocument(C).subscribe(P=>{T=P.obj;let E=P;if(S=null!=E&&E.Tables.length>0&&E.Tables[E.Tables.length-1].length>0&&E.Columns[E.Tables.length-1].Contains("ErrorMessage")?E.Tables[E.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",T>0){let w=[];w.push(T),w.push(I.d.SessionManager.UserID),w.push(I.d.SessionManager.LanguageID);let $=this.ViewModel.PostApplyLeaves(parseInt(I.d.SessionManager.CompanyIndex),w,"spPAY_PostApplyLeaves");null!=$&&$.Tables.length>0&&(S="Problem in processing your request,Please contact administrator."),this.ViewModel.SelectedEmpID=this.EmpSeqNo,this.Clear_Click()}else null!=E&&E.Tables.length>0&&E.Tables[E.Tables.length-1].length>0&&E.Columns[E.Tables.length-1].Contains("ServerMessage")&&(T="-407"==E.Tables[E.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.ViewModel.DisplayMessage=S,this.ViewModel.MessageVisibility=!0})}}GetActivityXML(){let C='<XML  SysInfo="'+I.d.SessionManager.GetSysInfo()+'" AP="Desktop" ';return"Approve"==this.ViewModel.sCmdParameter&&(C+=' AppRejDate="'+Date.Today().ToString("dd/MMM/yyyy")+'"'),C+=" >",C+=" </XML> ",C}GetDocumentXML(){let W,T="",S="",P="",E="",w="",$="";if(new Array,null!=I.d.SessionManager.dtDocDefAccs&&(W=I.d.SessionManager.dtDocDefAccs.filter(U=>40095==U.CostCenterID&&"CreditAccount"==U.SysColumnName),null!=W&&W.length>0&&null!=W[0].UserDefaultValue&&""!=W[0].UserDefaultValue.toString().Trim()&&(w=W[0].UserDefaultValue.toString()),W=I.d.SessionManager.dtDocDefAccs.filter(U=>40095==U.CostCenterID&&"DebitAccount"==U.SysColumnName),null!=W&&W.length>0&&null!=W[0].UserDefaultValue&&""!=W[0].UserDefaultValue.toString().Trim()&&($=W[0].UserDefaultValue.toString())),S+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="'+parseFloat(this.txtNetAmount.Text)+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+I.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+$+'" CreditAccount="'+w+'" CommonNarration="'+L.J0.EncodeXML(this.txtRemarks.Text),null!=this.dgvGratuity&&this.dgvGratuity.Table.length>0){let U=1;for(let R=0;R<this.dgvGratuity.Table.length;R++)T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Gratuity',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='1',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha4='"+this.lblGratuityServiceDays+"',",P+=" dcAlpha5='"+this.lblGratuityLOPDays+"',",P+=" dcAlpha6='"+this.lblGratuityBalDays+"',",P+=" dcAlpha7='"+this.lblGratuityTotalGrDays+"',",P+=" dcAlpha8='"+this.GratuityRemarks.Text+"',",P+=" dcAlpha9='"+this.GratuityGrade+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.cmbResignType.SelectedValue+"',",P+=" dcAlpha12='"+this.chkCalcBasedOnLastSal.IsChecked+"',",P+=" dcAlpha13='"+this.chkCalcBasedOnActDays.IsChecked+"',",P+=" dcAlpha14='"+this.lblGratuityTotalDays+"',",P+=" dcAlpha15='"+this.dgvGratuity.Table[R][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha16='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha17='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[4]]+"',",P+=" dcAlpha18='"+this.dgvGratuity.Table[R+2][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha19='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha20='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[4]]+"',",P+=" dcAlpha21='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha22='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha23='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[3]]+"',",P+=" dcAlpha24='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha25='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha26='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[3]]+"',",P+=" dcAlpha27='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[5]]+"',",P+=" dcAlpha28='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[7]]+"',",P+=" dcAlpha29='"+this.dgvGratuity.Table[R+7][this.dgvGratuity.TableColumns[5]]+"',",P+=" dcAlpha30='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[6]]+"',",P+=" dcAlpha31='"+this.GratuityDocID+"',",P+=" dcAlpha32='"+this.lblGratuityTaken+"',",P+=" dcAlpha33='"+this.cmbResignReason.SelectedValue+"',",P+=" dcAlpha34='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[6]]+"',",P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",R+=8,U++}if(null!=this.dgvLeaveEncash&&this.dgvLeaveEncash.Table.length>0){let U=1;for(let R=0;R<this.dgvLeaveEncash.Table.length;R++)0!=L.J0.Double(this.dgvLeaveEncash.Table[R].dgColLEAmount)&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leave Encashment',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",P+=" dcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",P+=" dcCalcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='2',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.LeaveRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvLeaveEncash.Table[R+"_Tag"].toString()+"',",P+=" dcAlpha12='"+this.dgvLeaveEncash.Table[R].dgColLELeaveType+"',",P+=" dcAlpha13='"+this.dgvLeaveEncash.Table[R].dgColLEAvailable+"',",P+=" dcAlpha14='"+this.dgvLeaveEncash.Table[R].dgColLEMaxEncash+"',",P+=" dcAlpha15='"+this.dgvLeaveEncash.Table[R].dgColLEApplied+"',",P+=" dcAlpha16='"+this.dgvLeaveEncash.Table[R].dgColLEAmount.toString().Replace(",","")+"',",P+=" dcAlpha17='"+this.chkLECalcBasedOnLastApprSerYearWise.IsChecked+"',",P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}if(null!=this.dgvUPS&&this.dgvUPS.Table.length>0){let U=1;for(let R=0;R<this.dgvUPS.Table.length;R++)L.J0.Double(this.dgvUPS.Table[R].dgColUPSNetSal)>0&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Un-Processed Salary',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='3',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.UPSRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvUPS.Table[R].dgColUPSPayrollMonth+"',",P+=" dcAlpha12='"+this.dgvUPS.Table[R].dgColUPSMonthDays+"',",P+=" dcAlpha13='"+this.dgvUPS.Table[R].dgColUPSDaysAtt+"',",P+=" dcAlpha14='"+this.dgvUPS.Table[R].dgColUPSLOP+"',",P+=" dcAlpha15='"+this.dgvUPS.Table[R].dgColUPSNetSal.toString().Replace(",","")+"',",P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}if(null!=this.dgvNoticePay&&this.dgvNoticePay.Table.length>0){let U=1;for(let R=0;R<this.dgvNoticePay.Table.length;R++)L.J0.Double(this.dgvNoticePay.Table[R].dgColNPNetSal)>0&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Notice Pay',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='4',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.NoticePayRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvNoticePay.Table[R].dgColNPPayrollMonth+"',",P+=" dcAlpha12='"+this.dgvNoticePay.Table[R].dgColNPMonthDays+"',",P+=" dcAlpha13='"+this.dgvNoticePay.Table[R].dgColNPDaysAtt+"',",P+=" dcAlpha14='"+this.dgvNoticePay.Table[R].dgColNPLOP+"',",P+=" dcAlpha15='"+this.dgvNoticePay.Table[R].dgColNPNetSal.toString().Replace(",","")+"',",P+=" dcAlpha16='"+this.dgvNoticePay.Table[R].dgColNPType+"',",P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}if(null!=this.dgvOthAdd&&this.dgvOthAdd.Table.length>0){let U=1;for(let R=0;R<this.dgvOthAdd.Table.length;R++)!L.J0.IsEmpty(this.dgvOthAdd.Table[R].dgColOthAddParticulars)&&L.J0.Double(this.dgvOthAdd.Table[R].dgColOthAddAmount)>0&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Additions',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='5',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.OAddRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvOthAdd.Table[R].dgColOthAddParticulars+"',",P+=" dcAlpha12='"+this.dgvOthAdd.Table[R].dgColOthAddAmount.toString().Replace(",","")+"',",L.J0.IsEmpty(this.dgvOthAdd.Table[R].dgColOthAddRemarks)||(P+=" dcAlpha13='"+this.dgvOthAdd.Table[R].dgColOthAddRemarks+"',"),P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}if(null!=this.dgvOthDed&&this.dgvOthDed.Table.length>0){let U=1;for(let R=0;R<this.dgvOthDed.Table.length;R++)!L.J0.IsEmpty(this.dgvOthDed.Table[R].dgColOthDedParticulars)&&L.J0.Double(this.dgvOthDed.Table[R].dgColOthDedAmount)>0&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Deductions',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='6',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.ODedRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvOthDed.Table[R].dgColOthDedParticulars+"',",P+=" dcAlpha12='"+this.dgvOthDed.Table[R].dgColOthDedAmount.toString().Replace(",","")+"',",null!=this.dgvOthDed.Table[R].dgColOthDedRemarks&&""!=this.dgvOthDed.Table[R].dgColOthDedRemarks.toString().Trim()&&(P+=" dcAlpha13='"+this.dgvOthDed.Table[R].dgColOthDedRemarks+"',"),P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}if(null!=this.dgvLoanBal&&this.dgvLoanBal.Table.length>0){let U=1;for(let R=0;R<this.dgvLoanBal.Table.length;R++)!L.J0.IsEmpty(this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag)&&null!=this.dgvLoanBal.Table[R].dgColLoanBalCalc_Tag&&(T+="\x11",T+="<Row>",T+="<AccountsXML></AccountsXML>",T+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan Balances',E="",T+=E.length>0?'" DocDetailsID="'+E:'" DocDetailsID="',T+=S.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',T+=P,P='<Alpha Query="',P+=" dcAlpha1='7',",P+=" dcAlpha2='"+U+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.LoanRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvLoanBal.Table[R].dgColLoanBalDocNo+"',",P+=" dcAlpha12='"+this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag+"',",P+=" dcAlpha13='"+this.dgvLoanBal.Table[R].dgColLoanBalLoanType_Tag+"',",P+=" dcAlpha14='"+this.dgvLoanBal.Table[R].dgColLoanBalApprAmount.toString().Replace(",","")+"',",P+=" dcAlpha15='"+this.dgvLoanBal.Table[R].dgColLoanBalAmountPaid.toString().Replace(",","")+"',",P+=" dcAlpha16='"+this.dgvLoanBal.Table[R].dgColLoanBalBalAmount.toString().Replace(",","")+"',",P+=" dcAlpha17='"+this.dgvLoanBal.Table[R].dgColLoanBalSNo_Tag+"',",P+='" ></Alpha>',T+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',T+=P,T+="<EXTRAXML></EXTRAXML>",T+="</Row>",U++)}return T.toString()}GetCalcXML(){let C="";if(C+="<Rows>",this.dgvGratuity.Table.length>0){let T=1;for(let S=0;S<this.dgvGratuity.Table.length;S++)C+='<Row DType="1" SubDType="'+T+'" Field1="'+this.cmbResignType.SelectedValue+'" Field2="'+this.chkCalcBasedOnLastSal.IsChecked+'" Field3="'+this.chkCalcBasedOnActDays.IsChecked+'" Field4="'+this.lblGratuityTotalDays+'" Field5="'+this.dgvGratuity.Table[S][this.dgvGratuity.TableColumns[1]]+'" Field6="'+this.dgvGratuity.Table[S+1][this.dgvGratuity.TableColumns[2]]+'" Field7="'+this.dgvGratuity.Table[S+1][this.dgvGratuity.TableColumns[4]]+'" Field8="'+this.dgvGratuity.Table[S+2][this.dgvGratuity.TableColumns[1]]+'" Field9="'+this.dgvGratuity.Table[S+3][this.dgvGratuity.TableColumns[1]]+'" Field10="'+this.dgvGratuity.Table[S+3][this.dgvGratuity.TableColumns[4]]+'" Field11="'+this.dgvGratuity.Table[S+5][this.dgvGratuity.TableColumns[1]]+'" Field12="'+this.dgvGratuity.Table[S+5][this.dgvGratuity.TableColumns[2]]+'" Field13="'+this.dgvGratuity.Table[S+5][this.dgvGratuity.TableColumns[3]]+'" Field14="'+this.dgvGratuity.Table[S+6][this.dgvGratuity.TableColumns[1]]+'" Field15="'+this.dgvGratuity.Table[S+6][this.dgvGratuity.TableColumns[2]]+'" Field16="'+this.dgvGratuity.Table[S+6][this.dgvGratuity.TableColumns[3]]+'" Field17="'+this.dgvGratuity.Table[S+6][this.dgvGratuity.TableColumns[5]]+'" Field18="'+this.dgvGratuity.Table[S+6][this.dgvGratuity.TableColumns[7]]+'" Field19="'+this.dgvGratuity.Table[S+7][this.dgvGratuity.TableColumns[5]]+'" Field20="'+this.dgvGratuity.Table[S+3][this.dgvGratuity.TableColumns[6]],C+='" />',S+=8,T++}if(this.dgvLeaveEncash.Table.length>0)for(let T=0;T<this.dgvLeaveEncash.Table.length;T++)0!=L.J0.Double(this.dgvLeaveEncash.Table[T].dgColLEAmount)&&(C+='<Row DType="2" SubDType="'+T+'1" Field1="'+this.dgvLeaveEncash.Table[T+"_Tag"].toString()+'" Field2="'+this.dgvLeaveEncash.Table[T].dgColLELeaveType+'" Field3="'+this.dgvLeaveEncash.Table[T].dgColLEAvailable+'" Field4="'+this.dgvLeaveEncash.Table[T].dgColLEMaxEncash+'" Field5="'+this.dgvLeaveEncash.Table[T].dgColLEApplied+'" Field6="'+this.dgvLeaveEncash.Table[T].dgColLEAmount,C+='" />');if(this.dgvUPS.Table.length>0)for(let T=0;T<this.dgvUPS.Table.length;T++)L.J0.Double(this.dgvUPS.Table[T].dgColUPSNetSal)>0&&(C+='<Row DType="3" SubDType="'+T+'1" Field1="'+this.dgvUPS.Table[T].dgColUPSPayrollMonth+'" Field2="'+this.dgvUPS.Table[T].dgColUPSMonthDays+'" Field3="'+this.dgvUPS.Table[T].dgColUPSDaysAtt+'" Field4="'+this.dgvUPS.Table[T].dgColUPSLOP+'" Field5="'+this.dgvUPS.Table[T].dgColUPSNetSal,C+='" />');if(this.dgvNoticePay.Table.length>0)for(let T=0;T<this.dgvNoticePay.Table.length;T++)L.J0.Double(this.dgvNoticePay.Table[T].dgColNPNetSal)>0&&(C+='<Row DType="4" SubDType="'+T+'1" Field1="'+this.dgvNoticePay.Table[T].dgColNPPayrollMonth+'" Field2="'+this.dgvNoticePay.Table[T].dgColNPMonthDays+'" Field3="'+this.dgvNoticePay.Table[T].dgColNPDaysAtt+'" Field4="'+this.dgvNoticePay.Table[T].dgColNPLOP+'" Field5="'+this.dgvNoticePay.Table[T].dgColNPNetSal+'" Field6="'+this.dgvNoticePay.Table[T].dgColNPType,C+='" />');if(this.dgvOthAdd.Table.length>0)for(let T=0;T<this.dgvOthAdd.Table.length;T++)!L.J0.IsEmpty(this.dgvOthAdd.Table[T].dgColOthAddParticulars)&&L.J0.Double(this.dgvOthAdd.Table[T].dgColOthAddAmount)>0&&(C+='<Row DType="5" SubDType="'+T+'1" Field1="'+this.dgvOthAdd.Table[T].dgColOthAddParticulars+'" Field2="'+this.dgvOthAdd.Table[T].dgColOthAddAmount,L.J0.IsEmpty(this.dgvOthAdd.Table[T].dgColOthAddRemarks)||(C+='" Field3="'+this.dgvOthAdd.Table[T].dgColOthAddRemarks),C+='" />');if(this.dgvOthDed.Table.length>0)for(let T=0;T<this.dgvOthDed.Table.length;T++)!L.J0.IsEmpty(this.dgvOthDed.Table[T].dgColOthDedParticulars)&&L.J0.Double(this.dgvOthDed.Table[T].dgColOthDedAmount)>0&&(C+='<Row DType="6" SubDType="'+T+'1" Field1="'+this.dgvOthDed.Table[T].dgColOthDedParticulars+'" Field2="'+this.dgvOthDed.Table[T].dgColOthDedAmount,L.J0.IsEmpty(this.dgvOthDed.Table[T].dgColOthDedRemarks)||(C+='" Field3="'+this.dgvOthDed.Table[T].dgColOthDedRemarks),C+='" />');if(this.dgvLoanBal.Table.length>0)for(let T=0;T<this.dgvLoanBal.Table.length;T++)L.J0.IsEmpty(this.dgvLoanBal.Table[T].dgColLoanBalDocNo_Tag)||(C+='<Row DType="7" SubDType="'+T+'1" Field1="'+this.dgvLoanBal.Table[T].dgColLoanBalDocNo+'" Field2="'+this.dgvLoanBal.Table[T].dgColLoanBalDocNo_Tag+'" Field3="'+this.dgvLoanBal.Table[T].dgColLoanBalLoanType_Tag+'" Field4="'+this.dgvLoanBal.Table[T].dgColLoanBalApprAmount+'" Field5="'+this.dgvLoanBal.Table[T].dgColLoanBalAmountPaid+'" Field6="'+this.dgvLoanBal.Table[T].dgColLoanBalBalAmount+'" Field7="'+this.dgvLoanBal.Table[T].dgColLoanBalSNo_Tag,C+='" />');return C+="</Rows>",C.toString()}ValidateSave(){if(0==this.EmpSeqNo)return this.ViewModel.DisplayMessage="Please Select Employee.",this.EmployeeList.SetFocus=!0,!1;if(null!=this.dsD&&this.dsD.Tables[0].length>0&&"Final"==this.cmbSettlementType.SelectedValue&&(9e3==L.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()||null==this.dsD.Tables[0][0].DORelieve.toString()||""==this.dsD.Tables[0][0].DORelieve.toString()||null==this.dsD.Tables[0][0].DORelieve||""==L.J0.String(this.dsD.Tables[0][0].ResignStatus)||"Posted"!=L.J0.String(this.dsD.Tables[0][0].ResignStatus)))return this.ViewModel.DisplayMessage="Selected Employee not yet Resigned, Please check",!1;let C=I.d.report.GetDataTable("FS001",this.EmpSeqNo.toString(),this.ViewModel.DocID.toString());if(null!=C&&C.length>0)return this.ViewModel.DisplayMessage="Cannot save the record, Employee FinalSettlement is Already done",this.ViewModel.MessageVisibility=!0,!1;if(("Final"==this.cmbSettlementType.SelectedValue||"Partial"==this.cmbSettlementType.SelectedValue&&I.d.SessionManager.Preferences.ContainsKey("PartialFinalSettlementMandatoryRepaymentofloan")&&"True"==I.d.SessionManager.Preferences.PartialFinalSettlementMandatoryRepaymentofloan.toString())&&this.dgvLoanBal.Table.length>0)for(let T=0;T<this.dgvLoanBal.Table.length;T++)if(L.J0.IsEmpty(this.dgvLoanBal.Table[T].dgColLoanBalCalc_Tag))return this.ViewModel.DisplayMessage="Please pay pending Loan Balance amounts.",!1;return null!=I.d.SessionManager.Preferences.PayrollProduct&&""!=I.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(I.d.SessionManager.Preferences.PayrollProduct)),0!=this.DefProdID||(this.ViewModel.DisplayMessage="Select any Default Payroll Product at Global Preferences",!1)}btnCalcGratuity_Click(){this.dgvGratuity.Columns.Clear(),this.dgvGratuity.TableColumns.Clear(),this.dgvGratuity.Clear();let C={dTotGratuitySal:0};if(this.dEarnedGrDays=0,this.isMaxDaysExceded=!1,this.dTotGratuityDays=0,!(this.EmpSeqNo>0))return this.ViewModel.DisplayMessage="Select any Employee",void(this.EmployeeList.SetFocus=!0);{let E=I.d.common.GetDataSet3("CRM023",this.EmpSeqNo.toString(),this.dtpDateOfRelieving.Date.Date().ToString("dd MMM yyyy"));if(null!=E&&E.Tables.length>0){if(this.isConsdExpiredupto=!1,4==this.cmbResignType.SelectedIndex&&E.Tables[0].length>0){let w=0;w=L.J0.IntTryParse(E.Tables[0][0].ConsdExpiredupto),w>0&&(this.dtpDateOfRelieving.Date=this.DOB.AddYears(w),this.isConsdExpiredupto=!0)}if(this.dLOPDays=0,this.dLOPDays=parseFloat(this.dsD.Tables[0][0].OPLOPDays),E.Tables[2].length>0)if(null!=this.dtEdit&&this.dtEdit.length>0){let w=this.dtEdit.filter($=>"1"==$.dcAlpha1&&"1"==$.dcAlpha2);null!=w&&w.length>0&&(this.dGratuityTaken=parseFloat(""==L.J0.String(w[0].dcAlpha32)?"0":w[0].dcAlpha32))}else this.dGratuityTaken=parseFloat(E.Tables[2][0].GratuityTaken);if(!(E.Tables[0].length>0))return void(this.ViewModel.DisplayMessage="Gratuity settings not found for this Grade.");{this.EOS_ROffYear=L.J0.DoubleTryParse(E.Tables[0][0].ROffYear);let X,w=this.dtpDateOfJoining.Date.Date(),$=this.dtpDateOfRelieving.Date.Date();if(this.EOS_ROffYear>0){let h=0,c=0;if(L.J0.GetYearsMonthsDays(w,$,{iY22:0,iM22:h,iD22:c}),h>=this.EOS_ROffYear){let u=0;c>0?(u=12-h,$=$.AddMonths(u).AddDays(-c)):$=$.AddMonths(-h).AddDays(-c)}else $=$.AddMonths(-h).AddDays(-c)}if(this.LoadExperinceDaysData(this.lst,E.Tables[0],"Resigned"==this.cmbResignType.SelectedValue?0:"Expired"==this.cmbResignType.SelectedValue?2:1),this.GratuityDocID=parseInt(E.Tables[0][0].DocID),this.GratuityGrade=parseInt(E.Tables[0][0].GradeID),this.EOS_MaxDays=L.J0.Double(E.Tables[0][0].MaxDays),this.EOS_ExcludeLOP=E.Tables[0][0].ExcludeLOP.toString(),this.ActEOS_ExcludeLOP=E.Tables[0][0].ExcludeLOP.toString(),this.EOS_ROff=L.J0.Double(E.Tables[0][0].ROff),this.EOS_CalcBasedOn=E.Tables[0][0].CalcBasedOn.toString(),this.EOS_GratuityFormula=E.Tables[0][0].Formula.toString(),this.EOS_AvailedFormula=null!=E.Tables[0][0].AvailedFormula&&null!=E.Tables[0][0].AvailedFormula&&""!=E.Tables[0][0].AvailedFormula.toString().Trim()?E.Tables[0][0].AvailedFormula.toString():"GratuityAmount","Exclude at Last"==this.EOS_ExcludeLOP){this.EOS_ExcludeLOP="No";let r={PayrollMonth:T=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:P=new Date};L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,r),T=r.PayrollMonth,P=r.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,r,this.EmpGrade),T=r.PayrollMonth,P=r.PayrollMonthEnd);let h=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),c=T,g=0;if(I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())g=this.GetLOPDaysFromDoc(h,P),this.dLOPDays+=g;else{g=this.GetPreviousLOPDays(h,c),this.dLOPDays+=g;let u=I.d.common.GetDataSet3("CRM024",this.EmpSeqNo.toString(),h.ToString("dd/MMM/yyyy"),c.ToString("dd/MMM/yyyy"));null!=u&&u.Tables.length>0&&(u.Tables[0].length>0&&(this.dLOPDays+=parseFloat(u.Tables[0][0].LOP.toString())),u.Tables[1].length>0&&(this.dLOPDays-=parseFloat(u.Tables[1][0].LOP.toString())))}$=$.AddDays(-this.dLOPDays)}for(let r=0;r<8;r++)X=new Z.O7,X.DisplayMember="Column"+r,X.ReadOnly=!0,X.Header="",X.Width=0==r?150:80,this.dgvGratuity.Columns.push(X),this.dgvGratuity.TableColumns.push(X.DisplayMember);if(this.dgvGratuity.RefreshColumns(),this.dActServiceDays=$.Subtract(w).Days+1,"Service Days"==this.EOS_CalcBasedOn){if(this.dServiceDaysAfterLOP=0,"No"!=this.EOS_ExcludeLOP){var T,P;let g={PayrollMonth:T=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:P=new Date};L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,g),T=g.PayrollMonth,P=g.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,g,this.EmpGrade),T=g.PayrollMonth,P=g.PayrollMonthEnd);let u=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),p=T,e=0;if(I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())e=this.GetLOPDaysFromDoc(u,P),this.dLOPDays+=e;else{e=this.GetPreviousLOPDays(u,p),this.dLOPDays+=e;let D=I.d.common.GetDataSet3("CRM025",this.EmpSeqNo.toString(),u.ToString("dd/MMM/yyyy"),p.ToString("dd/MMM/yyyy"));null!=D&&D.Tables.length>0&&D.Tables[0].length>0&&(this.dLOPDays+=parseFloat(D.Tables[0][0].LOP.toString()))}}this.dServiceDaysAfterLOP=this.dActServiceDays-this.dLOPDays,this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("ServiceDays",this.dActServiceDays.toString()),this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("LOPDays",this.dLOPDays.toString()),this.EOS_AvailedFormula=this.EOS_AvailedFormula.Replace("ServiceDays",this.dActServiceDays.toString())}this.dblGratuityAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly);let W=this.dtpDateOfJoining.Date.Date(),U=this.dtpDateOfRelieving.Date.Date(),R=0,B=0,se=0,z={iY:R,iM:B,iD:se};if(L.J0.GetYearsMonthsDays(W,U,z),R=z.iY,B=z.iM,se=z.iD,"Service Days"==this.EOS_CalcBasedOn){this.CalcGratuityBasedOnServiceDays(this.dblGratuityAmount,w,$,C);let r=0,h=0,c=0,g={iY:r,iM:h,iD:c};L.J0.GetYearsMonthsDays(w,$,g),r=g.iY,h=g.iM,c=g.iD,this.lblGratuityTotalDays=r+" : "+this.GetResource("Years",40095)+", "+h+" : "+this.GetResource("Months",40095)+", "+c+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=C.dTotGratuitySal.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount(),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let u={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),u),this.oEvalPayFormulas.PayrollMonth=u.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=u.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=u.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),g,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=u.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=u.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=u.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),E.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(E.Tables[1].length);for(let p=0;p<E.Tables[1].length;p++)this.oCPF=new fe.ph,this.oCPF.ComponentName="Lookup"+E.Tables[1][p].NodeID.toString(),this.oCPF.SNo=p+1,null!=E.Tables[0][0][E.Tables[1][p].SysColumnName.toString()]&&null!=E.Tables[0][0][E.Tables[1][p].SysColumnName.toString()]&&(this.oCPF.Formula=E.Tables[0][0][E.Tables[1][p].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[p].dgColOthAddParticulars=parseInt(E.Tables[1][p].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[p])}this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=R,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let p=0;p<this.oEvalPayFormulas.arrLstCPFields[6].length;p++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][p].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(I.d.SessionManager.sPayrollDecimals):(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][p].dEarned).ToString(I.d.SessionManager.sPayrollDecimals);else for(let e=0;e<this.dgvOthAdd.Table.length;e++)if(this.oEvalPayFormulas.arrLstCPFields[6][p].ComponentName=="Lookup"+L.J0.String(this.dgvOthAdd.Table[e].dgColOthAddParticulars)){this.dgvOthAdd.Table[e].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][p].dEarned).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[e]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}return}let le,he=w,Be=0,Ge=0,_e=0,ye={iY:Be,iM:Ge,iD:_e};L.J0.GetYearsMonthsDays(w,$,ye),Be=ye.iY,Ge=ye.iM,_e=ye.iD;let Ee=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked,st=this.dblGratuityAmount,Se=new Array,Re=new Array,V=new Array;Se.push(he);for(let r=0;r<this.lst.length;r++){if(Be<parseInt(this.lst[r].Year.Replace("=",""))){Re.push($),V.push(V.length>0?V[V.length-1]:0);break}if(this.lst[r].Days>0){if(this.lst[r].IsApplyToPrevYrs)for(let h=0;h<V.length;h++)V[h]=this.lst[r].Days;if(le=he.AddYears(parseInt(this.lst[r].Year.Replace("=",""))).AddDays(-1),le>=$){le=$,Re.push(le),V.push(this.lst[r].Days);break}V.Contains(this.lst[r].Days)?(Re[Re.length-1]=le,Se[Se.length-1]=le.AddDays(1)):(V.push(this.lst[r].Days),Re.push(le),Se.push(le.AddDays(1)))}}if(this.isLast=!1,Se.length>0)for(let r=0;r<Se.length;r++)if(r==Se.length-1&&(this.isLast=!0),Ee){if(Se.length>r+1)if(V[r]!=V[r+1]){if(this.CalcGratuityDays(V[r],st,Se[r],Re[r],C),this.isMaxDaysExceded)break}else Re[r]=Re[r+1],Se.RemoveAt(r+1),Re.RemoveAt(r+1),V.RemoveAt(r+1),r--;else if(this.isConsdExpiredupto){if(this.CalcGratuityDays(V[r],st,Se[r],this.dtActRelievingDate,C),this.isMaxDaysExceded||(this.CalcGratuityDays(V[r],st,this.dtActRelievingDate.AddDays(1),Re[r],C),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(V[r],st,Se[r],Re[r],C),this.isMaxDaysExceded)break}else if(Se.length>r+1)if(V[r]!=V[r+1]){let h=this.dsD.Tables[3].filter(g=>L.J0.ParseDate(g.dtEffectFrom)>=Se[r].AddDays(1)&&L.J0.ParseDate(g.dtEffectFrom)<=Re[r]),c=this.dsD.Tables[3].filter(g=>L.J0.ParseDate(g.dtEffectFrom)<=Se[r]);if(c.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=h&&h.length>0){let u,g=0;for(g=0;g<h.length;g++)if(0==g){if(this.CalcGratuityDays(V[r],parseFloat(c[0].BasicMonthly),Se[r],L.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),C),this.isMaxDaysExceded){u=!0;break}}else if(this.CalcGratuityDays(V[r],parseFloat(h[g-1].BasicMonthly),L.J0.ParseDate(h[g-1].dtEffectFrom),L.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),C),this.isMaxDaysExceded){u=!0;break}if(u||(this.CalcGratuityDays(V[r],parseFloat(h[g-1].BasicMonthly),L.J0.ParseDate(h[g-1].dtEffectFrom),Re[r],C),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(V[r],parseFloat(c[0].BasicMonthly),Se[r],Re[r],C),this.isMaxDaysExceded)break}else Re[r]=Re[r+1],Se.RemoveAt(r+1),Re.RemoveAt(r+1),V.RemoveAt(r+1),r--;else{let h=this.dsD.Tables[3].filter(g=>L.J0.ParseDate(g.dtEffectFrom)>=Se[r].AddDays(1)&&L.J0.ParseDate(g.dtEffectFrom)<=Re[r]),c=this.dsD.Tables[3].filter(g=>L.J0.ParseDate(g.dtEffectFrom)<=Se[r]);if(c.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=h&&h.length>0){let u,g=0;for(g=0;g<h.length;g++)if(0==g){if(this.CalcGratuityDays(V[r],parseFloat(c[0].BasicMonthly),Se[r],L.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),C),this.isMaxDaysExceded){u=!0;break}}else if(this.CalcGratuityDays(V[r],parseFloat(h[g-1].BasicMonthly),L.J0.ParseDate(h[g-1].dtEffectFrom),L.J0.ParseDate(h[g].dtEffectFrom).AddDays(-1),C),this.isMaxDaysExceded){u=!0;break}if(u||(this.CalcGratuityDays(V[r],parseFloat(h[g-1].BasicMonthly),L.J0.ParseDate(h[g-1].dtEffectFrom),Re[r],C),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(V[r],parseFloat(c[0].BasicMonthly),Se[r],Re[r],C),this.isMaxDaysExceded)break}let a=0,l=0,t=0,i={iY:a,iM:l,iD:t};L.J0.GetYearsMonthsDays(w,$,i),a=i.iY,l=i.iM,t=i.iD,this.lblGratuityTotalDays=a+" : "+this.GetResource("Years",40095)+", "+l+" : "+this.GetResource("Months",40095)+", "+t+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=C.dTotGratuitySal.ToString(I.d.SessionManager.sPayrollDecimals);let o=this.dtpDateOfRelieving.Date.Date().Subtract(w.Date()).Days+1;if(this.lblGratuityServiceDays=o.toString(),this.lblGratuityLOPDays=this.dLOPDays.toString(),this.lblGratuityBalDays=(o-this.dLOPDays).toString(),this.lblGratuityTotalGrDays=this.dTotGratuityDays.toString(),this.lblGratuityTaken=this.dGratuityTaken.toString(),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),z={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z),this.oEvalPayFormulas.PayrollMonth=z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=z.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),z,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=z.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),E.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(E.Tables[1].length);for(let r=0;r<E.Tables[1].length;r++)this.oCPF=new fe.ph,this.oCPF.ComponentName="Lookup"+E.Tables[1][r].NodeID.toString(),this.oCPF.SNo=r+1,L.J0.IsEmpty(E.Tables[0][0][E.Tables[1][r].SysColumnName.toString()])||(this.oCPF.Formula=E.Tables[0][0][E.Tables[1][r].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[r].dgColOthAddParticulars=parseInt(E.Tables[1][r].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[r])}this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=R,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let r=0;r<this.oEvalPayFormulas.arrLstCPFields[6].length;r++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][r].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(I.d.SessionManager.sPayrollDecimals):(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][r].dEarned).ToString(I.d.SessionManager.sPayrollDecimals);else for(let h=0;h<this.dgvOthAdd.Table.length;h++)if(this.oEvalPayFormulas.arrLstCPFields[6][r].ComponentName=="Lookup"+L.J0.String(this.dgvOthAdd.Table[h].dgColOthAddParticulars)){this.dgvOthAdd.Table[h].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][r].dEarned).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[h]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}}}}this.CalculateTotalAmount()}LoadExperinceDaysData(C,T,S){C.Clear();let P="Res";1==S?P="Term":2==S&&(P="Expired");for(let E=0;E<T.length;E++)C.push(new ha),C[E].Year=T[E][P+"Exp"].toString().Contains("+")?T[E][P+"Exp"].toString().Replace("[+]",""):"="+T[E][P+"Exp"].toString(),C[E].Days=parseFloat(T[E][P+"GrDays"]),C[E].IsApplyToPrevYrs="Yes"==T[E][P+"ApplyPrevYrs"].toString()}CalcGratuityDays(C,T,S,P,E){this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity/Year",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=C;let w=C,$="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),$=this.GetResource("Start Date",40095)+S.ToString("dd/MMM/yyyy")+"          ",$+=this.GetResource("End Date",40095)+P.ToString("dd/MMM/yyyy");let W=0,U=0,R=0,B=this.dtpDateOfJoining.Date.Date(),se=this.dtpDateOfRelieving.Date.Date(),z=0,he=0,le=0,Ie={iY:z,iM:he,iD:le};L.J0.GetYearsMonthsDays(B,P,Ie),z=Ie.iY,he=Ie.iM,le=Ie.iD;let we=0,Be=0,Ge=0,_e={iY:we,iM:Be,iD:Ge};L.J0.GetYearsMonthsDays(S,P,_e),we=_e.iY,Be=_e.iM,Ge=_e.iD;let ye=0;if("No"!=this.EOS_ExcludeLOP){var Ee=new Date,ot=new Date,st=new Date,Se={PayrollMonth:Ee,PayrollMonthStart:ot,PayrollMonthEnd:st};if(L.J0.SetPayrollDate_1(P,Se),Ee=Se.PayrollMonth,ot=Se.PayrollMonthStart,st=Se.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(L.J0.SetPayrollDate_1(P,Se,this.EmpGrade),Ee=Se.PayrollMonth,ot=Se.PayrollMonthStart,st=Se.PayrollMonthEnd),I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())ye=this.GetLOPDaysFromDoc(S,P);else{ye=this.GetPreviousLOPDays(S,Ee);let c=I.d.common.GetDataSet3("CRM026",this.EmpSeqNo.toString(),S.ToString("dd/MMM/yyyy"),Ee.ToString("dd/MMM/yyyy"));null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&(ye+=parseFloat(c.Tables[0][0].LOP.toString()))}let r=P;r=S==this.dtpDateOfJoining.Date.Date()?r.AddDays(-(this.dLOPDays+ye)):r.AddDays(-ye);let h={iY:we,iM:Be,iD:Ge};L.J0.GetYearsMonthsDays(S,r,h),we=h.iY,Be=h.iM,Ge=h.iD,this.dLOPDays+=ye}W=we*w,U=Be/12*w,R=Ge/365*w,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=S.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=P.ToString("dd/MMM/yyyy"),"Exclude at Last"==this.ActEOS_ExcludeLOP&&P.ToString("dd MMM yyyy")==se.AddDays(-this.dLOPDays).ToString("dd MMM yyyy")&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Actual End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=se.ToString("dd/MMM/yyyy"));let Re=!!this.chkCalcBasedOnActDays.IsChecked&&this.chkCalcBasedOnActDays.IsChecked,V=0,a=0,l=0;if(Re){let c,r=S,h=P,g=0,u=0;for(;r<=h;){if(c=new Date(r.getFullYear(),r.getMonth(),r.DaysInMonth()),!(c<=h)){g=h.Subtract(r).Days+1,a+=g,u=T*g/c.getDate(),l+=u;break}g=c.Subtract(r).Days+1,a+=g,u=T*g/c.getDate(),l+=u,r=c.AddDays(1)}V=l/a}let t=P.Subtract(S).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let i=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=T,i=T,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=we+" : "+this.GetResource("Years",40095)+", "+Be+" : "+this.GetResource("Months",40095)+", "+Ge+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=t,"Exclude at Last"==this.ActEOS_ExcludeLOP?this.isLast&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Total LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=this.dLOPDays):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=ye),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("Months",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=we,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=Be,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=Ge,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Available Gratuity",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=W,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=U,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=R;let o=W+U+R;if(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=o,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",o=Y.RoundOffValue(o,this.EOS_ROff),this.EOS_MaxDays>0&&this.dEarnedGrDays+o>=this.EOS_MaxDays?(o=this.EOS_MaxDays-this.dEarnedGrDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=o,this.isMaxDaysExceded=!0):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=o,this.dEarnedGrDays+=o),this.dTotGratuityDays+=o,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity",40095),Re)this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=l+" / "+a,i=V*o;else{let r=this.dtpDateOfJoining.Date.Date(),h=this.dtpDateOfRelieving.Date.Date(),c=0,g=0,u=0,p={iY:c,iM:g,iD:u};L.J0.GetYearsMonthsDays(r,h,p),c=p.iY,g=p.iM,u=p.iD;let e=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked;this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),p={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},e?(L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),p),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),p,this.EmpGrade)):(L.J0.SetPayrollDate_1(S.Date(),p),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&L.J0.SetPayrollDate_1(S.Date(),p,this.EmpGrade)),this.oEvalPayFormulas.PayrollMonth=p.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=p.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=p.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula.Replace("GratuityDays",o.toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=T,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=c,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let D=0;D<this.oEvalPayFormulas.arrLstCPFields[6].length;D++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][D].ComponentName){i=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][D].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=i,E.dTotGratuitySal+=i,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.refreshDataView()}GetPreviousLOPDays(C,T){let S=0,P=I.d.common.GetDataSet3("CRM027",this.EmpSeqNo.toString(),C.ToString("dd/MMM/yyyy"),T.ToString("dd/MMM/yyyy")).Tables[0];return null!=P&&P.length>0&&(S=parseFloat(P[0].LOPDays)),S}GetLOPDaysFromDoc(C,T){let S=0;if(I.d.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=I.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){let P=[];P.push(this.EmpSeqNo),P.push(C.ToString("dd/MMM/yyyy")),P.push(C.ToString("dd/MMM/yyyy")),P.push(T.ToString("dd/MMM/yyyy")),P.push(2),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.RoleID),P.push(I.d.SessionManager.LanguageID);let E=I.d.common.GetDataSet_SP(P,"spPAY_GetEmpAdjDetailsMultiple"),w=[];w.push(C.ToString("dd MMM yyyy")),w.push(""),w.push(0),w.push(I.d.SessionManager.RoleID),w.push(I.d.SessionManager.UserID),w.push(I.d.SessionManager.LanguageID);let $=I.d.common.GetDataSet_SP(w,"spPAY_GetEmpMasterCCDetails");null!=E&&E.Tables.length>0&&E.Tables[0].length>0&&E.Columns[0].Contains("EmpSeqNo")&&(S=this.AggregateLeaves(this.EmpSeqNo.toString(),E,C,T,$,this.dsD.Tables[0],this.EmpGrade))}return S}static RoundOffValue(C,T){if(T>0&&C>0){let S=0,P=!1;S=C%T,S>0&&(T/S<=2&&(P=!0),C-=S,P&&(C+=T))}return C}CalcGratuityBasedOnServiceDays(C,T,S,P){this.dgvGratuity.addEmptyRow();let E="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),E=this.GetResource("Start Date",40095)+T.ToString("dd/MMM/yyyy")+"          ",E+=this.GetResource("End Date",40095)+S.ToString("dd/MMM/yyyy");let w=0,$=0,X=0,W={iY:w,iM:$,iD:X};L.J0.GetYearsMonthsDays(T,S,W),w=W.iY,$=W.iM,X=W.iD,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=T.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=S.ToString("dd/MMM/yyyy");let U=S.Subtract(T).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let R=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=C,R=C,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=w+" : "+this.GetResource("Years",40095)+", "+$+" : "+this.GetResource("Months",40095)+", "+X+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=U,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Total Duration Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Service Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dActServiceDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.dLOPDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.dServiceDaysAfterLOP,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dServiceDaysAfterLOP,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]="/",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]="365";let B=this.dServiceDaysAfterLOP/365;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=B,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=B,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity Amount",40095);{this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let se={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),se),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),se,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=se.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=se.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=se.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new fe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=C,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=w,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let z=0;z<this.oEvalPayFormulas.arrLstCPFields[6].length;z++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][z].ComponentName){this.dServiceDaysFormulaAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][z].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.dServiceDaysFormulaAmount,P.dTotGratuitySal+=this.dServiceDaysFormulaAmount,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]="* * * * *"}dgvLeaveEncash_CellValidating(C,T){}btnCalcLeaveEncash_Click(){let C=this.chkLECalcBasedOnLastApprSerYearWise.IsChecked;this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let T={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),T),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&L.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),T,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=T.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=T.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=T.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear();let S=0;if(this.dgvLeaveEncash.Table.length>0){for(let E=0;E<this.dgvLeaveEncash.Table.length;E++)C&&this.dgvLeaveEncash.Table[E].dgColLELeaveType_Tag==this.sVacTypeSeqNo||L.J0.IsEmpty(this.dgvLeaveEncash.Table[E].dgColLEApplied)||(L.J0.IsEmpty(this.dgvLeaveEncash.Table[E].dgColLEAmount_Tag)||(this.strFormula=this.dgvLeaveEncash.Table[E].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays",this.dgvLeaveEncash.Table[E].dgColLELeaveType_Tag==this.sVacTypeSeqNo?"("+this.dgvLeaveEncash.Table[E].dgColLEApplied.toString()+")":"("+this.dgvLeaveEncash.Table[E].dgColLEApplied.toString().Replace("-","!")+")"),this.oCPF=new fe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[E+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[E+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF));this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas();for(let E=0;E<this.dgvLeaveEncash.Table.length;E++)if((!C||this.dgvLeaveEncash.Table[E].dgColLELeaveType_Tag!=this.sVacTypeSeqNo)&&0!=L.J0.Double(this.dgvLeaveEncash.Table[E].dgColLEApplied))for(let w=0;w<this.oEvalPayFormulas.arrLstCPFields[6].length;w++)if(this.oEvalPayFormulas.arrLstCPFields[6][w].ComponentName=="LEFormula"+this.dgvLeaveEncash.Table[E+"_Tag"].toString()){this.dgvLeaveEncash.Table[E].dgColLEAmount=this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned,S+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned);break}}let P=0;if(C&&this.dgvLeaveEncash.Table.length>0)for(let E=0;E<this.dgvLeaveEncash.Table.length;E++)if(this.dgvLeaveEncash.Table[E].dgColLELeaveType_Tag.toString()==this.sVacTypeSeqNo){if(!L.J0.IsEmpty(this.dgvLeaveEncash.Table[E].dgColLEApplied)&&parseFloat(this.dgvLeaveEncash.Table[E].dgColLEApplied)>0){let U,R,$=parseFloat(this.dgvLeaveEncash.Table[E].dgColLEApplied),X=0,W=null;try{U=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate())}catch{U=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate()-1)}for(U>this.dtpDateOfRelieving.Date&&(U=U.AddYears(-1)),R=this.dtpDateOfRelieving.Date;$>0;){W=this.ViewModel.GetVacationDays(U,R,this.EmpSeqNo),X=parseFloat(W.Tables[1][0].CreditedDays),X>$&&(X=$),this.oEvalPayFormulas=new fe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let B={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};L.J0.SetPayrollDate_1(R,B),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&L.J0.SetPayrollDate_1(R,B,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=B.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=B.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=B.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),null!=this.dgvLeaveEncash.Table[E].dgColLEAmount_Tag&&""!=this.dgvLeaveEncash.Table[E].dgColLEAmount_Tag.toString().Trim()&&(this.strFormula=this.dgvLeaveEncash.Table[E].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+X.toString().Replace("-","!")+")"),this.oCPF=new fe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[E+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[E+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.oEvalPayFormulas.dsAllEmpsData.Tables[2][this.dsD.Tables[2].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),P+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned),$=parseFloat(($-X).ToString("0.00")),R=U.AddDays(-1),U=U.AddYears(-1)}this.dgvLeaveEncash.Table[E].dgColLEAmount=P}break}this.txtLEAmount.Text=(parseFloat(this.txtCumLeaveSalBalAmt.Text)+S+P).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.invalidate(),this.CalculateTotalAmount()}dgvUPS_CellClick(C,T){if("dgColUPSCalc"==this.dgvUPS.Columns[C.cell].DisplayMember){L.J0.SetPayrollMonth(L.J0.ParseDate(this.dgvUPS.Table[C.row].dgColUPSPayrollMonth));let S=new Ye.MonthlyPayrollViewModel("Monthly Payroll","UnProcessed");S.sProcessType="UnProcessed",S.SelectedEmpID=this.EmpSeqNo,S.EmployeeList.Code.SelectedValue=S.EmployeeList.Name.SelectedValue=this.EmpSeqNo,S.EmployeeList.Code.Text=S.EmployeeList.Name.Text=this.EmployeeList.Text,S.InitSelectedEmployee(),I.d.page.ShowDialog(S,ae.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{S.DialogResult&&(this.dgvUPS.Table[C.row].dgColUPSDaysAtt=S.dFS_DaysAttended,this.dgvUPS.Table[C.row].dgColUPSLOP=S.dFS_LOPDays,this.dgvUPS.Table[C.row].dgColUPSNetSal=S.dFS_NetSal,this.dgvUPS.updateRow(this.dgvUPS[C.row]));let P=0;if(this.dgvUPS.Table.length>0)for(let E=0;E<this.dgvUPS.Table.length;E++)P+=parseFloat(this.dgvUPS.Table[E].dgColUPSNetSal);this.txtUPSAmount.Text=P.ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.invalidate(),this.CalculateTotalAmount()})}}dgvNoticePay_CellClick(C,T){if("dgColNPCalc"==this.dgvNoticePay.Columns[C.cell].DisplayMember){L.J0.SetPayrollMonth(L.J0.ParseDate(this.dgvNoticePay.Table[C.row].dgColNPPayrollMonth));let S=new Ye.MonthlyPayrollViewModel("Monthly Payroll","NoticePay");S.sProcessType="NoticePay",S.SelectedEmpID=this.EmpSeqNo,S.EmployeeList.Code.SelectedValue=S.EmployeeList.Name.SelectedValue=this.EmpSeqNo,S.EmployeeList.Code.Text=S.EmployeeList.Name.Text=this.EmployeeList.Text,S.InitSelectedEmployee(),I.d.page.ShowDialog(S,ae.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{S.DialogResult&&(this.dgvNoticePay.Table[C.row].dgColNPDaysAtt=S.dFS_DaysAttended,this.dgvNoticePay.Table[C.row].dgColNPLOP=S.dFS_LOPDays,this.dgvNoticePay.Table[C.row].dgColNPNetSal=S.dFS_NetSal,this.dgvNoticePay.updateRow(this.dgvNoticePay[C.row])),this.dgvNoticePay.Update(),this.CalculateNoticePayAmount()})}}CalculateNoticePayAmount(){let C=0;if(this.dgvNoticePay.Table.length>0)for(let T=0;T<this.dgvNoticePay.Table.length;T++)"Add"==L.J0.String(this.dgvNoticePay.Table[T].dgColNPType)?C+=parseFloat(this.dgvNoticePay.Table[T].dgColNPNetSal):"Subtract"==L.J0.String(this.dgvNoticePay.Table[T].dgColNPType)&&(C-=parseFloat(this.dgvNoticePay.Table[T].dgColNPNetSal));this.txtNPAmount.Text=C.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthAdd_CellEndEdit(C,T){null==T&&(T=C.cell),"dgColOthAddAmount"==this.dgvOthAdd.Columns[T].DisplayMember&&(this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd")),"dgColOthAddAmount"==this.dgvOthAdd.Columns[T].DisplayMember&&this.CalculateOthAddAmount()}dgvOthAdd_RowsAdded(C,T){this.GenerateSerialNos(this.dgvOthAdd)}CalculateOthAddAmount(){let C=0;for(let T=0;T<this.dgvOthAdd.Table.length;T++)L.J0.IsEmpty(this.dgvOthAdd.Table[T].dgColOthAddAmount)||(C+=parseFloat(this.dgvOthAdd.Table[T].dgColOthAddAmount));this.txtOthAddAmount.Text=C.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthDed_CellEndEdit(C,T){null==T&&(T=C.cell),"dgColOthDedAmount"==this.dgvOthDed.Columns[T].DisplayMember&&(this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")),"dgColOthDedAmount"==this.dgvOthDed.Columns[T].DisplayMember&&this.CalculateOthDedAmount()}dgvOthDed_RowsAdded(C,T){this.GenerateSerialNos(this.dgvOthDed)}CalculateOthDedAmount(){let C=0;for(let T=0;T<this.dgvOthDed.Table.length;T++)L.J0.IsEmpty(this.dgvOthDed.Table[T].dgColOthDedAmount)||(C+=parseFloat(this.dgvOthDed.Table[T].dgColOthDedAmount));this.txtOthDedAmount.Text=C.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dtpDateOfRelieving_SelectedDateChanged(C,T){this.PrevEmpSeqNo==this.EmpSeqNo&&0==L.J0.GetDateDifference(this.dtpDateOfRelieving.Date,this.dtPrevDateOfRelieving)||(this.PrevEmpSeqNo=this.EmpSeqNo,this.dtPrevDateOfRelieving=this.dtpDateOfRelieving.Date,this.RefreshLeaveEncashDetails())}btnSaveAndPrint_Click(C){this.ViewModel.SelectedEmpID>0?(this.Save_Click(),this.ViewModel.IsSaved&&this.ViewModel.DocID>0&&(this.PrintFS("SaveAndPrint"),this.ViewModel.IsSaved=!1,this.ViewModel.SelectedEmpID=0)):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrint_Click(C){return this.ViewModel.DocID>0?(this.PrintFS("Print"),""):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0,"")}PrintFS(C){this.MoreThanOneLayout=!1;let S=this.ViewModel.DocID;this.IsExportPrint=!1;let P=null,E=re.VoucherExportExcel.GetLocationPrintLayouts(50051,0,S);if(this.IsExportPrint)P=null;else{if(null==E||0==E.Tables[0].length)return I.d.GetResource("Err_PrintLayoutNotDefined");if(E.Tables[0].length>1){this.MoreThanOneLayout=!0;let w=new je.VPTDialogViewModel(E.Tables[0]);I.d.page.ShowDialog(w,Ke.VPTDialogComponent,{ShowCenter:!0},()=>{if(w.IsOkClicked&&(P=w.SelectedRow),null!=P){let X=new J.bT;X.push("IsFSDoc","1"),I.d.report.ExportPDF_Masters(50051,S.toString(),parseInt(P.DocPrintLayoutID),"PDF","",X).subscribe(W=>{"Export"==C?I.d.SessionManager.Download(W.FileName,"abcd"):(I.d.SessionManager.printTab(W.FileName),L.J0.IsEmpty(W.Message)&&!L.J0.IsEmpty(W.FileName)&&(this.ViewModel.DisplayMessage="Printed Sucessfully"))},W=>{this.ViewModel.DisplayMessage="Error in Preview",console.log(W)})}})}else P=E.Tables[0][0]}if(this.dsTotLayouts=E,this.drSelPrintLayout=P,null!=P&&!this.MoreThanOneLayout){let w=new J.bT;w.push("IsFSDoc","1"),I.d.report.ExportPDF_Masters(50051,S.toString(),parseInt(P.DocPrintLayoutID),"PDF","",w).subscribe($=>{console.log($),I.d.SessionManager.Download($.FileName,"abcd"),I.d.SessionManager.printTab($.FileName),L.J0.IsEmpty($.Message)&&!L.J0.IsEmpty($.FileName)&&(this.ViewModel.DisplayMessage="printed Successfully")},$=>{this.ViewModel.DisplayMessage="Error in Preview",console.log($)})}return""}btnPrintPreview_Click(C){this.ViewModel.DocID>0?this.PrintFS("Preview"):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnExport_Click(C){if(!(this.ViewModel.DocID>0))return this.ViewModel.DisplayMessage="Load document in Edit Mode",void(this.ViewModel.MessageVisibility=!0);this.PrintFS("Export")}dgvLoanBal_CellClick(C,T){if("dgColLoanBalCalc"==this.dgvLoanBal.Columns[C.cell].DisplayMember){let E=I.d.common.GetDataTable("CRM028","");if(null!=E&&E.length>0){let w,$=Date.Today(),X=this.dsD.Tables[11].filter(W=>W.RefNo==this.dgvLoanBal.Table[C.row].dgColLoanBalDocNo);if(X.length>0){w=new Ae.AddEditDocumentViewModel(40057,"Loan Repayment",!0,"IsFrmFS_LoanBal"),w.ScreenObject.Link.LinkCombo.Enable=!1,w.ScreenObject.Link.DocumentList.Enable=!1,w.ScreenObject.Preferences.Selective="false";let W={value:$};w.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(X[0].DocID),W,!1),$=W.value}else{w=new Ae.AddEditDocumentViewModel(40057,"Loan Repayment",!1,"IsFrmFS_LoanBal"),w.ScreenObject.Link.LinkCombo.SelectedValue=E[0].DocumentLinkDefID.toString(),w.ScreenObject.Link.LinkCombo.Enable=!1,w.ScreenObject.Link.DocumentList.Enable=!1,w.ScreenObject.Preferences.Selective="false";let W=w.ScreenObject._CCFields.find(U=>"dcCCNID51"==U.DBColumnName);null!=W&&(W instanceof d.y$||W instanceof Q.G)&&(W.SelectedValue=this.EmpSeqNo),w.OLinkSelectionChanged(null)}w.IsFrmFS_LoanBal=!0;var S=w.ScreenObject.HeaderFields.find(W=>W instanceof ze.MI&&"DocDate"==W.DBColumnName.toString());S&&(S.Enable=!1),(S=w.ScreenObject.HeaderFields.find(W=>W instanceof ze.MI&&"VoucherNo"==W.DBColumnName.toString()))instanceof Xe.e3&&(S.Enable=!1,S.LoadVisibility=!1,S.PreviousVisibility=!1,S.NextVisibility=!1);var P=w.ScreenObject.Link.DocumentList.Items.find(W=>W.Value==this.dgvLoanBal.Table[C.row].dgColLoanBalDocNo_Tag.toString());P&&(P.IsChecked=!0,w.OnLinkDocumentCheckedChanged(P)),(S=w.ScreenObject._CCFields.find(W=>"dcCCNID51"==W.DBColumnName))&&(S.Enable=!1),(S=w.ScreenObject._TextFields.find(W=>"dcAlpha6"==W.DBColumnName))instanceof Me.Dw&&(S.Text="FFS_LoanBalances");for(let W=0;W<w.ScreenObject.GridData.length;W++)L.J0.IsEmpty(w.ScreenObject.GridData[W].ProductID_Key)||(w.ScreenObject.GridData[W].dcAlpha5=this.dtpDocDate.Date.ToString(I.d.SessionManager.Preferences["Date Format"]),w.ScreenObject.GridData[W].dcAlpha5_Key=this.dtpDocDate.Date.toString());I.d.page.ShowDialog(w,gt.AddEditDocumentComponent),w.DialogResult&&(this.txtLoanBalAmount.Text=(parseFloat(this.txtLoanBalAmount.Text)+w.dFS_LoanAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[C.row].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[C.row].dgColLoanBalSNo_Tag=w.RetValue,this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[C.row])),this.CalculateTotalAmount()}}}NumberValidationTextBox(C,T){}GetResource(C,T){let S=C;return null!=this.ViewModel.dsRes1&&this.ViewModel.dsRes1.Tables.length>0&&this.ViewModel.dsRes1.Tables[0].length>0&&(this.drwRes=this.ViewModel.dsRes1.Tables[0].filter(P=>P.CCID==T&&P.Code=="'"+C+"'")),null!=this.drwRes&&this.drwRes.length>0?this.drwRes[0].AliasName.toString():S}cmbSettlementType_SelectionChanged(C,T){this.txtPartialGratuityAmount.IsReadOnly="Partial"!=this.cmbSettlementType.SelectedValue}AggregateLeaves(C,T,S,P,E,w,$){let B,se,Ie,X=0,W=0,R=0,z=I.d.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),he=" 1=1 ",le="";if(Ie=T.Tables[2],null!=z&&null!=z&&z.length>0)for(let ye=0;ye<z.length;ye++)L.J0.IsEmpty(z[ye])||(le="CCNID"+(parseInt(z[ye])-5e4),B=E.Tables[0].filter(Ee=>Ee.EmpSeqNo==C),null!=B&&B.length>0&&(le.Contains("CCNID51")?(he+=" AND ( "+le+"="+B[0].EmpSeqNo+" OR "+le+"= 1)",Ie=Ie.filter(Ee=>Ee[le]==B[0].EmpSeqNo||1==Ee[le])):(he+=" AND ( "+le+"="+B[0][le]+" OR "+le+"= 1)",Ie=Ie.filter(Ee=>Ee[le]==B[0][le]||1==Ee[le]))));" 1=1 "!=he&&(this.drcWOffAdjDef=Ie);let Be,Ge,_e,we=T.Tables[3];if(z=I.d.SessionManager.Preferences.HolidaysBasedOn.split(","),he=" 1=1 ",le="",null!=z&&null!=z&&z.length>0)for(let ye=0;ye<z.length;ye++)L.J0.IsEmpty(z[ye])||(le="CCNID"+(parseInt(z[ye])-5e4),B=E.Tables[0].filter(Ee=>Ee.EmpSeqNo==C),null!=B&&B.length>0&&(le.Contains("CCNID51")?(he+=" AND ( "+le+"="+B[0].EmpSeqNo+" OR "+le+"= 1)",we=we.filter(Ee=>Ee[le]==B[0].EmpSeqNo||1==Ee[le])):(he+=" AND ( "+le+"="+B[0][le]+" OR "+le+"= 1)",we=we.filter(Ee=>Ee[le]==B[0][le]||1==Ee[le]))));if(" 1=1 "!=he&&(se=we),null!=se&&se.length>0&&(this.dtHolidayAdjDef=se),_e=T.Tables[0].filter(ye=>ye.EmpSeqNo==C),!L.J0.IsEmpty(_e)&&null!=_e&&_e.length>0)for(let ye=0;ye<_e.length;ye++){Be=L.J0.ParseDate(_e[ye].FromDate),Ge=L.J0.ParseDate(_e[ye].ToDate),R=parseInt(_e[ye].ComponentID);let Ee=I.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),ot=null;Ee.length>0&&(ot=Ee.split(",")),Be>=S?Ge<=P?(W=parseFloat(_e[ye].NoOfDays),X+=W):Be<=P&&(W=this.GetNoOfDays(Be,P,R,T,w,$),X+=W):Ge<=P?Ge>=S&&(W=this.GetNoOfDays(S,Ge,R,T,w,$),X+=W):(W=this.GetNoOfDays(S,P,R,T,w,$),X+=W)}return X}GetNoOfDays(C,T,S,P,E,w){let $=0,X=0,W=0,U=null,R=P.Tables[1].filter(B=>B.GradeID==w&&4==B.Type&&B.ComponentID==S);if(null!=R&&R.length>0){let B=C,se=R[0].IncludeRExclude.toString();if($=L.J0.GetDateDifference(T,C)+1,"IncludeBoth"==se||""==se)return $;if("IncludeWeeklyOffs"==se)for(;B<=T;)L.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(z=>z.HolidayDate==B.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&W++,B=B.AddDays(1);else if("IncludeHolidays"==se)for(;B<=T;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(B,P,C,T,E)&&X++:("NONE"!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff1.toString()&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&X++,"NONE"!=E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff2.toString()&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&X++),B=B.AddDays(1);else if("ExcludeBoth"==se)for(;B<=T;){let z=!1;L.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(he=>he.HolidayDate==B.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&(W++,z=!0),null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(B,P,C,T,E)&&!z&&X++:("NONE"!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff1.toString()&&!z&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&!z&&X++,"NONE"!=E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff2.toString()&&!z&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&!z&&X++),B=B.AddDays(1)}else if("ExcludeWeeklyOffs"==se)for(;B<=T;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(B,P,C,T,E)&&X++:("NONE"!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff1.toString()&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&X++,"NONE"!=E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?E.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=E.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&B.getDay().toString()==E.drcAllEmpsData[0].WeeklyOff2.toString()&&X++:B.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&X++),B=B.AddDays(1);else if("ExcludeHolidays"==se)for(;B<=T;)L.J0.IsEmpty(this.dtHolidayAdjDef)||(U=this.dtHolidayAdjDef.filter(z=>z.HolidayDate==B.ToString("dd/MMM/yyyy"))),null!=U&&U.length>0&&W++,B=B.AddDays(1)}return $-(X+W)}CheckIsWeeklyOffFromDef(C,T,S,P,E){if(null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0){let U,w=1,X=E.DateOfRelieve<P?E.DateOfRelieve:P,W=E.DateOfJoining>S?E.DateOfJoining:S;for(;W<=X;){for(U=W.AddDays(6);W<=U&&W<=X;){if(T.Columns[2].Contains("Week"+w.toString()+"_W1")&&!L.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString())&&W.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString().toLowerCase()){if(W.ToString("dd MMM yyyy")==C.ToString("dd MMM yyyy"))return!0}else if(T.Columns[2].Contains("Week"+w.toString()+"_W2")&&!L.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString())&&W.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString().toLowerCase()&&W.ToString("dd MMM yyyy")==C.ToString("dd MMM yyyy"))return!0;W=W.AddDays(1)}w++}}return!1}static#e=this.\u0275fac=function(T){return new(T||Y)};static#t=this.\u0275cmp=n.VBU({type:Y,selectors:[["app-final-settlement"]],decls:300,vars:93,consts:[["acoordionHeader",""],["btnCollapseheader",""],["TabHeaderField",""],["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnpill"],[1,"btnMetroDiv","secondary-btn-group"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"document-screen","main_div"],[1,"section"],["panelClass","row form-row",3,"isOpen"],["accordion-heading","",1,"collapse_tabfields"],[1,"btn","btn-link"],[1,"fa","pull-right","btn-tab-icon",2,"line-height","36px","color","white","position","relative","left","-10px","float","right","background","none","border","none"],[1,"PACTHeaderFields"],[2,"display","flex","width","100%"],["class","form-group col-xl-3  col-md-3 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl"],[2,"margin-top","auto"],[1,"PACTTabFields","section","tab_content","tab-exrafields","custom_accordion",2,"display","flex"],[1,"master-tab-container",2,"width","100%"],[3,"selectTab","heading","removable"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"height","250px","border","1px solid #ccc","overflow","scroll"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","flex-direction","row","padding","0px 30px 8px 0px !important","width","100%"],[2,"font-weight","bold"],[1,"form-row","row"],[1,"form-group","col-3"],[3,"heading","removable","selectTab",4,"ngIf"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fas","fa-print"],[1,"fa-light","fa-print"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-paperclip"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-file-chart-line"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","/* flex-direction","row","*/padding","0px 0px 0px 0px !important","width","100%"],["FieldDirective","",2,"width","100%",3,"obj","group"],[2,"display","flex"],[1,"input_cntrl_label",2,"flex-direction","column"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-left","auto","margin-bottom","2px"],[1,"secondary-btn","prevnextbtn",3,"click"],[1,"far","fa-angle-left"],[1,"far","fa-angle-right"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(T,S){if(1&T){const P=n.RV6();n.j41(0,"div",3),n.EFF(1,"\n  "),n.j41(2,"div",4),n.EFF(3,"\n    "),n.j41(4,"div",5),n.EFF(5,"\n      "),n.j41(6,"span",6),n.EFF(7),n.j41(8,"span",7),n.EFF(9),n.k0s(),n.EFF(10,"\n      "),n.k0s(),n.EFF(11,"\n    "),n.k0s(),n.EFF(12,"\n    "),n.j41(13,"div",8),n.EFF(14,"\n      "),n.EFF(15,"\n      "),n.DNE(16,$t,4,3,"span",9),n.EFF(17,"\n      "),n.DNE(18,pt,4,3,"span",9),n.EFF(19,"\n      "),n.DNE(20,St,4,3,"span",9),n.EFF(21,"\n      "),n.DNE(22,ut,4,3,"span",9),n.EFF(23,"\n      "),n.DNE(24,Je,4,3,"span",9),n.EFF(25,"\n      "),n.DNE(26,Nt,4,3,"span",9),n.EFF(27,"\n      "),n.DNE(28,Dt,4,3,"span",9),n.EFF(29,"\n      "),n.DNE(30,Tt,4,3,"span",9),n.EFF(31,"\n      "),n.j41(32,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(S.obj.Button_Click("Clear"))}),n.nrm(33,"i",11),n.EFF(34),n.nI1(35,"translate"),n.k0s(),n.EFF(36,"\n      "),n.DNE(37,mt,4,3,"span",9),n.EFF(38,"\n          "),n.DNE(39,Qt,4,3,"span",9),n.EFF(40,"           \n    "),n.k0s(),n.EFF(41,"\n  "),n.k0s(),n.EFF(42,"\n  "),n.j41(43,"div",12),n.EFF(44,"\n    "),n.j41(45,"accordion",13,0),n.EFF(47,"\n      "),n.j41(48,"accordion-group",14),n.EFF(49,"\n        "),n.j41(50,"div",15),n.EFF(51,"\n          "),n.j41(52,"span",16),n.EFF(53," Primary Information"),n.k0s(),n.EFF(54,"\n          "),n.nrm(55,"span",17,1),n.EFF(57,"\n        "),n.k0s(),n.EFF(58,"\n        "),n.j41(59,"div"),n.EFF(60,"\n          "),n.j41(61,"div",18),n.EFF(62,"\n            "),n.j41(63,"div",19),n.EFF(64,"\n              "),n.DNE(65,qt,25,3,"div",20),n.EFF(66,"\n              "),n.DNE(67,zt,4,2,"div",20),n.EFF(68,"\n            "),n.k0s(),n.EFF(69,"\n            "),n.j41(70,"div",19),n.EFF(71,"\n              "),n.DNE(72,Zt,4,2,"div",21),n.EFF(73,"\n              "),n.DNE(74,Mt,4,2,"div",20),n.EFF(75,"\n            "),n.k0s(),n.EFF(76,"\n            "),n.j41(77,"div",19),n.EFF(78,"\n              "),n.DNE(79,ea,4,2,"div",20),n.EFF(80,"\n              "),n.DNE(81,ta,4,2,"div",20),n.EFF(82,"\n              "),n.j41(83,"div",22),n.EFF(84,"\n                "),n.j41(85,"label",23),n.EFF(86),n.k0s(),n.EFF(87,"\n              "),n.k0s(),n.EFF(88,"\n            "),n.k0s(),n.EFF(89,"\n            "),n.j41(90,"div",19),n.EFF(91,"\n              "),n.DNE(92,Rt,4,2,"div",21),n.EFF(93,"\n              "),n.DNE(94,Lt,4,2,"div",20),n.EFF(95,"\n            "),n.k0s(),n.EFF(96,"\n          "),n.k0s(),n.EFF(97,"\n        "),n.k0s(),n.EFF(98,"\n      "),n.k0s(),n.EFF(99,"\n    "),n.k0s(),n.EFF(100,"\n\n    "),n.j41(101,"div",24,2),n.EFF(103,"\n      "),n.j41(104,"tabset",25),n.EFF(105,"\n        "),n.j41(106,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvGratuity"))}),n.EFF(107,"\n          "),n.EFF(108,"\n            "),n.j41(109,"div",27),n.EFF(110,"\n            "),n.DNE(111,aa,5,2,"div",28),n.EFF(112,"\n            \n            "),n.j41(113,"div",29),n.EFF(114,"\n              "),n.EFF(115," \n              "),n.DNE(116,sa,4,2,"div",30),n.EFF(117,"\n              "),n.DNE(118,yt,4,2,"div",30),n.EFF(119,"\n              "),n.j41(120,"div",31),n.EFF(121,"\n                "),n.eu8(122,32),n.EFF(123,"\n              "),n.k0s(),n.EFF(124,"\n              "),n.j41(125,"div",31),n.EFF(126,"\n                "),n.eu8(127,32),n.EFF(128,"\n              "),n.k0s(),n.EFF(129,"\n              "),n.j41(130,"div",31),n.EFF(131,"\n                "),n.eu8(132,32),n.EFF(133,"\n              "),n.k0s(),n.EFF(134,"\n              "),n.j41(135,"div",31),n.EFF(136,"\n                "),n.j41(137,"button",33),n.bIt("click",function(){return n.eBV(P),n.Njj(S.obj.Button_Click("Gratuity"))}),n.EFF(138),n.k0s(),n.EFF(139,"\n              "),n.k0s(),n.EFF(140,"\n              "),n.j41(141,"div",34),n.EFF(142,"\n                "),n.j41(143,"label"),n.EFF(144),n.k0s(),n.j41(145,"label",35),n.EFF(146),n.k0s(),n.EFF(147,"\n              "),n.k0s(),n.EFF(148,"\n              "),n.j41(149,"div",34),n.EFF(150,"\n                "),n.j41(151,"label"),n.EFF(152),n.k0s(),n.j41(153,"label",35),n.EFF(154),n.k0s(),n.EFF(155," "),n.j41(156,"label"),n.EFF(157),n.k0s(),n.j41(158,"label",35),n.EFF(159),n.k0s(),n.EFF(160," "),n.j41(161,"label"),n.EFF(162),n.k0s(),n.j41(163,"label",35),n.EFF(164),n.k0s(),n.EFF(165,"\n              "),n.k0s(),n.EFF(166,"\n              "),n.j41(167,"div",34),n.EFF(168,"\n                "),n.j41(169,"label"),n.EFF(170),n.k0s(),n.j41(171,"label",35),n.EFF(172),n.k0s(),n.EFF(173,"\n              "),n.k0s(),n.EFF(174,"\n              "),n.j41(175,"div",34),n.EFF(176,"\n                "),n.j41(177,"label"),n.EFF(178),n.k0s(),n.j41(179,"label",35),n.EFF(180),n.k0s(),n.EFF(181,"\n              "),n.k0s(),n.EFF(182,"\n              "),n.DNE(183,nt,4,2,"div",30),n.EFF(184,"\n              "),n.DNE(185,vt,4,2,"div",30),n.EFF(186,"\n              "),n.DNE(187,Ot,4,2,"div",30),n.EFF(188,"\n            "),n.k0s(),n.EFF(189,"\n          "),n.k0s(),n.EFF(190,"\n        "),n.k0s(),n.EFF(191,"\n        "),n.j41(192,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvLeaveEncash"))}),n.EFF(193,"\n          "),n.j41(194,"div",36),n.EFF(195,"\n            "),n.DNE(196,Vt,4,2,"div",28),n.EFF(197,"\n            "),n.j41(198,"div",37),n.EFF(199,"\n              "),n.DNE(200,la,4,2,"div",30),n.EFF(201,"\n              "),n.j41(202,"div",31),n.EFF(203,"\n                "),n.eu8(204,32),n.EFF(205,"\n              "),n.k0s(),n.EFF(206,"\n              "),n.j41(207,"div",31),n.EFF(208,"\n                "),n.eu8(209,32),n.EFF(210,"\n              "),n.k0s(),n.EFF(211,"\n              "),n.j41(212,"div",31),n.EFF(213,"\n                "),n.j41(214,"button",33),n.bIt("click",function(){return n.eBV(P),n.Njj(S.obj.Button_Click("LeaveEncash"))}),n.EFF(215),n.k0s(),n.EFF(216,"\n              "),n.k0s(),n.EFF(217,"\n              "),n.DNE(218,ia,4,2,"div",30),n.EFF(219,"\n            "),n.k0s(),n.EFF(220,"\n          "),n.k0s(),n.EFF(221,"\n        "),n.k0s(),n.EFF(222,"\n        "),n.DNE(223,wt,17,6,"tab",38),n.EFF(224,"\n        "),n.j41(225,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvNoticePay"))}),n.EFF(226,"\n          "),n.j41(227,"div",36),n.EFF(228,"\n            "),n.DNE(229,Et,4,2,"div",28),n.EFF(230,"\n            "),n.j41(231,"div",37),n.EFF(232,"\n              "),n.j41(233,"div",31),n.EFF(234,"\n                "),n.eu8(235,32),n.EFF(236,"\n              "),n.k0s(),n.EFF(237,"\n              "),n.DNE(238,Gt,4,2,"div",30),n.EFF(239,"\n            "),n.k0s(),n.EFF(240,"\n          "),n.k0s(),n.EFF(241,"\n        "),n.k0s(),n.EFF(242,"\n        "),n.j41(243,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvOthAdd"))}),n.EFF(244,"\n          "),n.j41(245,"div",36),n.EFF(246,"\n            "),n.DNE(247,xe,4,2,"div",28),n.EFF(248,"\n            "),n.j41(249,"div",37),n.EFF(250,"\n              "),n.j41(251,"div",31),n.EFF(252,"\n                "),n.eu8(253,32),n.EFF(254,"\n              "),n.k0s(),n.EFF(255,"\n              "),n.DNE(256,ct,4,2,"div",30),n.EFF(257,"\n            "),n.k0s(),n.EFF(258,"\n          "),n.k0s(),n.EFF(259,"\n        "),n.k0s(),n.EFF(260,"\n        "),n.j41(261,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvOthDed"))}),n.EFF(262,"\n          "),n.j41(263,"div",36),n.EFF(264,"\n            "),n.DNE(265,oa,4,2,"div",28),n.EFF(266,"\n            "),n.j41(267,"div",37),n.EFF(268,"\n              "),n.j41(269,"div",31),n.EFF(270,"\n                "),n.eu8(271,32),n.EFF(272,"\n              "),n.k0s(),n.EFF(273,"\n              "),n.DNE(274,ra,4,2,"div",30),n.EFF(275,"\n            "),n.k0s(),n.EFF(276,"\n          "),n.k0s(),n.EFF(277,"\n        "),n.k0s(),n.EFF(278,"\n        "),n.j41(279,"tab",26),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(S.onSelectTab("dgvLoanBal"))}),n.EFF(280,"\n          "),n.j41(281,"div",36),n.EFF(282,"\n            "),n.DNE(283,_t,4,2,"div",28),n.EFF(284,"\n            "),n.j41(285,"div",37),n.EFF(286,"\n              "),n.j41(287,"div",31),n.EFF(288,"\n                "),n.eu8(289,32),n.EFF(290,"\n              "),n.k0s(),n.EFF(291,"\n              "),n.DNE(292,kt,4,2,"div",30),n.EFF(293,"\n            "),n.k0s(),n.EFF(294,"\n          "),n.k0s(),n.EFF(295,"\n        "),n.k0s(),n.EFF(296,"\n      "),n.k0s(),n.EFF(297,"\n\n    "),n.k0s(),n.EFF(298,"\n\n  "),n.k0s(),n.EFF(299,"\n"),n.k0s()}2&T&&(n.R7$(7),n.SpI("\n        ",S.obj.Title," "),n.R7$(),n.xc7("background-color",S.obj.StatusColor),n.R7$(),n.JRh(S.obj.DocStatus),n.R7$(7),n.Y8G("ngIf",S.ViewModel.ApproveVisibility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.PostVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.SavePrintVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.PrintVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.PreviewVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.ExportVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.AttachVisiblility),n.R7$(2),n.Y8G("ngIf",S.ViewModel.EMailVisiblility),n.R7$(4),n.JRh(n.bMT(35,91,"Clear")),n.R7$(3),n.Y8G("ngIf",S.obj.UnPostVisiblility),n.R7$(2),n.Y8G("ngIf",S.obj.ReportInfoVisibility),n.R7$(9),n.Y8G("isOpen",S.IsAccordionOpen),n.R7$(7),n.AVh("fa-chevron-down",S.IsAccordionOpen)("fa-chevron-up",!S.IsAccordionOpen),n.R7$(10),n.Y8G("ngIf",S.obj.txtDocNo.Visible),n.R7$(2),n.Y8G("ngIf",S.obj.dtpDocDate.Visible),n.R7$(5),n.Y8G("ngIf",S.obj.EmployeeList.Visible),n.R7$(2),n.Y8G("ngIf",S.obj.cmbSettlementType.Visible),n.R7$(5),n.Y8G("ngIf",S.obj.dtpDateOfJoining.Visible),n.R7$(2),n.Y8G("ngIf",S.obj.dtpDateOfRelieving.Visible),n.R7$(5),n.JRh(S.lblActRelievingDate),n.R7$(6),n.Y8G("ngIf",S.obj.txtRemarks.Visible),n.R7$(2),n.Y8G("ngIf",S.obj.txtNetAmount.Visible),n.R7$(12),n.FS9("heading",S.tpGratuity),n.Y8G("removable",!1),n.R7$(5),n.Y8G("ngIf",S.dgvGratuity.Visible),n.R7$(5),n.Y8G("ngIf",S.cmbResignType.Visible),n.R7$(2),n.Y8G("ngIf",S.cmbResignReason.Visible),n.R7$(4),n.Y8G("obj",S.chkCalcBasedOnLastSal)("group",S.form),n.R7$(5),n.Y8G("obj",S.chkCalcBasedOnActDays)("group",S.form),n.R7$(5),n.Y8G("obj",S.GratuityRemarks)("group",S.form),n.R7$(6),n.JRh(S.btnCalcGratuity),n.R7$(6),n.JRh(S.lbl1GratuityTotalDays),n.R7$(2),n.JRh(S.lblGratuityTotalDays),n.R7$(6),n.JRh(S.lbl1GratuityServiceDays),n.R7$(2),n.JRh(S.lblGratuityServiceDays),n.R7$(3),n.JRh(S.lbl1GratuityLOPDays),n.R7$(2),n.JRh(S.lblGratuityLOPDays),n.R7$(3),n.JRh(S.lbl1GratuityBalDays),n.R7$(2),n.JRh(S.lblGratuityBalDays),n.R7$(6),n.JRh(S.lbl1GratuityTotalGrDays),n.R7$(2),n.JRh(S.lblGratuityTotalGrDays),n.R7$(6),n.JRh(S.lbl1GratuityTaken),n.R7$(2),n.JRh(S.lblGratuityTaken),n.R7$(3),n.Y8G("ngIf",S.txtGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",S.txtAvailedGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",S.txtPartialGratuityAmount.Visible),n.R7$(5),n.FS9("heading",S.tpLeaveEncashment),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",S.dgvLeaveEncash.Visible),n.R7$(4),n.Y8G("ngIf",S.txtCumLeaveSalBalAmt.Visible),n.R7$(4),n.Y8G("obj",S.chkLECalcBasedOnLastApprSerYearWise)("group",S.form),n.R7$(5),n.Y8G("obj",S.LeaveRemarks)("group",S.form),n.R7$(6),n.JRh(S.btnCalcLE),n.R7$(3),n.Y8G("ngIf",S.txtLEAmount.Visible),n.R7$(5),n.Y8G("ngIf",S.ViewModel.UnProcessedVisible),n.R7$(2),n.FS9("heading",S.tpNoticePay),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",S.dgvNoticePay.Visible),n.R7$(6),n.Y8G("obj",S.NoticePayRemarks)("group",S.form),n.R7$(3),n.Y8G("ngIf",S.txtNPAmount.Visible),n.R7$(5),n.FS9("heading",S.tpOtherAdditions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",S.dgvOthAdd.Visible),n.R7$(6),n.Y8G("obj",S.OAddRemarks)("group",S.form),n.R7$(3),n.Y8G("ngIf",S.txtOthAddAmount.Visible),n.R7$(5),n.FS9("heading",S.tpOtherDeductions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",S.dgvOthDed.Visible),n.R7$(6),n.Y8G("obj",S.ODedRemarks)("group",S.form),n.R7$(3),n.Y8G("ngIf",S.txtOthDedAmount.Visible),n.R7$(5),n.FS9("heading",S.tpLoanBalances),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",S.dgvLoanBal.Visible),n.R7$(6),n.Y8G("obj",S.LoanRemarks)("group",S.form),n.R7$(3),n.Y8G("ngIf",S.txtLoanBalAmount.Visible))},dependencies:[$e.bT,Ct._,et.Mj,et.kt,tt.X,It.V6,It.fw,Kt.D9],encapsulation:2})}return Y})();class ha{constructor(){this.Days=0}}},5661:(Xt,at,G)=>{G.d(at,{N:()=>Xe});var ne=G(86739),I=G(8787),Me=G(23823),d=G(24028),Oe=G(92701),qe=G(72743),lt=G(35275),L=G(7023),s=G(26531),fe=G(29788),Ye=G(81669),ze=G(61994);class Xe extends Me.g{constructor(Ae){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.dtpPayrollMonth=new d.Lc(0),this.cmbPayslipLayout=new Oe.y$(0),this.cmbSortOn=new Oe.y$(0),this.PrintCallBack=new Ye.Yk,this.dtPrintLayouts=null,this.sFilter="",this.drSelectedPrintLayout=null,this.sDocIDs="",this.IsPDFExport=!1,this.iCostCenterID=40054,this.ExportSeperate=!1;try{if(this.DisplayName=ne.d.GetResource(Ae),this.Title=ne.d.GetResource(Ae),this.DisplayMessage="",this.dtpPayrollMonth.CustomFormat="MMM/yyyy",this.dtpPayrollMonth.Date=ne.d.SessionManager.PayrollMonth,this.dtPrintLayouts=ne.d.common.GetDataTable("PAY064",this.iCostCenterID.toString()+"~"+ne.d.SessionManager.RoleID+"~"+ne.d.SessionManager.UserID+"~"+ne.d.SessionManager.LocationID),null!=this.dtPrintLayouts&&this.dtPrintLayouts.length>0){let Z="-1";for(let Ce=0;Ce<this.dtPrintLayouts.length;Ce++)this.cmbPayslipLayout.Items.push(Oe._p.ComboBoxItems_2(this.dtPrintLayouts[Ce].Name.toString(),this.dtPrintLayouts[Ce].DocPrintLayoutID.toString())),"true"==this.dtPrintLayouts[Ce].IsDefault.toString().toLowerCase()&&(Z=this.dtPrintLayouts[Ce].DocPrintLayoutID.toString());this.cmbPayslipLayout.SelectedValue=Z,"-1"==Z&&!I.J0.IsEmpty(this.dtPrintLayouts[0].DocPrintLayoutID)&&(Z=this.dtPrintLayouts[0].DocPrintLayoutID.toString(),this.cmbPayslipLayout.SelectedValue=Z)}if(this.cmbSortOn.Items.Clear(),this.cmbSortOn.Items.push(Oe._p.ComboBoxItems_2("EmpCode","1")),this.cmbSortOn.Items.push(Oe._p.ComboBoxItems_2("EmpName","2")),this.cmbSortOn.Items.push(Oe._p.ComboBoxItems_2("TreeView","3")),this.cmbSortOn.SelectedValue="1",this.dtpPayrollMonth.Label=ne.d.GetResource("Payroll_Month"),this.cmbPayslipLayout.Label=ne.d.GetResource("PayslipLayout"),this.cmbSortOn.Label=ne.d.GetResource("SortOn"),ne.d.SessionManager.IsEmpUser&&!ne.d.SessionManager.IsRptManagerUser){let Z="";I.J0.IsEmpty(ne.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(Z="  AND EmpSeqNo IN ("+ne.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let Ce=[];Ce.push(ne.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),Ce.push(Z),Ce.push(1),Ce.push(ne.d.SessionManager.RoleID),Ce.push(ne.d.SessionManager.UserID),Ce.push(ne.d.SessionManager.LanguageID),this.dsEmps=ne.d.empService.GetData(Ce,"spPAY_GetEmpMasterCCDetails")}else this.btnFilter_Click();this.PrintCallBack.Subscribe(this,"PrintVoucher")}catch(Z){Logger.ErrorLog("PayslipViewModel::EXCEPTION PayslipViewModel()",Z)}}Button_Click(Ae){this.IsPDFExport=!1,"Preview"==Ae.toString()?this.btnPreview_Click(0):"Print"==Ae.toString()?this.btnPreview_Click(1):"Export"==Ae.toString()?(this.IsPDFExport=!0,this.btnPreview_Click(3)):"EMail"==Ae.toString()?this.btnPreview_Click(2):"Filter"==Ae.toString()&&this.btnFilter_Click(),Logger.InfoLog("PayslipViewModel::Exiting Button_Click()")}btnPreview_Click(Ae){if(null!=this.dsEmps&&0!=this.dsEmps.Tables.length)try{let Z=this.dsEmps.Tables[0],Ce=0,Ve=0;if(null!=Z&&Z.length>0){let Te="",Ze="";for(let m=0;m<Z.length;m++)Te+=Z[m].EmpSeqNo.toString()+",",Ve++;if(Te.length>0&&Ve>0){Te=Te.substr(0,Te.length-1),Ze="TreeView"==this.cmbSortOn.GetselectedItem().Name?" ORDER BY e.lft":" ORDER BY e."+this.cmbSortOn.GetselectedItem().Name.Replace("Emp","");let m=ne.d.common.GetDataSet3("PAY065",this.iCostCenterID.toString(),this.dtpPayrollMonth.Date.ToString("01/MMM/yyyy"),Te+"~"+Ze);if(null!=m&&m.Tables[0].length>0&&I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)>0){Ce=m.Tables[0].length,this.sDocIDs="";let ae=this.dtPrintLayouts.filter(Q=>Q.DocPrintLayoutID==this.cmbPayslipLayout.SelectedValue);for(let Q=0;Q<m.Tables[0].length;Q++)this.sDocIDs+=m.Tables[0][Q].DocID.toString()+",";if(this.sDocIDs.length>0)if(this.drSelectedPrintLayout=ae[0],this.sDocIDs=this.sDocIDs.substr(0,this.sDocIDs.length-1),0==Ae)this.PrintCallBack.Call(!0);else if(1==Ae)this.PrintCallBack.Call(!1);else if(3==Ae)if(this.ExportSeperate)for(let Q=0;Q<m.Tables[0].length;Q++)this.sDocIDs=m.Tables[0][Q].DocID.toString(),this.PrintCallBack.Call(!1);else this.PrintCallBack.Call(!1);else 2==Ae&&this.SendPaySlipsToEMail()}else 0==m.Tables[0].length?this.DisplayMessage="Payroll Not Processed For Selected Employees On This Payroll Month":-1==I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)&&(this.DisplayMessage="Please select Payslip Layout")}}else this.DisplayMessage="No Employees found to generate preview.";Logger.InfoLog("PayslipViewModel::Exiting btnPreview_Click()")}catch(Z){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnPreview_Click()"+Z.stack)}else this.DisplayMessage="First filter the Employees, then Preview"}SendPaySlipsToEMail(){try{Logger.InfoLog("PayslipViewModel::Entering SendPaySlipsToEMail()"),null!=this.sDocIDs&&this.sDocIDs.length>0?ne.d.page.ShowDialog(new s.SendEmailSMSViewModel(!0,this.iCostCenterID,0,this),fe.SendEmailSMSComponent):this.DisplayMessage="No Employees found to Send Email.",Logger.InfoLog("PayslipViewModel::Exiting SendPaySlipsToEMail()")}catch(Ae){Logger.ErrorLog("PayslipViewModel::EXCEPTION SendPaySlipsToEMail()"+Ae.stack)}}btnFilter_Click(){try{this.sFilter="",ne.d.SessionManager.Preferences.ContainsKey("PayslipFilter")&&parseInt(ne.d.SessionManager.Preferences.PayslipFilter)>0&&"Widget"!=this.DisplayName?null==this.objEmpFilter?this.objEmpFilter=new qe.t("",0,4):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=4,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new qe.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?ne.d.page.ShowDialog(this.objEmpFilter,ze.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}catch(Ae){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnFilter_Click()",Ae)}}btnFilter_Click_CallBack(){if(this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let Z=1,Ce="",Ve="",Te="";for(let Ze=0;Ze<this.objEmpFilter.CostCenterFilters.length;Ze++){let m=this.objEmpFilter.CostCenterFilters[Ze];if(m.CostCenterID>5e4&&(Z=2,Ce="NodeID",Ve=50051==m.CostCenterID?"EmpSeqNo":"CCNID"+(m.CostCenterID-5e4)),m.SelectedNodes.length>0){if(1==m.SelectedNodes.length)Te+=" AND ",Te+=Ve+"="+m.SelectedNodes[0].Id;else if(!m.SelectedNodes.find(ae=>ae.Id==Z&&ae.IsGroup))if(Te+=" AND ",lt.IPrefetchFilter.IsGroupTree(m)){let ae="";for(let Q=0;Q<m.SelectedNodes.length;Q++)(null==m.SelectedNodes[Q].Parent||!m.SelectedNodes[Q].Parent.IsSelected)&&(ae.length>0&&(ae+=","),ae+=m.SelectedNodes[Q].Id);0==ae.length&&(ae+=-12912),Te+=Ve+" IN ",Te+=" (select T."+Ce+" GTID from "+L.A.GetTagTableName(m.CostCenterID)+" T with(nolock),",L.A.GetTagTableName(m.CostCenterID),Te+=ae.toString()+")  group by T."+Ce+")"}else{Te+=Ve+" IN (";for(let ae=0;ae<m.SelectedNodes.length;ae++)ae>0&&(Te+=","),Te+=m.SelectedNodes[ae].Id;Te+=")"}}else m.DeleteButtonVisibility||(Te+=" AND ",Te+=Ve+"=-12912")}this.sFilter=Te.toString()}if(this.objEmpFilter.Filter>0){ne.d.SessionManager.LocationID>0&&ne.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&ne.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+ne.d.SessionManager.LocationID+")"),I.J0.IsEmpty(ne.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+ne.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),4==this.objEmpFilter.Filter&&"All"!=this.objEmpFilter.PaymentModes.SelectedValue&&(this.sFilter+=" AND EMP.PaymentMode ='"+this.objEmpFilter.PaymentModes.SelectedValue+"' ");let Z=[];Z.push(ne.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),Z.push(this.sFilter),Z.push(1),Z.push(ne.d.SessionManager.RoleID),Z.push(ne.d.SessionManager.UserID),Z.push(ne.d.SessionManager.LanguageID),this.dsEmps=ne.d.empService.GetData(Z,"spPAY_GetEmpMasterCCDetails")}}}PrintVoucher(Ae){let Ce=this;if(Ce.DisplayMessage="",!I.J0.IsEmpty(Ce.sDocIDs)){let Ve=null;Ve=Ce.drSelectedPrintLayout,null!=Ve&&ne.d.report.VoucherExport_PDF(40054,Ce.IsPDFExport,Ce.sDocIDs,"",Ce.IsPDFExport,I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)).subscribe(Te=>{console.log(Te),Ce.IsPDFExport?Ae?ne.d.SessionManager.printTab(Te.FileName):ne.d.SessionManager.Download(Te.FileName,"payslip"):setTimeout(()=>{ne.d.SessionManager.printTab(Te.FileName)},500),I.J0.IsEmpty(Te.Message)&&!I.J0.IsEmpty(Te.FileName)&&(this.DisplayMessage="Exported Successfully")},Te=>{console.log(Te)})}return""}}},70946:(Xt,at,G)=>{G.r(at),G.d(at,{RibbonExtPay:()=>Re});var ne=G(10467),I=G(62846),Me=G(15091),d=G(86739),Oe=G(72974),qe=G(75782),lt=G(50334),L=G(89417),s=G(54438),fe=G(60177),Ye=G(60440),ze=G(95021),Xe=G(73955);const gt=()=>({standalone:!0});function Ae(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Process"))}),s.nrm(1,"i",22),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Process")))}function Z(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",23),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function Ce(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",24),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function Ve(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Export"))}),s.nrm(1,"i",25),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function Te(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",26),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let Ze=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-consolidated-monthly-payroll"]],decls:89,vars:32,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"page-Subtitle",3,"dblclick"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-search"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"row",2,"height","30px"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"padding-left","inherit"],["FieldDirective","",3,"obj"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"padding-left","inherit"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-gears"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-file-chart-line"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n          "),s.j41(6,"span",3),s.EFF(7),s.j41(8,"span",4),s.bIt("dblclick",function(r){return i.obj.sPayrollMonth_MouseDoubleClick(r)}),s.EFF(9),s.k0s(),s.EFF(10,"\n          "),s.k0s(),s.EFF(11,"\n        "),s.k0s(),s.EFF(12,"\n\n        "),s.j41(13,"div",5),s.EFF(14,"\n          "),s.DNE(15,Ae,4,3,"span",6),s.EFF(16,"\n          "),s.DNE(17,Z,4,3,"span",6),s.EFF(18,"\n          "),s.j41(19,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(20,"i",8),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n          "),s.DNE(24,Ce,4,3,"span",6),s.EFF(25,"\n          "),s.j41(26,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(27,"i",9),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n          "),s.j41(31,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Load")}),s.nrm(32,"i",10),s.EFF(33),s.nI1(34,"translate"),s.k0s(),s.EFF(35,"\n          "),s.DNE(36,Ve,4,3,"span",6),s.EFF(37,"\n          "),s.DNE(38,Te,4,3,"span",6),s.EFF(39,"           \n        "),s.k0s(),s.EFF(40,"\n      "),s.k0s(),s.EFF(41,"\n    "),s.j41(42,"div",11),s.EFF(43,"\n      "),s.j41(44,"div",12),s.EFF(45,"\n        "),s.j41(46,"div",13),s.EFF(47,"\n          "),s.eu8(48,14),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",15),s.EFF(52,"\n          "),s.eu8(53,14),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n        "),s.j41(56,"div",15),s.EFF(57,"\n          "),s.eu8(58,14),s.EFF(59,"\n        "),s.k0s(),s.EFF(60,"\n      "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",12),s.EFF(63,"\n        "),s.j41(64,"div",16),s.EFF(65,"\n          "),s.j41(66,"input",17),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.IsProcessWithArrears,r)||(i.obj.IsProcessWithArrears=r),r}),s.k0s(),s.EFF(67,"\n          "),s.j41(68,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithArrears=!i.obj.IsProcessWithArrears}),s.EFF(69),s.nI1(70,"translate"),s.k0s(),s.EFF(71,"\n        "),s.k0s(),s.EFF(72,"\n        "),s.j41(73,"div",19),s.EFF(74,"\n          "),s.j41(75,"input",17),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.IsProcessWithAdjustments,r)||(i.obj.IsProcessWithAdjustments=r),r}),s.k0s(),s.EFF(76,"\n          "),s.j41(77,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithAdjustments=!i.obj.IsProcessWithAdjustments}),s.EFF(78),s.nI1(79,"translate"),s.k0s(),s.EFF(80,"\n        "),s.k0s(),s.EFF(81,"\n      "),s.k0s(),s.EFF(82,"\n        \n        "),s.j41(83,"div",20),s.EFF(84,"\n          "),s.nrm(85,"app-PactGridView",21),s.EFF(86,"  \n        "),s.k0s(),s.EFF(87,"\n    "),s.k0s(),s.EFF(88,"\n"),s.k0s()),2&t&&(s.R7$(7),s.SpI("\n            ",i.obj.Title,"\n            "),s.R7$(2),s.SpI("\n              ",i.obj.sPayrollMonth,"\n            "),s.R7$(6),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(22,20,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(29,22,"Filter")),s.R7$(5),s.JRh(s.bMT(34,24,"Load")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(10),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(5),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(8),s.R50("ngModel",i.obj.IsProcessWithArrears),s.Y8G("ngModelOptions",s.lJ4(30,gt)),s.R7$(3),s.JRh(s.bMT(70,26,"ProcesswithArrears")),s.R7$(6),s.R50("ngModel",i.obj.IsProcessWithAdjustments),s.Y8G("ngModelOptions",s.lJ4(31,gt)),s.R7$(3),s.JRh(s.bMT(79,28,"ProcesswithAdjustments")),s.R7$(7),s.Y8G("obj",i.obj.dgvEmployees))},dependencies:[fe.bT,Ye._,L.Zm,L.BC,ze.X,L.vS,Xe.D9],encapsulation:2})}return V})();var m=G(8787),ae=G(95707),Q=G(32647),re=G(49710),je=G(23823),Ke=G(33547),J=G(18569),n=G(92701),$e=G(72743),Ct=G(35275),et=G(7023),tt=G(5464),It=G(62288);class Kt extends je.g{constructor(a){super(),this.DialogResult=!1,this.dtData=null,this.dtDataColumns=null,this.ExcelData=[],this.DisplayMessage="",this.Parent=a[0],this.Parent.Opacity=.3,this.dgv=new re.vv,this.dgv.Columns=new Array,this.dgv.Width="450",this.dgv.Table=[]}Button_Click(a){if("Load"==a.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{let t;this.dtData=[],this.dtDataColumns=[];for(let i=0;i<this.dgv.Columns.length;i++)this.dtDataColumns.push(this.dgv.TableColumns[i]);for(let i=0;i<this.dgv.Table.length;i++){t={};for(let o=0;o<this.dgv.Columns.length;o++)null!=this.dgv.Table[i][o]&&null!=this.dgv.Table[i][o]&&(t[o]=this.dgv.Table[i][o].toString());this.dtData.push(t)}this.dtData=this.dgv.Table}catch{}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,d.d.page.HideDialog(this.PopUpGUID)}else if("View"==a.toString()){let t;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var l=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(let o=0;o<this.ExcelTableColumns.length;o++)t=new J.O7,t.Header=this.ExcelTableColumns[o],t.DisplayMember=this.ExcelTableColumns[o],t.ID=this.ExcelTableColumns[o],t.Width=100,t.ReadOnly=!0,l.push(t),this.dgv.TableColumns.push(this.ExcelTableColumns[o]);let i;this.dgv.Columns=l;for(let o=1;o<this.ExcelTable.length;o++){i=this.dgv.NewRow();for(let r=0;r<this.ExcelTableColumns.length;r++)i[this.ExcelTableColumns[r]]=this.ExcelTable[o][r];this.dgv.Table.push(i),this.dgv.updateRow(i)}}}else"Browse"==a.toString()||"Cancel"==a.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,d.d.page.HideDialog(this.PopUpGUID));Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}OpenFile(a){if(1!==a.target.files.length)throw new Error("Cannot use multiple files");const l=new FileReader,t=a.target.files[0];this.fileExt=t.name.split(".").pop(),this.fileName=t.name,l.onload=i=>{const h=It.LF(l.result,{type:"binary"});if(this.ExcelData=It.Wp.sheet_to_json(h.Sheets[h.SheetNames[0]],{header:1}),!m.J0.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.ExcelTable=this.ExcelData,this.ExcelTableColumns=this.ExcelData[0],this.ActualFileName=this.fileName}catch(u){return void(this.DisplayMessage=u.Message)}},l.readAsBinaryString(t)}}let $t=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-cons-mpload"]],decls:52,vars:18,consts:[["fileUpload",""],[1,"master-screen",2,"padding-bottom","4px","width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row"],[1,"col-xl-10","col-md-10","col-sm-12","col-xs-12"],["type","text","readonly","",3,"ngModelChange","ngModel"],[1,"col-xl-2","col-md-2","col-sm-12","col-xs-12",2,"margin-top","15px","display","flex !important"],["type","file","accept",".xlsx,.xls,.csv","name","upload",2,"display","none",3,"change"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-search"],[1,"form-group","row","form-row","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(t,i){if(1&t){const o=s.RV6();s.j41(0,"div",1),s.EFF(1,"\n    "),s.j41(2,"div",2),s.EFF(3,"\n        "),s.j41(4,"div",3),s.EFF(5,"\n            "),s.j41(6,"div",4),s.EFF(7,"\n                "),s.j41(8,"label"),s.EFF(9),s.nI1(10,"translate"),s.k0s(),s.EFF(11,"\n                "),s.j41(12,"input",5),s.mxI("ngModelChange",function(h){return s.eBV(o),s.DH7(i.obj.ActualFileName,h)||(i.obj.ActualFileName=h),s.Njj(h)}),s.k0s(),s.EFF(13,"\n            "),s.k0s(),s.EFF(14,"\n            "),s.j41(15,"div",6),s.EFF(16,"\n                "),s.j41(17,"input",7,0),s.bIt("change",function(h){return s.eBV(o),s.Njj(i.obj.OpenFile(h))}),s.k0s(),s.EFF(19,"               \n                "),s.j41(20,"span",8),s.bIt("click",function(){s.eBV(o);const h=s.sdS(18);return s.Njj(h.click())}),s.nrm(21,"i",9),s.EFF(22),s.nI1(23,"translate"),s.k0s(),s.EFF(24,"\n             \n            "),s.k0s(),s.EFF(25,"\n        "),s.k0s(),s.EFF(26,"  \n            \n        "),s.j41(27,"div",10),s.EFF(28,"\n            "),s.eu8(29,11),s.EFF(30,"\n        "),s.k0s(),s.EFF(31,"\n    "),s.k0s(),s.EFF(32,"\n    "),s.j41(33,"div",12),s.EFF(34,"\n        "),s.j41(35,"div"),s.EFF(36,"\n            "),s.j41(37,"button",13),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Load"))}),s.EFF(38),s.nI1(39,"translate"),s.k0s(),s.EFF(40,"\n            "),s.j41(41,"button",8),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("View"))}),s.EFF(42),s.nI1(43,"translate"),s.k0s(),s.EFF(44,"\n            "),s.j41(45,"button",8),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Cancel"))}),s.nrm(46,"i",14),s.EFF(47),s.nI1(48,"translate"),s.k0s(),s.EFF(49,"\n           \n        "),s.k0s(),s.EFF(50,"\n    "),s.k0s(),s.EFF(51,"\n"),s.k0s()}2&t&&(s.R7$(9),s.JRh(s.bMT(10,8,"Com_Attachments_FileName")),s.R7$(3),s.R50("ngModel",i.obj.ActualFileName),s.R7$(10),s.JRh(s.bMT(23,10,"Browse")),s.R7$(7),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(9),s.JRh(s.bMT(39,12,"Load")),s.R7$(4),s.JRh(s.bMT(43,14,"View")),s.R7$(5),s.JRh(s.bMT(48,16,"Cancel")))},dependencies:[Ye._,L.me,L.BC,L.vS,Xe.D9],encapsulation:2})}return V})();var pt=G(61994),St=G(2578),ut=G(38816),Je=G(72099),Nt=G(39032),Dt=G(98669),Tt=G(36466);class mt extends je.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}SerializeGridColumnType(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(let a=0;a<this.dgvEmployees.TableColumns.length;a++);}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.Opacity=1,this.DialogResult=!1,this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this._SelectAll=!1,this.IsProcessWithArrears=!1,this.IsProcessWithAdjustments=!1,this.chkPostBasedOnDailyAttendance=new Je.c,this.chkPostBasedOnAttDimWise=new Je.c,this.chkIncludeOTHours=new Je.c,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.ExportVisiblility=!0,this.GridColumnType=new ae.bT,this.dsDailyAttendanceData=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Tt.v,this.CostCenterID=0,this.sCrAccount="0",this.sDrAccount="0",this.dtRes=null,this.drwRes=null,this.dtCust=null,this.SelectUnCheck=0,this.objCMPLData=null,this.IsProcessed=!1,this.sFilter="",this.iColId=0,this.sBGWorkType="",this.dtArrData=null,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),this.ClassName="ConsolidatedMonthlyPayrollViewModel",this.CostCenterID=40054,this.dtRes=d.d.common.GetDataTable("PAY073",d.d.SessionManager.LangID),this.DisplayName=d.d.GetResource(a.Replace(" ","")),this.Title=d.d.GetResource(a.Replace(" ","")),this.DisplayMessage="",this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ExportVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.chkPostBasedOnDailyAttendance.Label=d.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=d.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=d.d.GetResource("PostbasedonAttendanceDimensionwise"),this.LoadGrid(),this.btnFilter_Click(),d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView()}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",l)}}sPayrollMonth_MouseDoubleClick(a){let l=new Me.SetPayrollDateViewModel;d.d.page.ShowDialog(l,Oe.SetPayrollDateComponent,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")}).subscribe(()=>{l.DialogResult&&this.btnClear_Click()})}dgvEmployees_EndEdit(a,l,t){let i=this.dgvEmployees.Table.indexOf(a);if(this.iEmpIndex=this.lstSelectedEmps.indexOf(i),!(this.iEmpIndex<0)){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);"DaysAttended"==l?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(a[l])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=d.d.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",a.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==l?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(a[l])):l.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(l.Replace("EarningOTHrs","")),a[l].toString()):l.startsWith("Earning")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(l.Replace("Earning","")),a[l].toString()):l.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(l.Replace("DeductionOTHrs","")),a[l].toString()):l.startsWith("Deduction")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(l.Replace("Deduction","")),a[l].toString()):l.startsWith("dcAlpha")?l.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l.Replace("_Key",""),m.J0.ParseDate(a[l]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString()):l.startsWith("dcCCNID")&&(Object.keys(a).Contains(l+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,a[l].toString())),this.dgvEmployees.updateRow(a),this.FillProcessedData(i)}}GetResource(a,l){let t=a;return this.drwRes=this.dtRes.filter(i=>i.CCID==l&&i.Code==a),null!=this.drwRes&&this.drwRes.length>0?1==d.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():t}LoadGrid(){let l,a=new Ke.ControlGenerator;this.dsDocDesig=a.GetScreenInfo(this.CostCenterID),l=this.dsDocDesig.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=l&&l.length>0&&!m.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sCrAccount=l[0].UserDefaultValue.toString()),l=this.dsDocDesig.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=l&&l.length>0&&!m.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sDrAccount=l[0].UserDefaultValue.toString()),this.dgvEmployees=new re.vv,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();let t=new J.O7;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],t=new J.O7,t.Header=this.GetResource("Select",40054),t.DisplayMember="Select",t.ID="Select",t.DataType="CheckBox",t.Width=50,t.IsFrozen=!0,t.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),t=new J.O7,t.Header=this.GetResource("S No",40054),t.DisplayMember="SNo",t.ID="SNo",t.DataType="TextBlock",t.Width=50,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("SNo"),t=new J.O7,t.Header="EmpSeqNo",t.DisplayMember="EmpSeqNo",t.ID="EmpSeqNo",t.DataType="TextBlock",t.Width=50,t.ReadOnly=!0,t.IsFrozen=!0,t.IsVisible=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpSeqNo"),t=new J.O7,t.Header=this.GetResource("Employee Code",40054),t.DisplayMember="EmpCode",t.ID="EmpCode",t.CrRefColName="dcCCNID51",t.DataType="TextBlock",t.Width=150,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpCode"),t=new J.O7,t.Header=this.GetResource("Employee Name",40054),t.DisplayMember="EmpName",t.ID="EmpName",t.CrRefColName="dcCCNID51",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,t.IsFrozen=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("EmpName"),t=new J.O7,t.Header="GradeID",t.DisplayMember="GradeID",t.ID="GradeID",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,t.IsFrozen=!0,t.IsVisible=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("GradeID"),t=new J.O7,t.Header=this.GetResource("dcAlpha3",40054),t.DisplayMember="NetSalary",t.ID="NetSalary",t.CrRefColName="dcAlpha3",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=90,t.ReadOnly=!0,t.IsFontBold=!0,t.IsFrozen=!0,t.ShowTotal=!0,t.IsCalculated=1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),t=new J.O7,t.Header=this.GetResource("Month Days",40054),t.DisplayMember="MonthDays",t.ID="MonthDays",t.CrRefColName="dcAlpha4",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),t=new J.O7,t.Header=this.GetResource("dcAlpha5",40054),t.DisplayMember="DaysAttended",t.ID="DaysAttended",t.CrRefColName="dcAlpha5",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),t=new J.O7,t.Header=this.GetResource("dcAlpha24",40054),t.DisplayMember="PaidLeaves",t.ID="PaidLeaves",t.CrRefColName="dcAlpha24",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),t=new J.O7,t.Header=this.GetResource("dcAlpha6",40054),t.DisplayMember="TotalLeaves",t.ID="TotalLeaves",t.CrRefColName="dcAlpha6",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),t=new J.O7,t.Header=this.GetResource("dcAlpha7",40054),t.DisplayMember="WeeklyOffs",t.ID="WeeklyOffs",t.CrRefColName="dcAlpha7",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),t=new J.O7,t.Header=this.GetResource("dcAlpha8",40054),t.DisplayMember="Holidays",t.ID="Holidays",t.CrRefColName="dcAlpha8",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),t=new J.O7,t.Header=this.GetResource("dcAlpha9",40054),t.DisplayMember="LOPDays",t.ID="LOPDays",t.CrRefColName="dcAlpha9",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!1,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),t=new J.O7,t.Header=this.GetResource("dcAlpha10",40054),t.DisplayMember="UnpaidDays",t.ID="UnpaidDays",t.CrRefColName="dcAlpha10",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),t=new J.O7,t.Header=this.GetResource("dcAlpha4",40054),t.DisplayMember="TotalDays",t.ID="TotalDays",t.CrRefColName="dcAlpha4",t.DataType="FLOAT",t.DecimalPoints="1",t.Width=60,t.ReadOnly=!0,t.ForeColor="Gray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=d.d.common.GetDataSet("PAY058",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if(l=this.dsStructure.Tables[0].filter(o=>1==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!m.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())||(t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Earning"+l[o].SNo.toString(),t.ID="Earning"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightBlue",t.Width=80,"OverTime"==l[o].FieldType.toString()?(t.DisplayMember="EarningOTHrs"+l[o].SNo.toString(),t.ID="EarningOTHrs"+l[o].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="EarningOTAmt"+l[o].SNo.toString(),t.ID="EarningOTAmt"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightBlue","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember)));if(t=new J.O7,t.Header=this.GetResource("dcAlpha11",40054),t.DisplayMember="TotalEarnings",t.ID="TotalEarnings",t.CrRefColName="dcAlpha11",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightBlue",t.Width=90,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!m.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())&&(t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Earning"+l[o].SNo.toString(),t.ID="Earning"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="GreenYellow",t.Width=80,"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>2==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Deduction"+l[o].SNo.toString(),t.ID="Deduction"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightCoral",t.Width=80,"OverTime"==l[o].FieldType.toString()?(t.DisplayMember="DeductionOTHrs"+l[o].SNo.toString(),t.ID="DeductionOTHrs"+l[o].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="DeductionOTAmt"+l[o].SNo.toString(),t.ID="DeductionOTAmt"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightCoral","-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>3==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Loan"+l[o].SNo.toString(),t.ID="Loan"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightGoldenrodYellow",t.Width=80,"-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember);if(t=new J.O7,t.Header=this.GetResource("dcAlpha12",40054),t.DisplayMember="TotalDeductions",t.ID="TotalDeductions",t.CrRefColName="dcAlpha12",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="LightCoral",t.Width=90,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember),l=this.dsStructure.Tables[0].filter(o=>4==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)t=new J.O7,t.Header=this.GetResource(l[o].ComponentCode.toString(),50052),t.CrRefColID=parseInt(l[o].ComponentID),t.DisplayMember="Leave"+l[o].SNo.toString(),t.ID="Leave"+l[o].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints="1",t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightGreen",t.Width=60,"-1"!=l[o].Visible.toString()&&(t.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(t.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(t.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(t.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(t.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push(t.DisplayMember),this.dgvEmployees.DataTypes.Double.push(t.DisplayMember)}let i=this.dsDocDesig.Tables[0].filter(o=>1==o.IsColumnUserDefined&&(2==o.SectionID&&"H"==o.SectionName||3==o.SectionID));if(null!=i&&i.length>0)for(let o=0;o<i.length;o++){switch(t=new J.O7,t.Header=this.GetResource(i[o].SysColumnName.toString(),40054),t.DisplayMember=i[o].SysColumnName.toString(),t.ID=i[o].SysColumnName.toString(),t.CrRefColName=i[o].SysColumnName.toString(),t.DataType=i[o].ColumnDataType.toString(),t.IsColumnUserDefined=(0,Q.yG0)(i[o].IsColumnUserDefined),t.Mandatory=(0,Q.yG0)(i[o].IsMandatory),t.DataType.toUpperCase()){case"LISTBOX":t.ValueMember=t.ID+"_Key",this.dgvEmployees.TableColumns.push(t.ID),this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(t.ID+"_Key"),t.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),t.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString()),m.J0.IsEmpty(i[o].FetchMaxRows)?m.J0.IsEmpty(i[o].UserProbableValues)||(t.FilterColumn=i[o].UserProbableValues.toString()):t.GridViewID=parseInt(i[o].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(t.ID),t.IsColumnUserDefined)if("Date"==i[o].UserColumnType.toString()&&(t.DataType="DATE",this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(t.ID+"_Key")),"DateTime"==i[o].UserColumnType.toString())t.DataType="DATETIME",this.dgvEmployees.TableColumns.push(t.ID+"_Key");else if("Time"==i[o].UserColumnType.toString())t.DataType="TIME",this.dgvEmployees.TableColumns.push(t.ID+"_Key");else if("Numeric"==i[o].UserColumnType.toString())t.DataType="FLOAT";else if("SELECTIONBOX"==i[o].UserColumnType.toString()||"editablecombobox"==i[o].UserColumnType.toString().toLowerCase())t.DataType="SELECTIONBOX",t.CostCenterID=this.CostCenterID;else if("combobox"==i[o].UserColumnType.toString().toLowerCase()){if(t.ValueBinding=t.ID,!m.J0.IsEmpty(i[o].linkData)&&22803==parseInt(i[o].linkData.toString())||"@YEAR"==t.DefaultValue){t.DataType="PactComboBox";let r=[];for(let h=1980;h<2100;h++){let c={};c.Year=h.toString(),r.push(c)}t.DisplayMember="Year",t.ValueMember="Year",t.ComboData=r,"@YEAR"==t.DefaultValue&&(t.DefaultValue="")}else{t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=[],h=i[o].UserProbableValues.toString().Trim();if(h.length>0){let c=h.split(";");for(let g=0;g<c.length;g++)r.push(n._p.ComboBoxItems_2(c[g],c[g]))}t.ComboData=r}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}else if("LISTBOX"==i[o].UserColumnType.toString())if(44==parseInt(i[o].ColumnCostCenterID.toString())){t.ValueBinding=t.ID,t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=mt.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=r){let h=[];for(let c=0;c<r.length;c++)h.push(n._p.ComboBoxItems_2(r[c].Name.toString(),r[c].NodeID.toString()));t.ComboData=h}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}else t.DataType="LISTBOX",t.ValueMember=t.ID+"_Key",this.dgvEmployees.TableColumns.push(t.ID+"_Key"),t.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),t.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString());else if("Attachment"==i[o].UserColumnType.toString())t.DataType="LINK",t.ReadOnly=!0,t.FilterCondition=i[o].BasedOnXml.toString(),t.Dependantinuse=!1;else if("Image"==i[o].UserColumnType.toString())t.DataType="LINK",t.ReadOnly=!0,t.Dependantinuse=!0;else if("LOOKUP"==i[o].UserColumnType.toString()){t.ValueBinding=t.ID,t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let r=mt.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=r){let h=[];for(let c=0;c<r.length;c++)h.push(n._p.ComboBoxItems_2(r[c].Name.toString(),r[c].NodeID.toString()));t.ComboData=h}this.dgvEmployees.TableColumns.push(t.ID+"_Key")}break;case"DATE":t.DataType="DATE",this.dgvEmployees.TableColumns.push(t.ID),this.dgvEmployees.TableColumns.push(t.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(t.ID+"_Key")}t.Width=100,t.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.Contains(i[o].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(i[o].SysColumnName.toString())}if(this.dtCust=d.d.common.GetDataTable("PAY059",d.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let o=new m.VB;if(o.ReadXml(this.dtCust[0].ValueXml.toString()),null!=o&&o.Tables.length>0&&o.Tables[0].length>0){let r,h=3;for(let c=0;c<this.dgvEmployees.Columns.length;c++)r=o.Tables[0].filter(g=>g.SysColumnName==this.dgvEmployees.Columns[c].CrRefColName),r.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):(r=o.Tables[0].filter(g=>g.ID==this.dgvEmployees.Columns[c].CrRefColID),null!=r&&r.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):(r=o.Tables[0].filter(g=>g.ID==-this.dgvEmployees.Columns[c].CrRefColID),null!=r&&r.length>0?(this.dgvEmployees.Columns[c].DisplayIndex=parseInt(r[0].Index)+h,this.dgvEmployees.Columns[c].Width=parseInt(r[0].Width),this.dgvEmployees.Columns[c].ReadOnly=null!=r[0].ReadOnly&&null!=r[0].ReadOnly&&"1"==r[0].ReadOnly.toString(),this.dgvEmployees.Columns[c].Mandatory=null!=r[0].Mandatory&&null!=r[0].Mandatory&&"1"==r[0].Mandatory.toString(),this.dgvEmployees.Columns[c].IsVisible=null!=r[0].Visible&&null!=r[0].Visible&&"1"==r[0].Visible.toString()):this.dgvEmployees.Columns[c].DisplayIndex=c))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}t=new J.O7,t.Header=this.GetResource("Result",40054),t.DisplayMember="Result",t.ID="Result",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,this.dgvEmployees.Columns.push(t),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}OnPreviewKeyDown(a,l,t){if("F5"==l.key){var i=this.dgvEmployees.Columns.find(o=>o.DisplayMember==t);if(null!=i){if(i.ReadOnly||"sno"==t.toLowerCase()||!confirm("Do you want to override all.?"))return!0;for(let o=0;o<this.dgvEmployees.Table.length;o++)this.dgvEmployees.Table[o][t]=a[t].toString(),this.dgvEmployees.TableColumns.Contains(t+"_Key")&&(this.dgvEmployees.Table[o][t+"_Key"]=a[t+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[o]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[o],t,-1)}}else if(l.ctrlKey)if("F"==l.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),l.Handled=!0;else if("E"==l.key){let o=this.GetRawExportHTML().toString();const r=new Blob([o],{type:"text/plain;charser=utf-8"});St.saveAs(r,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),l.Handled=!0}return!1}static GetLookupData(a){let l=d.d.common.GetDataSet("PAY060",a.toString());return null!=l&&l.Tables.length>0&&l.Columns[0].Contains("NodeID")?l.Tables[0]:null}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgvEmployees.Table.length;l++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Process"==a.toString()?this.btnProcess_Click():"Load"==a.toString()?this.btnLoad_Click():"Export"==a.toString()?this.btnExport_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,d.d.page.ShowDialog(this,Nt.L,{Title:"Reports"}));Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}btnExport_Click(){this.dgvEmployees.Excelexportdelegate.Call()}btnLoad_Click(){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;let a=[];a.push(this);let l=new Kt(a);d.d.page.ShowDialog(l,$t,{Title:"Load Data"}).subscribe(()=>{if(l.DialogResult){if(!l.dtDataColumns.Contains("Employee Code"))return this.DisplayMessage="'Employee Code' Column not found.",void(this.MessageVisibility=!0);this.objCMPLData=l.dtData,this.sBGWorkType="LOAD",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")})}catch(a){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",a)}}LoadXLData(a){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";let l=0;if(null!=a&&a.length>0){l=a.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=l,this.ProgressMessage="Loading Excel Data, please wait ...";let t,i="",o=-1;for(let r=0;r<this.dgvEmployees.Table.length;r++)if(!m.J0.IsEmpty(this.dgvEmployees.Table[r].EmpCode)&&(i="",t=a.filter(h=>h["Employee Code"]==this.dgvEmployees.Table[r].EmpCode.toString()),t.length>0)){for(let h=1;h<Object.keys(a[0]).length;h++){let c=Object.keys(a[0])[h];for(let g=0;g<this.dgvEmployees.TableColumns.length;g++)if(this.dgvEmployees.Columns[g].Header==c&&this.dgvEmployees.TableColumns.Contains(this.dgvEmployees.Columns[g].ID)){this.dgvEmployees.Table[r][this.dgvEmployees.Columns[g].ID]=t[0][h].toString();{let u=this.dgvEmployees.Table.indexOf(this.dgvEmployees.Table[r]);this.iEmpIndex=this.lstSelectedEmps.indexOf(u);let p=0,e=-1;this.dgvEmployees.Columns[g].ID.startsWith("EarningOTHrs")?(p=1,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("EarningOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Earning")?(p=0,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Earning","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("DeductionOTHrs")?(p=3,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("DeductionOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Deduction")&&(p=2,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Deduction","")),i=this.dgvEmployees.Columns[g].ID,o=g);let D=this.oCMP.arrLstCPFields[this.iEmpIndex][p].find(y=>y.SNo==e);null!=D&&(D.dActual=parseFloat(t[0][h].toString()).ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],("DaysAttended"==this.dgvEmployees.Columns[g].ID||"LOPDays"==this.dgvEmployees.Columns[g].ID)&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[r],this.dgvEmployees.Columns[g].ID,g)}break}}o>=0&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[r],i,o),this.ProgressValue=r+1,this.InProgress=r+1+" of "+l}this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}btnProcess_Click(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}AddArrearColumns(){if(this.IsProcessWithArrears||this.IsProcessWithAdjustments){let t=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);t.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(t,"Earning"),t=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),t.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(t,"Deduction")}else{let t=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);if(t.sort((i,o)=>i.SNo-o.SNo),null!=t&&t.length>0)for(let i=0;i<t.length;i++)this.dgvEmployees.TableColumns.Contains("Earning"+t[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Earning"+t[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(o=>o.DisplayMember=="Earning"+t[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Earning"+t[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Earning"+t[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Earning"+t[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a));if(t=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),null!=t&&t.length>0)for(let i=0;i<t.length;i++){var a;this.dgvEmployees.TableColumns.Contains("Deduction"+t[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+t[i].SNo+"_Arr"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Deduction"+t[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(a)),this.dgvEmployees.TableColumns.Contains("Deduction"+t[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+t[i].SNo+"_Adj"),null!=(a=this.dgvEmployees.Columns.find(r=>r.DisplayMember=="Deduction"+t[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(a))}}let l=[];for(let t=0;t<this.dgvEmployees.Columns.length;t++)l.push(this.dgvEmployees.Columns[t]);this.dgvEmployees.Columns=l}AddEarDedArrearColumns(a,l){if(null!=a&&a.length>0){let t;if(this.IsProcessWithArrears)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Arr"))break;if(!m.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;t=new J.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Arr",t.DisplayMember=l+a[i].SNo.toString()+"_Arr",t.ID=l+a[i].SNo.toString()+"_Arr",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"-1"!=m.J0.String(a[i].Visible)&&(t.IsVisible="1"==m.J0.String(a[i].Visible)),"-1"!=m.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=m.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=m.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==m.J0.String(a[i].Mandatory));let o=this.dgvEmployees.Columns.find(r=>r.DisplayMember==l+a[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}if(this.IsProcessWithAdjustments)for(let i=0;i<a.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+a[i].SNo+"_Adj"))break;if(!m.J0.IsEmpty(a[i].Behaviour)&&("Accruals"==a[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==a[i].Behaviour.toString()))continue;t=new J.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Adj",t.DisplayMember=l+a[i].SNo.toString()+"_Adj",t.ID=l+a[i].SNo.toString()+"_Adj",t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"-1"!=m.J0.String(a[i].Visible)&&(t.IsVisible="1"==m.J0.String(a[i].Visible)),"-1"!=m.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=m.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=m.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==m.J0.String(a[i].Mandatory));let o=this.dgvEmployees.Columns.find(r=>r.DisplayMember==l+a[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}}}btnUnPost_Click(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1,d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnFilter_Click(){this.sFilter="",d.d.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(d.d.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new $e.t("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new $e.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),d.d.page.ShowDialog(this.objEmpFilter,pt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let r=0;r<this.objEmpFilter.CostCenterFilters.length;r++){let h=this.objEmpFilter.CostCenterFilters[r];if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(c=>c.Id==l&&c.IsGroup))if(o+=" AND ",Ct.IPrefetchFilter.IsGroupTree(h)){let c="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(c.length>0&&(c+=","),c+=h.SelectedNodes[g].Id);0==c.length&&(c+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+et.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+et.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN ",o+=c.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let c=0;c<h.SelectedNodes.length;c++)c>0&&(o+=","),o+=h.SelectedNodes[c].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}if(this.objEmpFilter.Filter>0){this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let l=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=l.Trim()&&"None"!=l&&(this.sFilter+="TreeView"==l?" ORDER BY EMP.lft ":" ORDER BY EMP."+l);let t=[];t.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(d.d.SessionManager.RoleID),t.push(d.d.SessionManager.UserID),t.push(d.d.SessionManager.LanguageID);let o,i=d.d.empService.GetData(t,"spPAY_GetEmpMasterCCDetails");if(this.btnClear_Click(),null!=i&&i.Tables.length>0&&i.Tables[0].length>0){if(o=i.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let r=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayroll"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53);if(null!=r&&r.length>0&&null!=r[0].Value&&null!=r[0].Value&&""!=r[0].Value.toString()&&"True"==r[0].Value.toString()&&(r=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(h=>"DontConsiderEmpsForPayrollDays"==h.Name&&h.GradeID==i.Tables[0][0].CCNID53),null!=r&&r.length>0&&null!=r[0].Value&&null!=r[0].Value&&""!=r[0].Value.toString())){let h=0;if(h=parseInt(r[0].Value),h>0){let c=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),h),g=i.Tables[0].filter(u=>new Date(u.DOJ)<=c);null!=g&&g.length>0&&(i=[],i=g)}}i.sort((h,c)=>c.CCNID53-h.CCNID53),o=i}this.AddGradeApplicableColumns(o);for(let r=0;r<o.length;r++){let h=this.dgvEmployees.NewRow();h.EmpSeqNo=o[r].EmpSeqNo,h.EmpCode=o[r].EmpCode,h.EmpName=o[r].EmpName,h.GradeID=o[r].CCNID53,h.SNo=(r+1).toString(),h.Select=!1;let c,g="";for(let u=0;u<this.dgvEmployees.TableColumns.length;u++)g=this.dgvEmployees.TableColumns[u],(g.startsWith("dcAlpha")||g.startsWith("dcCCNID"))&&(c=this.dsDocDesig.Tables[0].filter(p=>p.SysColumnName==g),null!=c&&c.length>0&&(m.J0.IsEmpty(c[0].UserColumnType)||("LISTBOX"==c[0].UserColumnType.toString().toUpperCase()?m.J0.IsEmpty(c[0].UserDefaultValue)||(h[g+"_Key"]=c[0].UserDefaultValue.toString()):"TEXT"==c[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==c[0].UserColumnType.toString().toUpperCase()?m.J0.IsEmpty(c[0].UserDefaultValue)||(h[g]=c[0].UserDefaultValue.toString()):"DATE"==c[0].UserColumnType.toString().toUpperCase()&&(m.J0.IsEmpty(c[0].UserDefaultValue)||"TODAY"==c[0].UserDefaultValue.toString().toUpperCase()&&(h[g]=(new Date).ToString(d.d.SessionManager.Preferences["Date Format"]),this.dgvEmployees.TableColumns.Contains(g+"_Key")&&(h[g+"_Key"]=new Date))))));this.dgvEmployees.addRow(h),this.dgvEmployees.RefreshGrid=!0}}}}}),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}AddGradeApplicableColumns(a){let l,t="";if(null!=(a=a.ToTable(!0,["CCNID53"]))&&a.length>0)for(let o=0;o<a.length;o++)!m.J0.IsEmpty(t)&&t.length>0&&(t+=","),t+=a[o].CCNID53.toString();if(!m.J0.IsEmpty(t)&&t.length>0&&(l=d.d.common.GetDataSet3("PAY125",t,d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"")),null!=l&&l.Tables.length>0){let o=this.dsStructure.Tables[0].filter(c=>1==c.Type);if(o.sort((c,g)=>c.SNo-g.SNo),null!=o&&o.length>0)for(let c=0;c<o.length;c++)this.dgvEmployees.TableColumns.Contains("Earning"+o[c].SNo)?(this.dgvEmployees.TableColumns.Remove("Earning"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(g=>g.DisplayMember=="Earning"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i)):this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+o[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTHrs"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(u=>u.DisplayMember=="EarningOTHrs"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+o[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTAmt"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(u=>u.DisplayMember=="EarningOTAmt"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i)));if(o=this.dsStructure.Tables[0].filter(c=>2==c.Type),null!=o&&o.length>0)for(let c=0;c<o.length;c++)if(this.dgvEmployees.TableColumns.Contains("Deduction"+o[c].SNo))this.dgvEmployees.TableColumns.Remove("Deduction"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(u=>u.DisplayMember=="Deduction"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i);else if(this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+o[c].SNo)){var i;this.dgvEmployees.TableColumns.Remove("DeductionOTHrs"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(u=>u.DisplayMember=="DeductionOTHrs"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+o[c].SNo)&&(this.dgvEmployees.TableColumns.Remove("DeductionOTAmt"+o[c].SNo),null!=(i=this.dgvEmployees.Columns.find(p=>p.DisplayMember=="DeductionOTAmt"+o[c].SNo))&&this.dgvEmployees.Columns.Remove(i))}let r=this.dgvEmployees.Columns.find(c=>"TotalDays"==c.DisplayMember);null!=r&&(this.iColId=this.dgvEmployees.Columns.indexOf(r)),o=l.Tables[0].filter(c=>1==c.Type),o.sort((c,g)=>c.SNo-g.SNo),this.AddEarDedColumns(o,"Earning"),r=this.dgvEmployees.Columns.find(c=>"TotalEarnings"==c.DisplayMember),null!=r&&(this.iColId=this.dgvEmployees.Columns.indexOf(r)),o=l.Tables[0].filter(c=>2==c.Type),o.sort((c,g)=>c.SNo-g.SNo),this.AddEarDedColumns(o,"Deduction");let h=[];for(let c=0;c<this.dgvEmployees.Columns.length;c++)h.push(this.dgvEmployees.Columns[c]);if(this.dgvEmployees.Columns=h,this.dtCust=d.d.common.GetDataTable("PAY059",d.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let c=new m.VB;if(c.ReadXml(this.dtCust[0].ValueXml.toString()),null!=c&&c.Tables.length>0&&c.Tables[0].length>0){let g,u=3;for(let p=0;p<this.dgvEmployees.Columns.length;p++)g=c.Tables[0].filter(e=>e.SysColumnName==this.dgvEmployees.Columns[p].CrRefColName),g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+u,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=c.Tables[0].filter(e=>e.ID==this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+u,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=c.Tables[0].filter(e=>e.ID==-this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+u,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):this.dgvEmployees.Columns[p].DisplayIndex=p))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}}}AddEarDedColumns(a,l){if(null!=a&&a.length>0){let t;for(let i=0;i<a.length;i++)m.J0.IsEmpty(a[i].Behaviour)||"Accruals"!=a[i].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=a[i].Behaviour.toString()?(t=new J.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052),t.DisplayMember=l+a[i].SNo.toString(),t.ID=l+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",t.Width=80,"OverTime"==a[i].FieldType.toString()?(t.DisplayMember="EarningOTHrs"+a[i].SNo.toString(),t.ID="EarningOTHrs"+a[i].SNo.toString(),t.DecimalPoints="2",t.Width=60,t.ReadOnly=!1):"Monthly"==a[i].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=m.J0.String(a[i].Visible)&&(t.IsVisible="1"==m.J0.String(a[i].Visible)),"-1"!=m.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=m.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=m.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==m.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember),"OverTime"==a[i].FieldType.toString()&&(t=new J.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052)+"_Amount",t.CrRefColID=parseInt(a[i].ComponentID),t.DisplayMember=l+"OTAmt"+a[i].SNo.toString(),t.ID=l+"OTAmt"+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.Width=80,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.ForeColor="Gray",t.HeaderBackColor="LightBlue","-1"!=a[i].Visible.toString()&&(t.IsVisible="1"==a[i].Visible.toString()),"-1"!=a[i].Width.toString()&&(t.Width=parseInt(a[i].Width)),"-1"!=a[i].IndexValue.toString()&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=a[i].Mandatory.toString()&&(t.Mandatory="1"==a[i].Mandatory.toString()),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))):(t=new J.O7,t.Header=this.GetResource(a[i].ComponentCode.toString(),50052),t.DisplayMember=l+a[i].SNo.toString(),t.ID=l+a[i].SNo.toString(),t.DataType="FLOAT",t.DecimalPoints=d.d.SessionManager.Preferences.PayrollNoOfDecimals,t.ReadOnly=!0,t.ShowTotal=!0,t.IsCalculated=1,t.HeaderBackColor="GreenYellow",t.Width=80,"Monthly"==a[i].FieldType.toString()?t.ReadOnly=!1:t.ForeColor="Gray","-1"!=m.J0.String(a[i].Visible)&&(t.IsVisible="1"==m.J0.String(a[i].Visible)),"-1"!=m.J0.String(a[i].Width)&&(t.Width=parseInt(a[i].Width)),"-1"!=m.J0.String(a[i].IndexValue)&&(t.DisplayIndex=parseInt(a[i].IndexValue)),"-1"!=a[i].ReadOnly.toString()&&(t.ReadOnly="1"==a[i].ReadOnly.toString()),"-1"!=m.J0.String(a[i].Mandatory)&&(t.Mandatory="1"==m.J0.String(a[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,t),this.dgvEmployees.TableColumns.push(t.DisplayMember))}}bgworker_DoWork(a,l){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}ProcessPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let r,t="",i="",o=new Array,h=!1,c=0;for(let g=0;g<this.dgvEmployees.Table.length;g++)if((0,Q.yG0)(this.dgvEmployees.Table[g].Select)&&(t+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,c=0,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let u=0;u<o.length;u++)if(o[u].GradeID==parseInt(this.dgvEmployees.Table[g].GradeID)){c=u,h=!0;break}h?(i=o[c].sEmpIds,i+=","+this.dgvEmployees.Table[g].EmpSeqNo.toString(),o[c].sEmpIds=i,o[c].lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo))):(r=new ut.ii,r.GradeID=parseInt(this.dgvEmployees.Table[g].GradeID),r.sEmpIds=this.dgvEmployees.Table[g].EmpSeqNo.toString(),r.lstGradeEmps=new Array,r.lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo)),o.push(r))}if(t.length>0&&l>0){if(t=t.substr(0,t.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let g=[];g.push(t),g.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(m.J0.IntTryParse(d.d.SessionManager.UserID)),g.push(d.d.SessionManager.LanguageID),this.dsDailyAttendanceData=d.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new tt.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=t,d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()&&(this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0)),this.oCMP.PayrollMonth=d.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let u=0;u<o.length;u++)o[u].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=o[u].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=o[u].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=o[u].GradePayrollMonthEnd);this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);let g=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(g=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(u=>u.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==u.VoucherType)),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(m.J0.IsEmpty(g[0].dcAlpha21)||""==m.J0.String(g[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=g[0].dcAlpha21.toString()),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=g[0].dcAlpha22.toString());let u=d.d.common.GetDataTable("PAY099",m.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=u&&u.length>0){let p=d.d.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<u.length;e++){let D=m.J0.ParseDate(u[e].ArrearsCalcMonths);if(null!=p&&p.length>0){let y=p.filter(A=>A.ArrAdjMonth==D);if(null!=y&&y.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].ArrData+=D.ToString("dd MMM yyyy")+","+parseFloat(y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].ArrData+=D.ToString("dd MMM yyyy")+","+parseFloat(y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let u=0;u<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;u++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dArrear="0";for(let u=0;u<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;u++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][u].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}if(this.IsProcessWithAdjustments){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(m.J0.IsEmpty(g[0].dcAlpha32)||""==m.J0.String(g[0].dcAlpha32).Trim())this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=g[0].dcAlpha32.toString()),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=g[0].dcAlpha33.toString());let u=d.d.common.GetDataTable("PAY113",m.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy")+"~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);if(null!=u&&u.length>0){let p=d.d.common.GetDataTable("PAY114",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<u.length;e++){let D=m.J0.ParseDate(u[e].AdjMonth);if(null!=p&&p.length>0){let y=p.filter(A=>A.ArrAdjMonth==D);if(null!=y&&y.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].AdjData+=D.ToString("dd MMM yyyy")+","+parseFloat(y[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].AdjData+=D.ToString("dd MMM yyyy")+","+parseFloat(y[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let u=0;u<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;u++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][u].dAdjusted="0";for(let u=0;u<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;u++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][u].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=""),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.IsProcessWithAdjustments&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(u=>(0,Q.yG0)(u.Select)).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}CalculateArrears(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];let l=new Array,t=d.d.empService.GetQueryData(a,"ARE001",d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"","");if(null!=t&&t.Tables[0].length>0){let i=m.J0.ParseDate(t.Tables[0][0].DtApplyFrom.toString()),o=m.J0.ParseDate(t.Tables[0][0].DtEffectFrom.toString()),r=t.Tables[1][0].ArrCalcMonths.toString().Replace("/"," ");if(o>i&&d.d.SessionManager.PayrollMonth>=o){let h=i;for(;h<o;)r.Contains(h.ToString("dd MMM yyyy"))||l.push(h.ToString("dd MMM yyyy")),h=h.AddMonths(1)}}if(l.length>0){let o,r,i="";for(let u=0;u<l.length;u++)i.length>0&&(i+=";"),i+=l[u],o={},o.PayrollMonth=l[u],this.dtArrData.push(o);let h="'"+i.Replace(";","','")+"'",c=d.d.common.GetDataSet3("PAY079",a.toString(),h).Tables[0];if(null!=c&&c.length>0){r=c.filter(u=>11==u.VoucherType);for(let u=0;u<r.length;u++)this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.length>0&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+=";"),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+m.J0.String(r[u].PaidDays)}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=i;let g=i.split(";");if(g.length>0){for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][F].dArrear="0";for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][F].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0;let e,D,u=d.d.common.GetDataTable("PAY098",""),p=d.d.common.GetDataSet3("PAY101",a.toString(),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),A=0;for(let F=0;F<g.length;F++)if(null!=g[F]&&""!=g[F]&&(r=c.filter(k=>new Date(k.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")),r.length>0)){let k=u.filter(N=>N.GradeID==r[0].dcCCNID53&&new Date(N.CPayrollDate)<=new Date(g[F])).Compute("max","CPayrollDate"),f=u.filter(N=>N.GradeID==r[0].dcCCNID53&&new Date(N.CPayrollDate)==new Date(k.ToString())),b=new tt.O;if(b.oParent=this,b.sSelectedEmpSeqNos=a.toString(),b.PayrollMonth=d.d.SessionManager.PayrollMonth,b.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,b.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,b.drcArrStructure=f,b.IsArrearclick=!0,b.ArrGradeID=parseInt(r[0].dcCCNID53),b.ProcessPayroll(),b.IsCompleted){b.arrLstOthMPFields[0].TotalDays=parseFloat(r[0].TotalDays),b.arrLstOthMPFields[0].MonthDays=parseFloat(r[0].TotalDays),b.arrLstOthMPFields[0].PaidLeaves=parseFloat(r[0].dcAlpha24),b.arrLstOthMPFields[0].TotalLeaves=parseFloat(r[0].LeavesTaken),b.arrLstOthMPFields[0].WeeklyOffs=parseFloat(r[0].WOffs),b.arrLstOthMPFields[0].Holidays=parseFloat(r[0].Holidays);let N=parseFloat(r[0].TotalDays.toString())-parseFloat(r[0].LOPDays.toString())-parseFloat(r[0].LeavesTaken.toString())-parseFloat(r[0].UnpaidDays.toString());e=p.Tables[0].filter(O=>O.AdjMonth==m.J0.ParseDate(g[F])),null!=e&&e.length>0&&(N+=parseFloat(e[0].Days)),D=p.Tables[1].filter(O=>2==O.DType&&O.ArrAdjMonth==m.J0.ParseDate(g[F])),b.SetDaysAttended(0,"Days Attended",N);let ee=0,q=-1,H=0;r=c.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&11==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;O++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateArrears)for(let oe=0;oe<b.arrLstCPFields[0][0].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo==b.arrLstCPFields[0][0][oe].SNo){H=0,A=0,q=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo,m.J0.IsEmpty(r[0]["dcCalcNum"+q])||(H=parseFloat(r[0]["dcCalcNum"+q])),null!=D&&D.length>0&&(m.J0.IsEmpty(D[0]["Earning"+q])||(A=parseFloat(D[0]["Earning"+q]))),ee=parseFloat(b.arrLstCPFields[0][0][oe].dEarned)-H-A,this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData+=g[F]+","+ee+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dArrear)+ee).ToString(d.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+=ee);break}r=c.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&12==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;O++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateArrears)for(let oe=0;oe<b.arrLstCPFields[0][2].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo==b.arrLstCPFields[0][2][oe].SNo){H=0,A=0,q=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo,null!=r[0]["dcCalcNum"+q]&&null!=r[0]["dcCalcNum"+q]&&""!=r[0]["dcCalcNum"+q].toString()&&(H=parseFloat(r[0]["dcCalcNum"+q])),null!=D&&D.length>0&&null!=D[0]["Deduction"+q]&&null!=D[0]["Deduction"+q]&&""!=D[0]["Deduction"+q].toString()&&(A=parseFloat(D[0]["Deduction"+q])),ee=parseFloat(b.arrLstCPFields[0][2][oe].dEarned)-H-A,this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData+=g[F]+","+ee+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dArrear)+ee).ToString(d.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+=ee);break}}b.IsArrearclick=!1}let _="",x="";_=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays,x=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=_,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=x,this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+l.Message+"\r\n"+l.stack)}}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,c,l=[],t=d.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=d.d.SessionManager.PayrollMonth.AddMonths(-1),r=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=r;){if(c=t.filter(u=>u.PayrollMonth&&m.J0.ParseDate(u.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=c&&c.length>0){if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let u,p,e,D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e};if(m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=m.J0.GetEmployeeGrade(a.toString(),u,p,e),_>0&&(D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e},m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D,_),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd)}let y=[];y.push(a),y.push(u.ToString("dd/MMM/yyyy")),y.push(p.ToString("dd/MMM/yyyy")),y.push(e.ToString("dd/MMM/yyyy")),y.push(0),y.push(d.d.SessionManager.UserID),y.push(d.d.SessionManager.RoleID),y.push(d.d.SessionManager.LanguageID);let A=d.d.empService.ExecuteQuery_SP(y,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(e.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(d.d.SessionManager.RoleID),_.push(d.d.SessionManager.UserID),_.push(d.d.SessionManager.LanguageID);let x=d.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),F=new ut.mr,k=F.AggregateLeaves(a.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);k>0&&(h.Days=-k),g=F.lstPrevAdj}l.push(h)}if(null!=g&&g.length>0&&d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let u=0;u<g.length;u++)g[u].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy"),h.Days=g[u].dDays,l.push(h))}else if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let u,p,e,D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e};m.J0.SetPayrollDate_1(i,D),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd;let y=d.d.SessionManager.PayrollMonth,A=0;d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=m.J0.GetEmployeeGrade(a.toString(),u,p,e),A>0&&(D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e},m.J0.SetPayrollDate(i,D,A),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd),m.J0.SetPayrollMonth(u,d.d.SessionManager,A)),m.J0.SetPayrollMonth(u,d.d.SessionManager,A);let _=new tt.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=d.d.SessionManager.PayrollMonth,_.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),m.J0.SetPayrollMonth(y),l.push(h)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let u=0;u<l.length;u++)null!=l[u].Days&&null!=l[u].Days&&""!=l[u].Days.toString().Trim()&&(h={},h.PayrollMonth=d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[u].PayrollMonth.toString(),h.Days=l[u].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let u=0;u<this.dtAdjData.length;u++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[u].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[u].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=d.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),m.J0.SetPayrollMonth(a,d.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let t,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let r=d.d.empService.GetQueryData(a,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=d.d.empService.GetQueryData(0,"MPL014","","",""),c=d.d.empService.GetQueryData(a,"MPL005","","",""),g=d.d.empService.GetQueryData(a,"MPL011",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),u="";for(let e=0;e<this.dtAdjData.length;e++){let D=new Date(this.dtAdjData[e].AdjMonth),y=D;t=r.filter(k=>new Date(k.PayrollMonth).ToString("dd MMM yyyy")==D.ToString("dd MMM yyyy")&&11==k.VoucherType);let A=null;if(null!=t&&t.length>0){let k=h.filter(f=>f.GradeID==t[0].dcCCNID53&&f.CPayrollDate<=y.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(f=>f.GradeID==t[0].dcCCNID53&&f.CPayrollDate==m.J0.String(k))}if(u="'"+D.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+D.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=c.filter(k=>D.ToString("dd/MMM/yyyy")>=k.ApplyFrom&&D.ToString("dd/MMM/yyyy")<=k.EffectFrom),p=p.sort((k,f)=>k.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(k=>k.ArrearsCalcMonths==m.J0.ParseDate(D)),o=g.Tables[1].filter(k=>1==k.DType&&k.ArrAdjMonth==m.J0.ParseDate(D)),null!=p&&p.length>0){let k=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let b=0;b<f.length;b++)m.J0.ParseDate(f[b]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(k=!0)}null!=i&&i.length>0||k?(D=m.J0.ParseDate(p[0].EffectFrom),d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D)):d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D)}else d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D);let _=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=d.d.SessionManager.Preferences.PayDays?parseInt(d.d.SessionManager.Preferences.PayDays):D.DaysInMonth();let F=new tt.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=d.d.SessionManager.PayrollMonth,F.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=t&&t.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=m.J0.Int(t[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let k=0;null!=t&&t.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(t[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(t[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(t[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(t[0].Holidays),k=parseFloat(t[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",k)):m.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&m.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let H,f=0,b=-1,N=0,ee=0,q=0;t=r.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==D.ToString("dd MMM yyyy")&&11==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;O++)if(m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateAdjustments)for(let oe=0;oe<F.arrLstCPFields[0][0].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo==F.arrLstCPFields[0][0][oe].SNo){if(N=0,ee=0,q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo,!m.J0.IsEmpty(t)&&t.length>0&&!m.J0.IsEmpty(t[0]["dcCalcNum"+b])&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.split(";"),null!=H&&H.length>0))for(let pe=0;pe<H.length;pe+=2)new Date(H[pe]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(ee=parseFloat(H[pe+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+b]&&null!=o[0]["Earning"+b]&&""!=o[0]["Earning"+b]&&(q=parseFloat(o[0]["Earning"+b])),f=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,Q.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][oe].ComponentName?parseFloat(F.arrLstCPFields[0][0][oe].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][oe].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData=m.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData+=y.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dAdjusted)+f).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}t=r.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&12==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;O++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments)for(let oe=0;oe<F.arrLstCPFields[0][2].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo==F.arrLstCPFields[0][2][oe].SNo){if(N=0,ee=0,q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo,null!=t&&t.length>0&&null!=t[0]["dcCalcNum"+b]&&null!=t[0]["dcCalcNum"+b]&&""!=t[0]["dcCalcNum"+b].toString()&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.split(";"),null!=H&&H.length>0))for(let pe=0;pe<H.length;pe+=2)new Date(H[pe]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(ee=parseFloat(H[pe+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+b]&&null!=o[0]["Deduction"+b]&&""!=o[0]["Deduction"+b]&&(q=parseFloat(o[0]["Deduction"+b])),f=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,Q.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][oe].ComponentName?parseFloat(F.arrLstCPFields[0][2][oe].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][oe].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData=m.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData+=y.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dAdjusted)+f).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(t=>t.EmpSeqNo==a),l.length>0&&m.J0.ParseDate(l[0].cEffectFrom).getFullYear()==d.d.SessionManager.PayrollMonth.getFullYear()&&m.J0.ParseDate(l[0].cEffectFrom).iMonth()==d.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",i=0,o=0,r=0,h=0,c=0,g=0,u=0,p=0,e=0,D=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let y=d.d.empService.GetQueryData(a,"CONS002",JSON.stringify(t),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=d.d.empService.GetQueryData(0,"CONS003","","","");if(null!=y&&y.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,r=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){D=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<y.length;F++)c=parseFloat(y[F].TotalDays),h=parseFloat(y[F].DaysAttended)+parseFloat(y[F].PaidLeaves)+parseFloat(y[F].LOPDays),g=parseFloat(y[F]["dcCalcNum"+D]),u=parseFloat(y[F]["dcCalcNumFC"+D]),p=parseFloat((h/c*i).ToString(d.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(d.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(d.d.SessionManager.sPayrollDecimals)),r+=u;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-r).ToString(d.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<y.length;x++){let F=A.filter(b=>b.GradeID==parseInt(y[x].GradeID)&&b.CPayrollDate==m.J0.ParseDate(y[x].PayrollDate)).Compute("max","CPayrollDate"),k=A.filter(b=>b.GradeID==parseInt(y[x].GradeID)&&b.CPayrollDate==F),f=new tt.O;if(f.oParent=this,f.sSelectedEmpSeqNos=a.toString(),f.PayrollMonth=d.d.SessionManager.PayrollMonth,f.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,f.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,f.drcArrStructure=k,f.IsCalculateAccruals=!0,f.ArrGradeID=parseInt(y[x].GradeID),f.ProcessPayroll(),f.IsCompleted){f.arrLstOthMPFields[0].TotalDays=parseFloat(y[x].TotalDays),f.arrLstOthMPFields[0].MonthDays=parseFloat(y[x].TotalDays),f.arrLstOthMPFields[0].PaidLeaves=parseFloat(y[x].PaidLeaves),f.arrLstOthMPFields[0].TotalLeaves=parseFloat(y[x].LeavesTaken),f.arrLstOthMPFields[0].WeeklyOffs=parseFloat(y[x].WOffs),f.arrLstOthMPFields[0].Holidays=parseFloat(y[x].Holidays),h=parseFloat(y[x].TotalDays.toString())-parseFloat(y[x].LOPDays.toString())-parseFloat(y[x].LeavesTaken.toString())-parseFloat(y[x].UnpaidDays.toString()),f.SetDaysAttended(0,"Days Attended",h);let b=0,N=-1,ee=0,q=0;for(let H=0;H<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].Behaviour)for(let O=0;O<f.arrLstCPFields[0][0].length;O++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].SNo==f.arrLstCPFields[0][0][O].SNo){ee=0,q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].SNo,null!=y[x]["dcCalcNum"+N]&&null!=y[x]["dcCalcNum"+N]&&""!=y[x]["dcCalcNum"+N].toString()&&(ee=parseFloat(y[x]["dcCalcNum"+N])),null!=y[x]["dcCalcNumFC"+N]&&null!=y[x]["dcCalcNumFC"+N]&&""!=y[x]["dcCalcNumFC"+N].toString()&&(q=parseFloat(y[x]["dcCalcNumFC"+N])),b=parseFloat(f.arrLstCPFields[0][0][O].dEarned)-ee,this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].dPrevAccEar+=parseFloat(b.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][H].dPrevAccAdj+=q;break}for(let H=0;H<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].Behaviour)for(let O=0;O<f.arrLstCPFields[0][2].length;O++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].SNo==f.arrLstCPFields[0][2][O].SNo){ee=0,q=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].SNo,null!=y[x]["dcCalcNum"+N]&&null!=y[x]["dcCalcNum"+N]&&""!=y[x]["dcCalcNum"+N].toString()&&(ee=parseFloat(y[x]["dcCalcNum"+N])),null!=y[x]["dcCalcNumFC"+N]&&null!=y[x]["dcCalcNumFC"+N]&&""!=y[x]["dcCalcNumFC"+N].toString()&&(q=parseFloat(y[x]["dcCalcNumFC"+N])),b=parseFloat(f.arrLstCPFields[0][2][O].dEarned)-ee,this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].dPrevAccEar+=parseFloat(b.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][H].dPrevAccAdj+=q;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals))}}}}FillProcessedData(a){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;l++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo)&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dArrear).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dAdjusted).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;l++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dActual).ToString(d.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[a]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;l++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo)&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dArrear).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj")&&(this.dgvEmployees.Table[a]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dAdjusted).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;l++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dActual).ToString(d.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[a]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dEarned).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;l++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt&&(this.dgvEmployees.Table[a]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo]=m.J0.Double(this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;l++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo)&&(this.dgvEmployees.Table[a]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].LeaveTaken).ToString(d.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;l++)if(this.dgvEmployees.TableColumns.Contains(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName))if("LISTBOX"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldDataType){if("EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue){let t=d.d.SessionManager.dtFeatures.filter(i=>i.FeatureID==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName.Replace("dcCCNID",""))+5e4);if(null!=t&&t.length>0){let i=d.d.empService.GetQueryData(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,"CONS001",t[0].TableName.toString(),"","");null!=i&&i.length>0&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=i[0].Name.toString(),this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)}}}else"DATE"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldUserColumnType?"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=m.J0.ParseDate(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)))):"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(this.dgvEmployees.Table[a][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[a].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[a].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[a].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[a].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[a].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[a].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[a].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[a].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[a].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[a].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[a].TotalEarnings=this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings.ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[a].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[a].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(d.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[a]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}CheckViewForUser(a){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(let l=0;l<this.dgvEmployees.Columns.length;l++)this.SetView(this.dgvEmployees.Columns[l])}SetView(a){let l=this.dsDocDesig.Tables[6],t=this.dsDocDesig.Tables[0];l=l.filter(i=>1==i.Mode||2==i.Mode||3==i.Mode||4==i.Mode),a instanceof J.O7&&(l=a.CrRefColID>0?l.filter(i=>i.CostCenterColID==1e6+a.CrRefColID):null!=a.CrRefColName&&""!=a.CrRefColName&&a.CrRefColName.startsWith("dcAlpha")?l.filter(i=>i.SysColumnName==a.CrRefColName):[]),l.length>0?(a instanceof J.O7&&(a.IsVisible=(0,Q.yG0)(l[0].IsVisible.toString())),m.J0.IsEmpty(l[0].IsMandatory)||a instanceof J.O7&&(a.Mandatory=(0,Q.yG0)(l[0].IsMandatory)),a instanceof J.O7&&(a.ReadOnly=!(0,Q.yG0)(l[0].IsEditable)),a instanceof J.O7&&(a.Expression=m.J0.String(l[0].Expression)),a instanceof J.O7&&(a.Message=m.J0.String(l[0].FailureMessage)),m.J0.IsEmpty(l[0].ActionOptionID)?a instanceof J.O7&&(a.Action=0):a instanceof J.O7&&(a.Action=parseInt(l[0].ActionOptionID)),m.J0.IsEmpty(l[0].NumFieldEditOptionID)?a instanceof J.O7&&(a.EditOption=0):a instanceof J.O7&&(a.EditOption=parseInt(l[0].NumFieldEditOptionID.toString()))):(a instanceof J.O7&&(t="combobox"==a.DataType.toLowerCase()?t.filter(i=>i.SysColumnName==a.ValueBinding):t.filter(3==a.CostCenterID||2==a.CostCenterID?i=>i.CostcenterColid==a.ID:i=>i.SysColumnName==a.DisplayMember)),t.length>0&&(a instanceof J.O7&&(d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==a.CostCenterID||d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()&&50002==a.CostCenterID||(a.ReadOnly=!(0,Q.yG0)(t[0].IsEditable.toString()))),m.J0.IsEmpty(t[0].IsMandatory)||a instanceof J.O7&&(a.Mandatory=(0,Q.yG0)(t[0].IsMandatory)),a instanceof J.O7&&(a.IsVisible=(0,Q.yG0)(t[0].IsVisible.toString()))),a instanceof J.O7&&(a.EditOption=0),a instanceof J.O7&&(a.Expression=""),a instanceof J.O7&&(a.Message=""),a instanceof J.O7&&(a.Action=0))}UnPostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let t="";for(let i=0;i<this.dgvEmployees.Table.length;i++)(0,Q.yG0)(this.dgvEmployees.Table[i].Select)&&(t+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(t.length>0&&l>0){t=t.substr(0,t.length-1);let o,i=t.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...";let r=d.d.common.GetDataSet3("PAY061",t,d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0];for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(o=r.filter(c=>c.EmpSeqNo==i[h]),null!=o&&o.length>0){let c=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let u=d.d.document.DeleteSelectedRows(g,c);this.strResult=u.Message,c=u.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.dgvEmployees.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.dgvEmployees.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(c=>(0,Q.yG0)(c.Select)).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}PostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(let t=0;t<this.dgvEmployees.Table.length;t++)(0,Q.yG0)(this.dgvEmployees.Table[t].Select)&&l++;if(l>0){a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Posting data, please wait...";for(let t=0;t<this.dgvEmployees.Table.length;t++)if((0,Q.yG0)(this.dgvEmployees.Table[t].Select)){let i=this.oCMP.arrLstOthMPFields.find(o=>o.EmpSeqNo==this.dgvEmployees.Table[t].EmpSeqNo.toString());if(this.iEmpIndex=this.oCMP.arrLstOthMPFields.indexOf(i),this.iEmpIndex>=0){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let o=d.d.common.GetDataTable("PAY087",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+d.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+d.d.SessionManager.UserID+","+d.d.SessionManager.RoleID);null!=o&&o.length>0&&(!m.J0.IsEmpty(o[0].CanApprove)&&"TRUE"==o[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0?(this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[t].Result=this.strResult):(this.strResult="",this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a)}this.IsProcessed=!1}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(i=>(0,Q.yG0)(i.Select)).length>0&&(this.DisplayMessage="Posted Successfully",d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}ValidatePosting(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=d.d.SessionManager.Preferences.PayrollProduct&&""!=d.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(d.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(let a=0;a<this.dgvEmployees.Columns.length;a++)if(this.dgvEmployees.Columns[a].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[a].ID.endsWith("_Key")&&this.dgvEmployees.Columns[a].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[a].DataType&&""==m.J0.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[a].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[a].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(d.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",a),!1}}SaveVoucher(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(d.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(d.d.SessionManager.LocationID>0?d.d.SessionManager.LocationID:1):l.push(0),d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(d.d.SessionManager.DivisionID>0?d.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(d.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(d.d.SessionManager.CompanyGUID),l.push(d.d.SessionManager.UserName),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),l.push(d.d.SessionManager.IsOffline);let t="",i="",o=d.d.document.SetTempInvDocumentPostPayroll(l);a=o.obj;let r=o;t=null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("ErrorMessage")?r.Tables[r.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a=o.obj,a>0?null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("VoucherNo")&&(i=r.Tables[r.Tables.length-1][0].VoucherNo.toString()):null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Columns[r.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==r.Tables[r.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=t,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+a.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}GetDocumentXML(){let a,l="",t="",i="",o="",r="",h="",c=new Array,g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended.toString()+"'",i+='<Alpha Query="',i+=g;for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[e].endsWith("_Key")&&(r+=" "+this.dgvEmployees.TableColumns[e]+"='"+m.J0.EncodeXML(m.J0.StringValue(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]]))+"',");r+=" ",r.length>0&&(i+=","+r),i+='" ></Alpha>',r="",o+='<CostCenters Query="',r+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",r+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?r+=" dcCCNID68=1,":r+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",c.push("dcCCNID51"),c.push("dcCCNID53"),c.push("dcCCNID68");let u="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0]).length;e++)u=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0])[e].toString(),p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][u].toString(),u.Contains("CCNID")&&"CCNID51"!=u&&"CCNID53"!=u&&"CCNID68"!=u&&(r+=" dc"+u+"="+p+",",c.Contains("dc"+u)||c.push("dc"+u));for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcCCNID")&&(c.Contains(this.dgvEmployees.TableColumns[e])||this.dgvEmployees.TableColumns[e].endsWith("_Key")||(r+=" "+this.dgvEmployees.TableColumns[e]+"="+m.J0.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]+"_Key"].toString())+","));if(r.length>0&&(o+=r),o+='" ></CostCenters>',t+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+m.J0.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&!m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo)&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)!m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo)||(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",t="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let r=0;r<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;r++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[r].InvDocDetailsID.toString();let o="";if(o+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?a.length>0?'<XML DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML DetailIds="'+a+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let r,h,c,g,u,e,p="0";if(l=t="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let D=0;null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(y=>40057==y.CostCenterID&&"CreditAccount"==y.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(y=>40057==y.CostCenterID&&"DebitAccount"==y.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString()));for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;y++)if(!m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].IsVisible&&!m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanInstAmt)){r=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanDocNo,c=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanActInstNo,u=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanInstAmt.Replace(",","");let A=parseInt(c);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.RefNo==r&&k.dcAlpha5==d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(d.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==d.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.DocNo==r&&k.InstallmentNo==A),e.SortBy(["InstallmentNo"])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.DocNo==r&&k.InstBalance>0&&k.InstallmentNo<A),e.SortBy(["InstallmentNo"])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let _=parseFloat(u),x=0,F=0;do{if(D++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.DocNo==r&&k.InstallmentNo==A),h=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):_,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+D+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+r+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanBalAmt)-F)+"', dcAlpha3=N'"+u+"', dcAlpha4=N'"+m.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,_-=x,e[0].Flag=1,d.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==d.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let k=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==r&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=k&&null!=k&&(A=parseInt(k))}else A++}while(_>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let u,r="",h="",c="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let D=0;D<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;D++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[D].InvDocDetailsID.toString()}u=p="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(D=>40079==D.CostCenterID&&"CreditAccount"==D.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(u=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(D=>40079==D.CostCenterID&&"DebitAccount"==D.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+c+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(D=>D.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,_,x,F,D=[],y=[];y.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)y.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());y.push("OT1"),y.push("OT2"),y.push("OT3"),y.push("OT4"),y.push("OT5"),y.push("DAYSATTENDED"),y.push("ABSENTDAYS"),y.push("Leaves"),y.push("TOTALOTAMOUNT");for(let f=0;f<e.length;f++)if(_=this.ApplyFilter(D,e[f]),null!=_&&_.length>0)for(let b=0;b<y.length;b++)y[b].startsWith("OT")&&(_[0][y[b]]=m.J0.SUMHoursAndMinutes(_[0][y[b]].toString(),e[f][y[b]].toString()));else{A={},A.EMPNODE=e[f].EMPNODE;for(let b=1;b<y.length;b++)A[y[b]]=e[f][y[b]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let b=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[f]),N=0;if(null!=b&&b.length>0){let ee,q;N=0;for(let H=0;H<b.length;H++)ee=m.J0.ParseDate(b[H].FromDate),q=m.J0.ParseDate(b[H].ToDate),ee>=d.d.SessionManager.PayrollMonthStart?q<=d.d.SessionManager.PayrollMonthEnd?N+=parseFloat(b[H].Leaves):ee<=d.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ee,d.d.SessionManager.PayrollMonthEnd,parseInt(b[H].ComponentID))):q<=d.d.SessionManager.PayrollMonthEnd?q>=d.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,q,parseInt(b[H].ComponentID))):N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,d.d.SessionManager.PayrollMonthEnd,parseInt(b[H].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}D.push(A)}let k="0";for(let f=0;f<D.length;f++){if(k="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(k=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),r="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+k+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+u+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+m.J0.Double(D[f].TOTALOTAMOUNT)+", dcCalcNum1="+m.J0.Double(D[f].TOTALOTAMOUNT)+", ",o+="dcNum5="+m.J0.Double(D[f].OT1)+", dcCalcNum5="+m.J0.Double(D[f].OT1)+", ",o+="dcNum7="+m.J0.Double(D[f].OT2)+", dcCalcNum7="+m.J0.Double(D[f].OT2)+", ",o+="dcNum9="+m.J0.Double(D[f].OT3)+", dcCalcNum9="+m.J0.Double(D[f].OT3)+", ",o+="dcNum11="+m.J0.Double(D[f].OT4)+", dcCalcNum11="+m.J0.Double(D[f].OT4)+", ",o+="dcNum13="+m.J0.Double(D[f].OT5)+", dcCalcNum13="+m.J0.Double(D[f].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+m.J0.Double(D[f].DAYSATTENDED)+"', dcAlpha3=N'"+m.J0.Double(D[f].ABSENTDAYS)+"', dcAlpha4=N'"+m.J0.Double(D[f].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',r+=" dcCCNID51="+m.J0.Int(D[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let b=0;b<this.dsDailyAttendanceData.Tables[3].length;b++)h=this.dsDailyAttendanceData.Tables[3][b].Data.toString(),r+=" "+h+"="+m.J0.Int(D[f][h])+","}r.length>0&&(o+=r),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(r.length>0){o+="<ArrearsXML>",o+="<Rows>";for(let c=0;c<r.length;c++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" ArrearsCalcMonths="'+m.J0.ParseDate(r[c]).ToString("dd/MMM/yyyy"),o+='" ArrCalcMonthPayDays="'+h[c].toString(),o+='" ArrearsCalcDays="',o+='" />';o+="</Rows>",o+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(r.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let c=0;c<r.length;c++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+m.J0.ParseDate(r[c]).ToString("dd/MMM/yyyy"),o+='" Days="'+h[c].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(d.d.SessionManager.Preferences.CreateLoanType)>0&&(l=t="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"CreditAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"DebitAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+d.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<r.length;c++){let g="",u="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[c].toString()+"',1";for(let p=0;p<this.oCMP.arrLstCPFields[0][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.split(";"),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.split(";"),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=u+")",h+=g+")"}o+='<ArrearsDetailXML Query="'+h+'"></ArrearsDetailXML>'}}if(this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<r.length;c++){let g="",u="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[c].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=u+")",h+=g+")"}o+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}GetRawExportHTML(){let a="",l="";a+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",l+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",l+=".null{background-color:#ECF9C;}",a+="<style>"+l.toString()+"</style>";let t=this.dgvEmployees.Table;a+="<table>",a+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",a+="<COLGROUP>";let i=null;for(let r=0;r<this.dgvEmployees.TableColumns.length;r++){var o=this.dgvEmployees.TableColumns[r];i=this.dgvEmployees.Columns.find(h=>h.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[r][o].toUpperCase()),null!=i&&i.IsVisible&&(a+="<COL>")}a+="</COLGROUP>",a+="<tr style=''>";for(let r=0;r<this.dgvEmployees.Table.length;r++)o=this.dgvEmployees.Table[r],i=this.dgvEmployees.Columns.find(c=>c.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[r][o].toUpperCase()),null!=i&&i.IsVisible&&(a+="<th class='hdr'>",a+=i.Header,a+="</th>");a+="</tr>";for(let r=0;r<t.length;r++){if(a+="<tr",r%2==1&&(a+=" class=alt"),a+=">",0==this.dgvEmployees.TableColumns.length)a+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(let h=0;h<this.dgvEmployees.TableColumns.length;h++)o=this.dgvEmployees.TableColumns[r],i=this.dgvEmployees.Columns.find(g=>g.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[h][o].toUpperCase()),null!=i&&i.IsVisible&&(null==t[r][h]?a+="<td class='null'>":(a+="<td>",a+=t[r][h].toString()),a+="</td>");a+="</tr>"}return a+="</table>",a+="</td></tr></table>",a+="</body><html>",a.toString()}ApplyFilter(a,l){let t=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();t=t.filter(r=>r[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return t}ReportView(){this.ReportDimension=new Dt.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=d.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+d.d.SessionManager.UserID+" set @RoleID="+d.d.SessionManager.RoleID+"    \n                    SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                    FROM ADM_RevenUReports R  with(nolock)\n                    inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                    left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                    left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                    where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                    GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                    order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(t=>{let i=new Tt.v;i.DBColumnID=parseInt(t.ReportID),i.Label=t.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=t.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=t.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==t.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=t.Width.toString()&&(i.Width=t.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=t.Height.toString()&&(i.Length=t.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=t.DocumentField.toString()&&(i.Formula=t.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=t.mapxml.toString()&&(i.ToolTipDescription=t.mapxml.toString()),a.Contains(parseInt(t.ReportID))||(a.push(parseInt(t.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,ne.A)(function*(){const{ReportViewModel:t}=yield Promise.resolve().then(G.bind(G,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(G.bind(G,73540));let h,o={strXML:""},r=new t;if(l.DisplayMessage=l.GetReportFilterXML(a,o),h=o.strXML,0==l.DisplayMessage.length){var c=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=c&&c.Dependantinuse)r.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!m.J0.IsEmpty(c.Width)&&m.J0.Double(c.Width)>0&&(r.RptWidth=m.J0.Double(c.Width)),!m.J0.IsEmpty(c.length)&&m.J0.Double(c.length)>0&&(r.RptHeight=m.J0.Double(c.length)),r.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.ShowDialog(r,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new t;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let t="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let r,o=!1;i.forEach(h=>{(0,Q.yG0)(h.GroupLevel)&&(o=!0)}),t+="<XML",o&&(t+=' GroupLevel="1"'),t+=" >";for(let h=0;h<i.length;h++){if(r=i[h].ReportField.toString(),t+="<Row ",t+='ColID ="'+r+'" ',!m.J0.IsEmpty(i[h].SysColumnName))if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let c="";for(let g=0;g<this.dgvEmployees.Table.length;g++)(0,Q.yG0)(this.dgvEmployees.Table[g].Select)&&(c+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",");if(m.J0.IsEmpty(c)||!(c.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";c=c.substr(0,c.length-1),t+='Value ="'+c+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(t+='Value ="'+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');t+=" />"}return t+="</XML>",l.strXML=t.toString(),""}}function Qt(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",19),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function qt(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",20),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function zt(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",21),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let Zt=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-post-payroll"]],decls:100,vars:27,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"masterscreen",2,"height","120px"],[1,"row",2,"height","30px"],[1,"col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row","margin-bottom","9px"],[1,"input_cntrl_label",2,"font-size","13px"],[1,"input_cntrl_label",2,"font-weight","bold","font-size","12px !important"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],["FieldDirective","",3,"obj"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-chart-line"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n        "),s.j41(7,"div",3),s.EFF(8,"\n          "),s.DNE(9,Qt,4,3,"span",4),s.EFF(10,"\n          "),s.j41(11,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(12,"i",6),s.EFF(13),s.nI1(14,"translate"),s.k0s(),s.EFF(15,"\n          "),s.DNE(16,qt,4,3,"span",4),s.EFF(17,"\n          "),s.j41(18,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",7),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n          "),s.DNE(23,zt,4,3,"span",4),s.EFF(24,"           \n        "),s.k0s(),s.EFF(25,"\n      "),s.k0s(),s.EFF(26,"\n      "),s.j41(27,"div",8),s.EFF(28," \n        "),s.j41(29,"div",9),s.EFF(30,"\n          "),s.j41(31,"div",10),s.EFF(32," \n            "),s.j41(33,"div",11),s.EFF(34,"\n                  "),s.j41(35,"label",12),s.EFF(36),s.nI1(37,"translate"),s.k0s(),s.EFF(38,"\n                  "),s.j41(39,"label",13),s.EFF(40),s.k0s(),s.EFF(41,"\n              "),s.k0s(),s.EFF(42,"\n            "),s.k0s(),s.EFF(43,"\n          "),s.j41(44,"div",10),s.EFF(45,"\n                "),s.j41(46,"div",14),s.EFF(47,"\n                "),s.j41(48,"label",12),s.EFF(49),s.nI1(50,"translate"),s.k0s(),s.EFF(51,"\n                "),s.j41(52,"label",13),s.EFF(53),s.k0s(),s.EFF(54,"\n              "),s.k0s(),s.EFF(55,"\n              "),s.j41(56,"div",14),s.EFF(57,"\n                "),s.j41(58,"label",12),s.EFF(59),s.nI1(60,"translate"),s.k0s(),s.EFF(61,"\n                "),s.j41(62,"label",13),s.EFF(63),s.k0s(),s.EFF(64,"              \n            "),s.k0s(),s.EFF(65,"\n          "),s.k0s(),s.EFF(66,"\n          "),s.j41(67,"div",10),s.EFF(68,"\n            "),s.j41(69,"div",15),s.EFF(70,"\n              "),s.eu8(71,16),s.EFF(72,"\n          "),s.k0s(),s.EFF(73,"\n  \n          "),s.j41(74,"div",15),s.EFF(75,"\n            "),s.eu8(76,16),s.EFF(77,"\n        "),s.k0s(),s.EFF(78,"                  \n           "),s.k0s(),s.EFF(79,"\n           "),s.j41(80,"div",10),s.EFF(81,"\n        "),s.j41(82,"div",15),s.EFF(83,"\n          "),s.eu8(84,16),s.EFF(85,"\n      "),s.k0s(),s.EFF(86,"\n      "),s.j41(87,"div",15),s.EFF(88,"\n        "),s.eu8(89,16),s.EFF(90,"\n    "),s.k0s(),s.EFF(91,"\n          "),s.k0s(),s.EFF(92,"\n        "),s.k0s(),s.EFF(93,"\n        "),s.j41(94,"div",17),s.EFF(95,"\n          "),s.nrm(96,"app-PactGridView",18),s.EFF(97,"  \n        "),s.k0s(),s.EFF(98,"\n      "),s.k0s(),s.EFF(99,"\n "),s.k0s()),2&t&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(14,17,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(21,19,"Filter")),s.R7$(3),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(13),s.SpI("",s.bMT(37,21,"Payroll_PayMonth"),"        :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonth),s.R7$(9),s.SpI("",s.bMT(50,23,"Payroll_StartDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthStart),s.R7$(6),s.SpI("",s.bMT(60,25,"Payroll_EndDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthEnd),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(5),s.Y8G("obj",i.obj.IsProcessWithAdjustments),s.R7$(7),s.Y8G("obj",i.obj.EmployeesList))},dependencies:[fe.bT,Ye._,ze.X,Xe.D9],encapsulation:2})}return V})();var Mt=G(81669),ea=G(73631);const ta=V=>({width:V});let Rt=(()=>{class V extends ea.P{constructor(){super()}ngOnInit(){m.J0.IsEmpty(this.obj.ProgressMessage)||(this.ProgressMessage=this.obj.ProgressMessage),this.obj.progress||(this.obj.progress=0),0===this.obj.total?this.obj.total=this.obj.progress:this.obj.total||(this.obj.total=100),this.obj.progress>this.obj.total&&(this.obj.progress=100,this.obj.total=100),this.obj.progress=this.obj.progress/this.obj.total*100,this.color=this.obj.progress<55?"red":this.obj.progress<75?"yellow":"green",setTimeout(()=>{d.d.page.HideDialog(this.obj.PopUpGUID)},2e3)}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-progress-bar"]],inputs:{progress:"progress",total:"total"},features:[s.Vt3],decls:7,vars:7,consts:[[1,"progress-bar-container"],[3,"ngStyle"]],template:function(t,i){1&t&&(s.EFF(0,"\n  "),s.j41(1,"div",0),s.EFF(2,"\n     "),s.j41(3,"div",1),s.EFF(4),s.k0s(),s.EFF(5,"\n  "),s.k0s(),s.EFF(6,"\n  ")),2&t&&(s.R7$(3),s.ZvI("progress-bar ",i.color,""),s.Y8G("ngStyle",s.eq3(5,ta,i.progress+"%")),s.R7$(),s.SpI("\n      ",i.ProgressMessage,"\n     "))},dependencies:[fe.B3],encapsulation:2})}return V})();class Lt extends je.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(a){a!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=a)}constructor(a){super(),this.ButtonClick=new Mt.Yk,this.ProgressVisibility=!1,this.chkPostBasedOnDailyAttendance=new Je.c,this.chkPostBasedOnAttDimWise=new Je.c,this.chkIncludeOTHours=new Je.c,this.IsProcessWithAdjustments=new Je.c,this.EmployeesList=new re.vv,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.dsDailyAttendanceData=null,this.sPayrollMonthMouseDoubleClickCommand=new Mt.Yk,this.btnCancelFlag=!1,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Tt.v,this.sCrAccount="0",this.sDrAccount="0",this.SelectUnCheck=0,this.sFilter="",this.IsPosting=!1,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),this.ClassName="PostPayrollViewModel",this.CostCenterID=40054,this.DisplayName=d.d.GetResource(a),this.Title=d.d.GetResource(a),this.DisplayMessage="",this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.ButtonClick.Subscribe(this,"Button_Click"),this.sPayrollMonthMouseDoubleClickCommand.Subscribe(this,"sPayrollMonth_MouseDoubleClick"),this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.btnCancelFlag=!1,this.chkPostBasedOnDailyAttendance.Label=d.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=d.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=d.d.GetResource("PostbasedonAttendanceDimensionwise"),this.IsProcessWithAdjustments.Label=d.d.GetResource("IsProcessWithAdjustments"),this.LoadGrid(),this.btnFilter_Click(),d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView(),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(l){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+l.stack)}}sPayrollMonth_MouseDoubleClick(a){var l=this;return(0,ne.A)(function*(){const{SetPayrollDateViewModel:t}=yield Promise.resolve().then(G.bind(G,15091)),{SetPayrollDateComponent:i}=yield Promise.resolve().then(G.bind(G,72974));let o=new t;d.d.page.ShowDialog(o,i,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")}),o.DialogResult&&l.btnClear_Click()})()}LoadGrid(){let t,l=(new Ke.ControlGenerator).GetScreenInfo(this.CostCenterID);t=l.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=t&&t.length>0&&!m.J0.IsEmpty(t[0].UserDefaultValue)&&(this.sCrAccount=t[0].UserDefaultValue.toString()),t=l.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=t&&t.length>0&&null!=t[0].UserDefaultValue&&""!=t[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=t[0].UserDefaultValue.toString()),this.EmployeesList=new re.vv,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("GradeID"),this.EmployeesList.TableColumns.push("Result");let i=new J.O7;this.EmployeesList.Columns=[],i=new J.O7,i.Header=d.d.GetResource("Pay_Select"),i.DisplayMember="Select",i.DataType="CheckBox",i.Width=50,i.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(i),i=new J.O7,i.Header=d.d.GetResource("Payroll_EmpSNo"),i.DisplayMember="SNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new J.O7,i.Header=d.d.GetResource("EmployeeCode"),i.DisplayMember="EmpCode",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new J.O7,i.Header=d.d.GetResource("EmployeeName"),i.DisplayMember="EmpName",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new J.O7,i.Header=d.d.GetResource("Result"),i.DisplayMember="Result",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.EmployeesList.Table.length;l++)0==this.SelectUnCheck&&(this.EmployeesList.Table[l].Select=a);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}Button_Click(a){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"UnPost"==a.toString()?this.btnUnPost_Click():"Filter"==a.toString()?this.btnFilter_Click():"Report"==a.toString()&&(this.ReportInfoVisibility=!0,d.d.page.ShowDialog(this,Nt.L,{Title:"Reports"})),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}btnUnPost_Click(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+d.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=d.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}btnFilter_Click(){Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),d.d.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(d.d.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new $e.t("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new $e.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&d.d.page.ShowDialog(this.objEmpFilter,pt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted)if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let u=0;u<this.objEmpFilter.CostCenterFilters.length;u++){let p=this.objEmpFilter.CostCenterFilters[u];if(p.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==p.CostCenterID?"EmpSeqNo":"CCNID"+(p.CostCenterID-5e4)),p.SelectedNodes.length>0){if(1==p.SelectedNodes.length)o+=" AND ",o+=i+"="+p.SelectedNodes[0].Id;else if(!p.SelectedNodes.find(e=>e.Id==l&&e.IsGroup))if(o+=" AND ",Ct.IPrefetchFilter.IsGroupTree(p)){let e="";for(let D=0;D<p.SelectedNodes.length;D++)(null==p.SelectedNodes[D].Parent||!p.SelectedNodes[D].Parent.IsSelected)&&(e.length>0&&(e+=","),e+=p.SelectedNodes[D].Id);0==e.length&&(e+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+et.A.GetTagTableName(p.CostCenterID)+" T with(nolock),"+et.A.GetTagTableName(p.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=e.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let e=0;e<p.SelectedNodes.length;e++)e>0&&(o+=","),o+=p.SelectedNodes[e].Id;o+=")"}}else p.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let r=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=r.Trim()&&"None"!=r&&(this.sFilter+="TreeView"==r?" ORDER BY EMP.lft ":" ORDER BY EMP."+r);let h=[];h.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),h.push(this.sFilter),h.push(0),h.push(d.d.SessionManager.RoleID),h.push(d.d.SessionManager.UserID),h.push(d.d.SessionManager.LanguageID);let g,c=d.d.empService.GetData(h,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=c&&c.Tables.length>0&&c.Tables[0].length>0){if(g=c.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let u=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayroll"==p.Name&&p.GradeID==c.Tables[0][0].CCNID53);if(null!=u&&u.length>0&&null!=u[0].Value&&null!=u[0].Value&&""!=u[0].Value.toString()&&"True"==u[0].Value.toString()&&(u=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayrollDays"==p.Name&&p.GradeID==c.Tables[0][0].CCNID53),null!=u&&u.length>0&&null!=u[0].Value&&null!=u[0].Value&&""!=u[0].Value.toString())){let p=0;if(p=parseInt(u[0].Value),p>0){let e=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),p),D=c.Tables[0].filter(y=>y.DOJ<=e);null!=D&&D.length>0&&(c=[],c=D)}}c.Tables[0].DefaultView.Sort="CCNID53",g=c.Tables[0].DefaultView.ToTable()}for(let u=0;u<g.length;u++){let p=this.EmployeesList.NewRow();p.EmpSeqNo=g[u].EmpSeqNo,p.EmpCode=g[u].EmpCode,p.EmpName=g[u].EmpName,p.GradeID=g[u].CCNID53,p.SNo=(u+1).toString(),p.Select=!1,this.EmployeesList.addRow(p)}}}else this.objEmpFilter.Filter>0&&this.FilterEmployees()}),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}FilterEmployees(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==d.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+d.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+d.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let a=d.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=a.Trim()&&"None"!=a&&(this.sFilter+="TreeView"==a?" ORDER BY EMP.lft ":" ORDER BY EMP."+a);let l=[];l.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID);let i,t=d.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){if(i=t.Tables[0],d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let o=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(r=>"DontConsiderEmpsForPayroll"==r.Name&&r.GradeID==t.Tables[0][0].CCNID53);if(null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString()&&"True"==o[0].Value.toString()&&(o=d.d.SessionManager.dtPayrollPreferences.Tables[0].filter(r=>"DontConsiderEmpsForPayrollDays"==r.Name&&r.GradeID==t.Tables[0][0].CCNID53),null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString())){let r=0;if(r=parseInt(o[0].Value),r>0){let h=new Date(d.d.SessionManager.PayrollMonth.getFullYear(),d.d.SessionManager.PayrollMonth.getMonth(),r),c=t.Tables[0].filter(g=>new Date(g.DOJ)<=h);null!=c&&c.length>0&&(t=[],t=c)}}t.sort((r,h)=>h.CCNID53-r.CCNID53),i=t}for(let o=0;o<i.length;o++){let r=this.EmployeesList.NewRow();r.EmpSeqNo=i[o].EmpSeqNo,r.EmpCode=i[o].EmpCode,r.EmpName=i[o].EmpName,r.GradeID=i[o].CCNID53,r.SNo=(o+1).toString(),r.Select=!1,this.EmployeesList.addRow(r)}}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+a.stack)}}bgworker_DoWork(a,l){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}UnPostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let a=0,l=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let t="";for(let i=0;i<this.EmployeesList.Table.length;i++)(0,Q.yG0)(this.EmployeesList.Table[i].Select)&&(t+=this.EmployeesList.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(t.length>0&&l>0){t=t.substr(0,t.length-1);let o,i=t.split(",");a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Unposting Payroll, please wait ...",d.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},Rt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});let r=d.d.report.GetDataTable("PPVM01",t,d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"));for(let h=0;h<i.length;h++){if(this.strResult="",null!=i[h]&&""!=i[h]){if(o=r.filter(c=>c.EmpSeqNo==i[h]),null!=o&&o.length>0){let c=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let u=d.d.document.DeleteSelectedRows(g,c);this.strResult=u.Message,c=u.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.EmployeesList.Table[this.lstSelectedEmps[h]].EmpCode.toString()+",",this.FailedCount++;this.EmployeesList.Table[this.lstSelectedEmps[h]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[h]])}this.ProgressValue=h+1,this.InProgress=h+1+" of "+a}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(c=>1==c.Select).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(a,l){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}PostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let a=0,l=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let r,t="",i="",o=new Array,h=!1,c=0;for(let g=0;g<this.EmployeesList.Table.length;g++)if((0,Q.yG0)(this.EmployeesList.Table[g].Select)&&(t+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,h=!1,c=0,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let u=0;u<o.length;u++)if(o[u].GradeID==parseInt(this.EmployeesList.Table[g].GradeID)){c=u,h=!0;break}h?(i=o[c].sEmpIds,i+=","+this.EmployeesList.Table[g].EmpSeqNo.toString(),o[c].sEmpIds=i,o[c].lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo))):(r=new ut.ii,r.GradeID=parseInt(this.EmployeesList.Table[g].GradeID),r.sEmpIds=this.EmployeesList.Table[g].EmpSeqNo.toString(),r.lstGradeEmps=new Array,r.lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo)),o.push(r))}if(t.length>0&&l>0){if(t=t.substr(0,t.length-1),a=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Payroll is processing, please wait ...",d.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},Rt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString())if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++){m.J0.SetPayrollMonth(d.d.SessionManager.PayrollMonth,d.d.SessionManager,o[g].GradeID);let p=[];p.push(t),p.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),p.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),p.push(this.chkIncludeOTHours.IsChecked?1:0),p.push(m.J0.IntTryParse(d.d.SessionManager.UserID)),p.push(d.d.SessionManager.LanguageID);let e=d.d.empService.GetData(p,"spPAY_PostDailyAttendancetoPayroll");o[g].dsDailyAttendanceDataCollection=e}else{let g=[];g.push(t),g.push(d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(m.J0.IntTryParse(d.d.SessionManager.UserID)),g.push(d.d.SessionManager.LanguageID),this.dsDailyAttendanceData=d.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new tt.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=t,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=d.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=a,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++)o[g].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(d.d.SessionManager.PayrollMonth=o[g].GradePayrollMonth,d.d.SessionManager.PayrollMonthStart=o[g].GradePayrollMonthStart,d.d.SessionManager.PayrollMonthEnd=o[g].GradePayrollMonthEnd,this.dsDailyAttendanceData=o[g].dsDailyAttendanceDataCollection);if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let g=d.d.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+d.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+d.d.SessionManager.UserID+","+d.d.SessionManager.RoleID);null!=g&&g.length>0&&(!m.J0.IsEmpty(g[0].CanApprove)&&"TRUE"==g[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!d.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.IsProcessWithAdjustments.IsChecked&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+a}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(u=>1==u.Select).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,d.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==d.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==d.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}AdjustmentsClick(a){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let h,c,l=[],t=d.d.empService.GetQueryData(a,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=d.d.SessionManager.PayrollMonth.AddMonths(-1),r=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=r;){if(c=t.filter(u=>u.PayrollMonth&&m.J0.ParseDate(u.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=c&&c.length>0){if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let u,p,e,D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e};if(m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd,d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let _=0;_=m.J0.GetEmployeeGrade(a.toString(),u,p,e),_>0&&(D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e},m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D,_),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd)}let y=[];y.push(a),y.push(u.ToString("dd/MMM/yyyy")),y.push(p.ToString("dd/MMM/yyyy")),y.push(e.ToString("dd/MMM/yyyy")),y.push(0),y.push(d.d.SessionManager.UserID),y.push(d.d.SessionManager.RoleID),y.push(d.d.SessionManager.LanguageID);let A=d.d.empService.ExecuteQuery_SP(y,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let _=[];_.push(e.ToString("dd MMM yyyy")),_.push(""),_.push(0),_.push(d.d.SessionManager.RoleID),_.push(d.d.SessionManager.UserID),_.push(d.d.SessionManager.LanguageID);let x=d.d.empService.ExecuteQuery_SP(_,"spPAY_GetEmpMasterCCDetails"),k=(new ut.mr).AggregateLeaves(a.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);k>0&&(h.Days=-k)}l.push(h)}if(null!=g&&g.length>0&&d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=d.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let u=0;u<g.length;u++)g[u].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy"),h.Days=g[u].dDays,l.push(h))}else if(d.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==d.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(d.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){h={},h.PayrollMonth=o.ToString("dd/MMM/yyyy");let u,p,e,D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e};m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd;let y=d.d.SessionManager.PayrollMonth,A=0;d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=m.J0.GetEmployeeGrade(a.toString(),u,p,e),A>0&&(D={PayrollMonth:u,PayrollMonthStart:p,PayrollMonthEnd:e},m.J0.SetPayrollDate_1(m.J0.ParseDate(d.d.SessionManager.PayrollMonth.AddMonths(-1)),D,A),u=D.PayrollMonth,p=D.PayrollMonthStart,e=D.PayrollMonthEnd)),m.J0.SetPayrollMonth(u);let _=new tt.O;_.oParent=this,_.sSelectedEmpSeqNos=a.ToString(),_.PayrollMonth=d.d.SessionManager.PayrollMonth,_.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,_.ProcessPayroll(),_.IsCompleted&&(h.Days=_.arrLstOthMPFields[0].DaysAttended),m.J0.SetPayrollMonth(y),l.push(h)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let u=0;u<l.length;u++)null!=l[u].Days&&null!=l[u].Days&&""!=l[u].Days.toString().Trim()&&(h={},h.PayrollMonth=d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),h.AdjMonth=l[u].PayrollMonth.toString(),h.Days=l[u].Days.toString(),this.dtAdjData.push(h));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let u=0;u<this.dtAdjData.length;u++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[u].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[u].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let a=d.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),m.J0.SetPayrollMonth(a,d.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(a){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let t,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let r=d.d.empService.GetQueryData(a,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,h=d.d.empService.GetQueryData(0,"MPL014","","",""),c=d.d.empService.GetQueryData(a,"MPL005","","",""),g=d.d.empService.GetQueryData(a,"MPL011",d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),u="";for(let e=0;e<this.dtAdjData.length;e++){let D=new Date(this.dtAdjData[e].AdjMonth),y=D;t=r.filter(k=>new Date(k.PayrollMonth).ToString("dd MMM yyyy")==D.ToString("dd MMM yyyy")&&11==k.VoucherType);let A=null;if(null!=t&&t.length>0){let k=h.filter(f=>f.GradeID==t[0].dcCCNID53&&f.CPayrollDate<=y.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=h.filter(f=>f.GradeID==t[0].dcCCNID53&&f.CPayrollDate==m.J0.String(k))}if(u="'"+D.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+D.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=c.filter(k=>D.ToString("dd/MMM/yyyy")>=k.ApplyFrom&&D.ToString("dd/MMM/yyyy")<=k.EffectFrom),p=p.sort((k,f)=>k.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(k=>k.ArrearsCalcMonths==m.J0.ParseDate(D)),o=g.Tables[1].filter(k=>1==k.DType&&k.ArrAdjMonth==m.J0.ParseDate(D)),null!=p&&p.length>0){let k=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let b=0;b<f.length;b++)m.J0.ParseDate(f[b]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(k=!0)}null!=i&&i.length>0||k?(D=m.J0.ParseDate(p[0].EffectFrom),d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D)):d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D)}else d.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==d.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?m.J0.SetPayrollMonth(D,d.d.SessionManager,null!=t&&t.length>0?parseInt(t[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):m.J0.SetPayrollMonth(D);let _=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=d.d.SessionManager.Preferences.PayDays?parseInt(d.d.SessionManager.Preferences.PayDays):D.DaysInMonth();let F=new tt.O;if(F.oParent=this,F.sSelectedEmpSeqNos=a.toString(),F.PayrollMonth=d.d.SessionManager.PayrollMonth,F.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,F.dAdjDays=_,null!=t&&t.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=m.J0.Int(t[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let k=0;null!=t&&t.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(t[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(t[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(t[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(t[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(t[0].Holidays),k=parseFloat(t[0].DaysWorked.toString())+_,F.SetDaysAttended(0,"Days Attended",k)):m.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&m.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(_)));let H,f=0,b=-1,N=0,ee=0,q=0;t=r.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==D.ToString("dd MMM yyyy")&&11==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;O++)if(m.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].CalculateAdjustments)for(let oe=0;oe<F.arrLstCPFields[0][0].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo==F.arrLstCPFields[0][0][oe].SNo){if(N=0,ee=0,q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].SNo,!m.J0.IsEmpty(t)&&t.length>0&&!m.J0.IsEmpty(t[0]["dcCalcNum"+b])&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].ArrData.split(";"),null!=H&&H.length>0))for(let pe=0;pe<H.length;pe+=2)new Date(H[pe]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(ee=parseFloat(H[pe+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+b]&&null!=o[0]["Earning"+b]&&""!=o[0]["Earning"+b]&&(q=parseFloat(o[0]["Earning"+b])),f=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,Q.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][oe].ComponentName?parseFloat(F.arrLstCPFields[0][0][oe].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][oe].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData=m.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AdjData+=y.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].dAdjusted)+f).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}t=r.filter(O=>new Date(O.PayrollMonth).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&12==O.VoucherType);for(let O=0;O<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;O++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].CalculateAdjustments)for(let oe=0;oe<F.arrLstCPFields[0][2].length;oe++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo==F.arrLstCPFields[0][2][oe].SNo){if(N=0,ee=0,q=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].SNo,null!=t&&t.length>0&&null!=t[0]["dcCalcNum"+b]&&null!=t[0]["dcCalcNum"+b]&&""!=t[0]["dcCalcNum"+b].toString()&&(N=parseFloat(t[0]["dcCalcNum"+b])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.length>0&&(H=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.TrimEnd(","),H=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].ArrData.split(";"),null!=H&&H.length>0))for(let pe=0;pe<H.length;pe+=2)new Date(H[pe]).ToString("dd MMM yyyy")==y.ToString("dd MMM yyyy")&&(ee=parseFloat(H[pe+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+b]&&null!=o[0]["Deduction"+b]&&""!=o[0]["Deduction"+b]&&(q=parseFloat(o[0]["Deduction"+b])),f=d.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,Q.yG0)("True"==d.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][oe].ComponentName?parseFloat(F.arrLstCPFields[0][2][oe].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][oe].dEarned)-N-ee-q,this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData=m.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AdjData+=y.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].dAdjusted)+f).ToString(d.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][O].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet()}}}}CalculateAccruals(a){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(t=>t.EmpSeqNo==a),l.length>0&&m.J0.ParseDate(l[0].cEffectFrom).getFullYear()==d.d.SessionManager.PayrollMonth.getFullYear()&&m.J0.ParseDate(l[0].cEffectFrom).iMonth()==d.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let t="",i=0,o=0,r=0,h=0,c=0,g=0,u=0,p=0,e=0,D=-1;for(let _=0;_<this.oCMP.lstAccrAccumulateSNos.length;_++)t.length>0&&(t+=","),t+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[_]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[_];let y=d.d.empService.GetQueryData(a,"PostCalculateAccural",JSON.stringify(t),d.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=d.d.report.GetDataTable("PPVM02","");if(null!=y&&y.length>0){let _=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,r=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){D=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<y.length;F++)c=parseFloat(y[F].TotalDays),h=parseFloat(y[F].DaysAttended)+parseFloat(y[F].PaidLeaves)+parseFloat(y[F].LOPDays),g=parseFloat(y[F]["dcCalcNum"+D]),u=parseFloat(y[F]["dcCalcNumFC"+D]),p=parseFloat((h/c*i).ToString(d.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(d.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(d.d.SessionManager.sPayrollDecimals)),r+=u;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-r).ToString(d.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(_=!0);if(_){for(let x=0;x<y.length;x++){let F=A.filter(f=>f.GradeID==parseInt(y[x].GradeID)&&f.CPayrollDate==m.J0.ParseDate(y[x].PayrollDate)).Compute("max","MaxSchemeID"),k=new tt.O;if(k.oParent=this,k.sSelectedEmpSeqNos=a.toString(),k.PayrollMonth=d.d.SessionManager.PayrollMonth,k.PayrollMonthStart=d.d.SessionManager.PayrollMonthStart,k.PayrollMonthEnd=d.d.SessionManager.PayrollMonthEnd,k.drcArrStructure=F,k.IsCalculateAccruals=!0,k.ArrGradeID=parseInt(y[x].GradeID),k.ProcessPayroll(),k.IsCompleted){k.arrLstOthMPFields[0].TotalDays=parseFloat(y[x].TotalDays),k.arrLstOthMPFields[0].MonthDays=parseFloat(y[x].TotalDays),k.arrLstOthMPFields[0].PaidLeaves=parseFloat(y[x].PaidLeaves),k.arrLstOthMPFields[0].TotalLeaves=parseFloat(y[x].LeavesTaken),k.arrLstOthMPFields[0].WeeklyOffs=parseFloat(y[x].WOffs),k.arrLstOthMPFields[0].Holidays=parseFloat(y[x].Holidays),h=parseFloat(y[x].TotalDays.toString())-parseFloat(y[x].LOPDays.toString())-parseFloat(y[x].LeavesTaken.toString())-parseFloat(y[x].UnpaidDays.toString()),k.SetDaysAttended(0,"Days Attended",h);let f=0,b=-1,N=0,ee=0;for(let q=0;q<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].Behaviour)for(let H=0;H<k.arrLstCPFields[0][0].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].SNo==k.arrLstCPFields[0][0][H].SNo){N=0,ee=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].SNo,null!=y[x]["dcCalcNum"+b]&&null!=y[x]["dcCalcNum"+b]&&""!=y[x]["dcCalcNum"+b].toString()&&(N=parseFloat(y[x]["dcCalcNum"+b])),null!=y[x]["dcCalcNumFC"+b]&&null!=y[x]["dcCalcNumFC"+b]&&""!=y[x]["dcCalcNumFC"+b].toString()&&(ee=parseFloat(y[x]["dcCalcNumFC"+b])),f=parseFloat(k.arrLstCPFields[0][0][H].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].dPrevAccEar+=parseFloat(f.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][q].dPrevAccAdj+=ee;break}for(let q=0;q<this.oCMP.arrLstCPFields[2].length;q++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].Behaviour)for(let H=0;H<k.arrLstCPFields[0][2].length;H++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].SNo==k.arrLstCPFields[0][2][H].SNo){N=0,ee=0,b=this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].SNo,null!=y[x]["dcCalcNum"+b]&&null!=y[x]["dcCalcNum"+b]&&""!=y[x]["dcCalcNum"+b].toString()&&(N=parseFloat(y[x]["dcCalcNum"+b])),null!=y[x]["dcCalcNumFC"+b]&&null!=y[x]["dcCalcNumFC"+b]&&""!=y[x]["dcCalcNumFC"+b].toString()&&(ee=parseFloat(y[x]["dcCalcNumFC"+b])),f=parseFloat(k.arrLstCPFields[0][2][H].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].dPrevAccEar+=parseFloat(f.ToString(d.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][q].dPrevAccAdj+=ee;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(d.d.SessionManager.sPayrollDecimals))}}}}ValidatePosting(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=d.d.SessionManager.Preferences.PayrollProduct&&""!=d.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(d.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(d.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(a){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+a.stack),!1}}SaveVoucher(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let a=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(d.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==d.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(d.d.SessionManager.LocationID>0?d.d.SessionManager.LocationID:1):l.push(0),d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==d.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(d.d.SessionManager.DivisionID>0?d.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(d.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(d.d.SessionManager.CompanyGUID),l.push(d.d.SessionManager.UserName),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),l.push(d.d.SessionManager.IsOffline);let t="",i="",o=d.d.document.SetTempInvDocumentPostPayroll(l);a=o.obj;let r=o;t=null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("ErrorMessage"))?r.Tables[r.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",a>0?null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("VoucherNo"))&&(i=r.Tables[r.Tables.length-1][0].VoucherNo.toString()):null!=r&&r.Tables.length>0&&r.Tables[r.Tables.length-1].length>0&&r.Tables[r.Tables.length-1].some(h=>h.hasOwnProperty("ServerMessage"))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,a="-407"==r.Tables[r.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=t,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(a){this.strResult+=a.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",a)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}GetDocumentXML(){let a,l="",t="",i="",o="",r="",h="",c=[],g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?g+=",dcAlpha15='"+m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",d.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==d.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended+"'",i+='<Alpha Query="',i+=g,r+=" ",r.length>0&&(i+=","+r),i+='" ></Alpha>',r="",o+='<CostCenters Query="',r+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",r+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?r+=" dcCCNID68=1,":r+=" dcCCNID68="+m.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",c.push("dcCCNID51"),c.push("dcCCNID53"),c.push("dcCCNID68");let u="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;e++)u=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[e],p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][u],u.Contains("CCNID")&&"CCNID51"!=u&&"CCNID53"!=u&&"CCNID68"!=u&&(r+=" dc"+u+"="+p+",",c.Contains("dc"+u)||c.push("dc"+u));if(r.length>0&&(o+=r),o+='" ></CostCenters>',t+='" ProductID="'+this.DefProdID+'" Quantity="0',t+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',t+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',t+='" StockValue="0" StockValueFC="0" RefNO="',t+='" BillDate="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),t+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',t+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,t+='" CommonNarration="'+m.J0.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Earning',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Deduction',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Loan',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Leave',h="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(a=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=a&&a.length>0&&(h=a[0].InvDocDetailsID.toString())),l+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',l+=t.toString()+'" ></Transactions>',r="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo.toString()&&(r+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",r+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",r+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",r+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");r.length>0&&(l+=r),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,a="",l="",t="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let r=0;r<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;r++)a+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[r].InvDocDetailsID.toString();let o="";if(o+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?a.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':a.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" DetailIds="'+a+'" >':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="'+d.d.SessionManager.GetAccessPoint()+'" >',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let r,h,c,g,u,e,p="0";if(l=t="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let D=0;null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(y=>40057==y.CostCenterID&&"CreditAccount"==y.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(y=>40057==y.CostCenterID&&"DebitAccount"==y.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString()));for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;y++)if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].IsVisible&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanInstAmt&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanInstAmt.toString()){r=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanDocNo,c=this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanActInstNo,u=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanInstAmt.Replace(",","");let A=parseInt(c);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.RefNo==r&&m.J0.ParseDate(k.dcAlpha5)==d.d.SessionManager.PayrollMonth),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(d.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==d.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.RefNo==r&&k.InstallmentNo==A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.DocNo==r&&k.InstBalance>0&&k.InstallmentNo<A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let _=parseFloat(u),x=0,F=0;do{if(D++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(k=>k.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&k.DocNo==r&&k.InstallmentNo==A),e.length>0)if(h=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=_>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):_,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+D+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+h+'" LinkedFieldName="dcNum3" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="'+r+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanBalAmt)-F)+"', dcAlpha3=N'"+u+"', dcAlpha4=N'"+m.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][y].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,_-=x,e[0].Flag=1,d.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==d.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let k=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==r&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=k&&null!=k&&(A=parseInt(k))}else A++;else _=0}while(_>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&d.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==d.d.SessionManager.Preferences.CaputureDimensionData.toString()){let u,r="",h="",c="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){c=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let D=0;D<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;D++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[D].InvDocDetailsID.toString()}u=p="",null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(D=>40079==D.CostCenterID&&"CreditAccount"==D.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(u=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(D=>40079==D.CostCenterID&&"DebitAccount"==D.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+c+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(D=>D.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,_,x,F,D=[],y=[];y.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)y.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());y.push("OT1"),y.push("OT2"),y.push("OT3"),y.push("OT4"),y.push("OT5"),y.push("DAYSATTENDED"),y.push("ABSENTDAYS"),y.push("Leaves"),y.push("TOTALOTAMOUNT");for(let f=0;f<e.length;f++)if(_=this.ApplyFilter(D,e[f]),null!=_&&_.length>0)for(let b=0;b<y.length;b++)y[b].startsWith("OT")&&(_[0][y[b]]=m.J0.SUMHoursAndMinutes(_[0][y[b]].toString(),e[f][y[b]].toString()));else{A={},A.EMPNODE=e[f].EMPNODE;for(let b=1;b<y.length;b++)A[y[b]]=e[f][y[b]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let b=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[f]),N=0;if(null!=b&&b.length>0){let ee,q;N=0;for(let H=0;H<b.length;H++)ee=m.J0.ParseDate(b[H].FromDate),q=m.J0.ParseDate(b[H].ToDate),ee>=d.d.SessionManager.PayrollMonthStart?q<=d.d.SessionManager.PayrollMonthEnd?N+=parseFloat(b[H].Leaves):ee<=d.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ee,d.d.SessionManager.PayrollMonthEnd,parseInt(b[H].ComponentID))):q<=d.d.SessionManager.PayrollMonthEnd?q>=d.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,q,parseInt(b[H].ComponentID))):N+=this.oCMP.GetNoOfDays(d.d.SessionManager.PayrollMonthStart,d.d.SessionManager.PayrollMonthEnd,parseInt(b[H].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}D.push(A)}let k="0";for(let f=0;f<D.length;f++){if(k="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(k=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),r="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+k+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+u+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+m.J0.Double(D[f].TOTALOTAMOUNT)+", dcCalcNum1="+m.J0.Double(D[f].TOTALOTAMOUNT)+", ",o+="dcNum5="+m.J0.Double(D[f].OT1)+", dcCalcNum5="+m.J0.Double(D[f].OT1)+", ",o+="dcNum7="+m.J0.Double(D[f].OT2)+", dcCalcNum7="+m.J0.Double(D[f].OT2)+", ",o+="dcNum9="+m.J0.Double(D[f].OT3)+", dcCalcNum9="+m.J0.Double(D[f].OT3)+", ",o+="dcNum11="+m.J0.Double(D[f].OT4)+", dcCalcNum11="+m.J0.Double(D[f].OT4)+", ",o+="dcNum13="+m.J0.Double(D[f].OT5)+", dcCalcNum13="+m.J0.Double(D[f].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+m.J0.Double(D[f].DAYSATTENDED)+"', dcAlpha3=N'"+m.J0.Double(D[f].ABSENTDAYS)+"', dcAlpha4=N'"+m.J0.Double(D[f].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',r+=" dcCCNID51="+m.J0.Int(D[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){h="";for(let b=0;b<this.dsDailyAttendanceData.Tables[3].length;b++)h=this.dsDailyAttendanceData.Tables[3][b].Data.toString(),r+=" "+h+"="+m.J0.Int(D[f][h])+","}r.length>0&&(o+=r),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),h=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(r.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let c=0;c<r.length;c++)o+='<Row PayrollMonth="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+m.J0.ParseDate(r[c]).ToString("dd/MMM/yyyy"),o+='" Days="'+h[c].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),l=t="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==d.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(d.d.SessionManager.Preferences.CreateLoanType)>0&&(null!=d.d.SessionManager.dtDocDefAccs&&(i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"CreditAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=d.d.SessionManager.dtDocDefAccs.filter(r=>40056==r.CostCenterID&&"DebitAccount"==r.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(t=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+t+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+d.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+d.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let r=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(r.length>0){let h="";h+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let c=0;c<r.length;c++){let g="",u="";h+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+r[c].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let D=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),D=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=D&&D.length>0)for(let y=0;y<D.length;y+=2)m.J0.ParseDate(D[y]).ToString("dd MMM yyyy")==m.J0.ParseDate(r[c]).ToString("dd MMM yyyy")&&(e=D[y+1])}u+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}h+=u+")",h+=g+")"}o+='<AdjustmentsDetailXML Query="'+h+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}ApplyFilter(a,l){let t=a.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();t=t.filter(r=>r[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return t}ReportView(){this.ReportDimension=new Dt.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let a=[];this.dsData=d.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+d.d.SessionManager.UserID+" set @RoleID="+d.d.SessionManager.RoleID+"    \n                     SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                     FROM ADM_RevenUReports R  with(nolock)\n                     inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                     left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                     left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                     where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                     GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                     order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(t=>{let i=new Tt.v;i.DBColumnID=parseInt(t.ReportID),i.Label=t.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=t.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=t.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==t.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=t.Width.toString()&&(i.Width=t.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=t.Height.toString()&&(i.Length=t.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=t.DocumentField.toString()&&(i.Formula=t.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=t.mapxml.toString()&&(i.ToolTipDescription=t.mapxml.toString()),a.Contains(parseInt(t.ReportID))||(a.push(parseInt(t.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(a){var l=this;return(0,ne.A)(function*(){const{ReportViewModel:t}=yield Promise.resolve().then(G.bind(G,35725)),{ReportViewComponent:i}=yield Promise.resolve().then(G.bind(G,73540));let h,o={strXML:""},r=new t;if(l.DisplayMessage=l.GetReportFilterXML(a,o),h=o.strXML,0==l.DisplayMessage.length){var c=l.ReportsList.find(g=>g.DBColumnID==parseInt(a));if(null!=c&&c.Dependantinuse)r.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!0,null,null),!m.J0.IsEmpty(c.Width)&&m.J0.Double(c.Width)>0&&(r.RptWidth=m.J0.Double(c.Width)),!m.J0.IsEmpty(c.length)&&m.J0.Double(c.length)>0&&(r.RptHeight=m.J0.Double(c.length)),r.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.ShowDialog(r,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new t;g.ReportViewModel_Document(l.CostCenterID,h,parseInt(a),!1,null,null),g.DocumentObject=l,d.d.page.HideDialog(l.PopUpGUID),d.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(a,l){let t="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(h=>h.ReportID==a);let r,o=!1;i.forEach(h=>{(0,Q.yG0)(h.GroupLevel)&&(o=!0)}),t+="<XML",o&&(t+=' GroupLevel="1"'),t+=" >";for(let h=0;h<i.length;h++)if(r=i[h].ReportField.toString(),t+="<Row ",t+='ColID ="'+r+'" ',!m.J0.IsEmpty(i[h].SysColumnName)){if("dcccnid51"==i[h].SysColumnName.toString().toLowerCase()){let c="";for(let g=0;g<this.EmployeesList.Table.length;g++)(0,Q.yG0)(this.EmployeesList.Table[g].Select)&&(c+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",");if(m.J0.IsEmpty(c)||!(c.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";c=c.substr(0,c.length-1),t+='Value ="'+c+'" '}else"duedate"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[h].SysColumnName.toString().toLowerCase()?t+='Value ="'+d.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[h].SysColumnName.toString().toLowerCase()&&(t+='Value ="'+d.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');t+=" />"}return t+="</XML>",l.strXML=t.toString(),""}}function aa(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",12),s.EFF(2,"Post"),s.k0s()}}let sa=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-post-att-time-sheet-to-daily-att"]],decls:36,vars:12,consts:[[2,"display","flex","position","relative","height","100%"],[2,"width","100%"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-file-export"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"label",3),s.EFF(7),s.k0s(),s.EFF(8,"\n            "),s.j41(9,"div",4),s.EFF(10,"\n            "),s.DNE(11,aa,3,0,"span",5),s.EFF(12,"\n            "),s.j41(13,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(14,"i",7),s.EFF(15),s.nI1(16,"translate"),s.k0s(),s.EFF(17,"\n            "),s.j41(18,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",8),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n            "),s.j41(23,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(24,"i",9),s.EFF(25),s.nI1(26,"translate"),s.k0s(),s.EFF(27,"\n            "),s.k0s(),s.EFF(28,"\n        "),s.k0s(),s.EFF(29,"\n        "),s.j41(30,"div",10),s.EFF(31,"\n            "),s.nrm(32,"app-PactGridView",11),s.EFF(33,"  \n        "),s.k0s(),s.EFF(34,"\n   "),s.k0s(),s.EFF(35,"\n "),s.k0s()),2&t&&(s.R7$(7),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(16,6,"Clear")),s.R7$(5),s.JRh(s.bMT(21,8,"Filter")),s.R7$(5),s.JRh(s.bMT(26,10,"lbl_Export")),s.R7$(7),s.Y8G("obj",i.obj.dgv))},dependencies:[fe.bT,ze.X,Xe.D9],encapsulation:2})}return V})();var yt=G(48875),nt=G(95050),vt=G(96833);class Ot extends je.g{get SelectAll(){return this._SelectAll}set SelectAll(a){a!=this._SelectAll&&(this._SelectAll=a,this.SelectUnselectAll(a))}set RefreshGrid(a){}constructor(a){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.DialogResult=!1,this.PostVisiblility=!0,this._SelectAll=!1,this.ChkBtnPostOnlyFirstAndLastTrans=new Je.c,this.PostOnlyFirstInLastOut=!1,this.PostOnlyFirstInLastOutVisibility=!0,this.btnCancelFlag=!1,this.SelectUnCheck=0,this.dsEmps=null,this.sEmpSeqNosOnGrid="",this.sFilter="",this.iPostDocType=0,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.btnCancelFlag=!1,this.LoadGrid(),this.btnFilter_Click()}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",l)}}LoadGrid(){this.dgv=new re.vv,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");let l,a=new J.O7;if(this.dgv.Columns=new Array,a=new J.O7,a.Header="Select",a.DisplayMember="Select",a.DataType="CheckBox",a.Width=50,a.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(a),a=new J.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new J.O7,a.Header="Employee Code",a.DisplayMember="EmpCode",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new J.O7,a.Header="Employee Name",a.DisplayMember="EmpName",a.DataType="TextBlock",a.Width=220,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new J.O7,a.Header="Voucher No.",a.DisplayMember="VoucherNo",a.DataType="LINK_VOUCHER",a.Width=180,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new J.O7,a.Header="Check-in Date",a.DisplayMember="CheckInDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Check-in Time",a.DisplayMember="CheckInTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Check-out Date",a.DisplayMember="CheckOutDate",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Check-out Time",a.DisplayMember="CheckOutTime",a.DataType="TextBlock",a.Width=120,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Total Time",a.DisplayMember="TotalTime",a.DataType="TextBlock",a.Width=100,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Result",a.DisplayMember="Result",a.DataType="TextBlock",a.Width=200,a.ReadOnly=!0,this.dgv.Columns.push(a),this.dsCols=d.d.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(l=this.dsCols.Tables[0].filter(t=>1==t.IsColumnInUse),null!=l&&l.length>0))for(let t=0;t<l.length;t++)a=new J.O7,a.Header=l[t].USERCOLUMNNAME.toString(),a.DisplayMember=l[t].SysColumnName.toString(),a.ID=l[t].SysColumnName.toString(),a.DataType="LISTBOX",a.CostCenterID=parseInt(l[t].ColumnCostCenterID),a.TypeID=parseInt(l[t].ColumnCCListViewTypeID),a.ReadOnly=!0,a.Width=120,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember),a=new J.O7,a.DisplayMember=l[t].SysColumnName.toString()+"_Key",a.IsVisible=!1,this.dgv.Columns.push(a),this.dgv.TableColumns.push(a.DisplayMember)}dgColSelect_CheckedChanged(a,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(a){for(let l=0;l<this.dgv.Table.length;l++)0==this.SelectUnCheck&&(this.dgv.Table[l].Select=a);this.SelectUnCheck=0}Button_Click(a){"Post"==a.toString()?this.btnPost_Click():"Clear"==a.toString()?this.btnClear_Click():"Filter"==a.toString()?this.btnFilter_Click():"Export"==a.toString()&&this.Export_Click()}Export_Click(){this.dgv.Excelexportdelegate.Call()}btnClear_Click(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}btnPost_Click(){if(this.ValidatePosting()){let l,t,a="",i=null;for(let o=0;o<this.objEmpFilter.DocumentsToLoad.Items.length;o++)if(i=null,1==this.objEmpFilter.DocumentsToLoad.Items[o].IsChecked)if("89"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?d.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):"90"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?d.d.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(i=d.d.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")):"103"==this.objEmpFilter.DocumentsToLoad.Items[o].Value&&d.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=d.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")),null!=i){let r="";if(null!=this.dtData&&this.dtData.length>0){let c=this.dtData.filter(g=>g.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);if(null!=c&&c.length>0)for(let g=0;g<c.length;g++)r.length>0&&(r+=","),r+=c[g].EmpSeqNo.toString()}let h=this.GetGroupByFilterEmployees(r);if(null!=h&&h.length>0){let c="";if(null!=i&&i.length>0){for(let g=0;g<i.length;g++)m.J0.IsEmptySpace(i[g])||(c.length>0&&(c+=","),c+="-1"==i[g]?"RptManager":"-2"==i[g]?"EmpSeqNo":"CCNID"+(parseInt(i[g])-5e4));if(c.length>0){let g=h.ToTable(!0,c.split(","));if(null!=g&&g.length>0){this.dgv.TableColumns.Contains("Flag")&&this.dgv.TableColumns.Remove("Flag"),this.dgv.TableColumns.push("Flag");for(let u=0;u<this.dgv.Table.length;u++)this.dgv.TableColumns.Contains("Flag")&&(this.dgv.Table[u].Flag="0");for(let u=0;u<g.length;u++){let p=h;for(let e=0;e<Object.keys(g[0]).length;e++){let D=Object.keys(g[0])[e],y=g[0][D];p=p.filter(A=>A[D]==m.J0.String(y))}Object.keys(g[0]).length>0&&p.length>0&&nt.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(e=>{e.ScreenObject.GridData.Clear();let D=-1;for(let A=0;A<this.dgv.Table.length;A++)if((0,Q.yG0)(this.dgv.Table[A].Select)&&(t=this.dtData.filter(_=>_.InvDocDetailsID==this.dgv.Table[0].InvDocDetailsID&&_.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=t&&t.length>0&&"1"!=m.J0.String(this.dgv.Table[A].Flag)&&p.filter(_=>_.EmpCode==t[0].EmpCode.toString()).length>0)){if(this.dgv.Table[A].Flag="1",D++,l=e.ScreenObject.GridDataObj.NewRow(),e.ScreenObject.GridDataObj.addRow(l),e.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(e.ScreenObject.GridData[D].dcCCNID51Code=t[0].EmpCode),e.ScreenObject.GridData[D].dcCCNID51_Key=t[0].EmpSeqNo,e.ScreenObject.GridData[D].dcCCNID51=t[0].EmpName,e.FillDefaultProd(e.ScreenObject.GridData[D],"dcCCNID51"),e.ScreenObject.GridDataColumns.Contains("RefNo")&&(e.ScreenObject.GridData[D].RefNo=t[0].InvDocDetailsID),e.ScreenObject.GridData[D].dcAlpha1=m.J0.ParseDate(t[0].CheckInDate).ToString(d.d.SessionManager.Preferences["Date Format"]),e.ScreenObject.GridData[D].dcAlpha1_Key=m.J0.ParseDate(t[0].CheckInDate),e.Celleditend(e.ScreenObject.GridData[D],"dcCCNID51",0),e.ScreenObject.GridData[D].dcAlpha2=m.J0.ParseDate(t[0].CheckInTime).ToString("HH:mm"),e.ScreenObject.GridData[D].dcAlpha2_Key=m.J0.ParseDate(t[0].CheckInTime),e.ScreenObject.GridData[D].dcAlpha3=m.J0.ParseDate(t[0].CheckOutTime).ToString("HH:mm"),e.ScreenObject.GridData[D].dcAlpha3_Key=m.J0.ParseDate(t[0].CheckOutTime),e.Celleditend(e.ScreenObject.GridData[D],"dcAlpha3",40067),e.ScreenObject._CCFields.length>0)for(let _=0;_<e.ScreenObject._CCFields.length;_++)"DCCCNID51"!=e.ScreenObject._CCFields[_].DBColumnName.toUpperCase()&&(e.ScreenObject.GridDataColumns.Contains(e.ScreenObject._CCFields[_].DBColumnName+"_Key")?e.ScreenObject.GridData[D][e.ScreenObject._CCFields[_].DBColumnName+"_Key"]=t[0][e.ScreenObject._CCFields[_].DBColumnName].toString():(e.ScreenObject._CCFields[_]instanceof Dt.y$||e.ScreenObject._CCFields[_]instanceof yt.G)&&(e.ScreenObject._CCFields[_].SelectedValue=parseInt(t[0][e.ScreenObject._CCFields[_].DBColumnName])));for(let _=0;_<e.ScreenObject.GridDataColumns.length;_++)e.ScreenObject.GridDataColumns[_].startsWith("dcCCNID")&&!e.ScreenObject.GridDataColumns[_].endsWith("_Key")&&!e.ScreenObject.GridDataColumns[_].endsWith("Code")&&"DCCCNID51"!=e.ScreenObject.GridDataColumns[_].toUpperCase()&&"DCCCNID73"!=e.ScreenObject.GridDataColumns[_].toUpperCase()&&(e.ScreenObject.GridData[D][e.ScreenObject.GridDataColumns[_]]="",e.ScreenObject.GridData[D][e.ScreenObject.GridDataColumns[_]+"_Key"]=t[0][e.ScreenObject.GridDataColumns[_]]);e.CalculateTotals(e.ScreenObject.GridData[D],!1),e.ScreenObject.GridDataObj.updateRow(e.ScreenObject.GridData[D]),e.ScreenObject.GridDataObj.RefreshGrid=!0}m.J0.IsEmptySpace(a)||(e.DisplayMessage=a,e.MessageVisibility=!0),e.UpdateFooter=!0,e.RefreshGrid=!0,d.d.page.addNewTab({title:e.DisplayName,component:vt.AddEditDocumentComponent,params:{obj:e}});var y=e.ScreenObject._StaticFields.find(A=>"CommonNarration"==A.DBColumnName);null!=y&&(y.SetFocus=!0)})}}}}}}else{let r=this.dtData.filter(h=>h.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);null!=r&&r.length>0&&nt.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(h=>{h.ScreenObject.GridData.Clear();let c=-1;for(let u=0;u<this.dgv.Table.length;u++)if((0,Q.yG0)(this.dgv.Table[u].Select)&&(t=this.dtData.filter(p=>p.InvDocDetailsID==this.dgv.Table[u].InvDocDetailsID.toString()&&p.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=t&&t.length>0)){if(c++,l=h.ScreenObject.GridDataObj.NewRow(),h.ScreenObject.GridDataObj.addRow(l),h.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(h.ScreenObject.GridData[c].dcCCNID51Code=t[0].EmpCode),h.ScreenObject.GridData[c].dcCCNID51_Key=t[0].EmpSeqNo,h.ScreenObject.GridData[c].dcCCNID51=t[0].EmpName,h.FillDefaultProd(h.ScreenObject.GridData[c],"dcCCNID51"),h.ScreenObject.GridDataColumns.Contains("RefNo")&&(h.ScreenObject.GridData[c].RefNo=t[0].InvDocDetailsID),h.ScreenObject.GridData[c].dcAlpha1=m.J0.ParseDate(t[0].CheckInDate).ToString(d.d.SessionManager.Preferences["Date Format"]),h.ScreenObject.GridData[c].dcAlpha1_Key=m.J0.ParseDate(t[0].CheckInDate),h.Celleditend(h.ScreenObject.GridData[c],"dcCCNID51",0),h.ScreenObject.GridData[c].dcAlpha2=m.J0.ParseDate(t[0].CheckInTime).ToString("HH:mm"),h.ScreenObject.GridData[c].dcAlpha2_Key=m.J0.ParseDate(t[0].CheckInTime),h.ScreenObject.GridData[c].dcAlpha3=m.J0.ParseDate(t[0].CheckOutTime).ToString("HH:mm"),h.ScreenObject.GridData[c].dcAlpha3_Key=m.J0.ParseDate(t[0].CheckOutTime),h.Celleditend(h.ScreenObject.GridData[c],"dcAlpha3",40067),h.ScreenObject._CCFields.length>0)for(let p=0;p<h.ScreenObject._CCFields.length;p++)"DCCCNID51"!=h.ScreenObject._CCFields[p].DBColumnName.toUpperCase()&&(h.ScreenObject.GridDataColumns.Contains(h.ScreenObject._CCFields[p].DBColumnName+"_Key")?h.ScreenObject.GridData[c][h.ScreenObject._CCFields[p].DBColumnName+"_Key"]=t[0][h.ScreenObject._CCFields[p].DBColumnName].toString():(h.ScreenObject._CCFields[p]instanceof Dt.y$||h.ScreenObject._CCFields[p]instanceof yt.G)&&(h.ScreenObject._CCFields[p].SelectedValue=parseInt(t[0][h.ScreenObject._CCFields[p].DBColumnName])));for(let p=0;p<h.ScreenObject.GridDataColumns.length;p++)h.ScreenObject.GridDataColumns[p].startsWith("dcCCNID")&&!h.ScreenObject.GridDataColumns[p].endsWith("_Key")&&"DCCCNID51"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&"DCCCNID73"!=h.ScreenObject.GridDataColumns[p].toUpperCase()&&(h.ScreenObject.GridData[c][h.ScreenObject.GridDataColumns[p]+"_Key"]=t[0][h.ScreenObject.GridDataColumns[p]]);h.CalculateTotals(h.ScreenObject.GridData[c],!1),h.ScreenObject.GridDataObj.updateRow(h.ScreenObject.GridData[c]),h.ScreenObject.GridDataObj.RefreshGrid=!0}m.J0.IsEmptySpace(a)||(h.DisplayMessage=a,h.MessageVisibility=!0),h.UpdateFooter=!0,h.RefreshGrid=!0,d.d.page.addNewTab({title:h.DisplayName,component:vt.AddEditDocumentComponent,params:{obj:h}});var g=h.ScreenObject._StaticFields.find(u=>"CommonNarration"==u.DBColumnName);g&&(g.SetFocus=!0)})}}}GetGroupByFilterEmployees(a){let l="  AND EmpSeqNo IN ("+a+")",t=[];return t.push(Date.Today().ToString("dd MMM yyyy")),t.push(l),t.push(0),t.push(d.d.SessionManager.RoleID),t.push(d.d.SessionManager.UserID),t.push(d.d.SessionManager.LanguageID),d.d.empService.GetData(t,"spPAY_GetEmpMasterCCDetails").Tables[0]}ValidatePosting(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");{let a=0;for(let l=0;l<this.dgv.Table.length;l++)(0,Q.yG0)(this.dgv.Table[l].Select)&&a++;if(0==a)return this.DisplayMessage="Select atleast one Document to post",!1;for(let l=0;l<this.dgv.Table.length;l++)if((0,Q.yG0)(this.dgv.Table[l].Select)&&(null==this.dgv.Table[l].CheckInTime||null==this.dgv.Table[l].CheckInTime||""==this.dgv.Table[l].CheckInTime.toString()||null==this.dgv.Table[l].CheckOutTime||null==this.dgv.Table[l].CheckOutTime||""==this.dgv.Table[l].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(l+1).toString(),!1}return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(a){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+a.stack),!1}}btnFilter_Click(){Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new $e.t("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?d.d.page.ShowDialog(this.objEmpFilter,pt.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}btnFilter_Click_CallBack(){if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";for(let r=0;r<this.objEmpFilter.CostCenterFilters.length;r++){let h=this.objEmpFilter.CostCenterFilters[r];if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(c=>c.Id==l&&c.IsGroup))if(o+=" AND ",Ct.IPrefetchFilter.IsGroupTree(h)){let c="";for(let g=0;g<h.SelectedNodes.length;g++)(null==h.SelectedNodes[g].Parent||!h.SelectedNodes[g].Parent.IsSelected)&&(c.length>0&&(c+=","),c+=h.SelectedNodes[g].Id);0==c.length&&(c+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from "+et.A.GetTagTableName(h.CostCenterID)+" T with(nolock),"+et.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=c.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let c=0;c<h.SelectedNodes.length;c++)c>0&&(o+=","),o+=h.SelectedNodes[c].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}this.FilterEmployees()}}FilterEmployees(){this.sEmpSeqNosOnGrid="",this.objEmpFilter.rBtnPostAttDocs?this.iPostDocType=89:this.objEmpFilter.rBtnPostTimeSheetDocs?this.iPostDocType=90:this.objEmpFilter.rBtnPostOnDutyDocs&&(this.iPostDocType=103),this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");let l=[];l.push(Date.Today().ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID);let t=d.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails"),i="";if(this.dgv.Clear(),null!=t&&t.Tables.length>0&&t.Tables[0].length>0){for(let r=0;r<t.Tables[0].length;r++)i.Trim().length>0&&(i+=","),i+=t.Tables[0][r].EmpSeqNo.toString();var a;let o="";for(let r=0;r<this.objEmpFilter.DocumentsToLoad.Items.length;r++)1==this.objEmpFilter.DocumentsToLoad.Items[r].IsChecked&&(o.Trim().length>0&&(o+=","),o+=this.objEmpFilter.DocumentsToLoad.Items[r].Value);if(a=d.d.common.GetDataSet3("PAY117",o,i,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy")),this.dtData=a.Tables[0],!(null!=a&&a.Tables.length>0&&a.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");{let r;for(let h=0;h<a.Tables[0].length;h++){r=this.dgv.NewRow(),r.Select=!1,r.SNo=(h+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=a.Tables[0][h].EmpSeqNo.toString(),r.EmpSeqNo=a.Tables[0][h].EmpSeqNo,r.EmpCode=a.Tables[0][h].EmpCode,r.EmpName=a.Tables[0][h].EmpName,r.InvDocDetailsID=a.Tables[0][h].InvDocDetailsID,r.VoucherNo=a.Tables[0][h].VoucherNo,r.CheckInDate=a.Tables[0][h].CheckInDate,m.J0.IsEmptySpace(a.Tables[0][h].CheckInTime)||(r.CheckInTime=m.J0.ParseDate(a.Tables[0][h].CheckInTime).ToString("HH:mm")),m.J0.IsEmptySpace(a.Tables[0][h].CheckOutDate)?r.Row_Background="#F77B7E":r.CheckOutDate=a.Tables[0][h].CheckOutDate,m.J0.IsEmptySpace(a.Tables[0][h].CheckOutTime)||(r.CheckOutTime=m.J0.ParseDate(a.Tables[0][h].CheckOutTime).ToString("HH:mm")),r.TotalTime=m.J0.IsEmptySpace(a.Tables[0][h].TotalTime)?"0.00":a.Tables[0][h].TotalTime,0==parseFloat(r.TotalTime.toString().Replace(":","."))&&(r.Row_Background="#F77B7E");for(let c=0;c<this.dgv.TableColumns.length;c++)this.dgv.TableColumns[c].startsWith("dcCCNID")&&!this.dgv.TableColumns[c].endsWith("_Key")&&(r[this.dgv.TableColumns[c]+"_Key"]=a.Tables[0][h][this.dgv.TableColumns[c]]);this.dgv.addRow(r)}this.dgv.refreshDataView(),this.dgv.RefreshGrid=!0,this.dgv.Update()}}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+l.stack)}}}var Vt=G(5661);const la=()=>({standalone:!0});let ia=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.obj=this.params.obj}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-payslip"]],decls:71,vars:28,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-filter"],[1,"main_div"],[2,"padding","11px"],[1,"row","form-row"],[1,"form-group","col-md-3","col-sm-6","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"align-content","center"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n        "),s.j41(2,"div",1),s.EFF(3,"\n            "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n            "),s.j41(7,"div",3),s.EFF(8,"\n                "),s.j41(9,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Preview")}),s.nrm(10,"i",5),s.EFF(11),s.nI1(12,"translate"),s.k0s(),s.EFF(13," \n                "),s.j41(14,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Print")}),s.nrm(15,"i",6),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18," \n                "),s.j41(19,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(20,"i",7),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n                "),s.j41(24,"span",4),s.bIt("click",function(){return i.obj.Button_Click("EMail")}),s.nrm(25,"i",8),s.EFF(26),s.nI1(27,"translate"),s.k0s(),s.EFF(28,"\n                "),s.j41(29,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(30,"i",9),s.EFF(31),s.nI1(32,"translate"),s.k0s(),s.EFF(33,"\n            "),s.k0s(),s.EFF(34,"\n        "),s.k0s(),s.EFF(35,"\n"),s.j41(36,"div",10),s.EFF(37,"\n    "),s.j41(38,"div",11),s.EFF(39,"          \n        "),s.j41(40,"div",12),s.EFF(41,"\n            "),s.j41(42,"div",13),s.EFF(43,"\n                "),s.eu8(44,14),s.EFF(45,"\n            "),s.k0s(),s.EFF(46,"\n            "),s.j41(47,"div",13),s.EFF(48,"\n                "),s.eu8(49,14),s.EFF(50,"\n            "),s.k0s(),s.EFF(51,"\n            "),s.j41(52,"div",13),s.EFF(53,"\n                "),s.eu8(54,14),s.EFF(55,"\n            "),s.k0s(),s.EFF(56,"\n                "),s.j41(57,"div",15),s.EFF(58,"\n                  "),s.j41(59,"input",16),s.mxI("ngModelChange",function(r){return s.DH7(i.obj.ExportSeperate,r)||(i.obj.ExportSeperate=r),r}),s.k0s(),s.EFF(60,"\n                  "),s.j41(61,"label",17),s.bIt("click",function(){return i.obj.ExportSeperate=!i.obj.ExportSeperate}),s.EFF(62),s.nI1(63,"translate"),s.k0s(),s.EFF(64,"\n              "),s.k0s(),s.EFF(65,"              \n    "),s.k0s(),s.EFF(66,"\n\n    "),s.j41(67,"div",18),s.EFF(68,"\n        \n    "),s.k0s(),s.EFF(69,"\n"),s.k0s(),s.EFF(70,"\n "),s.k0s()()),2&t&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(6),s.JRh(s.bMT(12,15,"Preview")),s.R7$(5),s.JRh(s.bMT(17,17,"Print")),s.R7$(5),s.JRh(s.bMT(22,19,"Export")),s.R7$(5),s.JRh(s.bMT(27,21,"EMail")),s.R7$(5),s.JRh(s.bMT(32,23,"Filter")),s.R7$(13),s.Y8G("obj",i.obj.dtpPayrollMonth)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbPayslipLayout)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbSortOn)("group",i.form),s.R7$(5),s.R50("ngModel",i.obj.ExportSeperate),s.Y8G("ngModelOptions",s.lJ4(27,la)),s.R7$(3),s.JRh(s.bMT(63,25,"Export Each Employee Seperately")))},dependencies:[Ye._,L.Zm,L.BC,L.vS,Xe.D9],encapsulation:2})}return V})();var na=G(54004),ft=G(70234),wt=G(54683),Et=G(9309);class Gt{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}var xe=G(31820),ct=G(95005),oa=G(3436),ra=G(93426),_t=G(78906);class kt extends je.g{get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}constructor(){super(),this.CostCenterID=0,this.TypeID=0,this.AttachmentVisibility=!1,this.Employee=new yt.G(0),this.AttachVisiblility=!1,this.PayrollTaxFields=new Array,this.dtPayrollTaxCmptsObj=new re.vv,this.Savereturnvalue=-1,this.oRadio1=null,this.dsTaxComponents=null,this.CostCenterID=262,this.objEmp=new Gt,this.ScreenObject=new _t.a(0,0),this.ScreenObject.Data=[],this.ViewAttachments=new Et.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.AttachVisiblility=d.d.SessionManager.IsActionAssigned(262,"Attach"),this.EmpYear=new n.y$(0),this.EmpYear.LblWidth="60",this.EmpYear.Label=d.d.GetResource("Doc_Year"),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let a=2e3;a<2100;a++){let l=n._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=m.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("yyyy"),this.EmpRegime=new n.y$(0),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("New","New")),this.EmpRegime.Label="Regime Opted For",this.lFinancialDate=this.GetFinancialYear(),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.LblWidth="80",this.EmpRegime.LblWidth="80",this.Employee.Label=d.d.GetResource("Pay_Employee"),this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=new Array,this.dtPayrollTaxCmptsObj.Height=110,this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),this.BindHRAGridColumns()}BindHRAGridColumns(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();let a=new J.O7;a.Header="FromDate",a.DisplayMember="ITFromDate",a.ValueMember="ITFromDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="ToDate",a.DisplayMember="ITToDate",a.ValueMember="ITToDate_Key",a.DataType="DATE",a.ReadOnly=!1,a.Width=85,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=75,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="Metro",a.ValueBinding="Metro",a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value",a.Width=60;let l=[];l.push(n._p.ComboBoxItems_2("Yes","Yes")),l.push(n._p.ComboBoxItems_2("No","No")),a.ComboData=l,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="HRAAddress",a.DisplayMember="HRAAddress",a.DataType="TextArea",a.ReadOnly=!1,a.Width=200,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="Name of Landlord",a.DisplayMember="NameofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=153,this.PayrollColumnSourceTaxComponents.push(a),a=new J.O7,a.Header="Pan of Landlord",a.DisplayMember="PanofLandlord",a.DataType="TextBlock",a.ReadOnly=!1,a.Width=150,this.PayrollColumnSourceTaxComponents.push(a),this.dtPayrollTaxCmptsObj.RefreshGridView()}Employee_SelectedValueChanged(a){""!=this.EmpYear.SelectedValue.toString()?(this.EmpRegime.SelectedValue="",this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new Et.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}OnYearSelected(a){this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.lFinancialDate=this.GetFinancialYear(),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth,1),t=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(t.getMonth(),!1)+" "+t.getFullYear(),a}OnComponentSelection(a){let l="",t="";this.PayrollTaxFields.forEach(i=>{if(i instanceof ct.mn){let o=i;if(t=o.Currency.SelectedValue,null!=t){let r=this.dsTaxComponents.Tables[0].filter(h=>"ComboTextValue"==h.ControlType&&h.NodeID==parseInt(t));for(let h=0;h<r.length;h++){let c=r[h];"COMBOTEXTVALUE"===(l=m.J0.String(c.ControlType),l)&&(o.Label=m.J0.String(c.AmountLimit))}}}})}GenerateTaxComponentFields(a,l,t){try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");let o,r,i=0,h=null,c=null;if(null===l&&(l=0),0!=a&&0!=l&&(h=d.d.common.GetDataSet3("PAY071",a.toString(),l.toString())),null!=h&&h.Tables.length>0&&h.Tables[0].length>0&&!m.J0.IsEmpty(h.Tables[0][0].SEQNO)&&(c=d.d.common.GetDataSet("PAY072",h.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=d.d.empService.GetIncomeTaxComponents(0,a,l),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!m.J0.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());let g=this.dsTaxComponents.Tables[0];if(g.forEach(u=>{switch(o=m.J0.String(u.CONTROLTYPE).toUpperCase(),o){case"LABEL":r=new oa.D,r.Label=m.J0.String(u.NAME),t.push(r),r.tabname="LABEL";break;case"TEXTBOX":this.LabelLimitAmount=m.J0.String(u.AMOUNTLIMIT),this.oText=new xe.Dw(parseInt(u.NODEID)),this.oText.Label=m.J0.String(u.NAME),this.oText.KeyTip=this.LabelLimitAmount,this.oText.Text=u.AMOUNT.toString(),this.oText.LblWidth="400",this.oText.tabname="TEXTBOX",t.push(this.oText);break;case"COMBOTEXTVALUE":let e=g.filter(D=>"ComboTextValue"==D.CONTROLTYPE&&D.GROUPID==parseInt(u.GROUPID));var p=t.find(D=>D instanceof ct.mn&&D.DBColumnID==parseInt(u.GROUPID));null==p?(this.oRadio1=new ct.mn,this.oRadio1.DBColumnID=parseInt(u.GROUPID)):this.oRadio1=p,this.oRadio1.tabname="COMBOTEXTVALUE",this.oRadio1.LblWidth="1",(0==i||i!=parseInt(u.GROUPID))&&e.length>0&&(e.forEach(D=>{this.oRadio1.Currency.Items.push(n._p.ComboBoxItems_2(m.J0.String(D.NAME).TrimStart(" "),m.J0.String(D.NODEID)))}),this.oRadio1.Currency.SelectedValue=this.oRadio1.Currency.Items[0].Value,this.oRadio1.Currency.SelectionChangedCommand.Subscribe(this,"OnComponentSelection"),t.push(this.oRadio1)),parseInt(u.SELECTEDNODE)>0?(this.oRadio1.Currency.SelectedValue=m.J0.String(u.SELECTEDNODE),this.oRadio1.ExchangeRate.Text=u.AMOUNT.toString(),this.oRadio1.Label=u.SELECTEDAMTLIMIT.toString()):""==this.oRadio1.ExchangeRate.Text&&(this.oRadio1.ExchangeRate.Text=u.AMOUNT.toString()),null==this.oRadio1.Label&&(this.LabelLimitAmount=m.J0.String(u.AMOUNTLIMIT),this.oRadio1.Label=this.LabelLimitAmount),(0==i||i!=parseInt(u.GROUPID))&&(i=parseInt(u.GROUPID))}}),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>2&&this.dsTaxComponents.Tables[2].length>0&&this.dsTaxComponents.Columns[2].Contains("RegimeType")&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&""!=this.dsTaxComponents.Tables[2][0].RegimeType.toString()&&(this.EmpRegime.SelectedValue=this.dsTaxComponents.Tables[2][0].RegimeType.toString()),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0){let p;for(let e=0;e<this.dsTaxComponents.Tables[1].length;e++)p=this.dtPayrollTaxCmptsObj.NewRow(),p.ITFromDate=m.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("MMM/yyyy"),p.ITFromDate_Key=m.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("dd-MMM-yyyy"),p.ITToDate=m.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("MMM/yyyy"),p.ITToDate_Key=m.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("dd-MMM-yyyy"),p.Amount=this.dsTaxComponents.Tables[1][e].Amount.toString(),p.Metro=this.dsTaxComponents.Tables[1][e].Metro.toString().TrimEnd(),p.HRAAddress=this.dsTaxComponents.Tables[1][e].Address.toString(),p.NameofLandlord=this.dsTaxComponents.Tables[1][e].Landlord.toString(),p.PanofLandlord=this.dsTaxComponents.Tables[1][e].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(p)}if(null!=c&&c.Tables.length>0&&c.Tables[0].length>0){let u=c.Tables[0];if(null!=u&&u.length>0)for(let p=0;p<u.length;p++){let e=new wt.AddAttachmentViewModel;e.AddAttachmentViewModel_2(this),e.AttachmentID=parseInt(u[p].FileID),e.ActualFileName=u[p].ActualFileName.toString(),e.FileExtension=u[p].FileExtension.toString(),e.FileDescription=u[p].FileDescription.toString(),e.FilePath=m.J0.GetPath(u[p].GUID+"."+u[p].FileExtension),e.RelativeFileName=u[p].RelativeFileName.toString(),e.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(e)}}else this.BindEmptyRows(2)}catch(i){Logger.ErrorLog("Error : "+i),this.DisplayMessage=i.message}}OnSaveITDeclarations(a){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");let l="";if(l=this.DataValid(),""!=l.toString())return void(this.DisplayMessage=l);this.SaveEmpIncomeTax(),this.OnClear(a)}catch(l){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+l)}}DataValid(){let l,t,a="",i=0,o=0;0==this.Employee.SelectedValue&&(a+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(a+="Please select the Year \r\n");let r=d.d.common.GetDataTable("PAY111",this.EmpYear.SelectedValue.ToString());null!=r&&r.length>0&&(m.J0.IsEmpty(r[0].dcAlpha9)||m.J0.ParseDate(r[0].dcAlpha9)<Date.Today()&&(a+="Cannot save the record,CutOffDate Exceeded \r\n")),this.PayrollTaxFields.forEach(h=>{if(h instanceof xe.Dw){let c=h;i=m.J0.Double(c.KeyTip),o=m.J0.Double(c.Text),i>0&&o>i&&(a=a+"Amount should be less than Limit Amount for '"+c.Label.toString().Trim()+"'\r\n")}if(h instanceof ct.mn){let c=h;i=m.J0.Double(c.Label),o=m.J0.Double(c.ExchangeRate.Text),i>0&&o>i&&(a=a+"Amount should be less than Limit Amount for '"+c.Currency.Text.toString().Trim()+"'\r\n")}});for(let h=0;h<this.dtPayrollTaxCmpts.length;h++)m.J0.IsEmpty(this.dtPayrollTaxCmpts[h].ITFromDate_Key)||(m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))>m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))?a=a+"Fromdate should be less than todate at row no ('"+h.toString()+"')\r\n":m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"))<m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy"))&&(a=a+"Todate should be greater than fromdate at row no ('"+h.toString()+"')\r\n"));for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=m.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key);h++){l=m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),t=m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy"));for(let c=0;c<this.dtPayrollTaxCmpts.length;c++)if(h!=c){if(""==m.J0.String(this.dtPayrollTaxCmpts[c].ITFromDate_Key))break;if(+l.Date>=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+l.Date<=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+t.Date>=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+t.Date<=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+l.Date>=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()&&+t.Date<=+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()||+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITFromDate_Key).OnlyDate()>=+l.Date&&+m.J0.ParseDate(this.dtPayrollTaxCmpts[c].ITToDate_Key).OnlyDate()<=+t.Date){a=a+"Invalid dates entered at row no ('"+c.toString()+"')\r\n";break}}}for(let h=0;h<this.dtPayrollTaxCmpts.length&&""!=m.J0.String(this.dtPayrollTaxCmpts[h].ITFromDate_Key)&&""!=m.J0.String(this.dtPayrollTaxCmpts[h].ITToDate_Key);h++)if(l=m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITFromDate_Key).ToString("MMM/yyyy")),t=m.J0.ParseDate(m.J0.ParseDate(this.dtPayrollTaxCmpts[h].ITToDate_Key).ToString("MMM/yyyy")),""!=this.dtPayrollTaxCmpts[h].Amount.toString()){o=parseFloat(this.dtPayrollTaxCmpts[h].Amount);let c=12*(t.getFullYear()-l.getFullYear())+t.getMonth()-l.getMonth()+1;if(o/c>8e3){if(""==this.dtPayrollTaxCmpts[h].NameofLandlord.toString()){a=a+"Mandatory NameofLandlord row no ('"+(h+1).toString()+"')\r\n";break}if(""==this.dtPayrollTaxCmpts[h].PanofLandlord.toString()){a=a+"Mandatory PanofLandlord row no ('"+(h+1).toString()+"')\r\n";break}}}return a}SaveEmpIncomeTax(){Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{let l="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),this.objEmp.Regime=this.EmpRegime.SelectedValue,l+="<Rows>",this.PayrollTaxFields.forEach(o=>{o instanceof xe.Dw?(l+='<row ComponentID="'+o.DBColumnID,l+='" AmountLimit="'+o.KeyTip,l+=null!=o.Text?'" Amount="'+parseFloat(o.Text):'" Amount="0',l+='"/>'):o instanceof ct.mn&&(l+='<row ComponentID="'+o.Currency.SelectedValue,l+='" AmountLimit="'+o.Label,l+=null!=o.ExchangeRate.Text?'" Amount="'+parseFloat(o.ExchangeRate.Text):'" Amount="0',l+='"/>')}),l+="</Rows>";let t="";t+="<HRAINFO>";for(let o=0;o<this.dtPayrollTaxCmpts.length;o++)(""!=m.J0.String(this.dtPayrollTaxCmpts[o].ITFromDate_Key)||""!=m.J0.String(this.dtPayrollTaxCmpts[o].ITToDate_Key))&&(t+='<row FromDt="'+m.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITFromDate_Key).ToString("dd-MMM-yyyy"),t+='" ToDt="'+m.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[o].Amount.toString()?t+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[o].Amount):t+='" Amt="0',t+='" Metro="'+this.dtPayrollTaxCmpts[o].Metro,t+='" Address="'+this.dtPayrollTaxCmpts[o].HRAAddress,t+='" Landlord="'+this.dtPayrollTaxCmpts[o].NameofLandlord,t+='" LandlordPAN="'+this.dtPayrollTaxCmpts[o].PanofLandlord,t+='"/>');t+="</HRAINFO>";let i=this.ViewAttachments.GetXML();d.d.empService.SaveEmpTaxDeclarations(l.toString(),t.toString(),i.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode,this.objEmp.Regime).subscribe(o=>{this.DisplayMessage=o.Message,this.Savereturnvalue=o.RetValue})}catch(a){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+a.stack)}}OnClear(a){try{this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new Et.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(l){Logger.ErrorLog("Error : "+l),this.DisplayMessage=l.message}}BindEmptyRows(a){this.dtPayrollTaxCmptsObj.addEmptyRows(a)}FilterEmployees(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");let l,t,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=new Date(d.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),d.d.SessionManager.IsRptManagerUser&&d.d.SessionManager.IsActionAssigned(262,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+d.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+a.stack)}}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let a="";null!=this.Attachment&&(a=this.Attachment.ColID);let l=null;null!=this.Attachment&&(l=this.Attachment.RowID),this.Attachment=new wt.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==a?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=a,this.Attachment.RowID=l),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnClickAttachment(a){this.AttachmentVisibility=!0,d.d.page.ShowDialog(this,ra.l,{Title:"Attachment"})}}function da(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.OnClickAttachment())}),s.EFF(1,"\n        "),s.nrm(2,"i",22),s.EFF(3),s.nI1(4,"translate"),s.k0s()}2&V&&(s.R7$(3),s.JRh(s.bMT(4,1,"Attachments")))}function ha(V,a){if(1&V&&(s.j41(0,"div",26),s.EFF(1),s.k0s()),2&V){const l=s.XpG().$implicit;s.R7$(),s.JRh(l.Label)}}function Y(V,a){if(1&V&&s.nrm(0,"input",31),2&V){const l=s.XpG(2).$implicit,t=s.XpG();s.Y8G("placeholder",t.lblwatermark)("ngModel",l.Text)}}function ce(V,a){if(1&V){const l=s.RV6();s.j41(0,"input",32),s.mxI("ngModelChange",function(i){s.eBV(l);const o=s.XpG(2).$implicit;return s.DH7(o.Text,i)||(o.Text=i),s.Njj(i)}),s.k0s()}if(2&V){const l=s.XpG(2).$implicit;s.Y8G("tabindex",l.IsTabStop?null:-1)("disabled",!l.Enable||l.IsReadOnly),s.R50("ngModel",l.Text)}}function C(V,a){if(1&V&&(s.qex(0),s.EFF(1,"\n                "),s.j41(2,"div"),s.EFF(3,"\n                  "),s.j41(4,"label",27),s.EFF(5),s.k0s(),s.EFF(6," \n                  "),s.j41(7,"label",28),s.EFF(8),s.k0s(),s.EFF(9," \n                  "),s.DNE(10,Y,1,2,"input",29),s.EFF(11,"\n                  "),s.DNE(12,ce,1,3,"input",30),s.EFF(13,"\n                     "),s.EFF(14,"\n                "),s.k0s(),s.EFF(15,"\n              "),s.EFF(16,"\n            "),s.bVm()),2&V){const l=s.XpG().$implicit;s.R7$(2),s.AVh("c-flex",l.LblWidth),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("  ",l.Label," "),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("    ",l.KeyTip," "),s.R7$(2),s.Y8G("ngIf",!l.ShowControl),s.R7$(2),s.Y8G("ngIf",l.ShowControl)}}function T(V,a){if(1&V&&(s.qex(0),s.EFF(1,"\n              "),s.eu8(2,13),s.EFF(3,"\n            "),s.bVm()),2&V){const l=s.XpG().$implicit,t=s.XpG();s.R7$(2),s.Y8G("obj",l)("group",t.form)}}function S(V,a){if(1&V&&(s.qex(0),s.EFF(1,"\n          "),s.j41(2,"div",23),s.EFF(3,"\n            "),s.DNE(4,ha,2,1,"div",24),s.EFF(5,"\n            "),s.DNE(6,C,17,8,"ng-container",25),s.EFF(7,"\n            "),s.DNE(8,T,4,2,"ng-container",25),s.EFF(9,"\n          "),s.k0s(),s.EFF(10,"\n        "),s.bVm()),2&V){const l=a.$implicit;s.R7$(2),s.Y8G("ngSwitch",!0),s.R7$(2),s.Y8G("ngSwitchCase","LABEL"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","TEXTBOX"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","COMBOTEXTVALUE"==l.tabname)}}let P=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.obj=this.params.obj,console.log(this.obj)}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-income-tax-declaration"]],decls:77,vars:18,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px"],[1,"row"],[1,"form-group","col-xl-3","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label"],[1,"form-group","col-xl-6","col-md-4","col-sm-12","col-xs-12","PACTControl"],[2,"height","calc(100% - 190px)","overflow","auto"],[1,"PACTHeaderFields","row","form-row"],[4,"ngFor","ngForOf"],[1,"documentgrid",2,"height","140px"],[1,"page-subtitle",2,"padding","0","display","block","height","30px","font-size","16px"],[2,"height","90px"],[1,"fa-light","fa-paperclip"],[1,"form-group","row","PACTControl",3,"ngSwitch"],["class","input_cntrl_label panel-heading","style","font-weight: bold; background-color:var(--gridheaderbg-color); padding: 4px;",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"input_cntrl_label","panel-heading",2,"font-weight","bold","background-color","var(--gridheaderbg-color)","padding","4px"],[1,"input_cntrl_label",2,"width","70%"],[1,"input_cntrl_label",2,"width","10%","font-weight","bold"],["disabled","","class","input_cntrl disablecntrl","style","text-align: right;width: 20%;",3,"placeholder","ngModel",4,"ngIf"],["class","input_cntrl","style","width: 20%;text-align: right;",3,"tabindex","disabled","ngModel","ngModelChange",4,"ngIf"],["disabled","",1,"input_cntrl","disablecntrl",2,"text-align","right","width","20%",3,"placeholder","ngModel"],[1,"input_cntrl",2,"width","20%","text-align","right",3,"ngModelChange","tabindex","disabled","ngModel"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.EFF(14,"\n      "),s.j41(15,"span",6),s.bIt("click",function(){return i.obj.OnSaveITDeclarations()}),s.EFF(16,"\n        "),s.nrm(17,"i",7),s.EFF(18),s.nI1(19,"translate"),s.k0s(),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.obj.OnClear("Clear")}),s.EFF(22,"\n        "),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n      "),s.DNE(27,da,5,3,"span",9),s.EFF(28,"\n  "),s.k0s(),s.EFF(29,"\n  "),s.k0s(),s.EFF(30,"\n  "),s.j41(31,"div",10),s.EFF(32,"\n    "),s.j41(33,"div",11),s.EFF(34,"\n      "),s.j41(35,"div",12),s.EFF(36,"\n        "),s.eu8(37,13),s.EFF(38,"\n        "),s.j41(39,"label",14),s.EFF(40),s.k0s(),s.EFF(41,"\n      "),s.k0s(),s.EFF(42,"\n      "),s.j41(43,"div",15),s.EFF(44,"\n        "),s.eu8(45,13),s.EFF(46,"\n      "),s.k0s(),s.EFF(47,"\n      "),s.j41(48,"div",12),s.EFF(49,"\n        "),s.eu8(50,13),s.EFF(51,"\n      "),s.k0s(),s.EFF(52,"\n    "),s.k0s(),s.EFF(53,"\n    "),s.j41(54,"div",16),s.EFF(55,"\n      "),s.j41(56,"div",17),s.EFF(57,"\n        "),s.DNE(58,S,11,4,"ng-container",18),s.EFF(59,"\n      "),s.k0s(),s.EFF(60,"\n    "),s.k0s(),s.EFF(61,"\n    "),s.j41(62,"div",19),s.EFF(63,"\n      "),s.j41(64,"span",20),s.EFF(65,"HRA Information"),s.k0s(),s.EFF(66,"\n      "),s.j41(67,"div",21),s.EFF(68,"\n        "),s.eu8(69,13),s.EFF(70,"\n      "),s.k0s(),s.EFF(71,"\n    "),s.k0s(),s.EFF(72,"\n  "),s.k0s(),s.EFF(73,"\n  "),s.k0s(),s.EFF(74,"\n"),s.k0s(),s.EFF(75,"\n\n"),s.EFF(76,"\n")),2&t&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(9),s.JRh(s.bMT(19,14,"Save")),s.R7$(6),s.JRh(s.bMT(25,16,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.AttachVisiblility),s.R7$(10),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(3),s.JRh(i.obj.lFinancialDate),s.R7$(5),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(8),s.Y8G("ngForOf",i.obj.PayrollTaxFields),s.R7$(11),s.Y8G("obj",i.obj.dtPayrollTaxCmptsObj)("group",i.form))},dependencies:[fe.Sq,fe.bT,fe.ux,fe.e1,Ye._,L.me,L.BC,L.vS,Xe.D9],encapsulation:2})}return V})();var E=G(24028);class w extends je.g{constructor(a){super(),this.dtpFromDate=new E.P6(0),this.dtpToDate=new E.P6(0),this.lTotalTaxAmount="",this.lTDSPaidAmount="",this.lTDSAmount="",this.ButtonClick=new Mt.Yk,this.iComponentID=0,Logger.InfoLog("TDSPostingViewModel::Entering TDSPostingViewModel()"),this.DisplayMessage="",this.Parent=a[0],this.lTotalTaxAmount=a[1].toString(),this.lTDSPaidAmount=a[2].toString(),this.lTDSAmount=a[3].toString(),this.iComponentID=parseInt(a[4]),this.ButtonClick.Subscribe(this,"Button_Click"),this.LoadGrid(),this.dtpFromDate.Label="From Date",this.dtpFromDate.LblWidth="80",this.dtpFromDate.Date=new Date(parseInt(this.Parent.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),this.dtpToDate.Label="To Date",this.dtpToDate.LblWidth="80",this.dtpToDate.Date=this.dtpFromDate.Date.AddYears(1).AddMonths(-1),this.Generate_Click(0),Logger.InfoLog("TDSPostingViewModel::Exiting TDSPostingViewModel()")}LoadGrid(){this.dgv=new re.vv,this.dgv.Width="550",this.dgv.CanUserDeleteRows=!1,this.dgv.CanUserAddRows=!1,this.dgv.OnCellEditEnding.Subscribe(this,"dgv_EndEdit"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("Month"),this.dgv.TableColumns.push("Amount");let a=new J.O7;this.dgv.Columns=[],a=new J.O7,a.Header="#",a.DisplayMember="SNo",a.DataType="TextBlock",a.Width=40,a.ReadOnly=!0,this.dgv.Columns.push(a),a=new J.O7,a.Header="Month",a.DisplayMember="Month",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!0,a.TextAlign="Center",this.dgv.Columns.push(a),a=new J.O7,a.Header="Amount",a.DisplayMember="Amount",a.DataType="TextBlock",a.Width=180,a.ReadOnly=!1,a.TextAlign="FLOAT",this.dgv.Columns.push(a),this.dgv.Columns[2].footer="0.00",this.dgv.UpdateFooter()}Button_Click(a){Logger.InfoLog("TDSPostingViewModel::Entering Button_Click"),"Post"==a.toString()?this.Post_Click():"Cancel"==a.toString()?d.d.page.HideDialog(this.PopUpGUID):"Generate"==a.toString()&&this.Generate_Click(1),Logger.InfoLog("TDSPostingViewModel::Exiting Button_Click")}Generate_Click(a){this.dgv.Clear();let l=new Date(parseInt(this.Parent.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=l.AddYears(1).AddMonths(-1);if(this.dtpFromDate.Date<l||this.dtpFromDate.Date>t)return this.DisplayMessage="From Date should be in Between Finacial Year",void(this.MessageVisibility=!0);if(this.dtpToDate.Date<l||this.dtpToDate.Date>t)return this.DisplayMessage="To Date should be in Between Finacial Year",void(this.MessageVisibility=!0);let i=d.d.common.GetDataSet3("PAY122",this.Parent.Employee.SelectedValue,this.dtpFromDate.Date.ToString("dd MMM yyyy"),this.dtpToDate.Date.ToString("dd MMM yyyy"));if(0==a){if(null!=i&&i.length>0){let u=i.Compute("max","PayrollDate");m.J0.IsEmpty(u)||(this.dtpFromDate.Date=new Date(u))}}else if(1==a&&null!=i&&i.length>0)return this.DisplayMessage="Payroll Already Processed For the Month - "+new Date(i.Rows[0].PayrollDate).ToString("dd MMM yyyy"),void(this.MessageVisibility=!0);let o=null,r=0,h=0,c=0,g=this.dtpFromDate.Date;for(;g<=this.dtpToDate.Date;)r+=1,g=g.AddMonths(1);for(h=parseFloat(this.lTDSAmount)/r,h=parseFloat(h.ToString("0.00")),g=this.dtpFromDate.Date;g<=this.dtpToDate.Date;)o=this.dgv.NewRow(),o.SNo=this.dgv.Table.length+1,o.Month=g.ToString("dd MMM yyyy"),o.Amount=g.ToString("dd MMM yyyy")==this.dtpToDate.Date.ToString("dd MMM yyyy")?parseFloat(this.lTDSAmount)-c:h,this.dgv.addRow(o),c+=parseFloat(o.Amount),g=g.AddMonths(1);this.dgv.Columns[2].footer=c.ToString("0.00"),this.dgv.UpdateFooter()}Post_Click(){try{if(Logger.InfoLog("TDSPostingViewModel::Entering Post_Click()"),0==this.dgv.Table.length)return this.DisplayMessage="No Data to Post",void(this.MessageVisibility=!0);if(this.ValidatePosting()){let r,a="",l=0,t="0",i="0",o=d.d.common.GetScreenInfo(40068);r=o.Tables[0].filter(p=>"CreditAccount"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(t=r[0].UserDefaultValue.toString()),r=o.Tables[0].filter(p=>"DebitAccount"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(i=r[0].UserDefaultValue.toString()),r=o.Tables[0].filter(p=>"ProductID"==p.SysColumnName),null!=r&&r.length>0&&null!=r[0].UserDefaultValue&&""!=r[0].UserDefaultValue.toString().Trim()&&(l=parseInt(r[0].UserDefaultValue));let h=d.d.common.GetDataSet3("PAY123",this.Parent.Employee.SelectedValue,this.iComponentID.ToString(),this.iComponentID.ToString()),c="",g="",u=0;for(let p=0;p<this.dgv.Table.length;p++)if(c="",u=0,null!=this.dgv.Table[p].Amount&&null!=this.dgv.Table[p].Amount&&""!=this.dgv.Table[p].Amount.toString()&&null!=this.dgv.Table[p].Month&&null!=this.dgv.Table[p].Month&&""!=this.dgv.Table[p].Month.toString()){if(null!=h&&h.Tables.length>0){let e=h.Tables[0].filter(D=>new Date(D.dcAlpha2).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy")||new Date(D.dcAlpha4).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy"));null!=e&&e.length>0&&(g=e[0].InvDocDetailsID.toString(),u=parseInt(e[0].DocID))}c=g.length>0?'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="Desktop" DetailIds="'+g+'"> </XML>':'<XML SysInfo="'+d.d.SessionManager.GetSysInfo()+'" AP="Desktop" > </XML>',a+="<ROWS>",a+="<DocumentXML>",a+=this.GetRecXML(new Date(this.dgv.Table[p].Month),new Date(this.dgv.Table[p].Month),parseFloat(this.dgv.Table[p].Amount),l,t,i,g),a+="</DocumentXML>",a+="<ActivityXML>",a+=c,a+="</ActivityXML>",a+="<DOCIDXML>",a+='<XML DOCID="'+u+'"></XML>',a+="</DOCIDXML>",a+="</ROWS>"}if(a.length>0&&a.length>0){a="<REC>"+a,a+="</REC>";let p=[];p.push(a.toString()),p.push(d.d.SessionManager.GetSysInfo()),p.push("Desktop"),p.push(d.d.SessionManager.UserID),p.push(d.d.SessionManager.LanguageID);let e=d.d.empService.ExecuteQuery_SP(p,"spPAY_PostTDSDoc");return null!=e&&e.Tables.length>0&&e.Tables[e.Tables.length-1].length>0&&e.Columns[e.Tables.length-1].Contains("ErrorMessage")?(this.DisplayMessage=e.Tables[e.Tables.length-1][0].ErrorMessage.toString(),void(this.MessageVisibility=!0)):(this.DisplayMessage="Problem in processing your request,Please contact administrator.",void(this.MessageVisibility=!0))}}Logger.InfoLog("TDSPostingViewModel::Exiting Post_Click()")}catch(a){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION btnPost_Click()\r\n"+a.stack)}}ValidatePosting(){try{return Logger.InfoLog("TDSPostingViewModel::Entering ValidatePosting()"),parseFloat(this.dgv.Columns[2].footer)!=parseFloat(this.lTDSAmount)?(this.DisplayMessage="TDS Amount not Equal",this.MessageVisibility=!0,!1):this.iComponentID<=0?(this.DisplayMessage="TDS Component Should be Monthly Type",this.MessageVisibility=!0,!1):(Logger.InfoLog("TDSPostingViewModel::Exiting ValidatePosting()"),!0)}catch(a){return Logger.ErrorLog("TDSPostingViewModel::EXCEPTION ValidatePosting()\r\n"+a.stack),!1}}dgv_EndEdit(a,l,t){try{Logger.InfoLog("TDSPostingViewModel::Entering dgv_EndEdit()");let i=0;if(this.dgv.Table.length>0){for(let o=0;o<this.dgv.Table.length;o++)null!=this.dgv.Table[o].Amount&&null!=this.dgv.Table[o].Amount&&""!=this.dgv.Table[o].Amount.toString()&&(i+=parseFloat(this.dgv.Table[o].Amount));this.dgv.Columns[2].footer=i.ToString("0.00"),this.dgv.UpdateFooter()}Logger.InfoLog("TDSPostingViewModel::Exiting dgv_EndEdit()")}catch(i){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION dgv_EndEdit()\r\n"+i.stack)}}GetRecXML(a,l,t,i,o,r,h){let c="",g="",u="",p="",e="",D="";return u+='<Alpha Query="',u+=" dcAlpha1=3,dcAlpha2='"+a.ToString("dd MMM yyyy")+"',dcAlpha3="+this.iComponentID+",dcAlpha4='"+l.ToString("dd MMM yyyy")+"', ",u+='" ></Alpha>',D="",e+='<CostCenters Query="',D+=" dcCCNID51="+this.Parent.Employee.SelectedValue+",",D.length>0&&(e+=D),e+='" ></CostCenters>',g+=h.length>0?'" DocDetailsID="'+h:'" DocDetailsID="',g+='" ProductID="'+i+'" Quantity="0',g+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',g+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',g+='" StockValue="0" StockValueFC="0" RefNO="',g+='" BillDate="'+(new Date).ToString("dd/MMM/yyyy"),g+='" CurrencyID="1" ExchangeRate="1',g+='" DebitAccount="'+o+'" CreditAccount="'+r,g+='" CommonNarration="'+m.J0.EncodeXML(""),p+='<Numeric Query="',p+="dcNum1="+t+", dcCalcNum1="+t,p+='" ></Numeric>',c+="<Row>",c+="<AccountsXML></AccountsXML>",c+='<Transactions DocSeqNo="1',c+='" LinkedInvDocDetailsID="0" LinkedFieldName="',c+='" LineNarration="'+m.J0.EncodeXML(""),c+=g.toString()+'" ></Transactions>',c+=u.toString(),c+=p.toString(),c+=e.toString(),c+="<EXTRAXML></EXTRAXML>",c+="</Row>",c.toString()}}let $=(()=>{class V{constructor(){this.form=new L.gE({}),this.lblTotalTaxAmount="TOTAL INCOME TAX PAYABLE : ",this.lblTDSPaidAmount="TDS Paid : ",this.lblTDSAmount="Payable TDS Amount : "}ngOnInit(){}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-tds-posting"]],inputs:{obj:"obj"},decls:72,vars:21,consts:[[1,"master-screen",2,"padding-bottom","4px","width","700px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row"],["FieldDirective","",3,"obj","group"],[2,"margin-left","12px"],[1,"form-group",2,"margin-left","12px"],[1,"primary-btn-wicon",3,"click"],[2,"padding-top","5px"],[2,"font-weight","bold","margin-left","10px"],[2,"padding-top","5px","margin-left","25px"],[1,"documentgrid","row","form-row",2,"width","100%","margin-top","5px"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"secondary-btn-wicon",3,"click"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"div"),s.EFF(7,"\n            "),s.eu8(8,3),s.EFF(9,"\n        "),s.k0s(),s.EFF(10,"\n        "),s.j41(11,"div",4),s.EFF(12,"\n            "),s.eu8(13,3),s.EFF(14,"\n        "),s.k0s(),s.EFF(15,"\n        "),s.j41(16,"div",5),s.EFF(17,"\n            "),s.j41(18,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Generate")}),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n          "),s.k0s(),s.EFF(22,"\n        "),s.k0s(),s.EFF(23,"\n        "),s.j41(24,"div",2),s.EFF(25,"\n            "),s.j41(26,"div",7),s.EFF(27,"\n                "),s.j41(28,"label"),s.EFF(29),s.k0s(),s.j41(30,"label",8),s.EFF(31),s.k0s(),s.EFF(32,"\n            "),s.k0s(),s.EFF(33,"\n            "),s.j41(34,"div",9),s.EFF(35,"\n                "),s.j41(36,"label"),s.EFF(37),s.k0s(),s.j41(38,"label",8),s.EFF(39),s.k0s(),s.EFF(40,"\n            "),s.k0s(),s.EFF(41,"\n            "),s.j41(42,"div",9),s.EFF(43,"\n                "),s.j41(44,"label"),s.EFF(45),s.k0s(),s.j41(46,"label",8),s.EFF(47),s.k0s(),s.EFF(48,"\n            "),s.k0s(),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",10),s.EFF(52,"\n            "),s.nrm(53,"app-PactGridView",11),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n\n\n        "),s.j41(56,"div",12),s.EFF(57,"\n            "),s.j41(58,"div"),s.EFF(59,"\n                "),s.j41(60,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Post")}),s.EFF(61),s.nI1(62,"translate"),s.k0s(),s.EFF(63,"\n                "),s.j41(64,"button",13),s.bIt("click",function(){return i.obj.Button_Click("Cancel")}),s.EFF(65),s.nI1(66,"translate"),s.k0s(),s.EFF(67,"\n            "),s.k0s(),s.EFF(68,"\n        "),s.k0s(),s.EFF(69,"\n    "),s.k0s(),s.EFF(70,"\n"),s.k0s(),s.EFF(71,"\n")),2&t&&(s.R7$(8),s.Y8G("obj",i.obj.dtpFromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpToDate)("group",i.form),s.R7$(6),s.JRh(s.bMT(20,15,"Generate")),s.R7$(10),s.JRh(i.lblTotalTaxAmount),s.R7$(2),s.JRh(i.obj.lTotalTaxAmount),s.R7$(6),s.JRh(i.lblTDSPaidAmount),s.R7$(2),s.JRh(i.obj.lTDSPaidAmount),s.R7$(6),s.JRh(i.lblTDSAmount),s.R7$(2),s.JRh(i.obj.lTDSAmount),s.R7$(6),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(8),s.JRh(s.bMT(62,17,"Post")),s.R7$(4),s.JRh(s.bMT(66,19,"Close")))},dependencies:[Ye._,ze.X,Xe.D9]})}return V})();class X extends je.g{constructor(){super(...arguments),this.CostCenterID=0,this.MessageDisplay="",this.TypeID=0,this.Employee=new yt.G(0),this.TDSPostVisiblility=!1,this.PrintVisiblility=!1,this.ExportVisiblility=!1,this.WorksheetVisiblility=!1,this.txtDesignation="",this.dtPayrollTaxCmptsObj=new re.vv,this.Savereturnvalue=0,this.dsITComputation=null,this.sbComputationData="",this.sbValidation="",this.dPayableTDSAmount=0,this.dTotalTaxAmount=0,this.dTDSPaidAmount=0,this.iCompnentID=0,this.objTDSVM=null}get CCID(){return this.CostCenterID}set CCID(a){this.CostCenterID=a}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(a){a!=this._lFinancialDate&&(this._lFinancialDate=a)}get ScreenObject(){return this._ScreenObject}set ScreenObject(a){this._ScreenObject=a}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}IncomeTaxComputationViewModel(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new Gt,this.ScreenObject=new _t.a(0,0),this.ScreenObject.Data=[],this.TDSPostVisiblility=d.d.SessionManager.IsActionAssigned(264,"TDS Posting"),this.PrintVisiblility=d.d.SessionManager.IsActionAssigned(264,"Print"),this.ExportVisiblility=d.d.SessionManager.IsActionAssigned(264,"Export"),this.WorksheetVisiblility=d.d.SessionManager.IsActionAssigned(264,"WorkSheet"),this.EmpYear=new n.y$(0);for(let a=2e3;a<2100;a++){let l=n._p.ComboBoxItems_2(a.toString(),a.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=m.J0.ParseDate(d.d.SessionManager.PayrollMonth).ToString("yyyy"),this.lFinancialDate=this.GetFinancialYear(),this.EmpRegime=new n.y$(0),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(n._p.ComboBoxItems_2("New","New")),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}GetFinancialYear(){let a="",l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth,1),t=l.AddYears(1).AddMonths(-1);return a=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(t.getMonth(),!1)+" "+t.getFullYear(),a}Employee_SelectedValueChanged(a){this.dsITComputation=d.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,d.d.SessionManager.AccountingFromMonth),this.GetResPerson()}GetResPerson(){this.lstResponsiblePerson=new W,this.txtDesignation="";let t,i,a=" 1=1 ",l="";if(d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn")&&""!=d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn").toString()&&d.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOnXML")&&""!=d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML&&d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML.length>0){t=new m.VB,t.ReadXml(d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML),i=t.Tables[0];let r=d.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOn.split(",");if(null!=r&&r.length>0)for(let h=0;h<r.length;h++)if(null!=r[h]&&""!=r[h]&&(l="CCNID"+(parseInt(r[h])-5e4),null!=this.dsITComputation&&this.dsITComputation.Tables.length>27&&this.dsITComputation.Tables[27].length>0)){let c=this.dsITComputation.Tables[27].filter(g=>g.NodeID=this.Employee.SelectedValue);null!=c&&c.length>0&&(a+=" AND ( dc"+l+"="+c[0][l]+" )",i=i.filter(g=>g["dc"+l]==c[0][l]))}}let o="";if(" 1=1 "!=a&&(o=i),null!=o&&o.length>0){this.lstResponsiblePerson.SelectedValue=o[0].ResponsiblePerson.toString();let r=d.d.common.GetDataSet("PAY070",this.lstResponsiblePerson.SelectedValue.toString());null!=r&&r.Tables[0].length>0&&(this.lstResponsiblePerson.Text=r.Tables[0][0].Name.toString(),this.lstResponsiblePerson.Tag=r.Tables[0][0].FHName.toString(),this.txtDesignation=r.Tables[0][0].Designation.toString())}}OnYearSelected(a){this.FilterEmployees(),this.dsITComputation=d.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,d.d.SessionManager.AccountingFromMonth),this.GetResPerson()}OnSaveITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():d.d.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+l.stack)}}OnDeleteITComputation(a){try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():d.d.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+l.stack)}}OnSaveRegimeITComputation(a){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveRegimeITComputation()"),this.sbValidation?(this.DisplayMessage=this.sbValidation.toString(),this.MessageVisibility=!0):null!=this.EmpRegime.SelectedValue?(d.d.common.GetDataSet3("PAY121",this.EmpRegime.SelectedValue,this.Employee.SelectedValue.toString(),this.EmpYear.SelectedValue),this.DisplayMessage="Updated Succesfully",this.MessageVisibility=!0):(this.DisplayMessage="Please select RegimeType",this.MessageVisibility=!0)}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveRegimeITComputation()"+l.stack)}}OnTDSPostITComputation(a){try{if(Logger.InfoLog("ITComputationViewModel::Entering OnTDSPostITComputation()"),!this.DisplayMessage){let l=[];l.push(this),l.push(this.dTotalTaxAmount),l.push(this.dTDSPaidAmount),l.push(this.dPayableTDSAmount),l.push(this.iCompnentID),this.objTDSVM=new w(l),d.d.page.ShowDialog(this.objTDSVM,$,{ShowCenter:!0,Title:"TDS Posting"}).subscribe(()=>{})}Logger.InfoLog("ITComputationViewModel::Exiting OnTDSPostITComputation()")}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnTDSPostITComputation()"+l.stack)}}FilterEmployees(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");let l,t,a="";l=new Date(parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),t=new Date(d.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),d.d.SessionManager.AccountingToMonth-1,1),t=t.AddMonths(1).AddDays(-1),a=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",a=a+" or (Year(CONVERT(DATETIME,'"+t.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",a=a+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a=a+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a+="  AND a.NodeID IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),d.d.SessionManager.IsRptManagerUser&&d.d.SessionManager.IsActionAssigned(264,"Do not show sub ordinates Data")&&(a+="  AND a.NodeID IN ("+d.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=a,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+a.stack)}}}class W{}var U=G(71336),R=G(78324),B=G(9524),se=G(38859),z=G(35620);function he(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",27),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.PrintForm16_Click("PrintForm16"))}),s.nrm(1,"i",28),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Print")))}function le(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Export"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function Ie(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Worksheet"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"WorkSheet")))}function we(V,a){if(1&V){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("TDSPost"))}),s.nrm(1,"i",7),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&V&&(s.R7$(2),s.JRh(s.bMT(3,1,"TDSPost")))}let Be=(()=>{class V{constructor(){this.form=new L.gE({}),this.prevSelectedEmp=0,this.iSelectedEmpSeqNo=0,this.prevSelectReperson=0,this.BasicIndex=-1,this.TotalSalaryIndex=0,this.Form12Section1Index=0,this.Form12Section2Index=0,this.Exemptionsunder10Index=0,this.HRA10BasicIndex=0,this.HRAAcutalIndex=0,this.HRAMetroNonMetroIndex=0,this.HRAExemptionIndex=0,this.TDSPaidIndex=0,this.NetTaxPayableIndex=0,this.InhandAmountIndex=0,this.MonthlyDeducIndex=0,this.intTotalIncometaxPayableindex=0,this.TotAmtOthExemptUs10Index=0,this.ConveyanceIndex=0,this.ChildrenEduIndex=0,this.StandardDedIndex=0,this.MedicalIndex=0,this.LTAIndex=0,this.LeaveEncashIndex=0,this.FoodIndex=0,this.GratuityIndex=0,this.BalanceSalInc12BAIndex=0,this.ProfessionalTaxIndex=0,this.NetTaxableSalIndex=0,this.GrossTotalIncomeIndex=0,this.IncomefromHousePropertyIndex=0,this.intDeducunder8oCto80CCCIndex=0,this.intTotalDeducunder8oCto80CCCIndex=0,this.intOtherDeducunder8oCto80CCCIndex=0,this.dblTotalIncomeIndex=0,this.dblTotalIncomeRoundoffIndex=0,this.intOtherDeducunder8oCto80CCCIndex1=0,this.dblTaxOnTotalIncomeIndex=0,this.dblRebateIndex=0,this.dblTaxPayableAfterRebateIndex=0,this.dblSurchargeIndex=0,this.dblTaxPayableIndex=0,this.dblEducationCessIndex=0,this.dblSecHighEduCessIndex=0,this.NewStandardDedIndex=0,this.NewRegimeStartIndex=0,this.intNewDeducunder8oCto80CCCIndex=0,this.intNewTotalDeducunder8oCto80CCCIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex1=0,this.dblNewTotalIncomeIndex=0,this.dblNewTotalIncomeRoundoffIndex=0,this.dblNewTaxOnTotalIncomeIndex=0,this.dblNewRebateIndex=0,this.dblNewTaxPayableAfterRebateIndex=0,this.dblNewSurchargeIndex=0,this.dblNewTaxPayableIndex=0,this.dblNewEducationCessIndex=0,this.dblNewSecHighEduCessIndex=0,this.intNewTotalIncometaxPayableindex=0,this.NewTDSPaidIndex=0,this.NewNetTaxPayableIndex=0,this.NewNetTaxableSalIndex=0,this.NewGrossTotalIncomeIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex=0,this.dblbalanceSalaryInc12BA=0,this.dblTotalCellSalary=0,this.dPerq1=0,this.dPerq2=0,this.HraMinValue=0,this.dblMedicalAmount=0,this.dblLTAAmount=0,this.dblLeaveEncashAmount=0,this.dblFoodAmount=0,this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=0,this.dblNetTaxableSal=0,this.dblGrossTotalIncome=0,this.dblTDS=0,this.dblNetTaxPayable=0,this.dblInhandAmount=0,this.dblSelfletoutamount=0,this.dblTotalIncome=0,this.dblTotalIncomeRoundoff=0,this.dblServiceDays=0,this.dblStandardDeduction=0,this.dblNewStandardDeduction=0,this.dblNewTotaldeduction80ccc80c=0,this.dblNewTotalIncome=0,this.dblNewTotalIncomeRoundoff=0,this.dblNewSelfletoutamount=0,this.dblNewGrossTotalIncome=0,this.dblNewNetTaxableSal=0,this.lstTaxSalbs=new Array,this.lstNewTaxSalbs=new Array,this.bIsNewRegime=!1,this.txtPlace=new xe.Dw,this.dvTaxSlabsData=[],this.dvLimitData=[],this.dtpDate=new E.Lc}ngOnInit(){this.obj=this.params.obj,this.grdIncomeTax=new R.j,this.grdIncomeTax.ItComput=!0,this.ITComputationViewModel=this.obj,this.BindGridColumns(),this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.EmpYear.SelectionChangedCommand.Subscribe(this,"cmbYear_SelectionChanged"),this.lstEmployee.SelectionChangedCommand.Subscribe(this,"lstEmployee_SelectionChanged"),this.dtpDate=new E.Lc,d.d.page.MaximizeTab(this.obj),this.MessageDisplay=""}set MessageDisplay(l){this.ITComputationViewModel.DisplayMessage=l}BindGridColumns(){try{let l=new se.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,t=new se.bA;t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=11,t.IsBold=!1,t.BackColor="White",t.ForeColor="#FF333333",i=new B.D_,i.HeaderText="SNo",i.width=10,i.HeaderAppearance=new se.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new B.D_,i.HeaderText="Header",i.width=20,i.HeaderAppearance=new se.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new B.D_,i.HeaderText="ComponentID",i.width=25,i.HeaderAppearance=new se.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new B.D_,i.HeaderText="Salary Breakup",i.width=220,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new B.D_,i.HeaderText="Investment & Bill Details",i.width=100,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i);let e,o=0,r=0,h=0,c=0,g=0,u=0,p=0;g=d.d.SessionManager.FinancialYearStartDate.getFullYear(),e=g.toString(),g=parseInt(e.substr(2,2)),u=g+1,o=d.d.SessionManager.AccountingFromMonth,c=o,p=1==c?12:15;for(let D=c;D<=p;D++)if(12==r){h=r-D;for(let y=1;y<=h;y++)i=new B.D_,i.HeaderText=this.GetMonthName(y,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),D+=1}else i=new B.D_,r=o,i.HeaderText=this.GetMonthName(D,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i);i=new B.D_,i.HeaderText="RegimeType",i.width=25,i.HeaderAppearance=new se.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i),i=new B.D_,i.HeaderText="Amount",i.width=100,i.HeaderAppearance=l,i.DataAppearance=t,this.grdIncomeTax.ReportColumns.push(i)}catch(l){Logger.ErrorLog("Error : "+l),this.MessageDisplay=l.message}}get lstEmployee(){return this.ITComputationViewModel.Employee.Code}get lstEmployeeName(){return this.ITComputationViewModel.Employee.Name}get cmbYear(){return this.ITComputationViewModel.EmpYear}get cmbRegime(){return this.ITComputationViewModel.EmpRegime}clear(l){this.MessageDisplay="",this.prevSelectedEmp=0,this.prevSelectReperson=0,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary=this.dPerq1=this.dPerq2=this.HraMinValue=this.dblMedicalAmount=this.dblLTAAmount=this.dblLeaveEncashAmount=this.dblFoodAmount=this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=this.dblNetTaxableSal=this.dblGrossTotalIncome=this.dblTotalIncome=this.dblTotalIncomeRoundoff=this.dblServiceDays=this.dblTDS=this.dblNetTaxPayable=this.dblInhandAmount=0,this.dblStandardDeduction=0,this.cmbRegime.SelectedValue="",this.grdIncomeTax.Clear(),this.ITComputationViewModel.txtDesignation="",1==l&&(this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null,this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null)}btnSave_Click(l){if(null!=l)try{if("Clear"==l)this.clear(1);else if("Save"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i=0,o=0,r=0,h="";if(0==t.length){h+="<Rows>";for(let c=0;c<this.grdIncomeTax.Data.length;c++)null!=this.grdIncomeTax.Data[c].Cells[1].Value&&(h+='<row HeaderID="'+this.grdIncomeTax.Data[c].Cells[1].Value,parseFloat(this.grdIncomeTax.Data[c].Cells[2].Value)<0?h+='" HeaderName="'+this.grdIncomeTax.Data[c].Cells[3].Value:h+='" HeaderName="',h+='" ComponentID="'+this.grdIncomeTax.Data[c].Cells[2].Value,i=m.J0.Double(this.grdIncomeTax.Data[c].Cells[4].Value),h+=i>=0?'" ComponentAmount="'+i:'" ComponentAmount="-1',null!=this.grdIncomeTax.Data[c].Cells[17].Value?(r=m.J0.Int(this.grdIncomeTax.Data[c].Cells[17].Value),h+=r>=0?'" RegimeType="'+r:'" RegimeType="0'):h+='" RegimeType="0',o=m.J0.Double(this.grdIncomeTax.Data[c].Cells[17].Value),h+='" TotalAmount="'+o,h+='"/>');h+="</Rows>",this.ITComputationViewModel.sbComputationData=h,this.clear(1)}else h+=t,this.ITComputationViewModel.sbValidation=h;this.ITComputationViewModel.OnSaveITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("Delete"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?(this.ITComputationViewModel.sbComputationData=i,this.clear(1)):(i+=t,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnDeleteITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("Export"==l){let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?(this.ITComputationViewModel.sbComputationData=i,this.ExportToExcel()):(i+=t,this.ITComputationViewModel.sbValidation=i)}else if("Worksheet"==l){if(null==this.dtpDate.Date&&(this.dtpDate.Date=new Date),!(this.lstEmployee.SelectedValue>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);this.txtPlace.Text.Trim(),this.dtpDate.Date.ToString("dd/MMM/yyyy"),this.WorkSheetPrintGrid(),this.Form16export()}else if("SaveRegime"==l)try{let t=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==t.length?this.ITComputationViewModel.sbComputationData=i:(i+=t,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnSaveRegimeITComputation(l)}catch(t){Logger.ErrorLog("Error : "+t)}else if("TDSPost"==l)try{if(!(this.iSelectedEmpSeqNo>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation=this.dsTaxData.Tables[21],!(null!=this.dvEmpTaxComputation&&this.dvEmpTaxComputation.length>0))return this.ITComputationViewModel.DisplayMessage="Please Save Income Tax Computation",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation.RowFilter="",null==this.cmbRegime.SelectedValue)return this.ITComputationViewModel.DisplayMessage="Please Save Regime Opted For",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-122==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-122==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTotalTaxAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-123==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-123==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTDSPaidAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(t=>-124==t.ComponentID&&1==t.RegimeType):this.dsTaxData.Tables[21].filter(t=>-124==t.ComponentID&&0==t.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dPayableTDSAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),null!=this.dsTaxData&&this.dsTaxData.Tables.length>19&&this.dsTaxData.Tables[19].length>0){let t=this.dsTaxData.Tables[19].filter(i=>"TDS"==i.TaxmapName&&"Monthly"==i.FieldType);null!=t&&t.length>0&&(this.ITComputationViewModel.iCompnentID=parseInt(t[0].componentID))}this.ITComputationViewModel.OnTDSPostITComputation(l)}catch{}}catch(t){Logger.ErrorLog("Error : "+t),this.MessageDisplay=t.message}}WorkSheetPrintGrid(){this.grdPrint=new R.j,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let l=new se.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,t=new se.bA;t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=12,t.IsBold=!0,t.BackColor="White",t.ForeColor="#FF333333";for(let r=1;r<=10;r++)i=new B.D_,i.FieldName="Col"+r.toString(),i.width=70,i.HeaderText="Col"+r.toString(),i.HeaderAppearance=l,i.DataAppearance=t,this.grdPrint.ReportColumns.push(i);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=90,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=90,this.grdPrint.ReportColumns[6].width=80,this.grdPrint.ReportColumns[7].width=80,this.grdPrint.ReportColumns[8].width=80,this.grdPrint.ReportColumns[9].width=80;let o=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="WorkSheet\nEmployee Code : "+this.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+this.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+this.dtFromMonth.getFullYear()+" - "+this.dtToMonth.getFullYear()+", Assessment Year : "+this.dtFromMonth.AddYears(1).getFullYear()+" - "+this.dtToMonth.AddYears(1).getFullYear(),this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=10,o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="Salary Breakup",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value="Investment & Bill Details",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[5].ColSpan=1,this.grdPrint.Data[o].Cells[6].Value="Post Past",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value="Actual",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value="Projection",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[8].ColSpan=1,this.grdPrint.Data[o].Cells[9].Value="Amount",this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[9].ColSpan=1;for(let r=0;r<this.grdIncomeTax.Data.length;r++){let h;o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value=null!=this.grdIncomeTax.Data[r].Cells[3].Value&&""!=this.grdIncomeTax.Data[r].Cells[3].Value.toString()?this.grdIncomeTax.Data[r].Cells[3].Value:"",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value=null!=this.grdIncomeTax.Data[r].Cells[4].Value&&""!=this.grdIncomeTax.Data[r].Cells[4].Value.toString()&&m.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[4].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[4].Value).toString():"",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[5].ColSpan=1;let c=0,g=0,u=0;for(let p=5;p<this.grdIncomeTax.ReportColumns.length;p++)null!=this.grdIncomeTax.ReportColumns[p].Tag&&null!=this.grdIncomeTax.ReportColumns[p].Tag&&""!=this.grdIncomeTax.ReportColumns[p].Tag.toString()&&("Past"==this.grdIncomeTax.ReportColumns[p].Tag?(h=m.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString()),c+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&m.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0):"Processed"==this.grdIncomeTax.ReportColumns[p].Tag?g+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&m.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0:"Future"==this.grdIncomeTax.ReportColumns[p].Tag&&(u+=null!=this.grdIncomeTax.Data[r].Cells[p].Value&&""!=this.grdIncomeTax.Data[r].Cells[p].Value.toString()&&m.J0.DoubleTryParse(this.grdIncomeTax.Data[r].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[r].Cells[p].Value):0));this.grdPrint.Data[o].Cells[6].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?c.toString():"",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?g.toString():"",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value=r<=this.TotalSalaryIndex||r>this.MonthlyDeducIndex?u.toString():"",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[8].ColSpan=1,15!=r&&41!=r&&(this.grdPrint.Data[o].Cells[9].Value=null!=this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[r].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00"),this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[9].ColSpan=1}}ExportToExcel(){this.export()}export(){var l=this;return(0,ne.A)(function*(){let t="Income Tax Computation\nEmployee Code : "+l.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+l.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+l.dtFromMonth.getFullYear()+" - "+l.dtToMonth.getFullYear()+", Assessment Year : "+(l.dtFromMonth.getFullYear()+1)+" - "+(l.dtToMonth.getFullYear()+1),i=l.generatePrintContent(l.grdIncomeTax,t,!0);const o=new Blob([i],{type:"text/plain;charser=utf-8"});(0,St.saveAs)(o,"ITFile.xls")})()}Form16export(){var l=this;return(0,ne.A)(function*(){let t=l.generatePrintContent(l.grdPrint,"",!1,!0);const i=new Blob([t],{type:"text/plain;charser=utf-8"});(0,St.saveAs)(i,"TAX_PLACE_DATE_Form.xls")})()}getExcelColumnName(l){let o,t=l+1,i="";for(;t>0;)o=(t-1)%26,i=String.fromCharCode(65+o)+i,t=Math.floor((t-o)/26);return i}GetExportHTML(l){Logger.InfoLog("PostedDocumentViewModel:: inside GetExportHTML ");let t="",i="";t+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",i+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",i+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",i+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",i+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",t+="<style>"+i.toString()+"</style>";let h,r=0;for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)r+=this.grdIncomeTax.ReportColumns[c].width;t+="<table>",t+="\r\n<tr><td align='center'><h2>",t+=d.d.SessionManager.CompanyName,t+="</h2></td></tr>",t+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",t+=l,t+="</h3></td></tr>",t+="\r\n<tr><td align='center'>",t+=" From :  "+this.dtFromMonth.ToString(d.d.SessionManager.Preferences["Date Format"]),t+=" &nbs;&nbsp;&nbsp;To :  "+this.dtToMonth.ToString(d.d.SessionManager.Preferences["Date Format"]),t+="</td></tr>",t+="<tr><td style='padding-top:10p;'><table border=1 width='"+r+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",t+="<COLGROUP>";for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)m.J0.IsEmpty(this.grdIncomeTax.ReportColumns[c].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[c].ColumnType?t+="<COL style=''>":t+="<COL style='text-align:righ;'>";t+="</COLGROUP>",t+="<tr style=''>";for(let c=0;c<this.grdIncomeTax.ReportColumns.length;c++)t+="<th class='hdr' width='"+this.grdIncomeTax.ReportColumns[c].width,t+="' >",t+=this.grdIncomeTax.ReportColumns[c].HeaderText,t+="</th>";t+="</tr>";for(let c=0;c<this.grdIncomeTax.Data.length;c++){t+="<tr",c%2==1&&(t+=" class=alt"),t+=">";for(let g=0;g<this.grdIncomeTax.ReportColumns.length;g++)t+="<td",m.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[g].ColumnType?t+=" align='left'":t+=" align='right'",t+=">",m.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType),h=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[g]),this.grdIncomeTax.ReportColumns.Contains(h)&&(t+=m.J0.String(this.grdIncomeTax.Data[c].Cells[h].Text)),t+="</td>";t+="</tr>"}return t+="</table>",t+="</td></tr></table>",t+="</body><html>",Logger.InfoLog("PostedDocumentViewModel:: exiting GetExportHTML "),t}ValidateData(){let l="";return null==this.lstEmployee.SelectedValue&&(l="Please select the Employee."),l}GetMonthName(l,t){l>12&&(l-=12);let i="";switch(l){case 1:i=t?"January":"Jan";break;case 2:i=t?"February":"Feb";break;case 3:i=t?"March":"Mar";break;case 4:i=t?"April":"Apr";break;case 5:i="May";break;case 6:i=t?"June":"Jun";break;case 7:i=t?"July":"Jul";break;case 8:i=t?"August":"Aug";break;case 9:i=t?"September":"Sep";break;case 10:i=t?"October":"Oct";break;case 11:i=t?"November":"Nov";break;case 12:i=t?"December":"Dec"}return i}lstEmployee_SelectionChanged(l){this.lstEmployee.SelectedValue!=this.prevSelectedEmp&&(this.lstEmployeeName.SelectedValue=this.lstEmployee.SelectedValue,this.clear(0),this.prevSelectedEmp=this.lstEmployee.SelectedValue,this.iSelectedEmpSeqNo=this.lstEmployee.SelectedValue,this.ITComputationViewModel.Employee_SelectedValueChanged(l),this.FillDetails())}grdIncomeTax_CellEndEdit(l){if(4==l.ColumnIndex){let t=0;try{t=parseFloat(this.grdIncomeTax.Data[l.RowIndex][l.ColumnIndex]),t<0&&(t=0)}catch{}if(l.RowIndex==this.IncomefromHousePropertyIndex||l.RowIndex==this.IncomefromHousePropertyIndex+1||l.RowIndex==this.IncomefromHousePropertyIndex+2||l.RowIndex==this.IncomefromHousePropertyIndex+3||l.RowIndex==this.IncomefromHousePropertyIndex+4)return;l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<this.intTotalDeducunder8oCto80CCCIndex||(this.grdIncomeTax.Data[l.RowIndex][this.grdIncomeTax.ReportColumns.length-1]=m.J0.GetAmount(t)),this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+parseFloat(this.grdIncomeTax.Data[this.ConveyanceIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.ChildrenEduIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.MedicalIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LTAIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LeaveEncashIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.FoodIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.GratuityIndex][4].Value)+this.dblStandardDeduction),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblbalanceSalaryInc12BA),t=parseFloat(this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.NetTaxableSalIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(t),this.dblGrossTotalIncome=0,this.dblGrossTotalIncome=t+this.dblSelfletoutamount-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblGrossTotalIncome);let i=0,o=0;if(this.dvLimit=this.dvLimitData.filter(c=>995==c.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(o=parseFloat(this.dvLimit[0].AmountLimit)),l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<=this.intTotalDeducunder8oCto80CCCIndex){let c=0;for(let g=this.intDeducunder8oCto80CCCIndex+1;g<this.intTotalDeducunder8oCto80CCCIndex;g++)this.dvLimit=this.dvLimitData.filter(u=>u.ComponentID==parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)),this.dvLimit.length>0&&(i=m.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value=m.J0.GetAmount(i),this.grdIncomeTax.Data[g].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(i))),c+=parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][4].Value=m.J0.GetAmount(c),c>o&&(c=o),this.dblTotaldeduction80ccc80c=c,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTotaldeduction80ccc80c)}let h=0;for(let c=this.intOtherDeducunder8oCto80CCCIndex;c<=this.intOtherDeducunder8oCto80CCCIndex1;c++)this.dvLimit=this.dvLimitData.filter(g=>g.ComponentID==parseInt(this.grdIncomeTax.Data[c].Cells[2].Value)),this.dvLimit.length>0&&(i=m.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[c].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value=m.J0.GetAmount(i),this.grdIncomeTax.Data[c].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(i))),h+=parseFloat(this.grdIncomeTax.Data[c].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.dblTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Math.round(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-h)),this.UpdateTotals(parseFloat(this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value))}}UpdateTotals(l){let t=0;for(let p=0;p<this.lstTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstTaxSalbs[p].ToSlab){t+=l*this.lstTaxSalbs[p].Percentage;break}t+=this.lstTaxSalbs[p].ToSlab*this.lstTaxSalbs[p].Percentage}else{if(l<this.lstTaxSalbs[p].ToSlab){t+=(l-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage;break}t+=(this.lstTaxSalbs[p].ToSlab-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Math.round(t));let i=0,o=0;o=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?l<=5e5&&(i=2e3):2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=5e5&&(i=5e3):2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=35e4&&(i=2500):parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&l<=5e5&&(i=12500)),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,t=0):(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(o-i),t=o-i);let c,r=0,h=null,g=new ae.bT;if(this.dsTaxData.Tables[7].length>0){let p;c=new U.Nl("Basic",""),g.push("Basic",c),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),c=new U.Nl("TotalIncome",""),g.push("TotalIncome",c),g.TotalIncome.setFieldValue(this.dblTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let D=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(y=>1==y.Type&&"OverTime"!=y.FieldType),h.length>0)for(let y=0;y<h.length;y++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[y].ComponentID),null!=p&&p.length>0&&(c=new U.Nl(h[y].ComponentName.toString(),""),g.push(h[y].ComponentName.toString(),c),g[h[y].ComponentName.toString()].setFieldValue(D[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(y=>2==y.Type&&"OverTime"!=y.FieldType),h.length>0)for(let y=0;y<h.length;y++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==h[y].ComponentID),null!=p&&p.length>0&&(c=new U.Nl(h[y].ComponentName.toString(),""),g.push(h[y].ComponentName.toString(),c),g[h[y].ComponentName.toString()].setFieldValue(D[0]["Deduction"+p[0].SNo.toString()].toString()))}let u=g;this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvTaxSlabs[0].Surcharge.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].Surcharge.toString(),u))),this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].Value="Surcharge @ "+r+"%",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=t*r/100)>0?m.J0.GetAmount(Math.round(l)):0,t+=Math.round(l),this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?m.J0.GetAmount(t):0,r=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].EducationCess&&null!=this.dvTaxSlabs[0].EducationCess&&""!=this.dvTaxSlabs[0].EducationCess.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].EducationCess.toString(),u))),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].Value="Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?m.J0.GetAmount(Math.round(l)):0,r=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvTaxSlabs[0].SecondaryandHighEduc.toString(),u))),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?m.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?m.J0.GetAmount(Math.round(t)):0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}UpdateTotalsNewRegime(l){let t=0;for(let p=0;p<this.lstNewTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstNewTaxSalbs[p].ToSlab){t+=l*this.lstNewTaxSalbs[p].Percentage;break}t+=this.lstNewTaxSalbs[p].ToSlab*this.lstNewTaxSalbs[p].Percentage}else{if(l<this.lstNewTaxSalbs[p].ToSlab){t+=(l-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage;break}t+=(this.lstNewTaxSalbs[p].ToSlab-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Math.round(t));let i=0,o=0;o=parseFloat(this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&parseInt(this.cmbYear.SelectedValue)>=2023&&l<=7e5&&(i=25e3),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,t=0):(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(o-i),t=o-i);let c,r=0,h=null,g=new ae.bT;if(this.dsTaxData.Tables[7].length>0){let p;c=new U.Nl("Basic",""),g.push("Basic",c),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),c=new U.Nl("TotalIncome",""),g.push("TotalIncome",c),g.TotalIncome.setFieldValue(this.dblNewTotalIncomeRoundoff),h=this.dsTaxData.Tables[8];let e=this.dsTaxData.Tables[3];if(h=this.dsTaxData.Tables[8].filter(D=>1==D.Type&&"OverTime"!=D.FieldType),h.length>0)for(let D=0;D<h.length;D++)p=this.dsTaxData.Tables[8].filter(y=>y.ComponentID==h[D].ComponentID),null!=p&&p.length>0&&(c=new U.Nl(h[D].ComponentName.toString(),""),g.push(h[D].ComponentName.toString(),c),g[h[D].ComponentName.toString()].setFieldValue(e[0]["Earning"+p[0].SNo.toString()].toString()));if(h=this.dsTaxData.Tables[8].filter(D=>2==D.Type&&"OverTime"!=D.FieldType),h.length>0)for(let D=0;D<h.length;D++)p=this.dsTaxData.Tables[8].filter(y=>y.ComponentID==h[D].ComponentID),null!=p&&p.length>0&&(c=new U.Nl(h[D].ComponentName.toString(),""),g.push(h[D].ComponentName.toString(),c),g[h[D].ComponentName.toString()].setFieldValue(e[0]["Deduction"+p[0].SNo.toString()].toString()))}let u=g;this.dvNewTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvNewTaxSlabs[0].Surcharge.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].Surcharge.toString(),u))),this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].Value="Surcharge @ "+r+"%",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=t*r/100)>0?m.J0.GetAmount(Math.round(l)):0,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?m.J0.GetAmount(t):0,r=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].EducationCess&&""!=this.dvNewTaxSlabs[0].EducationCess.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].EducationCess.toString(),u))),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].Value="Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?m.J0.GetAmount(Math.round(l)):0,r=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(r=parseFloat(d.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString(),u))),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+r+"%",l=t*r/100,t+=Math.round(l),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?m.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=t>0?m.J0.GetAmount(Math.round(t)):0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}FillDetails(){try{let l=0,t=0,i=0,o=(new Date).OnlyDate(),r="";this.dsTaxData=this.ITComputationViewModel.dsITComputation;let h=this.dsTaxData.Tables[0],c=this.dsTaxData.Tables[22],g=this.dsTaxData.Tables[1],u=this.dsTaxData.Tables[2],p=this.dsTaxData.Tables[2];p=this.dsTaxData.Tables[2].filter(M=>"1"==M.ComponentType);let e=this.dsTaxData.Tables[3],D=this.dsTaxData.Tables[18];this.dvTaxSlabsData=this.dsTaxData.Tables[7],this.dvTaxSlabs=this.dsTaxData.Tables[7];let y=this.dsTaxData.Tables[15].filter(M=>"Old"==M.Regime);null!=y&&y.length>0&&(this.dvLimit=y,this.dvLimitData=this.dvLimit);let A=this.dsTaxData.Tables[15].filter(M=>"New"==M.Regime);null!=A&&A.length>0&&(this.dvNewLimit=A);let _=this.dsTaxData.Tables[7].filter(M=>"New"==M.RegimeType);if(null!=_&&_.length>0&&parseInt(this.cmbYear.SelectedValue)>=2020&&(!m.J0.IsEmpty(this.dvNewLimit)&&this.dvNewLimit.length>0?this.bIsNewRegime=!0:r+="Income tax amount limit data not avalilable for the selected year in New Regime"),this.dvEmpTaxComputation=this.dsTaxData.Tables[21],h.length>0&&(h=this.dsTaxData.Tables[0].filter(M=>"IT_BASIC"==M.MapFieldName),0==h.length&&(r+="Basic component is not available,Please map component in the payroll strucuture\r\n")),0==e.length&&(r+="Employee Payroll information not available\r\n"),!m.J0.IsEmpty(this.dvLimit)&&0==this.dvLimit.length&&(r+="Income tax amount limit data not avalilable for the selected year"),""!=r.toString())return this.MessageDisplay=r,this.ITComputationViewModel.MessageDisplay=r,void(this.ITComputationViewModel.MessageVisibility=!0);this.dsTaxData.Tables.length>26&&this.dsTaxData.Tables[26].length>0&&this.dsTaxData.Columns[26].Contains("RegimeType")&&null!=this.dsTaxData.Tables[26][0].RegimeType&&null!=this.dsTaxData.Tables[26][0].RegimeType&&""!=this.dsTaxData.Tables[26][0].RegimeType.toString()&&(this.cmbRegime.SelectedValue=this.dsTaxData.Tables[26][0].RegimeType.toString()),this.dblServiceDays=0,this.dtDateofJoining=m.J0.ParseDate(D[0].CDOJ),this.dtFromMonth=new Date(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue),d.d.SessionManager.AccountingFromMonth-1,1),this.dtToMonth=this.dtFromMonth.AddYears(1).AddDays(-1),this.dblServiceDays=o.Subtract(this.dtDateofJoining).Days+1;let x=0,F=0,k=0,f={iY:x,iM:F,iD:k};m.J0.GetYearsMonthsDays(m.J0.ParseDate(D[0].CDOB),this.dtToMonth.OnlyDate(),f),x=f.iY,F=f.iM,k=f.iD,this.dvTaxSlabs=this.dvTaxSlabsData.filter(x>=80?M=>"SuperSeniorCitizen"==M.Gender&&"Old"==M.RegimeType:x>=60?M=>"SeniorCitizen"==M.Gender&&"Old"==M.RegimeType:M=>M.Gender==m.J0.String(D[0].GenderName)&&"Old"==M.RegimeType),this.lstTaxSalbs.Clear();for(let M=0;M<this.dvTaxSlabs.length;M++)this.lstTaxSalbs.push(new Ge),this.lstTaxSalbs[M].FromSlab=parseFloat(this.dvTaxSlabs[M].Fromslab),this.lstTaxSalbs[M].ToSlab=parseFloat(this.dvTaxSlabs[M].Toslab),this.lstTaxSalbs[M].Percentage=parseFloat(this.dvTaxSlabs[M].Percentage)/100;i=17,t=5;for(let M=5;M<this.grdIncomeTax.ReportColumns.length;M++)this.grdIncomeTax.ReportColumns[M].HeaderText.toString()==m.J0.StringValue(c[0].Month)&&(t=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[M])),!m.J0.IsEmpty(c[0].RelieveMonth)&&this.grdIncomeTax.ReportColumns[M].HeaderText.toString()==m.J0.StringValue(c[0].RelieveMonth)&&(i=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[M]));let b=0,N=0;this.dsTaxData.Tables[0].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[0].length);let H,ee=0,q=0;for(let M=0;M<this.dsTaxData.Tables[0].length;M++){if(H=new Array,b=5,ee=0,q=0,this.grdIncomeTax.Data[M].Cells[17].Value=0,this.grdIncomeTax.Data[M].Cells[0].Value=this.dsTaxData.Tables[0][M].SNo,this.grdIncomeTax.Data[M].Cells[2].Value=this.dsTaxData.Tables[0][M].componentID,this.grdIncomeTax.Data[M].Cells[3].Value=this.dsTaxData.Tables[0][M].SalaryBreakup,this.grdIncomeTax.Data[M].Cells[3].CellAppearance=new se.bA,this.grdIncomeTax.Data[M].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[M].Cells[3].ColSpan=2,null!=this.dsTaxData.Tables[0][M].MapFieldName&&null!=this.dsTaxData.Tables[0][M].MapFieldName&&"IT_BASIC"==this.dsTaxData.Tables[0][M].MapFieldName.toString().Trim()&&(this.BasicIndex=M),parseInt(this.dsTaxData.Tables[0][M].SNo)>0){for(let K=0;K<g.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(!H.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)&&g[K].month.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()){this.grdIncomeTax.ReportColumns[j].Tag="Processed",H.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,m.J0.IsEmpty(g[K]["dcCalcNum"+this.dsTaxData.Tables[0][M].SNo.toString()])||(l=parseFloat(g[K]["dcCalcNum"+this.dsTaxData.Tables[0][M].SNo.toString()])),this.grdIncomeTax.Data[M].Cells[j].Value=l>0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[M].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[M].Cells[j].IsNormal=!1,q=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value=m.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.IsBold=!0,ee+=l;break}for(let K=0;K<p.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(parseInt(this.dsTaxData.Tables[0][M].componentID)==parseInt(p[K].componentid)&&p[K].FieldName.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&!m.J0.IsEmpty(p[K].Amount)&&parseFloat(p[K].Amount)>0&&!H.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){H.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,m.J0.IsEmpty(p[K].Amount)||(l=parseFloat(p[K].Amount)),this.grdIncomeTax.Data[M].Cells[j].Value=l>0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[M].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[M].Cells[j].IsNormal=!1,q=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value=m.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.IsBold=!0,ee+=l;break}if(0==e.length)return;for(let K=0;K<e.length;K++)for(b=t;b<i;b++)!H.Contains(this.grdIncomeTax.ReportColumns[b].HeaderText)&&m.J0.IntegerValue(this.grdIncomeTax.Data[M].Cells[b].Value)<=0&&(this.grdIncomeTax.ReportColumns[b].Tag="Future",H.push(this.grdIncomeTax.ReportColumns[b].HeaderText),l=parseFloat(e[K]["Earning"+this.dsTaxData.Tables[0][M].SNo.toString()]),this.grdIncomeTax.Data[M].Cells[b].Value=l>0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[M].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[M].Cells[b].IsNormal=!1,q=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].Value=m.J0.GetAmount(q),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[b].CellAppearance.IsBold=!0,ee+=l)}b=this.grdIncomeTax.ReportColumns.length-1,this.dblTotalCellSalary=this.dblTotalCellSalary+ee,parseInt(this.dsTaxData.Tables[0][M].SNo)>0?(this.grdIncomeTax.Data[M].Cells[b].Value=m.J0.GetAmount(ee),this.grdIncomeTax.Data[M].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[M].Cells[b].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[M].Cells[b].CellAppearance.FontSize=12,this.grdIncomeTax.Data[M].Cells[b].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[M].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[M].Cells[b].CellAppearance.ForeColor="#0bd10b"):(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTotalCellSalary),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].IsNormal=!1,this.TotalSalaryIndex=this.dsTaxData.Tables[0].length-1,this.grdIncomeTax.Data[M].Cells[1].Value=this.TotalSalaryIndex,N=this.TotalSalaryIndex)}if(N++,this.Form12Section1Index=this.TotalSalaryIndex+1,this.Form12Section2Index=this.TotalSalaryIndex+2,this.grdIncomeTax.addEmptyRowsWithCellApperance(2),this.dsTaxData.Tables[4].length>0){let M=0;for(let K=0;K<this.dsTaxData.Tables[4].length;K++)M=N+K,this.grdIncomeTax.Data[M].Cells[17].Value=0,this.grdIncomeTax.Data[M].Cells[0].Value=0,this.grdIncomeTax.Data[M].Cells[1].Value=M+1,this.grdIncomeTax.Data[M].Cells[2].Value=this.dsTaxData.Tables[4][K].componentid,this.grdIncomeTax.Data[M].Cells[3].Value=this.dsTaxData.Tables[4][K].SalaryBreakup,this.grdIncomeTax.Data[M].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[M].Cells[3].ColSpan=14,this.grdIncomeTax.Data[M].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[M].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[M].Cells[3].CellAppearance.IsBold=!0,-1==parseInt(this.dsTaxData.Tables[4][K].FieldType)&&(this.dPerq1=parseFloat(this.dsTaxData.Tables[4][K].Amount)),-2==parseInt(this.dsTaxData.Tables[4][K].FieldType)&&(this.dPerq2=parseFloat(this.dsTaxData.Tables[4][K].Amount)),this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(parseFloat(this.dsTaxData.Tables[4][K].AMOUNT)),this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b"}let O=0,oe=0,pe=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.Exemptionsunder10Index=this.Form12Section2Index+1,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[1].Value=this.Exemptionsunder10Index,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[2].Value=-101,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].Value="Less : Exemptions Under 10 ",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].ColSpan=15,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.IsBold=!0,this.dsTaxData.Tables[5].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(1),N=this.HRA10BasicIndex=this.Exemptionsunder10Index+1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[1].Value=this.HRA10BasicIndex,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].Value="Actual Rent Paid - 10% of Basic ",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].ColSpan=2;let ue=0,Le=0,v=this.dsTaxData.Tables[13];if(v.length>0){for(let M=0;M<v.length;M++)for(let K=5;K<this.grdIncomeTax.ReportColumns.length;K++)if(v[M].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){l=0,m.J0.IsEmpty(v[M].AMOUNT)||(l=parseFloat(v[M].AMOUNT)),l>0?(Le=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.BasicIndex].Cells[K].Value),l-=10*Le/100,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].Value=m.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].IsNormal=!1,ue+=l;break}}else for(let M=5;M<this.grdIncomeTax.ReportColumns.length;M++)this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[M].Value=m.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[M].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[M].IsNormal=!1;if(O=ue,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(ue),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAAcutalIndex=this.HRA10BasicIndex+1,ue=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[1].Value=this.HRAAcutalIndex,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[2].Value=this.dsTaxData.Tables[6][0].componentid.toString(),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].Value="Actual Received ",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].ColSpan=2,this.dsTaxData.Tables[6].length>0){for(b=5;b<17;b++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].Value=m.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].IsNormal=!1,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].CellAppearance.Alignment="Right";b=5;for(let M=0;M<this.TotalSalaryIndex;M++)if(parseInt(this.grdIncomeTax.Data[M].Cells[2].Value)==parseInt(this.dsTaxData.Tables[6][0].componentid))for(b=5;b<i;b++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].Value=m.J0.GetAmount(m.J0.DoubleTryParse(this.grdIncomeTax.Data[M].Cells[b].Value)),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[b].CellAppearance.Alignment="Right",ue+=m.J0.DoubleTryParse(this.grdIncomeTax.Data[M].Cells[b].Value)}oe=ue,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(ue),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1;let ke=0,be=0;if(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dsTaxData.Tables[7].length>0){ue=0;let K,Ne,M=null,j=new ae.bT;K=new U.Nl("Basic",""),j.push("Basic",K),j.Basic.setFieldValue(m.J0.DoubleTryParse(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),M=this.dsTaxData.Tables[8].filter(Pe=>1==Pe.Type&&"OverTime"!=Pe.FieldType);let te=this.dsTaxData.Tables[3];if(M.length>0)for(let Pe=0;Pe<M.length;Pe++)Ne=this.dsTaxData.Tables[8].filter(He=>He.ComponentID==M[Pe].ComponentID),null!=Ne&&Ne.length>0&&(K=new U.Nl(M[Pe].ComponentName.toString(),""),j.push(M[Pe].ComponentName.toString(),K),j[M[Pe].ComponentName.toString()].setFieldValue(te[0]["Earning"+Ne[0].SNo.toString()].toString()));if(M=this.dsTaxData.Tables[8].filter(Pe=>2==Pe.Type&&"OverTime"!=Pe.FieldType),M.length>0)for(let Pe=0;Pe<M.length;Pe++)Ne=this.dsTaxData.Tables[8].filter(He=>He.ComponentID==M[Pe].ComponentID),null!=Ne&&Ne.length>0&&(K=new U.Nl(M[Pe].ComponentName.toString(),""),j.push(M[Pe].ComponentName.toString(),K),j[M[Pe].ComponentName.toString()].setFieldValue(te[0]["Deduction"+Ne[0].SNo.toString()].toString()));if(M=this.dsTaxData.Tables[7],M.length>0){let Pe=j;ke=parseFloat(d.d.eval.EvaluateExpression(M[0].MetroFormula.toString(),Pe)),be=parseFloat(d.d.eval.EvaluateExpression(M[0].NonmetroFormula.toString(),Pe))}}this.HRAMetroNonMetroIndex=this.HRAAcutalIndex+1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[1].Value=this.HRAMetroNonMetroIndex,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[2].Value=-102,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].Value="Metro/Non-Metro ",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].ColSpan=2;let me="";if(v.length>0){for(let M=0;M<v.length;M++)for(let K=5;K<this.grdIncomeTax.ReportColumns.length;K++)if(v[M].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){me=v[M].METRO.toString(),"Yes"==me?(l=ke,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=m.J0.GetAmount(l)):"No"==me.TrimEnd(" ")?(l=be,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=m.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].CellAppearance.Alignment="Right",ue+=l;break}}else for(let M=5;M<this.grdIncomeTax.ReportColumns.length;M++)this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[M].Value=m.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[M].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[M].CellAppearance.Alignment="Right";pe=ue,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(ue),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAExemptionIndex=this.HRAMetroNonMetroIndex+1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[1].Value=this.HRAExemptionIndex,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[2].Value=-103,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].Value="HRA Exemption ",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.IsBold=!0,this.HraMinValue=Math.min(O,oe,pe),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.HraMinValue),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TotAmtOthExemptUs10Index=this.HRAExemptionIndex+1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[1].Value=this.TotAmtOthExemptUs10Index,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[2].Value=10001,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].Value="Total amount of any other exemption under section 10",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].ColSpan=14;let ve=0,de=this.dsTaxData.Tables[25].filter(M=>"U/S 10 : 1) Total amount of any other exemption under section 10"==M.Name);null!=de&&de.length>0&&null!=de[0].Amount&&null!=de[0].Amount&&""!=de[0].Amount.toString()&&(ve=parseFloat(de[0].Amount)),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(ve),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(2);let We=0,jt=0,ga=0;if(this.dvLimit=this.dvLimitData.filter(M=>998==M.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(We=parseFloat(this.dvLimit[0].AmountLimit)),this.ConveyanceIndex=this.TotAmtOthExemptUs10Index+1,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[1].Value=this.ConveyanceIndex,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][0].ComponentID),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].Value="Conveyance",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].ColSpan=14,parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){if(this.dsTaxData.Tables[9].length>0){b=5;for(let M=0;M<this.TotalSalaryIndex;M++)if(parseInt(this.grdIncomeTax.Data[M].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][0].ComponentID))for(b=5;b<i;b++)m.J0.IsEmpty(this.grdIncomeTax.Data[M].Cells[b].Value)||(jt+=m.J0.DoubleTryParse(this.grdIncomeTax.Data[M].Cells[b].Value))}ga=jt/12,0==ga||ga>We?We*=12:We=jt}parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2018&&(We=0,2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.dblStandardDeduction=4e4:parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.dblStandardDeduction=5e4)),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(We),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.ChildrenEduIndex=this.ConveyanceIndex+1,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[1].Value=this.ChildrenEduIndex,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][1].ComponentID),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[3].Value="Children Education Allowances";let Pa=0;if(parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){let M=0,K=0,j=0,Ne=0;if(this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(te=>996==te.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(j=parseFloat(this.dvLimit[0].AmountLimit)),this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(te=>996==te.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(K=parseInt(this.dvLimit[0].AmountLimit)),this.dsTaxData.Tables[10].length>0){M=parseInt(this.dsTaxData.Tables[10][0][0]),M>K&&(M=K),Ne=12*M*j,b=5;for(let te=0;te<this.TotalSalaryIndex;te++)if(parseInt(this.grdIncomeTax.Data[te].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][1].ComponentID))for(b=5;b<i;b++)null!=this.grdIncomeTax.Data[te].Cells[b].Value&&""!=this.grdIncomeTax.Data[te].Cells[b].Value.toString()&&0!=m.J0.DoubleTryParse(this.grdIncomeTax.Data[te].Cells[b].Value)&&(Pa+=M*j)}}this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Pa),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.dsTaxData.Tables[11].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[11].length);let ma=0,Ia=0;ma=this.ChildrenEduIndex+1,N=ma;for(let M=0;M<this.dsTaxData.Tables[11].length;M++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ma+M,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[11][M].NodeID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[11][M].NAME.toString(),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.dvEmpTaxComputation=this.dsTaxData.Tables[21],this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(K=>K.ComponentID==parseInt(this.dsTaxData.Tables[11][M].NODEID)&&0==K.RegimeType),this.dvEmpTaxComputation.length>0?(this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount))):(this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(0),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(0)),Ia+=m.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1;this.MedicalIndex=this.ChildrenEduIndex+1,this.LTAIndex=this.MedicalIndex+1,this.FoodIndex=this.LTAIndex+1,this.LeaveEncashIndex=this.FoodIndex+1,this.GratuityIndex=this.LeaveEncashIndex+1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.StandardDedIndex=this.GratuityIndex+1,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[1].Value=this.StandardDedIndex,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblStandardDeduction),this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.MedicalIndex].Cells[4].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LTAIndex].Cells[4].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LeaveEncashIndex].Cells[4].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.FoodIndex].Cells[4].Value)+m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.GratuityIndex].Cells[4].Value)+this.dblStandardDeduction),this.grdIncomeTax.addEmptyRowsWithCellApperance(3),this.BalanceSalInc12BAIndex=this.StandardDedIndex+1,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[1].Value=this.BalanceSalInc12BAIndex,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[2].Value=-104,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[3].Value="Balance Salary including Perquisites",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblbalanceSalaryInc12BA),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let Pt=0,xa=this.dsTaxData.Tables[12];this.ProfessionalTaxIndex=this.BalanceSalInc12BAIndex+1,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[0].Value=-105,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[1].Value=this.ProfessionalTaxIndex,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[3].Value="Professional Tax",g=this.dsTaxData.Tables[20];let De=!1;if(xa.length>0){De=!1;for(let M=0;M<this.dsTaxData.Tables[19].length;M++)if("PROFESSIONAL TAX"==m.J0.StringValue(this.dsTaxData.Tables[19][M].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][M].SNo)>0)for(let K=5;K<this.grdIncomeTax.ReportColumns.length-2;K++){De=!1;for(let j=0;j<g.length;j++)if(g[j].month.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){m.J0.IsEmpty(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])||(Pt+=parseFloat(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])),De=!0;break}if(!De)for(let j=0;j<p.length;j++)if(parseInt(this.dsTaxData.Tables[19][M].componentID)==parseInt(p[j].componentid)&&p[j].FieldName.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()&&parseFloat(p[j].Amount)>0){m.J0.IsEmpty(p[j].Amount)||(Pt+=parseFloat(p[j].Amount)),De=!0;break}if(!De)for(let j=0;j<e.length;j++)m.J0.IsEmpty(e[j]["Deduction"+this.dsTaxData.Tables[19][M].SNo.toString()])||(Pt+=parseFloat(e[j]["Deduction"+this.dsTaxData.Tables[19][M].SNo.toString()]))}}this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].Value=m.J0.GetAmount(Pt),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Pt),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.NetTaxableSalIndex=this.ProfessionalTaxIndex+1,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[1].Value=this.NetTaxableSalIndex,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNetTaxableSal=0,this.dblNetTaxableSal=this.dblbalanceSalaryInc12BA-Pt,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNetTaxableSal),this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[14].length+3);let Sa=0;this.IncomefromHousePropertyIndex=this.NetTaxableSalIndex+1;for(let M=0;M<this.dsTaxData.Tables[14].length;M++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[1].Value=this.IncomefromHousePropertyIndex,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][M].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[3].Value=this.dsTaxData.Tables[14][M].NAME,Sa=parseFloat(this.dsTaxData.Tables[14][M].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][M].AMOUNT)),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}let Ma=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[1].Value=this.IncomefromHousePropertyIndex+1,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[2].Value=-107,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[3].Value="Less : Standard deduction 30%",Ma=30*Sa/100,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value=m.J0.GetAmount(Ma),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Bt=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[1].Value=this.IncomefromHousePropertyIndex+2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[2].Value=-108,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[3].Value="",Bt=parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value)-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].Value=m.J0.GetAmount(Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[5].ColSpan=12;let Wt=0;for(let M=1;M<this.dsTaxData.Tables[14].length;M++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[1].Value=this.IncomefromHousePropertyIndex+3,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][M].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[3].Value=this.dsTaxData.Tables[14][M].NAME,Wt=parseFloat(this.dsTaxData.Tables[14][M].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].Value=m.J0.GetAmount(Wt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[1].Value=this.IncomefromHousePropertyIndex+4,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[2].Value=-109,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].Value="Loss from House Property",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(Wt-Bt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Jt=0;this.dblSelfletoutamount=0,N=Jt=this.IncomefromHousePropertyIndex+5;for(let M=2;M<this.dsTaxData.Tables[14].length;M++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Jt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][M].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[14][M].NAME,this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][M].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblSelfletoutamount=this.dblSelfletoutamount+parseFloat(this.dsTaxData.Tables[14][M].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(m.J0.DoubleTryParse(this.dsTaxData.Tables[14][M].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,Jt+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.GrossTotalIncomeIndex=Jt,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[1].Value=this.GrossTotalIncomeIndex,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblGrossTotalIncome=this.dblNetTaxableSal+this.dblSelfletoutamount-(Wt-Bt),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblGrossTotalIncome),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intDeducunder8oCto80CCCIndex=this.GrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[1].Value=this.intDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].ColSpan=15,this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[16].length);let fa=0,ca=0,rt=0;N=rt=this.intDeducunder8oCto80CCCIndex+1;for(let M=0;M<this.dsTaxData.Tables[16].length;M++){if(this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=rt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[16][M].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][M].NAME,this.dvEmpTaxComputation.RowFilter="",this.dvEmpTaxComputation.filter(K=>K.ComponentID==parseInt(this.dsTaxData.Tables[16][M].NODEID)),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==m.J0.String(this.dsTaxData.Tables[16][M].NAME)){let K=0;De=!1;for(let j=0;j<this.dsTaxData.Tables[19].length;j++)if("PF(Deduction from Salary)"==m.J0.String(this.dsTaxData.Tables[19][j].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][j].SNo)>0)for(let Ne=5;Ne<this.grdIncomeTax.ReportColumns.length-2;Ne++){De=!1;for(let te=0;te<g.length;te++)if(m.J0.String(g[te].month)==this.grdIncomeTax.ReportColumns[Ne].HeaderText.toString()){m.J0.IsEmpty(g[te]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][j].SNo)])||(K+=parseFloat(g[te]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][j].SNo)])),De=!0;break}if(!De)for(let te=0;te<p.length;te++)if(parseInt(this.dsTaxData.Tables[19][j].componentID)==parseInt(p[te].componentid)&&p[te].FieldName.toString()==this.grdIncomeTax.ReportColumns[Ne].HeaderText.toString()&&parseFloat(p[te].Amount)>0){m.J0.IsEmpty(p[te].Amount)||(K+=parseFloat(p[te].Amount)),De=!0;break}if(!De&&Ne>=t)for(let te=0;te<e.length;te++)m.J0.IsEmpty(e[te]["Deduction"+m.J0.String(this.dsTaxData.Tables[19][j].SNo)])||(K+=parseFloat(e[te]["Deduction"+m.J0.String(this.dsTaxData.Tables[19][j].SNo)]))}this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(K)}else this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dsTaxData.Tables[16][M].AMOUNT));this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",0==M&&(fa=m.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),M>0&&(ca+=m.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,N+=1,rt+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalDeducunder8oCto80CCCIndex=rt,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblTotaldeduction80ccc80c=ca+fa,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].Value=m.J0.GetAmount(this.dblTotaldeduction80ccc80c);let Ca=0;this.dvLimit=this.dvLimitData.filter(M=>995==M.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Ca=parseFloat(this.dvLimit[0].AmountLimit)),this.dblTotaldeduction80ccc80c>Ca&&(this.dblTotaldeduction80ccc80c=Ca),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b";let bt=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[17].length),this.intOtherDeducunder8oCto80CCCIndex=this.intTotalDeducunder8oCto80CCCIndex+1,N=rt=this.intTotalDeducunder8oCto80CCCIndex+1;for(let M=0;M<this.dsTaxData.Tables[17].length;M++){let K=0;if(this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=rt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[17][M].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[17][M].NAME,this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(j=>j.ComponentID==parseInt(this.dsTaxData.Tables[17][M].NODEID)&&0==j.RegimeType),this.dvEmpTaxComputation.length>0)bt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(K=0,K=parseFloat(this.dsTaxData.Tables[17][M].AMOUNT),"80D-Self/Spouse/Dependant Children"==m.J0.String(this.dsTaxData.Tables[17][M].NAME)||"80D-Self/Dependant/Parent (not Sr Citizen)"==this.dsTaxData.Tables[17][M].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==this.dsTaxData.Tables[17][M].NAME.toString()){De=!1;for(let j=0;j<this.dsTaxData.Tables[19].length;j++)if(!m.J0.IsEmpty(this.dsTaxData.Tables[19][j].TaxmapName)&&this.dsTaxData.Tables[19][j].TaxmapName.toString()==this.dsTaxData.Tables[17][M].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][j].SNo)>0)for(let Ne=5;Ne<this.grdIncomeTax.ReportColumns.length-2;Ne++){De=!1;for(let te=0;te<g.length;te++)if(g[te].month.toString()==this.grdIncomeTax.ReportColumns[Ne].HeaderText.toString()){null!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()]&&null!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()]&&""!=g[te]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()].toString()&&(K+=parseFloat(g[te]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()])),De=!0;break}if(!De)for(let te=0;te<p.length;te++)if(parseInt(this.dsTaxData.Tables[19][j].componentID)==parseInt(p[te].componentid)&&p[te].FieldName.toString()==this.grdIncomeTax.ReportColumns[Ne].HeaderText.toString()&&parseFloat(p[te].Amount)>0){null!=p[te].Amount&&null!=p[te].Amount&&""!=p[te].Amount.toString()&&(K+=parseFloat(p[te].Amount)),De=!0;break}if(!De)for(let te=0;te<e.length;te++)null!=e[te]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]&&null!=e[te]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]&&""!=e[te]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()].toString()&&(K+=parseFloat(e[te]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]))}}bt+=K,this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(K)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):K),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,rt+=1}this.intOtherDeducunder8oCto80CCCIndex1=rt-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeIndex=this.intOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeIndex,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.dblTotalIncome=this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-bt,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeRoundoffIndex=this.dblTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.IsBold=!0,this.dblTotalIncomeRoundoff=Math.round(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxOnTotalIncomeIndex=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblRebateIndex=this.dblTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[2].Value=-116,parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,000 for Taxable Income below Rs.5,00,000/-)":2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.5,000 for Taxable Income below Rs.5,00,000/-)":2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,500 for Taxable Income below Rs.3,50,000/-)":parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.12,500 for Taxable Income below Rs.5,00,000/-)"),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableAfterRebateIndex=this.dblRebateIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSurchargeIndex=this.dblTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableIndex=this.dblSurchargeIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblEducationCessIndex=this.dblTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSecHighEduCessIndex=this.dblEducationCessIndex+1,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalIncometaxPayableindex=this.dblSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[1].Value=this.intTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TDSPaidIndex=this.intTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[1].Value=this.TDSPaidIndex,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NetTaxPayableIndex=this.TDSPaidIndex+1,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[1].Value=this.NetTaxPayableIndex,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let ba,pa=0,At=0,Ea=0,Fa=0,Ht=0,Na=0;Ht=d.d.SessionManager.FinancialYearStartDate.getFullYear(),ba=Ht.toString(),Ht=parseInt(ba.substr(2,2)),Na=Ht+1,pa=d.d.SessionManager.AccountingFromMonth,Fa=pa;let Ut=1;At=pa,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.MonthlyDeducIndex=this.NetTaxPayableIndex+1,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[1].Value=this.MonthlyDeducIndex,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[2].Value=-125,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].Value="Monthly Deductions from salary",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].ColSpan=2;for(let M=5;M<this.grdIncomeTax.ReportColumns.length;M++)if(13==At){Ea=At-Ut;for(let K=1;K<=Ea;K++)this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[M].Value=this.GetMonthName(K,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[M].CellAppearance.Alignment="Center",Ut+=1,M++}else this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[M].Value=this.GetMonthName(At,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[M].CellAppearance.Alignment="Center",At+=1,Ut+=1;this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.dsTaxData.Tables[19].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[19].length+1);let Yt=0,xt=0,dt=0;N=Yt=this.MonthlyDeducIndex+1,g=this.dsTaxData.Tables[20];for(let M=0;M<this.dsTaxData.Tables[19].length;M++){if(H=new Array,b=5,dt=xt=0,this.grdIncomeTax.Data[N+M].Cells[17].Value=0,this.grdIncomeTax.Data[N+M].Cells[0].Value=this.dsTaxData.Tables[19][M].SNo,this.grdIncomeTax.Data[N+M].Cells[1].Value=Yt+M,this.grdIncomeTax.Data[N+M].Cells[2].Value=this.dsTaxData.Tables[19][M].componentID,this.grdIncomeTax.Data[N+M].Cells[3].Value=this.dsTaxData.Tables[19][M].SalaryBreakup,this.grdIncomeTax.Data[N+M].Cells[3].ColSpan=2,parseInt(this.dsTaxData.Tables[19][M].SNo)>0){for(let K=0;K<g.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(g[K].month.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&!H.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){H.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,m.J0.IsEmpty(g[K]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])||(l=parseFloat(g[K]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])),this.grdIncomeTax.Data[N+M].Cells[j].Value=l>=0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+M].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+M].Cells[j].IsNormal=!1,dt+=l;break}p=u,p=this.dsTaxData.Tables[2].filter(K=>"2"==K.ComponentType);for(let K=0;K<p.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(parseInt(this.dsTaxData.Tables[19][M].componentID)==parseInt(p[K].componentid)&&p[K].FieldName.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&parseFloat(p[K].Amount)>0&&!H.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){this.grdIncomeTax.ReportColumns[j].Tag="Past",H.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,m.J0.IsEmpty(p[K].Amount)||(l=parseFloat(p[K].Amount)),this.grdIncomeTax.Data[N+M].Cells[j].Value=l>=0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+M].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+M].Cells[j].IsNormal=!1,dt+=l;break}if(0==e.length)return;for(let K=0;K<e.length;K++)for(b=t;b<i;b++)!H.Contains(this.grdIncomeTax.ReportColumns[b].HeaderText)&&m.J0.DoubleTryParse(this.grdIncomeTax.Data[N+M].Cells[b].Value)<=0&&(H.push(this.grdIncomeTax.ReportColumns[b].HeaderText),l=parseFloat(e[K]["Deduction"+this.dsTaxData.Tables[19][M].SNo.toString()]),this.grdIncomeTax.Data[N+M].Cells[b].Value=l>=0?m.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+M].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+M].Cells[b].IsNormal=!1,dt+=l)}this.grdIncomeTax.Data[N+M].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(dt),this.grdIncomeTax.Data[N+M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[N+M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[N+M].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0}this.InhandAmountIndex=Yt+this.dsTaxData.Tables[19].length;let ua=0;this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[1].Value=this.InhandAmountIndex,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[2].Value=-126,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].Value="In Hand",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].IsNormal=!1,b=5;let Da=0;for(b=5;b<17;b++)this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].Value=m.J0.GetAmount(0),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.ForeColor="#dc3545";for(b=5;b<i;b++){xt=0;for(let M=Yt;M<this.InhandAmountIndex;M++)xt+=m.J0.DoubleTryParse(this.grdIncomeTax.Data[M].Cells[b].Value);Da=m.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[b].Value)-xt,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].Value=m.J0.GetAmount(Da),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[b].CellAppearance.ForeColor="#dc3545",ua+=Da}this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(ua),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",De=!1;for(let M=0;M<this.dsTaxData.Tables[19].length;M++)if("TDS"==m.J0.StringValue(this.dsTaxData.Tables[19][M].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][M].SNo)>0)for(let K=5;K<this.grdIncomeTax.ReportColumns.length-2;K++){De=!1;for(let j=0;j<g.length;j++)if(g[j].month.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){m.J0.IsEmpty(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])||(this.dblTDS+=parseFloat(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][M].SNo.toString()])),De=!0;break}if(!De)for(let j=0;j<p.length;j++)if(parseInt(this.dsTaxData.Tables[19][M].componentID)==parseInt(p[j].componentid)&&p[j].FieldName.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()&&parseFloat(p[j].Amount)>0){m.J0.IsEmpty(p[j].Amount)||(this.dblTDS+=parseFloat(p[j].Amount)),De=!0;break}if(!De)for(let j=0;j<e.length;j++)m.J0.IsEmpty(e[j]["Deduction"+this.dsTaxData.Tables[19][M].SNo.toString()])||(this.dblTDS+=parseFloat(e[j]["Deduction"+this.dsTaxData.Tables[19][M].SNo.toString()]))}if(this.UpdateTotals(this.dblTotalIncomeRoundoff),this.bIsNewRegime){let M=0,K=0,j=0;this.dvNewTaxSlabs=this.dsTaxData.Tables[7];let Ne={iY:M,iM:K,iD:j};m.J0.GetYearsMonthsDays(new Date(D[0].CDOB),this.dtToMonth.OnlyDate(),Ne),M=Ne.iY,K=Ne.iM,j=Ne.iD,this.dvNewTaxSlabs=this.dsTaxData.Tables[7].filter(M>=80?ie=>"SuperSeniorCitizen"==ie.Gender&&"New"==ie.RegimeType:M>=60?ie=>"SeniorCitizen"==ie.Gender&&"New"==ie.RegimeType:ie=>ie.Gender==m.J0.String(D[0].GenderName)&&"New"==ie.RegimeType),this.lstNewTaxSalbs.Clear();for(let ie=0;ie<this.dvNewTaxSlabs.length;ie++)this.lstNewTaxSalbs.push(new Ge),this.lstNewTaxSalbs[ie].FromSlab=parseFloat(this.dvNewTaxSlabs[ie].Fromslab),this.lstNewTaxSalbs[ie].ToSlab=parseFloat(this.dvNewTaxSlabs[ie].Toslab),this.lstNewTaxSalbs[ie].Percentage=parseFloat(this.dvNewTaxSlabs[ie].Percentage)/100;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewRegimeStartIndex=this.InhandAmountIndex+1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[1].Value=this.NewRegimeStartIndex,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[2].Value=-130,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].Value="Computation Based on New Regime",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.Alignment="Center",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.ForeColor="Black",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontSize=18,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Height=32,this.dblNewStandardDeduction=5e4,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewStandardDedIndex=this.NewRegimeStartIndex+1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[1].Value=this.NewStandardDedIndex,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewStandardDeduction),this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxableSalIndex=this.NewStandardDedIndex+1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[1].Value=this.NewNetTaxableSalIndex,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNewNetTaxableSal=0,this.dblNewNetTaxableSal=this.dblTotalCellSalary-this.dblNewStandardDeduction,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewNetTaxableSal),this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red";let te=0;this.dblNewSelfletoutamount=0;let Pe=this.dsTaxData.Tables[14].filter(ie=>"New"==ie.RegimeType||"Both"==ie.RegimeType);if(null!=Pe&&Pe.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Pe.length),N=te=this.NewNetTaxableSalIndex+1,null!=Pe&&Pe.length>0)for(let ie=0;ie<Pe.length;ie++)this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=te,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Pe[ie].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=Pe[ie].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(Pe[ie].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblNewSelfletoutamount=this.dblNewSelfletoutamount+parseFloat(Pe[ie].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(parseFloat(Pe[ie].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,te+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewGrossTotalIncomeIndex=te,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[1].Value=this.NewGrossTotalIncomeIndex,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewGrossTotalIncome=this.dblNewNetTaxableSal+this.dblNewSelfletoutamount,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewGrossTotalIncome),this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewDeducunder8oCto80CCCIndex=this.NewGrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].ColSpan=14;let He=this.dsTaxData.Tables[16].filter(ie=>"New"==ie.RegimeType||"Both"==ie.RegimeType);null!=He&&He.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(He.length);let Aa=0,Ta=0,ht=0;if(N=ht=this.intNewDeducunder8oCto80CCCIndex+1,null!=He&&He.length>0)for(let ie=0;ie<He.length;ie++){if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ht,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(He[ie].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][ie].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Ue=>Ue.ComponentID==parseInt(He[ie].NODEID)&&0==Ue.RegimeType),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==He[ie].NAME.toString()){let Ue=0;De=!1;for(let Fe=0;Fe<this.dsTaxData.Tables[19].length;Fe++)if("PF(Deduction from Salary)"==m.J0.String(this.dsTaxData.Tables[19][Fe].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][Fe].SNo)>0)for(let it=5;it<this.grdIncomeTax.ReportColumns.length-2;it++){De=!1;for(let ge=0;ge<g.length;ge++)if(m.J0.String(g[ge].month)==this.grdIncomeTax.ReportColumns[it].HeaderText.toString()){null!=g[ge]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)]&&""!=g[ge]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)].toString()&&(Ue+=parseFloat(g[ge]["dcCalcNum"+this.dsTaxData.Tables[19][Fe].SNo.toString()])),De=!0;break}if(!De)for(let ge=0;ge<p.length;ge++)if(parseInt(this.dsTaxData.Tables[19][Fe].componentID)==parseInt(p[ge].componentid)&&p[ge].FieldName.toString()==this.grdIncomeTax.ReportColumns[it].HeaderText.toString()&&parseFloat(p[ge].Amount)>0){null!=p[ge].Amount&&""!=p[ge].Amount.toString()&&(Ue+=parseFloat(p[ge].Amount)),De=!0;break}if(!De)for(let ge=0;ge<e.length;ge++)null!=e[ge]["Deduction"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)]&&""!=e[ge]["Deduction"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)].toString()&&(Ue+=parseFloat(e[ge]["Deduction"+this.dsTaxData.Tables[19][Fe].SNo.toString()]))}this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(Ue)}else this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(He[ie].Amount));0==ie&&(Aa=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),ie>0&&(Ta+=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[5].rowSpan=He.length,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].rowSpan=He.length,N+=1,ht+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalDeducunder8oCto80CCCIndex=ht,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblNewTotaldeduction80ccc80c=Ta+Aa,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].Value=m.J0.GetAmount(this.dblNewTotaldeduction80ccc80c);let ya=0;this.dvNewLimit=this.dsTaxData.Tables[15].filter(ie=>995==ie.ComponentID),null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()&&(ya=parseFloat(this.dvNewLimit[0].AmountLimit)),this.dblNewTotaldeduction80ccc80c>ya&&(this.dblNewTotaldeduction80ccc80c=ya),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green";let Ft=0,Qe=this.dsTaxData.Tables[17].filter(ie=>"New"==ie.RegimeType||"Both"==ie.RegimeType);if(null!=Qe&&Qe.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Qe.length),this.intNewOtherDeducunder8oCto80CCCIndex=this.intNewTotalDeducunder8oCto80CCCIndex+1,N=ht=this.intNewTotalDeducunder8oCto80CCCIndex+1,null!=Qe&&Qe.length>0)for(let ie=0;ie<Qe.length;ie++){let Ue=0;if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ht,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Qe[ie].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=Qe[ie].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Fe=>Fe.ComponentID==parseInt(Qe[ie].NODEID)&&0==Fe.RegimeType),this.dvEmpTaxComputation.length>0)Ft+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(Ue=0,Ue=parseFloat(Qe[ie].AMOUNT),"80D-Self/Spouse/Dependant Children"==Qe[ie].NAME.toString()||"80D-Self/Dependant/Parent (not Sr Citizen)"==Qe[ie].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==Qe[ie].NAME.toString()){De=!1;for(let Fe=0;Fe<this.dsTaxData.Tables[19].length;Fe++)if(this.dsTaxData.Tables[19][Fe].TaxmapName.toString()==Qe[ie].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][Fe].SNo)>0)for(let it=5;it<this.grdIncomeTax.ReportColumns.length-2;it++){De=!1;for(let ge=0;ge<g.length;ge++)if(g[ge].month.toString()==this.grdIncomeTax.ReportColumns[it].HeaderText.toString()){null!=g[ge]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)]&&""!=g[ge]["dcCalcNum"+m.J0.String(this.dsTaxData.Tables[19][Fe].SNo)].toString()&&(Ue+=parseFloat(g[ge]["dcCalcNum"+this.dsTaxData.Tables[19][Fe].SNo.toString()])),De=!0;break}if(!De)for(let ge=0;ge<p.length;ge++)if(parseInt(this.dsTaxData.Tables[19][Fe].componentID)==parseInt(p[ge].componentid)&&p[ge].FieldName.toString()==this.grdIncomeTax.ReportColumns[it].HeaderText.toString()&&parseFloat(p[ge].Amount)>0){null!=p[ge].Amount&&""!=p[ge].Amount.toString()&&(Ue+=parseFloat(p[ge].Amount)),De=!0;break}if(!De)for(let ge=0;ge<e.length;ge++)null!=e[ge]["Deduction"+this.dsTaxData.Tables[19][Fe].SNo.toString()]&&null!=e[ge]["Deduction"+this.dsTaxData.Tables[19][Fe].SNo.toString()]&&""!=e[ge]["Deduction"+this.dsTaxData.Tables[19][Fe].SNo.toString()].toString()&&(Ue+=parseFloat(e[ge]["Deduction"+this.dsTaxData.Tables[19][Fe].SNo.toString()]))}}Ft+=Ue,this.grdIncomeTax.Data[N].Cells[4].Value=m.J0.GetAmount(Ue)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):Ue),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,ht+=1}this.intNewOtherDeducunder8oCto80CCCIndex1=ht-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeIndex=this.intNewOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewTotalIncome=this.dblNewGrossTotalIncome-this.dblNewTotaldeduction80ccc80c-Ft,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeRoundoffIndex=this.dblNewTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.dblNewTotalIncomeRoundoff=Math.round(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblNewTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxOnTotalIncomeIndex=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewRebateIndex=this.dblNewTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[2].Value=-116,parseInt(this.cmbYear.SelectedValue)>=2023&&(this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.25,000 for Taxable Income below Rs.7,00,000/-)"),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableAfterRebateIndex=this.dblNewRebateIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSurchargeIndex=this.dblNewTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableIndex=this.dblNewSurchargeIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewEducationCessIndex=this.dblNewTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSecHighEduCessIndex=this.dblNewEducationCessIndex+1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalIncometaxPayableindex=this.dblNewSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[1].Value=this.intNewTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewTDSPaidIndex=this.intNewTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[1].Value=this.NewTDSPaidIndex,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=m.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxPayableIndex=this.NewTDSPaidIndex+1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[1].Value=this.NewNetTaxPayableIndex,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.UpdateTotalsNewRegime(this.dblNewTotalIncomeRoundoff)}}catch(l){Logger.ErrorLog("Error : "+l)}}cmbYear_SelectionChanged(l){this.clear(0),this.ITComputationViewModel.FilterEmployees(),this.ITComputationViewModel.lFinancialDate=this.ITComputationViewModel.GetFinancialYear(),null!=this.lstEmployee.SelectedValue&&0!=this.lstEmployee.SelectedValue&&(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.OnYearSelected("Year"),this.FillDetails())}PrintForm16_Click(l){var t=this;return(0,ne.A)(function*(){if(null==t.dtpDate.Date&&(t.dtpDate.Date=new Date),!(t.lstEmployee.SelectedValue>0))return t.obj.DisplayMessage="Select any Employee",void(t.obj.MessageVisibility=!0);t.txtPlace.Text.Trim(),t.dtpDate.Date.ToString("dd/MMM/yyyy"),t.LoadForm16PrintGrid(),t.Form16export()})()}LoadForm16PrintGrid(){let l,i="",o=-1,r=-1,h=-1,c=-1;this.grdPrint=new R.j,this.grdPrint.ItComput=!0,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let g=new se.bA;g.Alignment="Center",g.FontFamilyName="Arial",g.FontSize=12,g.IsBold=!0,g.BackColor="White",g.ForeColor="Black",g.IsVisible=!0;let p,u=new se.bA;u.Alignment="Left",u.FontFamilyName="Arial",u.FontSize=12,u.IsBold=!0,u.BackColor="White",u.ForeColor="#FF333333";for(let v=1;v<=10;v++)p=new B.D_,p.FieldName="Col"+v.toString(),p.width=70,p.HeaderText="Col"+v.toString(),p.HeaderAppearance=g,p.DataAppearance=u,this.grdPrint.ReportColumns.push(p);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=75,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=75,this.grdPrint.ReportColumns[6].width=40,this.grdPrint.ReportColumns[7].width=90,this.grdPrint.ReportColumns[8].width=90,this.grdPrint.ReportColumns[9].width=90;let e=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="[See rule 31(1)(a)]",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART A",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==d.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(v=>4==v.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Employee Reference No. provided by the Employer (If available)",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==d.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].Code&&null!=this.dsTaxData.Tables[18][0].Code?this.dsTaxData.Tables[18][0].Code.toString():"",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Summary of amount paid/credited and tax deducted at source thereon in respect of the employee",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Quarter(s)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="Receipt Numbers of original quarterly statements of TDS under sub-section (3) of Section 200",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="Amount paid/credited",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="Amount of tax deducted (Rs.)",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Amount of tax deposited/remitted in respect",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q1",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,o=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q2",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q3",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q4",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,r=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="I. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH BOOK ADJUSTMENT\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,h=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Book Identification Number (BIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="Receipt Numbers of Form No. 24G",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="DDO serial number in Form no. 24G",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Date of transfer voucher \r\n (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with Form no. 24G",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[h].Cells[0].rowSpan=2,this.grdPrint.Data[h].Cells[1].rowSpan=2,this.grdPrint.Data[h].Cells[2].rowSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].ColSpan=1,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="II. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH CHALLAN\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,c=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Challan Identification Number (CIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="BSR Code of the Bank Branch",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="Date on which Tax deposited (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Challan Serial Number",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with OLTAS*",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[c].Cells[0].rowSpan=2,this.grdPrint.Data[c].Cells[1].rowSpan=2,this.grdPrint.Data[c].Cells[2].rowSpan=2;let D=0,y=0,A=0,_=0,x=0,F=0,k=d.d.common.GetDataTable("INC001",this.iSelectedEmpSeqNo.toString()+"~"+this.obj.EmpYear.SelectedValue);if(null!=k&&k.length>0){if(l=k.filter(v=>"Monthly"==v.dcAlpha2),null!=l&&l.length>0){D=0;for(let v=0;v<l.length;v++)e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=v+1,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,F=0,F=m.J0.Double(l[v].dcNum5.toString()),this.grdPrint.Data[e].Cells[1].Value=F.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,D+=F,this.grdPrint.Data[e].Cells[3].Value=null!=l[v].dcAlpha5&&null!=l[v].dcAlpha5?l[v].dcAlpha5.toString():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value=null!=l[v].dcAlpha6&&null!=l[v].dcAlpha6?m.J0.ParseDate(l[v].dcAlpha6).ToString("dd'-'MMM'-'yyyy"):"",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value=null!=l[v].dcAlpha7&&null!=l[v].dcAlpha7?l[v].dcAlpha7.toString():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="F",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1}if(e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value=D.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=7,l=k.filter(v=>"Quarterly"==v.dcAlpha2),null!=l&&l.length>0){D=y=A=_=x=0;let v=0;for(let ke=0;ke<l.length;ke++)v=parseInt(l[ke].dcAlpha3.toString().Replace("Quarter",""))-1,this.grdPrint.Data[o+v].Cells[2].Value=null!=l[ke].dcAlpha8&&null!=l[ke].dcAlpha8?l[ke].dcAlpha8.toString():"",this.grdPrint.Data[o+v].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[o+v].Cells[2].ColSpan=2,F=0,0==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value):0):1==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value):0):2==v?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value):0):3==v&&(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value):0),this.grdPrint.Data[o+v].Cells[4].Value=F.ToString("0.00"),this.grdPrint.Data[o+v].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[o+v].Cells[4].ColSpan=2,D+=F,F=0,F=m.J0.Double(l[ke].dcNum6.toString()),this.grdPrint.Data[o+v].Cells[6].Value=F.ToString("0.00"),this.grdPrint.Data[o+v].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o+v].Cells[6].ColSpan=2,y+=F,F=0,F=m.J0.Double(l[ke].dcNum7.toString()),this.grdPrint.Data[o+v].Cells[8].Value=F.ToString("0.00"),this.grdPrint.Data[o+v].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o+v].Cells[8].ColSpan=2,A+=F}this.grdPrint.Data[r+1].Cells[4].Value=D.ToString("0.00"),this.grdPrint.Data[r+1].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[4].ColSpan=2,this.grdPrint.Data[r+1].Cells[6].Value=y.ToString("0.00"),this.grdPrint.Data[r+1].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[6].ColSpan=2,this.grdPrint.Data[r+1].Cells[8].Value=A.ToString("0.00"),this.grdPrint.Data[r+1].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[r+1].Cells[8].ColSpan=2}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+m.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that a sum of Rs. "+this.grdPrint.Data[r+1].Cells[6].Value+" ["+m.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[r+1].Cells[6].Value&&null!=this.grdPrint.Data[r+1].Cells[6].Value&&""!=this.grdPrint.Data[r+1].Cells[6].Value.toString()?this.grdPrint.Data[r+1].Cells[6].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" (in words)] has been deducted and a sum of Rs. "+this.grdPrint.Data[r+1].Cells[8].Value+" ["+m.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[r+1].Cells[6].Value&&null!=this.grdPrint.Data[r+1].Cells[6].Value&&""!=this.grdPrint.Data[r+1].Cells[6].Value.toString()?this.grdPrint.Data[r+1].Cells[8].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" ] has been deposited to the credit of the Central Government. I further certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, TDS deposited and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+m.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toString(),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Notes :",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="1. Part B (Annexure) of the certificate in Form No.16 shall be issued by the employer.\n\n2. If an assessee is employed under one employer during the year, Part 'A' of the certificate in Form No.16 issued for the quarter ending on 31st March of the financial year shall contain the details of tax deducted and deposited for all the quarters of the financial year.\n\n3. If an assessee is employed under more than one employer during the year, each of the employers shall issue Part A of the certificate in Form No.16 pertaining to the period for which such assessee was employed with each of the employers. Part B (Annexure) of the certificate in Form No. 16 may be issued by each of the employers or the last employer at the option of the assessee.\n\n4. To update PAN details in Income Tax Department database, apply for 'PAN change request' through NSDL or UTITSL.\n\n",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend used in Form 16",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   * Status of matching with OLTAS",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Description",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Definition",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="U",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Unmatched",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Deductors have not deposited taxes or have furnished incorrect particulars of tax payment. Final credit will be reflected only when payment details in bank match with details of deposit in TDS / TCS statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="P",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Provisional",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value='Provisional tax credit is effected only for TDS / TCS Statements filed by Government deductors."P" status will be changed to Final (F) on verification of payment details submitted by Pay and Accounts Officer (PAO)',this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="F",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Final",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="In case of non-government deductors, payment details of TDS / TCS deposited in bank by deductor have matched with the payment details mentioned in the TDS / TCS statement filed by the deductors. In case of government deductors, details of TDS / TCS booked in Government account have been verified by Pay & Accounts Officer (PAO)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="O",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Overbooked",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Payment details of TDS / TCS deposited in bank by deductor have matched with details mentioned in the TDS / TCS statement but the amount is over claimed in the statement. Final (F) credit will be reflected only when deductor reduces claimed amount in the statement or makes new payment for excess amount claimed in the statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Tag="Break",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART B",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==d.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(v=>4==v.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,l=this.dsTaxData.Tables[23].filter(v=>v.DBIndex==d.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Details of Salary Paid and any other income and tax deducted",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[0].ColSpan=6,this.grdPrint.Data[e].Cells[6].Value="Rs",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Rs.",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2;let f=0,b=0,N=0,ee=0,q=0,H=0,O=0,oe=0,pe=0;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="1.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross Salary",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Salary as per provisions contained in section 17(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Value of perquisites under section 17(2) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Profits in lieu of salary under section 17(3) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=7,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,b=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Reported total amount of salary received from other employer(s)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="0.00",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N=parseFloat(this.grdPrint.Data[e].Cells[8].Value),f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="2.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Allowances to the extent exempt under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Travel concession or assistance under section 10(5)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Death-cum-retirement gratuity under section 10(10)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Commuted value of pension under section 10(10A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Cash equivalent of leave salary encashment under section 10 (10AA)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="House rent allowance under section 10(13A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount of any other exemption under section 10 [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of any other exemption under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value,this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of exemption claimed under section 10\r\n [2(a)+2(b)+2(c)+2(d)+2(e)+2(g)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,b-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="3.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of salary received from current employer\r\n[1(d)-2(h)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=b.toString(),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="4.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Deductions under section 16",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Standard deduction under section 16(ia)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Entertainment allowance under section 16(ii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on employment under section 16(iii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="5.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of deductions under section 16\r\n[4(a)+4(b)+4(c)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),q=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="6.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value='Income chargeable under the head "Salaries"\r\n[(3+1(e))-5]',this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=N.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,q+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="7.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Add: Any other income reported by the employee under as per section 192 (2B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,ee=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income (or admissible loss) from house property reported by employee offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(-1*parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,ee+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income under the head Other Sources offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,ee+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="8.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of other income reported by the employee\r\n[7(a)+7(b)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=ee.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,q+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),O=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="9.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross total income (6+8)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=q.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,O+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="10.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions under Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,H=0;let ue=0;for(let v=this.intDeducunder8oCto80CCCIndex+1;v<this.intTotalDeducunder8oCto80CCCIndex;v++)if(null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCC-")){ue+=null!=this.grdIncomeTax.Data[v].Cells[4].Value&&""!=this.grdIncomeTax.Data[v].Cells[4].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[4].Value):0;break}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of life insurance premia, contributions to provident fund etc. under section 80C",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value-ue).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution to certain pension funds under section 80CCC",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=ue.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(1)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by taxpayer to pension scheme under section 80CCD (1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4;let Le=f;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total deduction under section 80C, 80CCC and 80CCD(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=(Le+parseFloat(null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00")).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(1B)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions in respect of amount paid/deposited to notified pension scheme under section 80CCD (1B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCD(2)-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by Employer to pension scheme under section 80CCD (2)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80D-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of health insurance premia under section 80D",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80DD-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Medical Treatment of handicapped Dependent under section 80DD",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80U-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (i)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Physically Disable Assesse under section 80U",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80E-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (j)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on loan taken for higher education under section 80E",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&(this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80G-")||this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GGA-")||this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GGC-"))&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (k)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total Deduction in respect of donations to certain funds, charitable institutions, etc. under section 80G",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=m.J0.Double(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80TTA-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (l)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on deposits in savings account under section 80TTA",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=m.J0.Double(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80EEB-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (m)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on Electric Vehicle Loan under section 80EEB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (n)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount deductible under any other provision(s) of Chapter VI-A [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=4,f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (o)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total of amount deductible under any other provision(s) of Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80CCF-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (p)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Amount invested in specific Government approved Infrastructure bonds under section 80CCF",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80DDB-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (q)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction for Medical Treatment of certain specified ailments for Self/Dependent under section 80DDB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let v=this.intOtherDeducunder8oCto80CCCIndex;v<=this.intOtherDeducunder8oCto80CCCIndex1;v++)null!=this.grdIncomeTax.Data[v].Cells[3].Value&&this.grdIncomeTax.Data[v].Cells[3].Value.toString().startsWith("80GG-")&&(f+=null!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[v].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (r)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of house rent paid who does not get HRA under section 80GG",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,H+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="11.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Aggregate of deductible amount under Chapter VI-A\r\n[10(d)+10(e)+10(f)+10(g)+10(h)+10(i)+10(j)+10(k)+10(l)+10(m)+10(n)+10(o)+10(p)+10(q)+10(r)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=H.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,O-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="12.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total taxable income (9-11)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=Math.round(O).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,oe=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="13.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on total income",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,oe+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="14.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Rebate under section 87A, if applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,oe-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="15.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Surcharge, wherever applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,oe+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="16.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Health and education cess",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,oe+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),pe=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="17.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax payable (13+15+16-14)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=oe.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,pe+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="18.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Relief under section 89 (attach details)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,pe-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="19.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Net tax payable (17-18)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=pe.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+m.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+m.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left"}generatePrintContent(l,t="",i=!1,o=!1){let r="",h="",c="",g="",p="";if(r+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",h+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",h+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",h+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",h+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",r+="<style>"+h.toString()+"</style>",p=r,p+=`<h3 style="text-align: center;">${t}</h3>`,p+=" <table  border=1  style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",o){p+="<thead>",p+="<tr>";for(let D=0;D<l.ReportColumns.length;D++){const y=l.ReportColumns[D];y.HeaderAppearance.IsVisible&&(p+=`<th  width=${y.width} ></th>`)}p+="</tr>",p+="</thead>"}else{p+="<thead>",p+="<tr>";for(let D=0;D<l.ReportColumns.length;D++){const y=l.ReportColumns[D];y.HeaderAppearance.IsVisible&&(p+=`<th class='hdr'  width=${y.width} >${y.HeaderText}</th>`)}p+="</tr>",p+="</thead>"}p+="<tbody>";for(let D=0;D<l.Data.length;D++){p+="<tr",D%2==1&&(p+=" class=alt"),p+=">";const y=l.Data[D];for(let A=0;A<l.ReportColumns.length;)l.ReportColumns[A].HeaderAppearance.IsVisible?(p+=y.Cells[A].ColSpan>1?`<td  align=${y.Cells[A].CellAppearance.Alignment} colspan=${y.Cells[A].ColSpan} `:"<td ",null!=y.Cells[A].CellAppearance&&(c=(y.Cells[A].CellAppearance.ForeColor.startsWith("#ff")||y.Cells[A].CellAppearance.ForeColor.startsWith("#FF"))&&9==y.Cells[A].CellAppearance.ForeColor.length?"#"+y.Cells[A].CellAppearance.ForeColor.substr(3):y.Cells[A].CellAppearance.ForeColor,g=(y.Cells[A].CellAppearance.BackColor.startsWith("#ff")||y.Cells[A].CellAppearance.BackColor.startsWith("#FF"))&&9==y.Cells[A].CellAppearance.BackColor.length?"#"+y.Cells[A].CellAppearance.BackColor.substr(3):y.Cells[A].CellAppearance.BackColor,p+=` style='background-color:${g} + ;color:${c}'`),p+=" >",p+=m.J0.StringValue(y.Cells[A].Value),p+="</td>",A+=y.Cells[A].ColSpan):A+=y.Cells[A].ColSpan;p+="</tr>"}return p+="</tbody>",p+="</table>",p}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-income-tax-computation"]],decls:110,vars:29,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex","padding","12px"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px 10px 0 10px"],[1,"row",2,"height","40px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"input_cntrl_label"],[1,"NoLabel",2,"margin-left","5px","width","100px"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label",2,"margin-left","10px"],[1,"NoLabel",2,"margin-left","5px","min-width","150px"],[1,"PactMasterTree","Pactpagetree",2,"height","calc(100% - 80px)","width","100%","border","1px solid rgb(204, 204, 204)"],[3,"obj"],[1,"row",2,"height","40px","margin-top","3px"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"NoLabel",2,"flex","1","margin-left","5px"],[1,"primary-btn-wicon",2,"flex","1","margin-left","5px",3,"click"],[1,"form-group","col-xl-2","col-md-2","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.j41(14,"span",6),s.bIt("click",function(){return i.btnSave_Click("Save")}),s.nrm(15,"i",7),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18,"\n      "),s.DNE(19,he,4,3,"span",8),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.btnSave_Click("Delete")}),s.nrm(22,"i",9),s.EFF(23),s.nI1(24,"translate"),s.k0s(),s.EFF(25,"\n      "),s.j41(26,"span",6),s.bIt("click",function(){return i.btnSave_Click("Clear")}),s.nrm(27,"i",10),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n      "),s.DNE(31,le,4,3,"span",11),s.EFF(32,"\n      "),s.DNE(33,Ie,4,3,"span",11),s.EFF(34,"\n      "),s.DNE(35,we,4,3,"span",11),s.EFF(36,"\n    "),s.k0s(),s.EFF(37,"\n  "),s.k0s(),s.EFF(38,"\n  "),s.j41(39,"div",12),s.EFF(40,"\n    "),s.j41(41,"div",13),s.EFF(42,"\n      "),s.j41(43,"div",14),s.EFF(44,"\n        "),s.j41(45,"label",15),s.EFF(46,"Financial Year "),s.k0s(),s.EFF(47,"\n        "),s.j41(48,"div",16),s.EFF(49,"\n          "),s.eu8(50,17),s.EFF(51,"\n        "),s.k0s(),s.EFF(52,"\n        "),s.j41(53,"label",18),s.EFF(54),s.k0s(),s.EFF(55,"\n      "),s.k0s(),s.EFF(56,"\n      "),s.j41(57,"div",14),s.EFF(58,"\n      "),s.j41(59,"label",15),s.EFF(60,"Employee "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",19),s.EFF(63,"\n          "),s.eu8(64,17),s.EFF(65,"\n        "),s.k0s(),s.EFF(66,"\n      "),s.k0s(),s.EFF(67,"\n      "),s.k0s(),s.EFF(68,"\n      "),s.j41(69,"div",20),s.EFF(70,"\n        "),s.nrm(71,"app-report-grid",21),s.EFF(72,"\n      "),s.k0s(),s.EFF(73,"\n      "),s.j41(74,"div",22),s.EFF(75,"\n        "),s.j41(76,"div",23),s.EFF(77,"\n          "),s.j41(78,"label",15),s.EFF(79,"Regime Opted For "),s.k0s(),s.EFF(80,"\n          "),s.j41(81,"div",24),s.EFF(82,"\n            "),s.eu8(83,17),s.EFF(84,"\n          "),s.k0s(),s.EFF(85,"\n          "),s.j41(86,"button",25),s.bIt("click",function(){return i.btnSave_Click("SaveRegime")}),s.EFF(87),s.nI1(88,"translate"),s.k0s(),s.EFF(89,"\n        "),s.k0s(),s.EFF(90,"\n        "),s.j41(91,"div",26),s.EFF(92,"\n       "),s.j41(93,"label",15),s.EFF(94,"Place"),s.k0s(),s.EFF(95,"\n        "),s.j41(96,"div",24),s.EFF(97,"\n          "),s.eu8(98,17),s.EFF(99,"\n        "),s.k0s(),s.EFF(100,"\n        "),s.j41(101,"div",24),s.EFF(102,"\n          "),s.eu8(103,17),s.EFF(104,"\n       "),s.k0s(),s.EFF(105,"\n      "),s.k0s(),s.EFF(106,"\n      \n    "),s.k0s(),s.EFF(107,"\n\n  "),s.k0s(),s.EFF(108,"\n  "),s.k0s(),s.EFF(109,"\n"),s.k0s()),2&t&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(7),s.JRh(s.bMT(17,21,"Save")),s.R7$(3),s.Y8G("ngIf",i.obj.PrintVisiblility),s.R7$(4),s.JRh(s.bMT(24,23,"Delete")),s.R7$(5),s.JRh(s.bMT(29,25,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.WorksheetVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.TDSPostVisiblility),s.R7$(15),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(4),s.JRh(i.obj.lFinancialDate),s.R7$(10),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(7),s.Y8G("obj",i.grdIncomeTax),s.R7$(12),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(4),s.JRh(s.bMT(88,27,"SaveRegime")),s.R7$(11),s.Y8G("obj",i.txtPlace)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpDate)("group",i.form))},dependencies:[fe.bT,Ye._,z.e,Xe.D9],encapsulation:2})}return V})();class Ge{constructor(){this.FromSlab=0,this.ToSlab=0,this.Percentage=0}}var _e=G(84769);class ye{constructor(a){this.MessageVisibility=!1,this.sBMConString="",this.bUseROffTimings=!1,this.bDocColumns=!1,this.bDirection=!1,this.sBMDBAdapterAccess="",this.IsAutoPost=!1,this.dtConfig=null,this.dicConf=new ae.bT,this.BMCDeviceBrandName=n.y$.PactComboBoxData3("BMCDeviceBrandName",10),this.BMCDatabaseType=n.y$.PactComboBoxData3("BMCDatabaseType",10),this.BMCServerName=new xe.Dw(0),this.BMCUserId=new xe.Dw(0),this.BMCPassword=new xe.Dw(0),this.BMCDatabaseName=new xe.Dw(0),this.ETMEmpTableName=new xe.Dw(0),this.ETMEmpSeqNo=new xe.Dw(0),this.ETMEmpCode=new xe.Dw(0),this.ETMEmpCodeInDevice=new xe.Dw(0),this.ETMEmpName=new xe.Dw(0),this.ETMEmpWhere=new xe.Dw(0),this.APTMAttendPunchTableName=new xe.Dw(0),this.APTMEmpSeqNo=new xe.Dw(0),this.APTMEmpCode=new xe.Dw(0),this.APTMEmpCodeInDevice=new xe.Dw(0),this.APTMPunchDateTime=new xe.Dw(0),this.APTMDeviceNo=new xe.Dw(0),this.APTMDeviceNoValues=new xe.Dw(0),this.APTMDirection=new xe.Dw(0),this.APTMDirectionInVal=new xe.Dw(0),this.APTMDirectionOutVal=new xe.Dw(0),this.APTMAttendPunchWhere=new xe.Dw(0),this.FromDate=new E.Lc(0),this.ToDate=new E.Lc(0),this.DPCDocumentName=n.y$.PactComboBoxData3("DPCDocumentName",10),this.ROTUseROffTimings=Je.c.PactCheckBoxData_1("Use Round off Timings",10),this.GetMultipleCheckINOUTInaDay=Je.c.PactCheckBoxData_1("Get Multiple Check IN/OUT in a Day",10),this.OverrideAttendanceDoc=Je.c.PactCheckBoxData_1("Override Attendance Document",10),this.DonotPullBiometricDataifAttendanceisposted=Je.c.PactCheckBoxData_1("Do not Pull Biometric Data if Attendance is posted",10),this.AutoPostAtaTime=Je.c.PactCheckBoxData_1("AutoPost At a Time",10),this.SortBasedOn=n.y$.PactComboBoxData3("SortBasedOn",10),this.GDBQchkUseQuery=Je.c.PactCheckBoxData_1("Use Query to get the Data",10),this.GDBQtxtQuery=new xe.Dw(0),this.sFilter="",this.sSelectedEmpSeqNos="",this.sSelectedEmpCodes="",this.sbPostErrLog="",this.oDocument=null,this.bOverrideAttendanceDoc=!1,this.bDonotPullBiometricDataifAttendanceisposted=!1,this.bAutoPostAtaTime=!1,this.dtShiftsData=null,this.dtBioMetData=null,this.dsbEmps=null,this.dsbDims=null,this.sEmpSeqNosOnGrid="",this.bGetMultipleCheckInOutInaDay=!0;try{Logger.InfoLog("BiometricConfigViewModel::Entering BiometricConfigViewModel()"),this.DisplayName=a,this.Title=a,this.DisplayMessage="",this.ShowConfigurations=!!d.d.SessionManager.IsActionAssigned(141,"Configuration"),this.Initialize(),this.subcontroller()}catch(l){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION BiometricConfigViewModel()\r\n"+l.Message+"\r\n"+l.stack)}}subcontroller(){var a=this;return(0,ne.A)(function*(){yield a.LoadConfig(),a.LoadGrid(),a.DPCDocumentName.SelectionChangedCommand.Subscribe(a,"DPCDocumentNameSelectionChanged"),a.sBMConString=a.GetBMConnString(),a.ToDate.Label="To Date",a.FromDate.Label="From Date"})()}Initialize(){this.BMCDeviceBrandName.Items.Clear(),this.BMCDeviceBrandName.Items.push(n._p.ComboBoxItems_2("***MANUAL***","1")),this.BMCDeviceBrandName.Items.push(n._p.ComboBoxItems_2("ViRDI->AC-5000RF","2")),this.BMCDeviceBrandName.SelectedValue="1",this.BMCDatabaseType.Items.Clear(),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("MS SQL Server","1")),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("MS Access","2")),this.BMCDatabaseType.Items.push(n._p.ComboBoxItems_2("API","3")),this.BMCDatabaseType.SelectedValue="1",this.DPCDocumentName.Items.Clear(),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Attendance","40089")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Time Sheet","40090")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Daily Attendance","40067")),this.DPCDocumentName.Items.push(n._p.ComboBoxItems_2("Employee wise Work Sheet","40087")),this.DPCDocumentName.SelectedValue="40090",this.SortBasedOn.Items.Clear(),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("None","1")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpCode","2")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpName","3")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("TreeView","4")),this.SortBasedOn.Items.push(n._p.ComboBoxItems_2("EmpCode Numeric","5")),this.SortBasedOn.SelectedValue="1",this.dgCol=new J.O7,this.dgvROffTimings=new re.vv,this.dgvROffTimings.Columns=[],this.dgvROffTimings.Width="",this.dgvROffTimings.AllowReorderColumns=!1,this.dgvROffTimings.CanUserResizeColumns=!0,this.dgvROffTimings.CanUserSortColumns=!1,this.dgvROffTimings.CanUserDeleteRows=!0,this.dgvROffTimings.CanUserAddRows=!0,this.dgCol=new J.O7,this.dgCol.Header="Start Time",this.dgCol.DisplayMember="StartTime",this.dgCol.ValueMember="StartTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="End Time",this.dgCol.DisplayMember="EndTime",this.dgCol.ValueMember="EndTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="ROff Time",this.dgCol.DisplayMember="ROffTime",this.dgCol.ValueMember="ROffTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgvROffTimings.Table=[],this.dgvROffTimings.TableColumns.push("StartTime"),this.dgvROffTimings.TableColumns.push("StartTime_Key"),this.dgvROffTimings.TableColumns.push("EndTime"),this.dgvROffTimings.TableColumns.push("EndTime_Key"),this.dgvROffTimings.TableColumns.push("ROffTime"),this.dgvROffTimings.TableColumns.push("ROffTime_Key"),this.dgvDocColumns=new re.vv,this.dgvDocColumns.Columns=[],this.dgvDocColumns.Width="",this.dgvDocColumns.AllowReorderColumns=!1,this.dgvDocColumns.CanUserResizeColumns=!0,this.dgvDocColumns.CanUserSortColumns=!1,this.dgvDocColumns.CanUserDeleteRows=!0,this.dgvDocColumns.CanUserAddRows=!1,this.dgCol=new J.O7,this.dgCol.Header="Source",this.dgCol.DisplayMember="Source",this.dgCol.ValueMember="Source_Key",this.dgCol.DataType="TextBlock",this.dgCol.ReadOnly=!0,this.dgCol.Width=150,this.dgvDocColumns.Columns.push(this.dgCol);let a=[],l=d.d.empService.GetQueryData(0,"BIO001","","","");l&&l.Tables.length>0&&(a=l.Tables[0]),this.dgCol=new J.O7,this.dgCol.Header="Destination",null!=a&&a.length>0&&(this.dgCol.ValueBinding="Destination",this.dgCol.DisplayMember="USERCOLUMNNAME",this.dgCol.ValueMember="SYSCOLUMNNAME",this.dgCol.DataType="ComboBox",this.dgCol.ReadOnly=!1,this.dgCol.Width=150,this.dvcol=a,this.dgCol.ComboData=this.dvcol,this.dgvDocColumns.Columns.push(this.dgCol)),this.dgvDocColumns.Table=[],this.dgvDocColumns.TableColumns.push("Source"),this.dgvDocColumns.TableColumns.push("Source_Key"),this.dgvDocColumns.TableColumns.push("Destination"),this.dgvDocColumns.TableColumns.push("Destination_Key")}LoadGrid(){this.dgv=new re.vv,this.dgv.Columns=[],this.dgv.Width="",this.dgv.HeaderHeight=40,this.dgv.AllowReorderColumns=!1,this.dgv.CanUserResizeColumns=!0,this.dgv.CanUserSortColumns=!1,this.dgv.CanUserDeleteRows=!0,this.dgv.IsReadOnly=!0,this.dgCol=new J.O7,this.dgCol.Header="#",this.dgCol.DisplayMember="SlNo",this.dgCol.ID="SlNo",this.dgCol.Width=45,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Employee Code",this.dgCol.DisplayMember="EmpCode",this.dgCol.ID="EmpCode",this.dgCol.Width=120,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Employee Name",this.dgCol.DisplayMember="EmpName",this.dgCol.ID="EmpName",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Punch Date",this.dgCol.DisplayMember="PunchDate",this.dgCol.ID="PunchDate",this.dgCol.Width=90,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Shift Code",this.dgCol.DisplayMember="ShiftCode",this.dgCol.ID="ShiftCode",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Shift Name",this.dgCol.DisplayMember="ShiftName",this.dgCol.ID="ShiftName",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Act.\nStart Time",this.dgCol.DisplayMember="ActStartTime",this.dgCol.ID="ActStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Act.\nEnd Time",this.dgCol.DisplayMember="ActEndTime",this.dgCol.ID="ActEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Act.\nTotal Hours",this.dgCol.DisplayMember="ActTotHrs",this.dgCol.ID="ActTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bUseROffTimings&&(this.dgCol=new J.O7,this.dgCol.Header="ROff\nStart Time",this.dgCol.DisplayMember="ROffStartTime",this.dgCol.ID="ROffStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="ROff\nEnd Time",this.dgCol.DisplayMember="ROffEndTime",this.dgCol.ID="ROffEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="ROff\nTotal Hours",this.dgCol.DisplayMember="ROffTotHrs",this.dgCol.ID="ROffTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&(this.dgCol=new J.O7,this.dgCol.Header=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.DisplayMember=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.ID=this.dgvDocColumns.Table[a].Source.toString(),this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bDocColumns=!0);this.dgCol=new J.O7,this.dgCol.Header="Remarks",this.dgCol.DisplayMember="Remarks",this.dgCol.ID="Remarks",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgv.Table=[],this.dgv.TableColumns.push("SlNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("PunchDate"),this.dgv.TableColumns.push("ShiftCode"),this.dgv.TableColumns.push("ShiftName"),this.dgv.TableColumns.push("ActStartTime"),this.dgv.TableColumns.push("ActEndTime"),this.dgv.TableColumns.push("ActTotHrs"),this.bUseROffTimings&&(this.dgv.TableColumns.push("ROffStartTime"),this.dgv.TableColumns.push("ROffEndTime"),this.dgv.TableColumns.push("ROffTotHrs"));for(let a=0;a<this.dgvDocColumns.Table.length;a++)null!=this.dgvDocColumns.Table[a].Destination&&null!=this.dgvDocColumns.Table[a].Destination&&""!=this.dgvDocColumns.Table[a].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[a].Destination.toString()&&this.dgv.TableColumns.push(this.dgvDocColumns.Table[a].Source.toString());this.dgv.TableColumns.push("Remarks"),this.dgv.TableColumns.push("Row_Background"),this.dgvFailedRecord=new re.vv,this.dgvFailedRecord.Columns=[],this.dgvFailedRecord.Width="",this.dgvFailedRecord.HeaderHeight=30,this.dgvFailedRecord.CanUserResizeColumns=!0,this.dgvFailedRecord.IsReadOnly=!0,this.dgCol=new J.O7,this.dgCol.Header="Attendance Date",this.dgCol.DisplayMember="AttendanceDate",this.dgCol.ID="AttendanceDate",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Code",this.dgCol.DisplayMember="Code",this.dgCol.ID="Code",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Name",this.dgCol.DisplayMember="Name",this.dgCol.ID="Name",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new J.O7,this.dgCol.Header="Message",this.dgCol.DisplayMember="Message",this.dgCol.ID="Message",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgvFailedRecord.Table=[],this.dgvFailedRecord.TableColumns.push("AttendanceDate"),this.dgvFailedRecord.TableColumns.push("Code"),this.dgvFailedRecord.TableColumns.push("Name"),this.dgvFailedRecord.TableColumns.push("Message")}dgv_BeforeRowDeleting(a){return!1}LoadConfig(){var a=this;return(0,ne.A)(function*(){a.dicConf.Clear();let l=d.d.empService.GetQueryData(0,"BIO002","","","");if(l&&l.Tables.length>0&&(a.dtConfig=l.Tables[0]),null!=a.dtConfig&&a.dtConfig.length>0){for(let t=0;t<a.dtConfig.length;t++)a.dicConf.push(m.J0.String(a.dtConfig[t].Name),m.J0.String(a.dtConfig[t].Value));if(a.drc=a.dtConfig.filter(t=>"BMCDeviceBrandName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDeviceBrandName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCDatabaseType"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseType.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCServerName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCServerName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCUserId"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCUserId.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"BMCPassword"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&""!=a.drc[0].Value.toString()){let t=yield d.d.empService.DecryptString(a.drc[0].Value.toString());a.BMCPassword.Text=t.DecryptString}if(a.drc=a.dtConfig.filter(t=>"BMCDatabaseName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.BMCDatabaseName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpTableName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpSeqNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpCode"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpCodeInDevice"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ETMEmpWhere"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ETMEmpWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMAttendPunchTableName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchTableName.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpSeqNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpSeqNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpCode"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCode.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMEmpCodeInDevice"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMEmpCodeInDevice.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMPunchDateTime"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMPunchDateTime.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDeviceNo"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNo.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDeviceNoValues"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDeviceNoValues.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirection"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirection.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirectionInVal"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionInVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMDirectionOutVal"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMDirectionOutVal.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"APTMAttendPunchWhere"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.APTMAttendPunchWhere.Text=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"DPCDocumentName"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DPCDocumentName.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"GetMultipleCheckINOUTInaDay"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GetMultipleCheckINOUTInaDay.IsChecked=(0,Q.yG0)(a.drc[0].Value),a.bGetMultipleCheckInOutInaDay=(0,Q.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"OverrideAttendanceDoc"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.OverrideAttendanceDoc.IsChecked=(0,Q.yG0)(a.drc[0].Value),a.bOverrideAttendanceDoc=(0,Q.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"DonotPullBiometricDataifAttendanceisposted"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.DonotPullBiometricDataifAttendanceisposted.IsChecked=(0,Q.yG0)(a.drc[0].Value),a.bDonotPullBiometricDataifAttendanceisposted=(0,Q.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"AutoPostAtaTime"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.AutoPostAtaTime.IsChecked=(0,Q.yG0)(a.drc[0].Value),a.bAutoPostAtaTime=(0,Q.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"SortBasedOn"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.SortBasedOn.SelectedValue=a.drc[0].Value.toString()),a.drc=a.dtConfig.filter(t=>"ROTUseROffTimings"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.ROTUseROffTimings.IsChecked=(0,Q.yG0)(a.drc[0].Value),a.bUseROffTimings=a.ROTUseROffTimings.IsChecked),a.dgvROffTimings.Clear(),a.drc=a.dtConfig.filter(t=>"ROffTimingsXML"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsROffTimings=new m.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsROffTimings.ReadXml(a.drc[0].Value.toString());let t=new m.VB;t.LoadXml(a.drc[0].Value.toString());let i=t.SelectSingleNode("RoundOffTimings");if(null!=i){let o;if(i.childNodes.length>0)for(let r=0;r<i.childNodes.length;r++)o=a.dgvROffTimings.NewRow(),o.StartTime=i.childNodes[r].attributes.MinsFrom.value,o.StartTime_Key=i.childNodes[r].attributes.MinsFrom.value,o.EndTime=i.childNodes[r].attributes.MinsUpto.value,o.EndTime_Key=i.childNodes[r].attributes.MinsUpto.value,o.ROffTime=i.childNodes[r].attributes.ROffTime.value,o.ROffTime_Key=i.childNodes[r].attributes.ROffTime.value,a.dgvROffTimings.addRow(o)}}if(a.dgvDocColumns.Clear(),a.drc=a.dtConfig.filter(t=>"DocColumnsXML"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value){a.dsDocColumns=new m.VB,a.drc[0].Value.toString().Contains("\r\n")&&(a.drc[0].Value=a.drc[0].Value.toString().Replace("\r\n","")),a.dsDocColumns.ReadXml(a.drc[0].Value.toString());let t=new m.VB;t.LoadXml(a.drc[0].Value.toString());let i=t.SelectSingleNode("DocColumns");if(null!=i){let o;if(i.childNodes.length>0)for(let r=0;r<i.childNodes.length;r++)o=a.dgvDocColumns.NewRow(),o.Source=i.childNodes[r].attributes.Source.value,o.Source_Key=i.childNodes[r].attributes.Source.value,o.Destination=i.childNodes[r].attributes.Destination.value,o.Destination_Key=i.childNodes[r].attributes.Destination.value,a.dgvDocColumns.addRow(o)}}a.drc=a.dtConfig.filter(t=>"GDBQchkUseQuery"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQchkUseQuery.IsChecked=(0,Q.yG0)(a.drc[0].Value)),a.drc=a.dtConfig.filter(t=>"GDBQtxtQuery"==t.Name),null!=a.drc&&a.drc.length>0&&null!=a.drc[0].Value&&(a.GDBQtxtQuery.Text=a.drc[0].Value.toString().Replace("[ENTER]","\r\n"))}})()}OnButtonClick(a){if(null!=a&&"BMCTestConn"!=a.toString()&&"SaveConfig"!=a.toString())if("GetData"==a.toString())this.GetData_Click();else if("PostData"==a.toString())this.PostData_Click();else if("Export"==a.toString())this.Export_Click();else if("ExportFailedRecords"==a.toString()){let l="";l+="<html><body style='color:blac;background-color:white;'>",l+="<style>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}",l+="</style>",l+="<table border=1 width='950' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >",l+="<tr><td class='hdr'><b>Sno<b></td>",l+="<td class='hdr' width='150'><b>Daily Attendance Date<b></td>",l+="<td class='hdr' width='150'><b>Code<b></td>",l+="<td class='hdr' width='150'><b>Name<b></td>",l+="<td class='hdr' width='750'><b>Message<b></td></tr>";let t=new m.VB;t.LoadXml(this.sbPostErrLog.toString());let i=t.SelectSingleNode("FailedRecord");if(null!=i&&i.childNodes.length>0)for(let o=0;o<i.childNodes.length;o++)l+="<tr",l+=">",l+="<td align='left' >"+o+"1</td>",l+="<td align='left' >"+i.childNodes[o].attributes.DADate!=null?i.childNodes[o].attributes.DADate.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Code!=null?i.childNodes[o].attributes.Code.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Name!=null?i.childNodes[o].attributes.Name.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Error!=null?i.childNodes[o].attributes.Error.value:"</td>",l+="</tr>";l+="</table>",l+="</body>",l+="</html>"}}Filter_Click(){var a=this;return(0,ne.A)(function*(){if(a.sSelectedEmpSeqNos=a.sSelectedEmpCodes="",null==a.objEmpFilter?a.objEmpFilter=new $e.t("",0,11):(a.objEmpFilter.Filter=11,a.objEmpFilter.InitControls()),a.objEmpFilter.Filter>0&&(yield d.d.page.openDialog(a.objEmpFilter,pt.m,{ShowCenter:!0})),a.objEmpFilter.IsCompleted)if(a.objEmpFilter.CostCenterFilters.length>0){let l=1,t="",i="",o="";a.objEmpFilter.CostCenterFilters.forEach(h=>{if(h.CostCenterID>5e4&&(l=2,t="NodeID",i=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)o+=" AND ",o+=i+"="+h.SelectedNodes[0].Id;else if(null==h.SelectedNodes.find(g=>g.Id==l&&g.IsGroup))if(o+=" AND ",Ct.IPrefetchFilter.IsGroupTree(h)){let g="";for(let u=0;u<h.SelectedNodes.length;u++)(null==h.SelectedNodes[u].Parent||!h.SelectedNodes[u].Parent.IsSelected)&&(g.length>0&&(g+=","),g+=h.SelectedNodes[u].Id);0==g.length&&(g+=-12912),o+=i+" IN ",o+=" (select T."+t+" GTID from ",o+=et.A.GetTagTableName(h.CostCenterID)+" T with(nolock),",o+=et.A.GetTagTableName(h.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+t+" IN (",o+=g.toString()+")  group by T."+t+")"}else{o+=i+" IN (";for(let g=0;g<h.SelectedNodes.length;g++)g>0&&(o+=","),o+=h.SelectedNodes[g].Id;o+=")"}}else h.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}),a.sFilter=o.toString(),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(a.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(a.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let r=[];if(r.push(a.ToDate.Date.ToString("dd MMM yyyy")),r.push(a.sFilter),r.push(0),r.push(d.d.SessionManager.RoleID),r.push(d.d.SessionManager.UserID),r.push(d.d.SessionManager.LanguageID),a.dtFiltEmps=d.d.common.GetDataSet_SP(r,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let h=0;h<a.dtFiltEmps.length;h++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[h].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[h].EmpCode.toString()+"'"}else a.objEmpFilter.Filter>0&&a.FilterEmployees()})()}FilterEmployees(){try{Logger.InfoLog("BiometricConfigViewModel::Entering FilterEmployees()"),d.d.SessionManager.LocationID>0&&d.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&d.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+d.d.SessionManager.LocationID+")"),m.J0.IsEmpty(d.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+d.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let a=[];if(a.push(this.ToDate.Date.ToString("dd MMM yyyy")),a.push(this.sFilter),a.push(0),a.push(d.d.SessionManager.RoleID),a.push(d.d.SessionManager.UserID),a.push(d.d.SessionManager.LanguageID),this.dtFiltEmps=d.d.common.GetDataSet_SP(a,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=this.dtFiltEmps&&this.dtFiltEmps.length>0)for(let l=0;l<this.dtFiltEmps.length;l++)this.sSelectedEmpSeqNos.length>0&&(this.sSelectedEmpSeqNos+=",",this.sSelectedEmpCodes+=","),this.sSelectedEmpSeqNos+=this.dtFiltEmps[l].EmpSeqNo.toString(),this.sSelectedEmpCodes+="'"+this.dtFiltEmps[l].EmpCode.toString()+"'";Logger.InfoLog("BiometricConfigViewModel::Exiting FilterEmployees()")}catch(a){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION FilterEmployees()\r\n"+a.Message+"\r\n"+a.stack)}}Export_Click(){}PostData_Click(){nt.RibbonExtViewModel.GetPay_BioPostData(this)}GetGroupByFilterEmployees(){let a="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",l=[];return l.push(this.ToDate.Date.ToString("dd MMM yyyy")),l.push(a),l.push(0),l.push(d.d.SessionManager.RoleID),l.push(d.d.SessionManager.UserID),l.push(d.d.SessionManager.LanguageID),d.d.common.GetDataSet_SP(l,"spPAY_GetEmpMasterCCDetails").Tables[0]}CreateSQLTable(a,l){let t="",i="",o="";t=" CREATE TABLE "+a+"(";for(let r=0;r<l.Columns.length;r++){switch(o="",i=l.Columns[r].DataType.toString(),i){case"System.Int32":o=" int ";break;case"System.Int64":o=" bigint ";break;case"System.Int16":o=" smallint ";break;case"System.Byte":o=" tinyint ";break;case"System.Decimal":o=" float ";break;case"System.DateTime":o=" datetime ";break;case"System.String":o=m.J0.Format(" nvarchar({0}) ",-1==l.Columns[r].MaxLength?"max":l.Columns[r].MaxLength.toString())}""!=o?(t+="\n ["+l.Columns[r].ColumnName+"] ",t+=o,t+=","):(l.Columns.Remove(l.Columns[r].ColumnName),l.AcceptChanges(),r--)}return t.substr(0,t.length-1)+"\n)"}BulkInsertData(a,l){}GetShiftsAssignedData(){let l=d.d.empService.GetQueryData(0,"BIO003",d.d.SessionManager.Preferences.ShiftAssignBasedOn,this.FromDate.Date.ToString("dd MMM yyyy"),this.ToDate.Date.ToString("dd MMM yyyy"));l&&l.Tables.length>0&&(this.dtShiftsData=l.Tables[0])}GetBioMetricData(){this.dicConf.APTMAttendPunchTableName=this.dicConf.APTMAttendPunchTableName.Replace("@Month",this.FromDate.Date.iMonth().toString()).Replace("@Year",this.FromDate.Date.getFullYear().toString());let a="\n        Select EmpCode, EmpName, CONVERT(VARCHAR(11), PunchTime, 106) as PunchDate, PunchTime, CONVERT(VARCHAR(8), PunchTime, 108) as PTime ";this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=",DeviceNo as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,Direction as Direction",this.bDirection=!0),a+=" FROM ( Select EMP."+this.dicConf.ETMEmpCode+" as EmpCode, EMP."+this.dicConf.ETMEmpName+" as EmpName, ",a+=" AP."+this.dicConf.APTMPunchDateTime+" as PunchTime ",this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDeviceNo+" as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(a+=" ,AP."+this.dicConf.APTMDirection+" as Direction "),a+=" From "+this.dicConf.APTMAttendPunchTableName+" AP WITH(NOLOCK)",""!=this.dicConf.APTMEmpSeqNo?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpSeqNo+"=AP."+this.dicConf.APTMEmpSeqNo+" ":""!=this.dicConf.APTMEmpCode?a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCode+"=AP."+this.dicConf.APTMEmpCode:""!=this.dicConf.APTMEmpCodeInDevice&&(a+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCodeInDevice+"=AP."+this.dicConf.APTMEmpCodeInDevice),a+=" WHERE 1=1 ",this.sSelectedEmpCodes.Trim().length>0&&(a+=" AND EMP."+this.dicConf.ETMEmpCode+" IN ("+this.sSelectedEmpCodes+") "),this.dicConf.ETMEmpWhere.Trim().length>0&&(a+=" AND "+this.dicConf.ETMEmpWhere),this.dicConf.APTMAttendPunchWhere.Trim().length>0&&(a+=" AND "+this.dicConf.APTMAttendPunchWhere),this.dicConf.APTMDeviceNo.Trim().length>0&&this.dicConf.APTMDeviceNoValues.Trim().length>0&&(a+=" AND AP."+this.dicConf.APTMDeviceNo+" IN("+this.dicConf.APTMDeviceNoValues+")"),a+=" AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+"')<=0 AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"')>=0\n) as tbl\n        Order By PunchTime, EmpCode ";let l=[];l.push(this.BMCDatabaseType.SelectedValue),l.push(this.BMCServerName.Text.Trim()),l.push(this.BMCDatabaseName.Text.Trim()),l.push(this.BMCUserId.Text.Trim()),l.push(this.BMCPassword.Text);let t=d.d.empService.ReportDataSet("RPT022",!0,a,"","","","",l);this.dtBioMetData=t.Tables[0]}GetData_Click(){var a=this;return(0,ne.A)(function*(){let l=0;if(a.sEmpSeqNosOnGrid="",a.ListVisbility=!1,yield a.LoadConfig(),a.IsAutoPost){let h=[];if(h.push(a.ToDate.Date.ToString("dd MMM yyyy")),h.push(a.sFilter),h.push(0),h.push(d.d.SessionManager.RoleID),h.push(d.d.SessionManager.UserID),h.push(d.d.SessionManager.LanguageID),a.dtFiltEmps=d.d.common.GetDataSet_SP(h,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=a.dtFiltEmps&&a.dtFiltEmps.length>0)for(let c=0;c<a.dtFiltEmps.length;c++)a.sSelectedEmpSeqNos.length>0&&(a.sSelectedEmpSeqNos+=",",a.sSelectedEmpCodes+=","),a.sSelectedEmpSeqNos+=a.dtFiltEmps[c].EmpSeqNo.toString(),a.sSelectedEmpCodes+="'"+a.dtFiltEmps[c].EmpCode.toString()+"'"}else yield a.Filter_Click();if(a.FromDate.Date>a.ToDate.Date)return a.DisplayMessage="'From Date' should be less than or Equal to 'To Date'",void(a.MessageVisibility=!0);if(0==a.sSelectedEmpCodes.length)return a.DisplayMessage="No Employees found",void(a.MessageVisibility=!0);a.DispMessage="Loading data, Please wait....",a.MsgVisibility=!0;let t="";for(let h=0;h<a.dgvDocColumns.Table.length;h++)null!=a.dgvDocColumns.Table[h].Destination&&null!=a.dgvDocColumns.Table[h].Destination&&""!=a.dgvDocColumns.Table[h].Destination.toString()&&"-1"!=a.dgvDocColumns.Table[h].Destination.toString()&&a.dgvDocColumns.Table[h].Destination.toString().startsWith("dcCCNID")&&(t.length>0&&(t+=","),t+=(5e4+parseInt(a.dgvDocColumns.Table[h].Destination.toString().Replace("dcCCNID",""))).toString());t.length>0&&(a.dsbDims=d.d.empService.GetQueryData(0,"BIO007",JSON.stringify(t),"",""));let i="";if(a.dsbEmps=d.d.empService.GetQueryData(0,"BIO004","","",""),a.dgv.Clear(),a.GDBQchkUseQuery.IsChecked&&a.GDBQtxtQuery.Text.Trim().length>0){let h=[],c="";if("1"==a.BMCDatabaseType.SelectedValue){c=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","'"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@TODATE@","'"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=d.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}else if("2"==a.BMCDatabaseType.SelectedValue){c=a.GDBQtxtQuery.Text.Replace("@FROMDATE@","#"+a.FromDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@TODATE@","#"+a.ToDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@EMPCODES@",a.sSelectedEmpCodes).Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString());try{h=d.d.empService.GetData_ClickData(a.Title,a.sFilter,a.FromDate.Date.ToString("dd MMM yyyy"),a.ToDate.Date.ToString("dd MMM yyyy"),a.sSelectedEmpCodes)}catch(g){return a.MsgVisibility=!1,a.DisplayMessage=g.Message,void(a.MessageVisibility=!0)}}if(null!=h&&h.Tables.length>0&&h.Tables[0].length>0){let g,u;l=0;for(let p=0;p<h.Tables[0].length;p++)u=a.dsbEmps.Tables[0].filter(e=>e.Code==h.Tables[0][p].EmpCode.toString()),null!=u&&u.length>0&&(a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=u[0].NodeID.toString(),l++,g=a.dgv.NewRow(),g.SlNo=l.toString(),g.EmpCode=h.Tables[0][p].EmpCode,g.EmpName=h.Tables[0][p].EmpName,g.PunchDate=new Date(h.Tables[0][p].PunchDate).ToString("dd/MMM/yyyy"),g.ShiftCode=h.Tables[0][p].ShiftCode,g.ShiftName=h.Tables[0][p].ShiftName,h.Tables[0][p].StartTime.toString().Contains(".")||(h.Tables[0][p].StartTime=h.Tables[0][p].StartTime.toString().Contains(":")?h.Tables[0][p].StartTime.toString().Replace(":","."):h.Tables[0][p].StartTime.toString()+".0"),g.ActStartTime=new Date(h.Tables[0][p].StartTime.toString().Replace(".",":")).ToString("HH:mm"),h.Tables[0][p].EndTime.toString().Contains(".")||(h.Tables[0][p].EndTime=h.Tables[0][p].EndTime.toString().Contains(":")?h.Tables[0][p].EndTime.toString().Replace(":","."):h.Tables[0][p].EndTime.toString()+".0"),g.ActEndTime=new Date(h.Tables[0][p].EndTime.toString().Replace(".",":")).ToString("HH:mm"),g.ActTotHrs=parseFloat(h.Tables[0][p].TotHrs).ToString("00.00"),0==parseFloat(g.ActTotHrs)&&(g.Row_Background="#F77B7E"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(g["IN Device No"]=h.Tables[0][p].INDeviceNo),a.dgv.TableColumns.Contains("OUT Device No")&&(g["OUT Device No"]=h.Tables[0][p].OUTDeviceNo)),g.Remarks="",a.dgv.addRow(g));a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0;return}if("2"==a.BMCDatabaseType.SelectedValue){a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim();let g="";g=" SELECT * FROM "+a.dicConf.ETMEmpTableName,a.dicConf.APTMAttendPunchTableName=a.dicConf.APTMAttendPunchTableName.Replace("@Month",a.FromDate.Date.iMonth().toString()).Replace("@Year",a.FromDate.Date.getFullYear().toString()),g=" SELECT * FROM "+a.dicConf.APTMAttendPunchTableName+" WHERE DateValue("+a.dicConf.APTMPunchDateTime+") BETWEEN #"+a.FromDate.Date.AddDays(-1).ToString("dd/MMM/yyyy")+"# AND #"+a.ToDate.Date.AddDays(1).ToString("dd/MMM/yyyy")+"#"}"3"==a.BMCDatabaseType.SelectedValue&&(a.dicConf.ETMEmpTableName=a.ETMEmpTableName.Text.Trim(),a.dicConf.APTMAttendPunchTableName=a.APTMAttendPunchTableName.Text.Trim());let o=[],r=!1;if(""!=a.dicConf.ETMEmpTableName.Trim()&&""!=a.dicConf.APTMAttendPunchTableName.Trim()){if(null!=a.dtFiltEmps&&a.dtFiltEmps.length>0){if(a.GetShiftsAssignedData(),null==a.dtShiftsData||0==a.dtShiftsData.length)return a.MsgVisibility=!1,a.DisplayMessage="Enter atlest one Shift Assign document for Default Employee",void(a.MessageVisibility=!0);let c=d.d.SessionManager.Preferences.ShiftAssignBasedOn;a.GetBioMetricData();let g=[];g.push("EmpSeqNo"),g.push("EmpCode"),g.push("EmpName"),g.push("PunchDate"),g.push("StartTime"),g.push("EndTime"),g.push("TotHrs"),a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&g.push("IN Device No"),a.dgv.TableColumns.Contains("OUT Device No")&&g.push("OUT Device No")),g.push("Remarks"),g.push("lfts"),g.push("EmpCodeNumeric");let e,D,y,A,_,x,F,u=a.FromDate.Date.OnlyDate(),p=a.ToDate.Date.OnlyDate(),k=null,f="",b="",N=!1,ee=0,q=0;l=0;let H=a.dtBioMetData.ToTable(!0,["EmpCode","EmpName"]);if(null!=H&&H.length>0){let O=null,oe="";for(let Le=0;Le<H.length;Le++)y=a.dtFiltEmps.filter(v=>v.EmpCode==H[Le].EmpCode.toString()),null!=y&&y.length>0&&(oe.length>0&&(oe+=","),oe+=y[0].EmpSeqNo.toString());if("-2"!=c){let Le=[];Le.push(p.ToString("dd MMM yyyy")),Le.push(" AND EmpSeqNo IN("+oe+")"),Le.push(0),Le.push(d.d.SessionManager.RoleID),Le.push(d.d.SessionManager.UserID),Le.push(d.d.SessionManager.LanguageID),O=d.d.common.GetDataSet_SP(Le,"spPAY_GetEmpMasterCCDetails").Tables[0]}a.bDonotPullBiometricDataifAttendanceisposted&&(i="",40067==parseInt(a.DPCDocumentName.SelectedValue)||40087==parseInt(a.DPCDocumentName.SelectedValue)?i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tDocumentType = 67 AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+oe+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') ":(40089==parseInt(a.DPCDocumentName.SelectedValue)||40090==parseInt(a.DPCDocumentName.SelectedValue))&&(i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tCostCenterID = "+parseInt(a.DPCDocumentName.SelectedValue)+" AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+oe+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+a.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+a.ToDate.Date.ToString("dd/MMM/yyyy")+"') "),i.Trim().length>0&&(k=d.d.empService.GetQueryData(parseInt(a.DPCDocumentName.SelectedValue),"BIO008",JSON.stringify(oe),a.FromDate.Date.ToString("dd/MMM/yyyy"),a.ToDate.Date.ToString("dd/MMM/yyyy"))));let pe=null,ue=null;for(;u<=p;){for(let Le=0;Le<H.length;Le++){if(r=!1,y=a.dtFiltEmps.filter(be=>be.EmpCode==H[Le].EmpCode.toString()),null!=y&&y.length>0){if(u<m.J0.ParseDate(y[0].DOJ))continue;b=y[0].EmpSeqNo.toString(),ee=parseInt(y[0].lft)}if(a.bDonotPullBiometricDataifAttendanceisposted&&null!=k&&k.length>0&&(_=k.filter(be=>be.EmpSeqNo==b&&be.DADate==u.ToString("dd/MMM/yyyy")),null!=_&&_.length>0))continue;l++,e={},e.SNo=l.toString(),e.EmpSeqNo=b,e.lfts=ee,null!=a.SortBasedOn.SelectedValue&&"5"==a.SortBasedOn.SelectedValue&&(q=0,q=m.J0.Int(H[Le].EmpCode),e.EmpCodeNumeric=q>0?q:0),e.EmpCode=H[Le].EmpCode,e.EmpName=H[Le].EmpName,e.PunchDate=u.ToString("dd/MMM/yyyy"),N=!1;let v="",ke=a.dtShiftsData;if("-2"==c)v="EmpSeqNo IN(1,"+b+") ",ke=ke.filter(be=>1==be.EmpSeqNo||be.EmpSeqNo==b);else{let be="",me=c.split(",");if(null!=me&&me.length>0){let ve=O.filter(de=>de.EmpSeqNo==b);for(let de=0;de<me.length;de++)null!=me[de]&&""!=me[de]&&(be="-2"==me[de]?"EmpSeqNo":"dcCCNID"+(parseInt(me[de])-5e4),v.length>0&&(v+=" AND "),v+=be+"="+ve[0][be.Replace("dcCCNID","CCNID")],ke=ke.filter(We=>We[be]==ve[0][be.Replace("dcCCNID","CCNID")]))}}if(f=v+" AND AssigningFrom <='"+u.ToString("dd/MMM/yyyy")+"' AND AssigningUpto >='"+u.ToString("dd/MMM/yyyy")+"'",ke=ke.filter(be=>null!=be.AssigningFrom&&new Date(be.AssigningFrom).ToString("dd/MMM/yyyy")<=u.ToString("dd/MMM/yyyy")&&null!=be.AssigningUpto&&new Date(be.AssigningUpto).ToString("dd/MMM/yyyy")>=u.ToString("dd/MMM/yyyy")),y=ke,y.sort((be,me)=>be.DocID>me.DocID||be.DocID==me.DocID&&be.EmpSeqNo>me.EmpSeqNo?1:-1),null!=y&&y.length>0){let be=(new Date).OnlyDate();if(x=m.J0.ParseDate(be.ToString("dd/MMM/yyyy")+" "+y[0].ShiftBMStartTime),F=m.J0.ParseDate(be.ToString("dd/MMM/yyyy")+" "+y[0].ShiftBMEndTime),x>F?(x=u.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=u.AddDays(1).AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())):(x=u.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=u.AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())),f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"'",A=a.dtBioMetData.filter(me=>me.EmpCode==e.EmpCode.toString()&&new Date(me.PunchTime)>=x&&new Date(me.PunchTime)<=F),A.sort((me,ve)=>me.PunchTime-ve.PunchTime),!(null!=A&&A.length>0))continue;if(1==A.length)e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),F=x,a.bDirection&&(e.Remarks=a.APTMDirectionInVal.Text==A[0].Direction.toString()?"Check-Out Missing":"Check-In Missing"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[0].DeviceNo.toString());else if(a.bDirection){let me=!1,ve=!1;if(a.bGetMultipleCheckInOutInaDay){for(let de=0;de<A.length;de++){me=!1,ve=!1,D={};for(let We=0;We<e.ItemArray.length;We++)D[We]=e[We];a.APTMDirectionInVal.Text==A[de].Direction.toString()&&(D.StartTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(D["IN Device No"]=A[de].DeviceNo.toString()),me=!0),a.APTMDirectionOutVal.Text==A[de].Direction.toString()&&(D.EndTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[de].DeviceNo.toString()),ve=!0),(me||ve)&&(A.length>de+1?(me&&(a.APTMDirectionOutVal.Text==A[de+1].Direction.toString()?(D.EndTime=new Date(A[de+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[de+1].DeviceNo.toString()),de++):(D.EndTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[de].DeviceNo.toString()),D.Remarks="Check-Out Missing",F=x)),ve&&(D.StartTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(D["IN Device No"]=A[de].DeviceNo.toString()),D.Remarks="Check-In Missing",F=x)):(me&&(D.EndTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[de].DeviceNo.toString()),D.Remarks="Check-Out Missing",F=x),ve&&(D.StartTime=new Date(A[de].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(D["IN Device No"]=A[de].DeviceNo.toString()),D.Remarks="Check-In Missing",F=x)),x=new Date(x.ToString("dd/MMM/yyyy")+" "+D.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+D.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString()),D.TotHrs=nt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(D))}N=!0}else{if(f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionInVal.Text+"'",pe=a.dtBioMetData.filter(de=>de.EmpCode==e.EmpCode.toString()&&new Date(de.PunchTime)>=x&&new Date(de.PunchTime)<=F&&de.Direction==a.APTMDirectionInVal.Text),pe.sort((de,We)=>de.PunchTime-We.PunchTime),null!=pe&&pe.length>0&&(me=!0,e.StartTime=new Date(pe[0].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=pe[0].DeviceNo.toString())),f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+a.APTMDirectionOutVal.Text+"'",ue=a.dtBioMetData.filter(de=>de.EmpCode==e.EmpCode.toString()&&new Date(de.PunchTime)>=x&&new Date(de.PunchTime)<=F&&de.Direction==a.APTMDirectionInVal.Text),ue.sort((de,We)=>de.PunchTime-We.PunchTime),null!=ue&&ue.length>0&&(me?new Date(ue[ue.length-1].PunchTime)>new Date(pe[0].PunchTime)&&(ve=!0,e.EndTime=new Date(ue[ue.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=ue[ue.length-1].DeviceNo.toString())):(ve=!0,e.EndTime=new Date(ue[ue.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=ue[ue.length-1].DeviceNo.toString()))),!me&&!ve)continue;(!me||!ve)&&(F=x,me?(e.EndTime=new Date(pe[0].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=pe[0].DeviceNo.toString()),e.Remarks="Check-Out Missing"):(e.StartTime=new Date(ue[ue.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=ue[ue.length-1].DeviceNo.toString()),e.Remarks="Check-In Missing"))}}else if(a.bGetMultipleCheckInOutInaDay&&A.length>2){for(let me=0;me<A.length;me+=2){D={};for(let ve=0;ve<e.ItemArray.length;ve++)D[ve]=e[ve];D.StartTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(D["IN Device No"]=A[me].DeviceNo.toString()),me==A.length-1?(D.EndTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[me].DeviceNo.toString())):(D.EndTime=new Date(A[me+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(D["OUT Device No"]=A[me+1].DeviceNo.toString())),x=new Date(x.ToString("dd/MMM/yyyy")+" "+D.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+D.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+D.EndTime.toString()),D.TotHrs=nt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(D)}N=!0}else e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[A.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[A.length-1].DeviceNo.toString());N||(x=new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()),e.TotHrs=nt.RibbonExtViewModel.CalculateTotalTime(x,x,F,F))}else{if(!a.IsAutoPost)return a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+H[Le].EmpCode,void(a.MessageVisibility=!0);a.MsgVisibility=!1,a.DisplayMessage="Assign Shift for the Employee Code : "+H[Le].EmpCode,a.MessageVisibility=!0,r=!0}r||N||o.push(e)}u=u.AddDays(1)}}}if(l=0,o.length>0){let c,g,u="";null!=a.SortBasedOn.SelectedValue&&"1"!=a.SortBasedOn.SelectedValue&&("2"==a.SortBasedOn.SelectedValue?u="EmpCode":"3"==a.SortBasedOn.SelectedValue?u="EmpName":"4"==a.SortBasedOn.SelectedValue?u="lfts":"5"==a.SortBasedOn.SelectedValue&&(u="EmpCodeNumeric"));for(let p=0;p<o.length;p++){if(g=a.dsbEmps.Tables[0].filter(D=>D.Code==o[p].EmpCode.toString()),!(null!=g&&g.length>0))continue;a.sEmpSeqNosOnGrid.length>0&&(a.sEmpSeqNosOnGrid+=","),a.sEmpSeqNosOnGrid+=g[0].NodeID.toString(),l++;let e=(new Date).OnlyDate();if(c=a.dgv.NewRow(),c.SlNo=l.toString(),c.EmpCode=o[p].EmpCode,c.EmpName=o[p].EmpName,c.PunchDate=new Date(o[p].PunchDate).ToString("dd/MMM/yyyy"),c.ActStartTime=m.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].StartTime).ToString("HH:mm"),c.ActEndTime=m.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].EndTime).ToString("HH:mm"),c.ActTotHrs=o[p].TotHrs,a.bUseROffTimings){let D,y,A,x,_=0;if(D=m.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+c.ActStartTime),y=m.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+c.ActEndTime),null!=a.dsROffTimings.Tables.ROffRow&&(x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=D.ToString("HH:mm")&&D.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(D=new Date(D.getFullYear(),D.iMonth(),D.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0)),x=a.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=y.ToString("HH:mm")&&y.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(y=new Date(y.getFullYear(),y.iMonth(),y.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0))),c.ROffStartTime=D.ToString("HH:mm"),c.ROffEndTime=y.ToString("HH:mm"),_=0,A=y.Subtract(D),D>y){c.ROffTotHrs="00.00",c.Row_Background="#F77B7E";continue}A=y.Subtract(D),_=parseFloat(A.Hours.ToString("00")+"."+A.Minutes.ToString("00")),c.ROffTotHrs=_.ToString("00.00")}a.bDocColumns&&(a.dgv.TableColumns.Contains("IN Device No")&&(c["IN Device No"]=o[p]["IN Device No"].toString()),a.dgv.TableColumns.Contains("OUT Device No")&&(c["OUT Device No"]=o[p]["OUT Device No"].toString())),0==parseFloat(c.ActTotHrs)&&(c.Row_Background="#F77B7E"),c.Remarks=m.J0.String(o[p].Remarks),a.dgv.addRow(c)}a.MsgVisibility=!1}else a.MsgVisibility=!1,a.DisplayMessage="No data found.",a.MessageVisibility=!0}})()}GetBMConnString(){return"1"==this.BMCDatabaseType.SelectedValue?"Data Source="+this.BMCServerName.Text.Trim()+";Initial Catalog="+this.BMCDatabaseName.Text.Trim()+";Persist Security Info=True;User ID="+this.BMCUserId.Text.Trim()+";Password="+this.BMCPassword.Text:""}}var Ee=G(13816);function ot(V,a){if(1&V&&(s.j41(0,"div",20),s.EFF(1,"\n                            "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                            "),s.k0s(),s.EFF(4,"\n                        "),s.k0s()),2&V){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgv)("group",l.form)}}function st(V,a){if(1&V&&(s.qex(0),s.EFF(1,"\n                                "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                                "),s.k0s(),s.EFF(4,"\n                            "),s.bVm()),2&V){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgvFailedRecord)("group",l.form)}}let Se=(()=>{class V{constructor(){this.form=new L.gE({})}ngOnInit(){this.params?.obj&&(this.obj=this.params.obj)}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275cmp=s.VBU({type:V,selectors:[["app-biometric-config-view-model"]],decls:64,vars:17,consts:[["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-export"],[1,"document-screen","main_div"],[1,"PACTTabFields","pagesection-noborder","tab_content","tab-exrafields","custom_accordion",2,"height","100%"],[1,"master-tab-container",2,"width","100%","height","98%"],["heading","Data",3,"removable"],[1,"row","form-row",2,"width","100%","margin-left","10px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"overflow","scroll"],[4,"ngIf"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(t,i){1&t&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"span",3),s.EFF(7),s.k0s(),s.EFF(8,"\n\n        "),s.k0s(),s.EFF(9,"\n        "),s.j41(10,"div",4),s.EFF(11,"\n            "),s.j41(12,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("GetData")}),s.nrm(13,"i",6),s.EFF(14),s.nI1(15,"translate"),s.k0s(),s.EFF(16,"\n            "),s.j41(17,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("PostData")}),s.nrm(18,"i",7),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n            "),s.j41(22,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("Export")}),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n        "),s.k0s(),s.EFF(27,"\n    "),s.k0s(),s.EFF(28,"\n\n    "),s.j41(29,"div",9),s.EFF(30,"\n\n        "),s.j41(31,"div",10),s.EFF(32,"\n            "),s.j41(33,"tabset",11),s.EFF(34,"\n                "),s.j41(35,"tab",12),s.EFF(36,"\n                    "),s.j41(37,"div",13),s.EFF(38,"\n                        "),s.j41(39,"div",14),s.EFF(40,"\n                            "),s.eu8(41,15),s.EFF(42,"\n                        "),s.k0s(),s.EFF(43,"\n                        "),s.j41(44,"div",14),s.EFF(45,"\n                            "),s.eu8(46,15),s.EFF(47,"\n                        "),s.k0s(),s.EFF(48,"\n                    "),s.k0s(),s.EFF(49,"\n                    "),s.j41(50,"div",16),s.EFF(51,"\n                        "),s.DNE(52,ot,5,2,"div",17),s.EFF(53,"\n                        "),s.j41(54,"div",18),s.EFF(55,"\n                            "),s.DNE(56,st,5,2,"ng-container",19),s.EFF(57,"\n\n                        "),s.k0s(),s.EFF(58,"\n                    "),s.k0s(),s.EFF(59,"\n                "),s.k0s(),s.EFF(60,"\n            "),s.k0s(),s.EFF(61,"\n        "),s.k0s(),s.EFF(62,"\n    "),s.k0s(),s.EFF(63,"\n"),s.k0s()),2&t&&(s.R7$(7),s.SpI("\n                ",i.obj.Title,"\n            "),s.R7$(7),s.JRh(s.bMT(15,11,"Get Data")),s.R7$(5),s.JRh(s.bMT(20,13,"Post")),s.R7$(5),s.JRh(s.bMT(25,15,"Export")),s.R7$(11),s.Y8G("removable",!1),s.R7$(6),s.Y8G("obj",i.obj.FromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.ToDate)("group",i.form),s.R7$(6),s.Y8G("ngIf",i.obj.dgv),s.R7$(4),s.Y8G("ngIf",i.obj.ListVisbility))},dependencies:[fe.bT,Ye._,ze.X,Ee.V6,Ee.fw,Xe.D9]})}return V})();class Re{static LoadPayrollScreen(a,l){if(50054!=a.FeatureID)if(256==a.FeatureID){let t=new Me.SetPayrollDateViewModel;d.d.page.ShowDialog(t,Oe.SetPayrollDateComponent,{ShowCenter:!0,Title:d.d.GetResource("Pay_SetPayrollDate")})}else if(258==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Lt);if(t)d.d.page.SetActiveTab(t);else{let i=new Lt(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Zt,params:{obj:i}})}}else if(260==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof mt);if(t)d.d.page.SetActiveTab(t);else{let i=new mt(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Ze,params:{obj:i}})}}else if(261==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Vt.N);if(t)d.d.page.SetActiveTab(t);else{let i=new Vt.N(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:ia,params:{obj:i}})}}else if(262==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof kt);if(t)d.d.page.SetActiveTab(t);else{let i=new kt;i.Title=i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:P,params:{obj:i}})}}else if(263!=a.FeatureID)if(264==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof X);if(t)d.d.page.SetActiveTab(t);else{let i=new X;i.IncomeTaxComputationViewModel(),i.Title=i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Be,params:{obj:i}})}}else if(40095==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof ft.FinalSettlementViewModel);if(t)d.d.page.SetActiveTab(t);else{let i=new ft.FinalSettlementViewModel(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:na.FinalSettlementComponent,params:{obj:i}})}}else if(141==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof ye);if(t)d.d.page.SetActiveTab(t);else{let i=new ye(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:Se,params:{obj:i}})}}else if(266==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof Ot);if(t)d.d.page.SetActiveTab(t);else{let i=new Ot(l);i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:sa,params:{obj:i}})}}else if(267!=a.FeatureID)if(40054==a.FeatureID){let t=d.d.page.tabs.find(i=>i.params?.obj instanceof qe.MonthlyPayrollViewModel);if(t)d.d.page.SetActiveTab(t);else{let i=new qe.MonthlyPayrollViewModel(a.ScreenName,"");i.DisplayName=l,d.d.page.addNewTab({title:a.ScreenName,component:lt.MonthlyPayrollComponent,params:{obj:i}})}}else if(40088!=a.FeatureID&&"4101"===a.FeatureActionID.toString())return{component:I.TreeViewPageComponent,params:{ScreenName:a.ScreenName,FeatureActionID:a.FeatureActionID,CostCenterID:a.FeatureID,Call:"C3"},basedon:"CostCenterID"};return{}}static LoadMonthlyPayrolByVoucherNo(a,l){return new qe.MonthlyPayrollViewModel(a,"",l)}static GetAppraisal(a){let A,l=0,t=0,i=0,o=0,r=!1,c="",g="",u="",p=new Date,e=new Date,D=new Date,y=a.ToTable(!0,["EmpSeqNo"]);if(null!=y&&y.length>0)for(let _=0;_<y.length;_++)if(null!=y[_].EmpSeqNo&&null!=y[_].EmpSeqNo&&""!=y[_].EmpSeqNo.toString()&&(l=parseInt(y[_].EmpSeqNo),A=a.filter(x=>x.EmpSeqNo==l),null!=A&&A.length>0)){p=new Date(A[0].EffectFrom),e=new Date(A[0].ApplyFrom),D=new Date(A[0].NextAppraisalDate),null!=A[0].Remarks&&null!=A[0].Remarks&&(c=A[0].Remarks.toString()),null!=A[0].Reason&&null!=A[0].Reason&&(g=A[0].Reason.toString());let x=d.d.common.GetDataSet3("BULK004",l.toString(),p.getMonth().toString(),p.getFullYear().toString());i=null!=x&&x.Tables.length>0&&x.Tables[0].length>0?parseInt(x.Tables[0][0].SeqNo):0;let F=new _e.X(null,l,new Date,i);F.isFromBulkAppraisals=!0,F.EffectFrom.Date=p,F.ActAppraisalFrom.Date=e,F.NextAppraisal.Date=D,F.Remarks.Text=c,F.Reason.Text=g;for(let k=0;k<A.length;k++){if(t=parseInt(A[k].ComponentID),o=parseFloat(A[k].Amt),r=!1,null!=x&&x.Tables.length>1&&x.Tables[1].length>0){let f=x.Tables[1].filter(b=>"BasicMonthlyFld"==b.prefname);null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&t==parseInt(f[0].prefvalue.toString())&&(F.BasicMonthly.Text=o.toString(),r=!0),f=x.Tables[1].filter(b=>"AnnualCTCFld"==b.prefname),null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&t==parseInt(f[0].prefvalue.toString())&&(F.AnnualCTC.Text=o.toString(),r=!0)}for(let f=0;f<F.dgvEarnings.Table.length;f++)if(F.dgvEarnings.Table[f].EarComponentID.toString()==t.toString()){F.dgvEarnings.Table[f].EarValue=o,r=!0;break}if(!r)for(let f=0;f<F.dgvDeductions.Table.length;f++)if(F.dgvDeductions.Table[f].DedComponentID.toString()==t.toString()){F.dgvDeductions.Table[f].DedValue=o;break}}F.ExecuteFormulas(),F.OnButtonClick("Save"),null!=F.DisplayMessage&&F.DisplayMessage.length>0||F.strUpdate.length>0&&(u+=F.strUpdate)}return u}static LoadFinalSettlementByVoucherNo(a,l){return new ft.FinalSettlementViewModel(a,l)}static ShowQuickAdd_Payroll(a,l){return(0,ne.A)(function*(){if(50051==a){const{AddEditEmpMasterComponent:t}=yield G.e(2742).then(G.bind(G,12742)),{AddEditEmpMasterViewModel:i}=yield Promise.resolve().then(G.bind(G,76412));let r={obj:new i(l,0,0,"",!1)};d.d.page.addNewTab({title:"",component:t,params:r})}})()}}}}]);