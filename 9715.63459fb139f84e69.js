"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9715],{99715:($,f,a)=>{a.r(f),a.d(f,{AddUsersViewModel:()=>X,RolesAssignGridViewModel:()=>L,RolesAssignListViewModel:()=>H});var p=a(10467),A=a(86271),r=a(8787),T=a(52886),O=a(23823),x=a(72856),l=a(92701),d=a(31820),V=a(33547),y=a(9309),U=a(54683),m=a(81669),g=a(18569),R=a(36466),M=a(98669),v=a(72099),w=a(32647),s=a(86739),G=a(99840),N=a(95984),B=a(29459),F=a(60833),W=a(49710),K=a(40012),j=a(42031),k=a(48577),P=a(28551),J=a(8018),b=a(10662);class X extends O.g{OnShowAttachment(){}OnAddAttachment(){this.Attachment=new U.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}LoadImageDimensions(){let t=new K.BR;if(t.Row=0,this.ImageVisibility=!0,t.RowSpan=3,t.Column=3,t.ColumnSpan=1,t.ImageHeight=90..toString(),null!=this.dsEdit&&this.dsEdit.Tables.length>3){let i=this.dsEdit.Tables[3].filter(n=>1==n.IsAccountImage&&1==n.IsDefaultImage);i.length>0?(this.ScreenObject.ImageVisibility=this.PhotoTextVisibility=!1,this.FileID=parseInt(i[0].FileID),this.AccountPhoto=r.J0.GetPath(i[0].GUID.toString()+"."+i[0].FileExtension.toString(),this.ScreenObject.YearMonth),this.ActualFileName=i[0].ActualFileName.toString()):(this.FileID=0,this.PhotoTextVisibility=!0)}this.ScreenObject.StaticFields.push(t)}OnDropPhoto(t){let e;if(Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnDropPhoto"),e.length>0)try{this.AccountPhoto=e[0],this.IsPhotoChanged=!0,this.PhotoTextVisibility=!1,this.DisplayMessage="",this.MessageVisibility=!1}catch{this.DisplayMessage=s.d.GetResource("File_NoPhoto"),this.MessageVisibility=!0}Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnDropPhoto")}onTabSelectionChanged(t){null!=this.ScreenObject.CustomTab.SelectedTab&&"Assign"==this.ScreenObject.CustomTab.SelectedTab.Name&&(s.d.SessionManager.IsActionAssigned(7,"Map")?this.ViewCCMapping.OnShowCC(null):this.CCMapVisibility=!1)}onCanDropPhoto(t){return!0}constructor(t){super(),this.IsPhotoDelete=!1,this.IsImageSaved=!1,this.ActualFileName="",this.AccountPhoto=null,this.SaveUsers=new m.Yk,this.LinkDocumentCheckedChanged=new m.Yk,this.TextChanged=new m.Yk,this.ScreenObject=new V.ControlGenerator,this.guid="",this.AssignTab=null,this.Profiles=new l.y$(0),this.Tabs=new T.Z,this.lblTitle=s.d.GetResource("Users_Title"),this.UserName=new d.Dw(22898),this.Email1=new d.Dw(22913),this.Lang=new l.y$(0),this.IsOffline=new l.y$(0),this.TwoStepVerMode=new l.y$(0),this.LicenseCount=new d.Dw(0),this.Email2=new d.Dw(22914),this.CompanyList=new l.v4(0),this.txtPassword=new d.Dw(22899),this.txtConfirmPassword=new d.Dw(999),this.sRandNum="",this.strPasswordCheckOTP="",this.Email1Password=new d.Dw(26697),this.Email1ConfirmPassword=new d.Dw(26698),this.Email2Password=new d.Dw(26699),this.Email2ConfirmPassword=new d.Dw(26700),this.Location=new M.y$(49993),this.Division=new M.y$(49992),this.DeviceID=new d.Dw(49992),this.MultipleDevices=new v.c(49992),this.TenantID=new d.Dw(0),this.ClientID=new d.Dw(0),this.ClientSecret=new d.Dw(0),this.APIEmailFrom=new d.Dw(0),this.APIEmailTO=new d.Dw(0),this.Parent=new l.y$(22917),this.DefCompList=new l.y$(0),this.Status=new l.y$(53531),this.PNodeID=0,this.FileExtension="",this.FileDescription="",Logger.InfoLog("AddUsersViewModel::Entering AddUsersViewModel");try{this.isUserFrmClone=0,this.CostCenterID=7,this.PNodeID=t,this.ViewCCMapping=new x.W(this),this.ViewCCMapping.ViewCCMappingViewModel_1(this,7,t),this.ViewAttachments=new y.ViewAttachmentViewModel(this),this.UserDefaultScreen=new j.X,this.UserDefaultScreen.UserDefaultScreenViewModelUsers(this),this.Restrict=new k.F(7,0,t),this.ScreenObject.LoadScreen_2(this,7),this.ScreenObject.CustomTab.OnTabChange.Subscribe(this,"onTabSelectionChanged"),this.SaveUsers.Subscribe(this,"OnSaveUsers"),this.TextChanged.Subscribe(this,"OnTextChange"),this.LinkDocumentCheckedChanged.Subscribe(this,"OnLinkDocumentCheckedChanged"),this.ButtonCapture=new R.v,0==t?this.ButtonCapture.Visible=!1:s.d.SessionManager.HideUnathorizedAccess?this.ButtonCapture.Visible=s.d.SessionManager.IsActionAssigned(7,"Capture"):this.ButtonCapture.Enable=s.d.SessionManager.IsActionAssigned(7,"Capture"),this.Lang.Label=s.d.GetResource("ComLanguage"),this.Lang.Visible=!0,this.Lang.Enable=!0,this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("ComLanguageEnglish"),"1")),this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("ComLanguageArabic"),"2")),this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("Italian"),"3")),this.Lang.DefaultValue="1",this.Lang.SelectedValue="1",this.ScreenObject.HeaderFields=[],this.IsOffline.Label="Online/Offline",s.d.SessionManager.Preferences.ContainsKey("CheckUserONLINEOFFLINE")&&"True"==s.d.SessionManager.Preferences.CheckUserONLINEOFFLINE?this.IsOffline.Enable=this.IsOffline.Visible=!0:this.IsOffline.Visible=!1,this.IsOffline.Items.push(l._p.ComboBoxItems_2("Online","True")),this.IsOffline.Items.push(l._p.ComboBoxItems_2("Offline","false")),this.IsOffline.DefaultValue="True",this.IsOffline.SelectedValue="True",this.TwoStepVerMode.Label="2-Step Verification Mode",this.TwoStepVerMode.Visible=!0,this.TwoStepVerMode.Enable=!0,this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("None","None")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("EMail","EMail")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("SMS","SMS")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("Both","Both")),this.TwoStepVerMode.DefaultValue="None",this.TwoStepVerMode.SelectedValue="None",this.DeviceID.Label="Device ID",this.MultipleDevices.Label="Multiple Devices",this.ClientID.Label="Client ID",this.ClientID.Visible=!0,this.ClientID.Enable=!0,this.ClientID.DefaultValue="",this.ClientID.Text="",this.TenantID.Label="Tenant ID",this.TenantID.Visible=!0,this.TenantID.Enable=!0,this.TenantID.DefaultValue="",this.TenantID.Text="",this.ClientSecret.Label="Client Secret",this.ClientSecret.Visible=!0,this.ClientSecret.Enable=!0,this.ClientSecret.DefaultValue="",this.ClientSecret.Text="",this.LicenseCount.Label="License Count",this.LicenseCount.Visible=!0,this.LicenseCount.Enable=!0,this.LicenseCount.DefaultValue="0",this.LicenseCount.Text="0",this.txtConfirmPassword.ColumnSpan=1,this.txtConfirmPassword.Row=0,this.txtConfirmPassword.Column=2,this.txtConfirmPassword.Visible=!0,this.txtConfirmPassword.IsReadOnly=!1,this.txtConfirmPassword.Enable=!0,this.txtConfirmPassword.Label="Confirm Password",this.txtConfirmPassword.Mandatory=!0,this.txtConfirmPassword.DisableLbl=!1,this.txtConfirmPassword.TextChangedCommand.Subscribe(this,"OnPasswordChanged"),this.ScreenObject.StaticFields.push(this.txtConfirmPassword),this.TwoStepVerMode.ColumnSpan=1,this.TwoStepVerMode.Row=4,this.TwoStepVerMode.Column=3,this.IsOffline.ColumnSpan=1,this.IsOffline.Row=4,this.IsOffline.Column=2,this.DeviceID.ColumnSpan=1,this.DeviceID.Row=5,this.DeviceID.Column=0,this.ClientID.ColumnSpan=1,this.ClientID.Row=6,this.ClientID.Column=1,this.TenantID.ColumnSpan=1,this.TenantID.Row=6,this.TenantID.Column=0,this.ClientSecret.ColumnSpan=1,this.ClientSecret.Row=6,this.ClientSecret.Column=2,this.LicenseCount.ColumnSpan=1,this.LicenseCount.Row=3,this.LicenseCount.Column=1,this.Location.ColumnSpan=1,this.Location.Row=3,this.Location.Column=2,this.Lang.ColumnSpan=1,this.Lang.Row=3,this.Lang.Column=0,this.Status.ColumnSpan=1,this.Status.Row=4,this.Status.Column=1,this.MultipleDevices.ColumnSpan=1,this.MultipleDevices.Row=5,this.MultipleDevices.Column=1,this.Division.ColumnSpan=0,this.Division.Row=4,this.Division.Column=0,this.ScreenObject.CustomTab.ColumnSpan=4,this.ScreenObject.CustomTab.Row=7,this.ScreenObject.CustomTab.Column=0,this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(l._p.ComboBoxItems_2(e.Status,e.StatusID))}),this.GetRoles(),this.DisplayName=0==t?this.lblTitle:"Edit User",this.RolesAssignGrid=new L(this),this.StatusAssignGrid=new G.w,t>0&&(this.GetSelected(t.toString()),this.UserName.Enable=!1,s.d.SessionManager.UserID&&(this.Parent.Enable=!1)),s.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==s.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.ScreenObject.YearMonth=""),this.OnLoad(),this.LoadImageDimensions(),Logger.InfoLog("AddUsersViewModel::Exiting AddUsersViewModel")}catch(e){Logger.ErrorLog("AddUsersViewModel:: AddUsersViewModel ::"+e.stack)}}GetSelected(t){var e=this;return(0,p.A)(function*(){Logger.InfoLog("AddUsersViewModel::Entering GetSelected");try{if(e.dsEdit=[],e.dsEdit=s.d.admin.GetUsersDett(t),e.dsEdit.Tables.length>0&&e.dsEdit.Tables[0].length>0){e.ScreenObject.YearMonth=s.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"TRUE"==s.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()?new Date(e.dsEdit.Tables[0][0].CDATE.toString()).ToString("yyyyMMM"):"",e.UserName.Text=e.dsEdit.Tables[0][0].UserName.toString(),e.UserName.Enable=!1,e.txtPassword.Text=yield e.Decrypt(e.dsEdit.Tables[0][0]),e.strPasswordCheckOTP=e.txtPassword.Text,e.txtConfirmPassword.Text=e.txtPassword.Text,e.SaveUserId=parseInt(e.dsEdit.Tables[0][0].UserID),e.guid=e.dsEdit.Tables[0][0].GUID.toString(),e.Parent.SelectedValue=e.dsEdit.Tables[0][0].RoleID.toString(),e.Email1.Text=e.dsEdit.Tables[0][0].Email1.toString(),e.Email2.Text=e.dsEdit.Tables[0][0].Email2.toString(),e.Email1Password.Text=yield e.DecryptEmailPass(e.dsEdit.Tables[0][0].Email1Password.toString()),e.Email2Password.Text=yield e.DecryptEmailPass(e.dsEdit.Tables[0][0].Email2Password.toString()),e.Email1ConfirmPassword.Text=e.Email1Password.Text,e.Email2ConfirmPassword.Text=e.Email2Password.Text,e.ScreenObject.LoadPrimaryContactData(e.dsEdit.Tables[0],e.dsEdit.Columns[0]),e.UserDefaultScreen.LoadData(e.dsEdit.Tables[0][0].DefaultScreenXML.toString()),e.Lang.SelectedValue=e.dsEdit.Tables[0][0].DefaultLanguage.toString(),e.IsOffline.SelectedValue=e.dsEdit.Columns[0].Contains("IsOffline")&&"0"==e.dsEdit.Tables[0][0].IsOffline.toString()&&"False"==e.dsEdit.Tables[0][0].IsOffline.toString()?"false":"True",e.Status.SelectedValue=e.dsEdit.Tables[0][0].StatusID.toString(),e.LicenseCount.Text=e.dsEdit.Tables[0][0].InstanceCount.toString(),e.TwoStepVerMode.SelectedValue=e.dsEdit.Columns[0].Contains("TwoStepVerMode")&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].TwoStepVerMode.toString())?e.dsEdit.Tables[0][0].TwoStepVerMode.toString():"None",e.Location.SelectedValue=e.dsEdit.Columns[0].Contains("LocationID")&&null!=e.dsEdit.Tables[0][0].LocationID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].LocationID.toString())&&parseInt(e.dsEdit.Tables[0][0].LocationID.toString())>0?parseInt(e.dsEdit.Tables[0][0].LocationID.toString()):0,e.Division.SelectedValue=e.dsEdit.Columns[0].Contains("DivisionID")&&null!=e.dsEdit.Tables[0][0].DivisionID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].DivisionID.toString())&&parseInt(e.dsEdit.Tables[0][0].DivisionID.toString())>0?parseInt(e.dsEdit.Tables[0][0].DivisionID.toString()):0,e.DeviceID.Text=e.dsEdit.Tables[0][0].DeviceID.toString(),e.dsEdit.Columns[0].Contains("ClientID")&&null!=e.dsEdit.Tables[0][0].ClientID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].ClientID.toString())&&(e.ClientID.Text=e.dsEdit.Tables[0][0].ClientID.toString()),e.dsEdit.Columns[0].Contains("TenantID")&&null!=e.dsEdit.Tables[0][0].TenantID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].TenantID.toString())&&(e.TenantID.Text=e.dsEdit.Tables[0][0].TenantID.toString()),e.dsEdit.Columns[0].Contains("ClientSecret")&&null!=e.dsEdit.Tables[0][0].ClientSecret&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].ClientSecret.toString())&&(e.ClientSecret.Text=e.dsEdit.Tables[0][0].ClientSecret.toString());let n=!1;r.J0.String(e.dsEdit.Tables[0][0].MultipleDevices.toString()),e.MultipleDevices.IsChecked=n,e.RolesAssignGrid.load(e.dsEdit.Tables[2]),e.ViewAttachments.LoadAttachments(e.dsEdit.Tables[3]),e.StatusAssignGrid.Load(e.dsEdit.Tables[4])}if(e.dsEdit.Tables.length>1&&e.dsEdit.Tables[1].length>0&&e.ViewCCMapping.LoadData(e.dsEdit.Tables[1],e.dsEdit.Columns[1]),1==e.SaveUserId){e.UserName.Enable=!1,e.Parent.Enable=!1;for(let n in e.ScreenObject.CustomTab.Pages[0].Fields)return null!=n&&Logger.InfoLog("AddUsersViewModel::Exiting GetSelected"),e.dsEdit.toString()}}catch(i){return Logger.ErrorLog("AddUsersViewModel:: AddUsersViewModel ::"+i.stack),""}})()}GetCompanyXml(){Logger.InfoLog("AddUsersViewModel::Entering GetCompanyXml");try{let t="";t+="<XML>";for(let e=0;e<this.CompanyList.Items.length;e++)this.CompanyList.Items[e].IsChecked&&(t+='<Row COMPID="'+this.CompanyList.Items[e].Value,this.DefCompList.Items[e].Value==this.DefCompList.SelectedValue.toString()?t+='" ISDEFAULT="true" />':t+='" ISDEFAULT="false" />');return t+="</XML>",Logger.InfoLog("AddUsersViewModel::Exiting GetCompanyXml"),t.toString()}catch(t){return Logger.ErrorLog("AddUsersViewModel:: GetCompanyXml ::"+t.stack),""}}OnLinkDocumentCheckedChanged(t){Logger.InfoLog("AddUsersViewModel::Entering OnLinkDocumentCheckedChanged");try{t.GetType()==typeof l.oN&&(this.DefCompList.Items.push(l._p.ComboBoxItems_2(l.oN.CheckedListBoxItem_1(t).Name,l.oN.CheckedListBoxItem_1(t).Value)),this.DefCompList.Items.filter(i=>i.Value==l.oN.CheckedListBoxItem_1(t).Value),this.DefCompList.Items.push())}catch{Logger.InfoLog("AddUsersViewModel::Exiting OnLinkDocumentCheckedChanged")}}OnPasswordChanged(t){this.txtConfirmPassword.Text=t.Text,this.CheckPassword()}OnTextChanged(t){Logger.InfoLog("AddUsersViewModel::Entering OnTextChange"),"UserChange"==t.toString()&&(this.DisplayMessage=this.IsUserExists(this.UserName.Text)?s.d.GetResource("Users_Exists"):""),Logger.InfoLog("AddUsersViewModel::Exiting OnTextChange")}CheckPassword(){return Logger.InfoLog("AddUsersViewModel::Entering CheckPassword"),null!=this.txtPassword.Text&&null!=this.txtConfirmPassword.Text?this.txtPassword.Text!=this.txtConfirmPassword.Text?(this.DisplayMessage=s.d.GetResource("Users_PwdError"),!1):(this.MessageVisibility=!1,!0):(this.DisplayMessage=" Password Mismatch ",Logger.InfoLog("AddUsersViewModel::Exiting CheckPassword"),!1)}CheckEmailPasswords(){Logger.InfoLog("AddUsersViewModel::Entering CheckEmailPasswords");let t="",e="",i="",n="";return null!=this.Email1Password.Text&&""!=this.Email1Password.Text&&(t=this.Email1Password.Text),null!=this.Email1ConfirmPassword.Text&&""!=this.Email1ConfirmPassword.Text&&(e=this.Email1ConfirmPassword.Text),null!=this.Email2Password.Text&&""!=this.Email2Password.Text&&(i=this.Email2Password.Text),null!=this.Email2ConfirmPassword.Text&&""!=this.Email2ConfirmPassword.Text&&(n=this.Email2ConfirmPassword.Text),t!=e?(this.DisplayMessage=s.d.GetResource("Users_PwdError")+" at Email 1",!1):i!=n?(this.DisplayMessage=s.d.GetResource("Users_PwdError")+" at Email 2",!1):(this.MessageVisibility=!1,!0)}GetRoles(){try{let t="";"1"!=s.d.SessionManager.UserID?(t=s.d.SessionManager.Preferences.ContainsKey("LWRole")&&"true"==s.d.SessionManager.Preferences.LWRole.toLowerCase()?s.d.SessionManager.LocationWhereWithParent:null,s.d.SessionManager.Preferences.ContainsKey("DWRole")&&"true"==s.d.SessionManager.Preferences.DWRole.toLowerCase()?t+=s.d.SessionManager.DivisionID>0?"~"+s.d.SessionManager.DivisionID.toString():"~"+s.d.SessionManager.DivisionWhere:t+="~null"):(t=null,t+="~null"),t+="~"+s.d.SessionManager.UserID,t+="~"+s.d.SessionManager.LanguageID,s.d.empService.getUserRoles(this.CostCenterID,t).Tables[0].forEach(i=>{this.Parent.Items.push(l._p.ComboBoxItems_2(i.Name.toString(),i.RoleID.toString()))}),Logger.InfoLog("AddCostCenterViewModel::Entering GetRoles")}catch(t){Logger.ErrorLog("AddCostCenterViewModel:: GetRoles"+t.stack)}}IsUserExists(t){Logger.InfoLog("VoucherGenerator:: Inside IsBatchIdExists");let e=[];e.push(t);let i=s.d.admin.IsUserExists(e);return Logger.InfoLog("VoucherGenerator:: Exiting IsBatchIdExists"),null!=i&&i.Tables.length>0&&i.Tables[0].length>0}OnLoad(){Logger.InfoLog("AddUsersViewModel::Entering OnLoad");for(let t=this.ScreenObject.CustomTab.Pages.length-1;t>=0;t--){let e=this.ScreenObject.CustomTab.Pages[t];switch(e.Name){case"Assign":e.Fields=[],e.Fields.push(this.ViewCCMapping);break;case"Default Screen":e.Fields=[],e.Fields.push(this.UserDefaultScreen)}}this.AddRestrictTab()}OnSaveUsers(t){var e=this;return(0,p.A)(function*(){try{if(e.DisplayMessage="","Save"==t.toString()){1==e.isUserFrmClone&&(e.SaveUserId=0);let i="";if(i=null==e.UserName.Text||""==e.UserName.Text?"Enter User Name":null==e.Parent.SelectedValue||""==e.Parent.SelectedValue?"Select Role":null==e.txtPassword.Text||""==e.txtPassword.Text?"Enter Password":e.ScreenObject.ValidateData(),i.length>0)e.DisplayMessage=i;else if(null==e.txtConfirmPassword.Text||""==e.txtConfirmPassword.Text)e.DisplayMessage=" Please Enter Confirm Password ";else{let n=!0;if(0==e.SaveUserId&&(null!=e.UserName.Text&&""!=e.UserName.Text?n=!e.IsUserExists(e.UserName.Text.Trim()):e.DisplayMessage="Please enter UserName"),n)if(e.CheckPassword()){if(s.d.SessionManager.Preferences.ContainsKey("OTPValidation")&&""!=s.d.SessionManager.Preferences.OTPValidation&&(0,w.yG0)(s.d.SessionManager.Preferences.OTPValidation)&&e.SaveUserId>0&&e.strPasswordCheckOTP!=e.txtPassword.Text){(new A.N).SmsEmailOTPViewModel_2(e,0),s.d.page.ShowDialog(N._,{ShowCenter:!0,Title:"OTP Verification"}).subscribe(()=>{})}if(e.DisplayMessage=r.J0.ValidatePassword(e.txtPassword.Text),e.DisplayMessage.length>0)return;e.CheckEmailPasswords()&&(e.MessageVisibility=!0),""==e.guid&&(e.guid=r.J0.NewGuid());let h="";h=e.ScreenObject.GetPrimaryContact(),h+="Email1='"+e.Email1.Text+"',",r.J0.IsEmpty(e.Email1Password.Text)?h+="Email1Password='',":h+="Email1Password='@ENC@"+r.J0.EncryptString(e.Email1Password.Text)+"',",h+="Email2='"+e.Email2.Text+"',",r.J0.IsEmpty(e.Email2Password.Text)?h+="Email2Password='',":h+="Email2Password='@ENC@"+r.J0.EncryptString(e.Email2Password.Text)+"',";let o=[];o.push(e.SaveUserId),o.push(parseInt(e.Parent.SelectedValue)),o.push(e.UserName.Text);let c=yield s.d.admin.EncryptString(e.UserName.Text+e.txtPassword.Text);o.push(c.EncryptedString),o.push(1),o.push(e.Lang.SelectedValue),o.push(e.IsOffline.SelectedValue),o.push(e.TwoStepVerMode.SelectedValue),o.push(e.DeviceID.Text),o.push(e.MultipleDevices.IsChecked),o.push(h),o.push(s.d.SessionManager.CompanyIndex);let S={};e.DisplayMessage=e.ViewCCMapping.GetXML(S);let I,Y=S.strXML;if(!r.J0.IsEmpty(e.DisplayMessage))return;o.push(Y),o.push(e.Restrict.GetXML()),o.push(e.UserDefaultScreen.GetXML()),I=r.J0.Double(e.LicenseCount.Text),I<0&&(I=0),o.push(I);let D="";null!=e.Sites&&(e.Sites.Items.filter(u=>u.IsChecked).forEach(u=>{D+='<R ID=" + chk.valueOf + "/>'}),0==D.length&&(e.DisplayMessage="Please assign atleast one site"),D="<Lic>"+D+"</Lic>"),o.push(D),o.push(e.ViewAttachments.GetXML()+e.GetImageXML()),o.push(e.RolesAssignGrid.GetXML()),o.push(e.StatusAssignGrid.GetXML()),o.push(e.Location.SelectedValue),o.push(e.Division.SelectedValue),o.push(s.d.SessionManager.CompanyGUID),o.push(e.guid),o.push(s.d.SessionManager.UserName),o.push(s.d.SessionManager.UserID),o.push(s.d.SessionManager.RoleID),o.push(s.d.SessionManager.LanguageID),o.push(e.ClientID.Text),o.push(e.TenantID.Text),o.push(e.ClientSecret.Text);let E=0,C=s.d.admin.CreateUser(o);if(E=C.obj,E>0){if(e.DisplayMessage=e.SaveUserId>0?" User Updated Successfully  ":" User Saved  Successfully",1==e.isUserFrmClone&&0==e.SaveUserId){let u=[];u.push(E),u.push(e.UserName.Text),u.push(e.CopySaveUserID),u.push(e.CopySaveUserName),u.push(s.d.SessionManager.LanguageID),u.push(s.d.SessionManager.UserName),u.push(s.d.SessionManager.UserID),s.d.admin.CloneUserWithAllRight(s.d.SessionManager.CompanyIndex)}e.isUserFrmClone=0,e.ViewCCMapping.Clear(),e.RolesAssignGrid.Clear(),e.StatusAssignGrid.Clear(),e.ViewAttachments.AttachmentsList.Clear(),e.AccountPhoto="",e.ActualFileName="",e.PhotoTextVisibility=!0,e.ScreenObject.Clear(),e.txtConfirmPassword.Text="",e.MultipleDevices.IsChecked=!1,e.DeviceID.Text="",e.ClientID.Text="",e.TenantID.Text="",e.ClientSecret.Text="",e.UserName.Enable=!0}else null!=C&&C.Tables.length>1&&(e.DisplayMessage=C.Tables[C.Tables.length-1][0].ErrorMessage.toString())}else e.MessageVisibility=!0,e.DisplayMessage=s.d.GetResource("Users_Exists");else if("PopUp"==t.toString()){let h;if(null!=e.dsEdit&&e.dsEdit.Tables.length>3&&e.dsEdit.Tables[3].Select("FileExtension='jpg' or FileExtension='png'").forEach(c=>{h+=r.J0.GetPath(c.GUID.toString()+"."+c.FileExtension.toString(),e.ScreenObject.YearMonth)+";"}),""!=e.AccountPhoto){const{PopupImageViewModel:o}=yield Promise.resolve().then(a.bind(a,70968)),{PopupImageComponent:c}=yield Promise.resolve().then(a.bind(a,45704));let S=new o("Popup Image","OK",!0,e.AccountPhoto,h);s.d.page.ShowDialog(S,c,{ShowCenter:!0,Title:"Popup Image"})}}else if("UploadPhoto"==t.toString()){let h=new J.R;s.d.page.ShowDialog(h,P.p,{ShowCenter:!0,Title:"Add Images"}),h.PopupAttachmentsViewModel_1(e.CostCenterID,e.SaveUserId,e),s.d.page.ShowDialog(h,P.p,{ShowCenter:!0,Title:"Add Images"})}else"MouseDown"==t.toString()||("DeletePhoto"==t.toString()?0==e.AccountPhoto.length?e.ImageHeight=(45*parseInt(e.ImgRowSpan)).toString():confirm("Are you sure you want to delete Image?")&&(e.IsPhotoDelete=!0,e.AccountPhoto="",e.ActualFileName="",e.DialogResult=!1,e.IsPhotoChanged=!1,e.PhotoTextVisibility=!0,e.DisplayMessage="",e.ImageHeight=(parseInt(e.ImageHeight)-15).toString(),e.FileID>0&&(e.DeletedFileID=e.FileID)):"ShowRoleAssignGrid"==t.toString()?(e.RolesAssignGrid.IsShown=!0,s.d.page.ShowDialog(e.RolesAssignGrid,b.m,{ShowCenter:!0,Title:s.d.GetResource("Assign")})):"ShowStatusAssignGrid"==t.toString()&&(e.StatusAssignGrid.IsShown=!0,s.d.page.ShowDialog(e.StatusAssignGrid,b.m,{ShowCenter:!0,Title:s.d.GetResource("Assign")})));t.toString(),Logger.InfoLog("AddUserViewModel::Exiting OnSaveUsers")}}}catch(i){Logger.ErrorLog("AddUsersViewModel:: OnSaveUsers ::"+i.stack)}})()}GetImageXML(){try{let t="";return this.IsPhotoChanged&&!r.J0.IsEmpty(this.AccountPhoto)?(t+=0==this.FileID?'<Row Action="NEW"':'<Row Action="MODIFY"',s.d.SessionManager.IsWebApplication&&(t+=' AttachmentID="'+this.FileID+'"',t+=' FilePath="'+this.AccountPhoto+'"',t+=' ActualFileName="'+this.ActualFileName+'"',t+=' RelativeFileName="'+this.AccountPhoto+'"',t+=' FileExtension="'+this.FileExtension+'"',t+=' FileDescription=""',t+=' IsAccountImage="1"',t+=' GUID="'+this.guid+'"',t+=' FolderPath="'+this.ScreenObject.YearMonth+'"',t+=' IsDefaultImage="1"',t+="/>")):this.IsPhotoDelete&&this.FileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.FileID+'"/>'),this.IsPhotoDelete&&this.DeletedFileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.DeletedFileID+'"/>'),t.length>0?(t.Insert(0,"<AttachmentsXML>"),t+="</AttachmentsXML>",t.toString()):""}catch{return this.DisplayMessage=s.d.GetResource("Upload_Path_notExists"),this.MessageVisibility=!0,""}}OnShowCC(){}onSave(){this.CCMap=new F.AddCCMapViewModel(this)}AddRestrictTab(){let t,e=[];e.push(this.PNodeID),e.push(s.d.SessionManager.RoleID),e.push(s.d.SessionManager.LanguageID),t=s.d.admin.GetUserRetrictTypes(this.PNodeID);let i=new T.O;i.Name="Allow",i.Header="Allow",i.Fields=[],i.Fields.push(this.Restrict),this.Restrict.onLoad(t.Tables[0],0==this.PNodeID?t.Tables[1]:t.Tables[2].length>0?t.Tables[2]:t.Tables[1]),this.ScreenObject.CustomTab.Pages.push(i)}AddLicenseTab(){let t=new T.O;t.Name="Site",t.Header="Site";let i=s.d.admin.GetAccessRights(11,s.d.ForwardProgress.LCDBIndex,null!=this.UserName.Text?this.UserName.Text:"","").ds;this.Sites=new l.v4,i.Table.forEach(n=>{i.Table1.filter(h=>h.SiteMap==n.SiteID),this.Sites.Items.push(l.oN.CheckedListBoxItem_5(n.SitesName.toString(),n.SID.toString(),!1))}),t.Fields=[],t.Fields.push(this.Sites),this.ScreenObject.CustomTab.Pages.push(t)}OnDeleteCallBack(){}Decrypt(t){let e=t.Password.toString();if(r.J0.hasprop(t,"IsPassEncr")&&(0,w.yG0)(t.IsPassEncr)){let i,n="";i=r.J0.StringValue(t.Password),n=r.J0.StringValue(t.UserName),e=s.d.admin.checkCredentials({Password:i,UserName:n},i),e==r.J0.StringValue(r.J0.StringValue(t.Password))&&(e=r.J0.DecryptString(r.J0.StringValue(t.Password)))}return e}DecryptEmailPass(t){return(0,p.A)(function*(){return t.startsWith("@ENC@")&&(t=yield r.J0.DecryptString(t.substr(5))),t.DecryptString})()}}class L{constructor(t){this.ButtonClick=new m.Yk,this.IsShown=!1,this.iTableColumns=[],this.Columns=[],this.col=new g.O7,this.Grid=new W.vv,this.Grid.Width="",this.Grid.Table=[],this.UserScreen=t,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.iTableColumns.push("MapID"),this.iTableColumns.push("RoleID"),this.iTableColumns.push("RoleName"),this.iTableColumns.push("FromDate"),this.iTableColumns.push("FromDate_Key"),this.iTableColumns.push("ToDate"),this.iTableColumns.push("ToDate_Key"),this.iTableColumns.push("StatusID"),this.iTableColumns.push("Delete"),this.col.Header="Data",this.col.DataType="LISTBOX",this.col.DisplayMember="RoleName",this.col.ValueMember="RoleID",this.col.TypeID=1,this.col.CostCenterID=6,this.col.Width=220,this.Columns.push(this.col),this.col=new g.O7,this.col.Header="From Date",this.col.DisplayMember="FromDate",this.col.DataType="DATE",this.col.Width=120,this.Columns.push(this.col),this.col=new g.O7,this.col.Header="To Date",this.col.DisplayMember="ToDate",this.col.DataType="DATE",this.col.Width=120,this.Columns.push(this.col),this.col=new g.O7,this.col.Header="Status",this.col.ValueBinding="StatusID",this.col.DataType="ComboBox",this.col.DisplayMember="Name",this.col.ValueMember="Value",this.col.Width=130;let e=[];e.push(l._p.ComboBoxItems_2("Active","1")),e.push(l._p.ComboBoxItems_2("In-Active","2")),this.col.ComboData=e,this.Columns.push(this.col),this.col=new g.O7,this.col.Header=s.d.GetResource("Delete"),this.col.DisplayMember="Delete",this.col.DataType="LINK",this.col.ValueMember="Delete",this.col.ReadOnly=!0,this.col.IsFrozen=!0,this.col.Width=130,this.Columns.push(this.col),this.Grid.Columns=this.Columns,this.Clear()}OnBeginEdit(t){t instanceof B.ae&&null!=this.dr.MapID&&this.ShowMessageBox("Role not allowed to change")}OnButtonClick(t){("Cancel"==t||"OK"==t)&&s.d.page.HideDialog()}load(t){this.Grid.Table.Clear();let e=s.d.SessionManager.Preferences["Date Format"];for(let i=0;i<t.length;i++){let n={};n.MapID=t[i].UserRoleMapID,n.RoleID=t[i].RoleID,n.RoleName=t[i].RoleName,null!=t[i].FromDate&&(n.FromDate=new Date(t[i].FromDate).toLocaleDateString(e),n.FromDate_Key=t[i].FromDate),null!=t[i].ToDate&&(n.ToDate=new Date(t[i].ToDate).toLocaleDateString(e),n.ToDate_Key=t[i].ToDate),n.StatusID=t[i].Status,n.Delete="Delete",this.Grid.Table.push(n)}this.Grid.Table.push({}),this.Grid.Table.push({});for(let i=this.Grid.Table.length;i<10;i++)this.Grid.Table.push({})}Clear(){this.IsShown=!1,this.Grid.Table.Clear();for(let t=0;t<10;t++)this.Grid.Table.push()}GetXML(){let t="";for(let e of this.Grid.Table)(null!=e.RoleID&&parseInt(e.RoleID)>0||null!=e.MapID&&parseInt(e.MapID)>0)&&(t+='<Row RoleID="'+e.RoleID.toString()+'"',null!=e.MapID&&parseInt(e.MapID)>0&&null!=e.RoleID&&parseInt(e.RoleID)>0?(t+=' MapID="'+e.MapID.toString()+'"',t+=' Action="EDIT"'):null!=e.MapID&&parseInt(e.MapID)>0&&null==e.RoleID?(t+=' MapID="'+e.MapID.toString()+'"',t+=' Action="DELETE"'):t+=' Action="NEW"',null!=e.FromDate_Key&&e.FromDate_Key.toString().length>0&&(t+=' FromDate="'+new Date(e.FromDate_Key).ToString("dd MMM yyyy")+'"',null!=e.ToDate_Key&&e.ToDate_Key.toString().length>0&&(t+=' ToDate="'+new Date(e.ToDate_Key).ToString("dd MMM yyyy")+'"')),null!=e.StatusID&&e.StatusID.toString().length>0?t+=' StatusID="'+e.StatusID.toString()+'"':t+=' StatusID="1"',t+="/>");return t.length>0&&(t.Insert(0,"<XML>"),t+="</XML>"),t.toString()}}class H{constructor(){this.ButtonClick=new m.Yk,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.RolesList=this.ds.Tables[4].DefaultView,this.SelectedRole=this.RolesList[0]}OnButtonClick(t){if("Cancel"==t)s.d.page.HideDialog();else if("Select"==t){if(null==this.SelectedRole)return void(this.DisplayMessage="Please Select Role");this.ds.Tables[0][0].RoleID=parseInt(this.SelectedRole.RoleID),this.ds.Tables[0][0].Name=this.SelectedRole.RoleName.toString(),this.ds.Tables[0][0].RoleType=this.SelectedRole.RoleType.toString(),s.d.page.HideDialog()}}}}}]);