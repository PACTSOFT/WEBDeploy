"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9715],{99715:(z,E,o)=>{o.r(E),o.d(E,{AddUsersViewModel:()=>X,RolesAssignGridViewModel:()=>P,RolesAssignListViewModel:()=>H});var I=o(10467),_=o(86271),r=o(8787),m=o(52886),A=o(23823),O=o(72856),l=o(92701),d=o(31820),y=o(33547),V=o(9309),x=o(54683),c=o(81669),D=o(18569),R=o(36466),p=o(98669),U=o(72099),f=o(32647),s=o(86739),v=o(99840),F=o(95984),G=o(29459),N=o(60833),B=o(49710),W=o(40012),K=o(42031),j=o(48577),k=o(28551),J=o(8018),M=o(10662),w=o(24028);class X extends A.g{OnShowAttachment(){}OnAddAttachment(){this.Attachment=new x.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this)}LoadImageDimensions(){let t=new W.BR;t.Row=1;this.ScreenObject.ImageVisibility=!0;let i=[];this.dsEdit&&this.dsEdit.Tables.length>3&&(i=this.dsEdit.Tables[3].filter(n=>1==n.IsProductImage&&1==n.IsDefaultImage)),i.length>0?(t.RowSpan=3,t.ColumnSpan=1,t.Column=3,t.ImageHeight=90..toString(),this.PhotoTextVisibility=!1,this.FileID=parseInt(i[0].FileID),this.AccountPhoto=r.J0.GetPath(i[0].GUID.toString()+"."+i[0].FileExtension.toString(),this.ScreenObject.YearMonth),this.ActualFileName=i[0].ActualFileName.ToString()):(t.RowSpan=3,t.Column=3,t.ColumnSpan=1,t.ImageHeight=90..toString(),this.PhotoTextVisibility=!0,this.FileID=0),this.ScreenObject.ImageVisibility&&null!=this.ScreenObject.HeaderFields&&this.ScreenObject.HeaderFields.length>0&&this.ScreenObject.LoadImageControl(t),this.ScreenObject.ImageVisibility&&null!=this.ScreenObject.StaticFields&&this.ScreenObject.StaticFields.length>0&&this.ScreenObject.StaticFields.push(t)}OnDropPhoto(t){let e;if(Logger.InfoLog("AddUsersViewModel::Entering OnDropPhoto"),e.length>0)try{this.AccountPhoto=e[0],this.IsPhotoChanged=!0,this.PhotoTextVisibility=!1,this.DisplayMessage="",this.MessageVisibility=!1}catch{this.DisplayMessage=s.d.GetResource("File_NoPhoto"),this.MessageVisibility=!0}Logger.InfoLog("AddUsersViewModel::Exiting OnDropPhoto")}onTabSelectionChanged(t){null!=this.ScreenObject.CustomTab.SelectedTab&&"Assign"==this.ScreenObject.CustomTab.SelectedTab.Name&&(s.d.SessionManager.IsActionAssigned(7,"Map")?this.ViewCCMapping.OnShowCC(null):this.CCMapVisibility=!1)}onCanDropPhoto(t){return!0}constructor(t){super(),this.IsPhotoDelete=!1,this.IsImageSaved=!1,this.ActualFileName="",this.AccountPhoto=null,this.SaveUsers=new c.Yk,this.LinkDocumentCheckedChanged=new c.Yk,this.TextChanged=new c.Yk,this.ScreenObject=new y.ControlGenerator,this.guid="",this.CustomTab=new m.Z,this.AssignTab=null,this.Profiles=new l.y$(0),this.Tabs=new m.Z,this.lblTitle=s.d.GetResource("Users_Title"),this.UserName=new d.Dw(22898),this.Email1=new d.Dw(22913),this.Lang=new l.y$(0),this.IsOffline=new l.y$(0),this.TwoStepVerMode=new l.y$(0),this.LicenseCount=new d.Dw(0),this.Email2=new d.Dw(22914),this.CompanyList=new l.v4(0),this.txtPassword=new d.Dw(22899),this.txtConfirmPassword=new d.Dw(999),this.sRandNum="",this.strPasswordCheckOTP="",this.Email1Password=new d.Dw(26697),this.Email1ConfirmPassword=new d.Dw(26698),this.Email2Password=new d.Dw(26699),this.Email2ConfirmPassword=new d.Dw(26700),this.Location=new p.y$(49993),this.Division=new p.y$(49992),this.DeviceID=new d.Dw(49992),this.FromDate=new w.P6(0),this.ToDate=new w.P6(0),this.MultipleDevices=new U.c(49992),this.TenantID=new d.Dw(0),this.ClientID=new d.Dw(0),this.ClientSecret=new d.Dw(0),this.APIEmailFrom=new d.Dw(0),this.APIEmailTO=new d.Dw(0),this.Parent=new l.y$(22917),this.DefCompList=new l.y$(0),this.Status=new l.y$(53531),this.PNodeID=0,this.FileExtension="",this.FileDescription="",Logger.InfoLog("AddUsersViewModel::Entering AddUsersViewModel");try{this.ClassName="AddUsersViewModel",this.isUserFrmClone=0,this.CostCenterID=7,this.PNodeID=t,this.ViewCCMapping=new O.W(this),this.ViewCCMapping.ViewCCMappingViewModel_1(this,7,t),this.ViewAttachments=new V.ViewAttachmentViewModel(this),this.UserDefaultScreen=new K.X,this.UserDefaultScreen.UserDefaultScreenViewModelUsers(this),this.Restrict=new j.F(7,0,t),this.ScreenObject.LoadScreen_2(this,7),this.ScreenObject.CustomTab.OnTabChange.Subscribe(this,"onTabSelectionChanged"),this.SaveUsers.Subscribe(this,"OnSaveUsers"),this.LinkDocumentCheckedChanged.Subscribe(this,"OnLinkDocumentCheckedChanged"),this.ButtonCapture=new R.v,0==t?this.ButtonCapture.Visible=!1:s.d.SessionManager.HideUnathorizedAccess?this.ButtonCapture.Visible=s.d.SessionManager.IsActionAssigned(7,"Capture"):this.ButtonCapture.Enable=s.d.SessionManager.IsActionAssigned(7,"Capture"),this.Lang.Label=s.d.GetResource("ComLanguage"),this.Lang.Visible=!0,this.Lang.Enable=!0,this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("ComLanguageEnglish"),"1")),this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("ComLanguageArabic"),"2")),this.Lang.Items.push(l._p.ComboBoxItems_2(s.d.GetResource("Italian"),"3")),this.Lang.DefaultValue="1",this.Lang.SelectedValue="1",this.ScreenObject.HeaderFields=[],this.IsOffline.Label="Online/Offline",s.d.SessionManager.Preferences.ContainsKey("CheckUserONLINEOFFLINE")&&"True"==s.d.SessionManager.Preferences.CheckUserONLINEOFFLINE?this.IsOffline.Enable=this.IsOffline.Visible=!0:this.IsOffline.Visible=!1,this.IsOffline.Items.push(l._p.ComboBoxItems_2("Online","True")),this.IsOffline.Items.push(l._p.ComboBoxItems_2("Offline","false")),this.IsOffline.DefaultValue="True",this.IsOffline.SelectedValue="True",this.TwoStepVerMode.Label="2-Step Verification Mode",this.TwoStepVerMode.Visible=!0,this.TwoStepVerMode.Enable=!0,this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("None","None")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("EMail","EMail")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("SMS","SMS")),this.TwoStepVerMode.Items.push(l._p.ComboBoxItems_2("Both","Both")),this.TwoStepVerMode.DefaultValue="None",this.TwoStepVerMode.SelectedValue="None",this.DeviceID.Label="Device ID",this.MultipleDevices.Label="Multiple Devices",this.ClientID.Label="Client ID",this.ClientID.Visible=!0,this.ClientID.Enable=!0,this.ClientID.DefaultValue="",this.ClientID.Text="",this.TenantID.Label="Tenant ID",this.TenantID.Visible=!0,this.TenantID.Enable=!0,this.TenantID.DefaultValue="",this.TenantID.Text="",this.ClientSecret.Label="Client Secret",this.ClientSecret.Visible=!0,this.ClientSecret.Enable=!0,this.ClientSecret.DefaultValue="",this.ClientSecret.Text="",this.LicenseCount.Label="License Count",this.LicenseCount.Visible=!0,this.LicenseCount.Enable=!0,this.LicenseCount.DefaultValue="0",this.LicenseCount.Text="0",this.FromDate.Label=s.d.GetResource("FromDate"),this.FromDate.Visible=!0,this.FromDate.Enable=!0,this.FromDate.Date=null,this.ToDate.Label=s.d.GetResource("ToDate"),this.ToDate.Visible=!0,this.ToDate.Enable=!0,this.ToDate.Date=null,this.txtConfirmPassword.ColumnSpan=1,this.txtConfirmPassword.Row=0,this.txtConfirmPassword.Column=2,this.txtConfirmPassword.Visible=!0,this.txtConfirmPassword.IsReadOnly=!1,this.txtConfirmPassword.Enable=!0,this.txtConfirmPassword.Label="Confirm Password",this.txtConfirmPassword.Mandatory=!0,this.txtConfirmPassword.DisableLbl=!1,this.txtConfirmPassword.LostFocusCommand.Subscribe(this,"OnPasswordChanged"),this.ScreenObject.StaticFields.push(this.txtConfirmPassword),this.UserName.LostFocusCommand.Subscribe(this,"OnTextChange"),this.TwoStepVerMode.ColumnSpan=1,this.TwoStepVerMode.Row=4,this.TwoStepVerMode.Column=3,this.IsOffline.ColumnSpan=1,this.IsOffline.Row=4,this.IsOffline.Column=2,this.DeviceID.ColumnSpan=1,this.DeviceID.Row=5,this.DeviceID.Column=0,this.ClientID.ColumnSpan=1,this.ClientID.Row=6,this.ClientID.Column=1,this.FromDate.ColumnSpan=1,this.FromDate.Row=5,this.FromDate.Column=2,this.ToDate.ColumnSpan=1,this.ToDate.Row=5,this.ToDate.Column=3,this.TenantID.ColumnSpan=1,this.TenantID.Row=6,this.TenantID.Column=0,this.ClientSecret.ColumnSpan=1,this.ClientSecret.Row=6,this.ClientSecret.Column=2,this.LicenseCount.ColumnSpan=1,this.LicenseCount.Row=3,this.LicenseCount.Column=1,this.Location.ColumnSpan=1,this.Location.Row=3,this.Location.Column=2,this.Lang.ColumnSpan=1,this.Lang.Row=3,this.Lang.Column=0,this.Status.ColumnSpan=1,this.Status.Row=4,this.Status.Column=1,this.MultipleDevices.ColumnSpan=1,this.MultipleDevices.Row=5,this.MultipleDevices.Column=1,this.Division.ColumnSpan=0,this.Division.Row=4,this.Division.Column=0,this.ScreenObject.CustomTab.ColumnSpan=4,this.ScreenObject.CustomTab.Row=7,this.ScreenObject.CustomTab.Column=0,this.txtPassword.IsPwd=!0,this.txtConfirmPassword.IsPwd=!0,this.Email1ConfirmPassword.IsPwd=!0,this.Email2ConfirmPassword.IsPwd=!0,this.Email1Password.IsPwd=!0,this.Email2Password.IsPwd=!0,this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(l._p.ComboBoxItems_2(e.ActualStatus,e.StatusID))}),this.GetRoles(),this.DisplayName=0==t?this.lblTitle:"Edit User",this.RolesAssignGrid=new P(this),this.StatusAssignGrid=new v.w,t>0&&(this.GetSelected(t.toString()),this.UserName.Enable=!1,t==r.J0.Int(s.d.SessionManager.UserID)&&(this.Parent.Enable=!1)),this.Status.LblClick=new c.Yk,this.Status.LblClick.Subscribe(this,"OnSaveUsers","ShowStatusAssignGrid"),this.Status.Enable=!1,this.Parent.LblClick=new c.Yk,this.Parent.LblClick.Subscribe(this,"OnSaveUsers","ShowRoleAssignGrid"),s.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==s.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.ScreenObject.YearMonth=""),this.OnLoad(),this.LoadImageDimensions(),Logger.InfoLog("AddUsersViewModel::Exiting AddUsersViewModel")}catch(e){Logger.ErrorLog("AddUsersViewModel:: AddUsersViewModel ::"+e.stack)}}GetSelected(t){var e=this;return(0,I.A)(function*(){Logger.InfoLog("AddUsersViewModel::Entering GetSelected");try{if(e.dsEdit=[],e.dsEdit=s.d.admin.GetUsersDet(t),e.dsEdit.Tables.length>0&&e.dsEdit.Tables[0].length>0){e.ScreenObject.YearMonth=s.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"TRUE"==s.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()?new Date(e.dsEdit.Tables[0][0].CDATE.toString()).ToString("yyyyMMM"):"",e.UserName.Text=e.dsEdit.Tables[0][0].UserName.toString(),e.UserName.Enable=!1,e.txtPassword.Text=yield e.Decrypt(e.dsEdit.Tables[0][0]),e.strPasswordCheckOTP=e.txtPassword.Text,e.txtConfirmPassword.Text=e.txtPassword.Text,e.SaveUserId=parseInt(e.dsEdit.Tables[0][0].UserID),e.guid=e.dsEdit.Tables[0][0].GUID.toString(),e.Parent.SelectedValue=e.dsEdit.Tables[0][0].RoleID.toString(),e.Email1.Text=e.dsEdit.Tables[0][0].Email1.toString(),e.Email2.Text=e.dsEdit.Tables[0][0].Email2.toString(),e.Email1Password.Text=yield e.DecryptEmailPass(e.dsEdit.Tables[0][0].Email1Password.toString()),e.Email2Password.Text=yield e.DecryptEmailPass(e.dsEdit.Tables[0][0].Email2Password.toString()),e.Email1ConfirmPassword.Text=e.Email1Password.Text,e.Email2ConfirmPassword.Text=e.Email2Password.Text,e.ScreenObject.LoadPrimaryContactData(e.dsEdit.Tables[0],e.dsEdit.Columns[0]),e.UserDefaultScreen.LoadData(e.dsEdit.Tables[0][0].DefaultScreenXML.toString()),e.Lang.SelectedValue=e.dsEdit.Tables[0][0].DefaultLanguage.toString(),e.IsOffline.SelectedValue=e.dsEdit.Columns[0].Contains("IsOffline")&&"0"==e.dsEdit.Tables[0][0].IsOffline.toString()&&"False"==e.dsEdit.Tables[0][0].IsOffline.toString()?"false":"True",e.Status.SelectedValue=e.dsEdit.Tables[0][0].StatusID.toString(),e.LicenseCount.Text=e.dsEdit.Tables[0][0].InstanceCount.toString(),e.TwoStepVerMode.SelectedValue=e.dsEdit.Columns[0].Contains("TwoStepVerMode")&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].TwoStepVerMode.toString())?e.dsEdit.Tables[0][0].TwoStepVerMode.toString():"None",e.Location.SelectedValue=e.dsEdit.Columns[0].Contains("LocationID")&&null!=e.dsEdit.Tables[0][0].LocationID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].LocationID.toString())&&parseInt(e.dsEdit.Tables[0][0].LocationID.toString())>0?parseInt(e.dsEdit.Tables[0][0].LocationID.toString()):0,e.Division.SelectedValue=e.dsEdit.Columns[0].Contains("DivisionID")&&null!=e.dsEdit.Tables[0][0].DivisionID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].DivisionID.toString())&&parseInt(e.dsEdit.Tables[0][0].DivisionID.toString())>0?parseInt(e.dsEdit.Tables[0][0].DivisionID.toString()):0,e.DeviceID.Text=e.dsEdit.Tables[0][0].DeviceID.toString(),e.dsEdit.Columns[0].Contains("ClientID")&&null!=e.dsEdit.Tables[0][0].ClientID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].ClientID.toString())&&(e.ClientID.Text=e.dsEdit.Tables[0][0].ClientID.toString()),e.dsEdit.Columns[0].Contains("TenantID")&&null!=e.dsEdit.Tables[0][0].TenantID&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].TenantID.toString())&&(e.TenantID.Text=e.dsEdit.Tables[0][0].TenantID.toString()),e.dsEdit.Columns[0].Contains("ClientSecret")&&null!=e.dsEdit.Tables[0][0].ClientSecret&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].ClientSecret.toString())&&(e.ClientSecret.Text=e.dsEdit.Tables[0][0].ClientSecret.toString()),e.dsEdit.Columns[0].Contains("AccessFromDate")&&null!=e.dsEdit.Tables[0][0].AccessFromDate&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].AccessFromDate.toString())&&(e.FromDate.Date=new Date(e.dsEdit.Tables[0][0].AccessFromDate)),e.dsEdit.Columns[0].Contains("AccessToDate")&&null!=e.dsEdit.Tables[0][0].AccessToDate&&!r.J0.IsEmpty(e.dsEdit.Tables[0][0].AccessToDate.toString())&&(e.ToDate.Date=new Date(e.dsEdit.Tables[0][0].AccessToDate));let n=!1;e.MultipleDevices.IsChecked=e.dsEdit.Tables[0][0].MultipleDevices.toString(),e.MultipleDevices.IsChecked=n,e.RolesAssignGrid.load(e.dsEdit.Tables[2]),e.ViewAttachments.LoadAttachments(e.dsEdit.Tables[3]),e.StatusAssignGrid.Load(e.dsEdit.Tables[4])}if(e.dsEdit.Tables.length>1&&e.dsEdit.Tables[1].length>0&&e.ViewCCMapping.LoadData(e.dsEdit.Tables[1],e.dsEdit.Columns[1]),1==e.SaveUserId){e.UserName.Enable=!1,e.Parent.Enable=!1;for(let n in e.ScreenObject.CustomTab.Pages[0].Fields)return null!=n&&Logger.InfoLog("AddUsersViewModel::Exiting GetSelected"),e.dsEdit.toString()}}catch(i){return Logger.ErrorLog("AddUsersViewModel:: AddUsersViewModel ::"+i.stack),""}})()}GetCompanyXml(){Logger.InfoLog("AddUsersViewModel::Entering GetCompanyXml");try{let t="";t+="<XML>";for(let e=0;e<this.CompanyList.Items.length;e++)this.CompanyList.Items[e].IsChecked&&(t+='<Row COMPID="'+this.CompanyList.Items[e].Value,this.DefCompList.Items[e].Value==this.DefCompList.SelectedValue.toString()?t+='" ISDEFAULT="true" />':t+='" ISDEFAULT="false" />');return t+="</XML>",Logger.InfoLog("AddUsersViewModel::Exiting GetCompanyXml"),t.toString()}catch(t){return Logger.ErrorLog("AddUsersViewModel:: GetCompanyXml ::"+t.stack),""}}OnLinkDocumentCheckedChanged(t){Logger.InfoLog("AddUsersViewModel::Entering OnLinkDocumentCheckedChanged");try{t.GetType()==typeof l.oN&&(this.DefCompList.Items.push(l._p.ComboBoxItems_2(l.oN.CheckedListBoxItem_1(t).Name,l.oN.CheckedListBoxItem_1(t).Value)),this.DefCompList.Items.filter(i=>i.Value==l.oN.CheckedListBoxItem_1(t).Value),this.DefCompList.Items.push())}catch{Logger.InfoLog("AddUsersViewModel::Exiting OnLinkDocumentCheckedChanged")}}OnPasswordChanged(t){this.txtConfirmPassword.Text=t.Text,this.CheckPassword()}OnTextChange(t){Logger.InfoLog("AddUsersViewModel::Entering OnTextChange"),this.DisplayMessage=this.IsUserExists(this.UserName.Text)?s.d.GetResource("Users_Exists"):"",Logger.InfoLog("AddUsersViewModel::Exiting OnTextChange")}CheckPassword(){return Logger.InfoLog("AddUsersViewModel::Entering CheckPassword"),null!=this.txtPassword.Text&&null!=this.txtConfirmPassword.Text?this.txtPassword.Text!=this.txtConfirmPassword.Text?(this.DisplayMessage=s.d.GetResource("Users_PwdError"),this.MessageVisibility=!0,!1):(this.MessageVisibility=!1,!0):(this.DisplayMessage=" Password Mismatch ",this.MessageVisibility=!0,Logger.InfoLog("AddUsersViewModel::Exiting CheckPassword"),!1)}CheckEmailPasswords(){Logger.InfoLog("AddUsersViewModel::Entering CheckEmailPasswords");let t="",e="",i="",n="";return null!=this.Email1Password.Text&&""!=this.Email1Password.Text&&(t=this.Email1Password.Text),null!=this.Email1ConfirmPassword.Text&&""!=this.Email1ConfirmPassword.Text&&(e=this.Email1ConfirmPassword.Text),null!=this.Email2Password.Text&&""!=this.Email2Password.Text&&(i=this.Email2Password.Text),null!=this.Email2ConfirmPassword.Text&&""!=this.Email2ConfirmPassword.Text&&(n=this.Email2ConfirmPassword.Text),t!=e?(this.DisplayMessage=s.d.GetResource("Users_PwdError")+" at Email 1",!1):i!=n?(this.DisplayMessage=s.d.GetResource("Users_PwdError")+" at Email 2",!1):(this.MessageVisibility=!1,!0)}GetRoles(){try{let t="";"1"!=s.d.SessionManager.UserID?(t=s.d.SessionManager.Preferences.ContainsKey("LWRole")&&"true"==s.d.SessionManager.Preferences.LWRole.toLowerCase()?s.d.SessionManager.LocationWhereWithParent:null,s.d.SessionManager.Preferences.ContainsKey("DWRole")&&"true"==s.d.SessionManager.Preferences.DWRole.toLowerCase()?t+=s.d.SessionManager.DivisionID>0?"~"+s.d.SessionManager.DivisionID.toString():"~"+s.d.SessionManager.DivisionWhere:t+="~null"):(t=null,t+="~null"),t+="~"+s.d.SessionManager.UserID,t+="~"+s.d.SessionManager.LanguageID;let e=s.d.empService.getUserRoles(this.CostCenterID,t);if(e.Tables[0].forEach(i=>{this.Parent.Items.push(l._p.ComboBoxItems_2(i.Name.toString(),i.RoleID.toString()))}),e.Tables.length>0)for(let i=0;i<e.Tables[1].length;i++)this.CompanyList.Items.push(l.oN.CheckedListBoxItem_3(e.Tables[1][i].NAME.toString(),e.Tables[1][i].COMPANYID.toString()));Logger.InfoLog("AddCostCenterViewModel::Entering GetRoles")}catch(t){Logger.ErrorLog("AddCostCenterViewModel:: GetRoles"+t.stack)}}IsUserExists(t){Logger.InfoLog("VoucherGenerator:: Inside IsBatchIdExists");let e=[];e.push(t);let i=s.d.admin.IsUserExists(e);return Logger.InfoLog("VoucherGenerator:: Exiting IsBatchIdExists"),null!=i&&i.Tables.length>0&&i.Tables[0].length>0}OnLoad(){Logger.InfoLog("AddUsersViewModel::Entering OnLoad");for(let t=this.ScreenObject.CustomTab.Pages.length-1;t>=0;t--){let e=this.ScreenObject.CustomTab.Pages[t];switch(e.Name){case"Assign":e.Fields=[],e.Fields.push(this.ViewCCMapping);break;case"Default Screen":e.Fields=[],e.Fields.push(this.UserDefaultScreen)}}this.AddRestrictTab()}OnSaveUsers(t){var e=this;return(0,I.A)(function*(){try{if(e.DisplayMessage="","Save"==t.toString()){1==e.isUserFrmClone&&(e.SaveUserId=0);let i="";if(i=null==e.UserName.Text||""==e.UserName.Text?"Enter User Name":null==e.Parent.SelectedValue||""==e.Parent.SelectedValue?"Select Role":null==e.txtPassword.IsPwd||""==e.txtPassword.Text?"Enter Password":e.ScreenObject.ValidateData(),i.length>0)e.DisplayMessage=i;else if(null==e.txtConfirmPassword.Text||""==e.txtConfirmPassword.Text)e.DisplayMessage=" Please Enter Confirm Password ";else{let n=!0;if(0==e.SaveUserId&&(null!=e.UserName.Text&&""!=e.UserName.Text?n=!e.IsUserExists(e.UserName.Text.Trim()):e.DisplayMessage="Please enter UserName"),n)if(e.CheckPassword()){if(s.d.SessionManager.Preferences.ContainsKey("OTPValidation")&&""!=s.d.SessionManager.Preferences.OTPValidation&&(0,f.yG0)(s.d.SessionManager.Preferences.OTPValidation)&&e.SaveUserId>0&&e.strPasswordCheckOTP!=e.txtPassword.Text){(new _.N).SmsEmailOTPViewModel_2(e,0),s.d.page.ShowDialog(F._,{ShowCenter:!0,Title:"OTP Verification"}).subscribe(()=>{})}if(e.DisplayMessage=r.J0.ValidatePassword(e.txtPassword.Text),e.DisplayMessage.length>0)return;e.CheckEmailPasswords()&&(e.MessageVisibility=!0),""==e.guid&&(e.guid=r.J0.NewGuid());let h="";h=e.ScreenObject.GetPrimaryContact(),h+="Email1='"+e.Email1.Text+"',",r.J0.IsEmpty(e.Email1Password.Text)?h+="Email1Password='',":h+="Email1Password='@ENC@"+r.J0.EncryptString(e.Email1Password.Text)+"',",h+="Email2='"+e.Email2.Text+"',",r.J0.IsEmpty(e.Email2Password.Text)?h+="Email2Password='',":h+="Email2Password='@ENC@"+r.J0.EncryptString(e.Email2Password.Text)+"',";let a=[];a.push(e.SaveUserId),a.push(parseInt(e.Parent.SelectedValue)),a.push(e.UserName.Text);let Y=yield s.d.admin.EncryptString2(e.txtPassword.Text,e.UserName.Text);a.push(Y.EncryptString2),a.push(1),a.push(e.Lang.SelectedValue),a.push(e.IsOffline.SelectedValue),a.push(e.TwoStepVerMode.SelectedValue),a.push(e.DeviceID.Text),a.push(e.MultipleDevices.IsChecked),a.push(h),a.push(s.d.SessionManager.CompanyIndex);let L={};e.DisplayMessage=e.ViewCCMapping.GetXML(L);let S,$=L.strXML;if(!r.J0.IsEmpty(e.DisplayMessage))return;a.push($),a.push(e.Restrict.GetXML()),a.push(e.UserDefaultScreen.GetXML()),S=r.J0.Double(e.LicenseCount.Text),S<0&&(S=0),a.push(S);let g="";null!=e.Sites&&(e.Sites.Items.filter(u=>u.IsChecked).forEach(u=>{g+='<R ID=" + chk.valueOf + "/>'}),0==g.length&&(e.DisplayMessage="Please assign atleast one site"),g="<Lic>"+g+"</Lic>"),a.push(g),a.push(e.ViewAttachments.GetXML()+e.GetImageXML()),a.push(e.RolesAssignGrid.GetXML()),a.push(e.StatusAssignGrid.GetXML()),a.push(e.Location.SelectedValue),a.push(e.Division.SelectedValue),a.push(s.d.SessionManager.CompanyGUID),a.push(e.guid),a.push(s.d.SessionManager.UserName),a.push(s.d.SessionManager.UserID),a.push(s.d.SessionManager.RoleID),a.push(s.d.SessionManager.LanguageID),a.push(e.ClientID.Text),a.push(e.TenantID.Text),a.push(e.ClientSecret.Text),a.push(e.FromDate.Visible&&e.FromDate.Date?e.FromDate.Date.ToString("dd/MMM/yyyy"):null),a.push(e.ToDate.Visible&&e.ToDate.Date?e.ToDate.Date.ToString("dd/MMM/yyyy"):null);let T=0,C=s.d.admin.CreateUser(a);if(T=C.obj,T>0){if(e.DisplayMessage=e.SaveUserId>0?" User Updated Successfully  ":" User Saved  Successfully",1==e.isUserFrmClone&&0==e.SaveUserId){let u=[];u.push(T),u.push(e.UserName.Text),u.push(e.CopySaveUserID),u.push(e.CopySaveUserName),u.push(s.d.SessionManager.LanguageID),u.push(s.d.SessionManager.UserName),u.push(s.d.SessionManager.UserID),s.d.admin.CloneUserWithAllRight(s.d.SessionManager.CompanyIndex)}e.isUserFrmClone=0,e.ViewCCMapping.Clear(),e.RolesAssignGrid.Clear(),e.StatusAssignGrid.Clear(),e.ViewAttachments.AttachmentsList.Clear(),e.AccountPhoto="",e.ActualFileName="",e.PhotoTextVisibility=!0,e.ScreenObject.Clear(),e.txtConfirmPassword.Text="",e.MultipleDevices.IsChecked=!1,e.DeviceID.Text="",e.ClientID.Text="",e.TenantID.Text="",e.ClientSecret.Text="",e.UserName.Enable=!0,null!=e.ParentWind&&e.ParentWind.Refresh()}else null!=C&&C.Tables.length>1&&(e.DisplayMessage=C.Tables[C.Tables.length-1][0].ErrorMessage.toString())}else e.MessageVisibility=!0;else e.DisplayMessage=s.d.GetResource("Users_Exists")}}else if("PopUp"==t.toString()){let i;if(null!=e.dsEdit&&e.dsEdit.Tables.length>3&&e.dsEdit.Tables[3].Select("FileExtension='jpg' or FileExtension='png'").forEach(h=>{i+=r.J0.GetPath(h.GUID.toString()+"."+h.FileExtension.toString(),e.ScreenObject.YearMonth)+";"}),""!=e.AccountPhoto){const{PopupImageViewModel:n}=yield Promise.resolve().then(o.bind(o,70968)),{PopupImageComponent:h}=yield Promise.resolve().then(o.bind(o,45704));let a=new n("Popup Image","OK",!0,e.AccountPhoto,i);s.d.page.ShowDialog(a,h,{ShowCenter:!0,Title:"Popup Image"})}}else if("UploadPhoto"==t.toString()){let i=new J.R;i.PopupAttachmentsViewModel_1(e.CostCenterID,e.SaveUserId,e),s.d.page.ShowDialog(i,k.p,{ShowCenter:!0,Title:"Add Images"})}else"MouseDown"==t.toString()||("DeletePhoto"==t.toString()?0==e.AccountPhoto.length?e.ImageHeight=(45*parseInt(e.ImgRowSpan)).toString():confirm("Are you sure you want to delete Image?")&&(e.IsPhotoDelete=!0,e.AccountPhoto="",e.ActualFileName="",e.DialogResult=!1,e.IsPhotoChanged=!1,e.PhotoTextVisibility=!0,e.DisplayMessage="",e.ImageHeight=(parseInt(e.ImageHeight)-15).toString(),e.FileID>0&&(e.DeletedFileID=e.FileID)):"ShowRoleAssignGrid"==t.toString()?(e.RolesAssignGrid.IsShown=!0,s.d.page.ShowDialog(e.RolesAssignGrid,M.m,{ShowCenter:!0,Title:s.d.GetResource("Assign")})):"ShowStatusAssignGrid"==t.toString()&&(e.StatusAssignGrid.IsShown=!0,s.d.page.ShowDialog(e.StatusAssignGrid,M.m,{ShowCenter:!0,Title:s.d.GetResource("Assign")})));t.toString(),e.AddUserDefaultScreenTab(e.dsEdit),Logger.InfoLog("AddUserViewModel::Exiting OnSaveUsers")}catch(i){Logger.ErrorLog("AddUsersViewModel:: OnSaveUsers ::"+i.stack)}})()}AddUserDefaultScreenTab(t){let e=new m.O;e.Name="DefaultScreen",e.Header="Default Screen",e.Fields.push(this.UserDefaultScreen),this.RoleID>0&&this.UserDefaultScreen.LoadData(r.J0.String(t.Tables[0][0].DefaultScreenXML)),this.CustomTab.Pages.push(e)}GetImageXML(){try{let t="";return this.IsPhotoChanged&&!r.J0.IsEmpty(this.AccountPhoto)?(t+=0==this.FileID?'<Row Action="NEW"':'<Row Action="MODIFY"',s.d.SessionManager.IsWebApplication&&(t+=' AttachmentID="'+this.FileID+'"',t+=' FilePath="'+this.AccountPhoto+'"',t+=' ActualFileName="'+this.ActualFileName+'"',t+=' RelativeFileName="'+this.AccountPhoto+'"',t+=' FileExtension="'+this.FileExtension+'"',t+=' FileDescription=""',t+=' IsProductImage="1"',t+=' GUID="'+this.guid+'"',t+=' FolderPath="'+this.ScreenObject.YearMonth+'"',t+=' IsDefaultImage="1"',t+="/>")):this.IsPhotoDelete&&this.FileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.FileID+'"/>'),this.IsPhotoDelete&&this.DeletedFileID>0&&(t+='<Row Action="DELETE"',t+=' AttachmentID="'+this.DeletedFileID+'"/>'),t.length>0?(t="<AttachmentsXML>"+t+"</AttachmentsXML>",t.toString()):""}catch{return this.DisplayMessage=s.d.GetResource("Upload_Path_notExists"),this.MessageVisibility=!0,""}}OnShowCC(){}onSave(){this.CCMap=new N.AddCCMapViewModel(this)}AddRestrictTab(){let t,e=[];e.push(this.PNodeID),e.push(s.d.SessionManager.RoleID),e.push(s.d.SessionManager.LanguageID),t=s.d.admin.GetUserRetrictTypes(this.PNodeID);let i=new m.O;i.Name="Allow",i.Header="Allow",i.Fields=[],i.Fields.push(this.Restrict),this.Restrict.onLoad(t.Tables[0],0==this.PNodeID?t.Tables[1]:t.Tables[2].length>0?t.Tables[2]:t.Tables[1]),this.ScreenObject.CustomTab.Pages.push(i)}AddLicenseTab(){let t=new m.O;t.Name="Site",t.Header="Site";let i=s.d.admin.GetAccessRights(11,s.d.ForwardProgress.LCDBIndex,null!=this.UserName.Text?this.UserName.Text:"","").ds;this.Sites=new l.v4,i.Table.forEach(n=>{i.Table1.filter(h=>h.SiteMap==n.SiteID),this.Sites.Items.push(l.oN.CheckedListBoxItem_5(n.SitesName.toString(),n.SID.toString(),!1))}),t.Fields=[],t.Fields.push(this.Sites),this.ScreenObject.CustomTab.Pages.push(t)}OnDeleteCallBack(){}Decrypt(t){let e=t.Password.toString();return r.J0.hasprop(t,"IsPassEncr")&&(0,f.yG0)(t.IsPassEncr)&&(e=r.J0.DecryptString2(r.J0.StringValue(t.Password),r.J0.StringValue(t.UserName)),e==r.J0.StringValue(r.J0.StringValue(t.Password))&&(e=r.J0.DecryptString(r.J0.StringValue(t.Password)))),e}DecryptEmailPass(t){return(0,I.A)(function*(){return t.startsWith("@ENC@")&&(t=yield r.J0.DecryptString(t.substr(5))),t.DecryptString})()}}class P{constructor(t){this.ClassName="RolesAssignGridViewModel",this.ButtonClick=new c.Yk,this.IsShown=!1,this.iTableColumns=[],this.Columns=[],this.col=new D.O7,this.Grid=new B.vv,this.Grid.Width="",this.Grid.Table=[],this.UserScreen=t,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.iTableColumns.push("MapID"),this.iTableColumns.push("RoleID"),this.iTableColumns.push("RoleName"),this.iTableColumns.push("FromDate"),this.iTableColumns.push("FromDate_Key"),this.iTableColumns.push("ToDate"),this.iTableColumns.push("ToDate_Key"),this.iTableColumns.push("StatusID"),this.iTableColumns.push("Delete"),this.col.Header="Data",this.col.DataType="LISTBOX",this.col.DisplayMember="RoleName",this.col.ValueMember="RoleID",this.col.TypeID=1,this.col.CostCenterID=6,this.col.Width=220,this.Columns.push(this.col),this.col=new D.O7,this.col.Header="From Date",this.col.DisplayMember="FromDate",this.col.DataType="DATE",this.col.Width=120,this.Columns.push(this.col),this.col=new D.O7,this.col.Header="To Date",this.col.DisplayMember="ToDate",this.col.DataType="DATE",this.col.Width=120,this.Columns.push(this.col),this.col=new D.O7,this.col.Header="Status",this.col.ValueBinding="StatusID",this.col.DataType="ComboBox",this.col.DisplayMember="Name",this.col.ValueMember="Value",this.col.Width=130;let e=[];e.push(l._p.ComboBoxItems_2("Active","1")),e.push(l._p.ComboBoxItems_2("In-Active","2")),this.col.ComboData=e,this.Columns.push(this.col),this.col=new D.O7,this.col.Header=s.d.GetResource("Delete"),this.col.DisplayMember="Delete",this.col.DataType="LINK",this.col.ValueMember="Delete",this.col.ReadOnly=!0,this.col.IsFrozen=!0,this.col.Width=130,this.Columns.push(this.col),this.Grid.Columns=this.Columns,this.Clear()}OnBeginEdit(t){t instanceof G.ae&&null!=this.dr.MapID&&this.ShowMessageBox("Role not allowed to change")}OnButtonClick(t){("Cancel"==t||"OK"==t)&&s.d.page.HideDialog()}load(t){this.Grid.Clear();let e=s.d.SessionManager.Preferences["Date Format"];for(let i=0;i<t.length;i++){let n=this.Grid.NewRow();n.MapID=t[i].UserRoleMapID,n.RoleID=t[i].RoleID,n.RoleName=t[i].RoleName,null!=t[i].FromDate&&(n.FromDate=new Date(t[i].FromDate).toLocaleDateString(e),n.FromDate_Key=t[i].FromDate),null!=t[i].ToDate&&(n.ToDate=new Date(t[i].ToDate).toLocaleDateString(e),n.ToDate_Key=t[i].ToDate),n.StatusID=t[i].Status,n.Delete="Delete",this.Grid.addRow(n)}this.Grid.addEmptyRow(),this.Grid.addEmptyRow();for(let i=this.Grid.Table.length;i<10;i++)this.Grid.addEmptyRow()}Clear(){this.IsShown=!1,this.Grid.Clear();for(let t=0;t<10;t++)this.Grid.addEmptyRow()}GetXML(){let t="";for(let e of this.Grid.Table)(null!=e.RoleID&&parseInt(e.RoleID)>0||null!=e.MapID&&parseInt(e.MapID)>0)&&(t+='<Row RoleID="'+e.RoleID.toString()+'"',null!=e.MapID&&parseInt(e.MapID)>0&&null!=e.RoleID&&parseInt(e.RoleID)>0?(t+=' MapID="'+e.MapID.toString()+'"',t+=' Action="EDIT"'):null!=e.MapID&&parseInt(e.MapID)>0&&null==e.RoleID?(t+=' MapID="'+e.MapID.toString()+'"',t+=' Action="DELETE"'):t+=' Action="NEW"',null!=e.FromDate_Key&&e.FromDate_Key.toString().length>0&&(t+=' FromDate="'+new Date(e.FromDate_Key).ToString("dd MMM yyyy")+'"',null!=e.ToDate_Key&&e.ToDate_Key.toString().length>0&&(t+=' ToDate="'+new Date(e.ToDate_Key).ToString("dd MMM yyyy")+'"')),null!=e.StatusID&&e.StatusID.toString().length>0?t+=' StatusID="'+e.StatusID.toString()+'"':t+=' StatusID="1"',t+="/>");return t.length>0&&(t.Insert(0,"<XML>"),t+="</XML>"),t.toString()}}class H{constructor(){this.ButtonClick=new c.Yk,this.ButtonClick.Subscribe(this,"OnButtonClick"),this.RolesList=this.ds.Tables[4].DefaultView,this.SelectedRole=this.RolesList[0]}OnButtonClick(t){if("Cancel"==t)s.d.page.HideDialog();else if("Select"==t){if(null==this.SelectedRole)return void(this.DisplayMessage="Please Select Role");this.ds.Tables[0][0].RoleID=parseInt(this.SelectedRole.RoleID),this.ds.Tables[0][0].Name=this.SelectedRole.RoleName.toString(),this.ds.Tables[0][0].RoleType=this.SelectedRole.RoleType.toString(),s.d.page.HideDialog()}}}}}]);