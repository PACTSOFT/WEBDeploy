"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9978],{69978:(W,T,u)=>{u.r(T),u.d(T,{GenerateBillsViewModel:()=>k});var I=u(10467),n=u(86739),r=u(8787),b=u(32647),P=u(23823),w=u(49710),C=u(18569),S=u(95543),y=u(72099),M=u(10287),V=u(81669),f=u(24028),d=u(92701),v=u(98669),O=u(83240),N=u(40044),G=u(89747),L=u(31820);class B extends G.d{get ClearSelectedNodes(){return this._ClearSelectedNodes}set ClearSelectedNodes(e){this._ClearSelectedNodes=e,this.tree.length>0&&(this.tree[0].ClearAllSelectedNodes=!this.tree[0].ClearAllSelectedNodes)}constructor(){super(),this.LocationCheckedChanged=new V.Yk,this.ButtonClick=new V.Yk,this.IsQuit=!0,this.IsOK=!1,this.FromDate=new f.Lc(0),this.TreeVisibility=!0,this._ClearSelectedNodes=!1,this.VoucherWiseRadio=new S.u("",0,"Doc"),this.DateWiseRadio=new S.u("",0,"Doc"),this.Documents=new d.y$(0),this.ToDate=new f.Lc(0),this.DateRanges=new d.y$(0),this.Location=new d.v4,this.Division=new d.v4,this.DimensionWise=new d.v4,this.Dimension=0,this.BasedOn=new d.y$(0),this.Status=new d.y$(0),this.Customer=new v.y$(0),this.From=new L.Dw(0),this.TO=new L.Dw(0),this.InvoiceDate=new f.Lc(0),this.TillDate=new f.Lc(0),this.LockCheckedChanged=!1,this.VoucherWiseRadio.Label=n.d.GetResource("Com_HCNoWise"),this.VoucherWiseRadio.CheckedChangedCommand.Subscribe(this,"onVoucherWiseCheck"),this.DateWiseRadio.Label=n.d.GetResource("Com_DateWise"),this.DateWiseRadio.CheckedChangedCommand.Subscribe(this,"onDateWiseCheck")}GenerateBillsDialogViewModel_1(e){this.parent=e,this.Title=n.d.GetResource("DocumentDesigner_PostedDocument"),this.Load(),this.TreeVisibility&&(this.CostCenters.Label=n.d.GetResource("Reports_SelectCostCenter"))}Load(){this.Customer.Label=n.d.GetResource("Reports_Customer"),this.FromDate.Label=n.d.GetResource("DocumentDesigner_FromDate"),this.ToDate.Label=n.d.GetResource("DocumentDesigner_ToDate"),this.FromDate.Date=n.d.SessionManager.ReportsFromDate,this.DateRanges=O.w.getDateRanges(),this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.LocationCheckedChanged.Subscribe(this,"OnLocationCheckedChanged"),this.Location=new d.v4,this.Location.CheckedChangedCommand.Subscribe(this,"OnLocationCheckedChanged"),this.Location.Items.push(d.oN.CheckedListBoxItem_6("All","All",!1,50002)),this.Location.Label=n.d.GetResource("lblPDCLocation"),this.Location.Visible=!!(n.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,b.yG0)(n.d.SessionManager.Preferences.EnableLocationWise)&&n.d.SessionManager.Preferences.ContainsKey("LW GenerateBills")&&""!=n.d.SessionManager.Preferences["LW GenerateBills"]&&(0,b.yG0)(n.d.SessionManager.Preferences["LW GenerateBills"])),this.tree=[],this.CostCenterFilters=[],this.CostCenters=new d.y$(0),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),this.Division=new d.v4,this.Division.Label=n.d.GetResource("Division"),this.Division.CheckedChangedCommand.Subscribe(this,"OnLocationCheckedChanged"),this.Division.Items.push(d.oN.CheckedListBoxItem_6("All","All",!1,50001)),this.Division.Visible=!!(n.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&(0,b.yG0)(n.d.SessionManager.Preferences.EnableDivisionWise)&&n.d.SessionManager.Preferences.ContainsKey("DW GenerateBills")&&""!=n.d.SessionManager.Preferences["DW GenerateBills"]&&(0,b.yG0)(n.d.SessionManager.Preferences["DW GenerateBills"])),n.d.SessionManager.Preferences.ContainsKey("GenerateBillsFilterDimension")&&null!=n.d.SessionManager.Preferences.GenerateBillsFilterDimension&&""!=n.d.SessionManager.Preferences.GenerateBillsFilterDimension.toString()&&"0"!=n.d.SessionManager.Preferences.GenerateBillsFilterDimension.toString()&&(this.Dimension=parseInt(n.d.SessionManager.Preferences.GenerateBillsFilterDimension.toString())),this.DimensionWise=new d.v4,this.DimensionWise.Items.push(d.oN.CheckedListBoxItem_6("All","All",!1,this.Dimension)),this.DimensionWise.Visible=this.Dimension>5e4&&!this.TreeVisibility,this.Customer.Label="Customer",this.Customer.CCID=2,this.Customer.TypeID=2,this.BasedOn.Label="Post Bills",this.Status.Label="Show Contracts",this.BasedOn.Items.push(d._p.ComboBoxItems_2("Contract based","0")),this.BasedOn.Items.push(d._p.ComboBoxItems_2("Customer based","1")),this.Status.Items.push(d._p.ComboBoxItems_2("Both","0")),this.Status.Items.push(d._p.ComboBoxItems_2("Pending","1")),this.Status.Items.push(d._p.ComboBoxItems_2("Invoiced","2")),this.BasedOn.SelectedValue="0",this.Status.SelectedValue="1",this.From.Label="From",this.TO.Label="To",this.InvoiceDate.Label="Invoice Date",this.VoucherWise=!1,this.VoucherWiseRadio.IsChecked=!1,this.DateWise=!0,this.DateWiseRadio.IsChecked=!0,this.TillDate.Label="Till Date",this.Documents.Items.push(d._p.ComboBoxItems_2("",""));let e=n.d.rental.GetFeatures();for(let s=0;s<e.Tables[0].length;s++)this.CostCenters.Items.push(d._p.ComboBoxItems_2(r.J0.String(e.Tables[0][s].Name),r.J0.String(e.Tables[0][s].FeatureID)));if(null!=this.parent){if(this.Location.Visible){let s=n.d.admin.getLocationRoles(["50002",n.d.SessionManager.LangID]),a=n.d.SessionManager.LocationWhere.split(","),t=r.J0.IsEmpty(this.parent.Locations)?[{LocationID:n.d.SessionManager.LocationID.toString()}]:this.parent.Locations.split(",");if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++)(0,b.yG0)(s.Tables[0][i].IsGroup.toString())||a.Contains(s.Tables[0][i][s.Columns[0][0]].toString())&&(t.Contains(s.Tables[0][i][s.Columns[0][0]].toString())?this.Location.Items.push(d.oN.CheckedListBoxItem_6(s.Tables[0][i][s.Columns[0][2]].toString(),s.Tables[0][i][s.Columns[0][0]].toString(),!0,50002)):this.Location.Items.push(d.oN.CheckedListBoxItem_6(s.Tables[0][i][s.Columns[0][2]].toString(),s.Tables[0][i][s.Columns[0][0]].toString(),!1,50002)))}if(this.Division.Visible){let s=n.d.admin.getLocationRoles([50001,n.d.SessionManager.LangID]),a=this.Location.Visible?n.d.SessionManager.DivisionWhere.split(","):n.d.SessionManager.LocationWhere.split(","),t=r.J0.IsEmpty(this.parent.Divisions)?this.Location.Visible?n.d.SessionManager.DivisionID.toString():n.d.SessionManager.LocationID.toString():this.parent.Divisions.split(",");if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++)(0,b.yG0)(s.Tables[0][i].IsGroup.toString())||a.Contains(s.Tables[0][i][s.Columns[0][0]].toString())&&(t.Contains(s.Tables[0][i][s.Columns[0][0]].toString())?this.Division.Items.push(d.oN.CheckedListBoxItem_6(s.Tables[0][i][s.Columns[0][2]].toString(),s.Tables[0][i][s.Columns[0][0]].toString(),!0,50001)):this.Division.Items.push(d.oN.CheckedListBoxItem_6(s.Tables[0][i][s.Columns[0][2]].toString(),s.Tables[0][i][s.Columns[0][0]].toString(),!1,50001)))}if(this.DimensionWise.Visible){let s=!1;s="1"!=n.d.SessionManager.UserID&&n.d.SessionManager.Preferences.ContainsKey("Dimension List")&&!r.J0.IsEmpty(n.d.SessionManager.Preferences["Dimension List"])&&n.d.SessionManager.Preferences["Dimension List"].toString().Contains(this.Dimension.toString());let a=n.d.SessionManager.Preferences.ContainsKey("Dimension List")&&!r.J0.IsEmpty(n.d.SessionManager.Preferences["Dimension List"])&&n.d.SessionManager.Preferences["Dimension List"].toString().Contains(this.Dimension.toString()),t=n.d.SessionManager.Preferences.ContainsKey("RoleDimension List")&&!r.J0.IsEmpty(n.d.SessionManager.Preferences["RoleDimension List"])&&n.d.SessionManager.Preferences["RoleDimension List"].toString().Contains(this.Dimension.toString()),i=n.d.common.GetDataSet3("PDDVM03",this.Dimension.toString(),a+"~"+t,n.d.SessionManager.UserID+","+n.d.SessionManager.LanguageID),l=this.parent.Dimensions.split(",");if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){for(let o=0;o<i.Tables[0].length;o++)(0,b.yG0)(i.Tables[0][o].IsGroup.toString())||(l.Contains(i.Tables[0][o][i.Columns[0][0]].toString())?this.DimensionWise.Items.push(d.oN.CheckedListBoxItem_6(i.Tables[0][o].Name.toString(),i.Tables[0][o].NodeID.toString(),!0,this.Dimension)):this.DimensionWise.Items.push(d.oN.CheckedListBoxItem_6(i.Tables[0][o].Name.toString(),i.Tables[0][o].NodeID.toString(),!1,this.Dimension)));this.DimensionWise.Label=i.Tables.length>1&&i.Tables[1].length>0?i.Tables[1][0][i.Columns[1][0]].toString():"Dimension"}}}}OnCostCenterChange(e){if(!r.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let s=0;null!=this.CostCenters.SelectedItem&&!r.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(s=r.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),s,0,null)}}LoadCostCenterTree(e,s,a,t){this.tree.Clear();let i="";50002==e&&"True"==n.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==n.d.SessionManager.Preferences["LW Reports"]&&(i=r.J0.IsEmpty(n.d.SessionManager.LocationWhere)?"a.NodeID IN (-1234)":"a.NodeID IN ("+n.d.SessionManager.LocationWhere+")");let l=new N.T;if(null==t)for(let o=0;o<this.CostCenterFilters.length;o++){const c=this.CostCenterFilters[o];if(c.CostCenterID==e&&c.LookupTypeID==s){t=c.SelectedNodes;break}}null==t?l.TreeViewModel_5(e,this,a,i,""):l.TreeViewModel_6(e,this,a,i,t,""),l.LookupTypeID=s,l.HeaderVisiblity=!1,l.OnNodeSelected||(l.OnNodeSelected=new V.Yk,l.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(l)}GetLocation(e,s){let a="";if(e.Visible){for(let t=1;t<e.Items.length;t++)e.Items[t].IsChecked&&(a.length>0&&(a+=","),a+=e.Items[t].Value);s&&(0==a.length&&(a="-100"),e.Items[0].IsChecked&&"1"==n.d.SessionManager.RoleID&&(a=""))}return a}OnLocationCheckedChanged(e){if(!this.LockCheckedChanged&&e.item instanceof d.oN){let s=e.item,a=50001==s.Type||50002==s.Type?50001==s.Type?this.Division:this.Location:this.DimensionWise;if("All"==s.Value){this.LockCheckedChanged=!0;for(let t=1;t<a.Items.length;t++)a.Items[t].IsChecked=s.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,s.IsChecked){a.Items[0].IsChecked=!0;for(let t=1;t<a.Items.length;t++)if(!a.Items[t].IsChecked){a.Items[0].IsChecked=!1;break}}else a.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}OnButtonClick(e){if("Cancel"==e.toString())n.d.page.HideDialog(this.PopUpGUID);else if("LocationSearch"!=e&&"DivisionSearch"!=e&&"DimensionWiseSearch"!=e)try{if(null!=parent){if(this.TreeVisibility&&this.Dimension>5e3){let t=!1;if(null!=this.CostCenterFilters&&this.CostCenterFilters.length>0){var s=this.CostCenterFilters.find(i=>i.CostCenterID==this.Dimension);null!=s&&s.SelectedNodes.length>0&&(t=!0)}if(!t){var a=this.CostCenters.Items.find(i=>i.Value==this.Dimension.toString());if(null!=a)return this.CostCenters.SelectedValue=this.Dimension.ToString(),this.DisplayMessage="select "+a.Name,void(this.MessageVisibility=!0)}}this.parent.DialogResult=!0,this.parent.FromDate=this.FromDate.Date,this.parent.ToDate=this.ToDate.Date,this.parent.CustomerID=this.Customer.SelectedValue,this.parent.StatusID=this.Status.SelectedValue,this.parent.BasedOn=this.BasedOn.SelectedValue,this.parent.InvoiceDate=this.InvoiceDate.Date,this.parent.TillDate=this.TillDate.Date,this.parent.FromValue=this.parent.Locations=this.GetLocation(this.Location,!0),this.parent.Divisions=this.GetLocation(this.Division,!0),this.parent.Dimensions=this.GetLocation(this.DimensionWise,!0),this.parent.TreeWhere="",this.TreeVisibility&&null!=this.CostCenterFilters&&this.CostCenterFilters.length>0&&(this.parent.TreeWhere=this.GetDimensionFilter("L.dcCCNID")),this.parent.LoadGenerateBills(),this.parent.GBDialog=this,this.MessageVisibility=!1,n.d.page.HideDialog(this.PopUpGUID)}}catch(t){Logger.ErrorLog("PostedDocumentDialogViewModel","OnButtonClick",t.Message)}}GetDimensionFilter(e,s=null){let a="";return this.CostCenterFilters.forEach(t=>{if(t.CostCenterID>5e4&&(null==s||!s.Contains(t.CostCenterID)))if(t.SelectedNodes.length>0){let i="";for(let l=0;l<t.SelectedNodes.length;l++)t.SelectedNodes[l].IsGroup||(i+=t.SelectedNodes[l].Id+",");i.length>1&&(i=i.substr(0,i.length-1),a+=" AND "+e+(t.CostCenterID-5e4)+" in("+i+")")}else t.DeleteButtonVisibility||(a+=" AND ",a+=e+(t.CostCenterID-5e4)+"=-12912")}),a.toString()}GetTagTableName(e){return 2==e?"ACC_Accounts":3==e?"INV_Product":7==e?"ADM_Users":50001==e?"COM_Division":50002==e?"COM_Location":50003==e?"COM_Branch":50004==e?"COM_Department":50005==e?"COM_Salesman":50006==e?"COM_Category":50007==e?"COM_Area":50008==e?"COM_Teritory":"COM_CC"+e}OnDateRangesSelectionChanged(e){null!=this.DateRanges.SelectedValue&&O.w.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.ToDate)}onVoucherWiseCheck(e){this.VoucherWise=e.IsChecked,this.VoucherWise=!0,this.DateWise=!1,this.DateWiseRadio.IsChecked=!1}onDateWiseCheck(e){this.DateWise=e.IsChecked,this.DateWise=!0,this.VoucherWise=!1,this.VoucherWiseRadio.IsChecked=!1}}var p=u(11460);class k extends P.g{get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}get OnlyFirstInvs(){return this._OnlyFirstInvs}set OnlyFirstInvs(e){e!=this._OnlyFirstInvs&&(this._OnlyFirstInvs=e,this.FilterfirstInvs(e))}constructor(e){super(),this.InProgress="",this.ProgressMessage="",this.ProgressValue=0,this.ProgressWidth=0,this.ProgressMax=0,this._SelectAll=!1,this.chkSelectAll=new y.c,this._OnlyFirstInvs=!1,this.chkOnlyFirstInvs=new y.c,this.VoucherWise=!1,this.DateWise=!1,this.rdoVoucherWise=new S.u("",0,"Doc"),this.rdoDateWise=new S.u("",0,"Doc"),this.Locations="",this.Divisions="",this.Dimensions="",this.TreeWhere="",this.StatusID="",this.FromValue=null,this.TOValue=null,this.DialogResult=!1,this.FromDate=new Date,this.ToDate=new Date,this.TillDate=new Date,this.InvoiceDate=new Date,this.dtpref=null,this.ShowProcessDialog=!1,this.VirtualVouchersTable=[],this.DisplayName=e,this.LoadGrid(),this.rdoVoucherWise.Label=n.d.GetResource("Com_HCNoWise"),this.rdoVoucherWise.CheckedChangedCommand.Subscribe(this,"onVoucherWiseCheck"),this.rdoDateWise.Label=n.d.GetResource("Com_DateWise"),this.rdoDateWise.CheckedChangedCommand.Subscribe(this,"onDateWiseCheck"),this.chkSelectAll.Label=n.d.GetResource("Selectall"),this.chkSelectAll.CheckedChangedCommand.Subscribe(this,"onSelectall"),this.chkOnlyFirstInvs.Label=n.d.GetResource("OnlyFirst"),this.chkOnlyFirstInvs.CheckedChangedCommand.Subscribe(this,"onOnlyFirstInvs"),this.ProgressWidth=1,this.Vouchers.Height=500;let s=new B;s.GenerateBillsDialogViewModel_1(this),n.d.page.openDialog(s,p.N,{ShowCenter:!0,Title:"Generate Bills"})}onSelectall(e){this.SelectAll=e.IsChecked}onOnlyFirstInvs(e){this.OnlyFirstInvs=e.IsChecked}onVoucherWiseCheck(e){this.VoucherWise=e.IsChecked,this.DateWise=!1,this.rdoDateWise.IsChecked=!1}onDateWiseCheck(e){this.DateWise=e.IsChecked,this.VoucherWise=!1,this.rdoVoucherWise.IsChecked=!1}OnBeginEdit(e){return!r.J0.IsEmpty(e.args.item.BillNo)}LoadGenerateBills(){this.OnButtonClick("OK")}LoadGrid(){this.Vouchers=new w.vv(!0),this.Vouchers.CanUserDeleteRows=!0,this.Vouchers.Table=[],this.Vouchers.OnBeginEdit.Subscribe(this,"OnBeginEdit"),this.Vouchers.TableColumns.push("Select"),this.Vouchers.TableColumns.push("Sno"),this.Vouchers.TableColumns.push("Date"),this.Vouchers.TableColumns.push("HCNo"),this.Vouchers.TableColumns.push("Customer"),this.Vouchers.TableColumns.push("Product"),this.Vouchers.TableColumns.push("BillCycle"),this.Vouchers.TableColumns.push("Price"),this.Vouchers.TableColumns.push("CustomerID"),this.Vouchers.TableColumns.push("DtBill"),this.Vouchers.TableColumns.push("BillNo"),this.Vouchers.TableColumns.push("Billdate"),this.Vouchers.TableColumns.push("TotDays"),this.Vouchers.TableColumns.push("InvDocDetailsID"),this.Vouchers.TableColumns.push("Remarks"),this.Vouchers.TableColumns.push("ProductID"),this.Vouchers.TableColumns.push("Fromdate"),this.Vouchers.TableColumns.push("Todate"),this.Vouchers.TableColumns.push("billseq"),this.Vouchers.TableColumns.push("serialno"),this.Vouchers.TableColumns.push("srnos");let e=new C.O7;this.Vouchers.Columns=[],e=new C.O7,e.Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Sno",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=50,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="HC Date",e.DisplayMember="Date",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="HC No.",e.DisplayMember="HCNo",e.DataType="LINK",e.Click.Subscribe(this,"onHCClick"),e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Customer",e.DisplayMember="Customer",e.DataType="TextBlock",e.Width=200,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Product",e.DisplayMember="Product",e.DataType="TextBlock",e.Width=150,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="BillCycle",e.DisplayMember="BillCycle",e.DataType="TextBlock",e.Width=200,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Tot Days",e.DisplayMember="TotDays",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Qty",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=80,e.ReadOnly=!0,e.IsVisible=!1,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Price",e.DisplayMember="Price",e.DataType="FLOAT",e.Width=70,e.DecimalPoints=n.d.SessionManager.Preferences.DecimalsinAmount,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Bill No",e.DisplayMember="BillNo",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,e.Click.Subscribe(this,"onDOcClick"),this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Bill Date",e.DisplayMember="Billdate",e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new C.O7,e.Header="Remarks",e.DisplayMember="Remarks",e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e);try{let s=[],a=n.d.common.GetDataSet("GB001","");if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[1].Contains("SysColumnName")){let t=a.Tables[0].filter(i=>"GBFields"==i.Name);if(t.length>0&&""!=t[0].Value.ToString()&&(s=t[0].Value.toString().split(";"),null!=s&&s.length>0))for(let i=0;i<a.Tables[1].length;i++)for(let l=0;l<s.length;l++)s[l]==a.Tables[1][i].SysColumnName.toString()&&(e=new C.O7,e.Header=a.Tables[1][i].ResourceData.toString(),e.DisplayMember=a.Tables[1][i].SysColumnName.toString(),e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),this.Vouchers.TableColumns.Contains(a.Tables[1][i].SysColumnName.toString())||this.Vouchers.TableColumns.push(a.Tables[1][i].SysColumnName.toString()))}}catch{}this.Vouchers.SearchVisible=!0,this.Vouchers.SelectAll.Visible=!0,this.Vouchers.SearchColStartIndex=1,this.Vouchers.AddSearchCols()}onHCClick(e){var s=this;return(0,I.A)(function*(){if(null!=s.Vouchers.SelectedItem&&!r.J0.IsEmpty(s.Vouchers.SelectedItem.HCNo)){let a=0,t=n.d.report.GetDocumentDetailsByVoucherNo(s.Vouchers.SelectedItem.HCNo.toString());if(a=r.J0.Int(t.obj),a>0){let i;i=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0];const{AddEditDocumentComponent:l}=yield Promise.resolve().then(u.bind(u,33012)),{AddEditDocumentViewModel:o}=yield Promise.resolve().then(u.bind(u,10287));let c=new o(parseInt(i.CostCenterID),i.DocumentName.toString(),!0);c.ScreenObject.DocPrefix.ComboBox.SelectedValue=i.DocPrefix.toString(),c.ScreenObject.DocPrefix.TextBox.Text=i.DocNumber.toString(),c.OnDocPrefixChanged("lostFocus"),c.ScreenObject.FillDocumentPrefix(!0),n.d.page.addNewTab({component:l,params:{obj:c}})}}})()}onDOcClick(e){var s=this;return(0,I.A)(function*(){if(null!=s.Vouchers.SelectedItem&&!r.J0.IsEmpty(s.Vouchers.SelectedItem.BillNo)){let a=0,t=n.d.report.GetDocumentDetailsByVoucherNo(s.Vouchers.SelectedItem.BillNo.toString());if(a=r.J0.Int(t.obj),a>0){let i;i=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0];const{AddEditDocumentComponent:l}=yield Promise.resolve().then(u.bind(u,33012));let o=new M.AddEditDocumentViewModel(parseInt(i.CostCenterID),i.DocumentName.toString(),!0);o.ScreenObject.DocPrefix.ComboBox.SelectedValue=i.DocPrefix.toString(),o.ScreenObject.DocPrefix.TextBox.Text=i.DocNumber.toString(),o.OnDocPrefixChanged("lostFocus"),o.ScreenObject.FillDocumentPrefix(!0),n.d.page.addNewTab({component:l,params:{obj:o}})}}})()}OnButtonClick(e){if("Hide"==e)this.ShowProcessDialog=!1;else if("Generate Bills"==e)this.ProgressMessage="Resaving documents.Please wait...",this.ShowProcessDialog=!0,this.SaveCall();else if("Export"!=e)if("OK"==e){this.SelectAll=!1;let s=0,a=0;null!=this.FromValue&&r.J0.Int(this.FromValue)>0&&(s=parseInt(this.FromValue)),null!=this.TOValue&&r.J0.Int(this.TOValue)>0&&(a=parseInt(this.TOValue));let i,t=this.GetBills(this.FromDate,this.ToDate,this.VoucherWise,s,a,this.TillDate,this.CustomerID,this.Locations,this.Divisions,this.Dimensions,this.TreeWhere);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>0)return this.DisplayMessage=t.Tables[0][0].ErrorMessage.toString(),void(this.MessageVisibility=!0);if(null!=t&&t.Tables.length>0){let l=!1;if(t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("Name")){this.dtpref=t.Tables[1];let o=this.dtpref.filter(g=>"GBFields"==g.Name);if(o.length>0&&""!=o[0].Value.ToString()&&(i=o[0].Value.toString().split(";")),!this.Vouchers.TableColumns.Contains("Qty")){let g=this.dtpref.filter(h=>"QtyBased"==h.Name);g.length>0&&!r.J0.IsEmpty(g[0].Value)&&(0,b.yG0)(g[0].Value.toString())&&(this.Vouchers.TableColumns.push("Qty"),this.Vouchers.Columns[8].IsVisible=!0,this.Vouchers.UpdateFooter())}let c=this.dtpref.filter(g=>"InvoiceOnDelDate"==g.Name);c.length>0&&(l=(0,b.yG0)(c[0].Value.toString())),l&&!this.Vouchers.TableColumns.Contains("InvDate")&&this.Vouchers.TableColumns.push("InvDate")}this.Vouchers.Table.Clear();for(let o=0;o<t.Tables[0].length;o++){let c=this.Vouchers.NewRow();if(this.GetSerNo(t,t.Tables[0][o],c),"1"==this.StatusID&&!r.J0.IsEmpty(t.Tables[0][o].BillNo)||"2"==this.StatusID&&""==r.J0.String(t.Tables[0][o].BillNo))continue;c.Date=r.J0.ParseDate(t.Tables[0][o].docdate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]),c.HCNo=t.Tables[0][o].voucherno,c.Customer=t.Tables[0][o].accountname,c.CustomerID=t.Tables[0][o].debitaccount,c.Product=t.Tables[0][o].productname,c.ProductID=t.Tables[0][o].Prodid,c.Fromdate=r.J0.ParseDate(r.J0.String(t.Tables[0][o].Fromdate)),c.Todate=r.J0.ParseDate(r.J0.String(t.Tables[0][o].Todate)),c.BillCycle="from "+r.J0.ParseDate(t.Tables[0][o].Fromdate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"])+"- to "+r.J0.ParseDate(t.Tables[0][o].Todate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]),r.J0.IsEmpty(t.Tables[0][o].Amount)||(c.Price=parseFloat(t.Tables[0][o].Amount.toString()).ToString("N"+n.d.SessionManager.Preferences.DecimalsinAmount));let h=r.J0.ParseDate(t.Tables[0][o].Todate.toString()).Subtract(r.J0.ParseDate(t.Tables[0][o].Fromdate.toString())).TotalDays+1;r.J0.IsEmpty(t.Tables[0][o].ExlDays)||(h-=parseInt(t.Tables[0][o].ExlDays.toString())),c.TotDays=h,c.DtBill=r.J0.ParseDate(t.Tables[0][o].Billdate.toString()),c.Billdate=r.J0.ParseDate(t.Tables[0][o].Billdate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]),c.BillNo=t.Tables[0][o].BillNo,c.InvDocDetailsID=t.Tables[0][o].InvDocDetailsID,c.Sno=(o+1).toString(),c.Select=!1,this.Vouchers.TableColumns.Contains("Qty")&&t.Columns[0].Contains("Qty")&&(c.Qty=t.Tables[0][o].Qty),this.Vouchers.TableColumns.Contains("billseq")&&t.Columns[0].Contains("billseq")&&(c.billseq=t.Tables[0][o].billseq),l&&(c.InvDate="1"==c.billseq.toString()?r.J0.ParseDate(r.J0.String(t.Tables[0][o].Fromdate)):r.J0.ParseDate(r.J0.String(t.Tables[0][o].Todate)));let m=this.dtpref.filter(D=>"OffHireDoc"==D.Name);if(m.length>0&&!r.J0.IsEmpty(m[0].Value)&&parseInt(m[0].Value.toString())>0&&(c.Remarks=t.Columns[0].Contains("isoffhire")&&!r.J0.IsEmpty(t.Tables[0][o].isoffhire)&&(0,b.yG0)(t.Tables[0][o].isoffhire.toString())?"Off Hire":"Hire cont."),null!=i&&i.length>0)for(let D=0;D<i.length;D++)t.Columns[0].Contains(i[D])&&!r.J0.IsEmpty(t.Tables[0][o][i[D]])&&(c[i[D]]=t.Tables[0][o][i[D]].toString());this.Vouchers.addRow(c)}this.VirtualVouchersTable=this.Vouchers.Table,this.FilterfirstInvs(this.OnlyFirstInvs)}}else"Refresh"==e&&(null!=this.GBDialog?(this.GBDialog.MessageVisibility=!1,n.d.page.openDialog(this.GBDialog,p.N,{ShowCenter:!0,Title:"Generate Bills"})):(this.GBDialog=new B,this.GBDialog.GenerateBillsDialogViewModel_1(this),n.d.page.openDialog(this.GBDialog,p.N,{ShowCenter:!0,Title:"Generate Bills"})))}GetSerNo(e,s,a){if(e.Tables.length>2&&e.Tables[2].length>0&&e.Columns[2].Contains("SerialNumber")){let t=null;if(!r.J0.IsEmpty(s.retid)){t=e.Tables[2].filter(i=>i.InvDocDetailsID==s.retid.toString());for(let i=0;i<t.length;i++){let l=e.Tables[2].filter(o=>o.InvDocDetailsID==r.J0.String(s.tempid)&&o.SerialNumber==r.J0.String(t[i].SerialNumber));l.length>0&&e.Tables[2].Remove(l[0])}}if(t=e.Tables[2].filter(i=>i.InvDocDetailsID==r.J0.String(s.tempid)),t.length>0){let i="",l="";l+="<xml>";for(let o=0;o<t.length;o++)l+="<Row ",l+=' SerialProductID="0" ',l+=' SerialNumber="'+r.J0.String(t[o].SerialNumber)+'" ',l+=' StockCode="'+r.J0.String(t[o].StockCode)+'" ',l+=' Quantity="0" ',l+=' Narration="" ',l+=' IsIssue="1" ',l+=' StatusID="158" ',l+=' RefInvDocDetailsID="'+r.J0.String(t[o].RefInvDocDetailsID)+'" ',l+=' IsAvailable="0" ',l+=' SerialGUID="'+r.J0.String(t[o].SerialGUID)+'" ',l+=" ></Row>",""!=i&&(i+=","),i+=r.J0.String(t[o].SerialNumber);l+="</xml>",a.serialno=l.toString(),a.srnos=i}}}GetExportHTML(){let e="",s="";e+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",s+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",s+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",s+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",s+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",e+="<style>"+s.toString()+"</style>";let t=0;for(let l=0;l<this.Vouchers.Columns.length;l++)t+=this.Vouchers.Columns[l].Width;e+="<table>",e+="\r\n<tr><td align='center'><h2>",e+=n.d.SessionManager.CompanyName,e+="</h2></td></tr>",e+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",e+=this.DisplayName,e+="</h3></td></tr>",e+="\r\n<tr><td align='center'>",e+=" From :  "+this.FromDate.ToString(n.d.SessionManager.Preferences["Date Format"]),e+=" &nbs;&nbsp;&nbsp;To :  "+this.ToDate.ToString(n.d.SessionManager.Preferences["Date Format"]),e+="</td></tr>",e+="<tr><td style='padding-top:10p;'><table border=1 width='"+t+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",e+="<COLGROUP>";for(let l=0;l<this.Vouchers.Columns.length-2;l++)e+="FLOAT"==this.Vouchers.Columns[l].DataType?"<COL style='text-align:righ;'>":"<COL style=''>";e+="</COLGROUP>",e+="<tr style=''>";for(let l=0;l<this.Vouchers.Columns.length-2;l++)e+="<th class='hdr' width='"+this.Vouchers.Columns[l].Width,e+="px' >",e+=this.Vouchers.Columns[l].Header,e+="</th>";e+="</tr>";let i=this.Vouchers.Table;for(let l=0;l<i.length;l++){e+="<tr",l%2==1&&(e+=" class=alt"),e+=">";for(let o=0;o<this.Vouchers.Columns.length-2;o++)e+="<td",e+="FLOAT"==this.Vouchers.Columns[o].DataType?" align='right'":" align='left'",e+=">",e+=i[l][this.Vouchers.Columns[o].DisplayMember].toString(),e+="</td>";e+="</tr>"}return e+="</table>",e+="</td></tr></table>",e+="</body><html>",e}SelectUnselectAll(e){let s=this.Vouchers.Table;for(let a=0;a<s.length;a++)""==r.J0.String(s[a].BillNo)&&(s[a].Select=e);this.Vouchers.refreshDataView()}FilterfirstInvs(e){this.Vouchers.TableColumns.Contains("billseq")&&(this.Vouchers.Table=e?this.VirtualVouchersTable.filter(s=>1==s.billseq):this.VirtualVouchersTable)}SaveCall(){if(this.ProgressValue=1,null==this.dtpref)return;let e=0,s=0,a=!1;this.Billdatefld="";let t=this.dtpref.filter(h=>"SIVDoc"==h.Name);if(t.length>0&&(e=parseInt(t[0].Value.toString())),t=this.dtpref.filter(h=>"HireContractDoc"==h.Name),t.length>0&&(s=parseInt(t[0].Value.toString())),t=this.dtpref.filter(h=>"SIVBillingDate"==h.Name),t.length>0&&(this.Billdatefld=t[0].Value.toString()),t=this.dtpref.filter(h=>"InvoiceOnDelDate"==h.Name),t.length>0&&(a=(0,b.yG0)(t[0].Value.toString())),0==e)return;this.objViewModel=new M.AddEditDocumentViewModel(e,"",!0),this.objViewModel.GenratePrefix=!0;var i=this.objViewModel.ScreenObject.Link.LinkCombo.Items.find(h=>h.Parent==s.toString());if(null==i||null==i)return void(this.DisplayMessage="Please place linking between Hire Contract and Sales invoice Docuemnt");if(this.objViewModel.ScreenObject.Link.LinkCombo.SelectedValue=i.Value,!this.objViewModel.ScreenObject.GridDataColumns.Contains(this.Billdatefld))return void(this.DisplayMessage="Sales invoice Billing Date should be in body");let l="",o=null;"1"==this.BasedOn?a?(o=this.Vouchers.Table.filter(h=>1==h.Select),o=o.sort((h,m)=>h.CustomerID>m.CustomerID||h.CustomerID==m.CustomerID&&h.InvDate>m.InvDate?1:-1)):(o=this.Vouchers.Table.filter(h=>1==h.Select),o=o.sort((h,m)=>m.CustomerID-h.CustomerID)):a?(o=this.Vouchers.Table.filter(h=>1==h.Select),o=o.sort((h,m)=>h.HCNo>m.HCNo||h.HCNo==m.HCNo&&h.InvDate>m.InvDate?1:-1)):(o=this.Vouchers.Table.filter(h=>1==h.Select),o=o.sort((h,m)=>m.HCNo-h.HCNo)),this.obja=[];let c=null,g=[];for(let h=0;h<o.length;h++)g.Contains(o[h].HCNo.toString())||g.push(o[h].HCNo),(0==h||a&&r.J0.ParseDate(o[h].InvDate.toString()).Date()!=r.J0.ParseDate(o[h-1].InvDate.toString()).Date()||"1"==this.BasedOn&&r.J0.String(o[h].CustomerID)!=r.J0.String(o[h-1].CustomerID)||"1"!=this.BasedOn&&r.J0.String(o[h].HCNo)!=r.J0.String(o[h-1].HCNo))&&(h>0&&this.obja.push(c),c=[]),c.push(o[h]);null!=c&&this.obja.push(c);for(let h=0;h<g.length;h++)""!=l&&(l+="','"),l+=g[h].toString();this.ProgressMax=this.obja.length,this.InProgress=this.ProgressValue+" of "+this.ProgressMax,this.ProgressWidth=100*(this.ProgressValue-1)/this.ProgressMax,0==this.ProgressWidth&&(this.ProgressWidth=1),this.objViewModel.ScreenObject.GetLinkDocDetails(l,parseInt(i.Value),"",!0).subscribe(h=>{this.dsLink=h,this.objViewModel.IsSelectAll=!0,this.iLoop=0,this.objViewModel.SaveCallBackMethod.Subscribe(this,"SaveCallBack_Complete"),this.SaveCallBack()})}SaveCallBack(){let e=!1,s=this.dtpref.filter(t=>"InvoiceOnDelDate"==t.Name);if(s.length>0&&(e=(0,b.yG0)(s[0].Value.toString())),this.iLoop>=this.obja.length)return this.Vouchers.refreshDataView(),void(this.ShowProcessDialog=!1);this.InProgress=this.ProgressValue+" of "+this.ProgressMax,this.ids=this.obja[this.iLoop],this.objViewModel.DocumentDate=this.InvoiceDate,this.objViewModel.DocumentDate=e&&this.ids.length>0?r.J0.ParseDate(this.ids[0].InvDate).Date():this.InvoiceDate;for(let t=0;t<this.ids.length;t++){let i=[];i.push(this.ids[t]),0==t&&null!=this.objViewModel.ScreenObject.DebitAccount&&(this.objViewModel.ScreenObject.DebitAccount.SelectedValue=parseInt(r.J0.String(this.ids[t].CustomerID)),this.objViewModel.ScreenObject.Data.Tables[0].filter(c=>null!=c.LocalReference&&c.LocalReference=="'"+this.objViewModel.ScreenObject.DebitAccount.DBColumnID+"'").length>0&&this.objViewModel.ScreenObject.GetLinkReferenceData(this.objViewModel.ScreenObject.DebitAccount.DBColumnID,this.objViewModel.CostCenterID,this.objViewModel.ScreenObject.DebitAccount.SelectedValue,this.objViewModel.DocumentDate,this.objViewModel.ScreenObject.DebitAccount.DBColumnName,2,null));let l=this.objViewModel.GetEmptyRowPosition(this.objViewModel.ScreenObject.GridDataObj,"ProductID_Key");if(this.objViewModel.LoadLinkData(this.dsLink,i,0,[],null),this.objViewModel.ScreenObject.GridData[l][this.Billdatefld]=r.J0.ParseDate(this.ids[t].DtBill.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]),this.objViewModel.ScreenObject.GridDataColumns.Contains(this.Billdatefld+"_Key")&&(this.objViewModel.ScreenObject.GridData[l][this.Billdatefld+"_Key"]=r.J0.ParseDate(this.ids[t].DtBill.toString())),this.objViewModel.ScreenObject.GridDataColumns.Contains("dcnum10")&&(this.objViewModel.ScreenObject.GridData[l].dcnum10=this.ids[t].TotDays.toString()),!r.J0.IsEmpty(this.ids[t].Fromdate)&&this.objViewModel.ScreenObject.GridDataColumns.Contains("dcalpha6_Key")&&(this.objViewModel.ScreenObject.GridData[l].dcalpha6_Key=r.J0.ParseDate(this.ids[t].Fromdate.toString()),this.objViewModel.ScreenObject.GridData[l].dcalpha6=r.J0.ParseDate(this.ids[t].Fromdate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"])),!r.J0.IsEmpty(this.ids[t].Todate)&&this.objViewModel.ScreenObject.GridDataColumns.Contains("dcalpha7_Key")&&(this.objViewModel.ScreenObject.GridData[l].dcalpha7_Key=r.J0.ParseDate(this.ids[t].Todate.toString()),this.objViewModel.ScreenObject.GridData[l].dcalpha7=r.J0.ParseDate(this.ids[t].Todate.toString()).ToString(n.d.SessionManager.Preferences["Date Format"])),this.objViewModel.ScreenObject.GridData[l].ProductID_Key.toString()!=this.ids[t].ProductID.toString()&&(this.objViewModel.ScreenObject.GridData[l].ProductID_Key=this.ids[t].ProductID.toString()),this.objViewModel.ScreenObject.GridData[l].Rate=this.ids[t].Price.toString(),this.Vouchers.TableColumns.Contains("Qty")&&!r.J0.IsEmpty(this.ids[t].Qty)&&(this.objViewModel.ScreenObject.GridData[l].Quantity=this.ids[t].Qty.toString()),this.objViewModel.ScreenObject.GridDataColumns.Contains("LineNarration")&&(this.objViewModel.ScreenObject.GridData[l].LineNarration=this.ids[t].BillCycle.toString()+"("+this.ids[t].Remarks.toString()+")"),""!=this.ids[t].serialno.toString()&&"2"==this.objViewModel.ScreenObject.GridData[l].Type.toString()){this.objViewModel.ScreenObject.GridData[l].ExtraXML=this.ids[t].serialno.toString();var a=this.objViewModel.ScreenObject.Data.Tables[0].filter(o=>79==o.LocalReference&&54308==o.LinkData);a.length>0&&a.length>0&&this.objViewModel.ScreenObject.GridDataColumns.Contains(a[0].SysColumnName.toString())&&(this.objViewModel.ScreenObject.GridData[l][a[0].SysColumnName.toString()]=this.ids[t].srnos.toString())}this.objViewModel.CalculateTotals(this.objViewModel.ScreenObject.GridData[l],!1)}this.objViewModel.SaveInventoryDocument("Save",!1)}SaveCallBack_Complete(){setTimeout(()=>{if(this.objViewModel.RetValue<=0)this.objViewModel.clear(1);else for(let e=0;e<this.ids.length;e++)this.ids[e].BillNo=this.objViewModel.DisplayMessage,this.ids[e].Select=!1;this.ProgressValue++,this.iLoop++,this.SaveCallBack()},30)}GetBills(e,s,a,t,i,l,o,c,g,h,m){Logger.InfoLog("Document:: Inside GetBills");try{let D=[];return D.push(e.ToString("dd/MMM/yyyy")),D.push(s.ToString("dd/MMM/yyyy")),D.push(a),D.push(t),D.push(i),D.push(l.ToString("dd/MMM/yyyy")),D.push(o),D.push(c),D.push(g),D.push(h),D.push(m),D.push(n.d.SessionManager.UserName),D.push(n.d.SessionManager.UserID),D.push(n.d.SessionManager.LanguageID),n.d.document.GetBills(D)}catch(D){return Logger.ErrorLog("Document:: GetBills"+D.stack),null}}}}}]);